{"version":3,"file":"og.umd.js","sources":["../../src/math.ts","../../src/LonLat.ts","../../src/mercator.ts","../../src/Extent.ts","../../src/math/Mat3.ts","../../src/math/Vec4.ts","../../src/math/Mat4.ts","../../src/math/Quat.ts","../../src/math/Vec3.ts","../../src/math/Vec2.ts","../../src/utils/colorTable.ts","../../src/utils/shared.ts","../../src/astro/jd.ts","../../src/bv/Box.ts","../../src/bv/Sphere.ts","../../src/Events.ts","../../src/ui/View.ts","../../src/ui/Button.ts","../../src/control/Control.ts","../../src/control/CompassButton.ts","../../src/ui/icons.ts","../../src/ui/Dialog.ts","../../src/ui/ToggleButton.ts","../../src/quadTree/quadTree.ts","../../src/layer/Material.ts","../../src/layer/Layer.ts","../../src/layer/CanvasTiles.ts","../../src/ui/ButtonGroup.ts","../../src/utils/BaseWorker.ts","../../src/entity/LabelWorker.ts","../../src/entity/BaseBillboard.ts","../../src/entity/Billboard.ts","../../src/entity/Geometry.ts","../../src/math/Line2.ts","../../src/math/Line3.ts","../../src/math/Ray.ts","../../src/entity/GeoObject.ts","../../src/entity/Label.ts","../../src/entity/PointCloud.ts","../../src/entity/Polyline.ts","../../src/entity/Ray.ts","../../src/entity/Strip.ts","../../src/entity/Entity.ts","../../src/utils/objParser.ts","../../src/Object3d.ts","../../src/scene/BaseNode.ts","../../src/scene/RenderNode.ts","../../src/cons.ts","../../src/webgl/types.ts","../../src/webgl/variableHandlers.ts","../../src/webgl/Program.ts","../../src/shaders/billboard.ts","../../src/entity/BaseBillboardHandler.ts","../../src/entity/BillboardHandler.ts","../../src/entity/GeoObjectHandler.ts","../../src/shaders/geoObject.ts","../../src/shaders/label.ts","../../src/entity/LabelHandler.ts","../../src/entity/PointCloudHandler.ts","../../src/shaders/pointCloud.ts","../../src/entity/PolylineHandler.ts","../../src/shaders/polyline.ts","../../src/entity/RayHandler.ts","../../src/shaders/ray.ts","../../src/entity/StripHandler.ts","../../src/entity/EntityCollection.ts","../../src/quadTree/EntityCollectionNode.ts","../../src/math/coder.ts","../../src/utils/earcut.ts","../../src/entity/GeometryHandler.ts","../../src/QueueArray.ts","../../src/layer/Vector.ts","../../src/control/drawing/PolygonDrawingScene.ts","../../src/control/drawing/LineStringDrawingScene.ts","../../src/control/drawing/DrawingControl.ts","../../src/utils/units.ts","../../src/control/EarthCoordinates.ts","../../src/control/EarthNavigation.ts","../../src/layer/BaseGeoImage.ts","../../src/input/input.ts","../../src/control/LayerAnimation.ts","../../src/control/LayerSwitcher.ts","../../src/ui/Slider.ts","../../src/Lock.ts","../../src/control/MouseNavigation.ts","../../src/control/ruler/RulerScene.ts","../../src/control/ruler/Ruler.ts","../../src/control/heightRuler/HeightRulerScene.ts","../../src/control/heightRuler/HeightRuler.ts","../../src/control/ScaleControl.ts","../../src/control/SimpleSkyBackground.ts","../../src/astro/astro.ts","../../src/astro/earth.ts","../../src/light/LightSource.ts","../../src/control/Sun.ts","../../src/control/TouchNavigation.ts","../../src/control/ZoomControl.ts","../../src/control/selection/SelectionScene.ts","../../src/control/timeline/timelineUtils.ts","../../src/control/timeline/TimelineModel.ts","../../src/control/timeline/TimelineView.ts","../../src/control/timeline/TimelineControl.ts","../../src/Deferred.ts","../../src/control/elevationProfile/ElevationProfile.ts","../../src/control/elevationProfile/ElevationProfileView.ts","../../src/control/elevationProfile/ElevationProfileScene.ts","../../src/control/elevationProfile/ElevationProfileButtonsView.ts","../../src/control/elevationProfile/PointListDialog.ts","../../src/control/elevationProfile/ElevationProfileLegend.ts","../../src/control/DebugInfo.ts","../../src/control/DrawingSwitcher.ts","../../src/control/elevationProfile/ElevationProfileControl.ts","../../src/control/GeoImageDragControl.ts","../../src/control/KeyboardNavigation.ts","../../src/control/Lighting.ts","../../src/control/MouseWheelZoomControl.ts","../../src/control/RulerSwitcher.ts","../../src/control/selection/Selection.ts","../../src/control/ShowFps.ts","../../src/control/SimpleNavigation.ts","../../src/control/ToggleWireframe.ts","../../src/segment/segmentHelper.ts","../../src/shaders/utils.ts","../../src/shaders/atmos.ts","../../src/shaders/drawnode.ts","../../src/webgl/BaseFramebuffer.ts","../../src/ImageCanvas.ts","../../src/webgl/Framebuffer.ts","../../src/control/Atmosphere.ts","../../src/proj/Proj.ts","../../src/proj/EPSG3857.ts","../../src/proj/EPSG4326.ts","../../src/segment/Slice.ts","../../src/segment/Segment.ts","../../src/quadTree/Node.ts","../../src/quadTree/QuadTreeStrategy.ts","../../src/segment/SegmentLonLat.ts","../../src/quadTree/EarthQuadTreeStrategy.ts","../../src/terrain/Geoid.ts","../../src/utils/GeoImageCreator.ts","../../src/utils/Loader.ts","../../src/utils/NormalMapCreator.ts","../../src/utils/PlainSegmentWorker.ts","../../src/camera/Frustum.ts","../../src/camera/Camera.ts","../../src/camera/PlanetCamera.ts","../../src/utils/TerrainWorker.ts","../../src/utils/VectorTileCreator.ts","../../src/ellipsoid/Ellipsoid.ts","../../src/ellipsoid/wgs84.ts","../../src/scene/Planet.ts","../../src/scene/SkyBox.ts","../../src/shaders/skybox.ts","../../src/scene/Axes.ts","../../src/terrain/EmptyTerrain.ts","../../src/terrain/GlobusTerrain.ts","../../src/layer/XYZ.ts","../../src/layer/WMS.ts","../../src/terrain/BilTerrain.ts","../../src/terrain/MapboxTerrain.ts","../../src/layer/GeoImage.ts","../../src/layer/GeoTexture2d.ts","../../src/layer/GeoVideo.ts","../../src/layer/KML.ts","../../src/Clock.ts","../../src/webgl/ProgramController.ts","../../src/Stack.ts","../../src/webgl/Handler.ts","../../src/webgl/Multisample.ts","../../src/input/KeyboardHandler.ts","../../src/input/MouseHandler.ts","../../src/input/TouchHandler.ts","../../src/renderer/RendererEvents.ts","../../src/Rectangle.ts","../../src/utils/ImagesCacheManager.ts","../../src/utils/TextureAtlas.ts","../../src/utils/FontAtlas.ts","../../src/renderer/Renderer.ts","../../src/shaders/screenFrame.ts","../../src/shaders/toneMapping.ts","../../src/shaders/depth.ts","../../src/Globe.ts","../../src/Popup.ts","../../src/segment/SegmentLonLatWgs84.ts","../../src/quadTree/MarsQuadTreeStrategy.ts","../../src/quadTree/Wgs84QuadTreeStrategy.ts","../../src/quadTree/index.ts","../../src/quadTree/EPSG4326QuadTreeStrategy.ts","../../src/math/Plane.ts"],"sourcesContent":["/** @const */\nexport const TWO_PI = 2.0 * Math.PI;\n/** @const */\nexport const PI_TWO = Math.PI / 2.0;\nexport const X = 0;\nexport const Y = 1;\nexport const Z = 2;\nexport const W = 3;\nexport const MAX_FLOAT = Number.MAX_VALUE || 1.7976931348623157e308;\n/** @const */\nexport const LOG2 = Math.log(2);\n/** @const */\nexport const MAX32 = 2147483647;\n/** @const */\nexport const MAX = 549755748352;\n/** @const */\nexport const MIN = -MAX;\n/** @const */\nexport const RADIANS = Math.PI / 180.0;\n/** @const */\nexport const DEGREES = 180.0 / Math.PI;\n/** @const */\nexport const DEGREES_DOUBLE = 2.0 * DEGREES;\n/** @const */\nexport const RADIANS_HALF = 0.5 * RADIANS;\n/** @const */\nexport const ARCSECONDS_TO_RADIANS = 0.00000484813681109536;\n/** @const */\nexport const RADIANS_TO_HOURS = 3.8197186342054880584532103209403;\n/** @const */\nexport const HOURS_TO_RADIANS = 0.26179938779914943653855361527329;\n/** @const */\nexport const HOURS_TO_DEGREES = 15.0;\n/** @const */\nexport const DEGREES_TO_HOURS = 1.0 / 15.0;\n/** @const */\nexport const SQRT_HALF = Math.sqrt(0.5);\nexport const EPS1 = 1e-1;\nexport const EPS2 = 1e-2;\nexport const EPS3 = 1e-3;\nexport const EPS4 = 1e-4;\nexport const EPS5 = 1e-5;\nexport const EPS6 = 1e-6;\nexport const EPS7 = 1e-7;\nexport const EPS8 = 1e-8;\nexport const EPS9 = 1e-9;\nexport const EPS10 = 1e-10;\nexport const EPS11 = 1e-11;\nexport const EPS12 = 1e-12;\nexport const EPS13 = 1e-13;\nexport const EPS14 = 1e-14;\nexport const EPS15 = 1e-15;\nexport const EPS16 = 1e-16;\nexport const EPS17 = 1e-17;\nexport const EPS18 = 1e-18;\nexport const EPS19 = 1e-19;\nexport const EPS20 = 1e-20;\n/**\n * The log function returns the power to which the base value has to be raised to produce n.\n * @function\n * @param {number} n - Produce value.\n * @param {number} base - Base value.\n * @returns {number} -\n * @example\n * log(64, 2)\n * //returns 6\n */\nexport function log(n, base) {\n    return Math.log(n) / Math.log(base);\n}\n/**\n * Clamp the number.\n * @function\n * @param {number} number - Input number.\n * @param {number} min - Minimal edge.\n * @param {number} max - Maximal edge.\n * @returns {number} -\n * @example\n * clamp(12, 1, 5)\n * //returns 5\n */\nexport function clamp(number, min, max) {\n    return Math.max(min, Math.min(number, max));\n}\n/**\n * Converts degrees value to radians.\n * @function\n * @param {number} degrees - Degree value.\n * @returns {number} -\n */\nexport function DEG2RAD(degrees) {\n    return degrees * RADIANS;\n}\n/**\n * Converts radians value to degrees.\n * @function\n * @param {number} angle - Degree value.\n * @returns {number} -\n */\nexport function RAD2DEG(angle) {\n    return angle * DEGREES;\n}\n/**\n * Check the number is a power of two.\n * @function\n * @param {number} x - Input value.\n * @returns {boolean} -\n */\nexport function isPowerOfTwo(x) {\n    return (x & (x - 1)) === 0;\n}\n/**\n * Returns next value that is power of two.\n * @function\n * @param {number} x - Input value.\n * @param {number} [maxValue=4096] - Maximal value.\n * @returns {number} -\n */\nexport function nextHighestPowerOfTwo(x, maxValue = 4096) {\n    --x;\n    for (let i = 1; i < 32; i <<= 1) {\n        x = x | (x >> i);\n    }\n    return (x + 1) > maxValue ? maxValue : x + 1;\n}\n/**\n * Returns random integer number within the bounds.\n * @function\n * @param {number} min - Minimal bound.\n * @param {number} max - Maximal bound.\n * @returns {number} -\n */\nexport function randomi(min = 0, max = 1) {\n    return Math.floor(Math.random() * (max - min)) + min;\n}\n/**\n * Returns random number within the bounds.\n * @function\n * @param {number} [min=0] - Minimal bound.\n * @param {number} [max=1] - Maximal bound.\n * @returns {number} -\n */\nexport function random(min = 0, max = 1) {\n    return Math.random() * (max - min) + min;\n}\n/**\n * Converts degrees value to decimal.\n * @function\n * @param {number} d - Degrees.\n * @param {number} m - Minutes.\n * @param {number} s - Seconds.\n * @param {boolean} [p] - Positive flag. False - default.\n * @returns {number} -\n **/\nexport function degToDec(d, m, s, p) {\n    if (p) {\n        return d + m / 60.0 + s / 3600.0;\n    }\n    else {\n        return -d - m / 60.0 - s / 3600.0;\n    }\n}\n/**\n * The modulo operation that also works for negative dividends.\n * @function\n * @param {number} m - The dividend.\n * @param {number} n - The divisor.\n * @returns {number} The remainder.\n */\nexport function mod(m, n) {\n    return ((m % n) + n) % n;\n}\n/**\n * Returns an angle in the range 0 <= angle <= 2Pi which is equivalent to the provided angle.\n * @function\n * @param {number} a - Angle in radians\n * @returns {number} -\n */\nexport function zeroTwoPI(a) {\n    const res = mod(a, TWO_PI);\n    if (Math.abs(res) < EPS14 && Math.abs(a) > EPS14) {\n        return TWO_PI;\n    }\n    return res;\n}\n/**\n * Returns 0.0 if x is smaller than edge and otherwise 1.0.\n * @function\n * @param {number} edge -\n * @param {number} x - Value to edge.\n * @returns {number} -\n */\nexport function step(edge, x) {\n    return x < edge ? 0.0 : 1.0;\n}\n/**\n * The frac function returns the fractional part of x, i.e. x minus floor(x).\n * @function\n * @param {number} x - Input value.\n * @returns {number} -\n */\nexport function frac(x) {\n    const mx = Math.abs(x);\n    return mx - Math.floor(mx);\n}\n/**\n * Returns Math.log(x) / Math.log(2)\n * @function\n * @param {number} x - Input value.\n * @returns {number} -\n */\nexport function log2(x) {\n    return Math.log(x) / LOG2;\n}\n/**\n * Returns two power of n.\n * @function\n * @param {number} n - Power value.\n * @returns {number} -\n */\nexport function exp2(n) {\n    return Math.pow(2, n);\n}\n/**\n * Returns two power of integer n.\n * @function\n * @param {number} n - Integer power value.\n * @returns {number} -\n */\nexport function pow2i(n) {\n    return 2 << (n - 1);\n}\n/**\n * Returns a slice of linear interpolation t * (h1 - h0)\n * @param {number} t - A value that linearly interpolates between the h0 parameter and the h1 parameter.\n * @param {number} h1 - End value.\n * @param {number} h0 - Start value.\n * @returns {number} -\n */\nexport function slice(t, h1, h0) {\n    return t * (h1 - h0);\n}\n/**\n * Performs a linear interpolation.\n * @function\n * @param {number} t - A value that linearly interpolates between the h0 parameter and the h1 parameter.\n * @param {number} h1 - End value.\n * @param {number} h0 - Start value.\n * @returns {number} -\n */\nexport function lerp(t, h1, h0) {\n    return h0 + t * (h1 - h0);\n}\nexport function cube(f) {\n    return f * f * f;\n}\nexport function square(f) {\n    return f * f;\n}\nexport function bezier1v(t, p0, p1, p2, p3) {\n    return (cube(1 - t) * p0 + 3 * square(1 - t) * t * p1 + 3 * (1 - t) * square(t) * p2 + cube(t) * p3);\n}\n/**\n * Performs a 3D bezier interpolation.\n * @function\n * @param {number} t - Interpolation value.\n * @param {Vec3} p0 - First control point.\n * @param {Vec3} p1 - Second control point.\n * @param {Vec3} p2 - Third control point.\n * @param {Vec3} p3 - Fourth control point.\n * @returns {Vec3} -\n */\nexport function bezier3v(t, p0, p1, p2, p3) {\n    let u = 1 - t;\n    let tt = t * t;\n    let uu = u * u;\n    let uuu = uu * u;\n    let ttt = tt * t;\n    return p0.scaleTo(uuu)\n        .addA(p1.scaleTo(3 * uu * t))\n        .addA(p2.scaleTo(3 * u * tt))\n        .addA(p3.scaleTo(ttt));\n}\n/**\n * Clamp angle value within 360.\n * @function\n * @param {number} x - Input angle.\n * @returns {number} -\n */\nexport function rev(x) {\n    return x - Math.floor(x / 360.0) * 360.0;\n}\n/**\n * Clamp longitude within: -180 to +180 degrees.\n * @function\n * @param {number} lon - Longitude.\n * @returns {number} -\n */\nexport function norm_lon(lon) {\n    return lon > 180 ? ((lon + 180) % 360) - 180 : lon < -180 ? ((lon - 180) % 360) + 180 : lon;\n}\n/**\n * Returns an angle in the range -Pi <= angle <= Pi which is equivalent to the provided angle.\n * @function\n * @param {number} a - Angle in radians.\n * @returns {number} -\n */\nexport function negativePItoPI(a) {\n    return zeroTwoPI(a + Math.PI) - Math.PI;\n}\n/**\n * Solve using iteration method and a fixed number of steps.\n * @function\n * @param {Function} f - Equation. Used in Euler's equation(see og.orbit) solving.\n * @param {number} x0 - First approximation.\n * @param {number} maxIter - Maximum iterations.\n * @returns {number} -\n */\nexport function solve_iteration_fixed(f, x0, maxIter) {\n    let x = 0;\n    let x2 = x0;\n    for (let i = 0; i < maxIter; i++) {\n        x = x2;\n        x2 = f(x);\n    }\n    return x2;\n}\n/**\n * Solve using iteration; terminate when error is below err or the maximum\n * number of iterations is reached. Used in Euler's equation(see og.orbit) solving.\n * @function\n * @param {(x: number) => number} f - Equation.\n * @param {number} x0 - First approximation.\n * @param {number} err - Maximal accepted error value.\n * @param {number} maxIter - Maximum iterations.\n * @returns {number} -\n */\nexport function solve_iteration(f, x0, err, maxIter = 50) {\n    let x = 0;\n    let x2 = x0;\n    for (let i = 0; i < maxIter; i++) {\n        x = x2;\n        x2 = f(x);\n        if (Math.abs(x2 - x) < err) {\n            return x2;\n        }\n    }\n    return x2;\n}\n/**\n * Equation function.\n * @callback equationCallback\n * @param {number} x - Equation variable.\n */\n/**\n *\n * @param a - First bearing angle\n * @param b - Second bearing angle\n * @returns {number}\n */\nfunction getAngleDirection(a, b) {\n    let a_y = Math.cos(a), a_x = Math.sin(a), b_y = Math.cos(b), b_x = Math.sin(b);\n    let c = a_y * b_x - b_y * a_x, d = a_x * b_x + a_y * b_y;\n    if (c > 0.0) {\n        return Math.acos(d);\n    }\n    return -Math.acos(d);\n}\n/**\n * Returns angle between two azimuths\n * @param {number} a - First azimuth angle\n * @param {number} b - Second azimuth angle\n * @returns {number}\n */\nexport function getAngleBetweenAzimuths(a, b) {\n    a = zeroTwoPI(a);\n    b = zeroTwoPI(b);\n    return ((((a - b) % 360) + 360 + 180) % 360) - 180;\n}\n//# sourceMappingURL=math.js.map","import * as mercator from \"./mercator\";\nconst HALF_PI = Math.PI * 0.5;\nconst INV_PI_BY_180 = 180.0 / Math.PI;\nconst INV_PI_BY_360 = INV_PI_BY_180 * 2.0;\nconst PI_BY_360 = Math.PI / 360.0;\nconst INV_PI_BY_180_HALF_PI = INV_PI_BY_180 * HALF_PI;\n/**\n * Represents a geographical point with a certain latitude, longitude and height.\n * @class\n * @param {number} [lon] - Longitude.\n * @param {number} [lat] - Latitude.\n * @param {number} [height] - Height over the surface.\n */\nexport class LonLat {\n    constructor(lon = 0, lat = 0, height = 0) {\n        /**\n         * Longitude.\n         * @public\n         * @type {number}\n         */\n        this.lon = 0;\n        /**\n         * Latitude.\n         * @public\n         * @type {number}\n         */\n        this.lat = 0;\n        /**\n         * Height.\n         * @public\n         * @type {number}\n         */\n        this.height = 0;\n        this.lon = lon;\n        this.lat = lat;\n        this.height = height;\n    }\n    /**\n     * Check zero coordinates\n     * @returns {boolean} -\n     */\n    isZero() {\n        return this.lon === 0.0 && this.lat === 0.0 && this.height === 0.0;\n    }\n    /**\n     * Creates coordinates array.\n     * @static\n     * @param{Array.<Array<number>>} arr - Coordinates array data. (exactly 3 entries)\n     * @return{Array.<LonLat>} the same coordinates array but each element is LonLat instance.\n     */\n    static join(arr) {\n        let res = [];\n        for (let i = 0; i < arr.length; i++) {\n            let ai = arr[i];\n            res[i] = new LonLat(ai[0], ai[1], ai[2]);\n        }\n        return res;\n    }\n    /**\n     * Creates an object by coordinate array.\n     * @static\n     * @param {Array.<number>} arr - Coordinates array, where first is longitude, second is latitude and third is a height. (exactly 3 entries)\n     * @returns {LonLat} -\n     */\n    static createFromArray(arr) {\n        return new LonLat(arr[0], arr[1], arr[2]);\n    }\n    /**\n     * Create array from lonLat\n     * @param lonLat\n     * @returns {number[]}\n     */\n    static toArray(lonLat) {\n        return [lonLat.lon, lonLat.lat, lonLat.height];\n    }\n    /**\n     * Create array from lonLat\n     * @returns {number[]}\n     */\n    toArray() {\n        return LonLat.toArray(this);\n    }\n    /**\n     * Converts degrees to mercator coordinates.\n     * @static\n     * @param {number} lon - Degrees longitude.\n     * @param {number} lat - Degrees latitude.\n     * @param {number} [height] - Height.\n     * @returns {LonLat} -\n     */\n    static forwardMercator(lon, lat, height) {\n        return new LonLat(lon * mercator.POLE_BY_180, Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * mercator.POLE_BY_PI, height);\n    }\n    /**\n     * Converts degrees to mercator coordinates.\n     * @static\n     * @param {LonLat} lonLat - Input geodetic degree coordinates\n     * @param {LonLat} res - Output mercator coordinates\n     * @returns {LonLat} - Output mercator coordinates\n     */\n    static forwardMercatorRes(lonLat, res) {\n        res.lon = lonLat.lon * mercator.POLE_BY_180;\n        res.lat = Math.log(Math.tan((90.0 + lonLat.lat) * PI_BY_360)) * mercator.POLE_BY_PI,\n            res.height = lonLat.height;\n        return res;\n    }\n    /**\n     * Converts mercator to degrees coordinates.\n     * @static\n     * @param {number} x - Mercator longitude.\n     * @param {number} y - Mercator latitude.\n     * @param {number} [height] - Height.\n     * @returns {LonLat} -\n     */\n    static inverseMercator(x, y, height = 0) {\n        return new LonLat(x * mercator.INV_POLE_BY_180, INV_PI_BY_360 * Math.atan(Math.exp(y * mercator.PI_BY_POLE)) - INV_PI_BY_180_HALF_PI, height);\n    }\n    /**\n     * Sets coordinates.\n     * @public\n     * @param {number} [lon] - Longitude.\n     * @param {number} [lat] - Latitude.\n     * @param {number} [height] - Height.\n     * @returns {LonLat} -\n     */\n    set(lon = 0, lat = 0, height = 0) {\n        this.lon = lon;\n        this.lat = lat;\n        this.height = height;\n        return this;\n    }\n    /**\n     * Copy coordinates.\n     * @public\n     * @param {LonLat} [lonLat] - Coordinates to copy.\n     * @returns {LonLat} -\n     */\n    copy(lonLat) {\n        this.lon = lonLat.lon;\n        this.lat = lonLat.lat;\n        this.height = lonLat.height;\n        return this;\n    }\n    /**\n     * Clone the coordinates.\n     * @public\n     * @returns {LonLat} -\n     */\n    clone() {\n        return new LonLat(this.lon, this.lat, this.height);\n    }\n    /**\n     * Converts to mercator coordinates.\n     * @public\n     * @returns {LonLat} -\n     */\n    forwardMercator() {\n        return LonLat.forwardMercator(this.lon, this.lat, this.height);\n    }\n    forwardMercatorEPS01() {\n        let lat = this.lat;\n        if (lat > 89.9) {\n            lat = 89.9;\n        }\n        else if (lat < -89.9) {\n            lat = -89.9;\n        }\n        return new LonLat(this.lon * mercator.POLE_BY_180, Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * mercator.POLE_BY_PI);\n    }\n    /**\n     * Converts from mercator coordinates.\n     * @public\n     * @returns {LonLat} -\n     */\n    inverseMercator() {\n        return LonLat.inverseMercator(this.lon, this.lat, this.height);\n    }\n    /**\n     * Compares coordinates.\n     * @public\n     * @param {LonLat} b - Coordinate to compare with.\n     * @returns {boolean} -\n     */\n    equal(b) {\n        if (b.height) {\n            return this.lon === b.lon && this.lat === b.lat && this.height === b.height;\n        }\n        else {\n            return this.lon === b.lon && this.lat === b.lat;\n        }\n    }\n}\n//# sourceMappingURL=LonLat.js.map","import { Extent } from \"./Extent\";\nimport { LonLat } from './LonLat';\n/**\n * Mercator size.\n * @const\n * @type {number}\n */\nexport const POLE = 20037508.34;\nexport const POLE2 = POLE * 2.0;\nexport const PI_BY_POLE = Math.PI / POLE;\nexport const POLE_BY_PI = POLE / Math.PI;\nconst HALF_PI = Math.PI * 0.5;\nexport const POLE_BY_180 = POLE / 180.0;\nexport const INV_POLE_BY_180 = 180.0 / POLE;\nconst PI_BY_360 = Math.PI / 360.0;\nconst PI_BY_180 = Math.PI / 180.0;\nconst INV_PI_BY_180 = 180.0 / Math.PI;\n/**\n * Double mercator size.\n * @const\n * @type {number}\n */\nexport const POLE_DOUBLE = 2.0 * POLE;\n/**\n * One by mercator double size.\n * @const\n * @type {number}\n */\nexport const ONE_BY_POLE_DOUBLE = 1.0 / POLE_DOUBLE;\nexport function forward(lonLat) {\n    return new LonLat(lonLat.lon * POLE / 180.0, Math.log(Math.tan((90.0 + lonLat.lat) * PI_BY_360)) * POLE_BY_PI, lonLat.height);\n}\n/**\n * Converts degrees longitude to mercator coordinate.\n * @function\n * @param {number} lon - Degrees geodetic longitude.\n * @returns {number} -\n */\nexport function forward_lon(lon) {\n    return lon * POLE / 180.0;\n}\n/**\n * Converts degrees latitude to mercator coordinate.\n * @function\n * @param {number} lat - Degrees geodetic latitude.\n * @returns {number} -\n */\nexport function forward_lat(lat) {\n    return Math.log(Math.tan((90.0 + lat) * PI_BY_360)) * POLE_BY_PI;\n}\n/**\n * Converts mercator longitude to degrees coordinate.\n * @function\n * @param {number} lon - Mercator longitude.\n * @returns {number} -\n */\nexport function inverse_lon(lon) {\n    return 180 * lon / POLE;\n}\n/**\n * Converts mercator latitude to degrees coordinate.\n * @function\n * @param {number} lon - Mercator latitude.\n * @returns {number} -\n */\nexport function inverse_lat(lat) {\n    return INV_PI_BY_180 * (2.0 * Math.atan(Math.exp(lat * PI_BY_POLE)) - HALF_PI);\n}\n/**\n * Returns mercator map tile grid horizontal coordinate index by geodetic\n * longitude and zoom level. Where top left corner of the grid is 0 coordinate index.\n * @function\n * @param {number} lon - Geodetic degrees longitude.\n * @param {number} zoom - Zoom level.\n * @returns {number}\n */\nexport function getTileX(lon, zoom) {\n    return Math.floor((lon + 180) / 360.0 * Math.pow(2, zoom));\n}\n/**\n * Returns mercator map tile grid vertical coordinate index by geodetic\n * latitude and zoom level. Where top left corner of the grid is 0 coordinate index.\n * @function\n * @param {number} lat - Geodetic degrees latitude.\n * @param {number} zoom - Zoom level.\n * @returns {number}\n */\nexport function getTileY(lat, zoom) {\n    return Math.floor((1.0 - Math.log(Math.tan(lat * PI_BY_180) + 1.0 / Math.cos(lat * PI_BY_180)) / Math.PI) * 0.5 * Math.pow(2, zoom));\n}\n/**\n * Converts geodetic coordinate array to mercator coordinate array.\n * @function\n * @param {Array.<LonLat>} lonLatArr - LonLat array to convert.\n * @returns {Array.<LonLat>}\n */\nexport function forwardArray(lonlatArr) {\n    let res = [];\n    for (let i = 0; i < lonlatArr.length; i++) {\n        res.push(lonlatArr[i].forwardMercator());\n    }\n    return res;\n}\nexport function getTileExtent(x, y, z) {\n    let size = POLE2 / Math.pow(2, z), sw = new LonLat(-POLE + x * size, POLE - y * size - size);\n    return new Extent(sw, new LonLat(sw.lon + size, sw.lat + size));\n}\n/**\n * Max mercator latitude.\n * @const\n * @type {number}\n */\nexport const MAX_LAT = inverse_lat(POLE);\n/**\n * Min mercator latitude.\n * @const\n * @type {number}\n */\nexport const MIN_LAT = -MAX_LAT;\n//# sourceMappingURL=mercator.js.map","import * as math from \"./math\";\nimport * as mercator from \"./mercator\";\nimport { LonLat } from \"./LonLat\";\n/**\n * Represents geographical coordinates extent.\n * @class\n * @param {LonLat} [sw] - South West extent corner coordinates.\n * @param {LonLat} [ne] - North East extent corner coordinates.\n */\nexport class Extent {\n    constructor(sw = new LonLat(), ne = new LonLat()) {\n        this.southWest = sw;\n        this.northEast = ne;\n    }\n    /**\n     * Creates extent instance from values in array.\n     * @static\n     * @param {Array.<number>} arr - South west and north-east longitude and latitudes packed in array. (exactly 4 entries)\n     * @return {Extent} Extent object.\n     */\n    static createFromArray(arr) {\n        return new Extent(new LonLat(arr[0], arr[1]), new LonLat(arr[2], arr[3]));\n    }\n    /**\n     * Creates bound extent instance by coordinate array.\n     * @static\n     * @param {Array.<LonLat>} arr - Coordinate array.\n     * @return {Extent} Extent object.\n     */\n    static createByCoordinates(arr) {\n        let lonmin = math.MAX, lonmax = math.MIN, latmin = math.MAX, latmax = math.MIN;\n        for (let i = 0; i < arr.length; i++) {\n            const vi = arr[i];\n            if (vi.lon < lonmin)\n                lonmin = vi.lon;\n            if (vi.lon > lonmax)\n                lonmax = vi.lon;\n            if (vi.lat < latmin)\n                latmin = vi.lat;\n            if (vi.lat > latmax)\n                latmax = vi.lat;\n        }\n        return new Extent(new LonLat(lonmin, latmin), new LonLat(lonmax, latmax));\n    }\n    /**\n     * Creates bound extent instance by coordinates array.\n     * @static\n     * @param {Array.<Array<number>>} arr - Coordinate array. (exactly 2 entries)\n     * @return {Extent} Extent object.\n     */\n    static createByCoordinatesArr(arr) {\n        let lonmin = math.MAX, lonmax = math.MIN, latmin = math.MAX, latmax = math.MIN;\n        for (let i = 0; i < arr.length; i++) {\n            const vi = arr[i];\n            if (vi[0] < lonmin)\n                lonmin = vi[0];\n            if (vi[0] > lonmax)\n                lonmax = vi[0];\n            if (vi[1] < latmin)\n                latmin = vi[1];\n            if (vi[1] > latmax)\n                latmax = vi[1];\n        }\n        return new Extent(new LonLat(lonmin, latmin), new LonLat(lonmax, latmax));\n    }\n    /**\n     * Creates extent by mer—Åator grid tile coordinates.\n     * @static\n     * @param {number} x -\n     * @param {number} y -\n     * @param {number} z -\n     * @param {number} width -\n     * @param {number} height -\n     * @returns {Extent} -\n     */\n    static fromTile(x, y, z, width = mercator.POLE_DOUBLE, height = mercator.POLE_DOUBLE) {\n        const H = Math.pow(2, z);\n        const W = Math.pow(2, z);\n        const lnSize = width / W;\n        const ltSize = height / H;\n        const left = -width * 0.5 + x * lnSize, top = height * 0.5 - y * ltSize, bottom = top - ltSize, right = left + lnSize;\n        return new Extent(new LonLat(left, bottom), new LonLat(right, top));\n    }\n    /**\n     * Sets current bounding extent object by coordinate array.\n     * @public\n     * @param {Array.<LonLat>} arr - Coordinate array.\n     * @return {Extent} Current extent.\n     */\n    setByCoordinates(arr) {\n        let lonmin = math.MAX, lonmax = math.MIN, latmin = math.MAX, latmax = math.MIN;\n        for (let i = 0; i < arr.length; i++) {\n            const vi = arr[i];\n            if (vi.lon < lonmin)\n                lonmin = vi.lon;\n            if (vi.lon > lonmax)\n                lonmax = vi.lon;\n            if (vi.lat < latmin)\n                latmin = vi.lat;\n            if (vi.lat > latmax)\n                latmax = vi.lat;\n        }\n        this.southWest.lon = lonmin;\n        this.southWest.lat = latmin;\n        this.northEast.lon = lonmax;\n        this.northEast.lat = latmax;\n        return this;\n    }\n    /**\n     * Determines if point inside extent.\n     * @public\n     * @param {LonLat} lonlat - Coordinate point.\n     * @return {boolean} Returns true if point inside extent.\n     */\n    isInside(lonlat) {\n        const sw = this.southWest;\n        const ne = this.northEast;\n        return (lonlat.lon >= sw.lon && lonlat.lon <= ne.lon &&\n            lonlat.lat >= sw.lat && lonlat.lat <= ne.lat);\n    }\n    /**\n     * Returns true if two extent overlap each other.\n     * @public\n     * @param {Extent} e - Another extent.\n     * @return {boolean} -\n     */\n    overlaps(e) {\n        const sw = this.southWest;\n        const ne = this.northEast;\n        return (sw.lon <= e.northEast.lon &&\n            ne.lon >= e.southWest.lon &&\n            sw.lat <= e.northEast.lat &&\n            ne.lat >= e.southWest.lat);\n    }\n    /**\n     * Gets extent width.\n     * @public\n     * @return {number} Extent width.\n     */\n    getWidth() {\n        return this.northEast.lon - this.southWest.lon;\n    }\n    /**\n     * Gets extent height.\n     * @public\n     * @return {number} Extent height.\n     */\n    getHeight() {\n        return this.northEast.lat - this.southWest.lat;\n    }\n    /**\n     * Creates clone instance of the current extent.\n     * @public\n     * @return {Extent} Extent clone.\n     */\n    clone() {\n        return new Extent(this.southWest.clone(), this.northEast.clone());\n    }\n    /**\n     * Gets the center coordinate of the extent.\n     * @public\n     * @return {number} Center coordinate.\n     */\n    getCenter() {\n        const sw = this.southWest;\n        const ne = this.northEast;\n        return new LonLat(sw.lon + (ne.lon - sw.lon) * 0.5, sw.lat + (ne.lat - sw.lat) * 0.5);\n    }\n    /**\n     * @public\n     */\n    getNorthWest() {\n        return new LonLat(this.southWest.lon, this.northEast.lat);\n    }\n    /**\n     * @public\n     */\n    getNorthEast() {\n        return new LonLat(this.northEast.lon, this.northEast.lat);\n    }\n    /**\n     * @public\n     */\n    getSouthWest() {\n        return new LonLat(this.southWest.lon, this.southWest.lat);\n    }\n    /**\n     * @public\n     */\n    getSouthEast() {\n        return new LonLat(this.northEast.lon, this.southWest.lat);\n    }\n    /**\n     * @public\n     */\n    getNorth() {\n        return this.northEast.lat;\n    }\n    getEast() {\n        return this.northEast.lon;\n    }\n    /**\n     * @public\n     */\n    getWest() {\n        return this.southWest.lon;\n    }\n    /**\n     * @public\n     */\n    getSouth() {\n        return this.southWest.lat;\n    }\n    /**\n     * Returns extents are equals.\n     * @param {Extent} extent - Extent.\n     * @returns {boolean} -\n     */\n    equals(extent) {\n        return (this.southWest.lon === extent.southWest.lon &&\n            this.southWest.lat === extent.southWest.lat &&\n            this.northEast.lon === extent.northEast.lon &&\n            this.northEast.lat === extent.northEast.lat);\n    }\n    /**\n     * Converts extent coordinates to mercator projection coordinates.\n     * @public\n     * @return {Extent} New instance of the current extent.\n     */\n    forwardMercator() {\n        return new Extent(this.southWest.forwardMercator(), this.northEast.forwardMercator());\n    }\n    /**\n     * Converts extent coordinates from mercator projection to degrees.\n     * @public\n     * @return {Extent} New instance of the current extent.\n     */\n    inverseMercator() {\n        return new Extent(this.southWest.inverseMercator(), this.northEast.inverseMercator());\n    }\n    /**\n     * Gets cartesian bounding bounds of the current ellipsoid.\n     * @public\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\n     * @return {Array.<number>} Cartesian 3d coordinate array. (exactly 6 entries)\n     */\n    getCartesianBounds(ellipsoid) {\n        let xmin = math.MAX, xmax = math.MIN, ymin = math.MAX, ymax = math.MIN, zmin = math.MAX, zmax = math.MIN;\n        const v = [\n            new LonLat(this.southWest.lon, this.southWest.lat),\n            new LonLat(this.southWest.lon, this.northEast.lat),\n            new LonLat(this.northEast.lon, this.northEast.lat),\n            new LonLat(this.northEast.lon, this.southWest.lat)\n        ];\n        for (let i = 0; i < v.length; i++) {\n            const coord = ellipsoid.lonLatToCartesian(v[i]);\n            const x = coord.x;\n            const y = coord.y;\n            const z = coord.z;\n            if (x < xmin)\n                xmin = x;\n            if (x > xmax)\n                xmax = x;\n            if (y < ymin)\n                ymin = y;\n            if (y > ymax)\n                ymax = y;\n            if (z < zmin)\n                zmin = z;\n            if (z > zmax)\n                zmax = z;\n        }\n        return [xmin, ymin, zmin, xmax, ymax, zmax];\n    }\n    toString() {\n        return (`[${this.southWest.lon.toFixed(5)}, ${this.southWest.lat.toFixed(5)}, ${this.northEast.lon.toFixed(5)}, ${this.northEast.lat.toFixed(5)}]`);\n    }\n}\n//# sourceMappingURL=Extent.js.map","import { Mat4 } from \"./Mat4\";\nimport { Vec3 } from \"./Vec3\";\n/**\n * Class represents a 3x3 matrix.\n * @class\n */\nexport class Mat3 {\n    constructor() {\n        /**\n         * A 3x3 matrix, indexing as a column-major order array.\n         * @public\n         * @type {Array.<number>}\n         */\n        this._m = [\n            0, 0, 0,\n            0, 0, 0,\n            0, 0, 0\n        ];\n    }\n    /**\n     * Sets column-major order array matrix.\n     * @public\n     * @param {Array.<number>} m - Matrix array.\n     * @returns {Mat3}\n     */\n    set(m) {\n        this._m[0] = m[0];\n        this._m[1] = m[1];\n        this._m[2] = m[2];\n        this._m[3] = m[3];\n        this._m[4] = m[4];\n        this._m[5] = m[5];\n        this._m[6] = m[6];\n        this._m[7] = m[7];\n        this._m[8] = m[8];\n        return this;\n    }\n    /**\n     * Duplicates a Mat3 instance.\n     * @public\n     * @returns {Mat3}\n     */\n    clone() {\n        let res = new Mat3();\n        res.set(this._m);\n        return res;\n    }\n    /**\n     * Copy matrix.\n     * @public\n     * @param {Mat3} a - Matrix to copy.\n     * @returns {Mat3}\n     */\n    copy(a) {\n        return this.set(a._m);\n    }\n    /**\n     * Creates transposed matrix from the current.\n     * @public\n     * @returns {Mat3}\n     */\n    transposeTo() {\n        let res = new Mat3();\n        let m = this._m;\n        res._m[0] = m[0];\n        res._m[1] = m[3];\n        res._m[2] = m[6];\n        res._m[3] = m[1];\n        res._m[4] = m[4];\n        res._m[5] = m[7];\n        res._m[6] = m[2];\n        res._m[7] = m[5];\n        res._m[8] = m[8];\n        return res;\n    }\n    /**\n     * Sets matrix to identity.\n     * @public\n     * @returns {Mat3}\n     */\n    setIdentity() {\n        this._m[0] = 1;\n        this._m[1] = 0;\n        this._m[2] = 0;\n        this._m[3] = 0;\n        this._m[4] = 1;\n        this._m[5] = 0;\n        this._m[6] = 0;\n        this._m[7] = 0;\n        this._m[8] = 1;\n        return this;\n    }\n    /**\n     * Multiply to 3d vector.\n     * @public\n     * @params {Vec3} p - 3d vector.\n     * @returns {Vec3}\n     */\n    mulVec(p) {\n        let d = p.x, e = p.y, g = p.z;\n        let m = this._m;\n        return new Vec3(m[0] * d + m[3] * e + m[6] * g, m[1] * d + m[4] * e + m[7] * g, m[2] * d + m[5] * e + m[8] * g);\n    }\n    /**\n     * Converts to 4x4 matrix.\n     * @public\n     * @returns {Mat4}\n     */\n    toMatrix4() {\n        let res = new Mat4();\n        let b = res._m;\n        let a = this._m;\n        b[0] = a[0];\n        b[1] = a[1];\n        b[2] = a[2];\n        b[3] = 0;\n        b[4] = a[3];\n        b[5] = a[4];\n        b[6] = a[5];\n        b[7] = 0;\n        b[8] = a[6];\n        b[9] = a[7];\n        b[10] = a[8];\n        b[11] = 0;\n        b[12] = 0;\n        b[13] = 0;\n        b[14] = 0;\n        b[15] = 1;\n        return res;\n    }\n}\n/**\n * Mat3 factory.\n * @static\n * @return {Mat3}\n */\nexport function mat3() {\n    return new Mat3();\n}\n//# sourceMappingURL=Mat3.js.map","import { frac } from \"../math\";\nimport { Vec3 } from \"./Vec3\";\n/**\n * Class represents a 4d vector.\n * @class\n * @param {number} [x] - First value.\n * @param {number} [y] - Second value.\n * @param {number} [z] - Third value.\n * @param {number} [w] - Fourth value.\n */\nexport class Vec4 {\n    constructor(x = 0.0, y = 0.0, z = 0.0, w = 0.0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n    }\n    /**\n     * Identity vector [0,0,0,1].\n     * @const\n     * @type {Vec4}\n     */\n    static get identity() {\n        return new Vec4(0, 0, 0, 1);\n    }\n    /**\n     * Creates 4d vector from array.\n     * @function\n     * @param {Array.<number>} arr - Array of four values\n     * @returns {Vec4}\n     */\n    static fromVec(arr) {\n        return new Vec4(arr[0], arr[1], arr[2], arr[3]);\n    }\n    /**\n     * Converts to Vec3, without fourth value.\n     * @public\n     * @returns {Vec3}\n     */\n    toVec3() {\n        return new Vec3(this.x, this.y, this.z);\n    }\n    /**\n     * Returns clone vector.\n     * @public\n     * @returns {Vec4}\n     */\n    clone() {\n        return new Vec4(this.x, this.y, this.z, this.w);\n    }\n    /**\n     * Compares with vector. Returns true if it equals another.\n     * @public\n     * @param {Vec4} v - Vector to compare.\n     * @returns {boolean}\n     */\n    equal(v) {\n        return this.x === v.x && this.y === v.y && this.z === v.z && this.w === v.w;\n    }\n    /**\n     * Copy input vector's values.\n     * @param {Vec4} v - Vector to copy.\n     * @returns {Vec4}\n     */\n    copy(v) {\n        this.x = v.x;\n        this.y = v.y;\n        this.z = v.z;\n        this.w = v.w;\n        return this;\n    }\n    /**\n     * Converts vector to a number array.\n     * @public\n     * @returns {Array.<number>} - (exactly 4 entries)\n     */\n    toArray() {\n        return [this.x, this.y, this.z, this.w];\n    }\n    /**\n     * Converts vector to a number array.\n     * @public\n     * @returns {Array.<number>} - (exactly 4 entries)\n     */\n    toArray3() {\n        return [this.x, this.y, this.z];\n    }\n    /**\n     * Sets vector's values.\n     * @public\n     * @param {number} x - Value X.\n     * @param {number} y - Value Y.\n     * @param {number} z - Value Z.\n     * @param {number} w - Value W.\n     * @returns {Vec4}\n     */\n    set(x, y, z, w) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n        return this;\n    }\n    /**\n     * Adds vector to the current.\n     * @public\n     * @param {Vec4} v - Vector to add.\n     * @returns {Vec4}\n     */\n    addA(v) {\n        this.x += v.x;\n        this.y += v.y;\n        this.z += v.z;\n        this.w += v.w;\n        return this;\n    }\n    /**\n     * Subtract vector from the current.\n     * @public\n     * @param {Vec4} v - Subtract vector.\n     * @returns {Vec4}\n     */\n    subA(v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        this.z -= v.z;\n        this.w -= v.w;\n        return this;\n    }\n    /**\n     * Scale current vector.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec4}\n     */\n    scale(scale) {\n        this.x *= scale;\n        this.y *= scale;\n        this.z *= scale;\n        this.w *= scale;\n        return this;\n    }\n    /**\n     * Makes vector affinity. Thereby fourth component becomes to 1.0.\n     * @public\n     * @returns {Vec4}\n     */\n    affinity() {\n        let iw = 1.0 / this.w;\n        this.x *= iw;\n        this.y *= iw;\n        this.z *= iw;\n        this.w = 1.0;\n        return this;\n    }\n    /**\n     * Scale current vector to another instance.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec3}\n     */\n    scaleTo(scale) {\n        return new Vec4(this.x * scale, this.y * scale, this.z * scale, this.w * scale);\n    }\n    /**\n     * Vector's edge function that returns vector where each component is 0.0 if it's smaller than edge and otherwise 1.0.\n     * @public\n     * @returns {Vec4}\n     */\n    getStep(edge) {\n        return new Vec4(this.x < edge ? 0.0 : 1.0, this.y < edge ? 0.0 : 1.0, this.z < edge ? 0.0 : 1.0, this.w < edge ? 0.0 : 1.0);\n    }\n    /**\n     * The vector frac function returns the vector of fractional parts of each value, i.e. x minus floor(x).\n     * @public\n     * @param {Vec4} v - Input vector\n     * @returns {Vec4}\n     */\n    getFrac(v) {\n        return new Vec4(frac(v.x), frac(v.y), frac(v.z), frac(v.w));\n    }\n    /**\n     * Gets vectors dot production.\n     * @public\n     * @param {Vec4} v - Another vector.\n     * @returns {number} - Dot product.\n     */\n    dot(v) {\n        return v.x * this.x + v.y * this.y + v.z * this.z + v.w * this.w;\n    }\n    /**\n     * Returns true if vector's values are zero.\n     * @public\n     * @returns {boolean} -\n     */\n    isZero() {\n        return !(this.x || this.y || this.z || this.w);\n    }\n}\n/**\n * Vector 4d object creator.\n * @function\n * @param {number} [x] - First value.\n * @param {number} [y] - Second value.\n * @param {number} [z] - Third value.\n * @param {number} [w] - Fourth value.\n * @returns {Vec4}\n */\nexport function vec4(x = 0, y = 0, z = 0, w = 0) {\n    return new Vec4(x, y, z, w);\n}\n//# sourceMappingURL=Vec4.js.map","import { Mat3 } from \"./Mat3\";\nimport { Quat } from \"./Quat\";\nimport { Vec3 } from \"./Vec3\";\nimport { Vec4 } from \"./Vec4\";\n/**\n * Class represents a 4x4 matrix.\n * @class\n */\nexport class Mat4 {\n    constructor() {\n        /**\n         * A 4x4 matrix, index-able as a column-major order array.\n         * @public\n         * @type {Array.<number>}\n         */\n        this._m = [\n            0, 0, 0, 0,\n            0, 0, 0, 0,\n            0, 0, 0, 0,\n            0, 0, 0, 0\n        ];\n    }\n    /**\n     * Returns identity matrix instance.\n     * @static\n     * @returns {Mat4} -\n     */\n    static identity() {\n        let res = new Mat4();\n        res._m[0] = 1;\n        res._m[1] = 0;\n        res._m[2] = 0;\n        res._m[3] = 0;\n        res._m[4] = 0;\n        res._m[5] = 1;\n        res._m[6] = 0;\n        res._m[7] = 0;\n        res._m[8] = 0;\n        res._m[9] = 0;\n        res._m[10] = 1;\n        res._m[11] = 0;\n        res._m[12] = 0;\n        res._m[13] = 0;\n        res._m[14] = 0;\n        res._m[15] = 1;\n        return res;\n    }\n    /**\n     * Sets column-major order array matrix.\n     * @public\n     * @param {Array.<number>} m - Matrix array.\n     * @returns {Mat4} -\n     */\n    set(m) {\n        this._m[0] = m[0];\n        this._m[1] = m[1];\n        this._m[2] = m[2];\n        this._m[3] = m[3];\n        this._m[4] = m[4];\n        this._m[5] = m[5];\n        this._m[6] = m[6];\n        this._m[7] = m[7];\n        this._m[8] = m[8];\n        this._m[9] = m[9];\n        this._m[10] = m[10];\n        this._m[11] = m[11];\n        this._m[12] = m[12];\n        this._m[13] = m[13];\n        this._m[14] = m[14];\n        this._m[15] = m[15];\n        return this;\n    }\n    /**\n     * Duplicates a Matrix3 instance.\n     * @public\n     * @returns {Mat4} -\n     */\n    clone() {\n        let res = new Mat4();\n        res.set(this._m);\n        return res;\n    }\n    /**\n     * Copy matrix.\n     * @public\n     * @param {Mat4} a - Matrix to copy.\n     * @return {Mat4}\n     */\n    copy(a) {\n        return this.set(a._m);\n    }\n    /**\n     * Converts to 3x3 matrix.\n     * @public\n     * @returns {Mat3} -\n     */\n    toMatrix3() {\n        let res = new Mat3();\n        let a = this._m, b = res._m;\n        b[0] = a[0];\n        b[1] = a[1];\n        b[2] = a[2];\n        b[3] = a[4];\n        b[4] = a[5];\n        b[5] = a[6];\n        b[6] = a[8];\n        b[7] = a[9];\n        b[8] = a[10];\n        return res;\n    }\n    /**\n     * Multiply to 3d vector.\n     * @public\n     * @param {Vec3} p - 3d vector.\n     * @returns {Vec3} -\n     */\n    mulVec3(p) {\n        let d = p.x, e = p.y, g = p.z;\n        return new Vec3(this._m[0] * d + this._m[4] * e + this._m[8] * g + this._m[12], this._m[1] * d + this._m[5] * e + this._m[9] * g + this._m[13], this._m[2] * d + this._m[6] * e + this._m[10] * g + this._m[14]);\n    }\n    /**\n     * Multiply to 4d vector.\n     * @public\n     * @param {Vec4} p - 4d vector.\n     * @returns {Vec4} -\n     */\n    mulVec4(p) {\n        let d = p.x, e = p.y, g = p.z, f = p.w;\n        return new Vec4(this._m[0] * d + this._m[4] * e + this._m[8] * g + this._m[12] * f, this._m[1] * d + this._m[5] * e + this._m[9] * g + this._m[13] * f, this._m[2] * d + this._m[6] * e + this._m[10] * g + this._m[14] * f, this._m[3] * d + this._m[7] * e + this._m[11] * g + this._m[15] * f);\n    }\n    /**\n     * Creates an inverse 3x3 matrix of the current.\n     * @public\n     * @returns {Mat3} -\n     */\n    toInverseMatrix3() {\n        let a = this._m;\n        let c = a[0], d = a[1], e = a[2], g = a[4], f = a[5], h = a[6], i = a[8], j = a[9], k = a[10], l = k * f - h * j, o = -k * g + h * i, m = j * g - f * i, n = c * l + d * o + e * m;\n        if (!n) {\n            return;\n        }\n        n = 1.0 / n;\n        let res = new Mat3();\n        res._m[0] = l * n;\n        res._m[1] = (-k * d + e * j) * n;\n        res._m[2] = (h * d - e * f) * n;\n        res._m[3] = o * n;\n        res._m[4] = (k * c - e * i) * n;\n        res._m[5] = (-h * c + e * g) * n;\n        res._m[6] = m * n;\n        res._m[7] = (-j * c + d * i) * n;\n        res._m[8] = (f * c - d * g) * n;\n        return res;\n    }\n    /**\n     * Creates an inverse matrix of the current.\n     * @public\n     * @returns {Mat4} -\n     */\n    inverseTo(res = new Mat4()) {\n        let c = this._m[0], d = this._m[1], e = this._m[2], g = this._m[3], f = this._m[4], h = this._m[5], i = this._m[6], j = this._m[7], k = this._m[8], l = this._m[9], o = this._m[10], m = this._m[11], n = this._m[12], p = this._m[13], r = this._m[14], s = this._m[15], A = c * h - d * f, B = c * i - e * f, t = c * j - g * f, u = d * i - e * h, v = d * j - g * h, w = e * j - g * i, x = k * p - l * n, y = k * r - o * n, z = k * s - m * n, C = l * r - o * p, D = l * s - m * p, E = o * s - m * r, q = 1 / (A * E - B * D + t * C + u * z - v * y + w * x);\n        res._m[0] = (h * E - i * D + j * C) * q;\n        res._m[1] = (-d * E + e * D - g * C) * q;\n        res._m[2] = (p * w - r * v + s * u) * q;\n        res._m[3] = (-l * w + o * v - m * u) * q;\n        res._m[4] = (-f * E + i * z - j * y) * q;\n        res._m[5] = (c * E - e * z + g * y) * q;\n        res._m[6] = (-n * w + r * t - s * B) * q;\n        res._m[7] = (k * w - o * t + m * B) * q;\n        res._m[8] = (f * D - h * z + j * x) * q;\n        res._m[9] = (-c * D + d * z - g * x) * q;\n        res._m[10] = (n * v - p * t + s * A) * q;\n        res._m[11] = (-k * v + l * t - m * A) * q;\n        res._m[12] = (-f * C + h * y - i * x) * q;\n        res._m[13] = (c * C - d * y + e * x) * q;\n        res._m[14] = (-n * u + p * B - r * A) * q;\n        res._m[15] = (k * u - l * B + o * A) * q;\n        return res;\n    }\n    /**\n     * Creates a transposed matrix of the current.\n     * @public\n     * @returns {Mat4} -\n     */\n    transposeTo() {\n        let res = new Mat4();\n        res._m[0] = this._m[0];\n        res._m[1] = this._m[4];\n        res._m[2] = this._m[8];\n        res._m[3] = this._m[12];\n        res._m[4] = this._m[1];\n        res._m[5] = this._m[5];\n        res._m[6] = this._m[9];\n        res._m[7] = this._m[13];\n        res._m[8] = this._m[2];\n        res._m[9] = this._m[6];\n        res._m[10] = this._m[10];\n        res._m[11] = this._m[14];\n        res._m[12] = this._m[3];\n        res._m[13] = this._m[7];\n        res._m[14] = this._m[11];\n        res._m[15] = this._m[15];\n        return res;\n    }\n    /**\n     * Sets matrix to identity.\n     * @public\n     * @returns {Mat4} -\n     */\n    setIdentity() {\n        this._m[0] = 1;\n        this._m[1] = 0;\n        this._m[2] = 0;\n        this._m[3] = 0;\n        this._m[4] = 0;\n        this._m[5] = 1;\n        this._m[6] = 0;\n        this._m[7] = 0;\n        this._m[8] = 0;\n        this._m[9] = 0;\n        this._m[10] = 1;\n        this._m[11] = 0;\n        this._m[12] = 0;\n        this._m[13] = 0;\n        this._m[14] = 0;\n        this._m[15] = 1;\n        return this;\n    }\n    /**\n     * Computes the product of two matrices.\n     * @public\n     * @param {Mat4} mx - Matrix to multiply.\n     * @returns {Mat4} -\n     */\n    mul(mx) {\n        let d = this._m[0], e = this._m[1], g = this._m[2], f = this._m[3], h = this._m[4], i = this._m[5], j = this._m[6], k = this._m[7], l = this._m[8], o = this._m[9], m = this._m[10], n = this._m[11], p = this._m[12], r = this._m[13], s = this._m[14], a = this._m[15];\n        let A = mx._m[0], B = mx._m[1], t = mx._m[2], u = mx._m[3], v = mx._m[4], w = mx._m[5], x = mx._m[6], y = mx._m[7], z = mx._m[8], C = mx._m[9], D = mx._m[10], E = mx._m[11], q = mx._m[12], F = mx._m[13], G = mx._m[14], b = mx._m[15];\n        let res = new Mat4();\n        res._m[0] = A * d + B * h + t * l + u * p;\n        res._m[1] = A * e + B * i + t * o + u * r;\n        res._m[2] = A * g + B * j + t * m + u * s;\n        res._m[3] = A * f + B * k + t * n + u * a;\n        res._m[4] = v * d + w * h + x * l + y * p;\n        res._m[5] = v * e + w * i + x * o + y * r;\n        res._m[6] = v * g + w * j + x * m + y * s;\n        res._m[7] = v * f + w * k + x * n + y * a;\n        res._m[8] = z * d + C * h + D * l + E * p;\n        res._m[9] = z * e + C * i + D * o + E * r;\n        res._m[10] = z * g + C * j + D * m + E * s;\n        res._m[11] = z * f + C * k + D * n + E * a;\n        res._m[12] = q * d + F * h + G * l + b * p;\n        res._m[13] = q * e + F * i + G * o + b * r;\n        res._m[14] = q * g + F * j + G * m + b * s;\n        res._m[15] = q * f + F * k + G * n + b * a;\n        return res;\n    }\n    /**\n     * Add translation vector to the current matrix.\n     * @public\n     * @param {Vec3} v - Translate vector.\n     * @returns {Mat4} -\n     */\n    translate(v) {\n        let d = v.x, e = v.y, b = v.z;\n        let a = this._m;\n        a[12] = a[0] * d + a[4] * e + a[8] * b + a[12];\n        a[13] = a[1] * d + a[5] * e + a[9] * b + a[13];\n        a[14] = a[2] * d + a[6] * e + a[10] * b + a[14];\n        a[15] = a[3] * d + a[7] * e + a[11] * b + a[15];\n        return this;\n    }\n    /**\n     * Sets translation matrix to the position.\n     * @public\n     * @param {Vec3} v - Translate to position.\n     * @returns {Mat4} -\n     */\n    translateToPosition(v) {\n        let a = this._m;\n        a[12] = v.x;\n        a[13] = v.y;\n        a[14] = v.z;\n        return this;\n    }\n    /**\n     * Rotate current matrix around the aligned axis and angle.\n     * @public\n     * @param {Vec3} u - Aligned axis.\n     * @param {number} angle - Aligned axis angle in radians.\n     * @returns {Mat4} -\n     */\n    rotate(u, angle) {\n        let c = Math.cos(angle), s = Math.sin(angle);\n        let rot = new Mat4();\n        let mx = rot._m;\n        mx[0] = c + (1 - c) * u.x * u.x;\n        mx[1] = (1 - c) * u.y * u.x - s * u.z;\n        mx[2] = (1 - c) * u.z * u.x + s * u.y;\n        mx[3] = 0;\n        mx[4] = (1 - c) * u.x * u.y + s * u.z;\n        mx[5] = c + (1 - c) * u.y * u.y;\n        mx[6] = (1 - c) * u.z * u.y - s * u.x;\n        mx[7] = 0;\n        mx[8] = (1 - c) * u.x * u.z - s * u.y;\n        mx[9] = (1 - c) * u.y * u.z + s * u.x;\n        mx[10] = c + (1 - c) * u.z * u.z;\n        mx[11] = 0;\n        mx[12] = 0;\n        mx[13] = 0;\n        mx[14] = 0;\n        mx[15] = 1;\n        return this.mul(rot);\n    }\n    /**\n     * Sets current rotation matrix around the aligned axis and angle.\n     * @public\n     * @param {Vec3} u - Aligned axis.\n     * @param {number} angle - Aligned axis angle in radians.\n     * @returns {Mat4} -\n     */\n    setRotation(u, angle) {\n        let c = Math.cos(angle), s = Math.sin(angle);\n        let mx = this._m;\n        mx[0] = c + (1 - c) * u.x * u.x;\n        mx[1] = (1 - c) * u.y * u.x - s * u.z;\n        mx[2] = (1 - c) * u.z * u.x + s * u.y;\n        mx[3] = 0;\n        mx[4] = (1 - c) * u.x * u.y + s * u.z;\n        mx[5] = c + (1 - c) * u.y * u.y;\n        mx[6] = (1 - c) * u.z * u.y - s * u.x;\n        mx[7] = 0;\n        mx[8] = (1 - c) * u.x * u.z - s * u.y;\n        mx[9] = (1 - c) * u.y * u.z + s * u.x;\n        mx[10] = c + (1 - c) * u.z * u.z;\n        mx[11] = 0;\n        mx[12] = 0;\n        mx[13] = 0;\n        mx[14] = 0;\n        mx[15] = 1;\n        return this;\n    }\n    /**\n     * Gets the rotation matrix from one vector to another.\n     * @public\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Mat4} -\n     */\n    rotateBetweenVectors(a, b) {\n        let q = Quat.getRotationBetweenVectors(a, b);\n        return q.getMat4();\n    }\n    /**\n     * Scale current matrix to the vector values.\n     * @public\n     * @param {Vec3} v - Scale vector.\n     * @returns {Mat4} -\n     */\n    scale(v) {\n        let mx = this._m;\n        mx[0] = mx[0] * v.x;\n        mx[1] = mx[1] * v.x;\n        mx[2] = mx[2] * v.x;\n        mx[3] = mx[3] * v.x;\n        mx[4] = mx[4] * v.y;\n        mx[5] = mx[5] * v.y;\n        mx[6] = mx[6] * v.y;\n        mx[7] = mx[7] * v.y;\n        mx[8] = mx[8] * v.z;\n        mx[9] = mx[9] * v.z;\n        mx[10] = mx[10] * v.z;\n        mx[11] = mx[11] * v.z;\n        return this;\n    }\n    /**\n     * Sets perspective projection matrix frustum values.\n     * @public\n     * @param {number} left -\n     * @param {number} right -\n     * @param {number} bottom -\n     * @param {number} top -\n     * @param {number} near -\n     * @param {number} far -\n     * @returns {Mat4} -\n     */\n    setPerspective(left, right, bottom, top, near, far) {\n        let h = right - left, i = top - bottom, j = far - near;\n        this._m[0] = (near * 2) / h;\n        this._m[1] = 0;\n        this._m[2] = 0;\n        this._m[3] = 0;\n        this._m[4] = 0;\n        this._m[5] = (near * 2) / i;\n        this._m[6] = 0;\n        this._m[7] = 0;\n        this._m[8] = (right + left) / h;\n        this._m[9] = (top + bottom) / i;\n        this._m[10] = -(far + near) / j;\n        this._m[11] = -1;\n        this._m[12] = 0;\n        this._m[13] = 0;\n        this._m[14] = -(far * near * 2) / j;\n        this._m[15] = 0;\n        return this;\n    }\n    /**\n     * Creates current orthographic projection matrix.\n     * @public\n     * @param {number} left -\n     * @param {number} right -\n     * @param {number} bottom -\n     * @param {number} top -\n     * @param {number} near -\n     * @param {number} far -\n     * @return {Mat4} -\n     */\n    setOrtho(left, right, bottom, top, near, far) {\n        let lr = 1.0 / (left - right), bt = 1.0 / (bottom - top), nf = 1.0 / (near - far), m = this._m;\n        m[0] = -2.0 * lr;\n        m[1] = 0;\n        m[2] = 0;\n        m[3] = 0;\n        m[4] = 0;\n        m[5] = -2.0 * bt;\n        m[6] = 0;\n        m[7] = 0;\n        m[8] = 0;\n        m[9] = 0;\n        m[10] = 2.0 * nf;\n        m[11] = 0;\n        m[12] = (left + right) * lr;\n        m[13] = (top + bottom) * bt;\n        m[14] = (far + near) * nf;\n        m[15] = 1.0;\n        return this;\n    }\n    /**\n     * Sets current rotation matrix by euler's angles.\n     * @public\n     * @param {number} ax - Rotation angle in radians around X axis.\n     * @param {number} ay - Rotation angle in radians around Y axis.\n     * @param {number} az - Rotation angle in radians around Z axis.\n     * @returns {Mat4} -\n     */\n    eulerToMatrix(ax, ay, az) {\n        let a = Math.cos(ax), b = Math.sin(ax), c = Math.cos(ay), d = Math.sin(ay), e = Math.cos(az), f = Math.sin(az);\n        let ad = a * d, bd = b * d;\n        let mat = this._m;\n        mat[0] = c * e;\n        mat[1] = -c * f;\n        mat[2] = -d;\n        mat[4] = -bd * e + a * f;\n        mat[5] = bd * f + a * e;\n        mat[6] = -b * c;\n        mat[8] = ad * e + b * f;\n        mat[9] = -ad * f + b * e;\n        mat[10] = a * c;\n        mat[3] = mat[7] = mat[11] = mat[12] = mat[13] = mat[14] = 0;\n        mat[15] = 1;\n        return this;\n    }\n}\n/**\n * Mat4 factory.\n * @static\n * @returns {Mat4} -\n */\nexport function mat4() {\n    return new Mat4();\n}\n//# sourceMappingURL=Mat4.js.map","import * as math from \"../math\";\nimport { Vec3 } from \"./Vec3\";\nimport { Mat4 } from \"./Mat4\";\nimport { Mat3 } from \"./Mat3\";\n/**\n * A set of 4-dimensional coordinates used to represent rotation in 3-dimensional space.\n * @constructor\n * @param {Number} [x=0.0] The X component.\n * @param {Number} [y=0.0] The Y component.\n * @param {Number} [z=0.0] The Z component.\n * @param {Number} [w=0.0] The W component.\n */\nexport class Quat {\n    constructor(x = 0.0, y = 0.0, z = 0.0, w = 0.0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n    }\n    /**\n     * Identity Quat.\n     * @const\n     * @type {Quat}\n     */\n    static get IDENTITY() {\n        return new Quat(0.0, 0.0, 0.0, 1.0);\n    }\n    /**\n     * Returns a Quat represents rotation around X axis.\n     * @static\n     * @param {number} a - The angle in radians to rotate around the axis.\n     * @returns {Quat} -\n     */\n    static xRotation(a) {\n        a *= 0.5;\n        return new Quat(Math.sin(a), 0.0, 0.0, Math.cos(a));\n    }\n    /**\n     * Returns a Quat represents rotation around Y axis.\n     * @static\n     * @param {number} a - The angle in radians to rotate around the axis.\n     * @returns {Quat} -\n     */\n    static yRotation(a) {\n        a *= 0.5;\n        return new Quat(0.0, Math.sin(a), 0.0, Math.cos(a));\n    }\n    /**\n     * Returns a Quat represents rotation around Z axis.\n     * @static\n     * @param {number} a - The angle in radians to rotate around the axis.\n     * @returns {Quat} -\n     */\n    static zRotation(a) {\n        a *= 0.5;\n        return new Quat(0.0, 0.0, Math.sin(a), Math.cos(a));\n    }\n    /**\n     * Computes a Quat representing a rotation around an axis.\n     * @static\n     * @param {Vec3} axis - The axis of rotation.\n     * @param {number} [angle=0.0] The angle in radians to rotate around the axis.\n     * @returns {Quat} -\n     */\n    static axisAngleToQuat(axis, angle = 0) {\n        let v = axis.getNormal();\n        let half_angle = angle * 0.5;\n        let sin_a = Math.sin(half_angle);\n        return new Quat(v.x * sin_a, v.y * sin_a, v.z * sin_a, Math.cos(half_angle));\n    }\n    /**\n     * Computes a rotation from the given heading and up vector.\n     * @static\n     * @param {Vec3} forward - Heading target coordinates.\n     * @param {Vec3} up - Up vector.\n     * @returns {Quat} -\n     */\n    static getLookRotation(forward, up) {\n        let f = forward.getNormal().negate();\n        let s = up.cross(f).normalize();\n        let u = f.cross(s);\n        let z = 1.0 + s.x + u.y + f.z;\n        if (z > 0.000001) {\n            let fd = 1.0 / (2.0 * Math.sqrt(z));\n            return new Quat((f.y - u.z) * fd, (s.z - f.x) * fd, (u.x - s.y) * fd, 0.25 / fd);\n        }\n        if (s.x > u.y && s.x > f.z) {\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + s.x - u.y - f.z));\n            return new Quat(0.25 / fd, (u.x + s.y) * fd, (s.z + f.x) * fd, (f.y - u.z) * fd);\n        }\n        if (u.y > f.z) {\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + u.y - s.x - f.z));\n            return new Quat((u.x + s.y) * fd, 0.25 / fd, (f.y + u.z) * fd, (s.z - f.x) * fd);\n        }\n        let fd = 1.0 / (2.0 * Math.sqrt(1.0 + f.z - s.x - u.y));\n        return new Quat((s.z + f.x) * fd, (f.y + u.z) * fd, 0.25 / fd, (u.x - s.y) * fd);\n    }\n    /**\n     * Computes a Quat from source point heading to the destination point.\n     * @static\n     * @param {Vec3} sourcePoint - Source coordinate.\n     * @param {Vec3} destPoint - Destination coordinate.\n     * @returns {Quat} -\n     */\n    static getLookAtSourceDest(sourcePoint, destPoint) {\n        let forwardVector = destPoint.subA(sourcePoint).normalize();\n        let dot = Vec3.FORWARD.dot(forwardVector);\n        if (Math.abs(dot - -1.0) < 0.000001) {\n            return Quat.axisAngleToQuat(Vec3.UP, Math.PI);\n        }\n        if (Math.abs(dot - 1.0) < 0.000001) {\n            return new Quat(0.0, 0.0, 0.0, 1.0);\n        }\n        let rotAngle = Math.acos(dot);\n        let rotAxis = Vec3.FORWARD.cross(forwardVector).normalize();\n        return Quat.axisAngleToQuat(rotAxis, rotAngle);\n    }\n    /**\n     * Compute rotation between two vectors.\n     * @static\n     * @param {Vec3} u - First vector.\n     * @param {Vec3} v - Second vector.\n     * @returns {Quat} -\n     */\n    static getRotationBetweenVectors(u, v) {\n        let w = u.cross(v);\n        let q = new Quat(w.x, w.y, w.z, 1.0 + u.dot(v));\n        return q.normalize();\n    }\n    /**\n     * Compute rotation between two vectors.\n     * @static\n     * @param {Vec3} u - First vector.\n     * @param {Vec3} v - Second vector.\n     * @param {Quat} res\n     * @returns {Quat} -\n     */\n    static getRotationBetweenVectorsRes(u, v, res) {\n        let w = u.cross(v);\n        res.set(w.x, w.y, w.z, 1.0 + u.dot(v));\n        return res.normalize();\n    }\n    /**\n     * Compute rotation between two vectors with around vector up\n     * for exactly opposite vectors. If vectors exactly in the same\n     * direction as returns identity Quat.\n     * @static\n     * @param {Vec3} source - First vector.\n     * @param {Vec3} dest - Second vector.\n     * @param {Vec3} up - Up vector.\n     * @returns {Quat} -\n     */\n    static getRotationBetweenVectorsUp(source, dest, up) {\n        let dot = source.dot(dest);\n        if (Math.abs(dot + 1.0) < 0.000001) {\n            // vector source and dest point exactly in the opposite direction,\n            // so it is a 180 degrees turn around the up-axis\n            return Quat.axisAngleToQuat(up, Math.PI);\n        }\n        if (Math.abs(dot - 1.0) < 0.000001) {\n            // vector source and dest point exactly in the same direction,\n            // so we return the identity Quat\n            return new Quat(0, 0, 0, 1);\n        }\n        let rotAngle = Math.acos(dot);\n        let rotAxis = source.cross(dest).normalize();\n        return Quat.axisAngleToQuat(rotAxis, rotAngle);\n    }\n    /**\n     * Returns true if the components are zero.\n     * @public\n     * @returns {boolean} -\n     */\n    isZero() {\n        return this.x === 0.0 && this.y === 0.0 && this.z === 0.0 && this.w === 0.0;\n    }\n    /**\n     * Clear Quat. Sets zeroes.\n     * @public\n     * @returns {Quat} -\n     */\n    clear() {\n        this.x = this.y = this.z = this.w = 0;\n        return this;\n    }\n    /**\n     * Sets Quat values.\n     * @public\n     * @param {Number} [x=0.0] The X component.\n     * @param {Number} [y=0.0] The Y component.\n     * @param {Number} [z=0.0] The Z component.\n     * @param {Number} [w=0.0] The W component.\n     * @returns {Quat} -\n     */\n    set(x, y, z, w) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        this.w = w;\n        return this;\n    }\n    /**\n     * Copy Quat values.\n     * @public\n     * @param {Quat} q - Copy Quat.\n     * @returns {Quat} -\n     */\n    copy(q) {\n        this.x = q.x;\n        this.y = q.y;\n        this.z = q.z;\n        this.w = q.w;\n        return this;\n    }\n    /**\n     * Set current Quat instance to identity Quat.\n     * @public\n     * @returns {Quat} -\n     */\n    setIdentity() {\n        this.x = 0.0;\n        this.y = 0.0;\n        this.z = 0.0;\n        this.w = 1.0;\n        return this;\n    }\n    /**\n     * Duplicates a Quat instance.\n     * @public\n     * @returns {Quat} -\n     */\n    clone() {\n        return new Quat(this.x, this.y, this.z, this.w);\n    }\n    /**\n     * Computes the componentwise sum of two Quats.\n     * @public\n     * @param {Quat} q - Quat to add.\n     * @returns {Quat} -\n     */\n    add(q) {\n        return new Quat(this.x + q.x, this.y + q.y, this.z + q.z, this.w + q.w);\n    }\n    /**\n     * Computes the componentwise difference of two Quats.\n     * @public\n     * @param {Quat} q - Quat to subtract.\n     * @returns {Quat} -\n     */\n    sub(q) {\n        return new Quat(this.x - q.x, this.y - q.y, this.z - q.z, this.w - q.w);\n    }\n    /**\n     * Multiplies the provided Quat componentwise by the provided scalar.\n     * @public\n     * @param {Number} scale - The scalar to multiply with.\n     * @returns {Quat} -\n     */\n    scaleTo(scale) {\n        return new Quat(this.x * scale, this.y * scale, this.z * scale, this.w * scale);\n    }\n    /**\n     * Multiplies the provided Quat componentwise.\n     * @public\n     * @param {Number} scale - The scalar to multiply with.\n     * @returns {Quat} -\n     */\n    scale(scale) {\n        this.x *= scale;\n        this.y *= scale;\n        this.z *= scale;\n        this.w *= scale;\n        return this;\n    }\n    /**\n     * Converts Quat values to array.\n     * @public\n     * @returns {Array.<number>} - (exactly 4 entries)\n     */\n    toVec() {\n        return [this.x, this.y, this.z, this.w];\n    }\n    /**\n     * Sets current quaternion by spherical coordinates.\n     * @public\n     * @param {number} lat - Latitude.\n     * @param {number} lon - Longitude.\n     * @param {number} angle - Angle in radians.\n     * @returns {Quat} -\n     */\n    setFromSphericalCoords(lat, lon, angle) {\n        let sin_a = Math.sin(angle / 2);\n        let cos_a = Math.cos(angle / 2);\n        let sin_lat = Math.sin(lat);\n        let cos_lat = Math.cos(lat);\n        let sin_long = Math.sin(lon);\n        let cos_long = Math.cos(lon);\n        this.x = sin_a * cos_lat * sin_long;\n        this.y = sin_a * sin_lat;\n        this.z = sin_a * sin_lat * cos_long;\n        this.w = cos_a;\n        return this;\n    }\n    /**\n     * Sets rotation with the given heading and up vectors.\n     * @static\n     * @param {Vec3} forward - Heading target coordinates.\n     * @param {Vec3} up - Up vector.\n     * @returns {Quat} -\n     */\n    setLookRotation(forward, up) {\n        let f = forward.getNormal().negate();\n        let s = up.cross(f).normalize();\n        let u = f.cross(s);\n        let z = 1.0 + s.x + u.y + f.z;\n        if (z > 0.000001) {\n            let fd = 1.0 / (2.0 * Math.sqrt(z));\n            this.x = (f.y - u.z) * fd;\n            this.y = (s.z - f.x) * fd;\n            this.z = (u.x - s.y) * fd;\n            this.w = 0.25 / fd;\n        }\n        else if (s.x > u.y && s.x > f.z) {\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + s.x - u.y - f.z));\n            this.x = 0.25 / fd;\n            this.y = (u.x + s.y) * fd;\n            this.z = (s.z + f.x) * fd;\n            this.w = (f.y - u.z) * fd;\n        }\n        else if (u.y > f.z) {\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + u.y - s.x - f.z));\n            this.x = (u.x + s.y) * fd;\n            this.y = 0.25 / fd;\n            this.z = (f.y + u.z) * fd;\n            this.w = (s.z - f.x) * fd;\n        }\n        else {\n            let fd = 1.0 / (2.0 * Math.sqrt(1.0 + f.z - s.x - u.y));\n            this.x = (s.z + f.x) * fd;\n            this.y = (f.y + u.z) * fd;\n            this.z = 0.25 / fd;\n            this.w = (u.x - s.y) * fd;\n        }\n        return this;\n    }\n    /**\n     * Gets spherical coordinates.\n     * @public\n     * @returns {Object} Returns object with latitude, longitude and alpha.\n     */\n    toSphericalCoords() {\n        let cos_a = this.w;\n        let sin_a = Math.sqrt(1.0 - cos_a * cos_a);\n        // var angle = Math.acos(cos_a) * 2;\n        if (Math.abs(sin_a) < 0.0005) {\n            sin_a = 1;\n        }\n        let tx = this.x / sin_a;\n        let ty = this.y / sin_a;\n        let tz = this.z / sin_a;\n        let lon, lat = -Math.asin(ty);\n        if (tx * tx + tz * tz < 0.0005) {\n            lon = 0;\n        }\n        else {\n            lon = Math.atan2(tx, tz);\n        }\n        if (lon < 0) {\n            lon += 360.0;\n        }\n        return {\n            lat: lat,\n            lon: lon,\n            alpha: Math.acos(cos_a)\n        };\n    }\n    /**\n     * Sets current Quat representing a rotation around an axis.\n     * @public\n     * @param {Vec3} axis - The axis of rotation.\n     * @param {number} angle The angle in radians to rotate around the axis.\n     * @returns {Quat} -\n     */\n    setFromAxisAngle(axis, angle) {\n        let v = axis.getNormal();\n        let half_angle = angle * 0.5;\n        let sin_a = Math.sin(half_angle);\n        this.set(v.x * sin_a, v.y * sin_a, v.z * sin_a, Math.cos(half_angle));\n        return this;\n    }\n    /**\n     * Returns axis and angle of the current Quat.\n     * @public\n     * @returns {Object} -\n     */\n    getAxisAngle() {\n        let x = this.x, y = this.y, z = this.z, w = this.w;\n        let vl = Math.sqrt(x * x + y * y + z * z);\n        let axis, angle;\n        if (vl > 0.0000001) {\n            let ivl = 1.0 / vl;\n            axis = new Vec3(x * ivl, y * ivl, z * ivl);\n            if (w < 0) {\n                angle = 2.0 * Math.atan2(-vl, -w); // -PI,0\n            }\n            else {\n                angle = 2.0 * Math.atan2(vl, w); // 0,PI\n            }\n        }\n        else {\n            axis = new Vec3(0, 0, 0);\n            angle = 0;\n        }\n        return {\n            axis: axis,\n            angle: angle\n        };\n    }\n    /**\n     * Sets current Quat by Euler's angles.\n     * @public\n     * @param {number} pitch - Pitch angle in degrees.\n     * @param {number} yaw - Yaw angle in degrees.\n     * @param {number} roll - Roll angle in degrees.\n     * @returns {Quat} -\n     */\n    setFromEulerAngles(pitch, yaw, roll) {\n        let ex = pitch * math.RADIANS_HALF, ey = yaw * math.RADIANS_HALF, ez = roll * math.RADIANS_HALF;\n        let cr = Math.cos(ex), cp = Math.cos(ey), cy = Math.cos(ez);\n        let sr = Math.sin(ex), sp = Math.sin(ey), sy = Math.sin(ez);\n        let cpcy = cp * cy, spsy = sp * sy;\n        this.w = cr * cpcy + sr * spsy;\n        this.x = sr * cpcy - cr * spsy;\n        this.y = cr * sp * cy + sr * cp * sy;\n        this.z = cr * cp * sy - sr * sp * cy;\n        return this.normalize();\n    }\n    /**\n     * Returns Euler's angles of the current Quat.\n     * @public\n     * @returns {Object} -\n     */\n    getEulerAngles() {\n        let x = this.x, y = this.y, z = this.z, w = this.w;\n        let sqy = y * y;\n        let roll = Math.atan2(2.0 * (w * x + y * z), 1.0 - 2.0 * (x * x + sqy));\n        let a = w * y - z * x;\n        if (a < -1.0) {\n            a = -1.0;\n        }\n        else if (a > 1.0) {\n            a = 1.0;\n        }\n        let pitch = Math.asin(2.0 * a);\n        let yaw = Math.atan2(2.0 * (w * z + x * y), 1.0 - 2.0 * (sqy + z * z));\n        return {\n            roll,\n            pitch,\n            yaw\n        };\n    }\n    /**\n     * Computes a Quat from the provided 4x4 matrix instance.\n     * @public\n     * @param {Mat4} mx - The rotation matrix.\n     * @returns {Quat} -\n     */\n    setFromMatrix4(mx) {\n        let tr, s, q = [];\n        let i, j, k;\n        let m = mx._m;\n        let nxt = [1, 2, 0];\n        tr = m[0] + m[5] + m[10];\n        if (tr > 0.0) {\n            s = Math.sqrt(tr + 1.0);\n            this.w = s / 2.0;\n            s = 0.5 / s;\n            this.x = (m[6] - m[9]) * s;\n            this.y = (m[8] - m[2]) * s;\n            this.z = (m[1] - m[4]) * s;\n        }\n        else {\n            i = 0;\n            if (m[5] > m[0])\n                i = 1;\n            if (m[10] > m[i * 5])\n                i = 2;\n            j = nxt[i];\n            k = nxt[j];\n            s = Math.sqrt(m[i * 5] - (m[j * 5] + m[k * 5]) + 1.0);\n            q[i] = s * 0.5;\n            if (s !== 0.0)\n                s = 0.5 / s;\n            q[3] = (m[j * 4 + k] - m[k * 4 + j]) * s;\n            q[j] = (m[i * 4 + j] + m[j * 4 + i]) * s;\n            q[k] = (m[i * 4 + k] + m[k * 4 + i]) * s;\n            this.x = q[0];\n            this.y = q[1];\n            this.z = q[2];\n            this.w = q[3];\n        }\n        return this;\n    }\n    /**\n     * Converts current Quat to the rotation 4x4 matrix.\n     * @public\n     * @params {Mat4} [out] - Output matrix\n     * @returns {Mat4} -\n     */\n    getMat4(out = new Mat4()) {\n        let xs = this.x + this.x;\n        let ys = this.y + this.y;\n        let zs = this.z + this.z;\n        let wx = this.w * xs;\n        let wy = this.w * ys;\n        let wz = this.w * zs;\n        let xx = this.x * xs;\n        let xy = this.x * ys;\n        let xz = this.x * zs;\n        let yy = this.y * ys;\n        let yz = this.y * zs;\n        let zz = this.z * zs;\n        return out.set([\n            1 - (yy + zz), xy - wz, xz + wy, 0,\n            xy + wz, 1 - (xx + zz), yz - wx, 0,\n            xz - wy, yz + wx, 1 - (xx + yy), 0,\n            0, 0, 0, 1\n        ]);\n    }\n    /**\n     * Converts current Quat to the rotation 3x3 matrix.\n     * @public\n     * @returns {Mat3} -\n     * @todo NOT TESTED\n     */\n    getMat3() {\n        let m = new Mat3();\n        let mx = m._m;\n        let c = this.x, d = this.y, e = this.z, g = this.w, f = c + c, h = d + d, i = e + e, j = c * f, k = c * h;\n        c = c * i;\n        let l = d * h;\n        d = d * i;\n        e = e * i;\n        f = g * f;\n        h = g * h;\n        g = g * i;\n        mx[0] = 1 - (l + e);\n        mx[1] = k - g;\n        mx[2] = c + h;\n        mx[3] = k + g;\n        mx[4] = 1 - (j + e);\n        mx[5] = d - f;\n        mx[6] = c - h;\n        mx[7] = d + f;\n        mx[8] = 1 - (j + l);\n        return m;\n    }\n    /**\n     * Returns quaternion and vector production.\n     * @public\n     * @param {Vec3} v - 3d Vector.\n     * @returns {Vec3} -\n     */\n    mulVec3(v) {\n        // t = 2 * cross(q.xyz, v)\n        // v' = v + q.w * t + cross(q.xyz, t)\n        let d = v.x, e = v.y, g = v.z;\n        let b = this.x, f = this.y, h = this.z, a = this.w;\n        let i = a * d + f * g - h * e, j = a * e + h * d - b * g, k = a * g + b * e - f * d;\n        d = -b * d - f * e - h * g;\n        return new Vec3(i * a + d * -b + j * -h - k * -f, j * a + d * -f + k * -b - i * -h, k * a + d * -h + i * -f - j * -b);\n    }\n    /**\n     * Computes the product of two Quats.\n     * @public\n     * @param {Quat} q - Quat to multiply.\n     * @returns {Quat} -\n     */\n    mul(q) {\n        let d = this.x, e = this.y, g = this.z, a = this.w;\n        let f = q.x, h = q.y, i = q.z, b = q.w;\n        return new Quat(d * b + a * f + e * i - g * h, e * b + a * h + g * f - d * i, g * b + a * i + d * h - e * f, a * b - d * f - e * h - g * i);\n    }\n    /**\n     * Computes the product of two Quats.\n     * @public\n     * @param {Quat} q - Quat to multiply.\n     * @returns {Quat} -\n     */\n    mulA(q) {\n        let d = this.x, e = this.y, g = this.z, a = this.w;\n        let f = q.x, h = q.y, i = q.z, b = q.w;\n        this.x = d * b + a * f + e * i - g * h;\n        this.y = e * b + a * h + g * f - d * i;\n        this.z = g * b + a * i + d * h - e * f;\n        this.w = a * b - d * f - e * h - g * i;\n        return this;\n    }\n    /**\n     * Gets the conjugate of the Quat.\n     * @public\n     * @returns {Quat} -\n     */\n    conjugate() {\n        return new Quat(-this.x, -this.y, -this.z, this.w);\n    }\n    /**\n     * Computes the inverse of the Quat.\n     * @public\n     * @returns {Quat} -\n     */\n    inverse() {\n        let n = 1.0 / this.magnitude2();\n        return new Quat(-this.x * n, -this.y * n, -this.z * n, this.w * n);\n    }\n    /**\n     * Computes a magnitude of the Quat.\n     * @public\n     * @returns {number} -\n     */\n    magnitude() {\n        let b = this.x, c = this.y, d = this.z, a = this.w;\n        return Math.sqrt(b * b + c * c + d * d + a * a);\n    }\n    /**\n     * Computes a squared magnitude of the Quat.\n     * @public\n     * @returns {number} -\n     */\n    magnitude2() {\n        let b = this.x, c = this.y, d = this.z, a = this.w;\n        return b * b + c * c + d * d + a * a;\n    }\n    /**\n     * Computes the dot (scalar) product of two Quats.\n     * @public\n     * @param {Quat} q - Second quaternion.\n     * @returns {number} -\n     */\n    dot(q) {\n        return this.x * q.x + this.y * q.y + this.z * q.z;\n    }\n    /**\n     * Current Quat normalization.\n     * @public\n     * @returns {Quat} -\n     */\n    normalize() {\n        let c = this.x, d = this.y, e = this.z, g = this.w, f = Math.sqrt(c * c + d * d + e * e + g * g);\n        if (f === 0.0) {\n            this.x = 0;\n            this.y = 0;\n            this.z = 0;\n            this.w = 0;\n            return this;\n        }\n        f = 1 / f;\n        this.x = c * f;\n        this.y = d * f;\n        this.z = e * f;\n        this.w = g * f;\n        return this;\n    }\n    /**\n     * Compares two Quats.\n     * @public\n     * @param {Quat} q - Second quaternion.\n     * @returns {Boolean} -\n     */\n    isEqual(q) {\n        let matching = this.dot(q);\n        if (Math.abs(matching - 1.0) < 0.001) {\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Performs a spherical linear interpolation between two Quats.\n     * @public\n     * @param {Quat} b - The end rotation Quat.\n     * @param {number} t - interpolation amount between the two Quats.\n     * @returns {Quat} -\n     */\n    slerp(b, t) {\n        let ax = this.x, ay = this.y, az = this.z, aw = this.w, bx = b.x, by = b.y, bz = b.z, bw = b.w;\n        let omega, cosom, sinom, scale0, scale1;\n        cosom = ax * bx + ay * by + az * bz + aw * bw;\n        if (cosom < 0.0) {\n            cosom = -cosom;\n            bx = -bx;\n            by = -by;\n            bz = -bz;\n            bw = -bw;\n        }\n        if (1.0 - cosom > 0.000001) {\n            omega = Math.acos(cosom);\n            sinom = Math.sin(omega);\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\n            scale1 = Math.sin(t * omega) / sinom;\n        }\n        else {\n            scale0 = 1.0 - t;\n            scale1 = t;\n        }\n        return new Quat(scale0 * ax + scale1 * bx, scale0 * ay + scale1 * by, scale0 * az + scale1 * bz, scale0 * aw + scale1 * bw);\n    }\n    /**\n     * Returns a roll angle in radians.\n     * @public\n     * @param {Boolean} [reprojectAxis] -\n     * @returns {Number} -\n     */\n    getRoll(reprojectAxis = false) {\n        let x = this.x, y = this.y, z = this.z, w = this.w;\n        if (reprojectAxis) {\n            let fTy = 2.0 * y;\n            let fTz = 2.0 * z;\n            let fTwz = fTz * w;\n            let fTxy = fTy * x;\n            let fTyy = fTy * y;\n            let fTzz = fTz * z;\n            return Math.atan2(fTxy + fTwz, 1.0 - (fTyy + fTzz));\n        }\n        else {\n            return Math.atan2(2 * (x * y + w * z), w * w + x * x - y * y - z * z);\n        }\n    }\n    /**\n     * Returns a pitch angle in radians.\n     * @public\n     * @param {Boolean} [reprojectAxis] -\n     * @returns {number} -\n     */\n    getPitch(reprojectAxis = false) {\n        let x = this.x, y = this.y, z = this.z, w = this.w;\n        if (reprojectAxis) {\n            let fTx = 2.0 * x;\n            let fTz = 2.0 * z;\n            let fTwx = fTx * w;\n            let fTxx = fTx * x;\n            let fTyz = fTz * y;\n            let fTzz = fTz * z;\n            return Math.atan2(fTyz + fTwx, 1.0 - (fTxx + fTzz));\n        }\n        else {\n            return Math.atan2(2 * (y * z + w * x), w * w - x * x - y * y + z * z);\n        }\n    }\n    /**\n     * Returns a yaw angle in radians.\n     * @public\n     * @param {Boolean} [reprojectAxis] -\n     * @returns {number} -\n     */\n    getYaw(reprojectAxis = false) {\n        let x = this.x, y = this.y, z = this.z, w = this.w;\n        if (reprojectAxis) {\n            let fTx = 2.0 * x;\n            let fTy = 2.0 * y;\n            let fTz = 2.0 * z;\n            let fTwy = fTy * w;\n            let fTxx = fTx * x;\n            let fTxz = fTz * x;\n            let fTyy = fTy * y;\n            return Math.atan2(fTxz + fTwy, 1.0 - (fTxx + fTyy));\n        }\n        else {\n            return Math.asin(-2 * (x * z - w * y));\n        }\n    }\n}\n/**\n * Creates Quat instance.\n * @function\n * @param {Number} [x=0.0] The X component.\n * @param {Number} [y=0.0] The Y component.\n * @param {Number} [z=0.0] The Z component.\n * @param {Number} [w=0.0] The W component.\n * @returns {Quat} -\n */\nexport function quat(x = 0, y = 0, z = 0, w = 0) {\n    return new Quat(x, y, z, w);\n}\n//# sourceMappingURL=Quat.js.map","import { Quat } from \"./Quat\";\nimport { Vec4 } from \"./Vec4\";\n/**\n * Class represents a 3d vector.\n * @class\n * @param {number} [x] - First value.\n * @param {number} [y] - Second value.\n * @param {number} [z] - Third value.\n */\nexport class Vec3 {\n    constructor(x = 0.0, y = 0.0, z = 0.0) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    }\n    /** @const */\n    static get UP() {\n        return new Vec3(0, 1, 0);\n    }\n    /** @const */\n    static get DOWN() {\n        return new Vec3(0, -1, 0);\n    }\n    /** @const */\n    static get RIGHT() {\n        return new Vec3(1, 0, 0);\n    }\n    /** @const */\n    static get LEFT() {\n        return new Vec3(-1, 0, 0);\n    }\n    /** @const */\n    static get FORWARD() {\n        return new Vec3(0, 0, -1);\n    }\n    /** @const */\n    static get BACKWARD() {\n        return new Vec3(0, 0, 1);\n    }\n    /** @const */\n    static get ZERO() {\n        return new Vec3();\n    }\n    /** @const */\n    static get UNIT_X() {\n        return new Vec3(1, 0, 0);\n    }\n    /** @const */\n    static get UNIT_Y() {\n        return new Vec3(0, 1, 0);\n    }\n    /** @const */\n    static get UNIT_Z() {\n        return new Vec3(0, 0, 1);\n    }\n    /** @const */\n    static get NORTH() {\n        return Vec3.UNIT_Z;\n    }\n    /**\n     * Separate 63 bit Vec3 to two Vec3 32-bit float values.\n     * @function\n     * @param {Vec3} v - Double type value.\n     * @param {Vec3} high - Out vector high values.\n     * @param {Vec3} low - Out vector low values.\n     */\n    static doubleToTwoFloats(v, high, low) {\n        let x = v.x, y = v.y, z = v.z;\n        if (x >= 0.0) {\n            let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\n            high.x = Math.fround(doubleHigh);\n            low.x = Math.fround(x - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\n            high.x = Math.fround(-doubleHigh);\n            low.x = Math.fround(x + doubleHigh);\n        }\n        if (y >= 0.0) {\n            let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\n            high.y = Math.fround(doubleHigh);\n            low.y = Math.fround(y - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\n            high.y = Math.fround(-doubleHigh);\n            low.y = Math.fround(y + doubleHigh);\n        }\n        if (z >= 0.0) {\n            let doubleHigh = Math.floor(z / 65536.0) * 65536.0;\n            high.z = Math.fround(doubleHigh);\n            low.z = Math.fround(z - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\n            high.z = Math.fround(-doubleHigh);\n            low.z = Math.fround(z + doubleHigh);\n        }\n    }\n    /**\n     * Separate 63 bit Vec3 to two Vec3 32-bit float values.\n     * @function\n     * @param {Vec3} v - Double type value.\n     * @param {Float32Array} high - Out vector high values.\n     * @param {Float32Array} low - Out vector low values.\n     * @returns {Array.<number>} Encoded array. (exactly 2 entries)\n     */\n    static doubleToTwoFloat32Array(v, high, low) {\n        let x = v.x, y = v.y, z = v.z;\n        if (x >= 0.0) {\n            let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\n            high[0] = Math.fround(doubleHigh);\n            low[0] = Math.fround(x - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\n            high[0] = Math.fround(-doubleHigh);\n            low[0] = Math.fround(x + doubleHigh);\n        }\n        if (y >= 0.0) {\n            let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\n            high[1] = Math.fround(doubleHigh);\n            low[1] = Math.fround(y - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\n            high[1] = Math.fround(-doubleHigh);\n            low[1] = Math.fround(y + doubleHigh);\n        }\n        if (z >= 0.0) {\n            let doubleHigh = Math.floor(z / 65536.0) * 65536.0;\n            high[2] = Math.fround(doubleHigh);\n            low[2] = Math.fround(z - doubleHigh);\n        }\n        else {\n            let doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\n            high[2] = Math.fround(-doubleHigh);\n            low[2] = Math.fround(z + doubleHigh);\n        }\n    }\n    /**\n     * Creates 3d vector from array.\n     * @function\n     * @param {NumberArray2 | NumberArray3 | NumberArray4} arr - Input array (exactly 3 entries)\n     * @returns {Vec3} -\n     */\n    static fromVec(arr) {\n        return new Vec3(arr[0], arr[1], arr[2]);\n    }\n    /**\n     * Gets angle between two vectors.\n     * @static\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {number} -\n     */\n    static angle(a, b) {\n        return Math.acos(a.dot(b) / Math.sqrt(a.length2() * b.length2()));\n    }\n    /**\n     * Returns two vectors linear interpolation.\n     * @static\n     * @param {Vec3} v1 - Start vector.\n     * @param {Vec3} v2 - End vector.\n     * @param {number} l - Interpolate value.\n     * @returns {Vec3} -\n     */\n    static lerp(v1, v2, l) {\n        return new Vec3(v1.x + (v2.x - v1.x) * l, v1.y + (v2.y - v1.y) * l, v1.z + (v2.z - v1.z) * l);\n    }\n    /**\n     * Returns summary vector.\n     * @static\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Vec3} - Summary vector.\n     */\n    static add(a, b) {\n        let res = new Vec3(a.x, a.y, a.z);\n        res.addA(b);\n        return res;\n    }\n    /**\n     * Returns two vectors subtraction.\n     * @static\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Vec3} - Vectors subtraction.\n     */\n    static sub(a, b) {\n        let res = new Vec3(a.x, a.y, a.z);\n        res.subA(b);\n        return res;\n    }\n    /**\n     * Returns scaled vector.\n     * @static\n     * @param {Vec3} a - Input vector.\n     * @param {number} scale - Scale value.\n     * @returns {Vec3} -\n     */\n    static scale(a, scale) {\n        return a.scaleTo(scale);\n    }\n    /**\n     * Returns two vectors production.\n     * @static\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Vec3} -\n     */\n    static mul(a, b) {\n        let res = new Vec3(a.x, a.y, a.z);\n        res.mulA(b);\n        return res;\n    }\n    /**\n     * Returns true if two vectors are non-collinear.\n     * @public\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Vec3} -\n     */\n    static noncollinear(a, b) {\n        return Boolean(a.y * b.z - a.z * b.y || a.z * b.x - a.x * b.z || a.x * b.y - a.y * b.z);\n    }\n    /**\n     * Get projection of the vector to plane where n - normal to the plane.\n     * @static\n     * @param {Vec3} b - Vector to project.\n     * @param {Vec3} n - Plane normal.\n     * @param {Vec3} [def] - Default value for non existed result.\n     * @returns {Vec3} -\n     */\n    static proj_b_to_plane(b, n, def) {\n        let res = b.sub(n.scaleTo(n.dot(b) / n.dot(n)));\n        if (def && res.isZero()) {\n            return new Vec3(def.x, def.y, def.z);\n        }\n        return res;\n    }\n    /**\n     * Get projection of the first vector to the second.\n     * @static\n     * @param {Vec3} b - First vector.\n     * @param {Vec3} a - Second vector.\n     * @returns {Vec3} -\n     */\n    static proj_b_to_a(b, a) {\n        return a.scaleTo(a.dot(b) / a.dot(a));\n    }\n    /**\n     * Makes vectors normalized and orthogonal to each other.\n     * Normalizes normal. Normalizes tangent and makes sure it is orthogonal to normal (that is, angle between them is 90 degrees).\n     * @static\n     * @param {Vec3} normal - Normal vector.\n     * @param {Vec3} tangent - Tangent vector.\n     * @returns {Vec3} -\n     */\n    static orthoNormalize(normal, tangent) {\n        normal = normal.getNormal();\n        normal.scale(tangent.dot(normal));\n        return tangent.subA(normal).normalize();\n    }\n    /**\n     * Returns vector components division product one to another.\n     * @static\n     * @param {Vec3} a - First vector.\n     * @param {Vec3} b - Second vector.\n     * @returns {Vec3} -\n     */\n    static div(a, b) {\n        let res = new Vec3(a.x, a.y, a.z);\n        res.divA(b);\n        return res;\n    }\n    static length2(a) {\n        return a.length2();\n    }\n    // static length(a: Vec3): number {\n    //     return a.length();\n    // }\n    static dot(a, b) {\n        return a.dot(b);\n    }\n    /**\n     * Converts to 4d vector, Fourth value is 1.0.\n     * @public\n     * @returns {Vec4} -\n     */\n    toVec4() {\n        return new Vec4(this.x, this.y, this.z, 1.0);\n    }\n    /**\n     * Returns clone vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    clone() {\n        return new Vec3(this.x, this.y, this.z);\n    }\n    /**\n     * Converts vector to text string.\n     * @public\n     * @returns {string} -\n     */\n    toString() {\n        return `(${this.x},${this.y},${this.z})`;\n    }\n    /**\n     * Returns true if vector's values are zero.\n     * @public\n     * @returns {boolean} -\n     */\n    isZero() {\n        return !(this.x || this.y || this.z);\n    }\n    /**\n     * Get projection of the first vector to the second.\n     * @static\n     * @param {Vec3} a - Project vector.\n     * @returns {Vec3} -\n     */\n    projToVec(a) {\n        return a.scaleTo(a.dot(this) / a.dot(a));\n    }\n    /**\n     * Compares with vector. Returns true if it equals another.\n     * @public\n     * @param {Vec3} p - Vector to compare.\n     * @returns {boolean} -\n     */\n    equal(p) {\n        return this.x === p.x && this.y === p.y && this.z === p.z;\n    }\n    /**\n     * Copy input vector's values.\n     * @param {Vec3} p - Vector to copy.\n     * @returns {Vec3} -\n     */\n    copy(p) {\n        this.x = p.x;\n        this.y = p.y;\n        this.z = p.z;\n        return this;\n    }\n    /**\n     * Gets vector's length.\n     * @public\n     * @returns {number} -\n     */\n    length() {\n        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n    }\n    /**\n     * Returns squared vector's length.\n     * @public\n     * @returns {number} -\n     */\n    length2() {\n        return this.x * this.x + this.y * this.y + this.z * this.z;\n    }\n    /**\n     * Converts vector's values to a quaternion object.\n     * @public\n     * @returns {Quat} -\n     */\n    getQuat() {\n        return new Quat(this.x, this.y, this.z);\n    }\n    /**\n     * Adds vector to the current.\n     * @public\n     * @param {Vec3} p - Point to add.\n     * @returns {Vec3} -\n     */\n    addA(p) {\n        this.x += p.x;\n        this.y += p.y;\n        this.z += p.z;\n        return this;\n    }\n    /**\n     * Gets two vectors summarization.\n     * @public\n     * @param {Vec3} p - Vector to add.\n     * @returns {Vec3} Returns a sum vector.\n     */\n    add(p) {\n        return new Vec3(this.x + p.x, this.y + p.y, this.z + p.z);\n    }\n    /**\n     * Subtract vector from the current.\n     * @public\n     * @param {Vec3} p - Subtract vector.\n     * @returns {Vec3} -\n     */\n    subA(p) {\n        this.x -= p.x;\n        this.y -= p.y;\n        this.z -= p.z;\n        return this;\n    }\n    /**\n     * Gets vector subtraction.\n     * @public\n     * @param {Vec3} p - Subtract vector.\n     * @return {Vec3} Returns new instance of a subtraction\n     */\n    sub(p) {\n        return new Vec3(this.x - p.x, this.y - p.y, this.z - p.z);\n    }\n    /**\n     * Scale current vector.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec3} -\n     */\n    scale(scale) {\n        this.x *= scale;\n        this.y *= scale;\n        this.z *= scale;\n        return this;\n    }\n    /**\n     * Scale current vector to another instance.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec3} -\n     */\n    scaleTo(scale) {\n        return new Vec3(this.x * scale, this.y * scale, this.z * scale);\n    }\n    /**\n     * Multiply current vector object to another and store result in the current instance.\n     * @public\n     * @param {Vec3} vec - Multiply vector.\n     * @returns {Vec3} -\n     */\n    mulA(vec) {\n        this.x *= vec.x;\n        this.y *= vec.y;\n        this.z *= vec.z;\n        return this;\n    }\n    /**\n     * Multiply current vector object to another and returns new vector instance.\n     * @public\n     * @param {Vec3} vec - Multiply vector.\n     * @returns {Vec3} -\n     */\n    mul(vec) {\n        return new Vec3(this.x * vec.x, this.y * vec.y, this.z * vec.z);\n    }\n    /**\n     * Divide current vector's components to another. Results stores in the current vector object.\n     * @public\n     * @param {Vec3} vec - Div vector.\n     * @returns {Vec3} -\n     */\n    divA(vec) {\n        this.x /= vec.x;\n        this.y /= vec.y;\n        this.z /= vec.z;\n        return this;\n    }\n    /**\n     * Divide current vector's components to another and returns new vector instance.\n     * @public\n     * @param {Vec3} vec - Div vector.\n     * @returns {Vec3} -\n     */\n    div(vec) {\n        return new Vec3(this.x / vec.x, this.y / vec.y, this.z / vec.z);\n    }\n    /**\n     * Gets vectors dot production.\n     * @public\n     * @param {Vec3} a - Another vector.\n     * @returns {number} -\n     */\n    dot(a) {\n        return a.x * this.x + a.y * this.y + a.z * this.z;\n    }\n    /**\n     * Gets vectors dot production.\n     * @public\n     * @param {Array.<number>} arr - Array vector. (exactly 3 entries)\n     * @returns {number} -\n     */\n    dotArr(arr) {\n        return arr[0] * this.x + arr[1] * this.y + arr[2] * this.z;\n    }\n    /**\n     * Gets vectors cross production.\n     * @public\n     * @param {Vec3} point3 - Another vector.\n     * @returns {Vec3} -\n     */\n    cross(point3) {\n        return new Vec3(this.y * point3.z - this.z * point3.y, this.z * point3.x - this.x * point3.z, this.x * point3.y - this.y * point3.x);\n    }\n    /**\n     * Sets vector to zero.\n     * @public\n     * @returns {Vec3} -\n     */\n    clear() {\n        this.x = this.y = this.z = 0;\n        return this;\n    }\n    /**\n     * Returns normalized vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    getNormal() {\n        let res = new Vec3();\n        res.copy(this);\n        let length = 1.0 / res.length();\n        res.x *= length;\n        res.y *= length;\n        res.z *= length;\n        return res;\n    }\n    /**\n     * Returns normalized vector.\n     * @deprecated\n     * @public\n     * @returns {Vec3} -\n     */\n    normal() {\n        let res = new Vec3();\n        res.copy(this);\n        let length = 1.0 / res.length();\n        res.x *= length;\n        res.y *= length;\n        res.z *= length;\n        return res;\n    }\n    /**\n     * Returns normalized negate vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    normalNegate() {\n        let res = new Vec3();\n        res.copy(this);\n        let length = -1.0 / res.length();\n        res.x *= length;\n        res.y *= length;\n        res.z *= length;\n        return res;\n    }\n    /**\n     * Returns normalized negate scale vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    normalNegateScale(scale) {\n        let res = new Vec3();\n        res.copy(this);\n        let length = -scale / res.length();\n        res.x *= length;\n        res.y *= length;\n        res.z *= length;\n        return res;\n    }\n    /**\n     * Returns normalized scale vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    normalScale(scale) {\n        let res = new Vec3();\n        res.copy(this);\n        let length = scale / res.length();\n        res.x *= length;\n        res.y *= length;\n        res.z *= length;\n        return res;\n    }\n    /**\n     * Normalize current vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    normalize() {\n        let length = 1.0 / this.length();\n        this.x *= length;\n        this.y *= length;\n        this.z *= length;\n        return this;\n    }\n    /**\n     * Converts vector to a number array.\n     * @public\n     * @returns {Array.<number>} - (exactly 3 entries)\n     * @deprecated\n     */\n    toVec() {\n        return [this.x, this.y, this.z];\n    }\n    /**\n     * Converts vector to a number array.\n     * @public\n     * @returns {Array.<number>} - (exactly 3 entries)\n     */\n    toArray() {\n        return [this.x, this.y, this.z];\n    }\n    /**\n     * Gets distance to point.\n     * @public\n     * @param {Vec3} p - Distant point.\n     * @returns {number} -\n     */\n    distance(p) {\n        let dx = this.x - p.x, dy = this.y - p.y, dz = this.z - p.z;\n        return Math.sqrt(dx * dx + dy * dy + dz * dz);\n    }\n    /**\n     * Gets square distance to point.\n     * @public\n     * @param {Vec3} p - Distant point.\n     * @returns {number} -\n     */\n    distance2(p) {\n        let dx = this.x - p.x, dy = this.y - p.y, dz = this.z - p.z;\n        return dx * dx + dy * dy + dz * dz;\n    }\n    /**\n     * Sets vector's values.\n     * @public\n     * @param {number} x - Value X.\n     * @param {number} y - Value Y.\n     * @param {number} z - Value Z.\n     * @returns {Vec3} -\n     */\n    set(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n        return this;\n    }\n    /**\n     * Negate current vector.\n     * @public\n     * @returns {Vec3} -\n     */\n    negate() {\n        this.x = -this.x;\n        this.y = -this.y;\n        this.z = -this.z;\n        return this;\n    }\n    /**\n     * Negate current vector to another instance.\n     * @public\n     * @returns {Vec3} -\n     */\n    negateTo() {\n        return new Vec3(-this.x, -this.y, -this.z);\n    }\n    /**\n     * Gets projected point coordinates of the current vector on the ray.\n     * @public\n     * @param {Vec3} pos - Ray position.\n     * @param {Vec3} direction - Ray direction.\n     * @returns {Vec3} -\n     */\n    projToRay(pos, direction) {\n        let v = Vec3.proj_b_to_a(Vec3.sub(this, pos), direction);\n        v.addA(pos);\n        return v;\n    }\n    /**\n     * Gets angle between two vectors.\n     * @public\n     * @param {Vec3} a - Another vector.\n     * @returns {number} -\n     */\n    angle(a) {\n        return Vec3.angle(this, a);\n    }\n    /**\n     * Returns two vectors linear interpolation.\n     * @public\n     * @param {Vec3} v2 - End vector.\n     * @param {number} l - Interpolate value.\n     * @returns {Vec3} -\n     */\n    lerp(v2, l) {\n        return new Vec3(this.x + (v2.x - this.x) * l, this.y + (v2.y - this.y) * l, this.z + (v2.z - this.z) * l);\n    }\n    /**\n     * Returns vector interpolation by v(t) = v1 * t + v2 * (1 - t)\n     * @public\n     * @param {Vec3} v2 - End vector.\n     * @param {number} t - Interpolate value.\n     * @returns {Vec3} -\n     */\n    smerp(v2, t) {\n        let one_d = 1 - t;\n        return new Vec3(this.x * t + v2.x * one_d, this.y * t + v2.y * one_d, this.z * t + v2.z * one_d);\n    }\n    static get LERP_DELTA() {\n        return 1e-6;\n    }\n    /**\n     * Spherically interpolates between two vectors.\n     * Interpolates between current and v2 vector by amount t. The difference between this and linear interpolation (aka, \"lerp\") is that\n     * the vectors are treated as directions rather than points in space. The direction of the returned vector is interpolated\n     * by the angle and its magnitude is interpolated between the magnitudes of from and to.\n     * @public\n     * @param {Vec3} v2 -\n     * @param {number} t - The parameter t is clamped to the range [0, 1].\n     * @returns {Vec3} -\n     */\n    slerp(v2, t) {\n        let res = new Vec3();\n        if (t <= 0.0) {\n            res.copy(this);\n            return res;\n        }\n        else if (t >= 1.0) {\n            res.copy(v2);\n            return res;\n        }\n        let omega, sinom, scale0, scale1;\n        let cosom = this.dot(v2);\n        if (1.0 - cosom > Vec3.LERP_DELTA) {\n            omega = Math.acos(cosom);\n            sinom = Math.sin(omega);\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\n            scale1 = Math.sin(t * omega) / sinom;\n        }\n        else {\n            scale0 = 1.0 - t;\n            scale1 = t;\n        }\n        return Vec3.add(this.scaleTo(scale0), v2.scale(scale1));\n    }\n    /**\n     * Gets the shortest arc quaternion to rotate this vector to the destination vector.\n     * @param {Vec3} dest -\n     * @param {Vec3} fallbackAxis -\n     * @returns {Quat} -\n     * @todo: TEST IT!\n     */\n    getRotationTo(dest, fallbackAxis) {\n        // Based on Stan Melax's article in Game Programming Gems\n        // Copy, since cannot modify local\n        let v0 = this.clone();\n        let v1 = dest.clone();\n        v0.normalize();\n        v1.normalize();\n        let d = v0.dot(v1);\n        // If dot == 1, vectors are the same\n        if (d >= 1.0) {\n            return Quat.IDENTITY.clone();\n        }\n        if (d < 1e-6 - 1.0) {\n            if (!fallbackAxis.equal(Vec3.ZERO)) {\n                // rotate 180 degrees about the fallback axis\n                return Quat.axisAngleToQuat(fallbackAxis, Math.PI);\n            }\n            else {\n                // Generate an axis\n                let axis = Vec3.UNIT_X.cross(v0);\n                if (axis.isZero()) {\n                    // pick another if colinear\n                    axis = Vec3.UNIT_Y.cross(v0);\n                }\n                axis.normalize();\n                return Quat.axisAngleToQuat(axis, Math.PI);\n            }\n        }\n        else {\n            let s = Math.sqrt((1 + d) * 2);\n            let invs = 1.0 / s;\n            let c = v0.cross(v1);\n            let q = new Quat(c.x * invs, c.y * invs, c.z * invs, s * 0.5);\n            q.normalize();\n            return q;\n        }\n    }\n}\n/**\n * Vector 3d object creator.\n * @function\n * @param {number} [x] - value X.\n * @param {number} [y] - value Y.\n * @param {number} [z] - value Z.\n * @returns {Vec3} -\n */\nexport function vec3(x = 0, y = 0, z = 0) {\n    return new Vec3(x, y, z);\n}\n//# sourceMappingURL=Vec3.js.map","import { Vec3 } from \"./Vec3\";\n/**\n * Class represents a 3d vector.\n * @class\n * @param {number} [x] - First value.\n * @param {number} [y] - Second value.\n */\nexport class Vec2 {\n    constructor(x = 0.0, y = 0.0) {\n        this.x = x;\n        this.y = y;\n    }\n    /** @const */\n    static get UP() {\n        return new Vec2(0, 1);\n    }\n    /** @const */\n    static get DOWN() {\n        return new Vec2(0, -1);\n    }\n    /** @const */\n    static get RIGHT() {\n        return new Vec2(1, 0);\n    }\n    /** @const */\n    static get LEFT() {\n        return new Vec2(-1, 0);\n    }\n    /** @const */\n    static get ZERO() {\n        return new Vec2();\n    }\n    /**\n     * Returns summary vector.\n     * @static\n     * @param {Vec2} a - First vector.\n     * @param {Vec2} b - Second vector.\n     * @returns {Vec2} - Summary vector.\n     */\n    static add(a, b) {\n        const res = new Vec2(a.x, a.y);\n        res.addA(b);\n        return res;\n    }\n    /**\n     * Returns two vectors subtraction.\n     * @static\n     * @param {Vec2} a - First vector.\n     * @param {Vec2} b - Second vector.\n     * @returns {Vec2} - Vectors subtraction.\n     */\n    static sub(a, b) {\n        var res = new Vec2(a.x, a.y);\n        res.subA(b);\n        return res;\n    }\n    /**\n     * Returns scaled vector.\n     * @static\n     * @param {Vec2} a - Input vector.\n     * @param {number} scale - Scale value.\n     * @returns {Vec2}\n     */\n    static scale(a, scale) {\n        let res = new Vec2(a.x, a.y);\n        res.scale(scale);\n        return res;\n    }\n    /**\n     * Returns two vectors production.\n     * @static\n     * @param {Vec2} a - First vector.\n     * @param {Vec2} b - Second vector.\n     * @returns {Vec2}\n     */\n    static mul(a, b) {\n        let res = new Vec2(a.x, a.y);\n        res.mulA(b);\n        return res;\n    }\n    /**\n     * Returns vector components division product one to another.\n     * @static\n     * @param {Vec2} a - First vector.\n     * @param {Vec2} b - Second vector.\n     * @returns {Vec2}\n     */\n    static div(a, b) {\n        let res = new Vec2(a.x, a.y);\n        res.divA(b);\n        return res;\n    }\n    /**\n     * Get projection of the first vector to the second.\n     * @static\n     * @param {Vec2} b - First vector.\n     * @param {Vec2} a - Second vector.\n     * @returns {Vec2}\n     */\n    static proj_b_to_a(b, a) {\n        return a.scaleTo(a.dot(b) / a.dot(a));\n    }\n    /**\n     * Gets angle between two vectors.\n     * @static\n     * @param {Vec2} a - First vector.\n     * @param {Vec2} b - Second vector.\n     * @returns {number}\n     */\n    static angle(a, b) {\n        return Math.acos(a.dot(b) / Math.sqrt(a.length2() * b.length2()));\n    }\n    /**\n     * Makes vectors normalized and orthogonal to each other.\n     * @static\n     * @param {Vec2} normal - Normal vector.\n     * @param {Vec2} tangent - Tangent vector.\n     * @returns {Vec2}\n     */\n    static orthoNormalize(normal, tangent) {\n        normal = normal.normal();\n        normal.scale(tangent.dot(normal));\n        return tangent.sub(normal).normalize();\n    }\n    /**\n     * Converts to 3d vector, third value is 0.0.\n     * @public\n     * @returns {Vec3}\n     */\n    toVector3() {\n        return new Vec3(this.x, this.y, 0);\n    }\n    /**\n     * Returns clone vector.\n     * @public\n     * @returns {Vec2}\n     */\n    clone() {\n        return new Vec2(this.x, this.y);\n    }\n    /**\n     * Compares with vector. Returns true if it equals another.\n     * @public\n     * @param {Vec2} p - Vector to compare.\n     * @returns {boolean}\n     */\n    equal(p) {\n        return this.x === p.x && this.y === p.y;\n    }\n    /**\n     * Copy input vector's values.\n     * @param {Vec2} point2 - Vector to copy.\n     * @returns {Vec2}\n     */\n    copy(point2) {\n        this.x = point2.x;\n        this.y = point2.y;\n        return this;\n    }\n    /**\n     * Gets vector's length.\n     * @public\n     * @returns {number}\n     */\n    length() {\n        return Math.sqrt(this.x * this.x + this.y * this.y);\n    }\n    /**\n     * Returns squared vector's length.\n     * @public\n     * @returns {number}\n     */\n    length2() {\n        return this.x * this.x + this.y * this.y;\n    }\n    /**\n     * Adds vector to the current.\n     * @public\n     * @param {Vec2}\n     * @returns {Vec2}\n     */\n    addA(v) {\n        this.x += v.x;\n        this.y += v.y;\n        return this;\n    }\n    /**\n     * Summarize two vectors.\n     * @public\n     * @param {Vec2}\n     * @returns {Vec2}\n     */\n    add(v) {\n        return new Vec2(this.x + v.x, this.y + v.y);\n    }\n    /**\n     * Subtract vector from the current where results saved on the current instance.\n     * @public\n     * @param {Vec2} v - Subtract vector.\n     * @returns {Vec2}\n     */\n    subA(v) {\n        this.x -= v.x;\n        this.y -= v.y;\n        return this;\n    }\n    /**\n     * Subtract vector from the current.\n     * @public\n     * @param {Vec2} v - Subtract vector.\n     * @returns {Vec2}\n     */\n    sub(v) {\n        return new Vec2(this.x - v.x, this.y - v.y);\n    }\n    /**\n     * Scale current vector.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec2}\n     */\n    scale(scale) {\n        this.x *= scale;\n        this.y *= scale;\n        return this;\n    }\n    /**\n     * Scale current vector to another instance.\n     * @public\n     * @param {number} scale - Scale value.\n     * @returns {Vec2}\n     */\n    scaleTo(scale) {\n        return new Vec2(this.x * scale, this.y * scale);\n    }\n    /**\n     * Multiply current vector object to another and store result in the current instance.\n     * @public\n     * @param {Vec2} vec - Multiply vector.\n     * @returns {Vec2}\n     */\n    mulA(vec) {\n        this.x *= vec.x;\n        this.y *= vec.y;\n        return this;\n    }\n    /**\n     * Multiply current vector object to another and returns new vector instance.\n     * @public\n     * @param {Vec2} vec - Multiply vector.\n     * @returns {Vec2}\n     */\n    mul(vec) {\n        return new Vec2(this.x * vec.x, this.y * vec.y);\n    }\n    /**\n     * Divide current vector's components to another. Results stores in the current vector object.\n     * @public\n     * @param {Vec2}\n     * @returns {Vec2}\n     */\n    divA(vec) {\n        this.x /= vec.x;\n        this.y /= vec.y;\n        return this;\n    }\n    /**\n     * Gets vectors dot production.\n     * @public\n     * @param {Vec2} v - Another vector.\n     * @returns {number}\n     */\n    dot(v) {\n        return v.x * this.x + v.y * this.y;\n    }\n    /**\n     * Gets vectors dot production.\n     * @public\n     * @param {Array.<number>} arr - Array vector. (exactly 2 entries)\n     * @returns {number}\n     */\n    dotArr(arr) {\n        return arr[0] * this.x + arr[1] * this.y;\n    }\n    /**\n     * Gets vectors cross production.\n     * @public\n     * @param {Vec2} v - Another vector.\n     * @returns {number}\n     */\n    cross(v) {\n        return this.x * v.y - this.y * v.x;\n    }\n    /**\n     * Sets vector to zero.\n     * @public\n     * @returns {Vec2}\n     */\n    clear() {\n        this.x = this.y = 0;\n        return this;\n    }\n    /**\n     * Returns normalized vector.\n     * @public\n     * @returns {Vec2}\n     */\n    normal() {\n        let res = new Vec2();\n        res.copy(this);\n        let length = 1.0 / res.length();\n        res.x *= length;\n        res.y *= length;\n        return res;\n    }\n    /**\n     * Normalize current vector.\n     * @public\n     * @returns {Vec2}\n     */\n    normalize() {\n        let length = 1.0 / this.length();\n        this.x *= length;\n        this.y *= length;\n        return this;\n    }\n    /**\n     * Converts vector to a number array.\n     * @public\n     * @returns {Array.<number>} - (exactly 2 entries)\n     */\n    toVec() {\n        return [this.x, this.y];\n    }\n    /**\n     * Gets distance to point.\n     * @public\n     * @param {Vec2} p - Distant point.\n     * @returns {number}\n     */\n    distance(p) {\n        let vec = Vec2.sub(this, p);\n        return vec.length();\n    }\n    /**\n     * Sets vector's values.\n     * @public\n     * @param {number} x - Value X.\n     * @param {number} y - Value Y.\n     * @returns {Vec2}\n     */\n    set(x, y) {\n        this.x = x;\n        this.y = y;\n        return this;\n    }\n    /**\n     * Negate current vector.\n     * @public\n     * @returns {Vec2}\n     */\n    negate() {\n        this.x = -this.x;\n        this.y = -this.y;\n        return this;\n    }\n    /**\n     * Negate current vector to another instance.\n     * @public\n     * @returns {Vec2}\n     */\n    negateTo() {\n        return new Vec2(-this.x, -this.y);\n    }\n    /**\n     * Gets projected point coordinates of the current vector on the ray.\n     * @public\n     * @param {Vec2} pos - Ray position.\n     * @param {Vec2} direction - Ray direction.\n     * @returns {Vec2}\n     */\n    projToRay(pos, direction) {\n        let v = Vec2.proj_b_to_a(Vec2.sub(this, pos), direction);\n        v.add(pos);\n        return v;\n    }\n    /**\n     * Gets angle between two vectors.\n     * @public\n     * @param {Vec2} a - Another vector.\n     * @returns {number}\n     */\n    angle(a) {\n        return Vec2.angle(this, a);\n    }\n    /**\n     * Returns two vectors linear interpolation.\n     * @public\n     * @param {Vec2} v2 - End vector.\n     * @param {number} l - Interpolate value.\n     * @returns {Vec2}\n     */\n    lerp(v1, v2, l) {\n        let res = this.clone();\n        if (l <= 0.0) {\n            res.copy(v1);\n        }\n        else if (l >= 1.0) {\n            res.copy(v2);\n        }\n        else {\n            res = Vec2.add(v1, Vec2.sub(v2, v1).scale(l));\n        }\n        return res;\n    }\n    static get LERP_DELTA() {\n        return 1e-6;\n    }\n    /**\n     * Spherically interpolates between two vectors.\n     * Interpolates between current and v2 vector by amount t. The difference between this and linear interpolation (aka, \"lerp\") is that\n     * the vectors are treated as directions rather than points in space. The direction of the returned vector is interpolated\n     * by the angle and its magnitude is interpolated between the magnitudes of from and to.\n     * @public\n     * @param {Vec2} v2\n     * @param {number} t - The parameter t is clamped to the range [0, 1].\n     * @returns {Vec2}\n     */\n    slerp(v2, t) {\n        let res = new Vec2();\n        if (t <= 0.0) {\n            res.copy(this);\n            return res;\n        }\n        else if (t >= 1.0) {\n            res.copy(v2);\n            return res;\n        }\n        let omega, sinom, scale0, scale1;\n        let cosom = this.dot(v2);\n        if (1.0 - cosom > Vec2.LERP_DELTA) {\n            omega = Math.acos(cosom);\n            sinom = Math.sin(omega);\n            scale0 = Math.sin((1.0 - t) * omega) / sinom;\n            scale1 = Math.sin(t * omega) / sinom;\n        }\n        else {\n            scale0 = 1.0 - t;\n            scale1 = t;\n        }\n        return Vec2.add(this.scale(scale0), v2.scale(scale1));\n    }\n}\n/**\n * Vector 2d object creator.\n * @function\n * @param {number} [x] - First cvalue.\n * @param {number} [y] - Second value.\n * @returns {Vec2}\n */\nexport function vec2(x = 0, y = 0) {\n    return new Vec2(x, y);\n}\n//# sourceMappingURL=Vec2.js.map","export const colorTable = {\n    \"aliceblue\": \"#f0f8ff\",\n    \"antiquewhite\": \"#faebd7\",\n    \"aqua\": \"#00ffff\",\n    \"aquamarine\": \"#7fffd4\",\n    \"azure\": \"#f0ffff\",\n    \"beige\": \"#f5f5dc\",\n    \"bisque\": \"#ffe4c4\",\n    \"black\": \"#000000\",\n    \"blanchedalmond\": \"#ffebcd\",\n    \"blue\": \"#0000ff\",\n    \"blueviolet\": \"#8a2be2\",\n    \"brown\": \"#a52a2a\",\n    \"burlywood\": \"#deb887\",\n    \"cadetblue\": \"#5f9ea0\",\n    \"chartreuse\": \"#7fff00\",\n    \"chocolate\": \"#d2691e\",\n    \"coral\": \"#ff7f50\",\n    \"cornflowerblue\": \"#6495ed\",\n    \"cornsilk\": \"#fff8dc\",\n    \"crimson\": \"#dc143c\",\n    \"cyan\": \"#00ffff\",\n    \"darkblue\": \"#00008b\",\n    \"darkcyan\": \"#008b8b\",\n    \"darkgoldenrod\": \"#b8860b\",\n    \"darkgray\": \"#a9a9a9\",\n    \"darkgreen\": \"#006400\",\n    \"darkkhaki\": \"#bdb76b\",\n    \"darkmagenta\": \"#8b008b\",\n    \"darkolivegreen\": \"#556b2f\",\n    \"darkorange\": \"#ff8c00\",\n    \"darkorchid\": \"#9932cc\",\n    \"darkred\": \"#8b0000\",\n    \"darksalmon\": \"#e9967a\",\n    \"darkseagreen\": \"#8fbc8f\",\n    \"darkslateblue\": \"#483d8b\",\n    \"darkslategray\": \"#2f4f4f\",\n    \"darkturquoise\": \"#00ced1\",\n    \"darkviolet\": \"#9400d3\",\n    \"deeppink\": \"#ff1493\",\n    \"deepskyblue\": \"#00bfff\",\n    \"dimgray\": \"#696969\",\n    \"dodgerblue\": \"#1e90ff\",\n    \"firebrick\": \"#b22222\",\n    \"floralwhite\": \"#fffaf0\",\n    \"forestgreen\": \"#228b22\",\n    \"fuchsia\": \"#ff00ff\",\n    \"gainsboro\": \"#dcdcdc\",\n    \"ghostwhite\": \"#f8f8ff\",\n    \"gold\": \"#ffd700\",\n    \"goldenrod\": \"#daa520\",\n    \"gray\": \"#808080\",\n    \"green\": \"#008000\",\n    \"greenyellow\": \"#adff2f\",\n    \"honeydew\": \"#f0fff0\",\n    \"hotpink\": \"#ff69b4\",\n    \"indianred \": \"#cd5c5c\",\n    \"indigo\": \"#4b0082\",\n    \"ivory\": \"#fffff0\",\n    \"khaki\": \"#f0e68c\",\n    \"lavender\": \"#e6e6fa\",\n    \"lavenderblush\": \"#fff0f5\",\n    \"lawngreen\": \"#7cfc00\",\n    \"lemonchiffon\": \"#fffacd\",\n    \"lightblue\": \"#add8e6\",\n    \"lightcoral\": \"#f08080\",\n    \"lightcyan\": \"#e0ffff\",\n    \"lightgoldenrodyellow\": \"#fafad2\",\n    \"lightgrey\": \"#d3d3d3\",\n    \"lightgreen\": \"#90ee90\",\n    \"lightpink\": \"#ffb6c1\",\n    \"lightsalmon\": \"#ffa07a\",\n    \"lightseagreen\": \"#20b2aa\",\n    \"lightskyblue\": \"#87cefa\",\n    \"lightslategray\": \"#778899\",\n    \"lightsteelblue\": \"#b0c4de\",\n    \"lightyellow\": \"#ffffe0\",\n    \"lime\": \"#00ff00\",\n    \"limegreen\": \"#32cd32\",\n    \"linen\": \"#faf0e6\",\n    \"magenta\": \"#ff00ff\",\n    \"maroon\": \"#800000\",\n    \"mediumaquamarine\": \"#66cdaa\",\n    \"mediumblue\": \"#0000cd\",\n    \"mediumorchid\": \"#ba55d3\",\n    \"mediumpurple\": \"#9370d8\",\n    \"mediumseagreen\": \"#3cb371\",\n    \"mediumslateblue\": \"#7b68ee\",\n    \"mediumspringgreen\": \"#00fa9a\",\n    \"mediumturquoise\": \"#48d1cc\",\n    \"mediumvioletred\": \"#c71585\",\n    \"midnightblue\": \"#191970\",\n    \"mintcream\": \"#f5fffa\",\n    \"mistyrose\": \"#ffe4e1\",\n    \"moccasin\": \"#ffe4b5\",\n    \"navajowhite\": \"#ffdead\",\n    \"navy\": \"#000080\",\n    \"oldlace\": \"#fdf5e6\",\n    \"olive\": \"#808000\",\n    \"olivedrab\": \"#6b8e23\",\n    \"orange\": \"#ffa500\",\n    \"orangered\": \"#ff4500\",\n    \"orchid\": \"#da70d6\",\n    \"palegoldenrod\": \"#eee8aa\",\n    \"palegreen\": \"#98fb98\",\n    \"paleturquoise\": \"#afeeee\",\n    \"palevioletred\": \"#d87093\",\n    \"papayawhip\": \"#ffefd5\",\n    \"peachpuff\": \"#ffdab9\",\n    \"peru\": \"#cd853f\",\n    \"pink\": \"#ffc0cb\",\n    \"plum\": \"#dda0dd\",\n    \"powderblue\": \"#b0e0e6\",\n    \"purple\": \"#800080\",\n    \"rebeccapurple\": \"#663399\",\n    \"red\": \"#ff0000\",\n    \"rosybrown\": \"#bc8f8f\",\n    \"royalblue\": \"#4169e1\",\n    \"saddlebrown\": \"#8b4513\",\n    \"salmon\": \"#fa8072\",\n    \"sandybrown\": \"#f4a460\",\n    \"seagreen\": \"#2e8b57\",\n    \"seashell\": \"#fff5ee\",\n    \"sienna\": \"#a0522d\",\n    \"silver\": \"#c0c0c0\",\n    \"skyblue\": \"#87ceeb\",\n    \"slateblue\": \"#6a5acd\",\n    \"slategray\": \"#708090\",\n    \"snow\": \"#fffafa\",\n    \"springgreen\": \"#00ff7f\",\n    \"steelblue\": \"#4682b4\",\n    \"tan\": \"#d2b48c\",\n    \"teal\": \"#008080\",\n    \"thistle\": \"#d8bfd8\",\n    \"tomato\": \"#ff6347\",\n    \"turquoise\": \"#40e0d0\",\n    \"violet\": \"#ee82ee\",\n    \"wheat\": \"#f5deb3\",\n    \"white\": \"#ffffff\",\n    \"whitesmoke\": \"#f5f5f5\",\n    \"yellow\": \"#ffff00\",\n    \"yellowgreen\": \"#9acd32\"\n};\n//# sourceMappingURL=colorTable.js.map","/**\n * @module og/utils/shared\n */\nimport { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { Vec4 } from \"../math/Vec4\";\nimport { colorTable } from \"./colorTable\";\nexport function getDefault(param, def) {\n    return param != undefined ? param : def;\n}\nexport function isEmpty(v) {\n    return v == null;\n}\n/**\n * Returns true if the object pointer is undefined.\n * @function\n * @param {Object} obj - Object pointer.\n * @returns {boolean} Returns true if object is undefined.\n */\nexport function isUndef(obj) {\n    return obj === void 0;\n}\nexport function isUndefExt(obj, defVal) {\n    return isUndef(obj) ? defVal : obj;\n}\nlet _stampCounter = 0;\nexport function stamp(obj) {\n    let stamp = obj._openglobus_id;\n    if (!stamp) {\n        stamp = obj._openglobus_id = ++_stampCounter;\n    }\n    return stamp;\n}\nexport function isString(s) {\n    return typeof s === \"string\" || s instanceof String;\n}\n/**\n * Convert html color string to the RGBA number vector.\n * @param {string} htmlColor - HTML string(\"#C6C6C6\" or \"#EF5\" or \"rgb(8,8,8)\" or \"rgba(8,8,8)\") color.\n * @param {number} [opacity] - Opacity for the output vector.\n * @returns {Vec4} -\n */\nexport function htmlColorToRgba(htmlColor, opacity) {\n    let hColor = colorTable[htmlColor];\n    if (hColor) {\n        htmlColor = hColor;\n    }\n    if (htmlColor[0] === \"#\") {\n        let shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        let hex = htmlColor.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        if (result) {\n            return new Vec4(parseInt(result[1], 16) / 255, parseInt(result[2], 16) / 255, parseInt(result[3], 16) / 255, isEmpty(opacity) ? 1.0 : opacity);\n        }\n        else {\n            return new Vec4();\n        }\n    }\n    else {\n        if (isEmpty(opacity)) {\n            opacity = 1.0;\n        }\n        let m = htmlColor.split(\",\");\n        return new Vec4(parseInt(m[0].split(\"(\")[1]) / 255, parseInt(m[1]) / 255, parseInt(m[2]) / 255, !isEmpty(m[3]) ? parseFloat(m[3]) : opacity);\n    }\n}\nexport function htmlColorToFloat32Array(htmlColor, opacity) {\n    let c = htmlColorToRgba(htmlColor, opacity);\n    return new Float32Array([c.x, c.y, c.z, c.w]);\n}\n/**\n * Convert html color string to the RGB number vector.\n * @param {string} htmlColor - HTML string(\"#C6C6C6\" or \"#EF5\" or \"rgb(8,8,8)\" or \"rgba(8,8,8)\") color.\n * @returns {Vec3} -\n */\nexport function htmlColorToRgb(htmlColor) {\n    let hColor = colorTable[htmlColor];\n    if (hColor) {\n        htmlColor = hColor;\n    }\n    if (htmlColor[0] === \"#\") {\n        let shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n        let hex = htmlColor.replace(shorthandRegex, function (m, r, g, b) {\n            return r + r + g + g + b + b;\n        });\n        let result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n        if (result) {\n            return new Vec3(parseInt(result[1], 16) / 255, parseInt(result[2], 16) / 255, parseInt(result[3], 16) / 255);\n        }\n        else {\n            return new Vec3();\n        }\n    }\n    else {\n        let m = htmlColor.split(\",\");\n        return new Vec3(parseInt(m[0].split(\"(\")[1]) / 255, parseInt(m[1]) / 255, parseInt(m[2]) / 255);\n    }\n}\n/**\n * Replace template substrings between '{' and '}' tokens.\n * @param {string} template - String with templates in \"{\" and \"}\"\n * @param {Object} params - Template named object with subsrtings.\n * @returns {string} -\n *\n * @example <caption>Example from og.terrain that replaces tile indexes in url:</caption>\n * var substrings = {\n *       \"x\": 12,\n *       \"y\": 15,\n *       \"z\": 8\n * }\n * og.utils.stringTemplate(\"http://earth3.openglobus.org/{z}/{y}/{x}.ddm\", substrings);\n * //returns http://earth3.openglobus.org/8/15/12.ddm\n */\nexport function stringTemplate(template, params) {\n    return template.replace(/{[^{}]+}/g, function (key) {\n        return params[key.replace(/[{}]+/g, \"\")] || \"\";\n    });\n}\nexport function getHTML(template, params) {\n    return stringTemplate(template, params);\n}\nexport function parseHTML(htmlStr) {\n    let p = document.createElement(\"div\");\n    p.innerHTML = htmlStr;\n    let domArr = [];\n    for (let i = 0; i < p.childNodes.length; i++) {\n        domArr.push(p.childNodes[i]);\n        p.removeChild(p.childNodes[i]);\n    }\n    return domArr;\n}\nexport function print2d(id, text, x, y) {\n    let el = document.getElementById(id);\n    if (!el) {\n        el = document.createElement(\"div\");\n        el.id = id;\n        el.classList.add(\"defaultText\");\n        document.body.appendChild(el);\n    }\n    el.innerHTML = text;\n    el.style.left = `${x}px`;\n    el.style.top = `${y}px`;\n}\nexport function defaultString(str, def = \"\") {\n    return str ? str.trim() : def;\n}\nexport function createVector3(v, def) {\n    if (v) {\n        if (v instanceof Vec3) {\n            return v.clone();\n        }\n        else if (v instanceof Array) {\n            return Vec3.fromVec(v);\n        }\n        else if (v instanceof Vec2) {\n            return new Vec3(v.x, v.y, 0.0);\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new Vec3();\n}\nexport function createVector4(v, def) {\n    if (v) {\n        if (v instanceof Vec4) {\n            return v.clone();\n        }\n        else if (v instanceof Array) {\n            return Vec4.fromVec(v);\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new Vec4();\n}\nexport function createColorRGBA(c, def) {\n    if (c) {\n        if (isString(c)) {\n            return htmlColorToRgba(c);\n        }\n        else if (c instanceof Array) {\n            return Vec4.fromVec(c);\n        }\n        else if (c instanceof Vec4) {\n            return c.clone();\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new Vec4(1.0, 1.0, 1.0, 1.0);\n}\nexport function createColorRGB(c, def) {\n    if (c) {\n        if (isString(c)) {\n            return htmlColorToRgb(c);\n        }\n        else if (c instanceof Array) {\n            return Vec3.fromVec(c);\n        }\n        else if (c instanceof Vec3) {\n            return c.clone();\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new Vec3(1.0, 1.0, 1.0);\n}\nexport function createExtent(e, def) {\n    if (e) {\n        if (e instanceof Array) {\n            return new Extent(createLonLat(e[0]), createLonLat(e[1]));\n        }\n        else if (e instanceof Extent) {\n            return e.clone();\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new Extent();\n}\nexport function createLonLat(l, def) {\n    if (l) {\n        if (l instanceof Array) {\n            return new LonLat(l[0], l[1], l[2]);\n        }\n        else if (l instanceof LonLat) {\n            return l.clone();\n        }\n    }\n    else if (def) {\n        return def;\n    }\n    return new LonLat();\n}\nexport function binarySearchFast(arr, x) {\n    let start = 0, end = arr.length - 1;\n    while (start <= end) {\n        let k = Math.floor((start + end) * 0.5);\n        if (Math.abs(arr[k] - x) < 1e-3) {\n            return k;\n        }\n        else if (arr[k] < x) {\n            start = k + 1;\n        }\n        else {\n            end = k - 1;\n        }\n    }\n    return -1;\n}\n/**\n * Finds an item in a sorted array.\n * @param {any[]} ar The sorted array to search.\n * @param {any} el The item to find in the array.\n * @param {Function} compare_fn comparator The function to use to compare the item to\n *        elements in the array.\n * @returns {number} a negative number  if 'a' is less than 'b'; 0 if 'a' is equal to 'b'; 'a' positive number of 'a' is greater than 'b'.\n *\n * @example\n * // Create a comparator function to search through an array of numbers.\n * function comparator(a, b) {\n *     return a - b;\n * };\n * var numbers = [0, 2, 4, 6, 8];\n * var index = og.utils.binarySearch(numbers, 6, comparator); // 3\n */\nexport function binarySearch(ar, el, compare_fn) {\n    let m = 0;\n    let n = ar.length - 1;\n    while (m <= n) {\n        let k = (n + m) >> 1;\n        let cmp = compare_fn(el, ar[k], k);\n        if (cmp > 0) {\n            m = k + 1;\n        }\n        else if (cmp < 0) {\n            n = k - 1;\n        }\n        else {\n            return k;\n        }\n    }\n    return -m - 1;\n}\n/**\n * @todo: replace any with generic\n * Binary insertion that uses binarySearch algorithm.\n * @param {any[]} ar - The sorted array to insert.\n * @param {any} el - The item to insert.\n * @param {Function} compare_fn - comparator The function to use to compare the item to\n *        elements in the array.\n * @returns {number} Array index position in which item inserted in.\n */\nexport function binaryInsert(ar, el, compare_fn) {\n    let i = binarySearch(ar, el, compare_fn);\n    if (i < 0) {\n        i = ~i;\n    }\n    ar.splice(i, 0, el);\n    return i;\n}\n/**\n * Returns two segment lines intersection coordinate.\n * @static\n * @param {Vec2} start1 - First line first coordinate.\n * @param {Vec2} end1 - First line second coordinate.\n * @param {Vec2} start2 - Second line first coordinate.\n * @param {Vec2} end2 - Second line second coordinate.\n * @param {boolean} [isSegment] - Lines are segments.\n * @return {Vec2} - Intersection coordinate.\n */\nexport function getLinesIntersection2v(start1, end1, start2, end2, isSegment) {\n    let dir1 = end1.sub(start1);\n    let dir2 = end2.sub(start2);\n    let a1 = -dir1.y;\n    let b1 = +dir1.x;\n    let d1 = -(a1 * start1.x + b1 * start1.y);\n    let a2 = -dir2.y;\n    let b2 = +dir2.x;\n    let d2 = -(a2 * start2.x + b2 * start2.y);\n    let seg1_line2_start = a2 * start1.x + b2 * start1.y + d2;\n    let seg1_line2_end = a2 * end1.x + b2 * end1.y + d2;\n    let seg2_line1_start = a1 * start2.x + b1 * start2.y + d1;\n    let seg2_line1_end = a1 * end2.x + b1 * end2.y + d1;\n    if (isSegment &&\n        (seg1_line2_start * seg1_line2_end > 0 || seg2_line1_start * seg2_line1_end > 0)) {\n        return undefined;\n    }\n    let u = seg1_line2_start / (seg1_line2_start - seg1_line2_end);\n    return new Vec2(start1.x + u * dir1.x, start1.y + u * dir1.y);\n}\n/**\n * Returns two segment lines intersection coordinate.\n * @static\n * @param {Vec2} start1 - First line first coordinate.\n * @param {Vec2} end1 - First line second coordinate.\n * @param {Vec2} start2 - Second line first coordinate.\n * @param {Vec2} end2 - Second line second coordinate.\n * @param {boolean} [isSegment=false] - Lines are segments.\n * @return {Vec2} - Intersection coordinate.\n */\nexport function getLinesIntersectionLonLat(start1, end1, start2, end2, isSegment = false) {\n    let dir1 = new LonLat(end1.lon - start1.lon, end1.lat - start1.lat);\n    let dir2 = new LonLat(end2.lon - start2.lon, end2.lat - start2.lat);\n    let a1 = -dir1.lat;\n    let b1 = +dir1.lon;\n    let d1 = -(a1 * start1.lon + b1 * start1.lat);\n    let a2 = -dir2.lat;\n    let b2 = +dir2.lon;\n    let d2 = -(a2 * start2.lon + b2 * start2.lat);\n    let seg1_line2_start = a2 * start1.lon + b2 * start1.lat + d2;\n    let seg1_line2_end = a2 * end1.lon + b2 * end1.lat + d2;\n    let seg2_line1_start = a1 * start2.lon + b1 * start2.lat + d1;\n    let seg2_line1_end = a1 * end2.lon + b1 * end2.lat + d1;\n    if (isSegment &&\n        (seg1_line2_start * seg1_line2_end > 0 || seg2_line1_start * seg2_line1_end > 0)) {\n        return undefined;\n    }\n    let u = seg1_line2_start / (seg1_line2_start - seg1_line2_end);\n    return new LonLat(start1.lon + u * dir1.lon, start1.lat + u * dir1.lat);\n}\n/**\n * Converts XML to JSON\n * @static\n * @param {Object} xml - Xml object\n * @return {Object} - Json converted object.\n */\nexport function xmlToJson(xml) {\n    // Create the return object\n    let obj = {};\n    if (xml.nodeType === 1) {\n        // element\n        // do attributes\n        if (xml.attributes.length > 0) {\n            obj[\"@attributes\"] = {};\n            for (let j = 0; j < xml.attributes.length; j++) {\n                let attribute = xml.attributes.item(j);\n                obj[\"@attributes\"][attribute.nodeName] = attribute.nodeValue;\n            }\n        }\n    }\n    else if (xml.nodeType === 3) {\n        // text\n        obj = xml.nodeValue;\n    }\n    // do children\n    if (xml.hasChildNodes()) {\n        for (let i = 0; i < xml.childNodes.length; i++) {\n            let item = xml.childNodes.item(i);\n            let nodeName = item.nodeName;\n            if (typeof obj[nodeName] === \"undefined\") {\n                obj[nodeName] = xmlToJson(item);\n            }\n            else {\n                if (typeof obj[nodeName].push === \"undefined\") {\n                    let old = obj[nodeName];\n                    obj[nodeName] = [];\n                    obj[nodeName].push(old);\n                }\n                obj[nodeName].push(xmlToJson(item));\n            }\n        }\n    }\n    return obj;\n}\nexport const castType = {\n    string: function (v) {\n        return isEmpty(v) ? v : v.toString();\n    },\n    date: function (v) {\n        return isEmpty(v) ? v : new Date(v * 1000);\n    },\n    datetime: function (v) {\n        return isEmpty(v) ? v : new Date(v * 1000);\n    },\n    time: function (v) {\n        return isEmpty(v) ? v : parseInt(v);\n    },\n    integer: function (v) {\n        return isEmpty(v) ? v : parseInt(v);\n    },\n    float: function (v) {\n        return isEmpty(v) ? v : parseFloat(v);\n    },\n    boolean: function (str) {\n        if (str === null) {\n            return str;\n        }\n        if (typeof str === \"boolean\") {\n            if (str === true) {\n                return true;\n            }\n            return false;\n        }\n        if (typeof str === \"string\") {\n            if (str === \"\") {\n                return false;\n            }\n            str = str.replace(/^\\s+|\\s+$/g, \"\");\n            if (str.toLowerCase() === \"true\" || str.toLowerCase() === \"yes\") {\n                return true;\n            }\n            str = str.replace(/,/g, \".\");\n            str = str.replace(/^\\s*\\-\\s*/g, \"-\");\n        }\n        if (!isNaN(str)) {\n            return parseFloat(str) !== 0;\n        }\n        return false;\n    }\n};\nexport function base64toBlob(base64Data, contentType = \"\") {\n    let sliceSize = 1024;\n    let byteCharacters = atob(base64Data);\n    let bytesLength = byteCharacters.length;\n    let slicesCount = Math.ceil(bytesLength / sliceSize);\n    let byteArrays = new Array(slicesCount);\n    for (let sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\n        let begin = sliceIndex * sliceSize;\n        let end = Math.min(begin + sliceSize, bytesLength);\n        let bytes = new Array(end - begin);\n        for (let offset = begin, i = 0; offset < end; ++i, ++offset) {\n            bytes[i] = byteCharacters[offset].charCodeAt(0);\n        }\n        byteArrays[sliceIndex] = new Uint8Array(bytes);\n    }\n    return new Blob(byteArrays, { type: contentType });\n}\nexport function base64StringToBlog(string) {\n    let block = string.split(\";\");\n    let contentType = block[0].split(\":\")[1];\n    let data = block[1].split(\",\")[1];\n    return base64toBlob(data, contentType);\n}\n///**\n// *\n// * @param {LonLat} p\n// * @param {LonLat} v1\n// * @param {LonLat} v2\n// * @param {LonLat} v3\n// * @param {Array<Number>} res\n// */\n//export function cartesianToBarycentricLonLat(p, v1, v2, v3, res) {\n//    const y2y3 = v2.lat - v3.lat,\n//        x3x2 = v3.lon - v2.lon,\n//        x1x3 = v1.lon - v3.lon,\n//        y1y3 = v1.lat - v3.lat,\n//        y3y1 = v3.lat - v1.lat,\n//        xx3 = p.lon - v3.lon,\n//        yy3 = p.lat - v3.lat;\n//    const d = y2y3 * x1x3 + x3x2 * y1y3,\n//        lambda1 = (y2y3 * xx3 + x3x2 * yy3) / d,\n//        lambda2 = (y3y1 * xx3 + x1x3 * yy3) / d;\n//    res[0] = lambda1;\n//    res[1] = lambda2;\n//    res[2] = 1 - lambda1 - lambda2;\n//    return 0 <= res[0] && res[0] <= 1 && 0 <= lambda1 && lambda1 <= 1 && 0 <= lambda2 && lambda2 <= 1;\n//};\n/**\n * Callback throttling\n * @param {any} func\n * @param {Number} limit\n * @param {boolean} [skip]\n */\nexport function throttle(func, limit, skip = false) {\n    let lastFunc;\n    let lastRan = 0;\n    return function () {\n        const args = arguments;\n        if (!lastRan) {\n            func.apply(null, args);\n            lastRan = Date.now();\n        }\n        else {\n            if (skip) {\n                clearTimeout(lastFunc);\n            }\n            lastFunc = setTimeout(() => {\n                if (Date.now() - lastRan >= limit) {\n                    func.apply(null, args);\n                    lastRan = Date.now();\n                }\n            }, limit - (Date.now() - lastRan));\n        }\n    };\n}\n/**\n *\n * y2-----Q12--------------Q22---\n * |       |     |          |\n * |       |     |          |\n * y-------|-----P----------|----\n * |       |     |          |\n * |       |     |          |\n * |       |     |          |\n * |       |     |          |\n * |       |     |          |\n * y1-----Q11----|---------Q21---\n *         |     |          |\n *         |     |          |\n *         x1    x          x2\n *\n *\n * @param {Number} x -\n * @param {Number} y -\n * @param {Number} fQ11 -\n * @param {Number} fQ21 -\n * @param {Number} fQ12 -\n * @param {Number} fQ22 -\n * @param {Number} [x1=0.0] -\n * @param {Number} [x2=1.0] -\n * @param {Number} [y1=0.0] -\n * @param {Number} [y2=1.0] -\n */\nexport function blerp(x, y, fQ11, fQ21, fQ12, fQ22, x1 = 0.0, x2 = 1.0, y1 = 0.0, y2 = 1.0) {\n    return ((fQ11 * (x2 - x) * (y2 - y) +\n        fQ21 * (x - x1) * (y2 - y) +\n        fQ12 * (x2 - x) * (y - y1) +\n        fQ22 * (x - x1) * (y - y1)) /\n        ((x2 - x1) * (y2 - y1)));\n}\nexport function blerp2(x, y, fQ11, fQ21, fQ12, fQ22) {\n    return (fQ11 * (1.0 - x) * (1.0 - y) + fQ21 * x * (1.0 - y) + fQ12 * (1.0 - x) * y + fQ22 * x * y);\n}\nexport function extractElevationTiles(rgbaData, outCurrenElevations, outChildrenElevations) {\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\n    let destSizeOne = destSize + 1;\n    let sourceSize = Math.sqrt(rgbaData.length / 4);\n    let dt = sourceSize / destSize;\n    let rightHeigh = 0, bottomHeigh = 0;\n    for (let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4; k < sourceDataLength; k++) {\n        let height = rgbaData[k * 4];\n        let i = Math.floor(k / sourceSize), j = k % sourceSize;\n        let tileX = Math.floor(j / destSize), tileY = Math.floor(i / destSize);\n        let destArr = outChildrenElevations[tileY][tileX];\n        let ii = i % destSize, jj = j % destSize;\n        let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\n        destArr[destIndex] = height;\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\n            outCurrenElevations[currIndex++] = height;\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\n            //current tile\n            rightHeigh = rgbaData[(k + 1) * 4];\n            let middleHeight = (height + rightHeigh) * 0.5;\n            destIndex = (ii + tileY) * destSizeOne + jj + 1;\n            destArr[destIndex] = middleHeight;\n            if ((i + tileY) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next right tile\n            let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n        }\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            bottomHeigh = rgbaData[(k + sourceSize) * 4];\n            let middleHeight = (height + bottomHeigh) * 0.5;\n            destIndex = (ii + 1) * destSizeOne + jj + tileX;\n            destArr[destIndex] = middleHeight;\n            if ((j + tileX) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next bottom tile\n            let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n        }\n        if ((j + 1) % destSize === 0 &&\n            j !== sourceSize - 1 &&\n            (i + 1) % destSize === 0 &&\n            i !== sourceSize - 1) {\n            //current tile\n            let rightBottomHeight = rgbaData[(k + sourceSize + 1) * 4];\n            let middleHeight = (height + rightHeigh + bottomHeigh + rightBottomHeight) * 0.25;\n            destIndex = (ii + 1) * destSizeOne + (jj + 1);\n            destArr[destIndex] = middleHeight;\n            outCurrenElevations[currIndex++] = middleHeight;\n            //next right tile\n            let rightindex = (ii + 1) * destSizeOne;\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n            //next bottom tile\n            let bottomindex = destSize;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n            //next right bottom tile\n            let rightBottomindex = 0;\n            outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\n        }\n    }\n}\n/**\n * Concatenates two the same type arrays\n * @param {TypedArray} a\n * @param {TypedArray | number[]} b\n */\nexport function concatTypedArrays(a, b) {\n    let c = new a.constructor(a.length + b.length); //hacky\n    c.set(a, 0);\n    c.set(b, a.length);\n    return c;\n}\n/**\n * Concatenates two the same  arrays\n * @param {TypedArray | number[]} [a=[]] - First array\n * @param {TypedArray | number[]} [b=[]] - Second array\n * @return {TypedArray | number[]} -\n */\nexport function concatArrays(a = [], b = []) {\n    if (ArrayBuffer.isView(a)) {\n        return concatTypedArrays(a, b);\n    }\n    else {\n        for (let i = 0; i < b.length; i++) {\n            a.push(b[i]);\n        }\n        return a;\n    }\n}\n/**\n * Convert simple array to typed\n * @param arr {number[]}\n * @param ctor {Float32Array}\n * @returns {TypedArray}\n */\nexport function makeArrayTyped(arr, ctor = Float32Array) {\n    if (!ArrayBuffer.isView(arr)) {\n        const typedArr = new ctor(arr.length); //hacky\n        typedArr.set(arr, 0);\n        return typedArr;\n    }\n    else {\n        return arr;\n    }\n}\n/**\n * Convert typed array to array\n * @param arr {TypedArray | number[]}\n * @returns {number[]}\n */\nexport function makeArray(arr) {\n    if (ArrayBuffer.isView(arr)) {\n        return Array.from(arr);\n    }\n    else {\n        return arr;\n    }\n}\n/**\n *\n * @param {TypedArray | Array} arr\n * @param {Number} starting\n * @param {Number} deleteCount\n * @param {{ result: number[] }} [out]\n */\nexport function spliceArray(arr, starting, deleteCount, out) {\n    if (ArrayBuffer.isView(arr)) {\n        if (starting < 0) {\n            deleteCount = Math.abs(starting);\n            starting += arr.length;\n        }\n        return spliceTypedArray(arr, starting, deleteCount, out);\n    }\n    else {\n        let res;\n        if (starting < 0) {\n            res = arr.splice(starting);\n        }\n        else {\n            res = arr.splice(starting, deleteCount);\n        }\n        if (out) {\n            out.result = res;\n        }\n        return arr;\n    }\n}\n/**\n *\n * @param {TypedArray} arr\n * @param {Number} starting\n * @param {Number} deleteCount\n * @param {{ result: TypedArray }} [out]\n */\nexport function spliceTypedArray(arr, starting, deleteCount, out) {\n    if (arr.length === 0) {\n        return arr;\n    }\n    const newSize = arr.length - deleteCount;\n    const splicedArray = new arr.constructor(newSize); //hacky\n    splicedArray.set(arr.subarray(0, starting));\n    splicedArray.set(arr.subarray(starting + deleteCount), starting);\n    if (out) {\n        out.result = arr.subarray(starting, starting + deleteCount);\n    }\n    return splicedArray;\n}\n/**\n * Returns 64-bit triangle coordinate array from inside of the source triangle array.\n * @static\n * @param {TypedArray | number[]} sourceArr - Source array\n * @param {number} gridSize - Source array square matrix size\n * @param {number} i0 - First row index source array matrix\n * @param {number} j0 - First column index\n * @param {number} size - Square matrix result size.\n * @return {Float64Array} Triangle coordinates array from the source array.\n * @TODO: optimization\n */\nexport function getMatrixSubArray64(sourceArr, gridSize, i0, j0, size) {\n    const size_1 = size + 1;\n    const i0size = i0 + size_1;\n    const j0size = j0 + size_1;\n    let res = new Float64Array(size_1 * size_1 * 3);\n    let vInd = 0;\n    for (let i = i0; i < i0size; i++) {\n        for (let j = j0; j < j0size; j++) {\n            let ind = 3 * (i * (gridSize + 1) + j);\n            res[vInd++] = sourceArr[ind];\n            res[vInd++] = sourceArr[ind + 1];\n            res[vInd++] = sourceArr[ind + 2];\n        }\n    }\n    return res;\n}\n/**\n * Returns 32-bit triangle coordinate array from inside of the source triangle array.\n * @static\n * @param {TypedArray | number[]} sourceArr - Source array\n * @param {number} gridSize - Source array square matrix size\n * @param {number} i0 - First row index source array matrix\n * @param {number} j0 - First column index\n * @param {number} size - Square matrix result size.\n * @return {Float32Array} Triangle coordinates array from the source array.\n */\nexport function getMatrixSubArray32(sourceArr, gridSize, i0, j0, size) {\n    const size_1 = size + 1;\n    const i0size = i0 + size_1;\n    const j0size = j0 + size_1;\n    let res = new Float32Array(size_1 * size_1 * 3);\n    let vInd = 0;\n    for (let i = i0; i < i0size; i++) {\n        for (let j = j0; j < j0size; j++) {\n            let ind = 3 * (i * (gridSize + 1) + j);\n            res[vInd++] = sourceArr[ind];\n            res[vInd++] = sourceArr[ind + 1];\n            res[vInd++] = sourceArr[ind + 2];\n        }\n    }\n    return res;\n}\n/**\n * Returns two float32 triangle coordinate arrays from inside of the source triangle array.\n * @static\n * @param {Array.<number>} sourceArr - Source array\n * @param {number} gridSize - Source array square matrix size\n * @param {number} i0 - First row index source array matrix\n * @param {number} j0 - First column index\n * @param {number} size - Square matrix result size.\n * @param {object} outBounds - Output bounds.\n * @return{Array.<number>} Triangle coordinates array from the source array.\n * @TODO: optimization\n */\nexport function getMatrixSubArrayBoundsExt(sourceArr, sourceArrHigh, sourceArrLow, noDataVertices, gridSize, i0, j0, size, outArr, outArrHigh, outArrLow, outBounds, outNoDataVertices) {\n    const i0size = i0 + size + 1;\n    const j0size = j0 + size + 1;\n    gridSize += 1;\n    let vInd = 0, nInd = 0;\n    for (let i = i0; i < i0size; i++) {\n        for (let j = j0; j < j0size; j++) {\n            let indBy3 = i * gridSize + j, ind = 3 * indBy3;\n            let x = sourceArr[ind], y = sourceArr[ind + 1], z = sourceArr[ind + 2];\n            if (!noDataVertices || noDataVertices[indBy3] === 0) {\n                if (x < outBounds.xmin)\n                    outBounds.xmin = x;\n                if (x > outBounds.xmax)\n                    outBounds.xmax = x;\n                if (y < outBounds.ymin)\n                    outBounds.ymin = y;\n                if (y > outBounds.ymax)\n                    outBounds.ymax = y;\n                if (z < outBounds.zmin)\n                    outBounds.zmin = z;\n                if (z > outBounds.zmax)\n                    outBounds.zmax = z;\n            }\n            else {\n                outNoDataVertices[nInd] = 1;\n            }\n            nInd++;\n            outArr[vInd] = x;\n            outArrLow[vInd] = sourceArrLow[ind];\n            outArrHigh[vInd++] = sourceArrHigh[ind];\n            outArr[vInd] = y;\n            outArrLow[vInd] = sourceArrLow[ind + 1];\n            outArrHigh[vInd++] = sourceArrHigh[ind + 1];\n            outArr[vInd] = z;\n            outArrLow[vInd] = sourceArrLow[ind + 2];\n            outArrHigh[vInd++] = sourceArrHigh[ind + 2];\n        }\n    }\n}\nexport function cloneArray(items) {\n    return items.map((item) => (Array.isArray(item) ? cloneArray(item) : item));\n}\n/**\n * Promise for load images\n * @function\n * @param {string} url - link to image.\n * @returns {Promise<Image>} Returns promise.\n */\nexport async function loadImage(url) {\n    return new Promise(resolve => {\n        const image = new Image();\n        image.addEventListener('load', () => {\n            resolve(image);\n        });\n        image.src = url;\n        image.crossOrigin = \"\";\n        return image;\n    });\n}\n/**\n * Gets image is loaded\n * @param {HTMLImageElement} image\n * @returns {boolean} Returns true is the image is loaded\n */\nexport function isImageLoaded(image) {\n    return image.complete && image.naturalHeight !== 0;\n}\nexport function distanceFormat(v) {\n    if (v > 1000) {\n        return `${(v / 1000).toFixed(2)} km`;\n    }\n    else if (v > 9) {\n        return `${Math.round(v)} m`;\n    }\n    else {\n        return `${v.toFixed(1)} m`;\n    }\n}\nexport function distanceFormatExt(v) {\n    if (v > 1000) {\n        let d = v - Math.floor(v);\n        if (d !== 0) {\n            return [(v / 1000).toFixed(2), \"km\"];\n        }\n        return [(v / 1000).toFixed(0), \"km\"];\n    }\n    else if (v > 9) {\n        return [Math.round(v).toString(), \"m\"];\n    }\n    else {\n        if (v <= 0.01) {\n            return [\"0\", \"m\"];\n        }\n        return [v.toFixed(1), \"m\"];\n    }\n}\nexport function getUrlParam(paramName) {\n    let urlParams = new URLSearchParams(location.search);\n    let param = urlParams.get(paramName);\n    if (param) {\n        return Number(param);\n    }\n}\n//# sourceMappingURL=shared.js.map","import { binarySearch } from \"../utils/shared\";\n/**\n * Seconds in millisecond.\n * @const\n */\nexport const SECONDS_PER_MILLISECOND = 0.001;\n/**\n * Milliseconds in second.\n * @const\n */\nexport const MILLISECONDS_PER_SECOND = 1000.0;\n/**\n * Seconds in minute.\n * @const\n */\nexport const SECONDS_PER_MINUTE = 60.0;\n/**\n * One by seconds in minute.\n * @const\n */\nexport const ONE_BY_SECONDS_PER_MINUTE = 1.0 / SECONDS_PER_MINUTE;\n/**\n * Minutes in hour.\n * @const\n */\nexport const MINUTES_PER_HOUR = 60.0;\n/**\n * Hours in day.\n * @const\n */\nexport const HOURS_PER_DAY = 24.0;\n/**\n * One by hours in day.\n * @const\n */\nexport const ONE_BY_HOURS_PER_DAY = 1.0 / HOURS_PER_DAY;\n/**\n * Seconds in hour.\n * @const\n */\nexport const SECONDS_PER_HOUR = 3600.0;\n/**\n * One by seconds in hour.\n * @const\n */\nexport const ONE_BY_SECONDS_PER_HOUR = 1.0 / SECONDS_PER_HOUR;\n/**\n * Seconds in 12 hours.\n * @const\n */\nexport const SECONDS_PER_12_HOURS = 12.0 * SECONDS_PER_HOUR;\n/**\n * Minutes in day.\n * @const\n */\nexport const MINUTES_PER_DAY = 1440.0;\n/**\n * One by minutes in day.\n * @const\n */\nexport const ONE_BY_MINUTES_PER_DAY = 1.0 / MINUTES_PER_DAY;\n/**\n * Seconds in day.\n * @const\n */\nexport const SECONDS_PER_DAY = 86400.0;\n/**\n * Milliseconds in day.\n * @const\n */\nexport const MILLISECONDS_PER_DAY = 86400000.0;\n/**\n * One by milliseconds in day.\n * @const\n */\nexport const ONE_BY_MILLISECONDS_PER_DAY = 1.0 / MILLISECONDS_PER_DAY;\n/**\n * One by seconds in day.\n * @const\n */\nexport const ONE_BY_SECONDS_PER_DAY = 1.0 / SECONDS_PER_DAY;\n/**\n * Days in julian century.\n * @const\n */\nexport const DAYS_PER_JULIAN_CENTURY = 36525.0;\n/**\n * Days in julian year.\n * @const\n */\nexport const DAYS_PER_JULIAN_YEAR = 365.25;\n/**\n * Seconds in picoseconds.\n * @const\n */\nexport const PICOSECOND = 0.000000001;\n/**\n * Modified julian date difference.\n * @const\n */\nexport const MODIFIED_JULIAN_DATE_DIFFERENCE = 2400000.5;\n/**\n * Julian date of 2000 year. Epoch.\n * @const\n */\nexport const J2000 = 2451545.0;\n/**\n * Returns julian days from Epoch.\n * @param {JulianDate} jd - Julian date.\n * @returns {number} Days from epoch\n */\nexport function T(jd) {\n    return (jd - J2000) / DAYS_PER_JULIAN_CENTURY;\n}\n/**\n * Gets the date's julian day.\n * @param {number} year - Year.\n * @param {number} month - Month.\n * @param {number} day - Day.\n * @returns {number} Day number\n */\nexport function getDayNumber(year, month, day) {\n    let a = ((month - 14) / 12) | 0;\n    let b = year + 4800 + a;\n    return ((((1461 * b) / 4) | 0) +\n        (((367 * (month - 2 - 12 * a)) / 12) | 0) -\n        (((3 * (((b + 100) / 100) | 0)) / 4) | 0) +\n        day -\n        32075);\n}\n/**\n * Converts javascript date to the universal(UTC) julian date.\n * @param {Date} date - Date.\n * @returns {JulianDate} UTC julian date\n */\nexport function DateToUTC(date) {\n    let dayNumber = getDayNumber(date.getUTCFullYear(), date.getUTCMonth() + 1, date.getUTCDate());\n    let hour = date.getUTCHours() - 12;\n    if (hour < 0) {\n        hour += 24;\n    }\n    let secondsOfDay = date.getUTCSeconds() +\n        hour * SECONDS_PER_HOUR +\n        date.getUTCMinutes() * SECONDS_PER_MINUTE +\n        date.getUTCMilliseconds() * SECONDS_PER_MILLISECOND;\n    if (secondsOfDay >= SECONDS_PER_12_HOURS) {\n        dayNumber--;\n    }\n    let extraDays = (secondsOfDay * ONE_BY_SECONDS_PER_DAY) | 0;\n    dayNumber += extraDays;\n    secondsOfDay -= SECONDS_PER_DAY * extraDays;\n    if (secondsOfDay < 0) {\n        dayNumber--;\n        secondsOfDay += SECONDS_PER_DAY;\n    }\n    return dayNumber + secondsOfDay * ONE_BY_SECONDS_PER_DAY;\n}\n/**\n * Converts javascript date to the atomic(TAI) julian date.\n * @param {Date} date - Date.\n * @returns {JulianDate} TAI julian date\n */\nexport function DateToTAI(date) {\n    return UTCtoTAI(DateToUTC(date));\n}\n/**\n * Converts coordinated universal(UTC) julian date to atomic(TAI) julian date.\n * @param {JulianDate} jd - UTC julian date.\n * @returns {JulianDate} TAI julian date\n */\nexport function UTCtoTAI(jd) {\n    let leapSeconds = leapSecondsTable;\n    let index = binarySearch(leapSeconds, jd, function (a, b) {\n        return a - b.jd;\n    });\n    if (index < 0) {\n        index = ~index;\n    }\n    if (index >= leapSeconds.length) {\n        index = leapSeconds.length - 1;\n    }\n    let offset = leapSeconds[index].leapSeconds;\n    if (index !== 0) {\n        if ((leapSeconds[index].jd - jd) * SECONDS_PER_DAY > offset) {\n            offset = leapSeconds[index - 1].leapSeconds;\n        }\n    }\n    return jd + offset * ONE_BY_SECONDS_PER_DAY;\n}\n/**\n * Converts atomic julian date(TAI) to the coordinated universal(UTC) julian date.\n * @param {JulianDate} tai - TAI julian date.\n * @returns {JulianDate | undefined} UTC julian date\n */\nexport function TAItoUTC(tai) {\n    let leapSeconds = leapSecondsTable;\n    let index = binarySearch(leapSeconds, tai, function (a, b) {\n        return a - b.jd;\n    });\n    if (index < 0) {\n        index = ~index;\n    }\n    if (index >= leapSeconds.length) {\n        return tai - leapSeconds[index - 1].leapSeconds * ONE_BY_SECONDS_PER_DAY;\n    }\n    if (index === 0) {\n        return tai - leapSeconds[0].leapSeconds * ONE_BY_SECONDS_PER_DAY;\n    }\n    let diff = (leapSeconds[index].jd - tai) * SECONDS_PER_DAY;\n    if (diff === 0) {\n        return tai - leapSeconds[index].leapSeconds * ONE_BY_SECONDS_PER_DAY;\n    }\n    if (diff <= 1.0) {\n        return;\n    }\n    return tai - leapSeconds[index - 1].leapSeconds * ONE_BY_SECONDS_PER_DAY;\n}\n/**\n * Converts UTC julian date to the javascript date object.\n * @param {JulianDate} utc - UTC julian date.\n * @returns {Date} JavaScript Date object\n */\nexport function UTCtoDate(utc) {\n    let julianDayNumber = utc | 0;\n    let secondsOfDay = (utc - julianDayNumber) * SECONDS_PER_DAY;\n    if (secondsOfDay >= SECONDS_PER_12_HOURS) {\n        julianDayNumber++;\n    }\n    let L = (julianDayNumber + 68569) | 0;\n    let N = ((4 * L) / 146097) | 0;\n    L = (L - (((146097 * N + 3) / 4) | 0)) | 0;\n    let I = ((4000 * (L + 1)) / 1461001) | 0;\n    L = (L - (((1461 * I) / 4) | 0) + 31) | 0;\n    let J = ((80 * L) / 2447) | 0;\n    let day = (L - (((2447 * J) / 80) | 0)) | 0;\n    L = (J / 11) | 0;\n    let month = (J + 2 - 12 * L) | 0;\n    let year = (100 * (N - 49) + I + L) | 0;\n    let hour = (secondsOfDay * ONE_BY_SECONDS_PER_HOUR) | 0;\n    let remainingSeconds = secondsOfDay - hour * SECONDS_PER_HOUR;\n    let minute = (remainingSeconds * ONE_BY_SECONDS_PER_MINUTE) | 0;\n    remainingSeconds = remainingSeconds - minute * SECONDS_PER_MINUTE;\n    let second = remainingSeconds | 0;\n    let millisecond = ((remainingSeconds - second) * MILLISECONDS_PER_SECOND) | 0;\n    hour += 12;\n    if (hour > 23) {\n        hour -= 24;\n    }\n    return new Date(Date.UTC(year, month - 1, day, hour, minute, second, millisecond));\n}\n/**\n * Converts TAI julian date to the javascript date object.\n * @param {JulianDate} tai - TAI julian date.\n * @returns {Date} JavaScript Date object\n */\nexport function TAItoDate(tai) {\n    let utc = TAItoUTC(tai);\n    if (!utc) {\n        utc = TAItoUTC(addSeconds(tai, -1));\n        console.trace(`TAItoDate - can't convert ${tai.toString()} to utc.`);\n    }\n    return UTCtoDate(utc);\n}\n/**\n * Adds milliseconds to the julian date.\n * @param {JulianDate} jd - Julian date.\n * @param {number} milliseconds - Milliseconds to add.\n * @returns {JulianDate} Julian date\n */\nexport function addMilliseconds(jd, milliseconds) {\n    return jd + milliseconds * ONE_BY_MILLISECONDS_PER_DAY;\n}\n/**\n * Adds seconds to the julian date.\n * @param {JulianDate} jd - Julian date.\n * @param {number} seconds - Seconds to add.\n * @returns {JulianDate} Julian date\n */\nexport function addSeconds(jd, seconds) {\n    return jd + seconds * ONE_BY_SECONDS_PER_DAY;\n}\n/**\n * Adds hours to the julian date.\n * @param {JulianDate} jd - Julian date.\n * @param {number} hours - Hours to add.\n * @returns {JulianDate} Julian date\n */\nexport function addHours(jd, hours) {\n    return jd + hours * ONE_BY_HOURS_PER_DAY;\n}\n/**\n * Adds minutes to the julian date.\n * @param {JulianDate} jd - Julian date.\n * @param {number} minutes - Minutes to add.\n * @returns {JulianDate} Julian date\n */\nexport function addMinutes(jd, minutes) {\n    return jd + minutes * MINUTES_PER_DAY;\n}\n/**\n * Adds days to the julian date.\n * @param {JulianDate} jd - Julian date.\n * @param {number} days - Days to add.\n * @returns {JulianDate} Julian date\n */\nexport function addDays(jd, days) {\n    return jd + days;\n}\n/**\n * Gets milliseconds of a julian date.\n * @param {JulianDate} jd - julian date.\n * @returns {number} Milliseconds\n */\nexport function getMilliseconds(jd) {\n    let s = jd - (jd | 0);\n    s *= SECONDS_PER_DAY;\n    return ((s - (s | 0)) * MILLISECONDS_PER_SECOND) | 0;\n}\n/**\n * Gets seconds of a julian date.\n * @param {JulianDate} jd - julian date.\n * @returns {number} Seconds\n */\nexport function getSeconds(jd) {\n    let s = jd - (jd | 0);\n    return s * SECONDS_PER_DAY;\n}\n/**\n * Gets hours of a julian date.\n * @param {JulianDate} jd - julian date.\n * @returns {number} Hours\n */\nexport function getHours(jd) {\n    let julianDayNumber = jd | 0;\n    let secondsOfDay = (jd - julianDayNumber) * SECONDS_PER_DAY;\n    let hour = (secondsOfDay * ONE_BY_SECONDS_PER_HOUR) | 0;\n    let remainingSeconds = secondsOfDay - hour * SECONDS_PER_HOUR;\n    let minute = (remainingSeconds * ONE_BY_SECONDS_PER_MINUTE) | 0;\n    remainingSeconds = remainingSeconds - minute * SECONDS_PER_MINUTE;\n    let second = remainingSeconds | 0;\n    let millisecond = ((remainingSeconds - second) * MILLISECONDS_PER_SECOND) | 0;\n    hour += 12 + minute / 60 + second / 3600 + millisecond / 1000;\n    if (hour > 23) {\n        hour -= 24;\n    }\n    return hour;\n}\n/**\n * Gets minutes of a julian date.\n * @param {JulianDate} jd - julian date.\n * @returns {number} Minutes\n */\nexport function getMinutes(jd) {\n    let s = jd - (jd | 0);\n    return (s * MINUTES_PER_DAY) | 0;\n}\n/**\n * Gets days of a julian date.\n * @param {JulianDate} jd - julian date.\n * @returns {number} Days\n */\nexport function getDays(jd) {\n    return jd | 0;\n}\n/**\n * Returns days in seconds.\n * @param {number} s - Seconds.\n * @returns {number} Days\n */\nexport function secondsToDays(s) {\n    return s * ONE_BY_SECONDS_PER_DAY;\n}\n/**\n * Returns seconds in days.\n * @param {number} d - Days.\n * @returns {number} Seconds\n */\nexport function daysToSeconds(d) {\n    return d * SECONDS_PER_DAY;\n}\nfunction __ls(jd, leapSeconds) {\n    return {\n        jd: jd,\n        leapSeconds: leapSeconds\n    };\n}\nconst leapSecondsTable = [\n    __ls(2441317.5, 10.0),\n    __ls(2441499.5, 11.0),\n    __ls(2441683.5, 12.0),\n    __ls(2442048.5, 13.0),\n    __ls(2442413.5, 14.0),\n    __ls(2442778.5, 15.0),\n    __ls(2443144.5, 16.0),\n    __ls(2443509.5, 17.0),\n    __ls(2443874.5, 18.0),\n    __ls(2444239.5, 19.0),\n    __ls(2444786.5, 20.0),\n    __ls(2445151.5, 21.0),\n    __ls(2445516.5, 22.0),\n    __ls(2446247.5, 23.0),\n    __ls(2447161.5, 24.0),\n    __ls(2447892.5, 25.0),\n    __ls(2448257.5, 26.0),\n    __ls(2448804.5, 27.0),\n    __ls(2449169.5, 28.0),\n    __ls(2449534.5, 29.0),\n    __ls(2450083.5, 30.0),\n    __ls(2450630.5, 31.0),\n    __ls(2451179.5, 32.0),\n    __ls(2453736.5, 33.0),\n    __ls(2454832.5, 34.0),\n    __ls(2456109.5, 35.0),\n    __ls(2457204.5, 36.0) // 2015-07-01T00:00:00.000Z\n];\nexport const J2000TAI = UTCtoTAI(J2000);\n//# sourceMappingURL=jd.js.map","import { Vec3 } from \"../math/Vec3\";\n/**\n * Bounding box class.\n * @class\n * @param {NumberArray6} [boundsArr]\n */\nclass Box {\n    constructor(boundsArr) {\n        this.vertices = [\n            new Vec3(),\n            new Vec3(),\n            new Vec3(),\n            new Vec3(),\n            new Vec3(),\n            new Vec3(),\n            new Vec3(),\n            new Vec3()\n        ];\n        if (boundsArr) {\n            this.setFromBoundsArr(boundsArr);\n        }\n    }\n    copy(bbox) {\n        for (let i = 0, len = this.vertices.length; i < len; i++) {\n            this.vertices[i].copy(bbox.vertices[i]);\n        }\n    }\n    /**\n     * Sets bounding box coordinates by the bounds array.\n     * @param {NumberArray6} bounds - Bounds is an array where [minX, minY, minZ, maxX, maxY, maxZ]\n     */\n    setFromBoundsArr(bounds) {\n        let xmin = bounds[0], xmax = bounds[3], ymin = bounds[1], ymax = bounds[4], zmin = bounds[2], zmax = bounds[5];\n        let v = this.vertices;\n        v[0].set(xmin, ymin, zmin);\n        v[1].set(xmax, ymin, zmin);\n        v[2].set(xmax, ymin, zmax);\n        v[3].set(xmin, ymin, zmax);\n        v[4].set(xmin, ymax, zmin);\n        v[5].set(xmax, ymax, zmin);\n        v[6].set(xmax, ymax, zmax);\n        v[7].set(xmin, ymax, zmax);\n    }\n    /**\n     * Sets bounding box coordinates by ellipsoid geodetic extend.\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\n     * @param {Extent} extent - Geodetic extent.\n     */\n    setFromExtent(ellipsoid, extent) {\n        this.setFromBoundsArr(extent.getCartesianBounds(ellipsoid));\n    }\n}\nexport { Box };\n//# sourceMappingURL=Box.js.map","import { Vec3 } from \"../math/Vec3\";\n/**\n * Bounding sphere class.\n * @class\n * @param {Number} [radius] - Bounding sphere radius.\n * @param {Vec3} [center] - Bounding sphere coordinates.\n */\nclass Sphere {\n    constructor(radius = 0, center) {\n        this.radius = radius;\n        this.center = center ? center.clone() : new Vec3();\n    }\n    /**\n     * Sets bounding sphere coordinates by the bounds array.\n     * @param {Array.<number>} bounds - Bounds is an array where [minX, minY, minZ, maxX, maxY, maxZ]\n     */\n    setFromBounds(bounds) {\n        let m = new Vec3(bounds[0], bounds[1], bounds[2]);\n        this.center.set(m.x + (bounds[3] - m.x) * 0.5, m.y + (bounds[3] - m.y) * 0.5, m.z + (bounds[5] - m.z) * 0.5);\n        this.radius = this.center.distance(m);\n    }\n    /**\n     * Sets bounding sphere coordinates by ellipsoid geodetic extend.\n     * @param {Ellipsoid} ellipsoid - Ellipsoid.\n     * @param {Extent} extent - Geodetic extent.\n     */\n    setFromExtent(ellipsoid, extent) {\n        this.setFromBounds(extent.getCartesianBounds(ellipsoid));\n    }\n}\nexport { Sphere };\n//# sourceMappingURL=Sphere.js.map","import { binaryInsert, stamp } from \"./utils/shared\";\nexport function createEvents(methodNames, sender) {\n    return new Events(methodNames, sender);\n}\n/**\n * Base events class to handle custom events.\n * @class\n * @param {Array.<string>} [eventNames] - Event names that could be dispatched.\n * @param {*} [sender]\n */\nexport class Events {\n    constructor(eventNames, sender) {\n        this.__id = Events.__counter__++;\n        this._eventNames = [];\n        eventNames && this.registerNames(eventNames);\n        this._sender = sender || this;\n        this._stopPropagation = false;\n        this._stampCache = {};\n    }\n    bindSender(sender) {\n        this._sender = sender || this;\n    }\n    /**\n     * Function that creates event object properties that would be dispatched.\n     * @public\n     * @param {Array.<string>} eventNames - Specified event names list.\n     */\n    registerNames(eventNames) {\n        for (let i = 0; i < eventNames.length; i++) {\n            this[eventNames[i]] = {\n                active: true,\n                handlers: []\n            };\n            this._eventNames.push(eventNames[i]);\n        }\n        return this;\n    }\n    _getStamp(name, id, ogid) {\n        return `${name}_${id}_${ogid}`;\n    }\n    /**\n     * Returns true if event callback has stamped.\n     * @protected\n     * @param {Object} name - Event identifier.\n     * @param {Object} obj - Event callback.\n     * @return {boolean} -\n     */\n    _stamp(name, obj) {\n        let ogid = stamp(obj);\n        let st = this._getStamp(name, this.__id, ogid);\n        if (!this._stampCache[st]) {\n            this._stampCache[st] = ogid;\n            return true;\n        }\n        return false;\n    }\n    /**\n     * Attach listener.\n     * @public\n     * @param {string} name - Event name to listen.\n     * @param {EventCallback} callback - Event callback function.\n     * @param {any} [sender] - Event callback function owner.\n     * @param {number} [priority] - Priority of event callback.\n     */\n    on(name, callback, sender, priority = 0) {\n        if (this._stamp(name, callback)) {\n            if (this[name]) {\n                let c = callback.bind(sender || this._sender);\n                c._openglobus_id = callback._openglobus_id;\n                c._openglobus_priority = priority;\n                binaryInsert(this[name].handlers, c, (a, b) => {\n                    return (b._openglobus_priority || 0) - (a._openglobus_priority || 0);\n                });\n            }\n        }\n    }\n    /**\n     * Stop listening event name with specified callback function.\n     * @public\n     * @param {string} name - Event name.\n     * @param {EventCallback | null} callback - Attached  event callback.\n     */\n    off(name, callback) {\n        if (callback) {\n            let st = this._getStamp(name, this.__id, callback._openglobus_id);\n            if (callback._openglobus_id && this._stampCache[st]) {\n                let h = this[name].handlers;\n                let i = h.length;\n                let indexToRemove = -1;\n                while (i--) {\n                    let hi = h[i];\n                    if (hi._openglobus_id === callback._openglobus_id) {\n                        indexToRemove = i;\n                        break;\n                    }\n                }\n                if (indexToRemove !== -1) {\n                    h.splice(indexToRemove, 1);\n                    this._stampCache[st] = undefined;\n                    delete this._stampCache[st];\n                }\n            }\n        }\n    }\n    /**\n     * Dispatch event.\n     * @public\n     * @param {EventCallbackHandler} event - Event instance property that created by event name.\n     * @param {Object} [args] - Callback parameters.\n     */\n    dispatch(event, ...args) {\n        let result = true;\n        if (event && event.active && !this._stopPropagation) {\n            let h = event.handlers.slice(0), i = h.length;\n            while (i--) {\n                if (h[i](...args) === false) {\n                    result = false;\n                }\n            }\n        }\n        this._stopPropagation = false;\n        return result;\n    }\n    /**\n     * Brakes events propagation.\n     * @public\n     */\n    stopPropagation() {\n        this._stopPropagation = true;\n    }\n    /**\n     * Removes all events.\n     * @public\n     */\n    clear() {\n        for (let i = 0; i < this._eventNames.length; i++) {\n            let e = this[this._eventNames[i]];\n            e.handlers.length = 0;\n            e.handlers = [];\n        }\n        this._eventNames.length = 0;\n        this._eventNames = [];\n    }\n}\nEvents.__counter__ = 0;\n//# sourceMappingURL=Events.js.map","import { createEvents } from '../Events';\nimport { parseHTML, stringTemplate } from '../utils/shared';\nconst VIEW_EVENTS = [\"render\"];\nclass View {\n    constructor(options = {}) {\n        this.__id = View.__counter__++;\n        this.events = createEvents(VIEW_EVENTS);\n        this.model = options.model || null;\n        this.template = options.template || \"\";\n        this.parent = options.parent || null;\n        this._classList = options.classList || [];\n        this.el = null;\n    }\n    static getHTML(template, params) {\n        return stringTemplate(template, params);\n    }\n    static parseHTML(htmlStr) {\n        return parseHTML(htmlStr);\n    }\n    static insertAfter(newNodes, referenceNode) {\n        if (!Array.isArray(newNodes)) {\n            newNodes = [newNodes];\n        }\n        for (let i = 0; i < newNodes.length; i++) {\n            if (referenceNode.parentNode) {\n                referenceNode.parentNode.insertBefore(newNodes[i], referenceNode.nextSibling);\n            }\n        }\n        return newNodes;\n    }\n    static insertBefore(newNodes, referenceNode) {\n        if (!Array.isArray(newNodes)) {\n            newNodes = [newNodes];\n        }\n        for (let i = 0; i < newNodes.length; i++) {\n            if (referenceNode.parentNode) {\n                referenceNode.parentNode.insertBefore(newNodes[i], referenceNode);\n            }\n        }\n        return newNodes;\n    }\n    insertBefore(view) {\n        if (!this.el) {\n            this.render();\n        }\n        if (this.el) {\n            if (view instanceof HTMLElement && view.parentNode) {\n                View.insertBefore(this.el, view);\n            }\n            if (view instanceof View && view.el && view.el.parentNode) {\n                View.insertBefore(this.el, view.el);\n            }\n        }\n    }\n    insertAfter(view) {\n        if (!this.el) {\n            this.render();\n        }\n        if (this.el) {\n            if (view instanceof HTMLElement && view.parentNode) {\n                View.insertAfter(this.el, view);\n            }\n            if (view instanceof View && view.el && view.el.parentNode) {\n                View.insertAfter(this.el, view.el);\n            }\n        }\n    }\n    isEqual(view) {\n        return view.__id === this.__id;\n    }\n    appendTo(node, clean = false, firstPosition = false) {\n        if (node) {\n            if (!this.el) {\n                this.beforeRender(node);\n                this.render();\n            }\n            if (this.el && this.el.parentNode) {\n                this.el.parentNode.removeChild(this.el);\n            }\n            if (clean) {\n                node.innerHTML = \"\";\n            }\n            if (this.el) {\n                if (firstPosition) {\n                    if (node.childNodes[0]) {\n                        View.insertBefore(this.el, node.childNodes[0]);\n                    }\n                    else {\n                        node.appendChild(this.el);\n                    }\n                }\n                else {\n                    node.appendChild(this.el);\n                }\n            }\n            this.afterRender(node);\n        }\n        return this;\n    }\n    afterRender(parentNode) {\n    }\n    beforeRender(parentNode) {\n    }\n    stopPropagation() {\n        this.events.stopPropagation();\n    }\n    renderTemplate(params) {\n        return View.parseHTML(View.getHTML(this.template, params || {}))[0];\n    }\n    render(params) {\n        this.el = this.renderTemplate(params);\n        for (let i = 0, len = this._classList.length; i < len; i++) {\n            this.el.classList.add(this._classList[i]);\n        }\n        this.events.dispatch(this.events.render, this);\n        return this;\n    }\n    select(queryStr) {\n        if (this.el) {\n            return this.el.querySelector(queryStr);\n        }\n        return null;\n    }\n    selectRemove(queryStr) {\n        if (this.el) {\n            let r = this.select(queryStr);\n            if (r && r.parentNode) {\n                r.parentNode.removeChild(r);\n                return r;\n            }\n        }\n    }\n    selectAll(queryStr, callback) {\n        if (this.el) {\n            const res = this.el.querySelectorAll(queryStr);\n            if (callback) {\n                for (let i = 0, len = res.length; i < len; i++) {\n                    callback(res[i], i);\n                }\n            }\n            return res;\n        }\n    }\n    remove() {\n        if (this.el && this.el.parentNode) {\n            this.el.parentNode.removeChild(this.el);\n        }\n    }\n}\nView.__counter__ = 0;\nexport { View };\n//# sourceMappingURL=View.js.map","import { stringTemplate } from '../utils/shared';\nimport { View } from './View';\nconst TEMPLATE = `<div class=\"og-button\" title=\"{title}\">\n       <div class=\"og-button-icon\">{icon}</div>\n       <div class=\"og-button-text\">{text}</div>\n    </div>`;\nconst BUTTON_EVENTS = [\"click\", \"mousedown\", \"mouseup\", \"touchstart\", \"touchend\", \"touchcancel\"];\nclass Button extends View {\n    constructor(options = {}) {\n        super({\n            template: stringTemplate(TEMPLATE, {\n                icon: options.icon || \"\",\n                text: options.text || \"\",\n                title: options.title || \"\"\n            }),\n            ...options\n        });\n        this._onMouseDown = (e) => {\n            e.preventDefault();\n            this.events.dispatch(this.events.mousedown, this, e);\n        };\n        this._onMouseUp = (e) => {\n            e.preventDefault();\n            this.events.dispatch(this.events.mouseup, this, e);\n        };\n        this._onTouchStart = (e) => {\n            e.preventDefault();\n            this.events.dispatch(this.events.touchstart, this, e);\n        };\n        this._onTouchEnd = (e) => {\n            e.preventDefault();\n            this.events.dispatch(this.events.touchend, this, e);\n        };\n        this._onTouchCancel = (e) => {\n            e.preventDefault();\n            this.events.dispatch(this.events.touchcancel, this, e);\n        };\n        this._onMouseClick = (e) => {\n            this._mouseClickHandler(e);\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(BUTTON_EVENTS);\n        this.el = null;\n        this.name = options.name || \"\";\n        this.$icon = null;\n        this.$text = null;\n    }\n    render(params) {\n        super.render(params);\n        this.$icon = this.select(\".og-button-icon\");\n        this.$text = this.select(\".og-button-text\");\n        this.el.__og_button__ = this;\n        this._initEvents();\n        return this;\n    }\n    _initEvents() {\n        if (this.el) {\n            this.el.addEventListener(\"click\", this._onMouseClick);\n            this.el.addEventListener(\"mousedown\", this._onMouseDown);\n            this.el.addEventListener(\"mouseup\", this._onMouseUp);\n            this.el.addEventListener(\"touchstart\", this._onTouchStart);\n            this.el.addEventListener(\"touchend\", this._onTouchEnd);\n            this.el.addEventListener(\"touchcancel\", this._onTouchCancel);\n        }\n    }\n    _mouseClickHandler(e) {\n        e.preventDefault();\n        this.events.dispatch(this.events.click, this, e);\n    }\n    remove() {\n        this._clearEvents();\n        super.remove();\n    }\n    _clearEvents() {\n        this.el && this.el.removeEventListener(\"click\", this._onMouseClick);\n    }\n}\nexport { Button };\n//# sourceMappingURL=Button.js.map","/**\n * Base control class. All other controls extend from this class.\n * @class Control\n * @param {Boolean} [options.autoActivate=true] - If true - calls initialize function after the renderer assigning.\n */\nexport class Control {\n    constructor(options = {}) {\n        this.__id = Control.__counter__++;\n        this._name = options.name || `_control_${this.__id.toString()}`;\n        this.planet = null;\n        this._initialized = false;\n        this.renderer = null;\n        this.autoActivate = options.autoActivate || false;\n        this._active = false;\n        this._deferredActive = true;\n    }\n    /**\n     * Returns control name.\n     * @public\n     * @return {string} -\n     */\n    get name() {\n        return this._name;\n    }\n    /**\n     * Control initialization function have to be overridden.\n     * @public\n     */\n    oninit() {\n    }\n    /**\n     * Control renderer assigning function have to be overridden.\n     * @public\n     */\n    onadd() {\n    }\n    /**\n     * Control remove function have to be overridden.\n     * @public\n     */\n    onremove() {\n    }\n    /**\n     * Control activation function have to be overridden.\n     * @public\n     */\n    onactivate() {\n    }\n    /**\n     * Control deactivation function have to be overriden.\n     * @public\n     */\n    ondeactivate() {\n    }\n    /**\n     * Assign renderer to the control.\n     * @public\n     * @type {Renderer}\n     */\n    addTo(renderer) {\n        if (renderer) {\n            this.renderer = renderer;\n            renderer.controls[this.name] = this;\n            this.onadd && this.onadd();\n            if (renderer.isInitialized()) {\n                this._initialized = true;\n                this.oninit && this.oninit();\n                if (this.autoActivate) {\n                    this.activate();\n                }\n            }\n        }\n    }\n    /**\n     * Removes control.\n     * @public\n     */\n    remove() {\n        this.deactivate();\n        this.onremove && this.onremove();\n        let r = this.renderer, n = this.name;\n        if (!r)\n            return;\n        let c = r.controls[n];\n        if (c) {\n            if (this.isEqual(c)) {\n                delete r.controls[n];\n            }\n        }\n        this.renderer = null;\n        this._active = false;\n        this._initialized = false;\n    }\n    /**\n     * Activate control.\n     * @public\n     */\n    activate() {\n        if (!this._active) {\n            if (!this._initialized) {\n                this._initialized = true;\n                this.oninit && this.oninit();\n            }\n            if (this._deferredActive) {\n                this._active = true;\n                this.onactivate && this.onactivate();\n            }\n            else {\n                this._deferredActive = true;\n            }\n        }\n    }\n    /**\n     * Deactivate control.\n     * @public\n     */\n    deactivate() {\n        if (this._active) {\n            this._active = false;\n            this.ondeactivate && this.ondeactivate();\n        }\n        else if (!this._initialized) {\n            this._deferredActive = false;\n        }\n    }\n    /**\n     * Is control active.\n     * @public\n     */\n    isActive() {\n        return this._active;\n    }\n    isEqual(control) {\n        return control.__id === this.__id;\n    }\n}\nControl.__counter__ = 0;\n//# sourceMappingURL=Control.js.map","import { Button } from \"../ui/Button\";\nimport { Control } from \"./Control\";\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg\n   xmlns:dc=\"http://purl.org/dc/elements/1.1/\"\n   xmlns:cc=\"http://creativecommons.org/ns#\"\n   xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"\n   xmlns:svg=\"http://www.w3.org/2000/svg\"\n   xmlns=\"http://www.w3.org/2000/svg\"\n   xmlns:sodipodi=\"http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd\"\n   xmlns:inkscape=\"http://www.inkscape.org/namespaces/inkscape\"\n   viewBox=\"0 0 110.6 110.3\"\n   version=\"1.1\"\n   id=\"svg21\"\n   sodipodi:docname=\"aaa.svg\"\n   inkscape:version=\"0.92.3 (2405546, 2018-03-11)\">\n  <metadata\n     id=\"metadata11\">\n    <rdf:RDF>\n      <cc:Work\n         rdf:about=\"\">\n        <dc:format>image/svg+xml</dc:format>\n        <dc:type\n           rdf:resource=\"http://purl.org/dc/dcmitype/StillImage\" />\n      </cc:Work>\n    </rdf:RDF>\n  </metadata>\n  <defs\n     id=\"defs25\" />\n  <sodipodi:namedview\n     pagecolor=\"#ffffff\"\n     bordercolor=\"#666666\"\n     borderopacity=\"1\"\n     objecttolerance=\"10\"\n     gridtolerance=\"10\"\n     guidetolerance=\"10\"\n     inkscape:pageopacity=\"0\"\n     inkscape:pageshadow=\"2\"\n     inkscape:window-width=\"1920\"\n     inkscape:window-height=\"1001\"\n     id=\"namedview23\"\n     showgrid=\"false\"\n     inkscape:zoom=\"9.4900968\"\n     inkscape:cx=\"28.376998\"\n     inkscape:cy=\"60.17054\"\n     inkscape:window-x=\"-9\"\n     inkscape:window-y=\"-9\"\n     inkscape:window-maximized=\"1\"\n     inkscape:current-layer=\"svg21\" />\n  <g\n     id=\"Layer_2\"\n     data-name=\"Layer 2\"\n     transform=\"matrix(1,0,0,-1,0,110.3)\">\n    <g\n       id=\"–°–ª–æ–π_1\"\n       data-name=\"–°–ª–æ–π 1\">\n      <g\n         id=\"_Group_\"\n         data-name=\"&lt;Group&gt;\">\n        <g\n           id=\"_Group_7\"\n           data-name=\"&lt;Group&gt;\">\n          <polygon\n             id=\"_Path_7\"\n             data-name=\"&lt;Path&gt;\"\n             points=\"55.2,97.6 55.3,97.4 55.3,97.6 55.3,97.2 65.3,55.1 55.3,55.1 55.2,55.1 45.3,55.1 55.2,97.2 \"\n             style=\"fill:#ff2b45\" />\n          <polygon\n             id=\"_Path_8\"\n             data-name=\"&lt;Path&gt;\"\n             points=\"55.3,12.7 55.3,12.9 55.2,12.7 55.2,13.1 45.3,55.1 55.2,55.1 55.3,55.1 65.3,55.1 55.3,13.1 \"\n             style=\"fill:#cecece;\" />\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>`;\n/**\n * Planet compass button\n */\nexport class CompassButton extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._heading = 0;\n        this._svg = null;\n    }\n    oninit() {\n        let btn = new Button({\n            classList: [\"og-map-button\", \"og-compass-button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        btn.appendTo(this.renderer.div);\n        btn.events.on(\"click\", this._onClick, this);\n        this._svg = btn.select(\"svg\");\n        this.renderer.events.on(\"draw\", this._draw, this);\n    }\n    _onClick() {\n        const planet = this.planet;\n        let c = planet.getCartesianFromPixelTerrain(this.renderer.handler.getCenter());\n        if (c) {\n            planet.flyCartesian(c.normal().scaleTo(c.length() + c.distance(planet.camera.eye)), null, null, 0, null, null, () => {\n                planet.camera.look(c);\n            });\n        }\n        else {\n            planet.flyCartesian(planet.camera.eye);\n        }\n    }\n    _draw() {\n        this.setHeading(this.planet.camera.getHeading());\n    }\n    setHeading(heading) {\n        if (this._heading !== heading) {\n            this._heading = heading;\n            this._svg.style.transform = `rotateZ(${-heading}deg)`;\n        }\n    }\n}\n//# sourceMappingURL=CompassButton.js.map","export const CLOSE_ICON = `<svg className=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor; overflow: hidden;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n    <path d=\"M777.856 280.192l-33.92-33.952-231.872 231.872-231.84-231.872-33.984 33.888 231.872 231.904-231.84 231.84 33.888 33.984 231.904-231.904 231.84 231.872 33.952-33.888-231.872-231.904z\"/>\n</svg>`;\n//# sourceMappingURL=icons.js.map","import { getDefault, stringTemplate } from '../utils/shared';\nimport { Button } from './Button';\nimport { CLOSE_ICON } from './icons';\nimport { View } from './View';\nconst DIALOG_EVENTS = [\"resize\", \"focus\", \"visibility\", \"dragstart\", \"dragend\"];\nconst TEMPLATE = `<div class=\"og-ddialog\" \n        style=\"display:{display}; resize:{resize}; width: {width}px; {height}; top: {top}px; left: {left}px; min-height: {minHeight}; max-height: {maxHeight}; min-width: {minWidth}; max-width: {maxWidth};\">\n       <div class=\"og-ddialog-header\">\n         <div class=\"og-ddialog-header__title\">{title}</div>      \n         <div class=\"og-ddialog-header__buttons\"></div>      \n        </div>\n       <div class=\"og-ddialog-container\"></div>\n    </div>>`;\nclass Dialog extends View {\n    constructor(options = {}) {\n        super({\n            template: stringTemplate(TEMPLATE, {\n                title: options.title || \"\",\n                display: getDefault(options.visible, true) ? \"flex\" : \"none\",\n                resize: getDefault(options.resizable, true) ? \"both\" : \"none\",\n                width: options.width || 300,\n                height: options.height ? `height: ${options.height || 200}px` : \"\",\n                left: options.left || 0,\n                top: options.top || 0,\n                minHeight: options.minHeight ? `${options.minHeight}px` : 'unset',\n                maxHeight: options.maxHeight ? `${options.maxHeight}px` : 'unset',\n                minWidth: options.minWidth ? `${options.minWidth}px` : 'unset',\n                maxWidth: options.maxWidth ? `${options.maxWidth}px` : 'unset',\n            }),\n            ...options\n        });\n        this._onCloseBtnClick = () => {\n            this.close();\n        };\n        this._onMouseDownAll = () => {\n            this.bringToFront();\n        };\n        this._onMouseDown = (e) => {\n            e.preventDefault();\n            this._startDragging();\n            this._startPosX = e.clientX;\n            this._startPosY = e.clientY;\n            document.addEventListener(\"mousemove\", this._onMouseMove);\n            document.addEventListener(\"mouseup\", this._onMouseUp);\n        };\n        this._onMouseMove = (e) => {\n            e.preventDefault();\n            let dx = this._startPosX - e.clientX;\n            let dy = this._startPosY - e.clientY;\n            this._startPosX = e.clientX;\n            this._startPosY = e.clientY;\n            this.setPosition(this.el.offsetLeft - dx, this.el.offsetTop - dy);\n        };\n        this._onMouseUp = () => {\n            this._clearDragging();\n            document.removeEventListener(\"mouseup\", this._onMouseUp);\n            document.removeEventListener(\"mousemove\", this._onMouseMove);\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(DIALOG_EVENTS);\n        this._startPosX = 0;\n        this._startPosY = 0;\n        this.$header = null;\n        this.$title = null;\n        this.$container = null;\n        this.$buttons = null;\n        this._closeBtn = new Button({\n            icon: CLOSE_ICON,\n            classList: [\"og-button-size__20\"]\n        });\n        this.useHide = options.useHide || false;\n        this._visibility = getDefault(options.visible, true);\n    }\n    setContainer(htmlStr) {\n        this.$container.innerHTML = htmlStr;\n    }\n    get container() {\n        return this.$container;\n    }\n    get width() {\n        return this.el ? parseFloat(this.el.style.width) : 0;\n    }\n    get height() {\n        return this.el ? parseFloat(this.el.style.height) : 0;\n    }\n    bringToFront() {\n        this.el.style.zIndex = String(Dialog.__zIndex__++);\n    }\n    render(params) {\n        super.render(params);\n        this.bringToFront();\n        this.$header = this.select(\".og-ddialog-header\");\n        this.$title = this.select(\".og-ddialog-header__title\");\n        this.$container = this.select(\".og-ddialog-container\");\n        this.$buttons = this.select(\".og-ddialog-header__buttons\");\n        this._initEvents();\n        this._initButtons();\n        return this;\n    }\n    show() {\n        if (!this._visibility) {\n            this._visibility = true;\n            this.el.style.display = \"flex\";\n            this.bringToFront();\n            this.events.dispatch(this.events.visibility, true, this);\n        }\n    }\n    hide() {\n        if (this._visibility) {\n            this._visibility = false;\n            this.el.style.display = \"none\";\n            this.events.dispatch(this.events.visibility, false, this);\n        }\n    }\n    close() {\n        if (this.useHide) {\n            this.hide();\n        }\n        else {\n            this.remove();\n        }\n    }\n    setVisibility(visibility) {\n        if (visibility) {\n            this.show();\n        }\n        else {\n            this.hide();\n        }\n    }\n    _initButtons() {\n        this._closeBtn.events.on(\"click\", this._onCloseBtnClick);\n        this._closeBtn.appendTo(this.$buttons);\n    }\n    _initEvents() {\n        this.$header.addEventListener(\"mousedown\", this._onMouseDown);\n        this.el.addEventListener(\"mousedown\", this._onMouseDownAll);\n    }\n    setPosition(x, y) {\n        if (x != undefined) {\n            this.el.style.left = `${x}px`;\n        }\n        if (y != undefined) {\n            this.el.style.top = `${y}px`;\n        }\n    }\n    _startDragging() {\n        if (!this.el.classList.contains(\"dragging\")) {\n            this.el.classList.add(\"dragging\");\n            this.events.dispatch(this.events.dragstart, this);\n        }\n    }\n    _clearDragging() {\n        if (this.el.classList.contains(\"dragging\")) {\n            this.events.dispatch(this.events.dragend, this);\n            this.el.classList.remove(\"dragging\");\n        }\n    }\n    remove() {\n        this._clearDragging();\n        this._clearEvents();\n        super.remove();\n    }\n    _clearEvents() {\n        this._closeBtn.events.off(\"click\", this._onCloseBtnClick);\n        document.removeEventListener(\"mouseup\", this._onMouseUp);\n        document.removeEventListener(\"mousemove\", this._onMouseMove);\n        this.$header.removeEventListener(\"mousedown\", this._onMouseDown);\n        this.el.removeEventListener(\"mousedown\", this._onMouseDownAll);\n    }\n}\nDialog.__zIndex__ = 0;\nexport { Dialog };\n//# sourceMappingURL=Dialog.js.map","import { Button } from './Button';\nconst TOGGLEBUTTON_EVENTS = [\"change\"];\nclass ToggleButton extends Button {\n    constructor(options) {\n        super({\n            ...options\n        });\n        this._onMouseClick = (e) => {\n            if (!this.preventClick) {\n                this._mouseClickHandler(e);\n                this.setActive(!this.isActive);\n            }\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(TOGGLEBUTTON_EVENTS);\n        this._isActive = options.isActive || false;\n        this.preventClick = options.preventClick || false;\n    }\n    setActive(isActive, stopPropagation = false) {\n        if (isActive !== this._isActive) {\n            this._isActive = isActive;\n            this._toggle();\n            if (!stopPropagation) {\n                this.events.dispatch(this.events.change, isActive, this);\n            }\n        }\n    }\n    _toggle() {\n        this.el && this.el.classList.toggle(\"og-button__active\");\n    }\n    get isActive() {\n        return this._isActive;\n    }\n    render(params) {\n        super.render(params);\n        if (this._isActive) {\n            this._toggle();\n        }\n        return this;\n    }\n}\nexport { ToggleButton };\n//# sourceMappingURL=ToggleButton.js.map","export const VISIBLE_DISTANCE = 3570.0;\nexport const MAX_RENDERED_NODES = 1000;\nexport const NW = 0;\nexport const NE = 1;\nexport const SW = 2;\nexport const SE = 3;\nexport const N = 0;\nexport const E = 1;\nexport const S = 2;\nexport const W = 3;\nexport const NOTRENDERING = 0;\nexport const RENDERING = 1;\nexport const WALKTHROUGH = 2;\n/**\n * World opposite side table.\n */\nexport const OPSIDE = [S, W, N, E];\n/**\n * First index is {N,E,S,W} and second is {NW,NE,SW,SE}\n */\nexport const NEIGHBOUR = [\n    [-1, -1, NW, NE],\n    [NE, -1, SE, -1],\n    [SW, SE, -1, -1],\n    [-1, NW, -1, SW]\n];\n/**\n * Neighbor's oposite part. For example oposite side\n * on the east neighbor side is: [S][SE] = NE\n */\nexport const OPPART = [\n    [SW, SE, NW, NE],\n    [NE, NW, SE, SW],\n    [SW, SE, NW, NE],\n    [NE, NW, SE, SW]\n];\n/**\n * Neighbos's opside array order. For example NW node\n * by E side array index is 0, SE node by S side is 1.\n */\nexport const NOPSORD = [\n    [0, 1, 0, 1],\n    [0, 0, 1, 1],\n    [0, 1, 0, 1],\n    [0, 0, 1, 1]\n];\n/**\n * First index is {NW,NE,SW,SE}, another one is {N,E,S,W}\n */\nexport const COMSIDE = [\n    [true, false, false, true],\n    [true, true, false, false],\n    [false, false, true, true],\n    [false, true, true, false]\n];\n/**\n * Gets segment part left to right or up to downo ffset against neighbour side.\n * Where 0 - no offset 1 - half segment size offset.\n */\nexport const PARTOFFSET = [\n    /*     N  E  S  W */\n    /*NW*/ [0, 1, 0, 0],\n    /*NE*/ [1, 0, 0, 0],\n    /*SW*/ [0, 1, 0, 1],\n    /*SE*/ [1, 1, 1, 1]\n];\n//# sourceMappingURL=quadTree.js.map","/**\n * @class Material\n * @param {Segment} segment\n * @param {Layer} layer\n */\nclass Material {\n    constructor(segment, layer) {\n        this.segment = segment;\n        this.layer = layer;\n        this.isReady = false;\n        this.isLoading = false;\n        this.texture = null;\n        this.pickingMask = null;\n        this.textureExists = false;\n        this.appliedNodeId = 0;\n        this.appliedNode = null;\n        this.texOffset = [0.0, 0.0, 1.0, 1.0];\n        this.loadingAttempts = 0;\n        this._updateTexture = null;\n        this._updatePickingMask = null;\n        this.pickingReady = false;\n    }\n    abortLoading() {\n        this.layer.abortMaterialLoading(this);\n    }\n    _createTexture(img) {\n        return this.layer._planet && this.layer.createTexture(img, this.layer._internalFormat, this.isReady ? this.texture : null);\n    }\n    applyImage(img) {\n        if (this.segment.initialized) {\n            this._updateTexture = null;\n            //this.image = img;\n            this.texture = this._createTexture(img);\n            this.isReady = true;\n            this.pickingReady = true;\n            this.textureExists = true;\n            this.isLoading = false;\n            this.appliedNodeId = this.segment.node.nodeId;\n            this.texOffset = [0.0, 0.0, 1.0, 1.0];\n        }\n    }\n    applyTexture(texture, pickingMask) {\n        if (this.segment.initialized) {\n            this.texture = texture;\n            this._updateTexture = null;\n            this.pickingMask = pickingMask || null;\n            this._updatePickingMask = null;\n            this.isReady = true;\n            this.pickingReady = true;\n            this.textureExists = true;\n            this.isLoading = false;\n            this.appliedNodeId = this.segment.node.nodeId;\n            this.texOffset = [0.0, 0.0, 1.0, 1.0];\n        }\n    }\n    textureNotExists() {\n        if (this.segment.initialized) {\n            this.pickingReady = true;\n            this.isLoading = false;\n            this.isReady = true;\n            this.textureExists = false;\n        }\n    }\n    clear() {\n        this.loadingAttempts = 0;\n        this.layer.clearMaterial(this);\n    }\n}\nexport { Material };\n//# sourceMappingURL=Material.js.map","import * as mercator from \"../mercator\";\nimport * as utils from \"../utils/shared\";\nimport { createColorRGB } from \"../utils/shared\";\nimport { createEvents } from \"../Events\";\nimport { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { Material } from \"./Material\";\nimport { Vec3 } from \"../math/Vec3\";\nconst FADING_RATIO = 15.8;\n/**\n * @class\n * Base class; normally only used for creating subclasses and not instantiated in apps.\n * A visual representation of raster or vector map data well known as a layer.\n * @class\n * @param {String} [name=\"noname\"] - Layer name.\n * @param {Object} [options] - Layer options:\n * @param {number} [options.opacity=1.0] - Layer opacity.\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\n * @param {boolean} [options.isBaseLayer=false] - This is a base layer.\n * @param {boolean} [options.visibility=true] - Layer visibility.\n * @param {boolean} [options.hideInLayerSwitcher=false] - Presence of layer in dialog window of LayerSwitcher control.\n * @param {boolean} [options.isSRGB=false] - Layer image webgl internal format.\n * @param {Extent} [options.extent=[[-180.0, -90.0], [180.0, 90.0]]] - Visible extent.\n * @param {string} [options.textureFilter=\"anisotropic\"] - Image texture filter. Available values: \"nearest\", \"linear\", \"mipmap\" and \"anisotropic\".\n * @param {string} [options.icon] - Icon for LayerSwitcher\n * @fires EventsHandler<LayerEventsList>#visibilitychange\n * @fires EventsHandler<LayerEventsList>#add\n * @fires EventsHandler<LayerEventsList>#remove\n * @fires EventsHandler<LayerEventsList>#mousemove\n * @fires EventsHandler<LayerEventsList>#mouseenter\n * @fires EventsHandler<LayerEventsList>#mouseleave\n * @fires EventsHandler<LayerEventsList>#lclick\n * @fires EventsHandler<LayerEventsList>#rclick\n * @fires EventsHandler<LayerEventsList>#mclick\n * @fires EventsHandler<LayerEventsList>#ldblclick\n * @fires EventsHandler<LayerEventsList>#rdblclick\n * @fires EventsHandler<LayerEventsList>#mdblclick\n * @fires EventsHandler<LayerEventsList>#lup\n * @fires EventsHandler<LayerEventsList>#rup\n * @fires EventsHandler<LayerEventsList>#mup\n * @fires EventsHandler<LayerEventsList>#ldown\n * @fires EventsHandler<LayerEventsList>#rdown\n * @fires EventsHandler<LayerEventsList>#mdown\n * @fires EventsHandler<LayerEventsList>#lhold\n * @fires EventsHandler<LayerEventsList>#rhold\n * @fires EventsHandler<LayerEventsList>#mhold\n * @fires EventsHandler<LayerEventsList>#mousewheel\n * @fires EventsHandler<LayerEventsList>#touchmove\n * @fires EventsHandler<LayerEventsList>#touchstart\n * @fires EventsHandler<LayerEventsList>#touchend\n * @fires EventsHandler<LayerEventsList>#doubletouch\n */\nclass Layer {\n    constructor(name, options = {}) {\n        this.isVector = false;\n        this.__id = Layer.__counter__++;\n        this._iconSrc = options.iconSrc || null;\n        this.events = createEvents(LAYER_EVENTS, this);\n        this.name = name || \"noname\";\n        this.properties = options.properties || {};\n        this.hideInLayerSwitcher = options.hideInLayerSwitcher || false;\n        this._hasImageryTiles = true;\n        this._opacity = options.opacity || 1.0;\n        this.minZoom = options.minZoom || 0;\n        this.maxZoom = options.maxZoom || 50;\n        this._planet = null;\n        this.isVector = false;\n        this._attribution = options.attribution || \"\";\n        this._zIndex = options.zIndex || 0;\n        this._isBaseLayer = options.isBaseLayer || false;\n        this._defaultTextures = options.defaultTextures || [null, null];\n        this._visibility = options.visibility !== undefined ? options.visibility : true;\n        this._fading = options.fading || false;\n        this._fadingFactor = this._opacity / FADING_RATIO;\n        if (this._fading) {\n            this._fadingOpacity = this._visibility ? this._opacity : 0.0;\n        }\n        else {\n            this._fadingOpacity = this._opacity;\n        }\n        this._height = options.height || 0;\n        this._extent = new Extent();\n        this.createTexture = null;\n        this._textureFilter = options.textureFilter ? options.textureFilter.trim().toUpperCase() : \"MIPMAP\";\n        this._isSRGB = options.isSRGB != undefined ? options.isSRGB : false;\n        this._internalFormat = null;\n        this._extentMerc = new Extent();\n        // Setting the extent up\n        this.setExtent(utils.createExtent(options.extent, new Extent(new LonLat(-180, -90), new LonLat(180, 90))));\n        /**\n         * Layer picking color. Assign when added to the planet.\n         * @protected\n         * @type {Vec3}\n         */\n        this._pickingColor = new Vec3();\n        this._pickingEnabled = options.pickingEnabled !== undefined ? options.pickingEnabled : true;\n        this._isPreloadDone = false;\n        this._preLoadZoomLevels = options.preLoadZoomLevels || [0, 1];\n        this._ambient = null;\n        this._diffuse = null;\n        this._specular = null;\n        if (options.ambient) {\n            let a = utils.createColorRGB(options.ambient, new Vec3(0.2, 0.2, 0.2));\n            this._ambient = new Float32Array([a.x, a.y, a.z]);\n        }\n        if (options.diffuse) {\n            let d = utils.createColorRGB(options.diffuse, new Vec3(0.8, 0.8, 0.8));\n            this._diffuse = new Float32Array([d.x, d.y, d.z]);\n        }\n        if (options.specular) {\n            let s = utils.createColorRGB(options.specular, new Vec3(0.0003, 0.0003, 0.0003));\n            let shininess = options.shininess || 20.0;\n            this._specular = new Float32Array([s.x, s.y, s.z, shininess]);\n        }\n        this.nightTextureCoefficient = options.nightTextureCoefficient || 1.0;\n    }\n    get iconSrc() {\n        return this._iconSrc;\n    }\n    set iconSrc(src) {\n        // @todo: add event\n        this._iconSrc = src;\n    }\n    set diffuse(rgb) {\n        if (rgb) {\n            let vec = createColorRGB(rgb);\n            this._diffuse = new Float32Array(vec.toArray());\n        }\n        else {\n            this._diffuse = null;\n        }\n    }\n    set ambient(rgb) {\n        if (rgb) {\n            let vec = createColorRGB(rgb);\n            this._ambient = new Float32Array(vec.toArray());\n        }\n        else {\n            this._ambient = null;\n        }\n    }\n    set specular(rgb) {\n        if (rgb) {\n            let vec = createColorRGB(rgb);\n            this._specular = new Float32Array([vec.x, vec.y, vec.y, this._specular ? this._specular[3] : 0.0]);\n        }\n        else {\n            this._specular = null;\n        }\n    }\n    set shininess(v) {\n        if (this._specular) {\n            this._specular[3] = v;\n        }\n    }\n    // get normalMapCreator() {\n    //     return this._normalMapCreator;\n    // }\n    static getTMS(x, y, z) {\n        return {\n            x: x,\n            y: (1 << z) - y - 1,\n            z: z\n        };\n    }\n    static getTileIndex(...arr) {\n        return arr.join(\"_\");\n    }\n    get instanceName() {\n        return \"Layer\";\n    }\n    get rendererEvents() {\n        return this.events;\n    }\n    set opacity(opacity) {\n        if (opacity !== this._opacity) {\n            if (this._fading) {\n                if (opacity > this._opacity) {\n                    this._fadingFactor = (opacity - this._opacity) / FADING_RATIO;\n                }\n                else if (opacity < this._opacity) {\n                    this._fadingFactor = (opacity - this._opacity) / FADING_RATIO;\n                }\n            }\n            else {\n                this._fadingOpacity = opacity;\n            }\n            this._opacity = opacity;\n        }\n    }\n    set pickingEnabled(picking) {\n        this._pickingEnabled = picking;\n    }\n    get pickingEnabled() {\n        return this._pickingEnabled;\n    }\n    /**\n     * Returns true if a layer has imagery tiles.\n     * @public\n     * @virtual\n     * @returns {boolean} - Imagery tiles flag.\n     */\n    hasImageryTiles() {\n        return this._hasImageryTiles;\n    }\n    /**\n     * Gets layer identifier.\n     * @public\n     * @returns {string} - Layer object id.\n     */\n    getID() {\n        return this.__id;\n    }\n    get id() {\n        return this.__id;\n    }\n    /**\n     * @todo: remove after all\n     */\n    get _id() {\n        return this.__id;\n    }\n    /**\n     * Compares layers instances.\n     * @public\n     * @param {Layer} layer - Layer instance to compare.\n     * @returns {boolean} - Returns true if the layers is the same instance of the input.\n     */\n    isEqual(layer) {\n        return layer.__id === this.__id;\n    }\n    /**\n     * Assign the planet.\n     * @protected\n     * @virtual\n     * @param {Planet} planet - Planet render node.\n     */\n    _assignPlanet(planet) {\n        this._planet = planet;\n        planet._layers.push(this);\n        if (planet.renderer && planet.renderer.isInitialized()) {\n            // TODO: webgl1\n            if (this._isSRGB) {\n                this._internalFormat = planet.renderer.handler.gl.SRGB8_ALPHA8;\n            }\n            else {\n                this._internalFormat = planet.renderer.handler.gl.RGBA8;\n            }\n            this.createTexture = planet.renderer.handler.createTexture[this._textureFilter];\n            this.events.on(\"visibilitychange\", planet._onLayerVisibilityChanged, planet);\n            if (this._isBaseLayer && this._visibility) {\n                planet.setBaseLayer(this);\n            }\n            planet.events.dispatch(planet.events.layeradd, this);\n            this.events.dispatch(this.events.add, planet);\n            planet.updateVisibleLayers();\n            this._bindPicking();\n            if (this._visibility && this.hasImageryTiles()) {\n                this._preLoad();\n            }\n        }\n    }\n    get isIdle() {\n        return this._planet && this._planet._terrainCompletedActivated || false;\n    }\n    /**\n     * Assign picking color to the layer.\n     * @protected\n     * @virtual\n     */\n    _bindPicking() {\n        this._planet && this._planet.renderer && this._planet.renderer.assignPickingColor(this);\n    }\n    /**\n     * Adds layer to the planet.\n     * @public\n     * @param {Planet} planet - Adds layer to the planet.\n     */\n    addTo(planet) {\n        if (!this._planet) {\n            this._assignPlanet(planet);\n        }\n    }\n    /**\n     * Removes from planet.\n     * @public\n     * @returns {Layer} -This layer.\n     */\n    remove() {\n        let p = this._planet;\n        if (p) {\n            //TODO: replace to planet\n            for (let i = 0; i < p._layers.length; i++) {\n                if (this.isEqual(p._layers[i])) {\n                    p.renderer && p.renderer.clearPickingColor(this);\n                    p._layers.splice(i, 1);\n                    p.updateVisibleLayers();\n                    this.clear();\n                    p.events.dispatch(p.events.layerremove, this);\n                    this.events.dispatch(this.events.remove, p);\n                    this._planet = null;\n                    this._internalFormat = null;\n                    this.createTexture = null;\n                    return this;\n                }\n            }\n        }\n        return this;\n    }\n    /**\n     * Clears layer material.\n     * @virtual\n     */\n    clear() {\n        if (this._planet) {\n            this._planet._clearLayerMaterial(this);\n        }\n    }\n    /**\n     * Returns planet instance.\n     */\n    get planet() {\n        return this._planet;\n    }\n    /**\n     * Sets layer attribution text.\n     * @public\n     * @param {string} html - HTML code that represents layer attribution, it could be just a text.\n     */\n    setAttribution(html) {\n        if (this._attribution !== html) {\n            this._attribution = html;\n            this._planet && this._planet.updateAttributionsList();\n        }\n    }\n    /**\n     * Gets layer attribution.\n     * @public\n     * @returns {string} Layer attribution\n     */\n    getAttribution() {\n        return this._attribution;\n    }\n    /**\n     * Sets height over the ground.\n     * @public\n     * @param {number} height - Layer height.\n     */\n    setHeight(height) {\n        this._height = height;\n        this._planet && this._planet.updateVisibleLayers();\n    }\n    /**\n     * Gets layer height.\n     * @public\n     * @returns {number} -\n     */\n    getHeight() {\n        return this._height;\n    }\n    /**\n     * Sets z-index.\n     * @public\n     * @param {number} zIndex - Layer z-index.\n     */\n    setZIndex(zIndex) {\n        this._zIndex = zIndex;\n        this._planet && this._planet.updateVisibleLayers();\n    }\n    /**\n     * Gets z-index.\n     * @public\n     * @returns {number} -\n     */\n    getZIndex() {\n        return this._zIndex;\n    }\n    /**\n     * Set zIndex to the maximal value depend on other layers on the planet.\n     * @public\n     */\n    bringToFront() {\n        if (this._planet) {\n            let vl = this._planet.visibleTileLayers;\n            let l = vl[vl.length - 1];\n            if (!l.isEqual(this)) {\n                this.setZIndex(l.getZIndex() + 1);\n            }\n        }\n    }\n    /**\n     * Returns true if the layer is a base.\n     * @public\n     * @returns {boolean} - Base layer flag.\n     */\n    isBaseLayer() {\n        return this._isBaseLayer;\n    }\n    /**\n     * Sets base layer type true.\n     * @public\n     * @param {boolean} isBaseLayer -\n     */\n    setBaseLayer(isBaseLayer) {\n        this._isBaseLayer = isBaseLayer;\n        if (this._planet) {\n            if (!isBaseLayer && this._planet.baseLayer && this.isEqual(this._planet.baseLayer)) {\n                this._planet.baseLayer = null;\n            }\n            this._planet.updateVisibleLayers();\n        }\n    }\n    /**\n     * Sets layer visibility.\n     * @public\n     * @virtual\n     * @param {boolean} visibility - Layer visibility.\n     */\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            this._visibility = visibility;\n            if (this._planet) {\n                if (this._isBaseLayer && visibility) {\n                    this._planet.setBaseLayer(this);\n                }\n                this._planet.updateVisibleLayers();\n                if (visibility && !this._isPreloadDone && !this.isVector) {\n                    this._isPreloadDone = true;\n                    this._preLoad();\n                }\n            }\n            this.events.dispatch(this.events.visibilitychange, this);\n        }\n    }\n    _forceMaterialApply(segment) {\n        let pm = segment.materials, m = pm[this.__id];\n        if (!m) {\n            m = pm[this.__id] = this.createMaterial(segment);\n        }\n        if (!m.isReady) {\n            this._planet._renderCompleted = false;\n        }\n        this.applyMaterial(m, true);\n    }\n    clearMaterial(material) {\n        //empty\n    }\n    loadMaterial(material, forceLoading = false) {\n        //empty\n    }\n    applyMaterial(m, isForced = false) {\n        return [0, 0, 1, 1];\n    }\n    _preLoadRecursive(node, maxZoom) {\n        if (node.segment.tileZoom > maxZoom) {\n            return;\n        }\n        if (this._preLoadZoomLevels.includes(node.segment.tileZoom)) {\n            this._forceMaterialApply(node.segment);\n        }\n        for (let i = 0, len = node.nodes.length; i < len; i++) {\n            if (node.nodes[i]) {\n                this._preLoadRecursive(node.nodes[i], maxZoom);\n            }\n        }\n    }\n    _preLoad() {\n        if (this._planet && this._preLoadZoomLevels.length) {\n            let p = this._planet, maxZoom = Math.max(...this._preLoadZoomLevels);\n            for (let i = 0, len = p.quadTreeStrategy.quadTreeList.length; i < len; i++) {\n                this._preLoadRecursive(p.quadTreeStrategy.quadTreeList[i], maxZoom);\n            }\n        }\n    }\n    /**\n     * Gets layer visibility.\n     * @public\n     * @returns {boolean} - Layer visibility.\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Sets visible geographical extent.\n     * @public\n     * @param {Extent} extent - Layer visible geographical extent.\n     */\n    setExtent(extent) {\n        let sw = extent.southWest.clone(), ne = extent.northEast.clone();\n        if (sw.lat < mercator.MIN_LAT) {\n            sw.lat = mercator.MIN_LAT;\n        }\n        if (ne.lat > mercator.MAX_LAT) {\n            ne.lat = mercator.MAX_LAT;\n        }\n        this._extent = extent.clone();\n        this._extentMerc = new Extent(sw.forwardMercator(), ne.forwardMercator());\n        this._correctFullExtent();\n    }\n    /**\n     * Gets layer extent.\n     * @public\n     * @return {Extent} - Layer geodetic extent.\n     */\n    getExtent() {\n        return this._extent;\n    }\n    /**\n     * Gets layer web-mercator extent.\n     * @public\n     * @return {Extent} - Layer extent.\n     */\n    getExtentMerc() {\n        return this._extentMerc;\n    }\n    /**\n     * Fly extent.\n     * @public\n     */\n    flyExtent() {\n        this._planet?.flyExtent(this.getExtent());\n    }\n    /**\n     * View extent.\n     * @public\n     */\n    viewExtent() {\n        this._planet?.viewExtent(this.getExtent());\n    }\n    /**\n     * Special correction of the whole globe extent.\n     * @protected\n     */\n    _correctFullExtent() {\n        // var e = this._extent,\n        //    em = this._extentMerc;\n        // var ENLARGE_MERCATOR_LON = og.mercator.POLE + 50000;\n        // var ENLARGE_MERCATOR_LAT = og.mercator.POLE + 50000;\n        // if (e.northEast.lat === 90.0) {\n        //    em.northEast.lat = ENLARGE_MERCATOR_LAT;\n        // }\n        // if (e.northEast.lon === 180.0) {\n        //    em.northEast.lon = ENLARGE_MERCATOR_LON;\n        // }\n        // if (e.southWest.lat === -90.0) {\n        //    em.southWest.lat = -ENLARGE_MERCATOR_LAT;\n        // }\n        // if (e.southWest.lon === -180.0) {\n        //    em.southWest.lon = -ENLARGE_MERCATOR_LON;\n        // }\n    }\n    get opacity() {\n        return this._opacity;\n    }\n    get screenOpacity() {\n        return this._fading ? this._fadingOpacity : this._opacity;\n    }\n    _refreshFadingOpacity() {\n        let p = this._planet;\n        if (this._visibility && p.getViewExtent().overlaps(this._extent) &&\n            p.maxCurrZoom >= this.minZoom &&\n            p.minCurrZoom <= this.maxZoom) {\n            this._fadingOpacity += this._fadingFactor;\n            if ((this._fadingFactor > 0.0 && this._fadingOpacity > this._opacity) ||\n                (this._fadingFactor < 0.0 && this._fadingOpacity < this._opacity)) {\n                this._fadingOpacity = this._opacity;\n            }\n            return false;\n        }\n        else {\n            this._fadingOpacity = 0.0;\n            return !this._visibility;\n        }\n    }\n    createMaterial(segment) {\n        return new Material(segment, this);\n    }\n    redraw() {\n        if (this._planet) {\n            this._planet.quadTreeStrategy.clearLayerMaterial(this);\n            // this._planet._quadTree.traverseTree((n: Node) => {\n            //         if (n.segment.materials[this.__id]) {\n            //             n.segment.materials[this.__id].clear();\n            //         }\n            //     }\n            // );\n            //\n            // this._planet._quadTreeNorth.traverseTree((n: Node) => {\n            //         if (n.segment.materials[this.__id]) {\n            //             n.segment.materials[this.__id].clear();\n            //         }\n            //     }\n            // );\n            //\n            // this._planet._quadTreeSouth.traverseTree((n: Node) => {\n            //         if (n.segment.materials[this.__id]) {\n            //             n.segment.materials[this.__id].clear();\n            //         }\n            //     }\n            // );\n        }\n    }\n    abortMaterialLoading(material) {\n    }\n    abortLoading() {\n    }\n}\nLayer.__counter__ = 0;\nexport const LAYER_EVENTS = [\n    /**\n     * Triggered when layer visibility changed.\n     * @event og.Layer#visibilitychange\n     */\n    \"visibilitychange\",\n    /**\n     * Triggered when layer has added to the planet.\n     * @event og.Layer#add\n     */\n    \"add\",\n    /**\n     * Triggered when layer has removed from the planet.\n     * @event og.Layer#remove\n     */\n    \"remove\",\n    /**\n     * Triggered when mouse moves over the layer.\n     * @event og.Layer#mousemove\n     */\n    \"mousemove\",\n    /**\n     * Triggered when mouse has entered over the layer.\n     * @event og.Layer#mouseenter\n     */\n    \"mouseenter\",\n    /**\n     * Triggered when mouse leaves the layer.\n     * @event og.Layer#mouseenter\n     */\n    \"mouseleave\",\n    /**\n     * Mouse left button clicked.\n     * @event og.Layer#lclick\n     */\n    \"lclick\",\n    /**\n     * Mouse right button clicked.\n     * @event og.Layer#rclick\n     */\n    \"rclick\",\n    /**\n     * Mouse right button clicked.\n     * @event og.Layer#mclick\n     */\n    \"mclick\",\n    /**\n     * Mouse left button double click.\n     * @event og.Layer#ldblclick\n     */\n    \"ldblclick\",\n    /**\n     * Mouse right button double click.\n     * @event og.Layer#rdblclick\n     */\n    \"rdblclick\",\n    /**\n     * Mouse middle button double click.\n     * @event og.Layer#mdblclick\n     */\n    \"mdblclick\",\n    /**\n     * Mouse left button up(stop pressing).\n     * @event og.Layer#lup\n     */\n    \"lup\",\n    /**\n     * Mouse right button up(stop pressing).\n     * @event og.Layer#rup\n     */\n    \"rup\",\n    /**\n     * Mouse middle button up(stop pressing).\n     * @event og.Layer#mup\n     */\n    \"mup\",\n    /**\n     * Mouse left button is just pressed down(start pressing).\n     * @event og.Layer#ldown\n     */\n    \"ldown\",\n    /**\n     * Mouse right button is just pressed down(start pressing).\n     * @event og.Layer#rdown\n     */\n    \"rdown\",\n    /**\n     * Mouse middle button is just pressed down(start pressing).\n     * @event og.Layer#mdown\n     */\n    \"mdown\",\n    /**\n     * Mouse left button is pressing.\n     * @event og.Layer#lhold\n     */\n    \"lhold\",\n    /**\n     * Mouse right button is pressing.\n     * @event og.Layer#rhold\n     */\n    \"rhold\",\n    /**\n     * Mouse middle button is pressing.\n     * @event og.Layer#mhold\n     */\n    \"mhold\",\n    /**\n     * Mouse wheel is rotated.\n     * @event og.Layer#mousewheel\n     */\n    \"mousewheel\",\n    /**\n     * Triggered when touching moves over the layer.\n     * @event og.Layer#touchmove\n     */\n    \"touchmove\",\n    /**\n     * Triggered when layer begins to touch.\n     * @event og.Layer#touchstart\n     */\n    \"touchstart\",\n    /**\n     * Triggered when layer has finished touching.\n     * @event og.Layer#touchend\n     */\n    \"touchend\",\n    /**\n     * Triggered layer has double touched.\n     * @event og.Layer#doubletouch\n     */\n    \"doubletouch\",\n    /**\n     * Triggered when touching leaves layer borders.\n     * @event og.Layer#touchleave\n     */\n    \"touchleave\",\n    /**\n     * Triggered when touch enters over the layer.\n     * @event og.Layer#touchenter\n     */\n    \"touchenter\"\n];\nexport { Layer };\n//# sourceMappingURL=Layer.js.map","import * as quadTree from \"../quadTree/quadTree\";\nimport { Layer } from \"./Layer\";\nconst CANVASTILES_EVENTS = [\n    /**\n     * Triggered when current tile image has loaded before rendering.\n     * @event og.layer.CanvasTiles#load\n     */\n    \"load\",\n    /**\n     * Triggered when all tiles have loaded or loading has stopped.\n     * @event og.layer.CanvasTiles#loadend\n     */\n    \"loadend\"\n];\n/**\n * Layer used to rendering each tile as a separate canvas object.\n * @class\n * @extends {Layer}\n * @param {String} [name=\"noname\"] - Layer name.\n * @param {ICanvasTilesParams} options:\n * @param {number} [options.opacity=1.0] - Layer opacity.\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\n * @param {boolean} [options.visibility=true] - Layer visibility.\n * @param {DrawTileCallback} options.drawTile - Draw tile callback.\n * @fires EventsHandler<CanvasTilesEventsList>#load\n * @fires EventsHandler<CanvasTilesEventsList>#loadend\n */\nclass CanvasTiles extends Layer {\n    constructor(name, options) {\n        super(name, options);\n        //@ts-ignore\n        this.events = this.events.registerNames(CANVASTILES_EVENTS);\n        this.animated = options.animated || false;\n        this.minNativeZoom = options.minNativeZoom || 0;\n        this.maxNativeZoom = options.maxNativeZoom || 100;\n        this._counter = 0;\n        this._pendingsQueue = []; // new og.QueueArray();\n        this.drawTile = options.drawTile;\n        this._onLoadend_ = null;\n    }\n    addTo(planet) {\n        this._onLoadend_ = this._onLoadend.bind(this);\n        this.events.on(\"loadend\", this._onLoadend_, this);\n        return super.addTo(planet);\n    }\n    remove() {\n        this.events.off(\"loadend\", this._onLoadend_);\n        this._onLoadend_ = null;\n        return super.remove();\n    }\n    _onLoadend() {\n        if (this._planet && this._planet._terrainCompletedActivated) {\n            this._planet.events.dispatch(this._planet.events.layerloadend, this);\n        }\n    }\n    get instanceName() {\n        return \"CanvasTiles\";\n    }\n    get isIdle() {\n        return super.isIdle && this._counter === 0;\n    }\n    /**\n     * Abort loading tiles.\n     * @public\n     */\n    abortLoading() {\n        //const q = this._pendingsQueue;\n        // for (let i = q._shiftIndex + 1; i < q._popIndex + 1; i++) {\n        //     if (q._array[i]) {\n        //         this.abortMaterialLoading(q._array[i]);\n        //     }\n        // }\n        // this._pendingsQueue.clear();\n        // for (let i = 0; i < q.length; i++) {\n        //     this.abortMaterialLoading(q[i]);\n        // }\n        this._pendingsQueue.forEach((qi) => {\n            this.abortMaterialLoading(qi);\n        });\n        this._pendingsQueue = [];\n    }\n    /**\n     * Sets layer visibility.\n     * @public\n     * @param {boolean} visibility - Layer visibility.\n     */\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            super.setVisibility(visibility);\n            if (!visibility) {\n                this.abortLoading();\n            }\n        }\n    }\n    /**\n     * Start to load tile material.\n     * @public\n     * @virtual\n     * @param {Material} material -\n     */\n    loadMaterial(material) {\n        let seg = material.segment;\n        if (this._isBaseLayer) {\n            material.texture = seg._isNorth ? seg.planet.solidTextureOne : seg.planet.solidTextureTwo;\n        }\n        else {\n            material.texture = seg.planet.transparentTexture;\n        }\n        if (this._planet.layerLock.isFree() || material.segment.tileZoom < 2) {\n            material.isReady = false;\n            material.isLoading = true;\n            if (CanvasTiles.__requestsCounter >= CanvasTiles.MAX_REQUESTS && this._counter) {\n                this._pendingsQueue.push(material);\n            }\n            else {\n                this._exec(material);\n            }\n        }\n    }\n    /**\n     * Loads material image and apply it to the planet segment.\n     * @protected\n     * @param {Material} material - Loads material image.\n     */\n    _exec(material) {\n        CanvasTiles.__requestsCounter++;\n        this._counter++;\n        const e = this.events.load;\n        if (e.handlers.length) {\n            this.events.dispatch(e, material);\n        }\n        requestAnimationFrame(() => {\n            this.drawTile(material, (canvas) => {\n                this._counter--;\n                CanvasTiles.__requestsCounter--;\n                this._correctCounter();\n                if (material.isLoading) {\n                    material.applyImage(canvas);\n                }\n                this._dequeueRequest();\n            });\n        });\n    }\n    _correctCounter() {\n        if (this._counter < 0)\n            this._counter = 0;\n        if (CanvasTiles.__requestsCounter < 0)\n            CanvasTiles.__requestsCounter = 0;\n    }\n    /**\n     * Abort exact material loading.\n     * @public\n     * @param {Material} material - Segment material.\n     */\n    abortMaterialLoading(material) {\n        if (material.isLoading) {\n            this._counter--;\n            CanvasTiles.__requestsCounter--;\n            this._correctCounter();\n            this._dequeueRequest();\n        }\n        material.isLoading = false;\n        material.isReady = false;\n    }\n    _dequeueRequest() {\n        if (this._pendingsQueue.length) {\n            if (CanvasTiles.__requestsCounter < CanvasTiles.MAX_REQUESTS) {\n                const pmat = this._whilePendings();\n                if (pmat) {\n                    this._exec(pmat);\n                }\n            }\n        }\n        else if (this._counter === 0 && this._planet && this._planet._terrainCompletedActivated) {\n            this.events.dispatch(this.events.loadend);\n        }\n    }\n    _whilePendings() {\n        while (this._pendingsQueue.length) {\n            const pmat = this._pendingsQueue.pop();\n            if (pmat && pmat.segment && pmat.segment.node) {\n                if (pmat.segment.initialized && pmat.segment.node.getState() === quadTree.RENDERING) {\n                    return pmat;\n                }\n                pmat.isLoading = false;\n            }\n        }\n        return null;\n    }\n    applyMaterial(material) {\n        if (material.isReady) {\n            // IMPORTANT!\n            // Animated doesn't work withMaxNativeZoom\n            // It could be fixed with call drawTile method only for parent\n            // material (which is rendered on the current segment material),\n            // just for one renderer frame\n            if (material.layer.animated) {\n                requestAnimationFrame(() => {\n                    this.drawTile(material, function (canvas) {\n                        material.applyImage(canvas);\n                    });\n                });\n            }\n            return material.texOffset;\n        }\n        else if (material.segment.tileZoom < this.minNativeZoom) {\n            material.textureNotExists();\n        }\n        else {\n            let segment = material.segment;\n            let pn = segment.node, parentTextureExists = false;\n            let maxNativeZoom = material.layer.maxNativeZoom;\n            if (segment.passReady && !material.isLoading && segment.tileZoom <= maxNativeZoom) {\n                this.loadMaterial(material);\n            }\n            let mId = this._id;\n            let psegm = material;\n            while (pn.parentNode) {\n                pn = pn.parentNode;\n                psegm = pn.segment.materials[mId];\n                if (psegm && psegm.textureExists) {\n                    parentTextureExists = true;\n                    break;\n                }\n            }\n            if (segment.passReady) {\n                if (pn.segment.tileZoom === maxNativeZoom) {\n                    if (segment.tileZoom > maxNativeZoom) {\n                        material.textureNotExists();\n                    }\n                }\n                else if (pn.segment.tileZoom < maxNativeZoom) {\n                    let pn = segment.node;\n                    while (pn.segment.tileZoom > maxNativeZoom) {\n                        pn = pn.parentNode;\n                    }\n                    let pnm = pn.segment.materials[mId];\n                    if (pnm) {\n                        !pnm.isLoading && !pnm.isReady && this.loadMaterial(pnm);\n                    }\n                    else {\n                        pnm = pn.segment.materials[material.layer._id] = material.layer.createMaterial(pn.segment);\n                        this.loadMaterial(pnm);\n                    }\n                }\n            }\n            if (parentTextureExists) {\n                //\n                // Animated doesn't work withMaxNativeZoom\n                //\n                if (material.layer.animated) {\n                    requestAnimationFrame(() => {\n                        this.drawTile(material, function (canvas) {\n                            material.applyImage(canvas);\n                        });\n                    });\n                }\n                material.appliedNodeId = pn.nodeId;\n                material.texture = psegm.texture;\n                let dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\n                material.texOffset[0] = segment.tileX * dZ2 - pn.segment.tileX;\n                material.texOffset[1] = segment.tileY * dZ2 - pn.segment.tileY;\n                material.texOffset[2] = dZ2;\n                material.texOffset[3] = dZ2;\n            }\n            else {\n                material.texture = segment.planet.transparentTexture;\n                material.texOffset[0] = 0.0;\n                material.texOffset[1] = 0.0;\n                material.texOffset[2] = 1.0;\n                material.texOffset[3] = 1.0;\n            }\n        }\n        return material.texOffset;\n    }\n    clearMaterial(material) {\n        if (material.isReady) {\n            material.isReady = false;\n            if (material.textureExists && material.texture && !material.texture.default) {\n                material.segment.handler.gl.deleteTexture(material.texture);\n                material.texture = null;\n            }\n        }\n        this.abortMaterialLoading(material);\n        material.isLoading = false;\n        material.textureExists = false;\n        //@ts-ignore\n        material.layer = null;\n        //@ts-ignore\n        material.segment = null;\n        // if (material.image) {\n        //     material.image.src = \"\";\n        //     material.image = null;\n        // }\n    }\n}\nCanvasTiles.MAX_REQUESTS = 20;\nCanvasTiles.__requestsCounter = 0;\nexport { CanvasTiles };\n//# sourceMappingURL=CanvasTiles.js.map","import { createEvents } from '../Events';\nconst BUTTONGROUP_EVENTS = [\"change\"];\nclass ButtonGroup {\n    constructor(options = {}) {\n        this._onChange = (isActive, btn) => {\n            if (isActive) {\n                btn.preventClick = true;\n                for (let i = 0; i < this._buttons.length; i++) {\n                    let bi = this._buttons[i];\n                    if (!bi.isEqual(btn)) {\n                        bi.setActive(false);\n                        bi.preventClick = false;\n                    }\n                }\n                this.events.dispatch(this.events.change, btn);\n            }\n        };\n        this.events = createEvents(BUTTONGROUP_EVENTS);\n        this._buttons = options.buttons || [];\n        for (let i = 0; i < this._buttons.length; i++) {\n            this._bindButton(this._buttons[i]);\n        }\n    }\n    _bindButton(button) {\n        button.events.on(\"change\", this._onChange);\n    }\n    add(button) {\n        this._buttons.push(button);\n        this._bindButton(button);\n    }\n    remove(button) {\n        for (let i = 0; i < this._buttons.length; i++) {\n            if (this._buttons[i].isEqual(button)) {\n                this._buttons.splice(i);\n                button.events.off(\"change\", this._onChange);\n                return;\n            }\n        }\n    }\n}\nexport { ButtonGroup };\n//# sourceMappingURL=ButtonGroup.js.map","export class BaseWorker {\n    constructor(numWorkers = 2, program) {\n        this._sourceId = 0;\n        this._source = new Map();\n        this._pendingQueue = [];\n        this._numWorkers = numWorkers;\n        this._workerQueue = [];\n        if (program) {\n            this.setProgram(program);\n        }\n    }\n    check() {\n        if (this._pendingQueue.length) {\n            this.make(this._pendingQueue.pop());\n        }\n    }\n    setProgram(program) {\n        let p = new Blob([program], { type: \"application/javascript\" });\n        for (let i = 0; i < this._numWorkers; i++) {\n            let w = new Worker(URL.createObjectURL(p));\n            w.onmessage = (e) => {\n                this._onMessage(e);\n                this._workerQueue && this._workerQueue.unshift(e.target);\n                this.check();\n            };\n            this._workerQueue.push(w);\n        }\n    }\n    make(data) {\n    }\n    _onMessage(e) {\n    }\n    destroy() {\n        for (let i = 0; i < this._workerQueue.length; i++) {\n            const w = this._workerQueue[i];\n            w.onmessage = null;\n            w.terminate();\n        }\n        //@ts-ignore\n        this._pendingQueue = null;\n        //@ts-ignore\n        this._workerQueue = null;\n    }\n    get pendingQueue() {\n        return this._pendingQueue;\n    }\n}\n//# sourceMappingURL=BaseWorker.js.map","import { BaseWorker } from \"../utils/BaseWorker\";\nexport const LOCK_UPDATE = -2;\nexport const LOCK_FREE = -1;\nclass LabelWorker extends BaseWorker {\n    constructor(numWorkers = 4) {\n        super(numWorkers, LABEL_PROGRAM);\n    }\n    _onMessage(e) {\n        let s = this._source.get(e.data.id);\n        if (s.label._lockId === LOCK_UPDATE) {\n            requestAnimationFrame(() => {\n                this.make({ handler: s.handler, label: s.label });\n            });\n        }\n        else {\n            s.handler.workerCallback(e.data, s.label);\n        }\n        this._source.delete(e.data.id);\n    }\n    make(data) {\n        let label = data.label, handler = data.handler;\n        if (handler._entityCollection) {\n            let labelData = label.serializeWorkerData(this._sourceId);\n            if (labelData) {\n                if (this._workerQueue.length) {\n                    let w = this._workerQueue.pop();\n                    this._source.set(this._sourceId, data);\n                    label._lockId = this._sourceId;\n                    this._sourceId++;\n                    w.postMessage({\n                        labelData: labelData\n                    }, [\n                        labelData.buffer,\n                    ]);\n                }\n                else {\n                    this._pendingQueue.push(data);\n                }\n            }\n        }\n    }\n}\nconst LABEL_PROGRAM = `'use strict';\n\n    function concatTypedArrays(dest, index, source) {\n        let len = source.length,\n            offset = index * len;\n        for(let i = 0; i < len; i++) {\n            dest[offset + i] = source[i];\n        }\n    }\n\n    self.onmessage = function (e) {\n        var labelData = e.data.labelData,\n            id = labelData[0],\n            maxLetters = labelData[1],\n            isVisible = labelData[2],\n            /*3, 4, 5*/_positionHigh_x = labelData[3], _positionHigh_y = labelData[4], _positionHigh_z = labelData[5],\n            /*6, 7, 8*/_positionLow_x = labelData[6], _positionLow_y = labelData[7], _positionLow_z = labelData[8],\n            /*9*/_size = labelData[9],\n            /*10, 11, 12*/_offset_x = labelData[10], _offset_y = labelData[11], _offset_z = labelData[12],\n            /*13, 14, 15, 16*/_color_x = labelData[13], _color_y = labelData[14], _color_z = labelData[15], _color_w = labelData[16],\n            /*17*/_rotation = labelData[17],\n            /*18, 19, 20*/_alignedAxis_x = labelData[18], _alignedAxis_y = labelData[19], _alignedAxis_z = labelData[20],\n            /*21*/_fontIndex = labelData[21],\n            /*22*/_outline = labelData[22],\n            /*23, 24, 25, 26*/_outlineColor_x = labelData[23], _outlineColor_y = labelData[24], _outlineColor_z = labelData[25], _outlineColor_w = labelData[26],\n            /*27, 28, 29*/_pickingColor_x = labelData[27], _pickingColor_y = labelData[28], _pickingColor_z = labelData[29]\n         \n\n        let _vertexArr = new Float32Array(maxLetters * 12),\n            _texCoordArr = new Float32Array(maxLetters * 24),\n            _gliphParamArr = new Float32Array(maxLetters * 24),\n            _positionHighArr = new Float32Array(maxLetters * 18),\n            _positionLowArr = new Float32Array(maxLetters * 18),\n            _sizeArr = new Float32Array(maxLetters * 6),\n            _offsetArr = new Float32Array(maxLetters * 18),\n            _rgbaArr = new Float32Array(maxLetters * 24),\n            _rotationArr = new Float32Array(maxLetters * 6),\n            _alignedAxisArr = new Float32Array(maxLetters * 18),\n            _fontIndexArr = new Float32Array(maxLetters * 6),\n            _outlineArr = new Float32Array(maxLetters * 6),\n            _outlineColorArr = new Float32Array(maxLetters * 24),\n            _pickingColorArr = new Float32Array(maxLetters * 18);\n        \n        for (let i = 0; i < maxLetters; i++) {\n            if (isVisible !== 0) {\n                concatTypedArrays(_vertexArr, i, [0, 0, 0, -1, 1, -1, 1, -1, 1, 0, 0, 0]);\n            } else {\n                concatTypedArrays(_vertexArr, i, [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n            }\n\n            concatTypedArrays(_texCoordArr, i, [0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0, 0, 0, -1, 0]);\n            concatTypedArrays(_gliphParamArr, i, [1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0, 1, 1, 0, 0]);\n\n            var x = _positionHigh_x, y = _positionHigh_y, z = _positionHigh_z, w;\n            concatTypedArrays(_positionHighArr, i, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n\n            x = _positionLow_x; y = _positionLow_y; z = _positionLow_z;\n            concatTypedArrays(_positionLowArr, i, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n\n            x = _size;\n            concatTypedArrays(_sizeArr, i, [x, x, x, x, x, x]);\n\n            x = _offset_x; y = _offset_y; z = _offset_z;\n            concatTypedArrays(_offsetArr, i, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n\n            x = _color_x; y = _color_y; z = _color_z; w = _color_w;\n            concatTypedArrays(_rgbaArr, i, [x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w]);\n\n            x = _rotation;\n            concatTypedArrays(_rotationArr, i, [x, x, x, x, x, x]);\n\n            x = _alignedAxis_x; y = _alignedAxis_y; z = _alignedAxis_z;\n            concatTypedArrays(_alignedAxisArr, i, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n\n            x = _fontIndex;\n            concatTypedArrays(_fontIndexArr, i, [x, x, x, x, x, x]);\n\n            x = _outline;\n            concatTypedArrays(_outlineArr, i, [x, x, x, x, x, x]);\n\n            x = _outlineColor_x; y = _outlineColor_y; z = _outlineColor_z; w = _outlineColor_w;\n            concatTypedArrays(_outlineColorArr, i, [x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w, x, y, z, w]);\n\n            x = _pickingColor_x / 255; y = _pickingColor_y / 255; z = _pickingColor_z / 255;\n            concatTypedArrays(_pickingColorArr, i, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n        }\n\n        self.postMessage({\n                id: id,\n                vertexArr: _vertexArr,\n                texCoordArr: _texCoordArr,\n                gliphParamArr: _gliphParamArr,\n                positionHighArr: _positionHighArr,\n                positionLowArr: _positionLowArr,\n                sizeArr: _sizeArr,\n                offsetArr: _offsetArr,\n                rgbaArr: _rgbaArr,\n                rotationArr: _rotationArr,\n                alignedAxisArr: _alignedAxisArr,\n                fontIndexArr: _fontIndexArr,\n                outlineArr: _outlineArr,\n                outlineColorArr: _outlineColorArr,\n                pickingColorArr: _pickingColorArr\n             }, [\n                    _vertexArr.buffer,\n                    _texCoordArr.buffer,\n                    _gliphParamArr.buffer,\n                    _positionHighArr.buffer,\n                    _positionLowArr.buffer,\n                    _sizeArr.buffer,\n                    _offsetArr.buffer,\n                    _rgbaArr.buffer,\n                    _rotationArr.buffer,\n                    _alignedAxisArr.buffer,\n                    _fontIndexArr.buffer,\n                    _outlineArr.buffer,\n                    _outlineColorArr.buffer,\n                    _pickingColorArr.buffer\n            ]);\n    }`;\nexport { LabelWorker };\n//# sourceMappingURL=LabelWorker.js.map","import * as utils from \"../utils/shared\";\nimport { LOCK_FREE, LOCK_UPDATE } from \"./LabelWorker\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Base prototype for billboard and label classes.\n * @class\n * @param {Object} [options] - Options:\n * @param {Vec3|Array.<number>} [options.position] - Billboard position.\n * @param {number} [options.rotation] - Screen angle rotation.\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\n * @param {boolean} [options.visibility] - Visibility.\n */\nclass BaseBillboard {\n    constructor(options = {}) {\n        this.__id = BaseBillboard.__counter__++;\n        this._position = utils.createVector3(options.position);\n        this._positionHigh = new Vec3();\n        this._positionLow = new Vec3();\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\n        this._rotation = options.rotation || 0;\n        this._color = utils.createColorRGBA(options.color);\n        this._alignedAxis = utils.createVector3(options.alignedAxis);\n        this._offset = utils.createVector3(options.offset);\n        this._visibility = options.visibility != undefined ? options.visibility : true;\n        this._entity = null;\n        this._handler = null;\n        this._handlerIndex = -1;\n        this._isReady = false;\n        this._lockId = LOCK_FREE;\n    }\n    /**\n     * Sets billboard position.\n     * @public\n     * @param {number} x - X coordinate.\n     * @param {number} y - Y coordinate.\n     * @param {number} z - Z coordinate.\n     */\n    setPosition(x, y, z) {\n        this._position.x = x;\n        this._position.y = y;\n        this._position.z = z;\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\n        if (this._isReady && this._handler) {\n            this._handler.setPositionArr(this._handlerIndex, this._positionHigh, this._positionLow);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Sets billboard position.\n     * @public\n     * @param {Vec3} position - Cartesian coordinates.\n     */\n    setPosition3v(position) {\n        this._position.x = position.x;\n        this._position.y = position.y;\n        this._position.z = position.z;\n        Vec3.doubleToTwoFloats(position, this._positionHigh, this._positionLow);\n        if (this._isReady && this._handler) {\n            this._handler.setPositionArr(this._handlerIndex, this._positionHigh, this._positionLow);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Returns billboard position.\n     * @public\n     * @returns {Vec3}\n     */\n    getPosition() {\n        return this._position;\n    }\n    /**\n     * Sets screen space offset.\n     * @public\n     * @param {number} x - X offset.\n     * @param {number} y - Y offset.\n     * @param {number} [z] - Z offset.\n     */\n    setOffset(x, y, z) {\n        this._offset.x = x;\n        this._offset.y = y;\n        z != undefined && (this._offset.z = z);\n        if (this._isReady && this._handler) {\n            this._handler.setOffsetArr(this._handlerIndex, this._offset);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Sets screen space offset.\n     * @public\n     * @param {Vec2} offset - Offset size.\n     */\n    setOffset3v(offset) {\n        this.setOffset(offset.x, offset.y, offset.z);\n    }\n    /**\n     * Returns billboard screen space offset size.\n     * @public\n     * @returns {Vec3}\n     */\n    getOffset() {\n        return this._offset;\n    }\n    /**\n     * Sets billboard screen space rotation in radians.\n     * @public\n     * @param {number} rotation - Screen space rotation in radians.\n     */\n    setRotation(rotation) {\n        if (rotation !== this._rotation) {\n            this._rotation = rotation;\n            if (this._isReady && this._handler) {\n                this._handler.setRotationArr(this._handlerIndex, rotation);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Gets screen space rotation.\n     * @public\n     * @returns {number}\n     */\n    getRotation() {\n        return this._rotation;\n    }\n    /**\n     * Sets billboard opacity.\n     * @public\n     * @param {number} a - Billboard opacity.\n     */\n    setOpacity(a) {\n        if (a !== this._color.w) {\n            a != undefined && (this._color.w = a);\n            if (this._isReady && this._handler) {\n                this._handler.setRgbaArr(this._handlerIndex, this._color);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Sets RGBA color. Each channel from 0.0 to 1.0.\n     * @public\n     * @param {number} r - Red.\n     * @param {number} g - Green.\n     * @param {number} b - Blue.\n     * @param {number} a - Alpha.\n     */\n    setColor(r, g, b, a) {\n        if (a !== this._color.w || r !== this._color.x || g !== this._color.y || this._color.z !== b) {\n            this._color.x = r;\n            this._color.y = g;\n            this._color.z = b;\n            a != undefined && (this._color.w = a);\n            if (this._isReady && this._handler) {\n                this._handler.setRgbaArr(this._handlerIndex, this._color);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Sets RGBA color. Each channel from 0.0 to 1.0.\n     * @public\n     * @param {Vec4} color - RGBA vector.\n     */\n    setColor4v(color) {\n        this.setColor(color.x, color.y, color.z, color.w);\n    }\n    /**\n     * Sets billboard color.\n     * @public\n     * @param {string} color - HTML style color.\n     */\n    setColorHTML(color) {\n        this.setColor4v(utils.htmlColorToRgba(color));\n    }\n    /**\n     * Returns RGBA color.\n     * @public\n     * @returns {Vec4}\n     */\n    getColor() {\n        return this._color;\n    }\n    /**\n     * Sets billboard visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            this._visibility = visibility;\n            if (this._isReady && this._handler) {\n                this._handler.setVisibility(this._handlerIndex, visibility);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Returns billboard visibility.\n     * @public\n     * @returns {boolean}\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Sets billboard cartesian aligned vector.\n     * @public\n     * @param {number} x - Aligned vector X coordinate.\n     * @param {number} y - Aligned vector Y coordinate.\n     * @param {number} z - Aligned vector Z coordinate.\n     */\n    setAlignedAxis(x, y, z) {\n        this._alignedAxis.x = x;\n        this._alignedAxis.y = y;\n        this._alignedAxis.z = z;\n        if (this._isReady && this._handler) {\n            this._handler.setAlignedAxisArr(this._handlerIndex, this._alignedAxis);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Sets billboard aligned vector.\n     * @public\n     * @param {Vec3} alignedAxis - Align direction.\n     */\n    setAlignedAxis3v(alignedAxis) {\n        this.setAlignedAxis(alignedAxis.x, alignedAxis.y, alignedAxis.z);\n    }\n    /**\n     * Returns aligned vector.\n     * @public\n     * @returns {Vec3}\n     */\n    getAlignedAxis() {\n        return this._alignedAxis;\n    }\n    /**\n     * Removes billboard from handler.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._handler && this._handler.remove(this);\n    }\n    /**\n     * Sets billboard picking color.\n     * @public\n     * @param {Vec3} color - Picking color.\n     */\n    setPickingColor3v(color) {\n        if (this._isReady && this._handler) {\n            this._handler.setPickingColorArr(this._handlerIndex, color);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    serializeWorkerData(workerId) {\n        if (this._handler) {\n            return new Float32Array([]);\n        }\n        return null;\n    }\n}\nBaseBillboard.__counter__ = 0;\nexport { BaseBillboard };\n//# sourceMappingURL=BaseBillboard.js.map","import { BaseBillboard } from \"./BaseBillboard\";\n/**\n * Represents basic quad billboard image.\n * @class\n * @extends {BaseBillboard}\n * @param {Object} [options] - Options:\n * @param {Vec3|Array.<number>} [options.position] - Billboard spatial position.\n * @param {number} [options.rotation] - Screen angle rotation.\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\n * @param {boolean} [options.visibility] - Visibility.\n * @param {string} [options.src] - Billboard image url source.\n * @param {Image} [options.image] - Billboard image object.\n * @param {number} [options.width] - Screen width.\n * @param {number} [options.height] - Screen height.\n * @param {number} [options.scale] - Billboard scale.\n */\nclass Billboard extends BaseBillboard {\n    constructor(options = {}) {\n        super(options);\n        this._handler = null;\n        this._src = options.src || null;\n        this._image = options.image || null;\n        this._scale = 1.0;\n        this._width = options.width || (options.size ? options.size[0] : 30);\n        this._height = options.height || (options.size ? options.size[1] : 30);\n    }\n    /**\n     * Sets billboard image url source.\n     * @public\n     * @param {string} src - Image url.\n     */\n    setSrc(src) {\n        this._src = src;\n        let bh = this._handler;\n        if (bh && src && src.length) {\n            let rn = bh._entityCollection.renderNode;\n            if (rn && rn.renderer) {\n                let ta = rn.renderer.billboardsTextureAtlas;\n                let that = this;\n                ta.loadImage(src, function (img) {\n                    if (img.__nodeIndex != undefined && ta.get(img.__nodeIndex)) {\n                        that._image = img;\n                        bh.setTexCoordArr(that._handlerIndex, ta.get(that._image.__nodeIndex).texCoords);\n                    }\n                    else {\n                        ta.addImage(img);\n                        ta.createTexture();\n                        that._image = img;\n                        rn.updateBillboardsTexCoords();\n                    }\n                });\n            }\n        }\n    }\n    getSrc() {\n        return this._src;\n    }\n    /**\n     * Sets image object.\n     * @public\n     * @param {Object} image - JavaScript image object.\n     */\n    setImage(image) {\n        this.setSrc(image.src);\n    }\n    getImage() {\n        return this._image;\n    }\n    /**\n     * Sets billboard screen size in pixels.\n     * @public\n     * @param {number} width - Billboard width.\n     * @param {number} height - Billboard height.\n     */\n    setSize(width, height) {\n        this._width = width;\n        this._height = height;\n        this._handler &&\n            this._handler.setSizeArr(this._handlerIndex, width * this._scale, height * this._scale);\n    }\n    /**\n     * Returns billboard screen size.\n     * @public\n     * @returns {Object}\n     */\n    getSize() {\n        return {\n            width: this._width,\n            height: this._height\n        };\n    }\n    /**\n     * Sets billboard screen width.\n     * @public\n     * @param {number} width - Width.\n     */\n    setWidth(width) {\n        this.setSize(width, this._height);\n    }\n    /**\n     * Gets billboard screen width.\n     * @public\n     * @returns {number}\n     */\n    getWidth() {\n        return this._width;\n    }\n    /**\n     * Sets billboard screen heigh.\n     * @public\n     * @param {number} height - Height.\n     */\n    setHeight(height) {\n        this.setSize(this._width, height);\n    }\n    /**\n     * Gets billboard screen height.\n     * @public\n     * @returns {number}\n     */\n    getHeight() {\n        return this._height;\n    }\n}\nexport { Billboard };\n//# sourceMappingURL=Billboard.js.map","import * as utils from \"../utils/shared\";\nimport { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { Vec4 } from \"../math/Vec4\";\nconst GeometryType = {\n    POINT: 1,\n    LINESTRING: 2,\n    POLYGON: 3,\n    MULTIPOLYGON: 4,\n    MULTILINESTRING: 5\n};\nclass Geometry {\n    constructor(options = {}) {\n        this.__id = Geometry.__counter__++;\n        this._entity = null;\n        this._handler = null;\n        this._handlerIndex = -1;\n        this._polyVerticesHighMerc = [];\n        this._polyVerticesLowMerc = [];\n        this._polyVerticesLength = -1;\n        this._polyIndexesLength = -1;\n        this._polyVerticesHandlerIndex = -1;\n        this._polyIndexesHandlerIndex = -1;\n        this._lineVerticesHighMerc = [];\n        this._lineVerticesLowMerc = [];\n        this._lineVerticesLength = -1;\n        this._lineOrdersLength = -1;\n        this._lineIndexesLength = -1;\n        this._lineColorsLength = -1;\n        this._lineThicknessLength = -1;\n        this._lineVerticesHandlerIndex = -1;\n        this._lineOrdersHandlerIndex = -1;\n        this._lineIndexesHandlerIndex = -1;\n        this._lineThicknessHandlerIndex = -1;\n        this._lineColorsHandlerIndex = -1;\n        this._type = (options.type && Geometry.getType(options.type)) || GeometryType.POINT;\n        this._coordinates = [];\n        this._extent = Geometry.getExtent({\n            type: options.type || \"Point\",\n            coordinates: options.coordinates || []\n        }, this._coordinates);\n        options.style = options.style || {};\n        this._style = {\n            fillColor: utils.createColorRGBA(options.style.fillColor, new Vec4(0.19, 0.62, 0.85, 0.4)),\n            lineColor: utils.createColorRGBA(options.style.lineColor, new Vec4(0.19, 0.62, 0.85, 1)),\n            strokeColor: utils.createColorRGBA(options.style.strokeColor, new Vec4(1, 1, 1, 0.95)),\n            lineWidth: options.style.lineWidth || 3,\n            strokeWidth: options.style.strokeWidth || 0\n        };\n        this._visibility = options.visibility || true;\n        // optimization flag for picking mask rendering pass\n        this._pickingReady = false;\n    }\n    get id() {\n        return this.__id;\n    }\n    get type() {\n        return this._type;\n    }\n    static getType(typeStr) {\n        return GeometryType[typeStr.toUpperCase()];\n    }\n    /**\n     * Returns geometry extent.\n     @static\n     @param {IGeometry} geometryObj - GeoJSON style geometry feature.\n     @param {IGeometryCoordinates} outCoordinates - Geometry feature coordinates clone.\n     @returns {Extent} -\n     */\n    static getExtent(geometryObj, outCoordinates) {\n        let res = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\n        let t = Geometry.getType(geometryObj.type);\n        if (t === GeometryType.POINT) {\n            let lon = geometryObj.coordinates[0], lat = geometryObj.coordinates[1];\n            res.southWest.lon = lon;\n            res.southWest.lat = lat;\n            res.northEast.lon = lon;\n            res.northEast.lat = lat;\n            outCoordinates && (outCoordinates[0] = lon) && (outCoordinates[1] = lat);\n        }\n        else if (t === GeometryType.LINESTRING) {\n            let c = geometryObj.coordinates;\n            for (let i = 0; i < c.length; i++) {\n                let lon = c[i][0], lat = c[i][1];\n                if (lon < res.southWest.lon)\n                    res.southWest.lon = lon;\n                if (lat < res.southWest.lat)\n                    res.southWest.lat = lat;\n                if (lon > res.northEast.lon)\n                    res.northEast.lon = lon;\n                if (lat > res.northEast.lat)\n                    res.northEast.lat = lat;\n                outCoordinates && (outCoordinates[i] = [lon, lat]);\n            }\n        }\n        else if (t === GeometryType.POLYGON) {\n            let c = geometryObj.coordinates;\n            for (let i = 0; i < c.length; i++) {\n                let ci = c[i];\n                outCoordinates && (outCoordinates[i] = []);\n                for (let j = 0; j < ci.length; j++) {\n                    let cij = ci[j];\n                    let lon = cij[0], lat = cij[1];\n                    if (lon < res.southWest.lon)\n                        res.southWest.lon = lon;\n                    if (lat < res.southWest.lat)\n                        res.southWest.lat = lat;\n                    if (lon > res.northEast.lon)\n                        res.northEast.lon = lon;\n                    if (lat > res.northEast.lat)\n                        res.northEast.lat = lat;\n                    outCoordinates && (outCoordinates[i][j] = [lon, lat]);\n                }\n            }\n        }\n        else if (t === GeometryType.MULTIPOLYGON) {\n            let p = geometryObj.coordinates;\n            for (let i = 0; i < p.length; i++) {\n                let pi = p[i];\n                outCoordinates && (outCoordinates[i] = []);\n                for (let j = 0; j < pi.length; j++) {\n                    let pij = pi[j];\n                    outCoordinates && (outCoordinates[i][j] = []);\n                    for (let k = 0; k < pij.length; k++) {\n                        let pijk = pij[k];\n                        let lon = pijk[0], lat = pijk[1];\n                        if (lon < res.southWest.lon)\n                            res.southWest.lon = lon;\n                        if (lat < res.southWest.lat)\n                            res.southWest.lat = lat;\n                        if (lon > res.northEast.lon)\n                            res.northEast.lon = lon;\n                        if (lat > res.northEast.lat)\n                            res.northEast.lat = lat;\n                        outCoordinates && (outCoordinates[i][j][k] = [lon, lat]);\n                    }\n                }\n            }\n        }\n        else if (t === GeometryType.MULTILINESTRING) {\n            let c = geometryObj.coordinates;\n            for (let i = 0; i < c.length; i++) {\n                let ci = c[i];\n                outCoordinates && (outCoordinates[i] = []);\n                for (let j = 0; j < ci.length; j++) {\n                    let cij = ci[j];\n                    let lon = cij[0], lat = cij[1];\n                    if (lon < res.southWest.lon)\n                        res.southWest.lon = lon;\n                    if (lat < res.southWest.lat)\n                        res.southWest.lat = lat;\n                    if (lon > res.northEast.lon)\n                        res.northEast.lon = lon;\n                    if (lat > res.northEast.lat)\n                        res.northEast.lat = lat;\n                    outCoordinates && (outCoordinates[i][j] = [lon, lat]);\n                }\n            }\n        }\n        else {\n            res.southWest.lon = res.southWest.lat = res.northEast.lon = res.northEast.lat = 0.0;\n            outCoordinates && (outCoordinates[0] = 0) && (outCoordinates[1] = 0);\n        }\n        return res;\n    }\n    /**\n     * @todo ASAP need test for this method\n     * @param geoJson\n     * @returns {Geometry}\n     */\n    setGeometry(geoJson) {\n        let h = this._handler;\n        if (h) {\n            this.remove();\n            this._type = Geometry.getType(geoJson.type || \"Point\");\n            this._extent = Geometry.getExtent(geoJson, this._coordinates);\n            h.add(this);\n        }\n        return this;\n    }\n    setFillColor(r, g, b, a = 1.0) {\n        let c = this._style.fillColor;\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\n            this._pickingReady = false;\n        }\n        c.x = r;\n        c.y = g;\n        c.z = b;\n        c.w = a;\n        this._handler && this._handler.setPolyColorArr(this, c);\n        return this;\n    }\n    overlaps(extent) {\n        return this._extent.overlaps(extent);\n    }\n    setFillColor4v(rgba) {\n        return this.setFillColor(rgba.x, rgba.y, rgba.z, rgba.w);\n    }\n    setStrokeColor(r, g, b, a = 1.0) {\n        let c = this._style.strokeColor;\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\n            this._pickingReady = false;\n        }\n        c.x = r;\n        c.y = g;\n        c.z = b;\n        c.w = a;\n        this._handler && this._handler.setLineStrokeColorArr(this, c);\n        return this;\n    }\n    setLineColor(r, g, b, a = 1.0) {\n        let c = this._style.lineColor;\n        if ((c.w === 0.0 && a !== 0.0) || (c.w !== 0.0 && a === 0.0)) {\n            this._pickingReady = false;\n        }\n        c.x = r;\n        c.y = g;\n        c.z = b;\n        c.w = a;\n        this._handler && this._handler.setLineColorArr(this, c);\n        return this;\n    }\n    setStrokeColor4v(rgba) {\n        return this.setStrokeColor(rgba.x, rgba.y, rgba.z, rgba.w);\n    }\n    setLineColor4v(rgba) {\n        return this.setLineColor(rgba.x, rgba.y, rgba.z, rgba.w);\n    }\n    setStrokeOpacity(opacity) {\n        let c = this._style.strokeColor;\n        c.w = opacity;\n        return this.setStrokeColor(c.x, c.y, c.z, opacity);\n    }\n    setLineOpacity(opacity) {\n        let c = this._style.lineColor;\n        c.w = opacity;\n        return this.setLineColor(c.x, c.y, c.z, opacity);\n    }\n    setStrokeWidth(width) {\n        this._style.strokeWidth = width;\n        this._pickingReady = false;\n        this._handler && this._handler.setLineStrokeArr(this, width);\n        return this;\n    }\n    bringToFront() {\n        this._handler && this._handler.bringToFront(this);\n        return this;\n    }\n    setLineWidth(width) {\n        this._style.lineWidth = width;\n        this._pickingReady = false;\n        this._handler && this._handler.setLineThicknessArr(this, width);\n        return this;\n    }\n    setFillOpacity(opacity) {\n        let c = this._style.fillColor;\n        if ((c.w === 0.0 && opacity !== 0.0) || (c.w !== 0.0 && opacity === 0.0)) {\n            this._pickingReady = false;\n        }\n        c.w = opacity;\n        this._handler && this._handler.setPolyColorArr(this, c);\n        return this;\n    }\n    setVisibility(visibility) {\n        this._visibility = visibility;\n        this._handler && this._handler.setGeometryVisibility(this);\n        return this;\n    }\n    getVisibility() {\n        return this._visibility;\n    }\n    remove() {\n        this._handler && this._handler.remove(this);\n    }\n    getExtent() {\n        return this._extent.clone();\n    }\n    getType() {\n        return this._type;\n    }\n}\nGeometry.__counter__ = 0;\nexport { Geometry, GeometryType };\n//# sourceMappingURL=Geometry.js.map","import { Vec2 } from './Vec2';\nexport class Line2 {\n    constructor(a = 0, b = 0, c = 0) {\n        this.a = a;\n        this.b = b;\n        this.c = c;\n    }\n    static get(p0, p1) {\n        return new Line2(p1.y - p0.y, p0.x - p1.x, p1.x * p0.y - p0.x * p1.y);\n    }\n    static getParallel(l, p) {\n        return new Line2(l.a, l.b, -l.a * p.x - l.b * p.y);\n    }\n    static getIntersection(L0, L1) {\n        let x = (L1.b * L0.c - L0.b * L1.c) / (L0.b * L1.a - L1.b * L0.a);\n        return new Vec2(x, -(L0.c + L0.a * x) / L0.b);\n    }\n    intersects(l) {\n        return Line2.getIntersection(this, l);\n    }\n}\n//# sourceMappingURL=Line2.js.map","import { EPS10 } from '../math';\nimport { Vec3 } from './Vec3';\n/**\n * @todo: write tests\n * @class Line3\n * Represents a line segment in 3d space.\n * @param {Vec3} [p0] - First point of the line\n * @param {Vec3} [p1] - Second point of the line\n */\nexport class Line3 {\n    constructor(p0, p1) {\n        this.p0 = p0 || new Vec3();\n        this.p1 = p1 || new Vec3();\n    }\n    getMagnitude() {\n        return this.p0.distance(this.p1);\n    }\n    getSphereIntersection(sphere) {\n        let p0 = this.p0, p1 = this.p1;\n        let cx = sphere.center.x, cy = sphere.center.y, cz = sphere.center.z;\n        let px = p0.x, py = p0.y, pz = p0.z;\n        let vx = p1.x - px, vy = p1.y - py, vz = p1.z - pz;\n        let A = vx * vx + vy * vy + vz * vz, B = 2.0 * (px * vx + py * vy + pz * vz - vx * cx - vy * cy - vz * cz), C = px * px - 2 * px * cx + cx * cx + py * py - 2 * py * cy + cy * cy +\n            pz * pz - 2 * pz * cz + cz * cz - sphere.radius * sphere.radius;\n        let D = B * B - 4 * A * C;\n        if (D < 0) {\n            // no solutions\n            return [];\n        }\n        let t1 = (-B - Math.sqrt(D)) / (2.0 * A);\n        let solution1 = new Vec3(p0.x * (1 - t1) + t1 * p1.x, p0.y * (1 - t1) + t1 * p1.y, p0.z * (1 - t1) + t1 * p1.z);\n        if (D == 0) {\n            return [solution1];\n        }\n        let t2 = (-B + Math.sqrt(D)) / (2.0 * A);\n        let solution2 = new Vec3(p0.x * (1 - t2) + t2 * p1.x, p0.y * (1 - t2) + t2 * p1.y, p0.z * (1 - t2) + t2 * p1.z);\n        // prefer a solution that's on the line segment itself\n        if (Math.abs(t1 - 0.5) < Math.abs(t2 - 0.5)) {\n            return [solution1, solution2];\n        }\n        return [solution2, solution1];\n    }\n    intersects(line, res, res2) {\n        let p13 = this.p0.sub(line.p0), p43 = line.p1.sub(line.p0);\n        if (Math.abs(p43.x) < EPS10 && Math.abs(p43.y) < EPS10 && Math.abs(p43.z) < EPS10) {\n            return false;\n        }\n        let p21 = this.p1.sub(this.p0);\n        if (Math.abs(p21.x) < EPS10 && Math.abs(p21.y) < EPS10 && Math.abs(p21.z) < EPS10) {\n            return false;\n        }\n        let d1343 = p13.x * p43.x + p13.y * p43.y + p13.z * p43.z, d4321 = p43.x * p21.x + p43.y * p21.y + p43.z * p21.z, d1321 = p13.x * p21.x + p13.y * p21.y + p13.z * p21.z, d4343 = p43.x * p43.x + p43.y * p43.y + p43.z * p43.z, d2121 = p21.x * p21.x + p21.y * p21.y + p21.z * p21.z;\n        let denom = d2121 * d4343 - d4321 * d4321;\n        if (Math.abs(denom) < EPS10) {\n            return false;\n        }\n        let numer = d1343 * d4321 - d1321 * d4343;\n        let mua = numer / denom;\n        res.x = this.p0.x + mua * p21.x;\n        res.y = this.p0.y + mua * p21.y;\n        res.z = this.p0.z + mua * p21.z;\n        if (res2) {\n            let mub = (d1343 + d4321 * mua) / d4343;\n            res2.x = line.p0.x + mub * p43.x;\n            res2.y = line.p0.y + mub * p43.y;\n            res2.z = line.p0.z + mub * p43.z;\n        }\n        return true;\n    }\n    getNearestDistancePoint(point, res) {\n        let p0 = this.p0, p1 = this.p1;\n        let mag = this.getMagnitude();\n        let u = (((point.x - p0.x) * (p1.x - p0.x)) +\n            ((point.y - p0.y) * (p1.y - p0.y)) +\n            ((point.z - p0.z) * (p1.z - p0.z))) /\n            (mag * mag);\n        res.x = p0.x + u * (p1.x - p0.x);\n        res.y = p0.y + u * (p1.y - p0.y);\n        res.z = p0.z + u * (p1.z - p0.z);\n        if (u < 0.0 || u > 1.0) {\n            return false;\n        }\n        return true;\n    }\n}\n//# sourceMappingURL=Line3.js.map","import { EPS10 } from \"../math\";\nimport { Vec3 } from \"./Vec3\";\n/**\n * Represents a ray that extends infinitely from the provided origin in the provided direction.\n * @class\n * @param {Vec3} origin - The origin of the ray.\n * @param {Vec3} direction - The direction of the ray.\n */\nexport class Ray {\n    constructor(origin = Vec3.ZERO, direction = Vec3.ZERO) {\n        this.origin = origin;\n        this.direction = direction;\n    }\n    /** @const */\n    static get OUTSIDE() {\n        return 0;\n    }\n    /** @const */\n    static get INSIDE() {\n        return 1;\n    }\n    /** @const */\n    static get INPLANE() {\n        return 2;\n    }\n    /** @const */\n    static get AWAY() {\n        return 3;\n    }\n    /**\n     * Sets a ray parameters.\n     * @public\n     * @param {Vec3} origin - The origin of the ray.\n     * @param {Vec3} direction - The direction of the ray.\n     * @returns {Ray}\n     */\n    set(origin, direction) {\n        this.origin = origin;\n        this.direction = direction;\n        return this;\n    }\n    /**\n     * Computes the point along the ray on the distance.\n     * @public\n     * @param {number} distance - Point distance.\n     * @returns {Vec3}\n     */\n    getPoint(distance) {\n        return Vec3.add(this.origin, this.direction.scaleTo(distance));\n    }\n    /**\n     * Returns ray hit a triange result.\n     * @public\n     * @param {Vec3} v0 - First triangle corner coordinate.\n     * @param {Vec3} v1 - Second triangle corner coordinate.\n     * @param {Vec3} v2 - Third triangle corner coordinate.\n     * @param {Vec3} res - Hit point object pointer that stores hit result.\n     * @returns {number} - Hit code, could 0 - og.Ray.OUTSIDE, 1 - og.Ray.INSIDE,\n     *      2 - og.Ray.INPLANE and 3 - og.Ray.AWAY(ray goes away from triangle).\n     */\n    hitTriangle(v0, v1, v2, res) {\n        let u = v1.sub(v0);\n        let v = v2.sub(v0);\n        let n = u.cross(v);\n        let w0 = this.origin.sub(v0);\n        let a = -n.dot(w0);\n        let b = n.dot(this.direction);\n        // ray is  parallel to triangle plane\n        if (Math.abs(b) < EPS10) {\n            if (a === 0) {\n                res.copy(this.origin);\n                // ray lies in triangle plane\n                return Ray.INPLANE;\n            }\n            else {\n                // ray disjoint from plane\n                return Ray.OUTSIDE;\n            }\n        }\n        let r = a / b;\n        // intersect point of ray and plane\n        res.copy(this.origin.add(this.direction.scaleTo(r)));\n        // ray goes away from triangle\n        if (r < 0.0) {\n            return Ray.AWAY;\n        }\n        // is res point inside the triangle?\n        let uu = u.dot(u);\n        let uv = u.dot(v);\n        let vv = v.dot(v);\n        let w = res.sub(v0);\n        let wu = w.dot(u);\n        let wv = w.dot(v);\n        let D = uv * uv - uu * vv;\n        let s = (uv * wv - vv * wu) / D;\n        if (s < 0.0 || s > 1.0) {\n            return Ray.OUTSIDE;\n        }\n        let t = (uv * wu - uu * wv) / D;\n        if (t < 0.0 || s + t > 1.0) {\n            return Ray.OUTSIDE;\n        }\n        return Ray.INSIDE;\n    }\n    /**\n     * Gets a ray hit a plane result. If the ray cross the plane returns 1 - og.Ray.INSIDE otherwise returns 0 - og.Ray.OUTSIDE.\n     * @public\n     * @param {Vec3} v0 - First plane point.\n     * @param {Vec3} v1 - Second plane point.\n     * @param {Vec3} v2 - Third plane point.\n     * @param {Vec3} res - Hit point object pointer that stores hit result.\n     * @returns {number}\n     */\n    hitPlane(v0, v1, v2, res) {\n        let u = Vec3.sub(v1, v0);\n        let v = Vec3.sub(v2, v0);\n        let n = u.cross(v);\n        let w0 = Vec3.sub(this.origin, v0);\n        let a = -n.dot(w0);\n        let b = n.dot(this.direction);\n        // ray is  parallel to the plane\n        if (Math.abs(b) < EPS10) {\n            if (a === 0) {\n                return Ray.OUTSIDE;\n            }\n        }\n        let r = a / b;\n        if (r < 0) {\n            return Ray.OUTSIDE;\n        }\n        let d = this.direction.scaleTo(r);\n        // intersect point of ray and plane\n        res.x = this.origin.x + d.x;\n        res.y = this.origin.y + d.y;\n        res.z = this.origin.z + d.z;\n        return Ray.INSIDE;\n    }\n    /**\n     * Returns a ray hit sphere coordiante. If there isn't hit returns null.\n     * @public\n     * @param {Sphere} sphere - Sphere object.\n     * @returns {Vec3}\n     */\n    hitSphere(sphere) {\n        let r = sphere.radius, c = sphere.center, o = this.origin, d = this.direction;\n        let vpc = Vec3.sub(c, o);\n        if (vpc.dot(d) < 0) {\n            var l = vpc.length();\n            if (l > r) {\n                return null;\n            }\n            else if (l === r) {\n                return o.clone();\n            }\n            let pc = c.projToRay(o, vpc);\n            var lc = Vec3.sub(pc, c).length();\n            let dist = Math.sqrt(r * r - lc * lc);\n            let di1 = dist - Vec3.sub(pc, o).length();\n            let intersection = Vec3.add(o, d.scaleTo(di1));\n            return intersection;\n        }\n        else {\n            let pc = c.projToRay(o, d);\n            var cpcl = Vec3.sub(c, pc).length();\n            if (cpcl > sphere.radius) {\n                return null;\n            }\n            else {\n                let dist = Math.sqrt(r * r - cpcl * cpcl);\n                let di1;\n                pc.subA(o);\n                if (vpc.length() > r) {\n                    di1 = pc.length() - dist;\n                }\n                else {\n                    di1 = pc.length() + dist;\n                }\n                let intersection = Vec3.add(o, d.scaleTo(di1));\n                return intersection;\n            }\n        }\n    }\n    hitBox(box) {\n        //\n        // TODO\n        //\n    }\n}\n//# sourceMappingURL=Ray.js.map","import * as utils from \"../utils/shared\";\nimport { Quat, Vec3 } from \"../math/index\";\n/**\n * @class\n * @param {Object} options -  Geo object parameters:\n * @param {Vec3} [options.position] - Geo object position.\n *\n * @todo: GeoObject and GeoObjectHandler provides instanced objects only.\n * It would be nice if it could provide not instanced rendering loop too.\n */\nclass GeoObject {\n    constructor(options) {\n        this._handlerIndex = -1;\n        this._tag = options.tag || \"none\";\n        this.instanced = true;\n        this._entity = null;\n        this._position = utils.createVector3(options.position);\n        this._positionHigh = new Vec3();\n        this._positionLow = new Vec3();\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\n        this._pitch = options.pitch || 0.0;\n        this._yaw = options.yaw || 0.0;\n        this._roll = options.roll || 0.0;\n        this._scale = options.scale || 1.0;\n        this._color = utils.createColorRGBA(options.color);\n        this._direction = new Vec3(0, 1, 0);\n        this._handler = null;\n        this._handlerIndex = -1;\n        this._tagData = null;\n        this._tagDataIndex = -1;\n        this._object3d = options.object3d;\n        this._visibility = true;\n        this._qNorthFrame = new Quat();\n    }\n    get tag() {\n        return this._tag;\n    }\n    getPosition() {\n        return this._position;\n    }\n    getPitch() {\n        return this._pitch;\n    }\n    getYaw() {\n        return this._yaw;\n    }\n    getRoll() {\n        return this._roll;\n    }\n    getDirection() {\n        return this._direction;\n    }\n    get object3d() {\n        return this._object3d;\n    }\n    get vertices() {\n        return this._object3d.vertices;\n    }\n    get normals() {\n        return this._object3d.normals;\n    }\n    get texCoords() {\n        return this._object3d.texCoords;\n    }\n    get indices() {\n        return this._object3d.indices;\n    }\n    /**\n     * Sets geo object opacity.\n     * @public\n     * @param {number} a - Billboard opacity.\n     */\n    setOpacity(a) {\n        this._color.w = a;\n        this.setColor(this._color.x, this._color.y, this._color.z, a);\n    }\n    /**\n     * Sets color.\n     * @public\n     * @param {number} r - Red.\n     * @param {number} g - Green.\n     * @param {number} b - Blue.\n     * @param {number} [a] - Alpha.\n     */\n    setColor(r, g, b, a) {\n        this._color.x = r;\n        this._color.y = g;\n        this._color.z = b;\n        a != undefined && (this._color.w = a);\n        this._handler && this._handler.setRgbaArr(this._tagData, this._tagDataIndex, this._color);\n    }\n    /**\n     * Sets color.\n     * @public\n     * @param {Vec3 | Vec4} color - RGBA vector.\n     */\n    setColor4v(color) {\n        this._color.x = color.x;\n        this._color.y = color.y;\n        this._color.z = color.z;\n        color.w != undefined && (this._color.w = color.w);\n        this._handler && this._handler.setRgbaArr(this._tagData, this._tagDataIndex, this._color);\n    }\n    /**\n     * Sets geo object visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        this._visibility = visibility;\n        this._handler && this._handler.setVisibility(this._tagData, this._tagDataIndex, visibility);\n    }\n    /**\n     * Returns geo object visibility.\n     * @public\n     * @returns {boolean}\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Sets geo object position.\n     * @public\n     * @param {number} x - X coordinate.\n     * @param {number} y - Y coordinate.\n     * @param {number} z - Z coordinate.\n     */\n    setPosition(x, y, z) {\n        this._position.x = x;\n        this._position.y = y;\n        this._position.z = z;\n        Vec3.doubleToTwoFloats(this._position, this._positionHigh, this._positionLow);\n        this._handler &&\n            this._handler.setPositionArr(this._tagData, this._tagDataIndex, this._positionHigh, this._positionLow);\n        this.updateDirection();\n    }\n    /**\n     * Sets geo object position.\n     * @public\n     * @param {Vec3} position - Cartesian coordinates.\n     */\n    setPosition3v(position) {\n        this._position.x = position.x;\n        this._position.y = position.y;\n        this._position.z = position.z;\n        Vec3.doubleToTwoFloats(position, this._positionHigh, this._positionLow);\n        this._handler && this._handler.setPositionArr(this._tagData, this._tagDataIndex, this._positionHigh, this._positionLow);\n        this.updateDirection();\n    }\n    setYaw(yaw) {\n        this._yaw = yaw;\n        this.updateDirection();\n    }\n    setPitch(pitch) {\n        this._pitch = pitch;\n        this._handler && this._handler.setPitchRollArr(this._tagData, this._tagDataIndex, pitch, this._roll);\n    }\n    setRoll(roll) {\n        this._roll = roll;\n        this._handler && this._handler.setPitchRollArr(this._tagData, this._tagDataIndex, this._pitch, roll);\n    }\n    setScale(scale) {\n        this._scale = scale;\n        this._handler && this._handler.setScaleArr(this._tagData, this._tagDataIndex, scale);\n    }\n    getScale() {\n        return this._scale;\n    }\n    /**\n     * Removes geo object from handler.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._handler && this._handler.remove(this);\n    }\n    /**\n     * Sets billboard picking color.\n     * @public\n     * @param {Vec3} color - Picking color.\n     */\n    setPickingColor3v(color) {\n        this._handler && this._handler.setPickingColorArr(this._tagData, this._tagDataIndex, color);\n    }\n    updateDirection() {\n        if (this._handler && this._handler._planet) {\n            this._qNorthFrame = this._handler._planet.getNorthFrameRotation(this._position);\n            let qq = Quat.yRotation(this._yaw).mul(this._qNorthFrame).conjugate();\n            this._direction = qq.mulVec3(new Vec3(0.0, 0.0, -1.0)).normalize();\n            this._handler.setDirectionArr(this._tagData, this._tagDataIndex, this._direction);\n        }\n    }\n}\nexport { GeoObject };\n//# sourceMappingURL=GeoObject.js.map","import * as utils from \"../utils/shared\";\nimport { BaseBillboard } from \"./BaseBillboard\";\nimport { LOCK_FREE, LOCK_UPDATE } from \"./LabelWorker\";\nimport { Vec4 } from \"../math/Vec4\";\nconst ALIGN = {\n    RIGHT: 0,\n    LEFT: 1,\n    CENTER: 2\n};\n/**\n * Text align options.\n * @readonly\n * @enum {number}\n */\nconst STR2ALIGN = {\n    left: ALIGN.LEFT,\n    right: ALIGN.RIGHT,\n    center: ALIGN.CENTER\n};\n/**\n * Billboard text label.\n * @class\n * @extends {BaseBillboard}\n * @param {Object} [options] - Label options:\n * @param {Vec3|Array.<number>} [options.position] - Billboard spatial position.\n * @param {number} [options.rotation] - Screen angle rotation.\n * @param {Vec4|string|Array.<number>} [options.color] - Billboard color.\n * @param {Vec3|Array.<number>} [options.alignedAxis] - Billboard aligned vector.\n * @param {Vec3|Array.<number>} [options.offset] - Billboard center screen offset.\n * @param {boolean} [options.visibility] - Visibility.\n * @param {string} [options.text] - Text string.\n * @param {string} [options.face] - HTML5 font face.\n * @param {number} [options.size] - Font size in pixels.\n * @param {string} [options.style] - HTML5 font style. Example 'normal', 'italic'.\n * @param {string} [options.weight] - HTML5 font weight. Example 'normal', 'bold'.\n * @param {number} [options.outline] - Text outline size. 0 - no outline, 1 - maximum outline. Default 0.58.\n * @param {Vec4|string|Array.<number>} [options.outlineColor] - Outline color.\n * @param {string} [options.align] - Text horizontal align: \"left\", \"right\" and \"center\".\n */\nclass Label extends BaseBillboard {\n    constructor(options = {}) {\n        super(options);\n        this._handler = null;\n        this._text = options.text || \"\";\n        this._face = utils.defaultString(options.face, \"arial\");\n        this._size = options.size || 24;\n        this._outline = options.outline != undefined ? options.outline : 0.0;\n        this._outlineColor = utils.createColorRGBA(options.outlineColor, new Vec4(0.0, 0.0, 0.0, 1.0));\n        this._align = options.align ? STR2ALIGN[options.align.trim().toLowerCase()] || ALIGN.RIGHT : ALIGN.RIGHT;\n        this._fontIndex = 0;\n        this._fontAtlas = null;\n        this._isRTL = options.isRTL || false;\n    }\n    /**\n     * Set label text.\n     * @public\n     * @param {string} text - Text string.\n     * It can't be bigger than maximum labelHandler _maxLetters value.\n     */\n    setText(text) {\n        this._text = text.toString();\n        if (this._isReady && this._handler) {\n            this._handler.setText(this._handlerIndex, text, this._fontIndex, this._align, this._isRTL);\n        }\n    }\n    /**\n     * Gets current text string.\n     * @public\n     * @returns {string}\n     */\n    getText() {\n        return this._text;\n    }\n    /**\n     * Sets label text align. Could be center, left or right. Left is default.\n     * @public\n     * @param {string} align - Text align.\n     */\n    setAlign(align) {\n        this._align = STR2ALIGN[align.trim().toLowerCase()];\n        if (this._isReady && this._handler) {\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, this._isRTL);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Gets label text current alignment.\n     * @public\n     * @returns {string}\n     */\n    getAlign() {\n        return this._align;\n    }\n    /**\n     * Sets font face family.\n     * @public\n     * @param {string} face - Font face family.\n     */\n    setFace(face) {\n        this._face = face.trim();\n        this.update();\n    }\n    /**\n     * Gets current font face.\n     * @public\n     * @returns {string}\n     */\n    getFace() {\n        return this._face;\n    }\n    /**\n     * Sets label font size in pixels.\n     * @public\n     * @param {number} size - Label size in pixels.\n     */\n    setSize(size) {\n        if (size !== this._size) {\n            this._size = size;\n            if (this._isReady && this._handler) {\n                this._handler.setSizeArr(this._handlerIndex, size);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Gets label size in pixels.\n     * @public\n     * @returns {number}\n     */\n    getSize() {\n        return this._size;\n    }\n    /**\n     * Sets text outline border size. Where 0 - is no outline, and 1 - is the maximum outline size.\n     * @public\n     * @param {number} outline - Text outline size.\n     */\n    setOutline(outline) {\n        this._outline = outline;\n        if (this._isReady && this._handler) {\n            this._handler.setOutlineArr(this._handlerIndex, outline);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Gets text current outline size.\n     * @public\n     * @returns {number}\n     */\n    getOutline() {\n        return this._outline;\n    }\n    /**\n     * Sets label opacity.\n     * @public\n     * @param {number} a - Label opacity.\n     */\n    setOpacity(a) {\n        super.setOpacity(a);\n        this.setOutlineOpacity(a);\n    }\n    /**\n     * Sets text outline color.\n     * @public\n     * @param {number} r - Red.\n     * @param {number} g - Green.\n     * @param {number} b - Blue.\n     * @param {number} a - Alpha.\n     */\n    setOutlineColor(r, g, b, a) {\n        if (a !== this._outlineColor.w || r !== this._outlineColor.x || g !== this._outlineColor.y || b !== this._outlineColor.z) {\n            this._outlineColor.x = r;\n            this._outlineColor.y = g;\n            this._outlineColor.z = b;\n            this._outlineColor.w = a;\n            if (this._isReady && this._handler) {\n                this._handler.setOutlineColorArr(this._handlerIndex, this._outlineColor);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Sets text outline color.\n     * @public\n     * @param {Vec4} rgba - Color vector.\n     */\n    setOutlineColor4v(rgba) {\n        this.setOutlineColor(rgba.x, rgba.y, rgba.z, rgba.w);\n    }\n    /**\n     * Sets text outline color HTML string.\n     * @public\n     * @param {string} color - HTML string color.\n     */\n    setOutlineColorHTML(color) {\n        this.setOutlineColor4v(utils.htmlColorToRgba(color));\n    }\n    /**\n     * Gets outline color vector.\n     * @public\n     * @returns {Vec4}\n     */\n    getOutlineColor() {\n        return this._outlineColor;\n    }\n    /**\n     * Sets outline opacity. Actually outline color alpha value.\n     * @public\n     * @param {number} opacity - Outline opacity.\n     */\n    setOutlineOpacity(opacity) {\n        if (opacity !== this._outlineColor.w) {\n            this._outlineColor.w = opacity;\n            if (this._isReady && this._handler) {\n                this._handler.setOutlineColorArr(this._handlerIndex, this._outlineColor);\n            }\n            else if (this._lockId !== LOCK_FREE) {\n                this._lockId = LOCK_UPDATE;\n            }\n        }\n    }\n    /**\n     * Gets outline opacity value.\n     * @public\n     * @returns {number}\n     */\n    getOutlineOpacity() {\n        return this._outlineColor.w;\n    }\n    /**\n     * Updates label parameters.\n     * @public\n     */\n    async update() {\n        if (this._fontAtlas) {\n            const fontIndex = await this._fontAtlas.getFontIndex(this._face);\n            this._applyFontIndex(fontIndex);\n        }\n    }\n    _applyFontIndex(fontIndex) {\n        this._fontIndex = fontIndex;\n        if (this._isReady && this._handler) {\n            this._handler.setFontIndexArr(this._handlerIndex, this._fontIndex);\n            this._handler.setText(this._handlerIndex, this._text, this._fontIndex, this._align, this._isRTL);\n        }\n        else if (this._lockId !== LOCK_FREE) {\n            this._lockId = LOCK_UPDATE;\n        }\n    }\n    /**\n     * Assigns font atlas and update.\n     * @public\n     * @param {FontAtlas} fontAtlas - Font atlas.\n     */\n    assignFontAtlas(fontAtlas) {\n        if (!this._fontAtlas) {\n            this._fontAtlas = fontAtlas;\n        }\n        this.update();\n    }\n    serializeWorkerData(workerId) {\n        if (this._handler) {\n            return new Float32Array([\n                /*0*/ workerId,\n                /*1*/ this._handler._maxLetters,\n                /*2*/ this.getVisibility() ? 1 : 0,\n                /*3, 4, 5*/ this._positionHigh.x, this._positionHigh.y, this._positionHigh.z,\n                /*6, 7, 8*/ this._positionLow.x, this._positionLow.y, this._positionLow.z,\n                /*9*/ this._size,\n                /*10, 11, 12*/ this._offset.x, this._offset.y, this._offset.z,\n                /*13, 14, 15, 16*/ this._color.x, this._color.y, this._color.z, this._color.w,\n                /*17*/ this._rotation,\n                /*18, 19, 20*/ this._alignedAxis.x, this._alignedAxis.y, this._alignedAxis.z,\n                /*21*/ this._fontIndex,\n                /*22*/ this._outline,\n                /*23, 24, 25, 26*/ this._outlineColor.x, this._outlineColor.y, this._outlineColor.z, this._outlineColor.w,\n                /*27, 28, 29*/ this._entity._pickingColor.x, this._entity._pickingColor.y, this._entity._pickingColor.z\n            ]);\n        }\n        return null;\n    }\n}\nexport { Label, ALIGN };\n//# sourceMappingURL=Label.js.map","import { Vec3 } from \"../math/Vec3\";\nimport { Vec4 } from \"../math/Vec4\";\nconst COORDINATES_BUFFER = 0;\nconst COLOR_BUFFER = 1;\nconst PICKING_COLOR_BUFFER = 2;\n/**\n * PointCloud object.\n * @class\n * @param {*} [options] - Point cloud options:\n * @param {Array.<Array.<number>>} [options.points] - Points cartesian coordinates array,\n * where first three is cartesian coordinates, next fourth is an RGBA color, and last is a point properties.\n * @param {number} [options.pointSize] - Point screen size in pixels.\n * @param {number} [options.pickingScale] - Point border picking size in screen pixels.\n * @param {boolean} [options.visibility] - Point cloud visibility.\n * @example <caption>Creates point cloud with two ten pixel size points</caption>\n * new og.Entity({\n *     pointCloud: {\n *         pointSize: 10,\n *         points: [\n *             [0, 0, 0, 255, 255, 255, 255, { 'name': 'White point' }],\n *             [100, 100, 0, 255, 0, 0, 255, { 'name': 'Red point' }]\n *         ]\n *     }\n * });\n */\nclass PointCloud {\n    constructor(options = {}) {\n        this.__id = PointCloud.__counter__++;\n        /**\n         * Cloud visibility.\n         * @public\n         * @type {boolean}\n         */\n        this.visibility = options.visibility != undefined ? options.visibility : true;\n        /**\n         * Point screen size in pixels.\n         * @public\n         * @type {number}\n         */\n        this.pointSize = options.pointSize || 3;\n        /**\n         * Point picking border size in pixels.\n         * @public\n         * @type {number}\n         */\n        this.pickingScale = options.pickingScale || 0;\n        /**\n         * Parent collection render node.\n         * @private\n         * @type {RenderNode}\n         */\n        this._renderNode = null;\n        /**\n         * Entity instance that holds this point cloud.\n         * @private\n         * @type {Entity}\n         */\n        this._entity = null;\n        /**\n         * Points properties.\n         * @private\n         * @type {IPoint[]}\n         */\n        this._points = [];\n        /**\n         * Coordinates array.\n         * @private\n         * @type {Array.<number>}\n         */\n        this._coordinatesData = [];\n        /**\n         * Color array.\n         * @private\n         * @type {Array.<number>}\n         */\n        this._colorData = [];\n        /**\n         * Picking color array.\n         * @private\n         * @type {Array.<number>}\n         */\n        this._pickingColorData = [];\n        this._coordinatesBuffer = null;\n        this._colorBuffer = null;\n        this._pickingColorBuffer = null;\n        /**\n         * Handler that stores and renders this object.\n         * @private\n         * @type {PointCloudHandler}\n         */\n        this._handler = null;\n        this._handlerIndex = -1;\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[COORDINATES_BUFFER] = this._createCoordinatesBuffer;\n        this._buffersUpdateCallbacks[COLOR_BUFFER] = this._createColorBuffer;\n        this._buffersUpdateCallbacks[PICKING_COLOR_BUFFER] = this._createPickingColorBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n        if (options.points) {\n            this.setPoints(options.points);\n        }\n    }\n    /**\n     * Clears point cloud data\n     * @public\n     */\n    clear() {\n        this._points.length = 0;\n        this._points = [];\n        this._coordinatesData.length = 0;\n        this._coordinatesData = [];\n        this._colorData.length = 0;\n        this._colorData = [];\n        this._pickingColorData.length = 0;\n        this._pickingColorData = [];\n        this._deleteBuffers();\n    }\n    /**\n     * Sets cloud visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        this.visibility = visibility;\n    }\n    /**\n     * @return {boolean} Point cloud visibility.\n     */\n    getVisibility() {\n        return this.visibility;\n    }\n    /**\n     * Assign rendering scene node.\n     * @public\n     * @param {RenderNode}  renderNode - Assigned render node.\n     */\n    setRenderNode(renderNode) {\n        this._renderNode = renderNode;\n        this._setPickingColors();\n    }\n    /**\n     * Removes from entity.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._handler && this._handler.remove(this);\n    }\n    /**\n     * Adds points to render.\n     * @public\n     * @param { Poi[]} points - Point cloud array.\n     * @example\n     * var points = [[0, 0, 0, 255, 255, 255, 255, { 'name': 'White point' }], [100, 100, 0, 255, 0, 0, 255, { 'name': 'Red point' }]];\n     */\n    setPoints(points) {\n        this.clear();\n        for (let i = 0; i < points.length; i++) {\n            let pi = points[i];\n            let pos = new Vec3(pi[0], pi[1], pi[2]), col = new Vec4(pi[3], pi[4], pi[5], pi[6] == undefined ? 255.0 : pi[6]);\n            this._coordinatesData.push(pos.x, pos.y, pos.z);\n            this._colorData.push(col.x / 255.0, col.y / 255.0, col.z / 255.0, col.w / 255.0);\n            let p = {\n                _entity: this._entity,\n                _pickingColor: new Vec3(),\n                _entityCollection: this._entity ? this._entity._entityCollection : null,\n                index: i,\n                position: pos,\n                color: col,\n                pointCloud: this,\n                properties: pi[7] || {}\n            };\n            this._points.push(p);\n            if (this._renderNode && this._renderNode.renderer) {\n                this._renderNode.renderer.assignPickingColor(p);\n                this._pickingColorData.push(p._pickingColor.x / 255.0, p._pickingColor.y / 255.0, p._pickingColor.z / 255.0, 1.0);\n            }\n        }\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n        this._changedBuffers[COLOR_BUFFER] = true;\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n    }\n    setPointPosition(index, x, y, z) {\n        // TODO: ...\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n    }\n    setPointColor(index, r, g, b, a) {\n        // TODO: ...\n        this._changedBuffers[COLOR_BUFFER] = true;\n    }\n    addPoints(points) {\n        // TODO: ...\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n        this._changedBuffers[COLOR_BUFFER] = true;\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n    }\n    addPoint(index, point) {\n        // TODO: ...\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n        this._changedBuffers[COLOR_BUFFER] = true;\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n    }\n    /**\n     * Returns specific point by index.\n     * @public\n     * @param {number} index - Point index.\n     * @return {Poi} Specific point\n     */\n    getPoint(index) {\n        return this._points[index];\n    }\n    removePoint(index) {\n        // TODO: ...\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n        this._changedBuffers[COLOR_BUFFER] = true;\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n    }\n    insertPoint(index, point) {\n        // TODO: ...\n        this._changedBuffers[COORDINATES_BUFFER] = true;\n        this._changedBuffers[COLOR_BUFFER] = true;\n        this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n    }\n    draw() {\n        if (this.visibility && this._coordinatesData.length) {\n            this._update();\n            let rn = this._renderNode;\n            let r = rn.renderer;\n            let sh = r.handler.programs.pointCloud;\n            let p = sh._program;\n            let gl = r.handler.gl, sha = p.attributes, shu = p.uniforms;\n            // gl.polygonOffset(\n            //     this._handler._entityCollection.polygonOffsetFactor,\n            //     this._handler._entityCollection.polygonOffsetUnits\n            // );\n            sh.activate();\n            gl.uniformMatrix4fv(shu.projectionViewMatrix, false, r.activeCamera.getProjectionViewMatrix());\n            gl.uniform1f(shu.opacity, this._handler._entityCollection._fadingOpacity);\n            gl.uniform1f(shu.pointSize, this.pointSize);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._coordinatesBuffer);\n            gl.vertexAttribPointer(sha.coordinates, this._coordinatesBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._colorBuffer);\n            gl.vertexAttribPointer(sha.colors, this._colorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.drawArrays(gl.POINTS, 0, this._coordinatesBuffer.numItems);\n        }\n    }\n    drawPicking() {\n        if (this.visibility && this._coordinatesData.length) {\n            let rn = this._renderNode;\n            let r = rn.renderer;\n            let sh = r.handler.programs.pointCloud;\n            let p = sh._program;\n            let gl = r.handler.gl, sha = p.attributes, shu = p.uniforms;\n            sh.activate();\n            // gl.polygonOffset(\n            //     this._handler._entityCollection.polygonOffsetFactor,\n            //     this._handler._entityCollection.polygonOffsetUnits\n            // );\n            gl.uniformMatrix4fv(shu.projectionViewMatrix, false, r.activeCamera.getProjectionViewMatrix());\n            gl.uniform1f(shu.opacity, this._handler._entityCollection._fadingOpacity);\n            gl.uniform1f(shu.pointSize, this.pointSize + this.pickingScale);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._coordinatesBuffer);\n            gl.vertexAttribPointer(sha.coordinates, this._coordinatesBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer);\n            gl.vertexAttribPointer(sha.colors, this._pickingColorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.drawArrays(gl.POINTS, 0, this._coordinatesBuffer.numItems);\n        }\n    }\n    /**\n     * Update gl buffers.\n     * @protected\n     */\n    _update() {\n        if (this._renderNode) {\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n        }\n    }\n    /**\n     * Delete buffers\n     * @public\n     */\n    _deleteBuffers() {\n        if (this._renderNode) {\n            let r = this._renderNode.renderer, gl = r.handler.gl;\n            gl.deleteBuffer(this._coordinatesBuffer);\n            gl.deleteBuffer(this._colorBuffer);\n            gl.deleteBuffer(this._pickingColorBuffer);\n        }\n        this._coordinatesBuffer = null;\n        this._colorBuffer = null;\n        this._pickingColorBuffer = null;\n    }\n    _createCoordinatesBuffer() {\n        let h = this._renderNode.renderer.handler;\n        h.gl.deleteBuffer(this._coordinatesBuffer);\n        this._coordinatesBuffer = h.createArrayBuffer(new Float32Array(this._coordinatesData), 3, this._coordinatesData.length / 3);\n    }\n    _createColorBuffer() {\n        let h = this._renderNode.renderer.handler;\n        h.gl.deleteBuffer(this._colorBuffer);\n        this._colorBuffer = h.createArrayBuffer(new Float32Array(this._colorData), 4, this._colorData.length / 4);\n    }\n    _createPickingColorBuffer() {\n        let h = this._renderNode.renderer.handler;\n        h.gl.deleteBuffer(this._pickingColorBuffer);\n        this._pickingColorBuffer = h.createArrayBuffer(new Float32Array(this._pickingColorData), 4, this._pickingColorData.length / 4);\n    }\n    _setPickingColors() {\n        if (this._renderNode && this._renderNode.renderer) {\n            for (let i = 0; i < this._points.length; i++) {\n                let p = this._points[i];\n                p._entity = this._entity;\n                p._entityCollection = this._entity._entityCollection;\n                this._renderNode.renderer.assignPickingColor(p);\n                this._pickingColorData.push(p._pickingColor.x / 255.0, p._pickingColor.y / 255.0, p._pickingColor.z / 255.0, 1.0);\n            }\n            this._changedBuffers[PICKING_COLOR_BUFFER] = true;\n        }\n    }\n}\nPointCloud.__counter__ = 0;\nexport { PointCloud };\n//# sourceMappingURL=PointCloud.js.map","import { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { cloneArray, htmlColorToFloat32Array, htmlColorToRgba, makeArray, makeArrayTyped } from \"../utils/shared\";\nconst VERTICES_BUFFER = 0;\nconst INDEX_BUFFER = 1;\nconst COLORS_BUFFER = 2;\nconst DEFAULT_COLOR = \"#0000FF\";\nconst R = 0;\nconst G = 1;\nconst B = 2;\nconst A = 3;\n/**\n * Polyline object.\n * @class\n * @param {Object} [options] - Polyline options:\n * @param {number} [options.thickness] - Thickness in screen pixels 1.5 is default.\n * @param {Number} [options.altitude] - Relative to ground layers altitude value.\n * @param {Vec4} [options.color] - RGBA color.\n * @param {Boolean} [options.opacity] - Line opacity.\n * @param {Boolean} [options.visibility] - Polyline visibility. True default.\n * @param {Boolean} [options.isClosed] - Closed geometry type identification.\n * @param {SegmentPathLonLatExt[]} [options.pathLonLat] - Polyline geodetic coordinates array. [[[0,0,0], [1,1,1],...]]\n * @param {SegmentPath3vExt[]} [options.path3v] - LinesString cartesian coordinates array. [[[0,0,0], [1,1,1],...]]\n * @param {SegmentPathColor[]} [options.pathColors] - Coordinates color. [[[1,0,0,1], [0,1,0,1],...]] for right and green colors.\n */\nclass Polyline {\n    constructor(options = {}) {\n        this.__id = Polyline.__counter__++;\n        this.altitude = options.altitude || 0.0;\n        this.thickness = options.thickness || 1.5;\n        this._opacity = options.opacity != undefined ? options.opacity : 1.0;\n        this._defaultColor = htmlColorToFloat32Array(options.color || DEFAULT_COLOR, options.opacity);\n        this.visibility = options.visibility != undefined ? options.visibility : true;\n        this._closedLine = options.isClosed || false;\n        this._path3v = [];\n        this._pathLengths = [];\n        this._pathLonLat = [];\n        this._pathLonLatMerc = [];\n        this._pathColors = options.pathColors ? cloneArray(options.pathColors) : [];\n        this._extent = new Extent();\n        this._verticesHigh = [];\n        this._verticesLow = [];\n        this._orders = [];\n        this._indexes = [];\n        this._colors = [];\n        this._verticesHighBuffer = null;\n        this._verticesLowBuffer = null;\n        this._ordersBuffer = null;\n        this._indexesBuffer = null;\n        this._colorsBuffer = null;\n        this._pickingColor = [0, 0, 0];\n        this._renderNode = null;\n        this._entity = null;\n        this._handler = null;\n        this._handlerIndex = -1;\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[VERTICES_BUFFER] = this._createVerticesBuffer;\n        this._buffersUpdateCallbacks[INDEX_BUFFER] = this._createIndexBuffer;\n        this._buffersUpdateCallbacks[COLORS_BUFFER] = this._createColorsBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n        // create path\n        if (options.pathLonLat) {\n            this.setPathLonLat(options.pathLonLat);\n        }\n        else if (options.path3v) {\n            this.setPath3v(options.path3v);\n        }\n        this._refresh();\n    }\n    /**\n     * Appends to the line array new cartesian coordinates line data.\n     * @static\n     */\n    static appendLineData3v(path3v, pathColors, defaultColor, isClosed, outVerticesHigh, outVerticesLow, outOrders, outIndexes, ellipsoid, outTransformedPathLonLat, outPath3v, outTransformedPathMerc, outExtent, outColors) {\n        var index = 0;\n        var v_high = new Vec3(), v_low = new Vec3();\n        if (outExtent) {\n            outExtent.southWest.set(180.0, 90.0);\n            outExtent.northEast.set(-180.0, -90.0);\n        }\n        if (outIndexes.length > 0) {\n            index = outIndexes[outIndexes.length - 5] + 9;\n            outIndexes.push(index, index);\n        }\n        else {\n            outIndexes.push(0, 0);\n        }\n        for (let j = 0, len = path3v.length; j < len; j++) {\n            var path = path3v[j], pathColors_j = pathColors[j];\n            outTransformedPathLonLat[j] = [];\n            outTransformedPathMerc[j] = [];\n            outPath3v[j] = [];\n            if (path.length === 0) {\n                continue;\n            }\n            var startIndex = index;\n            var last;\n            if (isClosed) {\n                last = path[path.length - 1];\n                if (last instanceof Array) {\n                    last = new Vec3(last[0], last[1], last[2]);\n                }\n            }\n            else {\n                var p0 = path[0], p1 = path[1] || p0;\n                if (p0 instanceof Array) {\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\n                }\n                if (p1 instanceof Array) {\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\n                }\n                p0 = p0;\n                p1 = p1;\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            }\n            let color = defaultColor;\n            if (pathColors_j && pathColors_j[0]) {\n                color = pathColors_j[0];\n            }\n            Vec3.doubleToTwoFloats(last, v_high, v_low);\n            outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n            outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n            let r = color[R], g = color[G], b = color[B], a = color[A] != undefined ? color[A] : 1.0;\n            if (j > 0) {\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n            }\n            outOrders.push(1, -1, 2, -2);\n            for (let i = 0, len = path.length; i < len; i++) {\n                var cur = path[i];\n                if (cur instanceof Array) {\n                    cur = new Vec3(cur[0], cur[1], cur[2]);\n                }\n                outPath3v[j].push(cur);\n                if (ellipsoid) {\n                    var lonLat = ellipsoid.cartesianToLonLat(cur);\n                    outTransformedPathLonLat[j].push(lonLat);\n                    outTransformedPathMerc[j].push(lonLat.forwardMercator());\n                    if (lonLat.lon < outExtent.southWest.lon) {\n                        outExtent.southWest.lon = lonLat.lon;\n                    }\n                    if (lonLat.lat < outExtent.southWest.lat) {\n                        outExtent.southWest.lat = lonLat.lat;\n                    }\n                    if (lonLat.lon > outExtent.northEast.lon) {\n                        outExtent.northEast.lon = lonLat.lon;\n                    }\n                    if (lonLat.lat > outExtent.northEast.lat) {\n                        outExtent.northEast.lat = lonLat.lat;\n                    }\n                }\n                if (pathColors_j && pathColors_j[i]) {\n                    color = pathColors_j[i];\n                }\n                r = color[R];\n                g = color[G];\n                b = color[B];\n                a = color[A] != undefined ? color[A] : 1.0;\n                Vec3.doubleToTwoFloats(cur, v_high, v_low);\n                outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n                outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n                outOrders.push(1, -1, 2, -2);\n                outIndexes.push(index++, index++, index++, index++);\n            }\n            var first;\n            if (isClosed) {\n                first = path[0];\n                if (first instanceof Array) {\n                    first = new Vec3(first[0], first[1], first[2]);\n                }\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\n            }\n            else {\n                let p0 = path[path.length - 1], p1 = path[path.length - 2] || p0;\n                if (p0 instanceof Array) {\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\n                }\n                else {\n                    p0 = p0;\n                }\n                if (p1 instanceof Array) {\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\n                }\n                else {\n                    p1 = p1;\n                }\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\n            }\n            if (pathColors_j && pathColors_j[path.length - 1]) {\n                color = pathColors_j[path.length - 1];\n            }\n            r = color[R];\n            g = color[G];\n            b = color[B];\n            a = color[A] != undefined ? color[A] : 1.0;\n            Vec3.doubleToTwoFloats(first, v_high, v_low);\n            outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n            outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n            outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n            outOrders.push(1, -1, 2, -2);\n            if (j < path3v.length - 1 && path3v[j + 1].length !== 0) {\n                index += 8;\n                outIndexes.push(index, index);\n            }\n        }\n    }\n    /**\n     * Appends to the line new cartesian coordinates point data.\n     * @static\n     */\n    static appendPoint3v(path3v, point3v, pathColors, color, isClosed, outVerticesHigh, outVerticesLow, outColors, outOrders, outIndexes, ellipsoid, outTransformedPathLonLat, outTransformedPathMerc, outExtent) {\n        var v_high = new Vec3(), v_low = new Vec3();\n        var ii = outIndexes.length - 4, index = outIndexes[ii - 1] + 1;\n        if (path3v.length === 0) {\n            path3v.push([]);\n            if (!pathColors[0]) {\n                pathColors[0] = [];\n            }\n        }\n        else if (!pathColors[path3v.length - 1]) {\n            pathColors[path3v.length - 1] = [];\n        }\n        var path = path3v[path3v.length - 1], len = path.length;\n        path.push(point3v);\n        let r = color[R], g = color[G], b = color[B], a = color[A] != undefined ? color[A] : 1.0, pathColors_last = pathColors[path3v.length - 1];\n        if (pathColors_last[len]) {\n            pathColors_last[len][R] = r;\n            pathColors_last[len][G] = g;\n            pathColors_last[len][B] = b;\n            pathColors_last[len][A] = a;\n        }\n        else {\n            pathColors_last.push(color);\n        }\n        if (len === 1) {\n            var last;\n            if (isClosed) {\n                last = path[len - 1];\n                if (last instanceof Array) {\n                    last = new Vec3(last[0], last[1], last[2]);\n                }\n            }\n            else {\n                let p0 = path[0], p1 = path[1] || p0;\n                if (p0 instanceof Array) {\n                    p0 = new Vec3(p0[0], p0[1], p0[2]);\n                }\n                else {\n                    p0 = p0;\n                }\n                if (p1 instanceof Array) {\n                    p1 = new Vec3(p1[0], p1[1], p1[2]);\n                }\n                else {\n                    p1 = p1;\n                }\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            }\n            Vec3.doubleToTwoFloats(last, v_high, v_low);\n            let vi = outVerticesHigh.length - 3 * 12;\n            outVerticesHigh[vi] = v_high.x;\n            outVerticesHigh[vi + 1] = v_high.y;\n            outVerticesHigh[vi + 2] = v_high.z;\n            outVerticesHigh[vi + 3] = v_high.x;\n            outVerticesHigh[vi + 4] = v_high.y;\n            outVerticesHigh[vi + 5] = v_high.z;\n            outVerticesHigh[vi + 6] = v_high.x;\n            outVerticesHigh[vi + 7] = v_high.y;\n            outVerticesHigh[vi + 8] = v_high.z;\n            outVerticesHigh[vi + 9] = v_high.x;\n            outVerticesHigh[vi + 10] = v_high.y;\n            outVerticesHigh[vi + 11] = v_high.z;\n            outVerticesLow[vi] = v_low.x;\n            outVerticesLow[vi + 1] = v_low.y;\n            outVerticesLow[vi + 2] = v_low.z;\n            outVerticesLow[vi + 3] = v_low.x;\n            outVerticesLow[vi + 4] = v_low.y;\n            outVerticesLow[vi + 5] = v_low.z;\n            outVerticesLow[vi + 6] = v_low.x;\n            outVerticesLow[vi + 7] = v_low.y;\n            outVerticesLow[vi + 8] = v_low.z;\n            outVerticesLow[vi + 9] = v_low.x;\n            outVerticesLow[vi + 10] = v_low.y;\n            outVerticesLow[vi + 11] = v_low.z;\n        }\n        var startIndex = index;\n        if (ellipsoid) {\n            if (outTransformedPathLonLat.length === 0) {\n                outTransformedPathLonLat.push([]);\n            }\n            if (outTransformedPathMerc.length === 0) {\n                outTransformedPathMerc.push([]);\n            }\n            var transformedPathLonLat = outTransformedPathLonLat[outTransformedPathLonLat.length - 1], transformedPathMerc = outTransformedPathMerc[outTransformedPathMerc.length - 1];\n            let lonLat = ellipsoid.cartesianToLonLat(point3v);\n            transformedPathLonLat.push(lonLat);\n            transformedPathMerc.push(lonLat.forwardMercator());\n            if (lonLat.lon < outExtent.southWest.lon) {\n                outExtent.southWest.lon = lonLat.lon;\n            }\n            if (lonLat.lat < outExtent.southWest.lat) {\n                outExtent.southWest.lat = lonLat.lat;\n            }\n            if (lonLat.lon > outExtent.northEast.lon) {\n                outExtent.northEast.lon = lonLat.lon;\n            }\n            if (lonLat.lat > outExtent.northEast.lat) {\n                outExtent.northEast.lat = lonLat.lat;\n            }\n        }\n        Vec3.doubleToTwoFloats(point3v, v_high, v_low);\n        let vi = outVerticesHigh.length - 12;\n        outVerticesHigh[vi] = v_high.x;\n        outVerticesHigh[vi + 1] = v_high.y;\n        outVerticesHigh[vi + 2] = v_high.z;\n        outVerticesHigh[vi + 3] = v_high.x;\n        outVerticesHigh[vi + 4] = v_high.y;\n        outVerticesHigh[vi + 5] = v_high.z;\n        outVerticesHigh[vi + 6] = v_high.x;\n        outVerticesHigh[vi + 7] = v_high.y;\n        outVerticesHigh[vi + 8] = v_high.z;\n        outVerticesHigh[vi + 9] = v_high.x;\n        outVerticesHigh[vi + 10] = v_high.y;\n        outVerticesHigh[vi + 11] = v_high.z;\n        outVerticesLow[vi] = v_low.x;\n        outVerticesLow[vi + 1] = v_low.y;\n        outVerticesLow[vi + 2] = v_low.z;\n        outVerticesLow[vi + 3] = v_low.x;\n        outVerticesLow[vi + 4] = v_low.y;\n        outVerticesLow[vi + 5] = v_low.z;\n        outVerticesLow[vi + 6] = v_low.x;\n        outVerticesLow[vi + 7] = v_low.y;\n        outVerticesLow[vi + 8] = v_low.z;\n        outVerticesLow[vi + 9] = v_low.x;\n        outVerticesLow[vi + 10] = v_low.y;\n        outVerticesLow[vi + 11] = v_low.z;\n        let ci = outColors.length - 16;\n        outColors[ci] = r;\n        outColors[ci + 1] = g;\n        outColors[ci + 2] = b;\n        outColors[ci + 3] = a;\n        outColors[ci + 4] = r;\n        outColors[ci + 5] = g;\n        outColors[ci + 6] = b;\n        outColors[ci + 7] = a;\n        outColors[ci + 8] = r;\n        outColors[ci + 9] = g;\n        outColors[ci + 10] = b;\n        outColors[ci + 11] = a;\n        outColors[ci + 12] = r;\n        outColors[ci + 13] = g;\n        outColors[ci + 14] = b;\n        outColors[ci + 15] = a;\n        outIndexes[ii] = index++;\n        outIndexes[ii + 1] = index++;\n        outIndexes[ii + 2] = index++;\n        outIndexes[ii + 3] = index++;\n        //\n        // Close path\n        //\n        var first;\n        if (isClosed) {\n            first = path[0];\n            outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\n        }\n        else {\n            let p0 = path[path.length - 1], p1 = path[path.length - 2] || p0;\n            first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            outIndexes.push(index - 1, index - 1, index - 1, index - 1);\n        }\n        Vec3.doubleToTwoFloats(first, v_high, v_low);\n        outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n        outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n        outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n        outOrders.push(1, -1, 2, -2);\n    }\n    /**\n     * Appends to the line array new geodetic coordinates line data.\n     * @static\n     */\n    static appendLineDataLonLat(pathLonLat, pathColors, defaultColor, isClosed, outVerticesHigh, outVerticesLow, outOrders, outIndexes, ellipsoid, outTransformedPathCartesian, outPathLonLat, outTransformedPathMerc, outExtent, outColors) {\n        var index = 0;\n        var v_high = new Vec3(), v_low = new Vec3();\n        if (outExtent) {\n            outExtent.southWest.set(180.0, 90.0);\n            outExtent.northEast.set(-180.0, -90.0);\n        }\n        if (outIndexes.length > 0) {\n            index = outIndexes[outIndexes.length - 5] + 9;\n            outIndexes.push(index, index);\n        }\n        else {\n            outIndexes.push(0, 0);\n        }\n        for (let j = 0, len = pathLonLat.length; j < len; j++) {\n            var path = pathLonLat[j], pathColors_j = pathColors[j];\n            outTransformedPathCartesian[j] = [];\n            outTransformedPathMerc[j] = [];\n            outPathLonLat[j] = [];\n            if (path.length === 0) {\n                continue;\n            }\n            var startIndex = index;\n            var last;\n            if (isClosed) {\n                let pp = path[path.length - 1];\n                if (pp instanceof Array) {\n                    last = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    last = ellipsoid.lonLatToCartesian(pp);\n                }\n            }\n            else {\n                let p0, p1;\n                let pp = path[0];\n                if (pp instanceof Array) {\n                    p0 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    p0 = ellipsoid.lonLatToCartesian(pp);\n                }\n                pp = path[1];\n                if (!pp) {\n                    pp = path[0];\n                }\n                if (pp instanceof Array) {\n                    p1 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    p1 = ellipsoid.lonLatToCartesian(pp);\n                }\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            }\n            let color = defaultColor;\n            if (pathColors_j && pathColors_j[0]) {\n                color = pathColors_j[0];\n            }\n            Vec3.doubleToTwoFloats(last, v_high, v_low);\n            outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n            outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n            let r = color[R], g = color[G], b = color[B], a = color[A] != undefined ? color[A] : 1.0;\n            if (j > 0) {\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n            }\n            outOrders.push(1, -1, 2, -2);\n            for (let i = 0, len = path.length; i < len; i++) {\n                var cur = path[i];\n                if (cur instanceof Array) {\n                    cur = new LonLat(cur[0], cur[1], cur[2]);\n                }\n                if (pathColors_j && pathColors_j[i]) {\n                    color = pathColors_j[i];\n                }\n                r = color[R];\n                g = color[G];\n                b = color[B];\n                a = color[A] != undefined ? color[A] : 1.0;\n                var cartesian = ellipsoid.lonLatToCartesian(cur);\n                outTransformedPathCartesian[j].push(cartesian);\n                outPathLonLat[j].push(cur);\n                outTransformedPathMerc[j].push(cur.forwardMercator());\n                Vec3.doubleToTwoFloats(cartesian, v_high, v_low);\n                outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n                outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n                outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n                outOrders.push(1, -1, 2, -2);\n                outIndexes.push(index++, index++, index++, index++);\n                if (cur.lon < outExtent.southWest.lon) {\n                    outExtent.southWest.lon = cur.lon;\n                }\n                if (cur.lat < outExtent.southWest.lat) {\n                    outExtent.southWest.lat = cur.lat;\n                }\n                if (cur.lon > outExtent.northEast.lon) {\n                    outExtent.northEast.lon = cur.lon;\n                }\n                if (cur.lat > outExtent.northEast.lat) {\n                    outExtent.northEast.lat = cur.lat;\n                }\n            }\n            var first;\n            if (isClosed) {\n                let pp = path[0];\n                if (pp instanceof Array) {\n                    first = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    first = ellipsoid.lonLatToCartesian(pp);\n                }\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\n            }\n            else {\n                let p0, p1;\n                let pp = path[path.length - 1];\n                if (pp instanceof Array) {\n                    p0 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    p0 = ellipsoid.lonLatToCartesian(pp);\n                }\n                pp = path[path.length - 2];\n                if (!pp) {\n                    pp = path[0];\n                }\n                if (pp instanceof Array) {\n                    p1 = ellipsoid.lonLatToCartesian(new LonLat(pp[0], pp[1], pp[2]));\n                }\n                else {\n                    p1 = ellipsoid.lonLatToCartesian(pp);\n                }\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\n            }\n            if (pathColors_j && pathColors_j[path.length - 1]) {\n                color = pathColors_j[path.length - 1];\n            }\n            r = color[R];\n            g = color[G];\n            b = color[B];\n            a = color[A] != undefined ? color[A] : 1.0;\n            Vec3.doubleToTwoFloats(first, v_high, v_low);\n            outVerticesHigh.push(v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z, v_high.x, v_high.y, v_high.z);\n            outVerticesLow.push(v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z, v_low.x, v_low.y, v_low.z);\n            outColors.push(r, g, b, a, r, g, b, a, r, g, b, a, r, g, b, a);\n            outOrders.push(1, -1, 2, -2);\n            if (j < pathLonLat.length - 1 && pathLonLat[j + 1].length !== 0) {\n                index += 8;\n                outIndexes.push(index, index);\n            }\n        }\n    }\n    /**\n     * Sets polyline path with cartesian coordinates.\n     * @protected\n     * @param {SegmentPath3vExt[]} path3v - Cartesian coordinates.\n     */\n    _setEqualPath3v(path3v) {\n        var extent = this._extent;\n        extent.southWest.set(180, 90);\n        extent.northEast.set(-180, -90);\n        var v_high = new Vec3(), v_low = new Vec3();\n        var vh = this._verticesHigh, vl = this._verticesLow, l = this._pathLonLat, m = this._pathLonLatMerc, k = 0;\n        var ellipsoid = this._renderNode.ellipsoid;\n        for (let j = 0; j < path3v.length; j++) {\n            var path = path3v[j];\n            var last;\n            if (this._closedLine) {\n                last = path[path.length - 1];\n            }\n            else {\n                last = new Vec3(path[0].x + path[0].x - path[1].x, path[0].y + path[0].y - path[1].y, path[0].z + path[0].z - path[1].z);\n            }\n            Vec3.doubleToTwoFloats(last, v_high, v_low);\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            for (let i = 0; i < path.length; i++) {\n                var cur = path[i], pji = this._path3v[j][i];\n                pji.x = cur.x;\n                pji.y = cur.y;\n                pji.z = cur.z;\n                if (ellipsoid) {\n                    var lonLat = ellipsoid.cartesianToLonLat(cur);\n                    this._pathLonLat[j][i] = lonLat;\n                    l[j][i] = lonLat;\n                    m[j][i] = lonLat.forwardMercator();\n                    if (lonLat.lon < extent.southWest.lon) {\n                        extent.southWest.lon = lonLat.lon;\n                    }\n                    if (lonLat.lat < extent.southWest.lat) {\n                        extent.southWest.lat = lonLat.lat;\n                    }\n                    if (lonLat.lon > extent.northEast.lon) {\n                        extent.northEast.lon = lonLat.lon;\n                    }\n                    if (lonLat.lat > extent.northEast.lat) {\n                        extent.northEast.lat = lonLat.lat;\n                    }\n                }\n                Vec3.doubleToTwoFloats(cur, v_high, v_low);\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n            }\n            var first;\n            if (this._closedLine) {\n                first = path[0];\n            }\n            else {\n                var l1 = path.length - 1;\n                first = new Vec3(path[l1].x + path[l1].x - path[l1 - 1].x, path[l1].y + path[l1].y - path[l1 - 1].y, path[l1].z + path[l1].z - path[l1 - 1].z);\n            }\n            Vec3.doubleToTwoFloats(first, v_high, v_low);\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n        }\n    }\n    /**\n     * Sets polyline with geodetic coordinates.\n     * @protected\n     * @param {SegmentPathLonLat[]} pathLonLat - Geodetic polyline path coordinates.\n     */\n    _setEqualPathLonLat(pathLonLat) {\n        var extent = this._extent;\n        extent.southWest.set(180.0, 90.0);\n        extent.northEast.set(-180.0, -90.0);\n        var v_high = new Vec3(), v_low = new Vec3();\n        var vh = this._verticesHigh, vl = this._verticesLow, l = this._pathLonLat, m = this._pathLonLatMerc, c = this._path3v, k = 0;\n        var ellipsoid = this._renderNode.ellipsoid;\n        for (let j = 0; j < pathLonLat.length; j++) {\n            var path = pathLonLat[j];\n            var last;\n            if (this._closedLine) {\n                last = ellipsoid.lonLatToCartesian(path[path.length - 1]);\n            }\n            else {\n                let p0 = ellipsoid.lonLatToCartesian(path[0]), p1 = ellipsoid.lonLatToCartesian(path[1]);\n                last = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            }\n            Vec3.doubleToTwoFloats(last, v_high, v_low);\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            for (let i = 0; i < path.length; i++) {\n                var cur = path[i];\n                var cartesian = ellipsoid.lonLatToCartesian(cur);\n                c[j][i] = cartesian;\n                m[j][i] = cur.forwardMercator();\n                l[j][i] = cur;\n                Vec3.doubleToTwoFloats(cartesian, v_high, v_low);\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                vh[k] = v_high.x;\n                vl[k++] = v_low.x;\n                vh[k] = v_high.y;\n                vl[k++] = v_low.y;\n                vh[k] = v_high.z;\n                vl[k++] = v_low.z;\n                if (cur.lon < extent.southWest.lon) {\n                    extent.southWest.lon = cur.lon;\n                }\n                if (cur.lat < extent.southWest.lat) {\n                    extent.southWest.lat = cur.lat;\n                }\n                if (cur.lon > extent.northEast.lon) {\n                    extent.northEast.lon = cur.lon;\n                }\n                if (cur.lat > extent.northEast.lat) {\n                    extent.northEast.lat = cur.lat;\n                }\n            }\n            var first;\n            if (this._closedLine) {\n                first = ellipsoid.lonLatToCartesian(path[0]);\n            }\n            else {\n                let p0 = ellipsoid.lonLatToCartesian(path[path.length - 1]), p1 = ellipsoid.lonLatToCartesian(path[path.length - 2]);\n                first = new Vec3(p0.x + p0.x - p1.x, p0.y + p0.y - p1.y, p0.z + p0.z - p1.z);\n            }\n            Vec3.doubleToTwoFloats(first, v_high, v_low);\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n            vh[k] = v_high.x;\n            vl[k++] = v_low.x;\n            vh[k] = v_high.y;\n            vl[k++] = v_low.y;\n            vh[k] = v_high.z;\n            vl[k++] = v_low.z;\n        }\n    }\n    setPointLonLat(lonlat, index, segmentIndex) {\n        if (this._renderNode && this._renderNode.ellipsoid) {\n            let l = this._pathLonLat, m = this._pathLonLatMerc;\n            l[segmentIndex][index] = lonlat;\n            m[segmentIndex][index] = lonlat.forwardMercator();\n            //\n            // Apply new extent(TODO: think about optimization)\n            //\n            var extent = this._extent;\n            extent.southWest.set(180.0, 90.0);\n            extent.northEast.set(-180.0, -90.0);\n            for (let i = 0; i < l.length; i++) {\n                var pi = l[i];\n                for (let j = 0; j < pi.length; j++) {\n                    var lon = pi[j].lon, lat = pi[j].lat;\n                    if (lon > extent.northEast.lon) {\n                        extent.northEast.lon = lon;\n                    }\n                    if (lat > extent.northEast.lat) {\n                        extent.northEast.lat = lat;\n                    }\n                    if (lon < extent.southWest.lon) {\n                        extent.southWest.lon = lon;\n                    }\n                    if (lat < extent.southWest.lat) {\n                        extent.southWest.lat = lat;\n                    }\n                }\n            }\n            this.setPoint3v(this._renderNode.ellipsoid.lonLatToCartesian(lonlat), index, segmentIndex, true);\n        }\n        else {\n            let path = this._pathLonLat[segmentIndex];\n            path[index].lon = lonlat.lon;\n            path[index].lat = lonlat.lat;\n            path[index].height = lonlat.height;\n        }\n    }\n    /**\n     * Changes cartesian point coordinates of the path\n     * @param {Vec3} coordinates - New coordinates\n     * @param {number} [index=0] - Path segment index\n     * @param {number} [segmentIndex=0] - Index of the point in the path segment\n     * @param {boolean} [skipLonLat=false] - Do not update geodetic coordinates\n     */\n    setPoint3v(coordinates, index = 0, segmentIndex = 0, skipLonLat = false) {\n        if (this._renderNode) {\n            var v_high = new Vec3(), v_low = new Vec3();\n            var vh = this._verticesHigh, vl = this._verticesLow, l = this._pathLonLat, m = this._pathLonLatMerc, k = 0, kk = 0;\n            //for (let i = 0; i < segmentIndex; i++) {\n            //    kk += this._path3v[i].length * 12 + 24;\n            //}\n            kk = this._pathLengths[segmentIndex] * 12 + 24 * segmentIndex;\n            let path = this._path3v[segmentIndex];\n            path[index].x = coordinates.x;\n            path[index].y = coordinates.y;\n            path[index].z = coordinates.z;\n            let _closedLine = this._closedLine || path.length === 1;\n            if (index === 0 || index === 1) {\n                var last;\n                if (_closedLine) {\n                    last = path[path.length - 1];\n                }\n                else {\n                    last = new Vec3(path[0].x + path[0].x - path[1].x, path[0].y + path[0].y - path[1].y, path[0].z + path[0].z - path[1].z);\n                }\n                k = kk;\n                Vec3.doubleToTwoFloats(last, v_high, v_low);\n                vh[k] = v_high.x;\n                vh[k + 1] = v_high.y;\n                vh[k + 2] = v_high.z;\n                vh[k + 3] = v_high.x;\n                vh[k + 4] = v_high.y;\n                vh[k + 5] = v_high.z;\n                vh[k + 6] = v_high.x;\n                vh[k + 7] = v_high.y;\n                vh[k + 8] = v_high.z;\n                vh[k + 9] = v_high.x;\n                vh[k + 10] = v_high.y;\n                vh[k + 11] = v_high.z;\n                vl[k] = v_low.x;\n                vl[k + 1] = v_low.y;\n                vl[k + 2] = v_low.z;\n                vl[k + 3] = v_low.x;\n                vl[k + 4] = v_low.y;\n                vl[k + 5] = v_low.z;\n                vl[k + 6] = v_low.x;\n                vl[k + 7] = v_low.y;\n                vl[k + 8] = v_low.z;\n                vl[k + 9] = v_low.x;\n                vl[k + 10] = v_low.y;\n                vl[k + 11] = v_low.z;\n            }\n            if (!skipLonLat && this._renderNode.ellipsoid) {\n                var lonLat = this._renderNode.ellipsoid.cartesianToLonLat(coordinates);\n                l[segmentIndex][index] = lonLat;\n                m[segmentIndex][index] = lonLat.forwardMercator();\n                //\n                // Apply new extent(TODO: think about optimization)\n                //\n                var extent = this._extent;\n                extent.southWest.set(180.0, 90.0);\n                extent.northEast.set(-180.0, -90.0);\n                for (let i = 0; i < l.length; i++) {\n                    var pi = l[i];\n                    for (let j = 0; j < pi.length; j++) {\n                        var lon = pi[j].lon, lat = pi[j].lat;\n                        if (lon > extent.northEast.lon) {\n                            extent.northEast.lon = lon;\n                        }\n                        if (lat > extent.northEast.lat) {\n                            extent.northEast.lat = lat;\n                        }\n                        if (lon < extent.southWest.lon) {\n                            extent.southWest.lon = lon;\n                        }\n                        if (lat < extent.southWest.lat) {\n                            extent.southWest.lat = lat;\n                        }\n                    }\n                }\n            }\n            k = kk + index * 12 + 12;\n            Vec3.doubleToTwoFloats(coordinates, v_high, v_low);\n            vh[k] = v_high.x;\n            vh[k + 1] = v_high.y;\n            vh[k + 2] = v_high.z;\n            vh[k + 3] = v_high.x;\n            vh[k + 4] = v_high.y;\n            vh[k + 5] = v_high.z;\n            vh[k + 6] = v_high.x;\n            vh[k + 7] = v_high.y;\n            vh[k + 8] = v_high.z;\n            vh[k + 9] = v_high.x;\n            vh[k + 10] = v_high.y;\n            vh[k + 11] = v_high.z;\n            vl[k] = v_low.x;\n            vl[k + 1] = v_low.y;\n            vl[k + 2] = v_low.z;\n            vl[k + 3] = v_low.x;\n            vl[k + 4] = v_low.y;\n            vl[k + 5] = v_low.z;\n            vl[k + 6] = v_low.x;\n            vl[k + 7] = v_low.y;\n            vl[k + 8] = v_low.z;\n            vl[k + 9] = v_low.x;\n            vl[k + 10] = v_low.y;\n            vl[k + 11] = v_low.z;\n            if (index === path.length - 1 || index === path.length - 2) {\n                var first;\n                if (_closedLine) {\n                    first = path[0];\n                }\n                else {\n                    var l1 = path.length - 1;\n                    first = new Vec3(path[l1].x + path[l1].x - path[l1 - 1].x, path[l1].y + path[l1].y - path[l1 - 1].y, path[l1].z + path[l1].z - path[l1 - 1].z);\n                }\n                k = kk + path.length * 12 + 12;\n                Vec3.doubleToTwoFloats(first, v_high, v_low);\n                vh[k] = v_high.x;\n                vh[k + 1] = v_high.y;\n                vh[k + 2] = v_high.z;\n                vh[k + 3] = v_high.x;\n                vh[k + 4] = v_high.y;\n                vh[k + 5] = v_high.z;\n                vh[k + 6] = v_high.x;\n                vh[k + 7] = v_high.y;\n                vh[k + 8] = v_high.z;\n                vh[k + 9] = v_high.x;\n                vh[k + 10] = v_high.y;\n                vh[k + 11] = v_high.z;\n                vl[k] = v_low.x;\n                vl[k + 1] = v_low.y;\n                vl[k + 2] = v_low.z;\n                vl[k + 3] = v_low.x;\n                vl[k + 4] = v_low.y;\n                vl[k + 5] = v_low.z;\n                vl[k + 6] = v_low.x;\n                vl[k + 7] = v_low.y;\n                vl[k + 8] = v_low.z;\n                vl[k + 9] = v_low.x;\n                vl[k + 10] = v_low.y;\n                vl[k + 11] = v_low.z;\n            }\n            this._changedBuffers[VERTICES_BUFFER] = true;\n        }\n        else {\n            let path = this._path3v[segmentIndex];\n            path[index].x = coordinates.x;\n            path[index].y = coordinates.y;\n            path[index].z = coordinates.z;\n        }\n    }\n    _resizePathLengths(index = 0) {\n        this._pathLengths[0] = 0;\n        for (let i = index + 1, len = this._path3v.length; i <= len; i++) {\n            this._pathLengths[i] = this._pathLengths[i - 1] + this._path3v[i - 1].length;\n        }\n    }\n    /**\n     * Remove path segment\n     * @param {number} index - Path segment index\n     */\n    removeSegment(index) {\n        this._path3v.splice(index, 1);\n        this.setPath3v([].concat(this._path3v));\n    }\n    /**\n     * Remove point from the path\n     * @param {number} index - Point index in a path segment\n     * @param {number} [multiLineIndex=0] - Segment path index\n     */\n    removePoint(index, multiLineIndex = 0) {\n        this._path3v[multiLineIndex].splice(index, 1);\n        if (this._path3v[multiLineIndex].length === 0) {\n            this._path3v.splice(multiLineIndex, 1);\n        }\n        this.setPath3v([].concat(this._path3v));\n    }\n    /**\n     * Insert point coordinates in a path segment\n     * @param {Vec3} point3v - Point coordinates\n     * @param {number} [index=0] - Index in the path\n     * @param {NumberArray4} [color] - Point color\n     * @param {number} [multilineIndex=0] - Path segment index\n     */\n    insertPoint3v(point3v, index = 0, color, multilineIndex = 0) {\n        let p = [].concat(this._path3v), pp = p[multilineIndex];\n        if (pp) {\n            let c = [].concat(this._pathColors);\n            pp.splice(index, 0, point3v);\n            if (color) {\n                let cc = c[multilineIndex];\n                if (!cc) {\n                    cc = new Array(pp.length);\n                }\n                cc.splice(index, 0, color);\n            }\n            this.setPath3v(p, c);\n        }\n        else {\n            this.addPoint3v(point3v, multilineIndex);\n        }\n    }\n    /**\n     * Adds a new cartesian point in the end of the path in a last line segment.\n     * @public\n     * @param {Vec3} point3v - New coordinates.\n     * @param {NumberArray4} [color] -\n     * @param {boolean} [skipEllipsoid] -\n     */\n    appendPoint3v(point3v, color, skipEllipsoid) {\n        if (this._path3v.length === 0 || !this._renderNode) {\n            this._pathColors.push([color || this._defaultColor]);\n            this.addPoint3v(point3v);\n        }\n        else {\n            //\n            // Making typedArrays suitable for appendPoint function\n            //\n            this._verticesHigh = makeArray(this._verticesHigh);\n            this._verticesLow = makeArray(this._verticesLow);\n            this._colors = makeArray(this._colors);\n            this._orders = makeArray(this._orders);\n            this._indexes = makeArray(this._indexes);\n            Polyline.appendPoint3v(this._path3v, point3v, this._pathColors, color || this._defaultColor, this._closedLine, this._verticesHigh, this._verticesLow, this._colors, this._orders, this._indexes, !skipEllipsoid ? this._renderNode.ellipsoid : null, this._pathLonLat, this._pathLonLatMerc, this._extent);\n            this._pathLengths[this._path3v.length] += 1;\n            this._changedBuffers[VERTICES_BUFFER] = true;\n            this._changedBuffers[COLORS_BUFFER] = true;\n            this._changedBuffers[INDEX_BUFFER] = true;\n        }\n    }\n    /**\n     * Append new point in the end of the path.\n     * @public\n     * @param {Vec3} point3v - New point coordinates.\n     * @param {number} [multiLineIndex=0] - Path segment index, first by default.\n     */\n    addPoint3v(point3v, multiLineIndex = 0) {\n        //\n        // TODO: could be optimized\n        //\n        if (multiLineIndex >= this._path3v.length) {\n            this._path3v.push([]);\n        }\n        this._path3v[multiLineIndex].push(point3v);\n        this.setPath3v([].concat(this._path3v));\n    }\n    /**\n     * Append new geodetic point in the end of the path.\n     * @public\n     * @param {LonLat} lonLat - New coordinate.\n     * @param {number} [multiLineIndex=0] - Path segment index, first by default.\n     */\n    addPointLonLat(lonLat, multiLineIndex = 0) {\n        //\n        // TODO: could be optimized\n        //\n        if (multiLineIndex >= this._pathLonLat.length) {\n            this._pathLonLat.push([]);\n        }\n        this._pathLonLat[multiLineIndex].push(lonLat);\n        this.setPathLonLat([].concat(this._pathLonLat));\n    }\n    /**\n     * Clear polyline data.\n     * @public\n     */\n    clear() {\n        this._clearData();\n    }\n    /**\n     * Change path point color\n     * @param {NumberArray4} color - New color\n     * @param {number} [index=0] - Point index\n     * @param {number} [segmentIndex=0] - Path segment index\n     */\n    setPointColor(color, index = 0, segmentIndex = 0) {\n        if (this._renderNode && index < this._path3v[segmentIndex].length) {\n            let colors = this._pathColors[segmentIndex];\n            if (!colors) {\n                if (this._path3v[segmentIndex] && index < this._path3v[segmentIndex].length) {\n                    this._pathColors[segmentIndex] = new Array(this._path3v[segmentIndex].length);\n                }\n                else {\n                    return;\n                }\n            }\n            if (!colors[index]) {\n                colors[index] = [color[R], color[G], color[B], color[A] || 1.0];\n            }\n            else {\n                colors[index][R] = color[R];\n                colors[index][G] = color[G];\n                colors[index][B] = color[B];\n                colors[index][A] = color[A] || 1.0;\n            }\n            let c = this._colors;\n            //optimized with this._pathLengths\n            //for (let i = 0; i < segmentIndex; i++) {\n            //    kk += this._path3v[i].length * 16 + 32;\n            //}\n            let k = index * 16 + this._pathLengths[segmentIndex] * 16 + 32 * segmentIndex;\n            c[k] = c[k + 4] = c[k + 8] = c[k + 12] = color[R];\n            c[k + 1] = c[k + 5] = c[k + 9] = c[k + 13] = color[G];\n            c[k + 2] = c[k + 6] = c[k + 10] = c[k + 14] = color[B];\n            c[k + 3] = c[k + 7] = c[k + 11] = c[k + 15] = color[A] || 1.0;\n            this._changedBuffers[COLORS_BUFFER] = true;\n        }\n        else {\n            let pathColors = this._pathColors[segmentIndex];\n            pathColors[index] = color;\n        }\n    }\n    /**\n     * Sets polyline opacity.\n     * @public\n     * @param {number} opacity - Opacity.\n     */\n    setOpacity(opacity) {\n        this._opacity = opacity;\n    }\n    /**\n     * Sets Polyline thickness in screen pixels.\n     * @public\n     * @param {number} thickness - Thickness.\n     */\n    setThickness(thickness) {\n        this.thickness = thickness;\n    }\n    /**\n     * Returns thickness.\n     * @public\n     * @return {number} Thickness in screen pixels.\n     */\n    getThickness() {\n        return this.thickness;\n    }\n    /**\n     * Sets visibility.\n     * @public\n     * @param {boolean} visibility - Polyline visibility.\n     */\n    setVisibility(visibility) {\n        this.visibility = visibility;\n    }\n    /**\n     * Gets Polyline visibility.\n     * @public\n     * @return {boolean} Polyline visibility.\n     */\n    getVisibility() {\n        return this.visibility;\n    }\n    /**\n     * Assign with render node.\n     * @public\n     * @param {RenderNode} renderNode -\n     */\n    setRenderNode(renderNode) {\n        if (renderNode) {\n            this._renderNode = renderNode;\n            if (this._pathLonLat.length) {\n                this._createDataLonLat([].concat(this._pathLonLat));\n            }\n            else {\n                this._createData3v([].concat(this._path3v));\n            }\n            this._refresh();\n            if (renderNode.renderer && renderNode.renderer.isInitialized()) {\n                this._update();\n            }\n        }\n    }\n    _clearData() {\n        //@ts-ignore\n        this._verticesHigh = null;\n        //@ts-ignore\n        this._verticesLow = null;\n        //@ts-ignore\n        this._orders = null;\n        //@ts-ignore\n        this._indexes = null;\n        //@ts-ignore\n        this._colors = null;\n        this._verticesHigh = [];\n        this._verticesLow = [];\n        this._orders = [];\n        this._indexes = [];\n        this._colors = [];\n        this._path3v.length = 0;\n        this._pathLonLat.length = 0;\n        this._pathLonLatMerc.length = 0;\n        this._path3v = [];\n        this._pathLonLat = [];\n        this._pathLonLatMerc = [];\n    }\n    _createData3v(path3v) {\n        this._clearData();\n        Polyline.appendLineData3v(path3v, this._pathColors, this._defaultColor, this._closedLine, this._verticesHigh, this._verticesLow, this._orders, this._indexes, this._renderNode.ellipsoid, this._pathLonLat, this._path3v, this._pathLonLatMerc, this._extent, this._colors);\n        this._resizePathLengths(0);\n    }\n    _createDataLonLat(pathLonlat) {\n        this._clearData();\n        Polyline.appendLineDataLonLat(pathLonlat, this._pathColors, this._defaultColor, this._closedLine, this._verticesHigh, this._verticesLow, this._orders, this._indexes, this._renderNode.ellipsoid, this._path3v, this._pathLonLat, this._pathLonLatMerc, this._extent, this._colors);\n        this._resizePathLengths(0);\n    }\n    /**\n     * Removes from an entity.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._pathColors.length = 0;\n        this._pathColors = [];\n        //@ts-ignore\n        this._verticesHigh = null;\n        //@ts-ignore\n        this._verticesLow = null;\n        //@ts-ignore\n        this._orders = null;\n        //@ts-ignore\n        this._indexes = null;\n        //@ts-ignore\n        this._colors = null;\n        this._verticesHigh = [];\n        this._verticesLow = [];\n        this._orders = [];\n        this._indexes = [];\n        this._colors = [];\n        this._deleteBuffers();\n        this._handler && this._handler.remove(this);\n    }\n    setPickingColor3v(color) {\n        this._pickingColor[0] = color.x / 255.0;\n        this._pickingColor[1] = color.y / 255.0;\n        this._pickingColor[2] = color.z / 255.0;\n    }\n    /**\n     * Returns polyline geodetic extent.\n     * @public\n     * @returns {Extent} - Geodetic extent\n     */\n    getExtent() {\n        return this._extent.clone();\n    }\n    /**\n     * Returns path cartesian coordinates.\n     * @return {SegmentPath3vExt[]} Polyline path.\n     */\n    getPath3v() {\n        return this._path3v;\n    }\n    /**\n     * Returns geodetic path coordinates.\n     * @return {SegmentPathLonLatExt[]} Polyline path.\n     */\n    getPathLonLat() {\n        return this._pathLonLat;\n    }\n    getPathColors() {\n        return this._pathColors;\n    }\n    /**\n     * @todo\n     * @param {NumberArray4[][]} pathColors\n     */\n    setPathColors(pathColors) {\n        if (this._renderNode) {\n            //\n            // ...\n            //\n        }\n    }\n    /**\n     * Sets polyline color\n     * @param {string} htmlColor- HTML color\n     */\n    setColorHTML(htmlColor) {\n        this._defaultColor = htmlColorToFloat32Array(htmlColor);\n        let color = htmlColorToRgba(htmlColor), p = this._pathColors;\n        for (let i = 0, len = p.length; i < len; i++) {\n            let s = p[i];\n            for (let j = 0, slen = s.length; j < slen; j++) {\n                s[j][0] = color.x;\n                s[j][1] = color.y;\n                s[j][2] = color.z;\n                s[j][3] = color.w;\n            }\n        }\n        let c = this._colors;\n        for (let i = 0, len = c.length; i < len; i += 4) {\n            c[i] = color.x;\n            c[i + 1] = color.y;\n            c[i + 2] = color.z;\n            c[i + 3] = color.w;\n        }\n        this._changedBuffers[COLORS_BUFFER] = true;\n    }\n    /**\n     * Sets polyline geodetic coordinates.\n     * @public\n     * @param {SegmentPathLonLat[]} pathLonLat - Polyline path cartesian coordinates.\n     * @param {Boolean} [forceEqual=false] - OPTIMIZATION FLAG: Makes assigning faster for size equal coordinates array.\n     */\n    setPathLonLat(pathLonLat, forceEqual = false) {\n        if (this._renderNode && this._renderNode.ellipsoid) {\n            if (forceEqual) {\n                this._setEqualPathLonLat(pathLonLat);\n                this._changedBuffers[VERTICES_BUFFER] = true;\n                this._changedBuffers[COLORS_BUFFER] = true;\n            }\n            else {\n                this._createDataLonLat(pathLonLat);\n                this._changedBuffers[VERTICES_BUFFER] = true;\n                this._changedBuffers[INDEX_BUFFER] = true;\n                this._changedBuffers[COLORS_BUFFER] = true;\n            }\n        }\n        else {\n            this._pathLonLat = [].concat(pathLonLat);\n        }\n    }\n    /**\n     * Sets Polyline cartesian coordinates.\n     * @public\n     * @param {SegmentPath3vExt[]} path3v - Polyline path cartesian coordinates. (exactly 3 entries)\n     * @param {SegmentPathColor[]} [pathColors] - Polyline path cartesian coordinates. (exactly 3 entries)\n     * @param {Boolean} [forceEqual=false] - Makes assigning faster for size equal coordinates array.\n     */\n    setPath3v(path3v, pathColors, forceEqual = false) {\n        if (pathColors) {\n            this._pathColors = [].concat(pathColors);\n        }\n        if (this._renderNode) {\n            if (forceEqual) {\n                this._setEqualPath3v(path3v);\n                this._changedBuffers[VERTICES_BUFFER] = true;\n                this._changedBuffers[COLORS_BUFFER] = true;\n            }\n            else {\n                this._createData3v(path3v);\n                this._changedBuffers[VERTICES_BUFFER] = true;\n                this._changedBuffers[INDEX_BUFFER] = true;\n                this._changedBuffers[COLORS_BUFFER] = true;\n            }\n        }\n        else {\n            this._path3v = [].concat(path3v);\n        }\n    }\n    draw() {\n        if (this.visibility && this._path3v.length) {\n            this._update();\n            let rn = this._renderNode;\n            let r = rn.renderer;\n            let sh = r.handler.programs.polyline_screen;\n            let p = sh._program;\n            let gl = r.handler.gl, sha = p.attributes, shu = p.uniforms;\n            let ec = this._handler._entityCollection;\n            sh.activate();\n            gl.disable(gl.CULL_FACE);\n            gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n            gl.uniformMatrix4fv(shu.proj, false, r.activeCamera.getProjectionMatrix());\n            gl.uniformMatrix4fv(shu.view, false, r.activeCamera.getViewMatrix());\n            // gl.uniform4fv(shu.color, [this.color.x, this.color.y, this.color.z, this.color.w * this._handler._entityCollection._fadingOpacity]);\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n            gl.uniform2fv(shu.uFloatParams, [rn._planetRadius2 || 0.0, r.activeCamera._tanViewAngle_hradOneByHeight]);\n            gl.uniform2fv(shu.viewport, [r.handler.canvas.width, r.handler.canvas.height]);\n            gl.uniform1f(shu.thickness, this.thickness * 0.5);\n            gl.uniform1f(shu.opacity, this._opacity * ec._fadingOpacity);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._colorsBuffer);\n            gl.vertexAttribPointer(sha.color, this._colorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            let v = this._verticesHighBuffer;\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\n            gl.vertexAttribPointer(sha.prevHigh, v.itemSize, gl.FLOAT, false, 12, 0);\n            gl.vertexAttribPointer(sha.currentHigh, v.itemSize, gl.FLOAT, false, 12, 48);\n            gl.vertexAttribPointer(sha.nextHigh, v.itemSize, gl.FLOAT, false, 12, 96);\n            v = this._verticesLowBuffer;\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\n            gl.vertexAttribPointer(sha.prevLow, v.itemSize, gl.FLOAT, false, 12, 0);\n            gl.vertexAttribPointer(sha.currentLow, v.itemSize, gl.FLOAT, false, 12, 48);\n            gl.vertexAttribPointer(sha.nextLow, v.itemSize, gl.FLOAT, false, 12, 96);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._ordersBuffer);\n            gl.vertexAttribPointer(sha.order, this._ordersBuffer.itemSize, gl.FLOAT, false, 4, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexesBuffer);\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n            gl.enable(gl.CULL_FACE);\n        }\n    }\n    drawPicking() {\n        if (this.visibility && this._path3v.length) {\n            let rn = this._renderNode;\n            let r = rn.renderer;\n            let sh = r.handler.programs.polyline_picking;\n            let p = sh._program;\n            let gl = r.handler.gl, sha = p.attributes, shu = p.uniforms;\n            sh.activate();\n            gl.disable(gl.CULL_FACE);\n            gl.uniform1f(shu.depthOffset, this._handler._entityCollection.polygonOffsetUnits);\n            gl.uniformMatrix4fv(shu.proj, false, r.activeCamera.getProjectionMatrix());\n            gl.uniformMatrix4fv(shu.view, false, r.activeCamera.getViewMatrix());\n            gl.uniform4fv(shu.color, [\n                this._pickingColor[0],\n                this._pickingColor[1],\n                this._pickingColor[2],\n                1.0\n            ]);\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n            gl.uniform2fv(shu.uFloatParams, [rn._planetRadius2 || 0.0, r.activeCamera._tanViewAngle_hradOneByHeight]);\n            //@todo: replace to the handler property\n            gl.uniform2fv(shu.viewport, [r.handler.canvas.width, r.handler.canvas.height]);\n            gl.uniform1f(shu.thickness, this.thickness * 0.5);\n            let v = this._verticesHighBuffer;\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\n            gl.vertexAttribPointer(sha.prevHigh, v.itemSize, gl.FLOAT, false, 12, 0);\n            gl.vertexAttribPointer(sha.currentHigh, v.itemSize, gl.FLOAT, false, 12, 48);\n            gl.vertexAttribPointer(sha.nextHigh, v.itemSize, gl.FLOAT, false, 12, 96);\n            v = this._verticesLowBuffer;\n            gl.bindBuffer(gl.ARRAY_BUFFER, v);\n            gl.vertexAttribPointer(sha.prevLow, v.itemSize, gl.FLOAT, false, 12, 0);\n            gl.vertexAttribPointer(sha.currentLow, v.itemSize, gl.FLOAT, false, 12, 48);\n            gl.vertexAttribPointer(sha.nextLow, v.itemSize, gl.FLOAT, false, 12, 96);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._ordersBuffer);\n            gl.vertexAttribPointer(sha.order, this._ordersBuffer.itemSize, gl.FLOAT, false, 4, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexesBuffer);\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n            gl.enable(gl.CULL_FACE);\n        }\n    }\n    /**\n     * Refresh buffers.\n     * @protected\n     */\n    _refresh() {\n        let i = this._changedBuffers.length;\n        while (i--) {\n            this._changedBuffers[i] = true;\n        }\n    }\n    /**\n     * Updates render buffers.\n     * @protected\n     */\n    _update() {\n        if (this._renderNode) {\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n        }\n    }\n    /**\n     * Clear GL buffers.\n     * @public\n     */\n    _deleteBuffers() {\n        if (this._renderNode) {\n            let r = this._renderNode.renderer, gl = r.handler.gl;\n            gl.deleteBuffer(this._verticesHighBuffer);\n            gl.deleteBuffer(this._verticesLowBuffer);\n            gl.deleteBuffer(this._ordersBuffer);\n            gl.deleteBuffer(this._indexesBuffer);\n            gl.deleteBuffer(this._colorsBuffer);\n            this._verticesHighBuffer = null;\n            this._verticesLowBuffer = null;\n            this._ordersBuffer = null;\n            this._indexesBuffer = null;\n            this._colorsBuffer = null;\n        }\n    }\n    /**\n     * Creates vertices buffers.\n     * @protected\n     */\n    _createVerticesBuffer() {\n        let h = this._renderNode.renderer.handler;\n        let numItems = this._verticesHigh.length / 3;\n        if (!this._verticesHighBuffer || this._verticesHighBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._verticesHighBuffer);\n            h.gl.deleteBuffer(this._verticesLowBuffer);\n            this._verticesHighBuffer = h.createStreamArrayBuffer(3, numItems);\n            this._verticesLowBuffer = h.createStreamArrayBuffer(3, numItems);\n        }\n        this._verticesHigh = makeArrayTyped(this._verticesHigh);\n        this._verticesLow = makeArrayTyped(this._verticesLow);\n        h.setStreamArrayBuffer(this._verticesHighBuffer, this._verticesHigh);\n        h.setStreamArrayBuffer(this._verticesLowBuffer, this._verticesLow);\n    }\n    /**\n     * Creates gl index and order buffer.\n     * @protected\n     */\n    _createIndexBuffer() {\n        let h = this._renderNode.renderer.handler;\n        h.gl.deleteBuffer(this._ordersBuffer);\n        h.gl.deleteBuffer(this._indexesBuffer);\n        this._orders = makeArrayTyped(this._orders);\n        this._ordersBuffer = h.createArrayBuffer(this._orders, 1, this._orders.length / 2);\n        this._indexes = makeArrayTyped(this._indexes, Uint32Array);\n        this._indexesBuffer = h.createElementArrayBuffer(this._indexes, 1, this._indexes.length);\n    }\n    _createColorsBuffer() {\n        let h = this._renderNode.renderer.handler;\n        h.gl.deleteBuffer(this._colorsBuffer);\n        this._colors = makeArrayTyped(this._colors);\n        this._colorsBuffer = h.createArrayBuffer(new Float32Array(this._colors), 4, this._colors.length / 4);\n    }\n}\nPolyline.__counter__ = 0;\nexport { Polyline };\n//# sourceMappingURL=Polyline.js.map","import * as utils from \"../utils/shared\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Ray class.\n * @class\n * @param {Object} [options] - Options:\n * @param {Vec3|Array.<number>} [options.startPosition] - Ray start point position.\n * @param {Vec3|Array.<number>} [options.endPosition] - Ray end point position.\n * @param {Vec3|Array.<number>} [options.startColor] - Ray start point color.\n * @param {Vec3|Array.<number>} [options.endColor] - Ray end point color.\n * @param {boolean} [options.visibility] - Visibility.\n */\nclass Ray {\n    constructor(options = {}) {\n        this.__id = Ray.__counter__++;\n        this._thickness = options.thickness || 2.0;\n        this._startPosition = utils.createVector3(options.startPosition);\n        this._startPositionHigh = new Vec3();\n        this._startPositionLow = new Vec3();\n        Vec3.doubleToTwoFloats(this._startPosition, this._startPositionHigh, this._startPositionLow);\n        this._endPosition = utils.createVector3(options.endPosition);\n        this._endPositionHigh = new Vec3();\n        this._endPositionLow = new Vec3();\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\n        this._startColor = utils.createColorRGBA(options.startColor);\n        this._endColor = utils.createColorRGBA(options.endColor);\n        this._visibility = options.visibility != undefined ? options.visibility : true;\n        this._entity = null;\n        this._handler = null;\n        this._handlerIndex = -1;\n    }\n    /**\n     * Sets ray start position.\n     * @public\n     * @param {number} x - X coordinate.\n     * @param {number} y - Y coordinate.\n     * @param {number} z - Z coordinate.\n     */\n    setStartPosition(x, y, z) {\n        this._startPosition.x = x;\n        this._startPosition.y = y;\n        this._startPosition.z = z;\n        Vec3.doubleToTwoFloats(this._startPosition, this._startPositionHigh, this._startPositionLow);\n        this._handler &&\n            this._handler.setStartPositionArr(this._handlerIndex, this._startPositionHigh, this._startPositionLow);\n    }\n    getLength() {\n        return this._startPosition.distance(this._endPosition);\n    }\n    /**\n     * Sets ray start position.\n     * @public\n     * @param {Vec3} position - Cartesian coordinates.\n     */\n    setStartPosition3v(position) {\n        this._startPosition.x = position.x;\n        this._startPosition.y = position.y;\n        this._startPosition.z = position.z;\n        Vec3.doubleToTwoFloats(this._startPosition, this._startPositionHigh, this._startPositionLow);\n        this._handler &&\n            this._handler.setStartPositionArr(this._handlerIndex, this._startPositionHigh, this._startPositionLow);\n    }\n    /**\n     * Sets ray end position.\n     * @public\n     * @param {number} x - X coordinate.\n     * @param {number} y - Y coordinate.\n     * @param {number} z - Z coordinate.\n     */\n    setEndPosition(x, y, z) {\n        this._endPosition.x = x;\n        this._endPosition.y = y;\n        this._endPosition.z = z;\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\n        this._handler &&\n            this._handler.setEndPositionArr(this._handlerIndex, this._endPositionHigh, this._endPositionLow);\n    }\n    /**\n     * Sets ray end position.\n     * @public\n     * @param {Vec3} position - Cartesian coordinates.\n     */\n    setEndPosition3v(position) {\n        this._endPosition.x = position.x;\n        this._endPosition.y = position.y;\n        this._endPosition.z = position.z;\n        Vec3.doubleToTwoFloats(this._endPosition, this._endPositionHigh, this._endPositionLow);\n        this._handler &&\n            this._handler.setEndPositionArr(this._handlerIndex, this._endPositionHigh, this._endPositionLow);\n    }\n    setThickness(thickness) {\n        this._thickness = thickness;\n        this._handler && this._handler.setThicknessArr(this._handlerIndex, thickness);\n    }\n    setColors4v(startColor, endColor) {\n        if (startColor) {\n            this._startColor.x = startColor.x;\n            this._startColor.y = startColor.y;\n            this._startColor.z = startColor.z;\n            this._startColor.w = startColor.w;\n        }\n        if (endColor) {\n            this._endColor.x = endColor.x;\n            this._endColor.y = endColor.y;\n            this._endColor.z = endColor.z;\n            this._endColor.w = endColor.w;\n        }\n        this._handler &&\n            this._handler.setRgbaArr(this._handlerIndex, this._startColor, this._endColor);\n    }\n    setColorsHTML(startColor, endColor) {\n        if (startColor) {\n            this._startColor = utils.htmlColorToRgba(startColor);\n        }\n        if (endColor) {\n            this._endColor = utils.htmlColorToRgba(endColor);\n        }\n        this._handler && this._handler.setRgbaArr(this._handlerIndex, this._startColor, this._endColor);\n    }\n    /**\n     * Returns ray start position.\n     * @public\n     * @returns {Vec3}\n     */\n    getStartPosition() {\n        return this._startPosition;\n    }\n    /**\n     * Returns ray end position.\n     * @public\n     * @returns {Vec3}\n     */\n    getEndPosition() {\n        return this._endPosition;\n    }\n    /**\n     * Sets visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        this._visibility = visibility;\n        this._handler && this._handler.setVisibility(this._handlerIndex, visibility);\n    }\n    /**\n     * Returns visibility.\n     * @public\n     * @returns {boolean}\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Remove from handler.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._handler && this._handler.remove(this);\n    }\n    /**\n     * Set picking color.\n     * @public\n     * @param {Vec3} color - Picking color.\n     */\n    setPickingColor3v(color) {\n        this._handler && this._handler.setPickingColorArr(this._handlerIndex, color);\n    }\n}\nRay.__counter__ = 0;\nexport { Ray };\n//# sourceMappingURL=Ray.js.map","import * as utils from \"../utils/shared\";\nimport { Line3 } from \"../math/Line3\";\nimport { Vec3 } from \"../math/Vec3\";\nlet _tempHigh = new Vec3(), _tempLow = new Vec3();\n/**\n * Strip object.\n * @class\n * @param {*} [options] - Strip options:\n * @param {boolean} [options.visibility] - Strip visibility.\n * @example <caption>Stripe example</caption>\n * new og.Entity({\n *     strip: {\n *         gridSize: 10,\n *         path: [\n *             [[],[]],\n *             [[],[]]\n *         ]\n *     }\n * });\n */\nclass Strip {\n    constructor(options = {}) {\n        this.__id = Strip.__counter__++;\n        this.visibility = options.visibility != undefined ? options.visibility : true;\n        this.color = new Float32Array([1.0, 1.0, 1.0, 0.5]);\n        if (options.color) {\n            let color = utils.createColorRGBA(options.color);\n            this.setColor(color.x, color.y, color.z, color.w);\n        }\n        if (options.opacity) {\n            this.setOpacity(options.opacity);\n        }\n        /**\n         * Parent collection render node.\n         * @protected\n         * @type {RenderNode}\n         */\n        this._renderNode = null;\n        /**\n         * Entity instance that holds this strip.\n         * @protected\n         * @type {Entity}\n         */\n        this._entity = null;\n        this._verticesHighBuffer = null;\n        this._verticesLowBuffer = null;\n        this._indexBuffer = null;\n        this._verticesHigh = [];\n        this._verticesLow = [];\n        this._indexes = [];\n        this._path = [];\n        this._pickingColor = new Float32Array(4);\n        this._gridSize = 1;\n        /**\n         * Handler that stores and renders this object.\n         * @protected\n         * @type {StripHandler}\n         */\n        this._handler = null;\n        this._handlerIndex = -1;\n        if (options.path) {\n            this.setPath(options.path);\n        }\n    }\n    /**\n     * Assign picking color.\n     * @public\n     * @param {Vec3} color - Picking RGB color.\n     */\n    setPickingColor3v(color) {\n        this._pickingColor[0] = color.x / 255.0;\n        this._pickingColor[1] = color.y / 255.0;\n        this._pickingColor[2] = color.z / 255.0;\n        this._pickingColor[3] = 1.0;\n    }\n    /**\n     * Clears object\n     * @public\n     */\n    clear() {\n        this._path.length = 0;\n        this._path = [];\n        this._verticesHigh.length = 0;\n        this._verticesHigh = [];\n        this._verticesLow.length = 0;\n        this._verticesLow = [];\n        this._indexes.length = 0;\n        this._indexes = [];\n        this._deleteBuffers();\n    }\n    setColor(r, g, b, a) {\n        a = a || this.color[3];\n        this.color[0] = r;\n        this.color[1] = g;\n        this.color[2] = b;\n        this.color[3] = a;\n    }\n    /**\n     * Set strip opacity.\n     * @public\n     * @param {number} opacity - opacity.\n     */\n    setOpacity(opacity) {\n        this.color[3] = opacity || 0;\n    }\n    /**\n     * Sets cloud visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        this.visibility = visibility;\n    }\n    /**\n     * @return {boolean} Strip visibility.\n     */\n    getVisibility() {\n        return this.visibility;\n    }\n    /**\n     * Assign rendering scene node.\n     * @public\n     * @param {RenderNode}  renderNode - Assigned render node.\n     */\n    setRenderNode(renderNode) {\n        this._renderNode = renderNode;\n        this._createBuffers();\n    }\n    /**\n     * Removes from entity.\n     * @public\n     */\n    remove() {\n        this._entity = null;\n        this._handler && this._handler.remove(this);\n    }\n    draw() {\n        if (this.visibility && this._verticesHigh.length) {\n            let r = this._renderNode.renderer;\n            let gl = r.handler.gl;\n            let sh = r.handler.programs.strip, p = sh._program, sha = p.attributes, shu = p.uniforms;\n            sh.activate();\n            gl.disable(gl.CULL_FACE);\n            gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n            gl.uniform4fv(shu.uColor, this.color);\n            gl.uniform1f(shu.uOpacity, this._entity._entityCollection._fadingOpacity);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesHighBuffer);\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this._verticesHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesLowBuffer);\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this._verticesLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n            gl.drawElements(r.handler.gl.TRIANGLE_STRIP, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n            gl.enable(gl.CULL_FACE);\n        }\n    }\n    drawPicking() {\n        if (this.visibility && this._verticesHigh.length) {\n            let r = this._renderNode.renderer;\n            let gl = r.handler.gl;\n            let sh = r.handler.programs.strip, p = sh._program, sha = p.attributes, shu = p.uniforms;\n            sh.activate();\n            gl.disable(gl.CULL_FACE);\n            gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n            gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n            gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n            gl.uniform1f(shu.uOpacity, this._entity._entityCollection._fadingOpacity != 0 ? 1 : 0);\n            gl.uniform4fv(shu.uColor, this._pickingColor);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesHighBuffer);\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this._verticesHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this._verticesLowBuffer);\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this._verticesLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n            gl.drawElements(r.handler.gl.TRIANGLE_STRIP, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n            gl.enable(gl.CULL_FACE);\n        }\n    }\n    /**\n     * Delete buffers\n     * @public\n     */\n    _deleteBuffers() {\n        if (this._renderNode && this._renderNode.renderer) {\n            let r = this._renderNode.renderer, gl = r.handler.gl;\n            gl.deleteBuffer(this._indexBuffer);\n            gl.deleteBuffer(this._verticesHighBuffer);\n            gl.deleteBuffer(this._verticesLowBuffer);\n        }\n        this._verticesHighBuffer = null;\n        this._verticesLowBuffer = null;\n        this._indexBuffer = null;\n    }\n    _createBuffers() {\n        if (this._renderNode && this._renderNode.renderer && this._renderNode.renderer.isInitialized()) {\n            let gl = this._renderNode.renderer.handler.gl;\n            gl.deleteBuffer(this._indexBuffer);\n            gl.deleteBuffer(this._verticesHighBuffer);\n            gl.deleteBuffer(this._verticesLowBuffer);\n            this._verticesHighBuffer = this._renderNode.renderer.handler.createArrayBuffer(new Float32Array(this._verticesHigh), 3, this._verticesHigh.length / 3);\n            this._verticesLowBuffer = this._renderNode.renderer.handler.createArrayBuffer(new Float32Array(this._verticesLow), 3, this._verticesLow.length / 3);\n            this._indexBuffer = this._renderNode.renderer.handler.createElementArrayBuffer(new Uint32Array(this._indexes), 1, this._indexes.length);\n        }\n    }\n    addEdge3v(p2, p3) {\n        let length = this._path.length;\n        if (length === 0) {\n            this._path.push([p2.clone(), p3.clone()]);\n        }\n        else {\n            let p0 = this._path[length - 1][0], p1 = this._path[length - 1][1];\n            this._path.push([p2.clone(), p3.clone()]);\n            let vHigh = this._verticesHigh, vLow = this._verticesLow;\n            let gs = this._gridSize, gs1 = gs + 1;\n            let p = new Vec3();\n            let last = this._verticesHigh.length / 3, ind = last;\n            let d = Math.abs(p0.sub(p1).normal().dot(p2.sub(p0).normal()));\n            for (let i = 0; i < gs1; i++) {\n                let di = i / gs;\n                let p02 = p0.lerp(p2, di), p13 = p1.lerp(p3, di);\n                for (let j = 0; j < gs1; j++) {\n                    let dj = j / gs;\n                    let p01 = p0.lerp(p1, dj), p23 = p2.lerp(p3, dj);\n                    if (d !== 1.0) {\n                        new Line3(p02, p13).intersects(new Line3(p01, p23), p);\n                    }\n                    else {\n                        p = p23;\n                    }\n                    ind = last + i * gs1 + j;\n                    Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\n                    let ind3 = ind * 3;\n                    vHigh[ind3] = _tempHigh.x;\n                    vHigh[ind3 + 1] = _tempHigh.y;\n                    vHigh[ind3 + 2] = _tempHigh.z;\n                    vLow[ind3] = _tempLow.x;\n                    vLow[ind3 + 1] = _tempLow.y;\n                    vLow[ind3 + 2] = _tempLow.z;\n                    if (i < gs) {\n                        this._indexes.push(ind, ind + gs1);\n                    }\n                }\n                if (i < gs) {\n                    this._indexes.push(ind + gs1, ind + 1);\n                }\n            }\n            this._createBuffers();\n        }\n    }\n    setEdge3v(p2, p3, index) {\n        if (index === this._path.length) {\n            this.addEdge3v(p2, p3);\n            return;\n        }\n        if (this._path[index]) {\n            this._path[index][0] = p2;\n            this._path[index][1] = p3;\n            if (this._path.length > 1) {\n                let gs = this._gridSize, gs1 = gs + 1;\n                let vSize = gs1 * gs1;\n                let p = new Vec3();\n                let vHigh = this._verticesHigh, vLow = this._verticesLow;\n                if (index === this._path.length - 1) {\n                    let p0 = this._path[index - 1][0], p1 = this._path[index - 1][1];\n                    let prev = this._verticesHigh.length / 3 - vSize, ind = prev;\n                    let d = Math.abs(p0.sub(p1).normal().dot(p2.sub(p0).normal()));\n                    for (let i = 0; i < gs1; i++) {\n                        let di = i / gs;\n                        let p02 = p0.lerp(p2, di), p13 = p1.lerp(p3, di);\n                        for (let j = 0; j < gs1; j++) {\n                            let dj = j / gs;\n                            let p01 = p0.lerp(p1, dj), p23 = p2.lerp(p3, dj);\n                            if (d !== 1.0) {\n                                new Line3(p02, p13).intersects(new Line3(p01, p23), p);\n                            }\n                            else {\n                                p = p23;\n                            }\n                            ind = prev + i * gs1 + j;\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\n                            let ind3 = ind * 3;\n                            vHigh[ind3] = _tempHigh.x;\n                            vHigh[ind3 + 1] = _tempHigh.y;\n                            vHigh[ind3 + 2] = _tempHigh.z;\n                            vLow[ind3] = _tempLow.x;\n                            vLow[ind3 + 1] = _tempLow.y;\n                            vLow[ind3 + 2] = _tempLow.z;\n                        }\n                    }\n                }\n                else if (index === 0) {\n                    let ind = 0;\n                    let p0 = p2, p1 = p3;\n                    p2 = this._path[1][0];\n                    p3 = this._path[1][1];\n                    for (let i = 0; i < gs1; i++) {\n                        let di = i / gs;\n                        let p02 = p0.lerp(p2, di), p13 = p1.lerp(p3, di);\n                        for (let j = 0; j < gs1; j++) {\n                            let dj = j / gs;\n                            let p01 = p0.lerp(p1, dj), p23 = p2.lerp(p3, dj);\n                            new Line3(p02, p13).intersects(new Line3(p01, p23), p);\n                            ind = i * gs1 + j;\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\n                            let ind3 = ind * 3;\n                            vHigh[ind3] = _tempHigh.x;\n                            vHigh[ind3 + 1] = _tempHigh.y;\n                            vHigh[ind3 + 2] = _tempHigh.z;\n                            vLow[ind3] = _tempLow.x;\n                            vLow[ind3 + 1] = _tempLow.y;\n                            vLow[ind3 + 2] = _tempLow.z;\n                        }\n                    }\n                }\n                else if (index > 0 && index < this._path.length) {\n                    let p0 = this._path[index - 1][0], p1 = this._path[index - 1][1];\n                    let p4 = this._path[index + 1][0], p5 = this._path[index + 1][1];\n                    let next = index * vSize, prev = (index - 1) * vSize, ind = prev;\n                    for (let i = 0; i < gs1; i++) {\n                        let di = i / gs;\n                        let p02 = p0.lerp(p2, di), p35 = p3.lerp(p5, di), p24 = p2.lerp(p4, di), p13 = p1.lerp(p3, di);\n                        for (let j = 0; j < gs1; j++) {\n                            let dj = j / gs;\n                            let p01 = p0.lerp(p1, dj), p23 = p2.lerp(p3, dj);\n                            // prev\n                            new Line3(p02, p13).intersects(new Line3(p01, p23), p);\n                            let ij = i * gs1 + j;\n                            ind = prev + ij;\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\n                            let ind3 = ind * 3;\n                            vHigh[ind3] = _tempHigh.x;\n                            vHigh[ind3 + 1] = _tempHigh.y;\n                            vHigh[ind3 + 2] = _tempHigh.z;\n                            vLow[ind3] = _tempLow.x;\n                            vLow[ind3 + 1] = _tempLow.y;\n                            vLow[ind3 + 2] = _tempLow.z;\n                            // next\n                            let p45 = p4.lerp(p5, dj);\n                            p23 = p2.lerp(p3, dj);\n                            new Line3(p24, p35).intersects(new Line3(p23, p45), p);\n                            ind = next + ij;\n                            Vec3.doubleToTwoFloats(p, _tempHigh, _tempLow);\n                            ind3 = ind * 3;\n                            vHigh[ind3] = _tempHigh.x;\n                            vHigh[ind3 + 1] = _tempHigh.y;\n                            vHigh[ind3 + 2] = _tempHigh.z;\n                            vLow[ind3] = _tempLow.x;\n                            vLow[ind3 + 1] = _tempLow.y;\n                            vLow[ind3 + 2] = _tempLow.z;\n                        }\n                    }\n                }\n                this._createBuffers();\n            }\n        }\n        else {\n            console.warn(`strip index ${index} is out of range`);\n        }\n    }\n    removeEdge(index) {\n        this._path.splice(index, 1);\n        this.setPath([].concat(this._path));\n    }\n    setGridSize(gridSize) {\n        this._gridSize = gridSize;\n        this.setPath([].concat(this._path));\n    }\n    getPath() {\n        return this._path;\n    }\n    setPath(path) {\n        this._verticesHigh = [];\n        this._verticesLow = [];\n        this._indexes = [];\n        this._path = [];\n        for (let i = 0; i < path.length; i++) {\n            let p0 = path[i][0], p1 = path[i][1];\n            if (p0 instanceof Array) {\n                p0 = new Vec3(p0[0], p0[1], p0[2]);\n            }\n            if (p1 instanceof Array) {\n                p1 = new Vec3(p1[0], p1[1], p1[2]);\n            }\n            this.addEdge3v(p0, p1);\n        }\n    }\n    insertEdge3v(p0, p1, index) {\n        if (index < this._path.length) {\n            let p = [].concat(this._path);\n            p.splice(index, 0, [p0, p1]);\n            this.setPath(p);\n        }\n        else if (index === this._path.length) {\n            this.addEdge3v(p0, p1);\n        }\n    }\n}\nStrip.__counter__ = 0;\nexport { Strip };\n//# sourceMappingURL=Strip.js.map","import * as mercator from \"../mercator\";\nimport * as utils from \"../utils/shared\";\nimport { Billboard } from \"./Billboard\";\nimport { Extent } from \"../Extent\";\nimport { Geometry } from \"./Geometry\";\nimport { GeoObject } from \"./GeoObject\";\nimport { LonLat } from \"../LonLat\";\nimport { Label } from \"./Label\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { PointCloud } from \"./PointCloud\";\nimport { Polyline } from \"./Polyline\";\nimport { Ray } from \"./Ray\";\nimport { Strip } from \"./Strip\";\n/**\n * Entity instances aggregate multiple forms of visualization into a single high-level object.\n * They can be created manually and added to entity collection.\n *\n * @class\n * @param {Object} [options] - Entity options:\n * @param {string} [options.name] - A human-readable name to display to users. It does not have to be unique.\n * @param {Vec3|Array.<number>} [options.cartesian] - Spatial entities like billboard, label etc. cartesian position.\n * @param {LonLat} [options.lonlat] - Geodetic coordinates for an entities like billboard, label etc.\n * @param {boolean} [options.aground] - True for entities that have to be placed on the relief.\n * @param {boolean} [options.visibility] - Entity visibility.\n * @param {*} [options.billboard] - Billboard options(see {@link Billboard}).\n * @param {*} [options.label] - Label options(see {@link Label}).\n * @param {*} [options.polyline] - Polyline options(see {@link Polyline}).\n * @param {*} [options.ray] - Ray options(see {@link Ray}).\n * @param {*} [options.pointCloud] - Point cloud options(see {@link PointCloud}).\n * @param {*} [options.geometry] - Geometry options (see {@link Geometry}), available for vector layer only.\n * @param {*} [options.properties] - Entity custom properties.\n */\nclass Entity {\n    constructor(options = {}) {\n        options.properties = options.properties || {};\n        this.__id = Entity.__counter__++;\n        this.properties = options.properties || {};\n        this.properties.name = this.properties.name != undefined ? this.properties.name : \"\";\n        this.childrenNodes = [];\n        this.parent = null;\n        this._cartesian = utils.createVector3(options.cartesian);\n        this._lonLat = utils.createLonLat(options.lonlat);\n        this._lonLatMerc = new LonLat();\n        this._altitude = options.altitude || 0.0;\n        this._visibility = options.visibility != undefined ? options.visibility : true;\n        this._entityCollection = null;\n        this._entityCollectionIndex = -1;\n        this._layer = null;\n        this._layerIndex = -1;\n        this._pickingColor = new Vec3(0, 0, 0);\n        this._featureConstructorArray = {\n            billboard: [Billboard, this.setBillboard],\n            label: [Label, this.setLabel],\n            polyline: [Polyline, this.setPolyline],\n            pointCloud: [PointCloud, this.setPointCloud],\n            geometry: [Geometry, this.setGeometry],\n            geoObject: [GeoObject, this.setGeoObject],\n            strip: [Strip, this.setStrip],\n            ray: [Ray, this.setRay]\n        };\n        this.billboard = this._createOptionFeature(\"billboard\", options.billboard);\n        this.label = this._createOptionFeature(\"label\", options.label);\n        this.polyline = this._createOptionFeature(\"polyline\", options.polyline);\n        this.ray = this._createOptionFeature(\"ray\", options.ray);\n        this.pointCloud = this._createOptionFeature(\"pointCloud\", options.pointCloud);\n        this.geometry = this._createOptionFeature(\"geometry\", options.geometry);\n        this.geoObject = this._createOptionFeature(\"geoObject\", options.geoObject);\n        this.strip = this._createOptionFeature(\"strip\", options.strip);\n    }\n    get id() {\n        return this.__id;\n    }\n    isEqual(entity) {\n        return this.__id === entity.__id;\n    }\n    get layerIndex() {\n        return this._layerIndex;\n    }\n    get instanceName() {\n        return \"Entity\";\n    }\n    _createOptionFeature(featureName, options) {\n        if (options) {\n            let c = this._featureConstructorArray[featureName];\n            return c[1].call(this, new c[0](options));\n        }\n        return null;\n    }\n    getCollectionIndex() {\n        return this._entityCollectionIndex;\n    }\n    /**\n     * Adds current entity into the specified entity collection.\n     * @public\n     * @param {EntityCollection | Vector} collection - Specified entity collection or vector layer.\n     * @param {Boolean} [rightNow=false] - Entity insertion option for vector layer.\n     * @returns {Entity} - This object.\n     */\n    addTo(collection, rightNow = false) {\n        collection.add(this, rightNow);\n        return this;\n    }\n    /**\n     * Removes current entity from collection and layer.\n     * @public\n     */\n    remove() {\n        this._layer && this._layer.removeEntity(this);\n        this._entityCollection && this._entityCollection.removeEntity(this);\n    }\n    /**\n     * Sets the entity visibility.\n     * @public\n     * @param {boolean} visibility - Entity visibility.\n     */\n    setVisibility(visibility) {\n        this._visibility = visibility;\n        // billboards\n        this.billboard && this.billboard.setVisibility(visibility);\n        // geoObject\n        this.geoObject && this.geoObject.setVisibility(visibility);\n        // labels\n        this.label && this.label.setVisibility(visibility);\n        // polyline\n        this.polyline && this.polyline.setVisibility(visibility);\n        // ray\n        this.ray && this.ray.setVisibility(visibility);\n        // geometry\n        this.geometry && this.geometry.setVisibility(visibility);\n        for (let i = 0; i < this.childrenNodes.length; i++) {\n            this.childrenNodes[i].setVisibility(visibility);\n        }\n    }\n    /**\n     * Returns entity visibility.\n     * @public\n     * @returns {boolean} -\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Sets entity cartesian position.\n     * @public\n     * @param {Vec3} cartesian - Cartesian position in 3d space.\n     */\n    setCartesian3v(cartesian) {\n        this.setCartesian(cartesian.x, cartesian.y, cartesian.z);\n    }\n    /**\n     * Sets entity cartesian position.\n     * @public\n     * @param {number} x - 3d space X - position.\n     * @param {number} y - 3d space Y - position.\n     * @param {number} z - 3d space Z - position.\n     */\n    setCartesian(x, y, z) {\n        let p = this._cartesian;\n        p.x = x || 0.0;\n        p.y = y || 0.0;\n        p.z = z || 0.0;\n        // billboards\n        this.billboard && this.billboard.setPosition3v(p);\n        // geoObject\n        this.geoObject && this.geoObject.setPosition3v(p);\n        // labels\n        this.label && this.label.setPosition3v(p);\n        for (let i = 0; i < this.childrenNodes.length; i++) {\n            this.childrenNodes[i].setCartesian(x, y, z);\n        }\n        let ec = this._entityCollection;\n        if (ec && ec.renderNode && ec.renderNode.ellipsoid) {\n            this._lonLat = ec.renderNode.ellipsoid.cartesianToLonLat(p);\n            if (Math.abs(this._lonLat.lat) < mercator.MAX_LAT) {\n                this._lonLatMerc = this._lonLat.forwardMercator();\n            }\n            else {\n                this._lonLatMerc.lon = this._lonLatMerc.lat = this._lonLatMerc.height = 0;\n            }\n        }\n        //ec && ec.events.dispatch(ec.events.entitymove, this);\n    }\n    /**\n     * Sets entity cartesian position without event dispatching.\n     * @public\n     * @param {Vec3} cartesian - Cartesian position in 3d space.\n     * @param {boolean} skipLonLat - skip geodetic calculation.\n     */\n    _setCartesian3vSilent(cartesian, skipLonLat = false) {\n        let p = this._cartesian;\n        p.x = cartesian.x || 0.0;\n        p.y = cartesian.y || 0.0;\n        p.z = cartesian.z || 0.0;\n        // billboards\n        this.billboard && this.billboard.setPosition3v(p);\n        // geoObject\n        this.geoObject && this.geoObject.setPosition3v(p);\n        // labels\n        this.label && this.label.setPosition3v(p);\n        for (let i = 0; i < this.childrenNodes.length; i++) {\n            this.childrenNodes[i].setCartesian(p.x, p.y, p.z);\n        }\n        let ec = this._entityCollection;\n        if (!skipLonLat && ec && ec.renderNode && ec.renderNode.ellipsoid) {\n            this._lonLat = ec.renderNode.ellipsoid.cartesianToLonLat(p);\n            if (Math.abs(this._lonLat.lat) < mercator.MAX_LAT) {\n                this._lonLatMerc = this._lonLat.forwardMercator();\n            }\n            else {\n                //this._lonLatMerc = null;\n            }\n        }\n    }\n    /**\n     * Gets entity geodetic coordinates.\n     * @public\n     * @returns {LonLat} -\n     */\n    getLonLat() {\n        return this._lonLat.clone();\n    }\n    /**\n     * Sets geodetic coordinates of the entity point object.\n     * @public\n     * @param {LonLat} lonlat - WGS84 coordinates.\n     */\n    setLonLat(lonlat) {\n        let l = this._lonLat;\n        l.lon = lonlat.lon;\n        l.lat = lonlat.lat;\n        l.height = lonlat.height;\n        let ec = this._entityCollection;\n        if (ec && ec.renderNode && ec.renderNode.ellipsoid) {\n            if (Math.abs(l.lat) < mercator.MAX_LAT) {\n                this._lonLatMerc = l.forwardMercator();\n            }\n            else {\n                //this._lonLatMerc = null;\n            }\n            ec.renderNode.ellipsoid.lonLatToCartesianRes(l, this._cartesian);\n            this.setCartesian3v(this._cartesian);\n        }\n    }\n    /**\n     * Sets geodetic coordinates of the entity point object.\n     * @public\n     * @param {number} lon - Longitude.\n     * @param {number} lat - Latitude\n     * @param {number} [height] - Height\n     */\n    setLonLat2(lon, lat, height) {\n        let l = this._lonLat;\n        l.lon = lon;\n        l.lat = lat;\n        l.height = height != undefined ? height : l.height;\n        let ec = this._entityCollection;\n        if (ec && ec.renderNode && ec.renderNode.ellipsoid) {\n            if (Math.abs(l.lat) < mercator.MAX_LAT) {\n                this._lonLatMerc = l.forwardMercator();\n            }\n            else {\n                this._lonLatMerc.lon = this._lonLatMerc.lat = this._lonLatMerc.height = 0;\n            }\n            ec.renderNode.ellipsoid.lonLatToCartesianRes(l, this._cartesian);\n            this.setCartesian3v(this._cartesian);\n        }\n    }\n    /**\n     * Sets entity altitude over the planet.\n     * @public\n     * @param {number} altitude - Altitude.\n     */\n    setAltitude(altitude) {\n        this._altitude = altitude;\n    }\n    /**\n     * Sets entity altitude over the planet.\n     * @public\n     * @return {number} Altitude.\n     */\n    getAltitude() {\n        return this._altitude;\n    }\n    /**\n     * Returns cartesian position.\n     * @public\n     * @returns {Vec3} -\n     */\n    getCartesian() {\n        return this._cartesian.clone();\n    }\n    /**\n     * Sets entity billboard.\n     * @public\n     * @param {Billboard} billboard - Billboard object.\n     * @returns {Billboard} -\n     */\n    setBillboard(billboard) {\n        if (this.billboard) {\n            this.billboard.remove();\n        }\n        this.billboard = billboard;\n        this.billboard._entity = this;\n        this.billboard.setPosition3v(this._cartesian);\n        this.billboard.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.billboardHandler.add(billboard);\n        return billboard;\n    }\n    /**\n     * Sets entity label.\n     * @public\n     * @param {Label} label - Text label.\n     * @returns {Label} -\n     */\n    setLabel(label) {\n        if (this.label) {\n            this.label.remove();\n        }\n        this.label = label;\n        this.label._entity = this;\n        this.label.setPosition3v(this._cartesian);\n        this.label.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.labelHandler.add(label);\n        return label;\n    }\n    /**\n     * Sets entity ray.\n     * @public\n     * @param {Ray} ray - Ray object.\n     * @returns {Ray} -\n     */\n    setRay(ray) {\n        if (this.ray) {\n            this.ray.remove();\n        }\n        this.ray = ray;\n        this.ray._entity = this;\n        this.ray.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.rayHandler.add(ray);\n        return ray;\n    }\n    /**\n     * Sets entity polyline.\n     * @public\n     * @param {Polyline} polyline - Polyline object.\n     * @returns {Polyline} -\n     */\n    setPolyline(polyline) {\n        if (this.polyline) {\n            this.polyline.remove();\n        }\n        this.polyline = polyline;\n        this.polyline._entity = this;\n        this.polyline.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.polylineHandler.add(polyline);\n        return polyline;\n    }\n    /**\n     * Sets entity pointCloud.\n     * @public\n     * @param {PointCloud} pointCloud - PointCloud object.\n     * @returns {PointCloud} -\n     */\n    setPointCloud(pointCloud) {\n        if (this.pointCloud) {\n            this.pointCloud.remove();\n        }\n        this.pointCloud = pointCloud;\n        this.pointCloud._entity = this;\n        this.pointCloud.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.pointCloudHandler.add(pointCloud);\n        return pointCloud;\n    }\n    /**\n     * Sets entity geometry.\n     * @public\n     * @param {Geometry} geometry - Geometry object.\n     * @returns {Geometry} -\n     */\n    setGeometry(geometry) {\n        if (this.geometry) {\n            this.geometry.remove();\n        }\n        this.geometry = geometry;\n        this.geometry._entity = this;\n        this.geometry.setVisibility(this._visibility);\n        let layer = this._layer;\n        if (this._layer) {\n            this._layer.removeEntity(this);\n        }\n        layer && layer.add(this);\n        return geometry;\n    }\n    /**\n     * Sets entity geoObject.\n     * @public\n     * @param {GeoObject} geoObject - GeoObject.\n     * @returns {GeoObject} -\n     */\n    setGeoObject(geoObject) {\n        if (this.geoObject) {\n            this.geoObject.remove();\n        }\n        this.geoObject = geoObject;\n        this.geoObject._entity = this;\n        this.geoObject.setPosition3v(this._cartesian);\n        this.geoObject.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.geoObjectHandler.add(geoObject);\n        return geoObject;\n    }\n    /**\n     * Sets entity strip.\n     * @public\n     * @param {Strip} strip - Strip object.\n     * @returns {Strip} -\n     */\n    setStrip(strip) {\n        if (this.strip) {\n            this.strip.remove();\n        }\n        this.strip = strip;\n        this.strip._entity = this;\n        this.strip.setVisibility(this._visibility);\n        this._entityCollection && this._entityCollection.stripHandler.add(strip);\n        return strip;\n    }\n    get layer() {\n        return this._layer;\n    }\n    get rendererEvents() {\n        if (this._layer) {\n            return this._layer.events;\n        }\n        else if (this._entityCollection) {\n            return this._entityCollection.events;\n        }\n        return null;\n    }\n    /**\n     * Append child entity.\n     * @public\n     * @param {Entity} entity - Child entity.\n     */\n    appendChild(entity) {\n        entity._entityCollection = this._entityCollection;\n        entity._pickingColor = this._pickingColor;\n        entity.parent = this;\n        this.childrenNodes.push(entity);\n        this._entityCollection && this._entityCollection.appendChildEntity(entity);\n    }\n    /**\n     * Appends entity items(billboard, label etc.) picking color.\n     * @public\n     */\n    setPickingColor() {\n        let c = this._pickingColor;\n        this.billboard && this.billboard.setPickingColor3v(c);\n        this.label && this.label.setPickingColor3v(c);\n        this.polyline && this.polyline.setPickingColor3v(c);\n        this.ray && this.ray.setPickingColor3v(c);\n        this.strip && this.strip.setPickingColor3v(c);\n        this.geoObject && this.geoObject.setPickingColor3v(c);\n        for (let i = 0; i < this.childrenNodes.length; i++) {\n            this.childrenNodes[i].setPickingColor();\n        }\n    }\n    /**\n     * Return geodetic extent.\n     * @public\n     * @returns {Extent} -\n     */\n    getExtent() {\n        let res;\n        let c = this._lonLat;\n        if (this.billboard || this.label) {\n            res = new Extent(new LonLat(c.lon, c.lat), new LonLat(c.lon, c.lat));\n        }\n        else {\n            res = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\n        }\n        let sw = res.southWest, ne = res.northEast;\n        if (this.polyline) {\n            let e = this.polyline.getExtent();\n            if (e.southWest.lon < sw.lon)\n                sw.lon = e.southWest.lon;\n            if (e.southWest.lat < sw.lat)\n                sw.lat = e.southWest.lat;\n            if (e.northEast.lon > ne.lon)\n                ne.lon = e.northEast.lon;\n            if (e.northEast.lat > ne.lat)\n                ne.lat = e.northEast.lat;\n        }\n        if (this.geometry) {\n            let e = this.geometry.getExtent();\n            if (e.southWest.lon < sw.lon)\n                sw.lon = e.southWest.lon;\n            if (e.southWest.lat < sw.lat)\n                sw.lat = e.southWest.lat;\n            if (e.northEast.lon > ne.lon)\n                ne.lon = e.northEast.lon;\n            if (e.northEast.lat > ne.lat)\n                ne.lat = e.northEast.lat;\n        }\n        for (let i = 0; i < this.childrenNodes.length; i++) {\n            let e = this.childrenNodes[i].getExtent();\n            if (e.southWest.lon < sw.lon)\n                sw.lon = e.southWest.lon;\n            if (e.southWest.lat < sw.lat)\n                sw.lat = e.southWest.lat;\n            if (e.northEast.lon > ne.lon)\n                ne.lon = e.northEast.lon;\n            if (e.northEast.lat > ne.lat)\n                ne.lat = e.northEast.lat;\n        }\n        return res;\n    }\n}\nEntity.__counter__ = 0;\nexport { Entity };\n//# sourceMappingURL=Entity.js.map","export function objParser(text) {\n    const objPositions = [[0, 0, 0]];\n    const objTexcoords = [[0, 0]];\n    const objNormals = [[0, 0, 0]];\n    // same order as `f` indices\n    const objVertexData = [\n        objPositions,\n        objTexcoords,\n        objNormals,\n    ];\n    // same order as `f` indices\n    let vertexData = [\n        [],\n        [],\n        [], // normals\n    ];\n    const materialLibs = [];\n    const geometries = [];\n    let geometry;\n    let groups = ['default'];\n    let material = 'default';\n    let object = 'default';\n    function newGeometry() {\n        // If there is an existing geometry and it's\n        // not empty then start a new one.\n        if (geometry && geometry.data.vertices.length) {\n            geometry = null;\n        }\n    }\n    function setGeometry() {\n        if (!geometry) {\n            const vertices = [];\n            const textures = [];\n            const normals = [];\n            vertexData = [\n                vertices,\n                textures,\n                normals,\n            ];\n            geometry = {\n                object,\n                groups,\n                material,\n                data: {\n                    vertices,\n                    textures,\n                    normals,\n                },\n            };\n            geometries.push(geometry);\n        }\n    }\n    function addVertex(vert) {\n        const ptn = vert.split('/');\n        ptn.forEach((objIndexStr, i) => {\n            if (!objIndexStr) {\n                return;\n            }\n            const objIndex = parseInt(objIndexStr);\n            const index = objIndex + (objIndex >= 0 ? 0 : objVertexData[i].length);\n            vertexData[i].push(...objVertexData[i][index]);\n        });\n    }\n    const keywords = {\n        v(parts) {\n            objPositions.push(parts.map(parseFloat));\n        },\n        vn(parts) {\n            objNormals.push(parts.map(parseFloat));\n        },\n        vt(parts) {\n            // should check for missing v and extra w?\n            objTexcoords.push(parts.map(parseFloat));\n        },\n        f(parts) {\n            setGeometry();\n            const numTriangles = parts.length - 2;\n            for (let tri = 0; tri < numTriangles; ++tri) {\n                addVertex(parts[0]);\n                addVertex(parts[tri + 1]);\n                addVertex(parts[tri + 2]);\n            }\n        },\n        s: () => {\n        },\n        mtllib(parts, unparsedArgs) {\n            // the spec says there can be multiple filenames here\n            // but many exist with spaces in a single filename\n            materialLibs.push(unparsedArgs);\n        },\n        usemtl(parts, unparsedArgs) {\n            material = unparsedArgs;\n            newGeometry();\n        },\n        g(parts) {\n            groups = parts;\n            newGeometry();\n        },\n        o(parts, unparsedArgs) {\n            object = unparsedArgs;\n            newGeometry();\n        },\n    };\n    const keywordRE = /(\\w*)(?: )*(.*)/;\n    const lines = text.split('\\n');\n    for (let lineNo = 0; lineNo < lines.length; ++lineNo) {\n        const line = lines[lineNo].trim();\n        if (line === '' || line.startsWith('#')) {\n            continue;\n        }\n        const m = keywordRE.exec(line);\n        if (!m) {\n            continue;\n        }\n        const [, keyword, unparsedArgs] = m;\n        const parts = line.split(/\\s+/).slice(1);\n        const handler = keywords[keyword];\n        if (!handler) {\n            console.warn('unhandled keyword:', keyword); // eslint-disable-line no-console\n            continue;\n        }\n        handler(parts, unparsedArgs);\n    }\n    // remove any arrays that have no entries.\n    for (const geometry of geometries) {\n        geometry.data = Object.fromEntries(Object.entries(geometry.data).filter(([key, array]) => array.length > 0));\n    }\n    return {\n        geometries,\n        materialLibs,\n    };\n}\nexport function transformLeftToRightCoordinateSystem(objData) {\n    const convertedGeometries = objData.geometries.map(geometry => {\n        const vertices = geometry.data.vertices;\n        const normals = geometry.data.normals;\n        const textures = geometry.data.textures;\n        rotateObject(geometry.data, 0);\n        let convertedVertices = [];\n        let convertedNormals = [];\n        let convertedTextures = [];\n        // Convert positions\n        for (let i = 0; i < vertices.length; i += 3) {\n            const x = vertices[i];\n            const y = vertices[i + 1];\n            const z = vertices[i + 2];\n            convertedVertices.push(x, y, z);\n        }\n        // Convert normals\n        for (let i = 0; i < normals.length; i += 3) {\n            const x = normals[i];\n            const y = normals[i + 1];\n            const z = normals[i + 2];\n            convertedNormals.push(x, y, -z);\n        }\n        // Convert textures\n        for (let i = 0; i < textures.length; i += 2) {\n            const s = textures[i];\n            const t = 1 - textures[i + 1];\n            convertedTextures.push(s, t);\n        }\n        return {\n            object: geometry.object,\n            groups: geometry.groups,\n            material: geometry.material,\n            data: {\n                vertices: convertedVertices,\n                normals: convertedNormals,\n                textures: convertedTextures\n            }\n        };\n    });\n    return {\n        geometries: convertedGeometries,\n        materialLibs: objData.materialLibs\n    };\n}\nfunction rotateObject(obj, angle) {\n    const cosA = Math.cos(angle);\n    const sinA = Math.sin(angle);\n    const vertices = obj.vertices;\n    const normals = obj.normals;\n    for (let i = 0; i < vertices.length; i += 3) {\n        const x = vertices[i];\n        const y = vertices[i + 1];\n        const z = vertices[i + 2];\n        vertices[i] = x * cosA + z * sinA;\n        vertices[i + 1] = y;\n        vertices[i + 2] = -x * sinA + z * cosA;\n        const nx = normals[i];\n        const ny = normals[i + 1];\n        const nz = normals[i + 2];\n        normals[i] = nx * cosA + nz * sinA;\n        normals[i + 1] = ny;\n        normals[i + 2] = -nx * sinA + nz * cosA;\n    }\n    return {\n        vertices: vertices,\n        normals: normals\n    };\n}\n//# sourceMappingURL=objParser.js.map","import { htmlColorToFloat32Array } from './utils/shared';\nimport { Vec3 } from './math/Vec3';\nimport { MAX, MIN } from './math';\nimport { transformLeftToRightCoordinateSystem, objParser } from \"./utils/objParser\";\nfunction getColor(color) {\n    if (color instanceof Array) {\n        return new Float32Array(color);\n    }\n    else if (typeof color === 'string') {\n        return htmlColorToFloat32Array(color);\n    }\n    return new Float32Array([1.0, 1.0, 1.0, 1.0]);\n}\nclass Object3d {\n    constructor(data = {}) {\n        this._name = data.name || \"noname\";\n        this._vertices = data.vertices || [];\n        this._numVertices = this._vertices.length / 3;\n        this._texCoords = data.texCoords || new Array(2 * this._numVertices);\n        if (data.center) {\n            Object3d.centering(this._vertices);\n        }\n        /**\n         * Image src.\n         * @protected\n         * @type {string}\n         */\n        this._src = data.src || null;\n        this.color = getColor(data.color);\n        if (data.scale) {\n            Object3d.scale(this._vertices, data.scale);\n        }\n        if (data.indices) {\n            this._indices = data.indices;\n            this._normals = data.normals || [];\n        }\n        else {\n            this._normals = Object3d.getNormals(this._vertices);\n            this._indices = new Array(this._vertices.length / 3);\n            for (let i = 0, len = this._indices.length; i < len; i++) {\n                this._indices[i] = i;\n            }\n        }\n    }\n    static centering(verts) {\n        let min_x = MAX, min_y = MAX, min_z = MAX, max_x = MIN, max_y = MIN, max_z = MIN;\n        for (let i = 0, len = verts.length; i < len; i += 3) {\n            let x = verts[i], y = verts[i + 1], z = verts[i + 2];\n            if (x < min_x)\n                min_x = x;\n            if (y < min_y)\n                min_y = y;\n            if (z < min_z)\n                min_z = z;\n            if (x > max_x)\n                max_x = x;\n            if (y > max_y)\n                max_y = y;\n            if (z > max_z)\n                max_z = z;\n        }\n        let c_x = min_x + (max_x - min_x) * 0.5;\n        let c_y = min_y + (max_y - min_y) * 0.5;\n        let c_z = min_z + (max_z - min_z) * 0.5;\n        for (let i = 0, len = verts.length; i < len; i += 3) {\n            verts[i] -= c_x;\n            verts[i + 1] -= c_y;\n            verts[i + 2] -= c_z;\n        }\n    }\n    get src() {\n        return this._src;\n    }\n    set src(src) {\n        this._src = src;\n    }\n    get name() {\n        return this._name;\n    }\n    get vertices() {\n        return this._vertices;\n    }\n    get normals() {\n        return this._normals;\n    }\n    get indices() {\n        return this._indices;\n    }\n    get texCoords() {\n        return this._texCoords;\n    }\n    get numVertices() {\n        return this._numVertices;\n    }\n    static scale(vertices, s) {\n        for (let i = 0; i < vertices.length; i++) {\n            vertices[i] *= s;\n        }\n    }\n    static centroid(vertices) {\n        let minX = 1000.0, minY = 1000.0, minZ = 1000.0, maxX = -1000.0, maxY = -1000.0, maxZ = -1000.0;\n        for (let i = 0; i < vertices.length; i += 3) {\n            let x = vertices[i], y = vertices[i + 1], z = vertices[i + 2];\n            if (x < minX)\n                minX = x;\n            if (y < minY)\n                minY = y;\n            if (z < minZ)\n                minZ = z;\n            if (x > maxX)\n                maxX = x;\n            if (y > maxY)\n                maxY = y;\n            if (z > maxZ)\n                maxZ = z;\n        }\n        return [minX + (maxX - minX) * 0.5, minY + (maxY - minY) * 0.5, minZ + (maxZ - minZ) * 0.5];\n    }\n    static translate(vertices, v) {\n        for (let i = 0; i < vertices.length; i += 3) {\n            vertices[i] -= v[0];\n            vertices[i + 1] -= v[1];\n            vertices[i + 2] -= v[2];\n        }\n    }\n    static getNormals(vertices) {\n        let res = new Array(vertices.length);\n        for (let i = 0; i < vertices.length; i += 9) {\n            let t03 = i, t13 = i + 3, t23 = i + 6, v0_x = vertices[t03], v0_y = vertices[t03 + 1], v0_z = vertices[t03 + 2], v1_x = vertices[t13], v1_y = vertices[t13 + 1], v1_z = vertices[t13 + 2], v2_x = vertices[t23], v2_y = vertices[t23 + 1], v2_z = vertices[t23 + 2], vv0_x = v1_x - v0_x, vv0_y = v1_y - v0_y, vv0_z = v1_z - v0_z, vv1_x = v2_x - v0_x, vv1_y = v2_y - v0_y, vv1_z = v2_z - v0_z, n_x = vv0_y * vv1_z - vv0_z * vv1_y, n_y = vv0_z * vv1_x - vv0_x * vv1_z, n_z = vv0_x * vv1_y - vv0_y * vv1_x;\n            let l = Math.sqrt(n_x * n_x + n_y * n_y + n_z * n_z);\n            n_x /= l;\n            n_y /= l;\n            n_z /= l;\n            res[t03] = n_x;\n            res[t03 + 1] = n_y;\n            res[t03 + 2] = n_z;\n            res[t13] = n_x;\n            res[t13 + 1] = n_y;\n            res[t13 + 2] = n_z;\n            res[t23] = n_x;\n            res[t23 + 1] = n_y;\n            res[t23 + 2] = n_z;\n        }\n        return res;\n    }\n    static createSphere(lonBands = 16, latBands = 16, radius = 1.0, offsetX = 0, offsetY = 0, offsetZ = 0) {\n        let vertices = [], indices = [], normals = [];\n        for (let latNumber = 0; latNumber <= latBands; latNumber++) {\n            let theta = latNumber * Math.PI / latBands;\n            let sinTheta = Math.sin(theta);\n            let cosTheta = Math.cos(theta);\n            for (let longNumber = 0; longNumber <= lonBands; longNumber++) {\n                let phi = longNumber * 2 * Math.PI / lonBands;\n                let sinPhi = Math.sin(phi);\n                let cosPhi = Math.cos(phi);\n                let x = cosPhi * sinTheta + offsetX;\n                let y = cosTheta + offsetY;\n                let z = sinPhi * sinTheta + offsetZ;\n                //var u = 1 - (longNumber / lonBands);\n                //var v = latNumber / latBands;\n                normals.push(x);\n                normals.push(y);\n                normals.push(z);\n                //texCoords.push(u);\n                //texCoords.push(v);\n                vertices.push(radius * x);\n                vertices.push(radius * y);\n                vertices.push(radius * z);\n            }\n        }\n        for (let latNumber = 0; latNumber < latBands; latNumber++) {\n            for (let longNumber = 0; longNumber < lonBands; longNumber++) {\n                let first = (latNumber * (lonBands + 1)) + longNumber;\n                let second = first + lonBands + 1;\n                indices.push(first);\n                indices.push(first + 1);\n                indices.push(second);\n                indices.push(second);\n                indices.push(first + 1);\n                indices.push(second + 1);\n            }\n        }\n        return new Object3d({\n            'vertices': vertices, 'normals': normals, 'indices': indices\n        });\n    }\n    static createDisc(radius = 1.0, height = 0.0, radialSegments = 8, isTop = true, startIndex = 0, offsetX = 0, offsetY = 0, offsetZ = 0) {\n        let vertices = [], indices = [], normals = [];\n        let thetaStart = 0.0, thetaLength = Math.PI * 2;\n        let sign = isTop ? 1.0 : -1.0;\n        let centerIndexStart = startIndex;\n        for (let x = 1; x <= radialSegments; x++) {\n            vertices.push(offsetX, height * sign + offsetY, offsetZ);\n            normals.push(0, sign, 0);\n            //texCoords.push(0.5, 0.5);\n            startIndex++;\n        }\n        let centerIndexEnd = startIndex;\n        for (let x = 0; x <= radialSegments; x++) {\n            let u = x / radialSegments;\n            let theta = u * thetaLength + thetaStart;\n            let cosTheta = Math.cos(theta);\n            let sinTheta = Math.sin(theta);\n            vertices.push(radius * sinTheta + offsetX, height * sign + offsetY, radius * cosTheta + offsetZ);\n            normals.push(0, sign, 0);\n            //texCoords.push((cosTheta * 0.5) + 0.5, (sinTheta * 0.5 * sign) + 0.5);\n            startIndex++;\n        }\n        for (let x = 0; x < radialSegments; x++) {\n            let c = centerIndexStart + x, i = centerIndexEnd + x;\n            if (isTop) {\n                indices.push(i, i + 1, c);\n            }\n            else {\n                indices.push(i + 1, i, c);\n            }\n        }\n        return new Object3d({\n            'vertices': vertices, 'normals': normals, 'indices': indices\n        });\n    }\n    static createCylinder(radiusTop = 1.0, radiusBottom = 1.0, height = 1.0, radialSegments = 32, heightSegments = 1.0, isTop = true, isBottom = true, offsetX = 0, offsetY = 0, offsetZ = 0) {\n        let vertices = [], indices = [], normals = [];\n        let thetaStart = 0.0, thetaLength = Math.PI * 2;\n        let index = 0;\n        let indexArray = [];\n        let normal = new Vec3();\n        let slope = (radiusBottom - radiusTop) / height;\n        for (let y = 0; y <= heightSegments; y++) {\n            let indexRow = [];\n            let v = y / heightSegments;\n            let radius = v * (radiusBottom - radiusTop) + radiusTop;\n            for (let x = 0; x <= radialSegments; x++) {\n                let u = x / radialSegments;\n                let theta = u * thetaLength + thetaStart;\n                let sinTheta = Math.sin(theta), cosTheta = Math.cos(theta);\n                vertices.push(radius * sinTheta + offsetX, -v * height + height + offsetY, radius * cosTheta + offsetZ);\n                normal.set(sinTheta, slope, cosTheta).normalize();\n                normals.push(normal.x, normal.y, normal.z);\n                //texCoords.push(u, 1 - v);\n                indexRow.push(index++);\n            }\n            indexArray.push(indexRow);\n        }\n        for (let x = 0; x < radialSegments; x++) {\n            for (let y = 0; y < heightSegments; y++) {\n                let a = indexArray[y][x], b = indexArray[y + 1][x], c = indexArray[y + 1][x + 1], d = indexArray[y][x + 1];\n                indices.push(a, b, d);\n                indices.push(b, c, d);\n            }\n        }\n        if (radiusTop !== 0.0 && isTop) {\n            let cap = Object3d.createDisc(radiusTop, height, radialSegments, true, index, offsetX, offsetY, offsetZ);\n            vertices.push(...cap.vertices);\n            normals.push(...cap.normals);\n            indices.push(...cap.indices);\n        }\n        if (radiusBottom !== 0.0 && isBottom) {\n            let cap = Object3d.createDisc(radiusBottom, 0, radialSegments, false, index + (isTop ? (1 + 2 * radialSegments) : 0), offsetX, offsetY, offsetZ);\n            vertices.push(...cap.vertices);\n            normals.push(...cap.normals);\n            indices.push(...cap.indices);\n        }\n        return new Object3d({\n            vertices: vertices,\n            normals: normals,\n            indices: indices\n        });\n    }\n    static createCube(length = 1, height = 1, depth = 1, xOffset = 0, yOffset = 0, zOffset = 0) {\n        let l = length * 0.5 + xOffset, h = height * 0.5 + yOffset, d = depth * 0.5 + zOffset;\n        return new Object3d({\n            vertices: [\n                -l, -h, d, l, -h, -d, l, -h, d, -l, -h, d, -l, -h, -d, l, -h, -d,\n                //top\n                -l, h, d, l, h, d, l, h, -d, -l, h, d, l, h, -d, -l, h, -d,\n                //front\n                -l, -h, d, l, -h, d, -l, h, d, -l, h, d, l, -h, d, l, h, d,\n                //back\n                -l, -h, -d, -l, h, -d, l, -h, -d, -l, h, -d, l, h, -d, l, -h, -d,\n                //left\n                l, -h, d, l, -h, -d, l, h, d, l, h, d, l, -h, -d, l, h, -d,\n                //right\n                -l, -h, d, -l, h, d, -l, -h, -d, -l, h, d, -l, h, -d, -l, -h, -d\n            ]\n        });\n    }\n    static createArrow(back = 0.0, height = 2.1, front = -15) {\n        return new Object3d({\n            vertices: [0, height, 0, 7, 0, 6, 0, 0, front,\n                0, 0, back, 7, 0, 6, 0, height, 0,\n                -7, 0, 6, 0, 0, back, 0, height, 0,\n                -7, 0, 6, 0, height, 0, 0, 0, front,\n                -7, 0, 6, 0, 0, front, 0, 0, back, 0, 0, back, 0, 0, front, 7, 0, 6]\n        });\n    }\n    static async loadObj(src) {\n        const obj = await fetch(src, { mode: \"cors\", })\n            .then((response) => response.text())\n            .then((data) => transformLeftToRightCoordinateSystem(objParser(data)))\n            .catch(() => []);\n        return obj.geometries.map(({ data: { vertices, normals, textures } }) => new Object3d({\n            vertices,\n            normals,\n            texCoords: textures\n        }));\n    }\n}\nexport { Object3d };\n//# sourceMappingURL=Object3d.js.map","/**\n * Scene node base class.\n * @class\n * @param {string} name - Node name.\n */\nclass BaseNode {\n    constructor(name) {\n        this.__id = BaseNode.__counter__++;\n        this._name = name || `nonameNode:${this.__id}`;\n        this.topNode = this;\n        this._dictionary = {};\n        this._dictionary[this._name] = this;\n        this.childNodes = [];\n        this.parentNode = null;\n    }\n    get name() {\n        return this._name;\n    }\n    /**\n     * Adds node to the current hierarchy.\n     * @public\n     * @type {BaseNode}\n     */\n    addNode(node) {\n        if (this.parentNode == null) {\n            node.topNode = this;\n        }\n        else {\n            node.topNode = this.topNode;\n        }\n        node.parentNode = this;\n        node._dictionary = this.topNode._dictionary;\n        this.childNodes.push(node);\n        this.topNode._dictionary[node.name] = node;\n    }\n    /**\n     * Destroy node.\n     * @public\n     */\n    destroy() {\n        for (let i = 0; i < this.childNodes.length; i++) {\n            this.childNodes[i].destroy();\n        }\n        this._clear();\n    }\n    /**\n     * Gets node by name in the current.\n     * @public\n     * @param {string} name - Node name.\n     * @return {RenderNode} Node object in the current node.\n     */\n    getNodeByName(name) {\n        return this._dictionary[name];\n    }\n    /**\n     * Clear current node.\n     * @protected\n     */\n    _clear() {\n        this.parentNode = null;\n        this.topNode = this;\n        this.childNodes.length = 0;\n    }\n    isEqual(node) {\n        return node.__id === this.__id;\n    }\n}\nBaseNode.__counter__ = 0;\nexport { BaseNode };\n//# sourceMappingURL=BaseNode.js.map","import { BaseNode } from \"./BaseNode\";\n/**\n * Render node is a logical part of a render mechanism. Represents scene rendering.\n * For example one scene node for rendering the Earth, another one for rendering the Moon, another node for rendering stars etc.\n * Each render node has own model view space defined with matrices(scale, rotation, translation, transformation).\n * There are collections of light sources, entities and so on in the node.\n * Access to the node is renderer.renderNodes[\"Earth\"]\n * @class\n * @extends {BaseNode}\n * @param {string} name - Node name.\n */\nclass RenderNode extends BaseNode {\n    constructor(name) {\n        super(name);\n        this.childNodes = [];\n        this.renderer = null;\n        this.drawMode = 0;\n        this.show = true;\n        this._isActive = true;\n        this.lightEnabled = false;\n        this._lights = [];\n        this._lightsNames = [];\n        this._lightsPositions = [];\n        this._lightsParamsv = [];\n        this._lightsParamsf = [];\n        this.entityCollections = [];\n        this._pickingId = -1;\n    }\n    /**\n     * Adds node to the current hierarchy.\n     * @public\n     * @type {RenderNode}\n     */\n    addNode(node) {\n        super.addNode(node);\n        this.renderer && node.assign(this.renderer);\n    }\n    /**\n     * Assign render node with renderer.\n     * @public\n     * @param {Renderer} renderer - Render node's renderer.\n     */\n    assign(renderer) {\n        this.renderer = renderer;\n        this._pickingId = renderer.addPickingCallback(this, this._entityCollectionPickingCallback);\n        this.initialize();\n    }\n    initialize() {\n        if (this.renderer && this.renderer.isInitialized()) {\n            for (let i = 0; i < this.entityCollections.length; i++) {\n                this.entityCollections[i].bindRenderNode(this);\n            }\n            this.init();\n        }\n    }\n    init() {\n        //virtual\n    }\n    onremove() {\n        //virtual\n    }\n    remove() {\n        let r = this.renderer, n = this.name;\n        if (r) {\n            // TODO: replace to renderer\n            if (r.renderNodes[n] && r.renderNodes[n].isEqual(this)) {\n                // @ts-ignore\n                r.renderNodes[n] = null;\n                delete r.renderNodes[n];\n            }\n            for (let i = 0; i < r._renderNodesArr.length; i++) {\n                if (r._renderNodesArr[i].isEqual(this)) {\n                    r._renderNodesArr.splice(i, 1);\n                    break;\n                }\n            }\n            r.removePickingCallback(this._pickingId);\n            this._pickingId = -1;\n            this.onremove && this.onremove();\n        }\n    }\n    /**\n     * Adds entity collection.\n     * @public\n     * @param {EntityCollection} entityCollection - Entity collection.\n     * @param {boolean} [isHidden] - If it's true that this collection has specific rendering.\n     * @returns {RenderNode} -\n     */\n    addEntityCollection(entityCollection, isHidden) {\n        entityCollection.addTo(this, isHidden);\n        return this;\n    }\n    /**\n     * Removes entity collection.\n     * @public\n     * @param {EntityCollection} entityCollection - Entity collection for remove.\n     */\n    removeEntityCollection(entityCollection) {\n        entityCollection.remove();\n    }\n    /**\n     * Adds point light source.\n     * @public\n     * @param {LightSource} light - Light source.\n     * @returns {RenderNode}\n     */\n    addLight(light) {\n        light.addTo(this);\n        return this;\n    }\n    /**\n     * Gets light object by its name.\n     * @public\n     * @param {string} name - Point light name.\n     * @returns {LightSource}\n     */\n    getLightByName(name) {\n        let li = this._lightsNames.indexOf(name);\n        return this._lights[li];\n    }\n    /**\n     * Removes light source.\n     * @public\n     * @param {LightSource} light - Light source object.\n     */\n    removeLight(light) {\n        light.remove();\n    }\n    /**\n     * Calls render frame node's callback. Used in renderer.\n     * @public\n     */\n    preDrawNode() {\n        this._isActive && this._preDrawNodes();\n    }\n    /**\n     * Calls render frame node's callback. Used in renderer.\n     * @public\n     */\n    drawNode() {\n        this._isActive && this._drawNodes();\n    }\n    /**\n     * Gets render node activity.\n     * @public\n     * @returns {Boolean} -\n     */\n    isActive() {\n        return this._isActive;\n    }\n    /**\n     * Rendering activation.\n     * @public\n     * @param {boolean} isActive - Activation flag.\n     */\n    setActive(isActive) {\n        this._isActive = isActive;\n        if (this.renderer) {\n            if (this._isActive && this._pickingId === -1) {\n                // This picking callback MUST be the first picking callback\n                // in the rendering queue in the renderer. It affects on blending.\n                this._pickingId = this.renderer.addPickingCallback(this, this._entityCollectionPickingCallback);\n            }\n            else if (!this._isActive && this._pickingId !== -1) {\n                this.renderer.removePickingCallback(this._pickingId);\n                this._pickingId = -1;\n            }\n        }\n        for (let i = 0; i < this.childNodes.length; i++) {\n            this.childNodes[i].setActive(isActive);\n        }\n    }\n    /**\n     * Sets draw mode\n     * @public\n     * @param {Number} mode - Draw mode, such as gl.TRIANGLES, gl.TRIANGLE_STRIP, gl.LINES etc.\n     */\n    setDrawMode(mode) {\n        this.drawMode = mode;\n        for (let i = 0; i < this.childNodes.length; i++) {\n            this.childNodes[i].setDrawMode(mode);\n        }\n    }\n    /**\n     * IMPORTANT: This function have to be called manually in each render node frame callback, before drawing scene geometry.\n     * @public\n     */\n    transformLights() {\n        for (let i = 0; i < this._lights.length; i++) {\n            let ii = i * 3;\n            let tp;\n            tp = this._lights[i]._position;\n            this._lightsPositions[ii] = tp.x;\n            this._lightsPositions[ii + 1] = tp.y;\n            this._lightsPositions[ii + 2] = tp.z;\n        }\n        // for (let i = 0; i < this._lights.length; i++) {\n        //     var ii = i * 4;\n        //     var tp;\n        //     if (this._lights[i].directional) {\n        //         tp = r.activeCamera._normalMatrix.mulVec(this._lights[i]._position);\n        //         this._lightsTransformedPositions[ii + 3] = 0;\n        //     } else {\n        //         tp = r.activeCamera._viewMatrix.mulVec3(this._lights[i]._position);\n        //         this._lightsTransformedPositions[ii + 3] = 1;\n        //     }\n        //     this._lightsTransformedPositions[ii] = tp.x;\n        //     this._lightsTransformedPositions[ii + 1] = tp.y;\n        //     this._lightsTransformedPositions[ii + 2] = tp.z;\n        // }\n    }\n    updateBillboardsTexCoords() {\n        for (let i = 0; i < this.entityCollections.length; i++) {\n            this.entityCollections[i].billboardHandler.refreshTexCoordsArr();\n        }\n    }\n    // public updateGeoObjectsTexCoords() {\n    //     for (let i = 0; i < this.entityCollections.length; i++) {\n    //         this.entityCollections[i].geoObjectHandler.refreshTexCoordsArr();\n    //     }\n    // }\n    frame() {\n        // virtual\n    }\n    preFrame() {\n        // virtual\n    }\n    _preDrawNodes() {\n        for (let i = 0; i < this.childNodes.length; i++) {\n            if (this.childNodes[i]._isActive) {\n                this.childNodes[i]._preDrawNodes();\n            }\n        }\n        if (this.show) {\n            //this.lightEnabled && this.transformLights();\n            this.preFrame();\n            this.drawEntityCollections(this.entityCollections);\n        }\n    }\n    _drawNodes() {\n        for (let i = 0; i < this.childNodes.length; i++) {\n            if (this.childNodes[i]._isActive) {\n                this.childNodes[i]._drawNodes();\n            }\n        }\n        if (this.show) {\n            this.frame();\n        }\n    }\n    drawEntityCollections(ec) {\n        this.renderer.enqueueEntityCollectionsToDraw(ec);\n    }\n    /**\n     * Draw entity collections picking frame.\n     * @public\n     * @param {Array<EntityCollection>} ec - Entity collection array.\n     */\n    drawPickingEntityCollections(ec) {\n        if (ec.length) {\n            // billboard pass\n            let i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].billboardHandler.drawPicking();\n            }\n            // geoObject pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].geoObjectHandler.drawPicking();\n            }\n            // label pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].labelHandler.drawPicking();\n            }\n            // ray pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].rayHandler.drawPicking();\n            }\n            // polyline pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._visibility && ec[i].polylineHandler.drawPicking();\n            }\n            //Strip pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._visibility && ec[i].stripHandler.drawPicking();\n            }\n            // //pointClouds pass\n            // i = ec.length;\n            // while (i--) {\n            //    ec[i]._visibility && ec[i].pointCloudHandler.drawPicking();\n            // }\n        }\n    }\n    _entityCollectionPickingCallback() {\n        this.drawPickingEntityCollections(this.entityCollections);\n    }\n}\nexport { RenderNode };\n//# sourceMappingURL=RenderNode.js.map","/**\n * Console logging singleton object.\n * @class\n */\nexport class Cons {\n    constructor() {\n        this._container = document.createElement(\"div\");\n        this._container.classList.add(\"ogConsole\");\n        this._container.style.display = \"none\";\n        if (document.body) {\n            document.body.appendChild(this._container);\n        }\n        this._visibility = false;\n    }\n    getVisibility() {\n        return this._visibility;\n    }\n    setVisibility(visibility) {\n        if (this._visibility != visibility) {\n            this._visibility = visibility;\n            if (this._visibility) {\n                this.show();\n            }\n            else {\n                this.hide();\n            }\n        }\n    }\n    /**\n     * Show console panel.\n     * @public\n     */\n    show() {\n        if (!this._container.parentNode) {\n            if (document.body) {\n                document.body.appendChild(this._container);\n            }\n        }\n        this._container.style.display = \"block\";\n        this._visibility = true;\n    }\n    /**\n     * Hide console panel.\n     * @public\n     */\n    hide() {\n        this._container.style.display = \"none\";\n        this._visibility = false;\n    }\n    /**\n     * Adds error text in the console.\n     * @public\n     * @param {string} str - Error text.\n     */\n    logErr(str) {\n        let d = document.createElement(\"div\");\n        d.classList.add(\"ogConsole-text\");\n        d.classList.add(\"ogConsole-error\");\n        d.innerHTML = \"error: \" + str;\n        console.trace(d.innerHTML);\n        this._container.appendChild(d);\n        this.show();\n    }\n    /**\n     * Adds warning text in the console.\n     * @public\n     * @param {string} str - Warning text.\n     */\n    logWrn(str) {\n        let d = document.createElement(\"div\");\n        d.classList.add(\"ogConsole-text\");\n        d.classList.add(\"ogConsole-warning\");\n        d.innerHTML = \"warning: \" + str;\n        console.trace(d.innerHTML);\n        this._container.appendChild(d);\n        this.show();\n    }\n    /**\n     * Adds log text in the console.\n     * @public\n     * @param {string} str - Log text.\n     */\n    log(str) {\n        let d = document.createElement(\"div\");\n        d.classList.add(\"ogConsole-text\");\n        d.innerHTML = str;\n        console.trace(str);\n        this._container.appendChild(d);\n        this.show();\n    }\n}\nexport const cons = new Cons();\n//# sourceMappingURL=cons.js.map","/**\n * @module og/webgl/types\n */\nlet _declarations = [\n    \"FLOAT\", \"DOUBLE\", \"BOOL\", \"INT\", \"UINT\",\n    \"VEC2\", \"VEC3\", \"VEC4\", \"DVEC2\",\n    \"DVEC3\", \"DVEC4\",\n    \"BVEC2\", \"BVEC3\", \"BVEC4\",\n    \"IVEC2\", \"IVEC3\", \"IVEC4\",\n    \"UVEC2\", \"UVEC3\", \"UVEC4\",\n    \"MAT2\", \"DMAT2\", \"MAT3\", \"DMAT3\", \"MAT4\", \"DMAT4\",\n    \"MAT2X3\", \"MAT2X4\", \"MAT3X2\", \"MAT3X4\", \"MAT4X2\",\n    \"MAT4X3\", \"DMAT2X3\", \"DMAT2X4\", \"DMAT3X2\", \"DMAT3X4\",\n    \"DMAT4X2\", \"DMAT4X3\",\n    \"SAMPLER1D\", \"SAMPLER2D\", \"SAMPLER3D\", \"SAMPLERCUBE\", \"SAMPLER2DSHADOW\",\n    \"SAMPLER2DARRAY\",\n    \"INTXX\", \"FLOATXX\"\n];\nexport const types = {};\nfor (let i = 0; i < _declarations.length; i++) {\n    types[_declarations[i]] = i;\n}\nexport const typeStr = {};\nfor (let i = 0; i < _declarations.length; i++) {\n    typeStr[_declarations[i].toLowerCase()] = types[_declarations[i]];\n}\n//# sourceMappingURL=types.js.map","/**\n * @module og/webgl/variableHandlers\n */\nimport { types } from \"./types\";\n/*=========================\n   Uniforms callbacks\n =========================*/\nexport const variableHandlers = {\n    u: [],\n    a: []\n};\nvariableHandlers.u[types.MAT4] = function (program, variable) {\n    program.gl.uniformMatrix4fv(variable._pName, false, variable.value);\n};\nvariableHandlers.u[types.MAT3] = function (program, variable) {\n    program.gl.uniformMatrix3fv(variable._pName, false, variable.value);\n};\nvariableHandlers.u[types.FLOAT] = function (program, variable) {\n    program.gl.uniform1f(variable._pName, variable.value);\n};\nvariableHandlers.u[types.INT] = function (program, variable) {\n    program.gl.uniform1i(variable._pName, variable.value);\n};\nvariableHandlers.u[types.VEC2] = function (program, variable) {\n    program.gl.uniform2fv(variable._pName, variable.value);\n};\nvariableHandlers.u[types.VEC3] = function (program, variable) {\n    program.gl.uniform3fv(variable._pName, variable.value);\n};\nvariableHandlers.u[types.VEC4] = function (program, variable) {\n    program.gl.uniform4fv(variable._pName, variable.value);\n};\nvariableHandlers.u[types.SAMPLER2D] = function (program, variable) {\n    let pgl = program.gl;\n    pgl.activeTexture(pgl.TEXTURE0 + program._textureID);\n    pgl.bindTexture(pgl.TEXTURE_2D, variable.value);\n    pgl.uniform1i(variable._pName, program._textureID);\n    program._textureID++;\n};\nvariableHandlers.u[types.SAMPLERCUBE] = function (program, variable) {\n    let pgl = program.gl;\n    pgl.activeTexture(pgl.TEXTURE0 + program._textureID);\n    pgl.bindTexture(pgl.TEXTURE_CUBE_MAP, variable.value);\n    pgl.uniform1i(variable._pName, program._textureID);\n    program._textureID++;\n};\nvariableHandlers.u[types.SAMPLER2DARRAY] = function (program, variable) {\n    let value = variable.value;\n    let pgl = program.gl, size = value.length;\n    let samplerArr = new Int32Array(size);\n    for (let i = 0; i < size; i++) {\n        pgl.activeTexture(pgl.TEXTURE0 + program._textureID + i);\n        pgl.bindTexture(pgl.TEXTURE_2D, value[i]);\n        samplerArr[i] = i;\n    }\n    pgl.uniform1iv(variable._pName, samplerArr);\n};\nvariableHandlers.u[types.INTXX] = function (program, variable) {\n    program.gl.uniform1iv(variable._pName, variable.value);\n};\nvariableHandlers.u[types.FLOATXX] = function (program, variable) {\n    program.gl.uniform1fv(variable._pName, variable.value);\n};\n/*========================\n   Attributes callbacks\n ========================*/\nvariableHandlers.a[types.FLOAT] = function (program, variable) {\n    program.gl.vertexAttrib1f(variable._pName, variable.value);\n};\nvariableHandlers.a[types.VEC2] = function (program, variable) {\n    program.gl.vertexAttrib2fv(variable._pName, variable.value);\n};\nvariableHandlers.a[types.VEC3] = function (program, variable) {\n    program.gl.vertexAttrib3fv(variable._pName, variable.value);\n};\n//VariableHandlers.a[types.VEC4] = function (program, variable) {\n//    program.gl.vertexAttrib4fv(variable._pName, variable.value);\n//};\n//# sourceMappingURL=variableHandlers.js.map","import { cons } from \"../cons\";\nimport { variableHandlers } from \"./variableHandlers\";\nimport { types, typeStr } from \"./types\";\nconst itemTypes = [\"BYTE\", \"SHORT\", \"UNSIGNED_BYTE\", \"UNSIGNED_SHORT\", \"FLOAT\", \"HALF_FLOAT\"];\n/**\n * Represents more comfortable using WebGL shader program.\n * @class\n * @param {string} name - Program name.\n * @param {ProgramMaterial} material - Object stores uniforms, attributes and program codes:\n * @param {Record<string, any>} material.uniforms - Uniforms definition section.\n * @param {Record<string, any>} material.attributes - Attributes definition section.\n * @param {string} material.vertexShader - Vertex glsl code.\n * @param {string} material.fragmentShader - Fragment glsl code.\n */\nclass Program {\n    constructor(name, material) {\n        this.name = name;\n        this._attributes = {};\n        for (let t in material.attributes) {\n            if (typeof material.attributes[t] === \"string\" ||\n                typeof material.attributes[t] === \"number\") {\n                this._attributes[t] = { type: material.attributes[t] };\n            }\n            else {\n                this._attributes[t] = material.attributes[t];\n            }\n        }\n        this._uniforms = {};\n        for (let t in material.uniforms) {\n            if (typeof material.uniforms[t] === \"string\" ||\n                typeof material.uniforms[t] === \"number\") {\n                this._uniforms[t] = { type: material.uniforms[t] };\n            }\n            else {\n                this._uniforms[t] = material.uniforms[t];\n            }\n        }\n        this.vertexShader = material.vertexShader;\n        this.fragmentShader = material.fragmentShader;\n        this.gl = null;\n        this._variables = {};\n        this._p = null;\n        this._textureID = 0;\n        this._attribArrays = [];\n        this._attribDivisor = [];\n        this.attributes = {};\n        this.uniforms = {};\n        this.vertexAttribDivisor = null;\n        this.drawElementsInstanced = null;\n    }\n    /**\n     * Bind program buffer.\n     * @function\n     * @param {Program} program - Used program.\n     * @param {Object} variable - Variable represents buffer data.\n     */\n    static bindBuffer(program, variable) {\n        let gl = program.gl;\n        if (gl) {\n            gl.bindBuffer(gl.ARRAY_BUFFER, variable.value);\n            gl.vertexAttribPointer(variable._pName, variable.value.itemSize, variable.itemType, variable.normalized, 0, 0);\n        }\n    }\n    /**\n     * Sets the current program frame.\n     * @public\n     */\n    use() {\n        this.gl && this.gl.useProgram(this._p);\n    }\n    /**\n     * Sets program variables.\n     * @public\n     * @param {Object} material - Variables and values object.\n     */\n    set(material) {\n        this._textureID = 0;\n        for (let i in material) {\n            this._variables[i].value = material[i];\n            this._variables[i].func(this, this._variables[i]);\n        }\n    }\n    /**\n     * Apply current variables.\n     * @public\n     */\n    apply() {\n        this._textureID = 0;\n        let v = this._variables;\n        for (let i in v) {\n            v[i].func(this, v[i]);\n        }\n    }\n    /**\n     * Calls drawElements index buffer function.\n     * @public\n     * @param {number} mode - Draw mode(GL_TRIANGLES, GL_LINESTRING etc.).\n     * @param {Object} buffer - Index buffer.\n     */\n    drawIndexBuffer(mode, buffer) {\n        let gl = this.gl;\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n        gl.drawElements(mode, buffer.numItems, gl.UNSIGNED_SHORT, 0);\n    }\n    /**\n     * Calls drawArrays function.\n     * @public\n     * @param {number} mode - Draw mode GL_TRIANGLES, GL_LINESTRING, etc.\n     * @param {number} numItems - Items to draw\n     */\n    drawArrays(mode, numItems) {\n        this.gl.drawArrays(mode, 0, numItems);\n    }\n    /**\n     * Check and log for a shader compile errors and warnings. Returns True - if no errors otherwise returns False.\n     * @private\n     * @param {WebGLShader} shader - WebGl shader program.\n     * @param {string} src - Shader program source.\n     * @returns {boolean} -\n     */\n    _getShaderCompileStatus(shader, src) {\n        if (!this.gl)\n            return false;\n        this.gl.shaderSource(shader, src);\n        this.gl.compileShader(shader);\n        if (!this.gl.getShaderParameter(shader, this.gl.COMPILE_STATUS)) {\n            cons.logErr(`Shader program \"${this.name}\":${this.gl.getShaderInfoLog(shader)}.`);\n            return false;\n        }\n        return true;\n    }\n    /**\n     * Returns compiled vertex shader program pointer.\n     * @private\n     * @param {string} src - Vertex shader source code.\n     * @returns {Object} -\n     */\n    _createVertexShader(src) {\n        if (!this.gl)\n            return;\n        let shader = this.gl.createShader(this.gl.VERTEX_SHADER);\n        if (shader && this._getShaderCompileStatus(shader, src)) {\n            return shader;\n        }\n    }\n    /**\n     * Returns compiled fragment shader program pointer.\n     * @private\n     * @param {string} src - Vertex shader source code.\n     * @returns {Object} -\n     */\n    _createFragmentShader(src) {\n        if (!this.gl)\n            return;\n        let shader = this.gl.createShader(this.gl.FRAGMENT_SHADER);\n        if (shader && this._getShaderCompileStatus(shader, src)) {\n            return shader;\n        }\n    }\n    /**\n     * Disable current program vertexAttribArrays.\n     * @public\n     */\n    disableAttribArrays() {\n        let gl = this.gl;\n        let a = this._attribArrays;\n        for (let i = 0, len = a.length; i < len; i++) {\n            gl.disableVertexAttribArray(a[i]);\n            this.vertexAttribDivisor(a[i], 0);\n        }\n    }\n    /**\n     * Enable current program vertexAttribArrays.\n     * @public\n     */\n    enableAttribArrays() {\n        let gl = this.gl;\n        let a = this._attribArrays;\n        let d = this._attribDivisor;\n        for (let i = 0, len = a.length; i < len; i++) {\n            gl.enableVertexAttribArray(a[i]);\n            this.vertexAttribDivisor(a[i], d[i]);\n        }\n    }\n    // public vertexAttribDivisor(index: number, divisor: number) {\n    //     const gl = this.gl!;\n    //     gl.vertexAttribDivisor ?\n    //         gl.vertexAttribDivisor(index, divisor) :\n    //         gl.getExtension('ANGLE_instanced_arrays').vertexAttribDivisorANGLE(index, divisor);\n    // }\n    /**\n     * Delete program.\n     * @public\n     */\n    delete() {\n        this.gl && this.gl.deleteProgram(this._p);\n    }\n    /**\n     * Creates program.\n     * @public\n     * @param {Object} gl - WebGl context.\n     */\n    createProgram(gl) {\n        this.gl = gl;\n        this._p = this.gl.createProgram();\n        if (!this._p)\n            return;\n        let fs = this._createFragmentShader(this.fragmentShader);\n        let vs = this._createVertexShader(this.vertexShader);\n        if (!fs || !vs)\n            return;\n        gl.attachShader(this._p, fs);\n        gl.attachShader(this._p, vs);\n        gl.linkProgram(this._p);\n        if (!this.drawElementsInstanced) {\n            if (gl.drawElementsInstanced) {\n                this.drawElementsInstanced = gl.drawElementsInstanced.bind(gl);\n            }\n            else {\n                let ext = gl.getExtension('ANGLE_instanced_arrays');\n                if (ext) {\n                    this.drawElementsInstanced = ext.drawElementsInstancedANGLE.bind(ext);\n                }\n            }\n            // this.drawElementsInstanced =\n            //     gl.drawElementsInstanced ?\n            //         gl.drawElementsInstanced.bind(gl) :\n            //         gl.getExtension('ANGLE_instanced_arrays').drawElementsInstancedANGLE.bind(gl.getExtension('ANGLE_instanced_arrays'));\n        }\n        if (!this.vertexAttribDivisor) {\n            if (gl.vertexAttribDivisor) {\n                this.vertexAttribDivisor = gl.vertexAttribDivisor.bind(gl);\n            }\n            else {\n                let ext = gl.getExtension('ANGLE_instanced_arrays');\n                if (ext) {\n                    this.vertexAttribDivisor = ext.vertexAttribDivisorANGLE.bind(ext);\n                }\n            }\n            // this.vertexAttribDivisor =\n            //     gl.vertexAttribDivisor ?\n            //         gl.vertexAttribDivisor.bind(gl) :\n            //         gl.getExtension('ANGLE_instanced_arrays').vertexAttribDivisorANGLE.bind(gl.getExtension('ANGLE_instanced_arrays'));\n        }\n        if (!gl.getProgramParameter(this._p, gl.LINK_STATUS)) {\n            cons.logErr(`Shader program \"${this.name}\": initialization failed. ${gl.getProgramInfoLog(this._p)}.`);\n            gl.deleteProgram(this._p);\n            return;\n        }\n        this.use();\n        for (let a in this._attributes) {\n            //this.attributes[a]._name = a;\n            this._variables[a] = this._attributes[a];\n            this._attributes[a].func = Program.bindBuffer;\n            let t = this._attributes[a].itemType;\n            let itemTypeStr = t ? t.trim().toUpperCase() : \"FLOAT\";\n            if (itemTypes.indexOf(itemTypeStr) == -1) {\n                cons.logErr(`Shader program \"${this.name}\": attribute '${a}', item type '${this._attributes[a].itemType}' not exists.`);\n                this._attributes[a].itemType = gl.FLOAT;\n            }\n            else {\n                this._attributes[a].itemType = gl[itemTypeStr];\n            }\n            this._attributes[a].normalized = this._attributes[a].normalized || false;\n            this._attributes[a].divisor = this._attributes[a].divisor || 0;\n            this._p[a] = gl.getAttribLocation(this._p, a);\n            if (this._p[a] == undefined) {\n                cons.logErr(`Shader program \"${this.name}\":  attribute '${a}' not exists.`);\n                gl.deleteProgram(this._p);\n                return;\n            }\n            let type = this._attributes[a].type;\n            if (typeof type === \"string\") {\n                type = typeStr[type.trim().toLowerCase()];\n            }\n            let d = this._attributes[a].divisor;\n            if (type === types.MAT4) {\n                let loc = this._p[a];\n                this._attribArrays.push(loc, loc + 1, loc + 2, loc + 3);\n                this._attribDivisor.push(d, d, d, d);\n            }\n            else {\n                this._attribArrays.push(this._p[a]);\n                this._attribDivisor.push(d);\n            }\n            gl.enableVertexAttribArray(this._p[a]);\n            this._attributes[a]._pName = this._p[a];\n            this.attributes[a] = this._p[a];\n        }\n        for (let u in this._uniforms) {\n            if (typeof this._uniforms[u].type === \"string\") {\n                let t = this._uniforms[u].type;\n                this._uniforms[u].func = variableHandlers.u[typeStr[t.trim().toLowerCase()]];\n            }\n            else {\n                this._uniforms[u].func = variableHandlers.u[this._uniforms[u].type];\n            }\n            this._variables[u] = this._uniforms[u];\n            this._p[u] = gl.getUniformLocation(this._p, u);\n            if (this._p[u] == undefined) {\n                cons.logErr(`Shader program \"${this.name}\": uniform '${u}' not exists.`);\n                gl.deleteProgram(this._p);\n                return;\n            }\n            this._uniforms[u]._pName = this._p[u];\n            this.uniforms[u] = this._p[u];\n        }\n        gl.detachShader(this._p, fs);\n        gl.detachShader(this._p, vs);\n        gl.deleteShader(fs);\n        gl.deleteShader(vs);\n    }\n}\nexport { Program };\n//# sourceMappingURL=Program.js.map","import { Program } from '../webgl/Program';\nconst PROJECT = `vec2 project(vec4 p) {\n                    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\n                }`;\nconst ROTATE2D = `mat2 rotate2d(float angle) {\n        return mat2(cos(angle), -sin(angle),\n           sin(angle), cos(angle));\n     }`;\nexport function billboardPicking() {\n    return new Program(\"billboardPicking\", {\n        uniforms: {\n            viewport: \"vec2\",\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            planetRadius: \"float\",\n            uScaleByDistance: \"vec3\",\n            opacity: \"float\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            a_vertices: \"vec2\",\n            a_positionsHigh: \"vec3\",\n            a_positionsLow: \"vec3\",\n            a_offset: \"vec3\",\n            a_size: \"vec2\",\n            a_rotation: \"float\",\n            a_rgba: \"vec4\"\n        },\n        vertexShader: `precision highp float;\n            attribute vec2 a_vertices;\n            attribute vec3 a_positionsHigh;\n            attribute vec3 a_positionsLow;\n            attribute vec3 a_offset;\n            attribute vec2 a_size;\n            attribute float a_rotation;\n            attribute vec4 a_rgba;\n\n            varying vec3 v_rgb;\n\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform vec3 uScaleByDistance;\n            uniform float opacity;\n            uniform float planetRadius;\n            uniform vec2 viewport;\n            uniform float depthOffset;\n\n            const vec3 ZERO3 = vec3(0.0);\n\n            ${PROJECT}\n\n            ${ROTATE2D}\n\n            void main() {\n\n                vec3 a_positions = a_positionsHigh + a_positionsLow;\n                vec3 cameraPos = eyePositionHigh + eyePositionLow;\n\n                vec3 look = a_positions - cameraPos;\n                float lookDist = length(look);\n                v_rgb = a_rgba.rgb;\n\n                if(opacity * step(lookDist, sqrt(dot(cameraPos,cameraPos) - planetRadius) + sqrt(dot(a_positions,a_positions) - planetRadius)) == 0.0){\n                    return;\n                }\n\n                vec3 up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\n                vec3 right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\n\n                float scd = (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookDist)) * (1.0 - step(uScaleByDistance[2], lookDist));\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = a_positionsHigh - eyePositionHigh;\n                vec3 lowDiff = a_positionsLow - eyePositionLow;\n                vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                vec4 projPos = projectionMatrix * posRTE;\n                                \n                float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));                \n                if(camSlope > 0.5) {\n                    float dist = dot(look, normalize(cameraPos));\n                    projPos.z += dist * 0.02;\n                }else{\n                    projPos.z += -(abs(projPos.z)) * 0.002;                 \n                }\n                \n                projPos.z += depthOffset + a_offset.z;\n                                \n                vec2 screenPos = project(projPos);\n\n                vec2 v =  screenPos + rotate2d(a_rotation) * (a_vertices * a_size * scd + a_offset.xy);\n\n                gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\n            }`,\n        fragmentShader: `precision highp float;\n            varying vec3 v_rgb;\n            void main () {\n                gl_FragColor = vec4(v_rgb, 1.0);\n            }`\n    });\n}\nexport function billboard_screen() {\n    return new Program(\"billboard\", {\n        uniforms: {\n            viewport: \"vec2\",\n            u_texture: \"sampler2d\",\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            planetRadius: \"float\",\n            uScaleByDistance: \"vec3\",\n            opacity: \"float\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            a_vertices: \"vec2\",\n            a_texCoord: \"vec2\",\n            a_positionsHigh: \"vec3\",\n            a_positionsLow: \"vec3\",\n            a_offset: \"vec3\",\n            a_size: \"vec2\",\n            a_rotation: \"float\",\n            a_rgba: \"vec4\",\n        },\n        vertexShader: `precision highp float;\n            attribute vec2 a_vertices;\n            attribute vec2 a_texCoord;\n            attribute vec3 a_positionsHigh;\n            attribute vec3 a_positionsLow;\n            attribute vec3 a_offset;\n            attribute vec2 a_size;\n            attribute float a_rotation;\n            attribute vec4 a_rgba;\n\n            varying vec2 v_texCoords;\n            varying vec4 v_rgba;\n\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform vec3 uScaleByDistance;\n            uniform float opacity;\n            uniform float planetRadius;\n            uniform vec2 viewport;\n            uniform float depthOffset;\n\n            const vec3 ZERO3 = vec3(0.0);\n\n            ${PROJECT}\n\n            ${ROTATE2D}\n\n            void main() {\n                \n                vec3 a_positions = a_positionsHigh + a_positionsLow;\n                vec3 cameraPos = eyePositionHigh + eyePositionLow;\n\n                v_texCoords = a_texCoord;\n                vec3 look = a_positions - cameraPos;\n                float lookDist = length(look);\n                v_rgba = a_rgba;\n\n                if(opacity * step(lookDist, sqrt(dot(cameraPos,cameraPos) - planetRadius) + sqrt(dot(a_positions,a_positions) - planetRadius)) == 0.0){\n                    return;\n                }\n\n                vec3 up = vec3( viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1] );\n                vec3 right = vec3( viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0] );\n\n                float scd = (1.0 - smoothstep(uScaleByDistance[0], uScaleByDistance[1], lookDist)) * (1.0 - step(uScaleByDistance[2], lookDist));\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = a_positionsHigh - eyePositionHigh;\n                vec3 lowDiff = a_positionsLow - eyePositionLow;\n                vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                vec4 projPos = projectionMatrix * posRTE;\n                                                \n                float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));                \n                if(camSlope > 0.5) {\n                    float dist = dot(look, normalize(cameraPos));\n                    projPos.z += dist * 0.02;\n                }else{\n                    projPos.z += -(abs(projPos.z)) * 0.002;                 \n                }\n                \n                projPos.z += depthOffset + a_offset.z;\n                \n                vec2 screenPos = project(projPos);\n\n                vec2 v = screenPos + rotate2d(a_rotation) * (a_vertices * a_size * scd + a_offset.xy);\n\n                gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\n            }`,\n        fragmentShader: `precision highp float;\n            uniform sampler2D u_texture;\n            varying vec2 v_texCoords;\n            varying vec4 v_rgba;\n            void main () {\n                vec4 color = texture2D(u_texture, v_texCoords);\n                if(color.a < 0.1)\n                    discard;\n                gl_FragColor = color * v_rgba;\n            }`\n    });\n}\n//# sourceMappingURL=billboard.js.map","import * as shaders from \"../shaders/billboard\";\nimport { spliceTypedArray } from \"../utils/shared\";\nimport { LOCK_FREE } from \"./LabelWorker\";\nconst PICKINGCOLOR_BUFFER = 0;\nconst POSITION_BUFFER = 1;\nconst SIZE_BUFFER = 2;\nconst OFFSET_BUFFER = 3;\nconst RGBA_BUFFER = 4;\nconst ROTATION_BUFFER = 5;\nconst TEXCOORD_BUFFER = 6;\nconst VERTEX_BUFFER = 7;\n/**\n * @class BaseBillboardHandler\n */\nclass BaseBillboardHandler {\n    constructor(entityCollection) {\n        this.__id = BaseBillboardHandler.__counter__++;\n        this.pickingEnabled = true;\n        this._entityCollection = entityCollection;\n        this._renderer = null;\n        this._billboards = [];\n        this._positionHighBuffer = null;\n        this._positionLowBuffer = null;\n        this._sizeBuffer = null;\n        this._offsetBuffer = null;\n        this._rgbaBuffer = null;\n        this._rotationBuffer = null;\n        this._texCoordBuffer = null;\n        this._vertexBuffer = null;\n        this._pickingColorBuffer = null;\n        this._texCoordArr = new Float32Array([]);\n        this._vertexArr = new Float32Array([]);\n        this._positionHighArr = new Float32Array([]);\n        this._positionLowArr = new Float32Array([]);\n        this._sizeArr = new Float32Array([]);\n        this._offsetArr = new Float32Array([]);\n        this._rgbaArr = new Float32Array([]);\n        this._rotationArr = new Float32Array([]);\n        this._pickingColorArr = new Float32Array([]);\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\n        this._buffersUpdateCallbacks[POSITION_BUFFER] = this.createPositionBuffer;\n        this._buffersUpdateCallbacks[SIZE_BUFFER] = this.createSizeBuffer;\n        this._buffersUpdateCallbacks[OFFSET_BUFFER] = this.createOffsetBuffer;\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\n        this._buffersUpdateCallbacks[ROTATION_BUFFER] = this.createRotationBuffer;\n        this._buffersUpdateCallbacks[TEXCOORD_BUFFER] = this.createTexCoordBuffer;\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n    }\n    isEqual(handler) {\n        return handler && (handler.__id === this.__id);\n    }\n    static concArr(dest, curr) {\n        for (let i = 0; i < curr.length; i++) {\n            dest.push(curr[i]);\n        }\n    }\n    initProgram() {\n        if (this._renderer && this._renderer.handler) {\n            if (!this._renderer.handler.programs.billboard) {\n                this._renderer.handler.addProgram(shaders.billboard_screen());\n            }\n            if (!this._renderer.handler.programs.billboardPicking) {\n                this._renderer.handler.addProgram(shaders.billboardPicking());\n            }\n        }\n    }\n    setRenderer(renderer) {\n        this._renderer = renderer;\n        this.initProgram();\n    }\n    refresh() {\n        let i = this._changedBuffers.length;\n        while (i--) {\n            this._changedBuffers[i] = true;\n        }\n    }\n    _removeBillboards() {\n        let i = this._billboards.length;\n        while (i--) {\n            let bi = this._billboards[i];\n            bi._handlerIndex = -1;\n            bi._handler = null;\n            bi._isReady = false;\n            bi._lockId = LOCK_FREE;\n        }\n        this._billboards.length = 0;\n        this._billboards = [];\n    }\n    clear() {\n        // @ts-ignore\n        this._texCoordArr = null;\n        // @ts-ignore\n        this._vertexArr = null;\n        // @ts-ignore\n        this._positionHighArr = null;\n        // @ts-ignore\n        this._positionLowArr = null;\n        // @ts-ignore\n        this._sizeArr = null;\n        // @ts-ignore\n        this._offsetArr = null;\n        // @ts-ignore\n        this._rgbaArr = null;\n        // @ts-ignore\n        this._rotationArr = null;\n        // @ts-ignore\n        this._pickingColorArr = null;\n        this._texCoordArr = new Float32Array([]);\n        this._vertexArr = new Float32Array([]);\n        this._positionHighArr = new Float32Array([]);\n        this._positionLowArr = new Float32Array([]);\n        this._sizeArr = new Float32Array([]);\n        this._offsetArr = new Float32Array([]);\n        this._rgbaArr = new Float32Array([]);\n        this._rotationArr = new Float32Array([]);\n        this._pickingColorArr = new Float32Array([]);\n        this._removeBillboards();\n        this._deleteBuffers();\n        this.refresh();\n    }\n    _deleteBuffers() {\n        if (this._renderer) {\n            let gl = this._renderer.handler.gl;\n            gl.deleteBuffer(this._positionHighBuffer);\n            gl.deleteBuffer(this._positionLowBuffer);\n            gl.deleteBuffer(this._sizeBuffer);\n            gl.deleteBuffer(this._offsetBuffer);\n            gl.deleteBuffer(this._rgbaBuffer);\n            gl.deleteBuffer(this._rotationBuffer);\n            gl.deleteBuffer(this._vertexBuffer);\n            gl.deleteBuffer(this._texCoordBuffer);\n            gl.deleteBuffer(this._pickingColorBuffer);\n        }\n        this._positionHighBuffer = null;\n        this._positionLowBuffer = null;\n        this._sizeBuffer = null;\n        this._offsetBuffer = null;\n        this._rgbaBuffer = null;\n        this._rotationBuffer = null;\n        this._vertexBuffer = null;\n        this._texCoordBuffer = null;\n        this._pickingColorBuffer = null;\n    }\n    update() {\n        if (this._renderer) {\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n        }\n    }\n    add(billboard) {\n        if (billboard._handlerIndex == -1) {\n            billboard._isReady = true;\n            billboard._handler = this;\n            billboard._handlerIndex = this._billboards.length;\n            this._billboards.push(billboard);\n        }\n    }\n    _displayPASS() {\n        let r = this._renderer;\n        let h = r.handler;\n        h.programs.billboard.activate();\n        let sh = h.programs.billboard._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        let gl = h.gl, ec = this._entityCollection;\n        gl.disable(gl.CULL_FACE);\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n        gl.uniform1i(shu.u_texture, 0);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniform3fv(shu.uScaleByDistance, ec.scaleByDistance);\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer);\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer);\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer);\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer);\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer);\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.uniform1f(shu.planetRadius, ec.renderNode._planetRadius2 || 0);\n        gl.uniform2fv(shu.viewport, [h.canvas.clientWidth, h.canvas.clientHeight]);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer);\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        gl.enable(gl.CULL_FACE);\n    }\n    _pickingPASS() {\n        let r = this._renderer;\n        let h = r.handler;\n        h.programs.billboardPicking.activate();\n        let sh = h.programs.billboardPicking._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        let gl = h.gl, ec = this._entityCollection;\n        gl.disable(gl.CULL_FACE);\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniform3fv(shu.uScaleByDistance, ec.scaleByDistance);\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer);\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer);\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._pickingColorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer);\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer);\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.uniform1f(shu.planetRadius, ec.renderNode._planetRadius2 || 0);\n        gl.uniform2fv(shu.viewport, [h.canvas.clientWidth, h.canvas.clientHeight]);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer);\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        gl.enable(gl.CULL_FACE);\n    }\n    draw() {\n        if (this._billboards.length) {\n            this.update();\n            this._displayPASS();\n        }\n    }\n    drawPicking() {\n        if (this._billboards.length && this.pickingEnabled) {\n            this._pickingPASS();\n        }\n    }\n    reindexBillboardsArray(startIndex) {\n        let b = this._billboards;\n        for (let i = startIndex; i < b.length; i++) {\n            b[i]._handlerIndex = i;\n        }\n    }\n    _removeBillboard(billboard) {\n        let bi = billboard._handlerIndex;\n        this._billboards.splice(bi, 1);\n        let i = bi * 24;\n        this._rgbaArr = spliceTypedArray(this._rgbaArr, i, 24);\n        i = bi * 18;\n        this._positionHighArr = spliceTypedArray(this._positionHighArr, i, 18);\n        this._positionLowArr = spliceTypedArray(this._positionLowArr, i, 18);\n        this._offsetArr = spliceTypedArray(this._offsetArr, i, 18);\n        //this._alignedAxisArr = spliceTypedArray(this._alignedAxisArr, i, 18) as Float32Array;\n        this._pickingColorArr = spliceTypedArray(this._pickingColorArr, i, 18);\n        i = bi * 12;\n        this._vertexArr = spliceTypedArray(this._vertexArr, i, 12);\n        this._sizeArr = spliceTypedArray(this._sizeArr, i, 12);\n        this._texCoordArr = spliceTypedArray(this._texCoordArr, i, 12);\n        i = bi * 6;\n        this._rotationArr = spliceTypedArray(this._rotationArr, i, 6);\n        this.reindexBillboardsArray(bi);\n        this.refresh();\n        billboard._handlerIndex = -1;\n        billboard._handler = null;\n        billboard._isReady = false;\n        billboard._lockId = LOCK_FREE;\n    }\n    setAlignedAxisArr(index, alignedAxis) {\n        //...\n    }\n    remove(billboard) {\n        if (billboard._handler) {\n            if (billboard._isReady && this.__id === billboard._handler.__id) {\n                this._removeBillboard(billboard);\n            }\n            else {\n                billboard._handler = null;\n            }\n        }\n    }\n    setPositionArr(index, positionHigh, positionLow) {\n        let i = index * 18;\n        // High\n        let a = this._positionHighArr, x = positionHigh.x, y = positionHigh.y, z = positionHigh.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        // Low\n        a = this._positionLowArr;\n        x = positionLow.x;\n        y = positionLow.y;\n        z = positionLow.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[POSITION_BUFFER] = true;\n    }\n    setPickingColorArr(index, color) {\n        let i = index * 18;\n        let a = this._pickingColorArr, x = color.x / 255, y = color.y / 255, z = color.z / 255;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\n    }\n    setSizeArr(index, width, height) {\n        let i = index * 12;\n        let a = this._sizeArr, x = width, y = height;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = x;\n        a[i + 3] = y;\n        a[i + 4] = x;\n        a[i + 5] = y;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = x;\n        a[i + 9] = y;\n        a[i + 10] = x;\n        a[i + 11] = y;\n        this._changedBuffers[SIZE_BUFFER] = true;\n    }\n    setOffsetArr(index, offset) {\n        let i = index * 18;\n        let a = this._offsetArr, x = offset.x, y = offset.y, z = offset.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[OFFSET_BUFFER] = true;\n    }\n    setRgbaArr(index, rgba) {\n        let i = index * 24;\n        let a = this._rgbaArr, x = rgba.x, y = rgba.y, z = rgba.z, w = rgba.w;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = w;\n        a[i + 4] = x;\n        a[i + 5] = y;\n        a[i + 6] = z;\n        a[i + 7] = w;\n        a[i + 8] = x;\n        a[i + 9] = y;\n        a[i + 10] = z;\n        a[i + 11] = w;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = w;\n        a[i + 16] = x;\n        a[i + 17] = y;\n        a[i + 18] = z;\n        a[i + 19] = w;\n        a[i + 20] = x;\n        a[i + 21] = y;\n        a[i + 22] = z;\n        a[i + 23] = w;\n        this._changedBuffers[RGBA_BUFFER] = true;\n    }\n    setRotationArr(index, rotation) {\n        let i = index * 6;\n        let a = this._rotationArr;\n        a[i] = rotation;\n        a[i + 1] = rotation;\n        a[i + 2] = rotation;\n        a[i + 3] = rotation;\n        a[i + 4] = rotation;\n        a[i + 5] = rotation;\n        this._changedBuffers[ROTATION_BUFFER] = true;\n    }\n    setTexCoordArr(index, tcoordArr) {\n        let i = index * 12;\n        let a = this._texCoordArr;\n        a[i] = tcoordArr[0];\n        a[i + 1] = tcoordArr[1];\n        a[i + 2] = tcoordArr[2];\n        a[i + 3] = tcoordArr[3];\n        a[i + 4] = tcoordArr[4];\n        a[i + 5] = tcoordArr[5];\n        a[i + 6] = tcoordArr[6];\n        a[i + 7] = tcoordArr[7];\n        a[i + 8] = tcoordArr[8];\n        a[i + 9] = tcoordArr[9];\n        a[i + 10] = tcoordArr[10];\n        a[i + 11] = tcoordArr[11];\n        this._changedBuffers[TEXCOORD_BUFFER] = true;\n    }\n    setVisibility(index, visibility) {\n        let vArr;\n        if (visibility) {\n            vArr = [-0.5, 0.5, -0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, 0.5, -0.5, 0.5];\n        }\n        else {\n            vArr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        }\n        this.setVertexArr(index, vArr);\n    }\n    setVertexArr(index, vertexArr) {\n        let i = index * 12;\n        let a = this._vertexArr;\n        a[i] = vertexArr[0];\n        a[i + 1] = vertexArr[1];\n        a[i + 2] = vertexArr[2];\n        a[i + 3] = vertexArr[3];\n        a[i + 4] = vertexArr[4];\n        a[i + 5] = vertexArr[5];\n        a[i + 6] = vertexArr[6];\n        a[i + 7] = vertexArr[7];\n        a[i + 8] = vertexArr[8];\n        a[i + 9] = vertexArr[9];\n        a[i + 10] = vertexArr[10];\n        a[i + 11] = vertexArr[11];\n        this._changedBuffers[VERTEX_BUFFER] = true;\n    }\n    createPositionBuffer() {\n        let h = this._renderer.handler, numItems = this._positionHighArr.length / 3;\n        if (!this._positionHighBuffer || this._positionHighBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._positionHighBuffer);\n            h.gl.deleteBuffer(this._positionLowBuffer);\n            this._positionHighBuffer = h.createStreamArrayBuffer(3, numItems);\n            this._positionLowBuffer = h.createStreamArrayBuffer(3, numItems);\n        }\n        h.setStreamArrayBuffer(this._positionHighBuffer, this._positionHighArr);\n        h.setStreamArrayBuffer(this._positionLowBuffer, this._positionLowArr);\n    }\n    createSizeBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._sizeBuffer);\n        this._sizeBuffer = h.createArrayBuffer(this._sizeArr, 2, this._sizeArr.length / 2);\n    }\n    createOffsetBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._offsetBuffer);\n        this._offsetBuffer = h.createArrayBuffer(this._offsetArr, 3, this._offsetArr.length / 3);\n    }\n    createRgbaBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._rgbaBuffer);\n        this._rgbaBuffer = h.createArrayBuffer(this._rgbaArr, 4, this._rgbaArr.length / 4);\n    }\n    createRotationBuffer() {\n        let h = this._renderer.handler;\n        if (!this._rotationBuffer || this._rotationBuffer.numItems !== this._rotationArr.length) {\n            h.gl.deleteBuffer(this._rotationBuffer);\n            this._rotationBuffer = h.createStreamArrayBuffer(1, this._rotationArr.length);\n        }\n        h.setStreamArrayBuffer(this._rotationBuffer, this._rotationArr);\n    }\n    createVertexBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._vertexBuffer);\n        this._vertexBuffer = h.createArrayBuffer(this._vertexArr, 2, this._vertexArr.length / 2);\n    }\n    createTexCoordBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._texCoordBuffer);\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr, 2, this._texCoordArr.length / 2);\n    }\n    //createAlignedAxisBuffer() {\n    //    var h = this._renderer.handler;\n    //    h.gl.deleteBuffer(this._alignedAxisBuffer);\n    //    this._alignedAxisBuffer = h.createArrayBuffer(\n    //        this._alignedAxisArr,\n    //        3,\n    //        this._alignedAxisArr.length / 3\n    //    );\n    //}\n    createPickingColorBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._pickingColorBuffer);\n        this._pickingColorBuffer = h.createArrayBuffer(this._pickingColorArr, 3, this._pickingColorArr.length / 3);\n    }\n    refreshTexCoordsArr() {\n    }\n}\nBaseBillboardHandler.__counter__ = 0;\nexport { BaseBillboardHandler };\n//# sourceMappingURL=BaseBillboardHandler.js.map","import { BaseBillboardHandler } from \"./BaseBillboardHandler\";\nimport { concatTypedArrays } from \"../utils/shared\";\n/**\n * @class BillboardHandler\n */\nclass BillboardHandler extends BaseBillboardHandler {\n    constructor(props) {\n        super(props);\n        this._billboards = [];\n    }\n    add(billboard) {\n        if (billboard._handlerIndex == -1) {\n            super.add(billboard);\n            this._addBillboardToArrays(billboard);\n            this.refresh();\n            let src = billboard.getSrc() || (billboard.getImage() && billboard.getImage().src);\n            if (src) {\n                billboard.setSrc(src);\n            }\n        }\n    }\n    _addBillboardToArrays(billboard) {\n        if (billboard.getVisibility()) {\n            this._vertexArr = concatTypedArrays(this._vertexArr, [-0.5, 0.5, -0.5, -0.5, 0.5, -0.5, 0.5, -0.5, 0.5, 0.5, -0.5, 0.5]);\n        }\n        else {\n            this._vertexArr = concatTypedArrays(this._vertexArr, [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n        }\n        this._texCoordArr = concatTypedArrays(this._texCoordArr, [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);\n        let x = billboard._positionHigh.x, y = billboard._positionHigh.y, z = billboard._positionHigh.z, w;\n        this._positionHighArr = concatTypedArrays(this._positionHighArr, [\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z\n        ]);\n        x = billboard._positionLow.x;\n        y = billboard._positionLow.y;\n        z = billboard._positionLow.z;\n        this._positionLowArr = concatTypedArrays(this._positionLowArr, [\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z\n        ]);\n        x = billboard._width;\n        y = billboard._height;\n        this._sizeArr = concatTypedArrays(this._sizeArr, [x, y, x, y, x, y, x, y, x, y, x, y]);\n        x = billboard._offset.x;\n        y = billboard._offset.y;\n        z = billboard._offset.z;\n        this._offsetArr = concatTypedArrays(this._offsetArr, [\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z,\n            x, y, z\n        ]);\n        x = billboard._color.x;\n        y = billboard._color.y;\n        z = billboard._color.z;\n        w = billboard._color.w;\n        this._rgbaArr = concatTypedArrays(this._rgbaArr, [\n            x, y, z, w,\n            x, y, z, w,\n            x, y, z, w,\n            x, y, z, w,\n            x, y, z, w,\n            x, y, z, w\n        ]);\n        x = billboard._rotation;\n        this._rotationArr = concatTypedArrays(this._rotationArr, [x, x, x, x, x, x]);\n        x = billboard._entity._pickingColor.x / 255;\n        y = billboard._entity._pickingColor.y / 255;\n        z = billboard._entity._pickingColor.z / 255;\n        this._pickingColorArr = concatTypedArrays(this._pickingColorArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n    }\n    get billboards() {\n        return this._billboards;\n    }\n    refreshTexCoordsArr() {\n        let bc = this._entityCollection;\n        if (bc && this._renderer) {\n            let ta = this._renderer.billboardsTextureAtlas;\n            for (let i = 0; i < this._billboards.length; i++) {\n                let bi = this._billboards[i];\n                let img = bi.getImage();\n                if (img) {\n                    let imageNode = ta.get(img.__nodeIndex);\n                    if (imageNode) {\n                        this.setTexCoordArr(bi._handlerIndex, imageNode.texCoords);\n                    }\n                }\n            }\n        }\n    }\n}\nexport { BillboardHandler };\n//# sourceMappingURL=BillboardHandler.js.map","import * as shaders from \"../shaders/geoObject\";\nimport { concatArrays, loadImage, makeArrayTyped, spliceArray } from \"../utils/shared\";\nconst VERTEX_BUFFER = 0;\nconst POSITION_BUFFER = 1;\nconst RGBA_BUFFER = 2;\nconst NORMALS_BUFFER = 3;\nconst INDEX_BUFFER = 4;\nconst DIRECTION_BUFFER = 5;\nconst PITCH_ROLL_BUFFER = 6;\nconst SIZE_BUFFER = 7;\nconst PICKINGCOLOR_BUFFER = 8;\nconst VISIBLE_BUFFER = 9;\nconst TEXCOORD_BUFFER = 10;\nfunction setParametersToArray(arr, index = 0, length = 0, itemSize = 1, ...params) {\n    const currIndex = index * length;\n    for (let i = currIndex, len = currIndex + length; i < len; i++) {\n        arr[i] = params[i % itemSize];\n    }\n    return arr;\n}\n// function setParametersToArrayArr(arr: number[] | TypedArray, index: number = 0, length: number = 0, itemSize: number = 1, paramsArr: number[]): number[] | TypedArray {\n//     const currIndex = index * length;\n//     for (let i = currIndex, len = currIndex + length; i < len; i++) {\n//         arr[i] = paramsArr[i % itemSize];\n//     }\n//     return arr;\n// }\nclass InstanceData {\n    constructor(geoObjectHandler) {\n        this.isFree = true;\n        this._geoObjectHandler = geoObjectHandler;\n        this.geoObjects = [];\n        this.numInstances = 0;\n        this._texture = null;\n        this._textureSrc = null;\n        this._pitchRollArr = [];\n        this._sizeArr = [];\n        this._vertexArr = [];\n        this._positionHighArr = [];\n        this._positionLowArr = [];\n        this._directionArr = [];\n        this._rgbaArr = [];\n        this._normalsArr = [];\n        this._indicesArr = [];\n        this._pickingColorArr = [];\n        this._visibleArr = [];\n        this._texCoordArr = [];\n        this._pitchRollBuffer = null;\n        this._sizeBuffer = null;\n        this._vertexBuffer = null;\n        this._positionHighBuffer = null;\n        this._positionLowBuffer = null;\n        this._directionBuffer = null;\n        this._rgbaBuffer = null;\n        this._normalsBuffer = null;\n        this._indicesBuffer = null;\n        this._pickingColorBuffer = null;\n        this._visibleBuffer = null;\n        this._texCoordBuffer = null;\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\n        this._buffersUpdateCallbacks[POSITION_BUFFER] = this.createPositionBuffer;\n        this._buffersUpdateCallbacks[DIRECTION_BUFFER] = this.createDirectionBuffer;\n        this._buffersUpdateCallbacks[NORMALS_BUFFER] = this.createNormalsBuffer;\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\n        this._buffersUpdateCallbacks[INDEX_BUFFER] = this.createIndicesBuffer;\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\n        this._buffersUpdateCallbacks[SIZE_BUFFER] = this.createSizeBuffer;\n        this._buffersUpdateCallbacks[PITCH_ROLL_BUFFER] = this.createPitchRollBuffer;\n        this._buffersUpdateCallbacks[VISIBLE_BUFFER] = this.createVisibleBuffer;\n        this._buffersUpdateCallbacks[TEXCOORD_BUFFER] = this.createTexCoordBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n    }\n    createTexture(image) {\n        if (this._geoObjectHandler && this._geoObjectHandler._planet) {\n            this._texture = this._geoObjectHandler._planet.renderer.handler.createTextureDefault(image);\n        }\n    }\n    clear() {\n        this.numInstances = 0;\n        this.geoObjects = [];\n        this._pitchRollArr = [];\n        this._sizeArr = [];\n        this._vertexArr = [];\n        this._positionHighArr = [];\n        this._positionLowArr = [];\n        this._directionArr = [];\n        this._rgbaArr = [];\n        this._normalsArr = [];\n        this._indicesArr = [];\n        this._pickingColorArr = [];\n        this._visibleArr = [];\n        this._texCoordArr = [];\n        this._deleteBuffers();\n        this.isFree = false;\n        //this._geoObjectHandler = null;\n    }\n    _deleteBuffers() {\n        if (this._geoObjectHandler && this._geoObjectHandler._planet && this._geoObjectHandler._planet.renderer) {\n            let h = this._geoObjectHandler._planet.renderer.handler, gl = h.gl;\n            h.deleteTexture(this._texture);\n            this._texture = null;\n            gl.deleteBuffer(this._pitchRollBuffer);\n            gl.deleteBuffer(this._sizeBuffer);\n            gl.deleteBuffer(this._vertexBuffer);\n            gl.deleteBuffer(this._positionHighBuffer);\n            gl.deleteBuffer(this._positionLowBuffer);\n            gl.deleteBuffer(this._directionBuffer);\n            gl.deleteBuffer(this._rgbaBuffer);\n            gl.deleteBuffer(this._normalsBuffer);\n            gl.deleteBuffer(this._indicesBuffer);\n            gl.deleteBuffer(this._pickingColorBuffer);\n            gl.deleteBuffer(this._visibleBuffer);\n            gl.deleteBuffer(this._texCoordBuffer);\n        }\n        this._pitchRollBuffer = null;\n        this._sizeBuffer = null;\n        this._vertexBuffer = null;\n        this._positionHighBuffer = null;\n        this._positionLowBuffer = null;\n        this._directionBuffer = null;\n        this._rgbaBuffer = null;\n        this._normalsBuffer = null;\n        this._indicesBuffer = null;\n        this._pickingColorBuffer = null;\n        this._visibleBuffer = null;\n        this._texCoordBuffer = null;\n    }\n    createVertexBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler;\n        h.gl.deleteBuffer(this._vertexBuffer);\n        this._vertexArr = makeArrayTyped(this._vertexArr);\n        this._vertexBuffer = h.createArrayBuffer(this._vertexArr, 3, this._vertexArr.length / 3);\n    }\n    createPitchRollBuffer() {\n        let h = this._geoObjectHandler._planet.renderer.handler, numItems = this._pitchRollArr.length / 2;\n        if (!this._pitchRollBuffer || this._pitchRollBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._pitchRollBuffer);\n            this._pitchRollBuffer = h.createStreamArrayBuffer(2, numItems);\n        }\n        this._pitchRollArr = makeArrayTyped(this._pitchRollArr);\n        h.setStreamArrayBuffer(this._pitchRollBuffer, this._pitchRollArr);\n    }\n    createVisibleBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler, numItems = this._visibleArr.length;\n        if (!this._visibleBuffer || this._visibleBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._visibleBuffer);\n            this._visibleBuffer = h.createStreamArrayBuffer(1, numItems);\n        }\n        this._visibleArr = makeArrayTyped(this._visibleArr);\n        h.setStreamArrayBuffer(this._visibleBuffer, this._visibleArr);\n    }\n    createSizeBuffer() {\n        let h = this._geoObjectHandler._planet.renderer.handler, numItems = this._sizeArr.length;\n        if (!this._sizeBuffer || this._sizeBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._sizeBuffer);\n            this._sizeBuffer = h.createStreamArrayBuffer(1, numItems);\n        }\n        this._sizeArr = makeArrayTyped(this._sizeArr);\n        h.setStreamArrayBuffer(this._sizeBuffer, this._sizeArr);\n    }\n    createTexCoordBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler;\n        h.gl.deleteBuffer(this._texCoordBuffer);\n        this._texCoordArr = makeArrayTyped(this._texCoordArr);\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr, 2, this._texCoordArr.length / 2);\n    }\n    createPositionBuffer() {\n        let h = this._geoObjectHandler._planet.renderer.handler, numItems = this._positionHighArr.length / 3;\n        if (!this._positionHighBuffer || this._positionHighBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._positionHighBuffer);\n            h.gl.deleteBuffer(this._positionLowBuffer);\n            this._positionHighBuffer = h.createStreamArrayBuffer(3, numItems);\n            this._positionLowBuffer = h.createStreamArrayBuffer(3, numItems);\n        }\n        this._positionHighArr = makeArrayTyped(this._positionHighArr);\n        this._positionLowArr = makeArrayTyped(this._positionLowArr);\n        h.setStreamArrayBuffer(this._positionHighBuffer, this._positionHighArr);\n        h.setStreamArrayBuffer(this._positionLowBuffer, this._positionLowArr);\n    }\n    createRgbaBuffer() {\n        let h = this._geoObjectHandler._planet.renderer.handler, numItems = this._rgbaArr.length / 4;\n        if (!this._rgbaBuffer || this._rgbaBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._rgbaBuffer);\n            this._rgbaBuffer = h.createStreamArrayBuffer(4, numItems);\n        }\n        this._rgbaArr = makeArrayTyped(this._rgbaArr);\n        h.setStreamArrayBuffer(this._rgbaBuffer, this._rgbaArr);\n    }\n    createDirectionBuffer() {\n        let h = this._geoObjectHandler._planet.renderer.handler, numItems = this._directionArr.length / 3;\n        if (!this._directionBuffer || this._directionBuffer.numItems !== numItems) {\n            h.gl.deleteBuffer(this._directionBuffer);\n            this._directionBuffer = h.createStreamArrayBuffer(3, numItems);\n        }\n        this._directionArr = makeArrayTyped(this._directionArr);\n        h.setStreamArrayBuffer(this._directionBuffer, this._directionArr);\n    }\n    createNormalsBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler;\n        h.gl.deleteBuffer(this._normalsBuffer);\n        this._normalsArr = makeArrayTyped(this._normalsArr);\n        this._normalsBuffer = h.createArrayBuffer(this._normalsArr, 3, this._normalsArr.length / 3);\n    }\n    createIndicesBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler;\n        h.gl.deleteBuffer(this._indicesBuffer);\n        this._indicesArr = makeArrayTyped(this._indicesArr, Uint32Array);\n        this._indicesBuffer = h.createElementArrayBuffer(this._indicesArr, 1, this._indicesArr.length);\n    }\n    createPickingColorBuffer() {\n        const h = this._geoObjectHandler._planet.renderer.handler;\n        h.gl.deleteBuffer(this._pickingColorBuffer);\n        this._pickingColorArr = makeArrayTyped(this._pickingColorArr);\n        this._pickingColorBuffer = h.createArrayBuffer(this._pickingColorArr, 3, this._pickingColorArr.length / 3);\n    }\n    refresh() {\n        let i = this._changedBuffers.length;\n        while (i--) {\n            this._changedBuffers[i] = true;\n        }\n    }\n    update() {\n        if (this._geoObjectHandler._planet) {\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n            this.isFree = true;\n        }\n    }\n}\nclass GeoObjectHandler {\n    constructor(entityCollection) {\n        this.__id = GeoObjectHandler.__counter__++;\n        this.pickingEnabled = true;\n        this._entityCollection = entityCollection;\n        this._planet = null;\n        this._geoObjects = [];\n        this._instanceDataMap = new Map();\n        this._instanceDataMapValues = [];\n        this._dataTagUpdateQueue = [];\n    }\n    initProgram() {\n        if (this._planet && this._planet.renderer) {\n            if (!this._planet.renderer.handler.programs.geo_object) {\n                this._planet.renderer.handler.addProgram(shaders.geo_object());\n            }\n            if (!this._planet.renderer.handler.programs.geo_object_picking) {\n                this._planet.renderer.handler.addProgram(shaders.geo_object_picking());\n            }\n        }\n    }\n    setRenderNode(renderNode) {\n        this._planet = renderNode;\n        this.initProgram();\n        //\n        // in case of lazy initialization loading data here\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\n            this._loadDataTagTexture(this._instanceDataMapValues[i]);\n        }\n        for (let i = 0; i < this._geoObjects.length; i++) {\n            this._geoObjects[i].updateDirection();\n        }\n        this.update();\n    }\n    _addGeoObjectToArray(geoObject) {\n        const tag = geoObject.tag;\n        let tagData = this._instanceDataMap.get(tag);\n        if (!tagData) {\n            tagData = new InstanceData(this);\n            this._instanceDataMap.set(tag, tagData);\n            this._instanceDataMapValues = Array.from(this._instanceDataMap.values());\n            //\n            // Setting instanced data\n            tagData._vertexArr = geoObject.vertices;\n            tagData._normalsArr = geoObject.normals;\n            tagData._indicesArr = geoObject.indices;\n            tagData._texCoordArr = geoObject.texCoords;\n            tagData._textureSrc = geoObject.object3d.src;\n            this._loadDataTagTexture(tagData);\n        }\n        geoObject._tagDataIndex = tagData.numInstances++;\n        geoObject._tagData = tagData;\n        tagData.geoObjects.push(geoObject);\n        let itemSize = 3;\n        tagData._visibleArr = concatArrays(tagData._visibleArr, setParametersToArray([], 0, 1, 1, geoObject.getVisibility() ? 1 : 0));\n        let x = geoObject._positionHigh.x, y = geoObject._positionHigh.y, z = geoObject._positionHigh.z, w;\n        tagData._positionHighArr = concatArrays(tagData._positionHighArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\n        x = geoObject._positionLow.x;\n        y = geoObject._positionLow.y;\n        z = geoObject._positionLow.z;\n        tagData._positionLowArr = concatArrays(tagData._positionLowArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\n        x = geoObject._entity._pickingColor.x / 255;\n        y = geoObject._entity._pickingColor.y / 255;\n        z = geoObject._entity._pickingColor.z / 255;\n        tagData._pickingColorArr = concatArrays(tagData._pickingColorArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\n        x = geoObject._direction.x;\n        y = geoObject._direction.y;\n        z = geoObject._direction.z;\n        tagData._directionArr = concatArrays(tagData._directionArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z));\n        itemSize = 4;\n        x = geoObject._color.x;\n        y = geoObject._color.y;\n        z = geoObject._color.z;\n        w = geoObject._color.w;\n        tagData._rgbaArr = concatArrays(tagData._rgbaArr, setParametersToArray([], 0, itemSize, itemSize, x, y, z, w));\n        itemSize = 2;\n        x = geoObject.getPitch();\n        y = geoObject.getRoll();\n        tagData._pitchRollArr = concatArrays(tagData._pitchRollArr, setParametersToArray([], 0, itemSize, itemSize, x, y));\n        itemSize = 1;\n        tagData._sizeArr = concatArrays(tagData._sizeArr, setParametersToArray([], 0, itemSize, itemSize, geoObject.getScale()));\n    }\n    _displayPASS() {\n        let r = this._planet.renderer, sh = r.handler.programs.geo_object, p = sh._program, u = p.uniforms, a = p.attributes, gl = r.handler.gl, ec = this._entityCollection;\n        sh.activate();\n        //\n        // Could be in VAO\n        //\n        gl.uniform3fv(u.uScaleByDistance, ec.scaleByDistance);\n        gl.uniform3fv(u.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(u.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniformMatrix4fv(u.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniformMatrix4fv(u.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniform3fv(u.lightsPositions, this._planet._lightsPositions);\n        gl.uniform3fv(u.lightsParamsv, this._planet._lightsParamsv);\n        gl.uniform1fv(u.lightsParamsf, this._planet._lightsParamsf);\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\n            let tagData = this._instanceDataMapValues[i];\n            //\n            //  Instance individual data\n            //\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._directionBuffer);\n            gl.vertexAttribPointer(a.aDirection, tagData._directionBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._sizeBuffer);\n            gl.vertexAttribPointer(a.aScale, tagData._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._pitchRollBuffer);\n            gl.vertexAttribPointer(a.aPitchRoll, tagData._pitchRollBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._rgbaBuffer);\n            gl.vertexAttribPointer(a.aColor, tagData._rgbaBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._visibleBuffer);\n            gl.vertexAttribPointer(a.aDispose, tagData._visibleBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.uniform1f(u.uUseTexture, tagData._texture ? 1 : 0);\n            //\n            // Instance common data(could be in VAO)\n            //\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._positionHighBuffer);\n            gl.vertexAttribPointer(a.aPositionHigh, tagData._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._positionLowBuffer);\n            gl.vertexAttribPointer(a.aPositionLow, tagData._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._normalsBuffer);\n            gl.vertexAttribPointer(a.aVertexNormal, tagData._normalsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._vertexBuffer);\n            gl.vertexAttribPointer(a.aVertexPosition, tagData._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, (tagData._texture || r.handler.defaultTexture));\n            gl.uniform1i(u.uTexture, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._texCoordBuffer);\n            gl.vertexAttribPointer(a.aTexCoord, tagData._texCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, tagData._indicesBuffer);\n            p.drawElementsInstanced(gl.TRIANGLES, tagData._indicesBuffer.numItems, gl.UNSIGNED_INT, 0, tagData.numInstances);\n        }\n    }\n    drawPicking() {\n        if (this._geoObjects.length && this.pickingEnabled) {\n            this.update();\n            this._pickingPASS();\n        }\n    }\n    _pickingPASS() {\n        let r = this._planet.renderer, sh = r.handler.programs.geo_object_picking, p = sh._program, u = p.uniforms, a = p.attributes, gl = r.handler.gl, ec = this._entityCollection;\n        sh.activate();\n        gl.uniform3fv(u.uScaleByDistance, ec.scaleByDistance);\n        gl.uniform1f(u.pickingScale, ec.pickingScale);\n        gl.uniform3fv(u.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(u.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniformMatrix4fv(u.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniformMatrix4fv(u.viewMatrix, false, r.activeCamera.getViewMatrix());\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\n            let tagData = this._instanceDataMapValues[i];\n            //\n            // Instance individual data\n            //\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._directionBuffer);\n            gl.vertexAttribPointer(a.aDirection, tagData._directionBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._sizeBuffer);\n            gl.vertexAttribPointer(a.aScale, tagData._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._pitchRollBuffer);\n            gl.vertexAttribPointer(a.aPitchRoll, tagData._pitchRollBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._pickingColorBuffer);\n            gl.vertexAttribPointer(a.aPickingColor, tagData._pickingColorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._positionHighBuffer);\n            gl.vertexAttribPointer(a.aPositionHigh, tagData._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._positionLowBuffer);\n            gl.vertexAttribPointer(a.aPositionLow, tagData._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._visibleBuffer);\n            gl.vertexAttribPointer(a.aDispose, tagData._visibleBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            //\n            // Instance common data(could be in VAO)\n            //\n            gl.bindBuffer(gl.ARRAY_BUFFER, tagData._vertexBuffer);\n            gl.vertexAttribPointer(a.aVertexPosition, tagData._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, tagData._indicesBuffer);\n            p.drawElementsInstanced(gl.TRIANGLES, tagData._indicesBuffer.numItems, gl.UNSIGNED_INT, 0, tagData.numInstances);\n        }\n    }\n    async _loadDataTagTexture(tagData) {\n        if (this._planet && tagData._textureSrc) {\n            const image = await loadImage(tagData._textureSrc);\n            tagData.createTexture(image);\n        }\n    }\n    setDirectionArr(tagData, tagDataIndex, direction) {\n        setParametersToArray(tagData._directionArr, tagDataIndex, 3, 3, direction.x, direction.y, direction.z);\n        tagData._changedBuffers[DIRECTION_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    setVisibility(tagData, tagDataIndex, visibility) {\n        setParametersToArray(tagData._visibleArr, tagDataIndex, 1, 1, visibility ? 1 : 0);\n        tagData._changedBuffers[VISIBLE_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    setPositionArr(tagData, tagDataIndex, positionHigh, positionLow) {\n        setParametersToArray(tagData._positionHighArr, tagDataIndex, 3, 3, positionHigh.x, positionHigh.y, positionHigh.z);\n        setParametersToArray(tagData._positionLowArr, tagDataIndex, 3, 3, positionLow.x, positionLow.y, positionLow.z);\n        tagData._changedBuffers[POSITION_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    setRgbaArr(tagData, tagDataIndex, rgba) {\n        setParametersToArray(tagData._rgbaArr, tagDataIndex, 4, 4, rgba.x, rgba.y, rgba.z, rgba.w);\n        tagData._changedBuffers[RGBA_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    setPickingColorArr(tagData, tagDataIndex, color) {\n        setParametersToArray(tagData._pickingColorArr, tagDataIndex, 3, 3, color.x / 255, color.y / 255, color.z / 255);\n        tagData._changedBuffers[PICKINGCOLOR_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    // setTexCoordArr(tagData, tagDataIndex, tcoordArr) {\n    //     setParametersToArray(tagData._texCoordArr, tagDataIndex, 2, 2, ...tcoordArr);\n    //     tagData._changedBuffers[TEXCOORD_BUFFER] = true;\n    //     this._updateTag(tagData);\n    // }\n    setPitchRollArr(tagData, tagDataIndex, pitch, roll) {\n        setParametersToArray(tagData._pitchRollArr, tagDataIndex, 2, 2, pitch, roll);\n        tagData._changedBuffers[PITCH_ROLL_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    setScaleArr(tagData, tagDataIndex, scale) {\n        setParametersToArray(tagData._sizeArr, tagDataIndex, 1, 1, scale);\n        tagData._changedBuffers[SIZE_BUFFER] = true;\n        this._updateTag(tagData);\n    }\n    _updateTag(dataTag) {\n        if (dataTag.isFree) {\n            dataTag.isFree = false;\n            this._dataTagUpdateQueue.push(dataTag);\n        }\n    }\n    update() {\n        for (let i = 0, len = this._dataTagUpdateQueue.length; i < len; i++) {\n            this._dataTagUpdateQueue[i].update();\n        }\n        this._dataTagUpdateQueue = [];\n    }\n    _removeAll() {\n        let i = this._geoObjects.length;\n        while (i--) {\n            const gi = this._geoObjects[i];\n            gi._tagDataIndex = -1;\n            gi._tagData = null;\n            gi._handlerIndex = -1;\n            gi._handler = null;\n        }\n        this._geoObjects.length = 0;\n        this._geoObjects = [];\n        for (let i = 0; i < this._instanceDataMapValues.length; i++) {\n            this._instanceDataMapValues[i].clear();\n        }\n        this._instanceDataMap.clear();\n        this._instanceDataMapValues = [];\n    }\n    clear() {\n        this._removeAll();\n    }\n    draw() {\n        if (this._geoObjects.length) {\n            this.update();\n            this._displayPASS();\n        }\n    }\n    add(geoObject) {\n        if (geoObject._handlerIndex === -1) {\n            geoObject._handler = this;\n            geoObject._handlerIndex = this._geoObjects.length;\n            this._geoObjects.push(geoObject);\n            this._addGeoObjectToArray(geoObject);\n            geoObject.updateDirection();\n            geoObject._tagData.refresh();\n            this._updateTag(geoObject._tagData);\n        }\n    }\n    remove(geoObject) {\n        if (geoObject._handler && this.__id == geoObject._handler.__id) {\n            this._removeGeoObject(geoObject);\n        }\n    }\n    _clearDataTagQueue() {\n        this._dataTagUpdateQueue = [];\n    }\n    _removeGeoObject(geoObject) {\n        let tagData = geoObject._tagData;\n        let tag = geoObject.tag;\n        tagData.numInstances--;\n        let isEmpty = false;\n        // dataTag becomes empty, remove it from the rendering\n        if (tagData.numInstances === 0) {\n            tagData.clear();\n            this._instanceDataMap.delete(tag);\n            this._instanceDataMapValues = [];\n            this._clearDataTagQueue();\n            isEmpty = true;\n        }\n        this._geoObjects.splice(geoObject._handlerIndex, 1);\n        for (let i = geoObject._handlerIndex, len = this._geoObjects.length; i < len; i++) {\n            let gi = this._geoObjects[i];\n            gi._handlerIndex = gi._handlerIndex - 1;\n        }\n        let tdi = geoObject._tagDataIndex;\n        tagData.geoObjects.splice(tdi, 1);\n        for (let i = geoObject._tagDataIndex, len = tagData.geoObjects.length; i < len; i++) {\n            let gi = tagData.geoObjects[i];\n            gi._tagDataIndex = gi._tagDataIndex - 1;\n        }\n        tagData._rgbaArr = spliceArray(tagData._rgbaArr, tdi * 4, 4);\n        tagData._positionHighArr = spliceArray(tagData._positionHighArr, tdi * 3, 3);\n        tagData._positionLowArr = spliceArray(tagData._positionLowArr, tdi * 3, 3);\n        tagData._directionArr = spliceArray(tagData._directionArr, tdi * 3, 3);\n        tagData._pickingColorArr = spliceArray(tagData._pickingColorArr, tdi * 3, 3);\n        tagData._pitchRollArr = spliceArray(tagData._pitchRollArr, tdi * 2, 2);\n        tagData._sizeArr = spliceArray(tagData._sizeArr, tdi, 1);\n        tagData._visibleArr = spliceArray(tagData._visibleArr, tdi, 1);\n        geoObject._handlerIndex = -1;\n        geoObject._handler = null;\n        geoObject._tagDataIndex = -1;\n        geoObject._tagData = null;\n        if (!isEmpty) {\n            tagData.refresh();\n            this._updateTag(tagData);\n        }\n    }\n}\nGeoObjectHandler.__counter__ = 0;\nexport { GeoObjectHandler, InstanceData };\n//# sourceMappingURL=GeoObjectHandler.js.map","import { Program } from \"../webgl/Program\";\nexport const geo_object = () => new Program(\"geo_object\", {\n    uniforms: {\n        viewMatrix: \"mat4\",\n        projectionMatrix: \"mat4\",\n        uScaleByDistance: \"vec3\",\n        eyePositionHigh: \"vec3\",\n        eyePositionLow: \"vec3\",\n        lightsPositions: \"vec3\",\n        lightsParamsv: \"vec3\",\n        lightsParamsf: \"float\",\n        uTexture: \"sampler2d\",\n        uUseTexture: \"float\"\n    },\n    attributes: {\n        aVertexPosition: \"vec3\",\n        aVertexNormal: \"vec3\",\n        aTexCoord: \"vec2\",\n        aPositionHigh: { type: \"vec3\", divisor: 1 },\n        aPositionLow: { type: \"vec3\", divisor: 1 },\n        aDirection: { type: \"vec3\", divisor: 1 },\n        aPitchRoll: { type: \"vec2\", divisor: 1 },\n        aColor: { type: \"vec4\", divisor: 1 },\n        aScale: { type: \"float\", divisor: 1 },\n        aDispose: { type: \"float\", divisor: 1 }\n    },\n    vertexShader: `precision highp float;\n            \n            attribute vec3 aVertexPosition;\n            attribute vec3 aVertexNormal; \n            attribute vec3 aPositionHigh;\n            attribute vec3 aPositionLow;    \n            attribute vec3 aDirection;\n            attribute vec2 aPitchRoll;\n            attribute vec4 aColor;\n            attribute float aScale;\n            attribute float aDispose;\n            attribute float aUseTexture;\n            attribute vec2 aTexCoord;\n            \n            uniform float uUseTexture;\n            uniform vec3 uScaleByDistance;\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            \n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n\n            varying vec3 cameraPosition;\n            varying vec3 vNormal;\n            varying vec3 v_vertex;           \n            varying vec4 vColor;\n            varying float vDispose;\n            varying float vUseTexture;\n            varying vec2 vTexCoords;\n            \n            const float PI = 3.141592653589793;\n            \n            const float RADIANS = PI / 180.0;\n           \n            void main(void) {\n            \n                if (aDispose == 0.0) {\n                   return;\n                }\n            \n                vUseTexture = uUseTexture;\n                vColor = aColor;\n                vTexCoords = aTexCoord;\n              \n                float cos_roll = cos(aPitchRoll.y);\n                float sin_roll = sin(aPitchRoll.y);\n                \n                mat3 rotZ = mat3(\n                     vec3(cos_roll, sin_roll, 0.0),\n                     vec3(-sin_roll, cos_roll, 0.0), \n                     vec3(0.0, 0.0, 1.0) \n                );\n\n                float cos_pitch = cos(aPitchRoll.x);\n                float sin_pitch = sin(aPitchRoll.x);\n\n                mat3 rotX = mat3(\n                    vec3(1.0, 0.0, 0.0),\n                    vec3(0.0, cos_pitch, sin_pitch), \n                    vec3(0.0, -sin_pitch, cos_pitch) \n               );\n\n                vec3 position = aPositionHigh + aPositionLow;\n                cameraPosition = eyePositionHigh + eyePositionLow;\n                vec3 r = cross(normalize(-position), aDirection);\n                mat3 modelMatrix = mat3(r, normalize(position), -aDirection) * rotX * rotZ;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = aPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aPositionLow - eyePositionLow;\n             \n                vec3 look = cameraPosition - position;\n                float lookLength = length(look);\n                vNormal = modelMatrix * aVertexNormal;\n                               \n                // if(lookLength > uScaleByDistance[1])\n                // {\n                //     scd = uScaleByDistance[1] / uScaleByDistance[0];\n                // }\n                // else if(lookLength > uScaleByDistance[0])\n                // {\n                //     scd = lookLength / uScaleByDistance[0];\n                // }\n                // ... is the same math\n                float scd = uScaleByDistance[2] * clamp(lookLength, uScaleByDistance[0], uScaleByDistance[1]) / uScaleByDistance[0];\n                \n                vec3 vert = modelMatrix * aVertexPosition * aScale * scd;\n                v_vertex = position + vert;\n                \n                // @hack\n                // Mac/Safari affects on lowDiff somehow. \n                vert += lowDiff;\n                               \n                gl_Position = projectionMatrix * viewMatrixRTE  * vec4(highDiff + vert, 1.0);\n            }`,\n    fragmentShader: `precision highp float;\n\n                #define MAX_POINT_LIGHTS 1\n                \n                uniform vec3 lightsPositions[MAX_POINT_LIGHTS];\n                uniform vec3 lightsParamsv[MAX_POINT_LIGHTS * 3];\n                uniform float lightsParamsf[MAX_POINT_LIGHTS];                \n                uniform sampler2D uTexture;\n                \n                varying vec3 cameraPosition;\n                varying vec3 v_vertex;                \n                varying vec4 vColor;\n                varying vec3 vNormal;\n                varying vec2 vTexCoords;\n                varying float vUseTexture;\n                \n                void main(void) {                \n                    vec3 normal = normalize(vNormal);\n                \n                    vec3 lightDir = normalize(lightsPositions[0]);\n                    vec3 viewDir = normalize(cameraPosition - v_vertex);                \n                    vec3 reflectionDirection = reflect(-lightDir, normal);\n                    float reflection = max( dot(reflectionDirection, viewDir), 0.0);\n                    float specularLightWeighting = pow( reflection, lightsParamsf[0]);                                        \n                    float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);\n                    vec3 lightWeighting = lightsParamsv[0] + lightsParamsv[1] * diffuseLightWeighting + lightsParamsv[2] * specularLightWeighting;\n                    vec4 tColor = texture2D(uTexture, vTexCoords);\n                    if(vUseTexture > 0.0){\n                        gl_FragColor = vec4(tColor.rgb * lightWeighting, tColor.a);\n                    } else {\n                        gl_FragColor = vec4(vColor.rgb * lightWeighting, vColor.a);\n                    }\n                }`\n});\nexport const geo_object_picking = () => new Program(\"geo_object_picking\", {\n    uniforms: {\n        viewMatrix: \"mat4\",\n        projectionMatrix: \"mat4\",\n        uScaleByDistance: \"vec3\",\n        eyePositionHigh: \"vec3\",\n        eyePositionLow: \"vec3\",\n        pickingScale: \"float\"\n    },\n    attributes: {\n        aVertexPosition: \"vec3\",\n        aPositionHigh: { type: \"vec3\", divisor: 1 },\n        aPositionLow: { type: \"vec3\", divisor: 1 },\n        aDirection: { type: \"vec3\", divisor: 1 },\n        aPitchRoll: { type: \"vec2\", divisor: 1 },\n        aPickingColor: { type: \"vec3\", divisor: 1 },\n        aScale: { type: \"float\", divisor: 1 },\n        aDispose: { type: \"float\", divisor: 1 }\n    },\n    vertexShader: `precision highp float;\n\n            attribute vec3 aVertexPosition;\n            attribute vec3 aPositionHigh;\n            attribute vec3 aPositionLow;    \n            attribute vec3 aDirection;\n            attribute vec3 aPickingColor;\n            attribute vec2 aPitchRoll;\n            attribute float aScale;\n            attribute float aDispose;\n            \n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform vec3 uScaleByDistance;\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform float pickingScale;\n\n            varying vec3 vColor;\n            \n            const float RADIANS = 3.141592653589793 / 180.0;\n\n            void main(void) {\n\n                if (aDispose == 0.0) {\n                    return;\n                 }\n            \n                 vColor = aPickingColor;\n               \n                float cos_roll = cos(aPitchRoll.y);\n                float sin_roll = sin(aPitchRoll.y);\n                \n                mat3 rotZ = mat3(\n                     vec3(cos_roll, sin_roll, 0.0),\n                     vec3(-sin_roll, cos_roll, 0.0), \n                     vec3(0.0, 0.0, 1.0) \n                );\n\n                float cos_pitch = cos(aPitchRoll.x);\n                float sin_pitch = sin(aPitchRoll.x);\n\n                mat3 rotX = mat3(\n                    vec3(1.0, 0.0, 0.0),\n                    vec3(0.0, cos_pitch, sin_pitch), \n                    vec3(0.0, -sin_pitch, cos_pitch) \n               );\n \n                 vec3 position = aPositionHigh + aPositionLow;\n                 vec3 cameraPosition = eyePositionHigh + eyePositionLow;\n                 vec3 r = cross(normalize(-position), aDirection);\n                 mat3 modelMatrix = mat3(r, normalize(position), -aDirection) * rotX * rotZ;\n \n                 mat4 viewMatrixRTE = viewMatrix;\n                 viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n \n                 vec3 highDiff = aPositionHigh - eyePositionHigh;\n                 vec3 lowDiff = aPositionLow - eyePositionLow;\n              \n                 vec3 look = cameraPosition - position;\n                 float lookLength = length(look);\n                                \n                 // if(lookLength > uScaleByDistance[1])\n                 // {\n                 //     scd = uScaleByDistance[1] / uScaleByDistance[0];\n                 // }\n                 // else if(lookLength > uScaleByDistance[0])\n                 // {\n                 //     scd = lookLength / uScaleByDistance[0];\n                 // }\n                 // ... is the same math above\n                 // @hack\n                 // pickingScale replace to this line, because when it s\n                 // tays in the vert above it affects on Mac Safari jitter\n                 float scd = pickingScale * uScaleByDistance[2] * clamp(lookLength, uScaleByDistance[0], uScaleByDistance[1]) / uScaleByDistance[0];\n\n                 vec3 vert = modelMatrix * aVertexPosition * aScale * scd;\n                 \n                 vert += lowDiff;\n                                \n                 gl_Position = projectionMatrix * viewMatrixRTE  * vec4(highDiff + vert, 1.0);\n            }`,\n    fragmentShader: `precision highp float;\n            varying vec3 vColor;\n            void main () {\n                gl_FragColor = vec4(vColor, 1.0);\n            }`\n});\n//# sourceMappingURL=geoObject.js.map","import { Program } from '../webgl/Program';\nconst DEFINE = `\n#define EMPTY -1.0\n#define RTL 1.0`;\nconst PROJECT = `vec2 project(vec4 p) {\n                    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\n                }`;\nconst ROTATE2D = `mat2 rotate2d(float angle) {\n        return mat2(cos(angle), -sin(angle),\n           sin(angle), cos(angle));\n     }`;\nexport function label_webgl2() {\n    return new Program(\"label\", {\n        uniforms: {\n            viewport: \"vec2\",\n            fontTextureArr: \"sampler2darray\",\n            sdfParamsArr: \"vec4\",\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            planetRadius: \"float\",\n            scaleByDistance: \"vec3\",\n            opacity: \"float\",\n            isOutlinePass: \"int\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            a_outline: \"float\",\n            a_gliphParam: \"vec4\",\n            a_vertices: \"vec2\",\n            a_texCoord: \"vec4\",\n            a_positionsHigh: \"vec3\",\n            a_positionsLow: \"vec3\",\n            a_size: \"float\",\n            a_rotation: \"float\",\n            a_rgba: \"vec4\",\n            a_offset: \"vec3\",\n            a_fontIndex: \"float\"\n        },\n        vertexShader: `#version 300 es\n            \n            ${DEFINE}\n            \n            in float a_outline;\n            in vec4 a_gliphParam;\n            in vec2 a_vertices;\n            in vec4 a_texCoord;\n            in vec3 a_positionsHigh;\n            in vec3 a_positionsLow;\n            in vec3 a_offset;\n            in float a_size;\n            in float a_rotation;\n            in vec4 a_rgba;\n            in float a_fontIndex;\n\n            out vec2 v_uv;\n            out vec4 v_rgba;\n            flat out int v_fontIndex;            \n            out vec4 v_outlineColor;\n            flat out float v_outline;\n\n            uniform vec2 viewport;\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float planetRadius;\n            uniform vec3 scaleByDistance;\n            uniform float opacity;\n            uniform float depthOffset;\n\n            const vec3 ZERO3 = vec3(0.0);\n           \n            ${PROJECT}\n\n            ${ROTATE2D}\n\n            void main() {\n\n                if(a_texCoord.w == EMPTY) {\n                    gl_Position = vec4(0.0);\n                    v_fontIndex = -1;\n                    return;\n                }\n               \n                vec3 a_positions = a_positionsHigh + a_positionsLow;\n                vec3 cameraPos = eyePositionHigh + eyePositionLow;\n\n                v_outline = a_outline;\n\n                v_fontIndex = int(a_fontIndex);\n                v_uv = a_texCoord.xy;\n                vec3 look = a_positions - cameraPos;\n                float lookDist = length(look);\n                v_rgba = a_rgba;\n                \n                if(opacity * step(lookDist, sqrt(dot(cameraPos,cameraPos) - planetRadius) + sqrt(dot(a_positions,a_positions) - planetRadius)) == 0.0){\n                    return;\n                }\n\n                float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\n\n                v_rgba.a *= opacity;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = a_positionsHigh - eyePositionHigh;\n                vec3 lowDiff = a_positionsLow - eyePositionLow;\n                vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                vec4 projPos = projectionMatrix * posRTE;\n                                \n                float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));                \n                if(camSlope > 0.5) {\n                    float dist = dot(look, normalize(cameraPos));\n                    projPos.z += dist * 0.02;                  \n                }else{\n                    projPos.z += -(abs(projPos.z)) * 0.002;                 \n                }\n                        \n                projPos.z += depthOffset + a_offset.z;\n                               \n                vec2 screenPos = project(projPos);\n                \n                vec2 vert = a_vertices;                \n                vec4 gp = a_gliphParam;                                \n                if(a_texCoord.w == RTL){\n                    vert.x = step(vert.x * 0.5 + 1.0, 1.0);\n                    gp.x = -a_gliphParam.x;\n                    gp.z = -(a_gliphParam.z + a_texCoord.z);\n                }else{\n                    gp.z = a_gliphParam.z + a_texCoord.z;\n                }\n                                \n                vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\n\n                gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\n            }`,\n        fragmentShader: `#version 300 es\n\n            uniform int isOutlinePass;\n            \n            precision highp float;\n\n            const int MAX_SIZE = 11;\n\n            // x - ATLAS_WIDTH = 512.0;\n            // y - ATLAS_HEIGHT = 512.0;\n            // z - ATLAS_GLYPH_SIZE = 32.0;\n            // w - ATLAS_FIELD_RANGE = 8.0;\n\n            uniform sampler2D fontTextureArr[MAX_SIZE];\n            uniform vec4 sdfParamsArr[MAX_SIZE];\n\n            flat in int v_fontIndex;\n            in vec2 v_uv;\n            in vec4 v_rgba;           \n\n            flat in float v_outline;\n\n            in vec3 v_pickingColor;\n\n            layout(location = 0) out vec4 outScreen;\n\n            float median(float r, float g, float b) {\n                return max(min(r, g), min(max(r, g), b));\n            }\n\n            float getDistance() {\n                vec3 msdf;\n                if(v_fontIndex == 0) {\n                    msdf = texture(fontTextureArr[0], v_uv).rgb;\n                } else if(v_fontIndex == 1){\n                    msdf = texture(fontTextureArr[1], v_uv).rgb;\n                } else if(v_fontIndex == 2){\n                    msdf = texture(fontTextureArr[2], v_uv).rgb;\n                } else if(v_fontIndex == 3){\n                    msdf = texture(fontTextureArr[3], v_uv).rgb;\n                } else if(v_fontIndex == 4){\n                    msdf = texture(fontTextureArr[4], v_uv).rgb;\n                } else if(v_fontIndex == 5){\n                    msdf = texture(fontTextureArr[5], v_uv).rgb;\n                } else if(v_fontIndex == 6){\n                    msdf = texture(fontTextureArr[6], v_uv).rgb;\n                } else if(v_fontIndex == 7){\n                    msdf = texture(fontTextureArr[7], v_uv).rgb;\n                } else if(v_fontIndex == 8){\n                    msdf = texture(fontTextureArr[8], v_uv).rgb;\n                } else if(v_fontIndex == 9){\n                    msdf = texture(fontTextureArr[9], v_uv).rgb;\n                } else if(v_fontIndex == 10){\n                    msdf = texture(fontTextureArr[10], v_uv).rgb;\n                }\n                return median(msdf.r, msdf.g, msdf.b);\n            }\n                        \n            void main () {\n            \n                if(v_fontIndex == -1) {\n                    return;\n                }\n                \n                vec4 sdfParams = sdfParamsArr[v_fontIndex];\n                float sd = getDistance();             \n                vec2 dxdy = fwidth(v_uv) * sdfParams.xy;\n\n                if(isOutlinePass == 0){                             \n                    float dist = sd + min(0.001, 0.5 - 1.0 / sdfParams.w) - 0.5;\n                    float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\n                    if(opacity <= 0.1){\n                        discard;\n                    }\n                    outScreen = vec4(v_rgba.rgb, opacity * v_rgba.a);\n                } else {             \n                    float dist = sd + min(v_outline, 0.5 - 1.0 / sdfParams.w) - 0.5;\n                    float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);                       \n                    if(opacity <= 0.1){\n                        discard;\n                    }\n                    outScreen = vec4(v_rgba.rgb, opacity * v_rgba.a);\n                    //outScreen = v_rgba * strokeAlpha * (0.5 - opacity) * 2.0;\n                }         \n            }`\n    });\n}\nexport function label_screen() {\n    return new Program(\"label\", {\n        uniforms: {\n            viewport: \"vec2\",\n            fontTextureArr: \"sampler2darray\",\n            sdfParamsArr: \"vec4\",\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            planetRadius: \"float\",\n            scaleByDistance: \"vec3\",\n            opacity: \"float\",\n            isOutlinePass: \"int\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            a_outline: \"float\",\n            a_gliphParam: \"vec4\",\n            a_vertices: \"vec2\",\n            a_texCoord: \"vec4\",\n            a_positionsHigh: \"vec3\",\n            a_positionsLow: \"vec3\",\n            a_size: \"float\",\n            a_rotation: \"float\",\n            a_rgba: \"vec4\",\n            a_offset: \"vec3\",\n            a_fontIndex: \"float\"\n        },\n        vertexShader: `            \n            ${DEFINE}\n                        \n            attribute float a_outline;\n            attribute vec4 a_gliphParam;\n            attribute vec2 a_vertices;\n            attribute vec4 a_texCoord;\n            attribute vec3 a_positionsHigh;\n            attribute vec3 a_positionsLow;\n            attribute vec3 a_offset;\n            attribute float a_size;\n            attribute float a_rotation;\n            attribute vec4 a_rgba;\n            attribute float a_fontIndex;\n\n            varying float v_outline;\n            varying vec2 v_uv;\n            varying vec4 v_rgba;\n            varying float v_fontIndex;            \n\n            uniform vec2 viewport;\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float planetRadius;\n            uniform vec3 scaleByDistance;\n            uniform float opacity;\n            uniform float depthOffset;\n\n            const vec3 ZERO3 = vec3(0.0);\n\n            ${PROJECT}\n\n            ${ROTATE2D}\n\n            void main() {\n\n                if(a_texCoord.w == EMPTY) {\n                    gl_Position = vec4(0.0);\n                    v_fontIndex = -1.0;\n                    return;\n                }\n               \n                vec3 a_positions = a_positionsHigh + a_positionsLow;\n                vec3 cameraPos = eyePositionHigh + eyePositionLow;\n\n                v_outline = a_outline;\n                v_uv = vec2(a_texCoord.xy);\n                v_rgba = a_rgba;\n                v_fontIndex = a_fontIndex;\n                \n                vec3 look = a_positions - cameraPos;\n                float lookDist = length(look);\n                \n                if(opacity * step(lookDist, sqrt(dot(cameraPos,cameraPos) - planetRadius) + sqrt(dot(a_positions,a_positions) - planetRadius)) == 0.0){\n                    return;\n                }\n\n                float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\n\n                v_rgba.a *= opacity;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = a_positionsHigh - eyePositionHigh;\n                vec3 lowDiff = a_positionsLow - eyePositionLow;\n                vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                vec4 projPos = projectionMatrix * posRTE;\n                                \n                float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));                \n                if(camSlope > 0.5) {\n                    float dist = dot(look, normalize(cameraPos));\n                    projPos.z += dist * 0.02;                  \n                }else{\n                    projPos.z += -(abs(projPos.z)) * 0.002;                 \n                }\n                        \n                projPos.z += depthOffset + a_offset.z;\n                               \n                vec2 screenPos = project(projPos);\n                \n                vec2 vert = a_vertices;                \n                vec4 gp = a_gliphParam;                                \n                if(a_texCoord.w == RTL){\n                    vert.x = step(vert.x * 0.5 + 1.0, 1.0);\n                    gp.x = -a_gliphParam.x;\n                    gp.z = -(a_gliphParam.z + a_texCoord.z);\n                }else{\n                    gp.z = a_gliphParam.z + a_texCoord.z;\n                }\n                                \n                vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\n                \n                gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\n            }`,\n        fragmentShader: `#extension GL_OES_standard_derivatives : enable\n\n            precision highp float;\n            precision highp int;\n\n            const int MAX_SIZE = 11;\n\n            // x - ATLAS_WIDTH = 512.0;\n            // y - ATLAS_HEIGHT = 512.0;\n            // z - ATLAS_GLYPH_SIZE = 32.0;\n            // w - ATLAS_FIELD_RANGE = 8.0;\n\n            uniform sampler2D fontTextureArr[MAX_SIZE];\n            uniform vec4 sdfParamsArr[MAX_SIZE];\n            uniform int isOutlinePass;\n            \n            varying float v_outline;\n            varying vec2 v_uv;\n            varying vec4 v_rgba;           \n            varying float v_fontIndex;\n            \n            float fontIndex;\n\n            float median(float r, float g, float b) {\n                return max(min(r, g), min(max(r, g), b));\n            }\n\n            float getDistance() {\n                vec3 msdf;\n                if(fontIndex >= 0.0 && fontIndex < 1.0) {\n                    msdf = texture2D(fontTextureArr[0], v_uv).rgb;\n                } else if(fontIndex >= 1.0 && fontIndex < 2.0){\n                    msdf = texture2D(fontTextureArr[1], v_uv).rgb;\n                } else if(fontIndex >= 2.0 && fontIndex < 3.0){\n                    msdf = texture2D(fontTextureArr[2], v_uv).rgb;\n                } else if(fontIndex >= 3.0 && fontIndex < 4.0){\n                    msdf = texture2D(fontTextureArr[3], v_uv).rgb;\n                } else if(fontIndex >= 4.0 && fontIndex < 5.0){\n                    msdf = texture2D(fontTextureArr[4], v_uv).rgb;\n                } else if(fontIndex >= 5.0 && fontIndex < 6.0){\n                    msdf = texture2D(fontTextureArr[5], v_uv).rgb;\n                } else if(fontIndex >= 6.0 && fontIndex < 7.0){\n                    msdf = texture2D(fontTextureArr[6], v_uv).rgb;\n                } else if(fontIndex >= 7.0 && fontIndex < 8.0){\n                    msdf = texture2D(fontTextureArr[7], v_uv).rgb;\n                } else if(fontIndex >= 8.0 && fontIndex < 9.0){\n                    msdf = texture2D(fontTextureArr[8], v_uv).rgb;\n                } else if(fontIndex >= 9.0 && fontIndex < 10.0){\n                    msdf = texture2D(fontTextureArr[9], v_uv).rgb;\n                } else if(fontIndex >= 10.0 && fontIndex < 11.0){\n                    msdf = texture2D(fontTextureArr[10], v_uv).rgb;\n                }\n                return median(msdf.r, msdf.g, msdf.b);\n            }\n\n\n            vec4 getSDFParams() {\n                if(fontIndex >= 0.0 && fontIndex < 1.0) {\n                    return sdfParamsArr[0];\n                } else if(fontIndex >= 1.0 && fontIndex < 2.0){\n                    return sdfParamsArr[1];\n                } else if(fontIndex >= 2.0 && fontIndex < 3.0){\n                    return sdfParamsArr[2];\n                } else if(fontIndex >= 3.0 && fontIndex < 4.0){\n                    return sdfParamsArr[3];\n                } else if(fontIndex >= 4.0 && fontIndex < 5.0){\n                    return sdfParamsArr[4];\n                } else if(fontIndex >= 5.0 && fontIndex < 6.0){\n                    return sdfParamsArr[5];\n                } else if(fontIndex >= 6.0 && fontIndex < 7.0){\n                    return sdfParamsArr[6];\n                } else if(fontIndex >= 7.0 && fontIndex < 8.0){\n                    return sdfParamsArr[7];\n                } else if(fontIndex >= 8.0 && fontIndex < 9.0){\n                    return sdfParamsArr[8];\n                } else if(fontIndex >= 9.0 && fontIndex < 10.0){\n                    return sdfParamsArr[9];\n                } else if(fontIndex >= 10.0 && fontIndex < 11.0){\n                    return sdfParamsArr[10];\n                }\n            }\n                    \n            void main () {\n\n                fontIndex = v_fontIndex + 0.1;\n                \n                if(v_fontIndex < 0.0){\n                    return;\n                }\n                \n                vec4 sdfParams = getSDFParams();\n                float sd = getDistance();             \n                vec2 dxdy = fwidth(v_uv) * sdfParams.xy;\n                float dist = sd + min(0.001, 0.5 - 1.0 / sdfParams.w) - 0.5;\n                float opacity = clamp(dist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);\n\n                if(isOutlinePass == 0){                             \n                    //gl_FragColor = vec4(v_rgba.rgb, opacity * v_rgba.a);\n                } else {                \n                    float strokeDist = sd + min(v_outline, 0.5 - 1.0 / sdfParams.w) - 0.5;\n                    float strokeAlpha = v_rgba.a * clamp(strokeDist * sdfParams.w / length(dxdy) + 0.5, 0.0, 1.0);                    \n                    if(strokeAlpha < 0.1){\n                        discard;\n                    }\n                    //gl_FragColor = v_rgba * strokeAlpha * (0.5 - opacity) * 2.0;\n                }\n            }`\n    });\n}\nexport function labelPicking() {\n    return new Program(\"labelPicking\", {\n        uniforms: {\n            viewport: \"vec2\",\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            planetRadius: \"float\",\n            scaleByDistance: \"vec3\",\n            opacity: \"float\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            a_gliphParam: \"vec4\",\n            a_vertices: \"vec2\",\n            a_texCoord: \"vec4\",\n            a_positionsHigh: \"vec3\",\n            a_positionsLow: \"vec3\",\n            a_offset: \"vec3\",\n            a_size: \"float\",\n            a_rotation: \"float\",\n            a_rgba: \"vec4\"\n        },\n        vertexShader: `\n            \n            ${DEFINE}\n            \n            attribute vec4 a_gliphParam;\n            attribute vec2 a_vertices;\n            attribute vec4 a_texCoord;\n            attribute vec3 a_positionsHigh;\n            attribute vec3 a_positionsLow;\n            attribute vec3 a_offset;\n            attribute float a_size;\n            attribute float a_rotation;\n            attribute vec4 a_rgba;\n\n            varying vec4 v_rgba;\n\n            uniform vec2 viewport;\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float planetRadius;\n            uniform vec3 scaleByDistance;\n            uniform float opacity;\n            uniform float depthOffset;\n\n            const vec3 ZERO3 = vec3(0.0);\n\n            ${PROJECT}\n\n            ${ROTATE2D}\n\n            void main() {\n                vec3 a_positions = a_positionsHigh + a_positionsLow;\n                vec3 cameraPos = eyePositionHigh + eyePositionLow;\n                v_rgba = a_rgba;\n                \n                if(a_texCoord.w == EMPTY) {\n                    v_rgba.a = 0.0;\n                    gl_Position = vec4(0.0);\n                    return;\n                }\n\n                vec3 look = a_positions - cameraPos;\n                float lookDist = length(look);\n                if(opacity * step(lookDist, sqrt(dot(cameraPos,cameraPos) - planetRadius) + sqrt(dot(a_positions,a_positions) - planetRadius)) == 0.0){\n                    return;\n                }\n\n                float scd = (1.0 - smoothstep(scaleByDistance[0], scaleByDistance[1], lookDist)) * (1.0 - step(scaleByDistance[2], lookDist));\n\n                v_rgba.a *= opacity;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                vec3 highDiff = a_positionsHigh - eyePositionHigh;\n                vec3 lowDiff = a_positionsLow - eyePositionLow;\n                vec4 posRTE = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                vec4 projPos = projectionMatrix * posRTE;\n                \n                float camSlope = dot(vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]), normalize(cameraPos));                \n                if(camSlope > 0.5) {\n                    float dist = dot(look, normalize(cameraPos));\n                    projPos.z += dist * 0.02;                  \n                }else{\n                    projPos.z += -(abs(projPos.z)) * 0.002;                 \n                }\n                        \n                projPos.z += depthOffset + a_offset.z;\n                \n                vec2 screenPos = project(projPos);\n                \n                vec2 vert = a_vertices;                \n                vec4 gp = a_gliphParam;                                \n                if(a_texCoord.w == RTL){\n                    vert.x = step(vert.x * 0.5 + 1.0, 1.0);\n                    gp.x = -a_gliphParam.x;\n                    gp.z = -(a_gliphParam.z + a_texCoord.z);\n                }else{\n                    gp.z = a_gliphParam.z + a_texCoord.z;\n                }\n                                \n                vec2 v = screenPos + rotate2d(a_rotation) * ((vert * gp.xy + gp.zw) * a_size * scd + a_offset.xy);\n                                \n                gl_Position = vec4((2.0 * v / viewport - 1.0) * projPos.w, projPos.z, projPos.w);\n            }`,\n        fragmentShader: `precision highp float;\n\n            varying vec4 v_rgba;\n\n            varying vec3 v_pickingColor;\n\n            void main () {\n\n                vec4 color = v_rgba;\n                if (color.a < 0.05) {\n                    return;\n                }\n\n                gl_FragColor = vec4(v_rgba.rgb, v_rgba.a);\n            }`\n    });\n}\n//# sourceMappingURL=label.js.map","import * as shaders from \"../shaders/label\";\nimport { ALIGN } from \"./Label\";\nimport { BaseBillboardHandler } from \"./BaseBillboardHandler\";\nimport { concatTypedArrays, spliceTypedArray } from \"../utils/shared\";\nimport { LOCK_FREE } from \"./LabelWorker\";\nconst PICKINGCOLOR_BUFFER = 0;\nconst POSITION_BUFFER = 1;\nconst SIZE_BUFFER = 2;\nconst OFFSET_BUFFER = 3;\nconst RGBA_BUFFER = 4;\nconst ROTATION_BUFFER = 5;\nconst TEXCOORD_BUFFER = 6;\nconst VERTEX_BUFFER = 7;\nconst FONTINDEX_BUFFER = 8;\nconst OUTLINE_BUFFER = 9;\nconst OUTLINECOLOR_BUFFER = 10;\nconst EMPTY = -1.0;\nconst RTL = 1.0;\nclass LabelHandler extends BaseBillboardHandler {\n    constructor(entityCollection, maxLetters = 21) {\n        super(entityCollection);\n        this._billboards = [];\n        this._gliphParamBuffer = null;\n        this._fontIndexBuffer = null;\n        this._outlineBuffer = null;\n        this._outlineColorBuffer = null;\n        this._gliphParamArr = new Float32Array([]);\n        this._fontIndexArr = new Float32Array([]);\n        this._outlineArr = new Float32Array([]);\n        this._outlineColorArr = new Float32Array([]);\n        this._buffersUpdateCallbacks[FONTINDEX_BUFFER] = this.createFontIndexBuffer;\n        this._buffersUpdateCallbacks[OUTLINE_BUFFER] = this.createOutlineBuffer;\n        this._buffersUpdateCallbacks[OUTLINECOLOR_BUFFER] = this.createOutlineColorBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n        this._maxLetters = maxLetters;\n    }\n    initProgram() {\n        if (this._renderer && this._renderer.handler && this._renderer.handler.gl) {\n            if (!this._renderer.handler.programs.label) {\n                if (this._renderer.handler.gl.type === \"webgl2\") {\n                    this._renderer.handler.addProgram(shaders.label_webgl2());\n                }\n                else {\n                    this._renderer.handler.addProgram(shaders.label_screen());\n                }\n            }\n            if (!this._renderer.handler.programs.labelPicking) {\n                this._renderer.handler.addProgram(shaders.labelPicking());\n            }\n        }\n    }\n    get labels() {\n        return this._billboards;\n    }\n    add(label) {\n        if (!label._handler) {\n            label._handler = this;\n            this.assignFontAtlas(label);\n            this.refresh();\n        }\n    }\n    updateFonts() {\n        let l = [...this._billboards];\n        this._billboards = [];\n        for (let i = 0; i < l.length; i++) {\n            this.assignFontAtlas(l[i]);\n        }\n    }\n    _addLabelToArrays(label) {\n        this._renderer && this._renderer.labelWorker.make({ handler: this, label: label });\n    }\n    assignFontAtlas(label) {\n        if (this._entityCollection && this._renderer) {\n            label.assignFontAtlas(this._renderer.fontAtlas);\n            this._addLabelToArrays(label);\n        }\n        else {\n            this._billboards.push(label);\n        }\n    }\n    workerCallback(data, label) {\n        if (label._lockId !== LOCK_FREE && label._handler && this.isEqual(label._handler)) {\n            label._isReady = true;\n            label._lockId = LOCK_FREE;\n            label._handlerIndex = this._billboards.length;\n            this._billboards.push(label);\n            this._vertexArr = concatTypedArrays(this._vertexArr, data.vertexArr);\n            this._texCoordArr = concatTypedArrays(this._texCoordArr, data.texCoordArr);\n            this._gliphParamArr = concatTypedArrays(this._gliphParamArr, data.gliphParamArr);\n            this._positionHighArr = concatTypedArrays(this._positionHighArr, data.positionHighArr);\n            this._positionLowArr = concatTypedArrays(this._positionLowArr, data.positionLowArr);\n            this._sizeArr = concatTypedArrays(this._sizeArr, data.sizeArr);\n            this._offsetArr = concatTypedArrays(this._offsetArr, data.offsetArr);\n            this._rgbaArr = concatTypedArrays(this._rgbaArr, data.rgbaArr);\n            this._rotationArr = concatTypedArrays(this._rotationArr, data.rotationArr);\n            this._fontIndexArr = concatTypedArrays(this._fontIndexArr, data.fontIndexArr);\n            this._outlineArr = concatTypedArrays(this._outlineArr, data.outlineArr);\n            this._outlineColorArr = concatTypedArrays(this._outlineColorArr, data.outlineColorArr);\n            this._pickingColorArr = concatTypedArrays(this._pickingColorArr, data.pickingColorArr);\n            label.update();\n            this.refresh();\n        }\n    }\n    clear() {\n        // @ts-ignore\n        this._texCoordArr = null;\n        // @ts-ignore\n        this._gliphParamArr = null;\n        // @ts-ignore\n        this._vertexArr = null;\n        // @ts-ignore\n        this._positionHighArr = null;\n        // @ts-ignore\n        this._positionLowArr = null;\n        // @ts-ignore\n        this._sizeArr = null;\n        // @ts-ignore\n        this._offsetArr = null;\n        // @ts-ignore\n        this._rgbaArr = null;\n        // @ts-ignore\n        this._rotationArr = null;\n        // @ts-ignore\n        this._fontIndexArr = null;\n        // @ts-ignore\n        this._outlineArr = null;\n        // @ts-ignore\n        this._outlineColorArr = null;\n        this._texCoordArr = new Float32Array([]);\n        this._gliphParamArr = new Float32Array([]);\n        this._vertexArr = new Float32Array([]);\n        this._positionHighArr = new Float32Array([]);\n        this._positionLowArr = new Float32Array([]);\n        this._sizeArr = new Float32Array([]);\n        this._offsetArr = new Float32Array([]);\n        this._rgbaArr = new Float32Array([]);\n        this._rotationArr = new Float32Array([]);\n        this._fontIndexArr = new Float32Array([]);\n        this._outlineArr = new Float32Array([]);\n        this._outlineColorArr = new Float32Array([]);\n        this._removeBillboards();\n        this._deleteBuffers();\n        this.refresh();\n    }\n    _deleteBuffers() {\n        if (this._renderer) {\n            let gl = this._renderer.handler.gl;\n            gl.deleteBuffer(this._gliphParamBuffer);\n            gl.deleteBuffer(this._sizeBuffer);\n            gl.deleteBuffer(this._fontIndexBuffer);\n            gl.deleteBuffer(this._texCoordBuffer);\n            gl.deleteBuffer(this._outlineBuffer);\n            gl.deleteBuffer(this._outlineColorBuffer);\n            gl.deleteBuffer(this._positionHighBuffer);\n            gl.deleteBuffer(this._positionLowBuffer);\n            gl.deleteBuffer(this._sizeBuffer);\n            gl.deleteBuffer(this._offsetBuffer);\n            gl.deleteBuffer(this._rgbaBuffer);\n            gl.deleteBuffer(this._rotationBuffer);\n            gl.deleteBuffer(this._vertexBuffer);\n            gl.deleteBuffer(this._texCoordBuffer);\n            gl.deleteBuffer(this._pickingColorBuffer);\n            this._gliphParamBuffer = null;\n            this._sizeBuffer = null;\n            this._fontIndexBuffer = null;\n            this._texCoordBuffer = null;\n            this._outlineBuffer = null;\n            this._outlineColorBuffer = null;\n            this._positionHighBuffer = null;\n            this._positionLowBuffer = null;\n            this._sizeBuffer = null;\n            this._offsetBuffer = null;\n            this._rgbaBuffer = null;\n            this._rotationBuffer = null;\n            this._vertexBuffer = null;\n            this._texCoordBuffer = null;\n            this._pickingColorBuffer = null;\n        }\n    }\n    _displayPASS() {\n        let r = this._renderer;\n        let h = r.handler;\n        h.programs.label.activate();\n        let sh = h.programs.label._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        let gl = h.gl, ec = this._entityCollection;\n        gl.disable(gl.CULL_FACE);\n        gl.uniform1iv(shu.fontTextureArr, r.fontAtlas.samplerArr);\n        gl.uniform4fv(shu.sdfParamsArr, r.fontAtlas.sdfParamsArr);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniform3fv(shu.scaleByDistance, ec.scaleByDistance);\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\n        gl.uniform1f(shu.planetRadius, ec.renderNode._planetRadius2 || 0);\n        gl.uniform2fv(shu.viewport, [h.canvas.clientWidth, h.canvas.clientHeight]);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer);\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gliphParamBuffer);\n        gl.vertexAttribPointer(sha.a_gliphParam, this._gliphParamBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer);\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer);\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer);\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer);\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer);\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._fontIndexBuffer);\n        gl.vertexAttribPointer(sha.a_fontIndex, this._fontIndexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        //\n        // outline PASS\n        gl.uniform1i(shu.isOutlinePass, 1);\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._outlineColorBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._outlineColorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._outlineBuffer);\n        gl.vertexAttribPointer(sha.a_outline, this._outlineBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        //\n        // no outline PASS\n        gl.depthFunc(gl.EQUAL);\n        gl.uniform1i(shu.isOutlinePass, 0);\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        gl.depthFunc(gl.LESS);\n        gl.enable(gl.CULL_FACE);\n    }\n    _pickingPASS() {\n        let r = this._renderer;\n        let h = r.handler;\n        h.programs.labelPicking.activate();\n        let sh = h.programs.labelPicking._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        let gl = h.gl, ec = this._entityCollection;\n        let rn = ec.renderNode;\n        gl.disable(gl.CULL_FACE);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniform3fv(shu.scaleByDistance, ec.scaleByDistance);\n        gl.uniform1f(shu.opacity, ec._fadingOpacity);\n        gl.uniform1f(shu.planetRadius, rn._planetRadius2 || 0);\n        gl.uniform2fv(shu.viewport, [h.canvas.clientWidth, h.canvas.clientHeight]);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._texCoordBuffer);\n        gl.vertexAttribPointer(sha.a_texCoord, this._texCoordBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gliphParamBuffer);\n        gl.vertexAttribPointer(sha.a_gliphParam, this._gliphParamBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionHighBuffer);\n        gl.vertexAttribPointer(sha.a_positionsHigh, this._positionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._positionLowBuffer);\n        gl.vertexAttribPointer(sha.a_positionsLow, this._positionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._sizeBuffer);\n        gl.vertexAttribPointer(sha.a_size, this._sizeBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rotationBuffer);\n        gl.vertexAttribPointer(sha.a_rotation, this._rotationBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._offsetBuffer);\n        gl.vertexAttribPointer(sha.a_offset, this._offsetBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._pickingColorBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._pickingColorBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.uniform1f(shu.depthOffset, ec.polygonOffsetUnits);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        gl.enable(gl.CULL_FACE);\n    }\n    _removeBillboard(label) {\n        let li = label._handlerIndex;\n        this._billboards.splice(li, 1);\n        let ml = 24 * this._maxLetters;\n        let i = li * ml;\n        this._rgbaArr = spliceTypedArray(this._rgbaArr, i, ml);\n        this._outlineColorArr = spliceTypedArray(this._outlineColorArr, i, ml);\n        this._texCoordArr = spliceTypedArray(this._texCoordArr, i, ml);\n        this._gliphParamArr = spliceTypedArray(this._gliphParamArr, i, ml);\n        ml = 18 * this._maxLetters;\n        i = li * ml;\n        this._positionHighArr = spliceTypedArray(this._positionHighArr, i, ml);\n        this._positionLowArr = spliceTypedArray(this._positionLowArr, i, ml);\n        this._offsetArr = spliceTypedArray(this._offsetArr, i, ml);\n        this._pickingColorArr = spliceTypedArray(this._pickingColorArr, i, ml);\n        ml = 12 * this._maxLetters;\n        i = li * ml;\n        this._vertexArr = spliceTypedArray(this._vertexArr, i, ml);\n        ml = 6 * this._maxLetters;\n        i = li * ml;\n        this._sizeArr = spliceTypedArray(this._sizeArr, i, ml);\n        this._rotationArr = spliceTypedArray(this._rotationArr, i, ml);\n        this._fontIndexArr = spliceTypedArray(this._fontIndexArr, i, ml);\n        this._outlineArr = spliceTypedArray(this._outlineArr, i, ml);\n        this.reindexBillboardsArray(li);\n        this.refresh();\n        label._handlerIndex = -1;\n        label._handler = null;\n        label._isReady = false;\n    }\n    setText(index, text, fontIndex, align, isRTL = false) {\n        text = text.normalize('NFKC');\n        let fa = this._renderer.fontAtlas.atlasesArr[fontIndex];\n        if (!fa)\n            return;\n        let i = index * 24 * this._maxLetters;\n        let a = this._texCoordArr, g = this._gliphParamArr;\n        let c = 0;\n        let len = Math.min(this._maxLetters, text.length);\n        let _rtl_ = 0.0;\n        if (isRTL) {\n            _rtl_ = RTL;\n        }\n        let offset = 0.0;\n        let kern = fa.kernings;\n        for (c = 0; c < len; c++) {\n            let j = i + c * 24;\n            let char = text[c];\n            let n = fa.get(char.charCodeAt(0)) || fa.get(\" \".charCodeAt(0));\n            if (!n)\n                continue;\n            let tc = n.texCoords;\n            let m = n.metrics;\n            a[j] = tc[0];\n            a[j + 1] = tc[1];\n            a[j + 2] = offset;\n            a[j + 3] = _rtl_;\n            a[j + 4] = tc[2];\n            a[j + 5] = tc[3];\n            a[j + 6] = offset;\n            a[j + 7] = _rtl_;\n            a[j + 8] = tc[4];\n            a[j + 9] = tc[5];\n            a[j + 10] = offset;\n            a[j + 11] = _rtl_;\n            a[j + 12] = tc[6];\n            a[j + 13] = tc[7];\n            a[j + 14] = offset;\n            a[j + 15] = _rtl_;\n            a[j + 16] = tc[8];\n            a[j + 17] = tc[9];\n            a[j + 18] = offset;\n            a[j + 19] = _rtl_;\n            a[j + 20] = tc[10];\n            a[j + 21] = tc[11];\n            a[j + 22] = offset;\n            a[j + 23] = _rtl_;\n            //\n            // Gliph\n            //\n            g[j] = m.nWidth;\n            g[j + 1] = m.nHeight;\n            g[j + 2] = m.nXOffset;\n            g[j + 3] = m.nYOffset;\n            g[j + 4] = m.nWidth;\n            g[j + 5] = m.nHeight;\n            g[j + 6] = m.nXOffset;\n            g[j + 7] = m.nYOffset;\n            g[j + 8] = m.nWidth;\n            g[j + 9] = m.nHeight;\n            g[j + 10] = m.nXOffset;\n            g[j + 11] = m.nYOffset;\n            g[j + 12] = m.nWidth;\n            g[j + 13] = m.nHeight;\n            g[j + 14] = m.nXOffset;\n            g[j + 15] = m.nYOffset;\n            g[j + 16] = m.nWidth;\n            g[j + 17] = m.nHeight;\n            g[j + 18] = m.nXOffset;\n            g[j + 19] = m.nYOffset;\n            g[j + 20] = m.nWidth;\n            g[j + 21] = m.nHeight;\n            g[j + 22] = m.nXOffset;\n            g[j + 23] = m.nYOffset;\n            let k = kern[char.charCodeAt(0)];\n            if (k && text[c + 1]) {\n                let kk = k[text[c + 1].charCodeAt(0)];\n                if (kk) {\n                    offset += m.nAdvance + kk;\n                }\n                else {\n                    offset += m.nAdvance;\n                }\n            }\n            else {\n                offset += m.nAdvance;\n            }\n        }\n        // 49/512 - font atlas left border letter offset\n        if (align === ALIGN.CENTER) {\n            offset *= -0.5;\n            for (c = 0; c < len; c++) {\n                let j = i + c * 24;\n                a[j + 2] += offset;\n                a[j + 6] += offset;\n                a[j + 10] += offset;\n                a[j + 14] += offset;\n                a[j + 18] += offset;\n                a[j + 22] += offset;\n            }\n        }\n        for (; c < this._maxLetters; c++) {\n            let j = i + c * 24;\n            a[j + 3] = EMPTY;\n            a[j + 7] = EMPTY;\n            a[j + 11] = EMPTY;\n            a[j + 15] = EMPTY;\n            a[j + 19] = EMPTY;\n            a[j + 23] = EMPTY;\n        }\n        this._changedBuffers[TEXCOORD_BUFFER] = true;\n    }\n    setPositionArr(index, positionHigh, positionLow) {\n        let i = index * 18 * this._maxLetters;\n        let a = this._positionHighArr, x = positionHigh.x, y = positionHigh.y, z = positionHigh.z, b = this._positionLowArr, xl = positionLow.x, yl = positionLow.y, zl = positionLow.z;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 18;\n            a[j] = x;\n            a[j + 1] = y;\n            a[j + 2] = z;\n            a[j + 3] = x;\n            a[j + 4] = y;\n            a[j + 5] = z;\n            a[j + 6] = x;\n            a[j + 7] = y;\n            a[j + 8] = z;\n            a[j + 9] = x;\n            a[j + 10] = y;\n            a[j + 11] = z;\n            a[j + 12] = x;\n            a[j + 13] = y;\n            a[j + 14] = z;\n            a[j + 15] = x;\n            a[j + 16] = y;\n            a[j + 17] = z;\n            // low\n            b[j] = xl;\n            b[j + 1] = yl;\n            b[j + 2] = zl;\n            b[j + 3] = xl;\n            b[j + 4] = yl;\n            b[j + 5] = zl;\n            b[j + 6] = xl;\n            b[j + 7] = yl;\n            b[j + 8] = zl;\n            b[j + 9] = xl;\n            b[j + 10] = yl;\n            b[j + 11] = zl;\n            b[j + 12] = xl;\n            b[j + 13] = yl;\n            b[j + 14] = zl;\n            b[j + 15] = xl;\n            b[j + 16] = yl;\n            b[j + 17] = zl;\n        }\n        this._changedBuffers[POSITION_BUFFER] = true;\n    }\n    setPickingColorArr(index, color) {\n        let i = index * 18 * this._maxLetters;\n        let a = this._pickingColorArr, x = color.x / 255, y = color.y / 255, z = color.z / 255;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 18;\n            a[j] = x;\n            a[j + 1] = y;\n            a[j + 2] = z;\n            a[j + 3] = x;\n            a[j + 4] = y;\n            a[j + 5] = z;\n            a[j + 6] = x;\n            a[j + 7] = y;\n            a[j + 8] = z;\n            a[j + 9] = x;\n            a[j + 10] = y;\n            a[j + 11] = z;\n            a[j + 12] = x;\n            a[j + 13] = y;\n            a[j + 14] = z;\n            a[j + 15] = x;\n            a[j + 16] = y;\n            a[j + 17] = z;\n        }\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\n    }\n    setSizeArr(index, size) {\n        let i = index * 6 * this._maxLetters;\n        let a = this._sizeArr;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 6;\n            a[j] = size;\n            a[j + 1] = size;\n            a[j + 2] = size;\n            a[j + 3] = size;\n            a[j + 4] = size;\n            a[j + 5] = size;\n        }\n        this._changedBuffers[SIZE_BUFFER] = true;\n    }\n    setOffsetArr(index, offset) {\n        let i = index * 18 * this._maxLetters;\n        let a = this._offsetArr, x = offset.x, y = offset.y, z = offset.z;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 18;\n            a[j] = x;\n            a[j + 1] = y;\n            a[j + 2] = z;\n            a[j + 3] = x;\n            a[j + 4] = y;\n            a[j + 5] = z;\n            a[j + 6] = x;\n            a[j + 7] = y;\n            a[j + 8] = z;\n            a[j + 9] = x;\n            a[j + 10] = y;\n            a[j + 11] = z;\n            a[j + 12] = x;\n            a[j + 13] = y;\n            a[j + 14] = z;\n            a[j + 15] = x;\n            a[j + 16] = y;\n            a[j + 17] = z;\n        }\n        this._changedBuffers[OFFSET_BUFFER] = true;\n    }\n    setRgbaArr(index, rgba) {\n        let i = index * 24 * this._maxLetters;\n        let a = this._rgbaArr, x = rgba.x, y = rgba.y, z = rgba.z, w = rgba.w;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 24;\n            a[j] = x;\n            a[j + 1] = y;\n            a[j + 2] = z;\n            a[j + 3] = w;\n            a[j + 4] = x;\n            a[j + 5] = y;\n            a[j + 6] = z;\n            a[j + 7] = w;\n            a[j + 8] = x;\n            a[j + 9] = y;\n            a[j + 10] = z;\n            a[j + 11] = w;\n            a[j + 12] = x;\n            a[j + 13] = y;\n            a[j + 14] = z;\n            a[j + 15] = w;\n            a[j + 16] = x;\n            a[j + 17] = y;\n            a[j + 18] = z;\n            a[j + 19] = w;\n            a[j + 20] = x;\n            a[j + 21] = y;\n            a[j + 22] = z;\n            a[j + 23] = w;\n        }\n        this._changedBuffers[RGBA_BUFFER] = true;\n    }\n    setOutlineColorArr(index, rgba) {\n        let i = index * 24 * this._maxLetters;\n        let a = this._outlineColorArr, x = rgba.x, y = rgba.y, z = rgba.z, w = rgba.w;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 24;\n            a[j] = x;\n            a[j + 1] = y;\n            a[j + 2] = z;\n            a[j + 3] = w;\n            a[j + 4] = x;\n            a[j + 5] = y;\n            a[j + 6] = z;\n            a[j + 7] = w;\n            a[j + 8] = x;\n            a[j + 9] = y;\n            a[j + 10] = z;\n            a[j + 11] = w;\n            a[j + 12] = x;\n            a[j + 13] = y;\n            a[j + 14] = z;\n            a[j + 15] = w;\n            a[j + 16] = x;\n            a[j + 17] = y;\n            a[j + 18] = z;\n            a[j + 19] = w;\n            a[j + 20] = x;\n            a[j + 21] = y;\n            a[j + 22] = z;\n            a[j + 23] = w;\n        }\n        this._changedBuffers[OUTLINECOLOR_BUFFER] = true;\n    }\n    setOutlineArr(index, outline) {\n        let i = index * 6 * this._maxLetters;\n        let a = this._outlineArr;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 6;\n            a[j] = outline;\n            a[j + 1] = outline;\n            a[j + 2] = outline;\n            a[j + 3] = outline;\n            a[j + 4] = outline;\n            a[j + 5] = outline;\n        }\n        this._changedBuffers[OUTLINE_BUFFER] = true;\n    }\n    setRotationArr(index, rotation) {\n        let i = index * 6 * this._maxLetters;\n        let a = this._rotationArr;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 6;\n            a[j] = rotation;\n            a[j + 1] = rotation;\n            a[j + 2] = rotation;\n            a[j + 3] = rotation;\n            a[j + 4] = rotation;\n            a[j + 5] = rotation;\n        }\n        this._changedBuffers[ROTATION_BUFFER] = true;\n    }\n    setVisibility(index, visibility) {\n        let vArr;\n        if (visibility) {\n            vArr = [0, 0, 0, -1, 1, -1, 1, -1, 1, 0, 0, 0];\n        }\n        else {\n            vArr = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];\n        }\n        this.setVertexArr(index, vArr);\n    }\n    setVertexArr(index, vertexArr) {\n        let i = index * 12 * this._maxLetters;\n        let a = this._vertexArr;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 12;\n            a[j] = vertexArr[0];\n            a[j + 1] = vertexArr[1];\n            a[j + 2] = vertexArr[2];\n            a[j + 3] = vertexArr[3];\n            a[j + 4] = vertexArr[4];\n            a[j + 5] = vertexArr[5];\n            a[j + 6] = vertexArr[6];\n            a[j + 7] = vertexArr[7];\n            a[j + 8] = vertexArr[8];\n            a[j + 9] = vertexArr[9];\n            a[j + 10] = vertexArr[10];\n            a[j + 11] = vertexArr[11];\n        }\n        this._changedBuffers[VERTEX_BUFFER] = true;\n    }\n    setFontIndexArr(index, fontIndex) {\n        let i = index * 6 * this._maxLetters;\n        let a = this._fontIndexArr;\n        for (let q = 0; q < this._maxLetters; q++) {\n            let j = i + q * 6;\n            a[j] = fontIndex;\n            a[j + 1] = fontIndex;\n            a[j + 2] = fontIndex;\n            a[j + 3] = fontIndex;\n            a[j + 4] = fontIndex;\n            a[j + 5] = fontIndex;\n        }\n        this._changedBuffers[FONTINDEX_BUFFER] = true;\n    }\n    createSizeBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._sizeBuffer);\n        this._sizeBuffer = h.createArrayBuffer(this._sizeArr, 1, this._sizeArr.length);\n    }\n    createFontIndexBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._fontIndexBuffer);\n        this._fontIndexBuffer = h.createArrayBuffer(this._fontIndexArr, 1, this._fontIndexArr.length);\n    }\n    createTexCoordBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._texCoordBuffer);\n        this._texCoordBuffer = h.createArrayBuffer(this._texCoordArr, 4, this._texCoordArr.length / 4);\n        h.gl.deleteBuffer(this._gliphParamBuffer);\n        this._gliphParamBuffer = h.createArrayBuffer(this._gliphParamArr, 4, this._gliphParamArr.length / 4);\n    }\n    createOutlineBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._outlineBuffer);\n        this._outlineBuffer = h.createArrayBuffer(this._outlineArr, 1, this._outlineArr.length);\n    }\n    createOutlineColorBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._outlineColorBuffer);\n        this._outlineColorBuffer = h.createArrayBuffer(this._outlineColorArr, 4, this._outlineColorArr.length / 4);\n    }\n    setMaxLetters(c) {\n        this._maxLetters = c;\n        // TODO: ...\n    }\n}\nexport { LabelHandler };\n//# sourceMappingURL=LabelHandler.js.map","import * as shaders from \"../shaders/pointCloud\";\nclass PointCloudHandler {\n    constructor(entityCollection) {\n        /**\n         * Picking rendering option.\n         * @public\n         * @type {boolean}\n         */\n        this.pickingEnabled = true;\n        this.__id = PointCloudHandler.__counter__++;\n        this.pickingEnabled = true;\n        this._entityCollection = entityCollection;\n        this._renderer = null;\n        this._pointClouds = [];\n    }\n    _initProgram() {\n        if (this._renderer && this._renderer.handler) {\n            if (!this._renderer.handler.programs.pointCloud) {\n                this._renderer.handler.addProgram(shaders.pointCloud());\n            }\n        }\n    }\n    setRenderNode(renderNode) {\n        this._renderer = renderNode.renderer;\n        this._initProgram();\n        for (let i = 0; i < this._pointClouds.length; i++) {\n            this._pointClouds[i].setRenderNode(renderNode);\n        }\n    }\n    add(pointCloud) {\n        if (pointCloud._handlerIndex === -1) {\n            pointCloud._handler = this;\n            pointCloud._handlerIndex = this._pointClouds.length;\n            this._pointClouds.push(pointCloud);\n            this._entityCollection &&\n                this._entityCollection.renderNode &&\n                pointCloud.setRenderNode(this._entityCollection.renderNode);\n        }\n    }\n    remove(pointCloud) {\n        let index = pointCloud._handlerIndex;\n        if (index !== -1) {\n            pointCloud._deleteBuffers();\n            pointCloud._handlerIndex = -1;\n            pointCloud._handler = null;\n            this._pointClouds.splice(index, 1);\n            this._reindexPointCloudArray(index);\n        }\n    }\n    _reindexPointCloudArray(startIndex) {\n        let pc = this._pointClouds;\n        for (let i = startIndex; i < pc.length; i++) {\n            pc[i]._handlerIndex = i;\n        }\n    }\n    draw() {\n        let i = this._pointClouds.length;\n        while (i--) {\n            this._pointClouds[i].draw();\n        }\n    }\n    drawPicking() {\n        if (this.pickingEnabled) {\n            let i = this._pointClouds.length;\n            while (i--) {\n                this._pointClouds[i].drawPicking();\n            }\n        }\n    }\n    clear() {\n        let i = this._pointClouds.length;\n        while (i--) {\n            this._pointClouds[i]._deleteBuffers();\n            this._pointClouds[i]._handler = null;\n            this._pointClouds[i]._handlerIndex = -1;\n        }\n        this._pointClouds.length = 0;\n        this._pointClouds = [];\n    }\n}\nPointCloudHandler.__counter__ = 0;\nexport { PointCloudHandler };\n//# sourceMappingURL=PointCloudHandler.js.map","import { Program } from '../webgl/Program';\n//Picking is the same\nexport function pointCloud() {\n    return new Program(\"pointCloud\", {\n        uniforms: {\n            projectionViewMatrix: \"mat4\",\n            opacity: \"float\",\n            pointSize: \"float\"\n        },\n        attributes: {\n            coordinates: \"vec3\",\n            colors: \"vec3\"\n        },\n        vertexShader: `attribute vec3 coordinates;\n            attribute vec4 colors;\n            uniform mat4 projectionViewMatrix;\n            uniform float opacity;\n            uniform float pointSize;\n            varying vec4 color;\n            void main() {\n                color = colors;\n                color.a *= opacity;\n                gl_Position = projectionViewMatrix * vec4(coordinates, 1.0);\n                gl_PointSize = pointSize;\n            }`,\n        fragmentShader: `precision highp float;\n            varying vec4 color;\n            void main(void) {\n                gl_FragColor = color;\n            }`\n    });\n}\n//# sourceMappingURL=pointCloud.js.map","import * as shaders from '../shaders/polyline';\nclass PolylineHandler {\n    constructor(entityCollection) {\n        this.__id = PolylineHandler.__counter__++;\n        this._entityCollection = entityCollection;\n        this._renderer = null;\n        this._polylines = [];\n        this.pickingEnabled = true;\n    }\n    _initProgram() {\n        if (this._renderer && this._renderer.handler) {\n            if (!this._renderer.handler.programs.polyline_screen) {\n                this._renderer.handler.addProgram(shaders.polyline_screen());\n            }\n            if (!this._renderer.handler.programs.polyline_picking) {\n                this._renderer.handler.addProgram(shaders.polyline_picking());\n            }\n        }\n    }\n    setRenderNode(renderNode) {\n        this._renderer = renderNode.renderer;\n        this._initProgram();\n        for (let i = 0; i < this._polylines.length; i++) {\n            this._polylines[i].setRenderNode(renderNode);\n        }\n    }\n    add(polyline) {\n        if (polyline._handlerIndex === -1) {\n            polyline._handler = this;\n            polyline._handlerIndex = this._polylines.length;\n            this._polylines.push(polyline);\n            this._entityCollection && this._entityCollection.renderNode &&\n                polyline.setRenderNode(this._entityCollection.renderNode);\n        }\n    }\n    remove(polyline) {\n        let index = polyline._handlerIndex;\n        if (index !== -1) {\n            polyline._deleteBuffers();\n            polyline._handlerIndex = -1;\n            polyline._handler = null;\n            this._polylines.splice(index, 1);\n            this.reindexPolylineArray(index);\n        }\n    }\n    reindexPolylineArray(startIndex) {\n        let ls = this._polylines;\n        for (let i = startIndex; i < ls.length; i++) {\n            ls[i]._handlerIndex = i;\n        }\n    }\n    draw() {\n        let i = this._polylines.length;\n        while (i--) {\n            this._polylines[i].draw();\n        }\n    }\n    drawPicking() {\n        if (this.pickingEnabled) {\n            let i = this._polylines.length;\n            while (i--) {\n                this._polylines[i].drawPicking();\n            }\n        }\n    }\n    clear() {\n        let i = this._polylines.length;\n        while (i--) {\n            this._polylines[i]._deleteBuffers();\n            this._polylines[i]._handler = null;\n            this._polylines[i]._handlerIndex = -1;\n        }\n        this._polylines.length = 0;\n        this._polylines = [];\n    }\n}\nPolylineHandler.__counter__ = 0;\nexport { PolylineHandler };\n//# sourceMappingURL=PolylineHandler.js.map","import { Program } from '../webgl/Program';\nexport function polyline_screen() {\n    return new Program(\"polyline_screen\", {\n        uniforms: {\n            viewport: \"vec2\",\n            proj: \"mat4\",\n            view: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            uFloatParams: \"vec2\",\n            thickness: \"float\",\n            opacity: \"float\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            prevHigh: \"vec3\",\n            currentHigh: \"vec3\",\n            nextHigh: \"vec3\",\n            prevLow: \"vec3\",\n            currentLow: \"vec3\",\n            nextLow: \"vec3\",\n            order: \"float\",\n            color: \"vec4\"\n        },\n        vertexShader: `precision highp float;\n\n                attribute vec3 prevHigh;\n                attribute vec3 currentHigh;\n                attribute vec3 nextHigh;\n\n                attribute vec3 prevLow;\n                attribute vec3 currentLow;\n                attribute vec3 nextLow;\n\n                attribute float order;\n\n                attribute vec4 color;\n\n                uniform float thickness;\n                uniform mat4 proj;\n                uniform mat4 view;\n                uniform vec2 viewport;\n                uniform vec3 eyePositionHigh;\n                uniform vec3 eyePositionLow;\n                uniform float opacity;\n                uniform float depthOffset;\n\n                varying vec4 vColor;\n                varying vec3 vPos;\n                varying vec3 uCamPos;\n\n                const float NEAR = -1.0;\n\n                vec2 getIntersection(vec2 start1, vec2 end1, vec2 start2, vec2 end2){\n                    vec2 dir = end2 - start2;\n                    vec2 perp = vec2(-dir.y, dir.x);\n                    float d2 = dot(perp, start2);\n                    float seg = dot(perp, start1) - d2;\n                    float prl = seg - dot(perp, end1) + d2;\n                    if(prl > -1.0 && prl < 1.0){\n                        return start1;\n                    }\n                    float u = seg / prl;\n                    return start1 + u * (end1 - start1);\n                }\n\n                vec2 project(vec4 p){\n                    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\n                }\n\n                void main(){\n\n                    uCamPos = eyePositionHigh + eyePositionLow;\n\n                    vColor = vec4(color.rgb, color.a * opacity);\n\n                    vec3 current = currentHigh + currentLow;\n\n                    vPos = current;\n\n                    mat4 viewMatrixRTE = view;\n                    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                    vec3 highDiff, lowDiff;\n\n                    highDiff = currentHigh - eyePositionHigh;\n                    lowDiff = currentLow - eyePositionLow;\n                    vec4 vCurrent = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    highDiff = prevHigh - eyePositionHigh;\n                    lowDiff = prevLow - eyePositionLow;\n                    vec4 vPrev = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    highDiff = nextHigh - eyePositionHigh;\n                    lowDiff = nextLow - eyePositionLow;\n                    vec4 vNext = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    /*Clip near plane, the point behind view plane*/\n                    if(vCurrent.z > NEAR) {\n                        if(vPrev.z < NEAR && abs(order) == 1.0){\n                            vCurrent = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\n                        } else if(vNext.z < NEAR && abs(order) == 2.0){\n                            vCurrent = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\n                        }\n                    }\n\n                    vec4 dCurrent = proj * vCurrent;\n                    vec2 _next = project(proj * vNext);\n                    vec2 _prev = project(proj * vPrev);\n                    vec2 _current = project(dCurrent);\n\n                    if(_prev == _current){\n                        if(_next == _current){\n                            _next = _current + vec2(1.0, 0.0);\n                            _prev = _current - _next;\n                        }else{\n                            _prev = _current + normalize(_current - _next);\n                        }\n                    }\n\n                    if(_next == _current){\n                        _next = _current + normalize(_current - _prev);\n                    }\n\n                    vec2 sNext = _next,\n                         sCurrent = _current,\n                         sPrev = _prev;\n\n                    vec2 dirNext = normalize(sNext - sCurrent);\n                    vec2 dirPrev = normalize(sPrev - sCurrent);\n                    float dotNP = dot(dirNext, dirPrev);\n\n                    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\n                    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\n\n                    float d = thickness * sign(order);\n\n                    vec2 m;\n                    if(dotNP >= 0.99991){\n                        m = sCurrent - normalPrev * d;\n                    }else{\n                        m = getIntersection( sCurrent + normalPrev * d, sPrev + normalPrev * d,\n                                sCurrent + normalNext * d, sNext + normalNext * d );\n\n                        if( dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0 ){\n                            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\n                            if(occw == -1.0){\n                                m = sCurrent + normalPrev * d;\n                            }else if(occw == 1.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == -2.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == 2.0){\n                                m = sCurrent + normalPrev * d;\n                            }\n                        }else if(distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))){\n                            m = sCurrent + normalNext * d;\n                        }\n                    }\n\n                    gl_Position = vec4((2.0 * m / viewport - 1.0) * dCurrent.w, dCurrent.z + depthOffset, dCurrent.w);\n                }`,\n        fragmentShader: `precision highp float;\n                uniform vec2 uFloatParams;\n                varying vec3 uCamPos;\n                varying vec4 vColor;\n                varying vec3 vPos;\n                void main() {\n                    vec3 look = vPos - uCamPos;\n                    float lookLength = length(look);\n                    float a = vColor.a * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(vPos,vPos) - uFloatParams[0]));\n                    gl_FragColor = vec4(vColor.rgb, a);\n                }`\n    });\n}\nexport function polyline_picking() {\n    return new Program(\"polyline_picking\", {\n        uniforms: {\n            viewport: \"vec2\",\n            proj: \"mat4\",\n            view: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            uFloatParams: \"vec2\",\n            color: \"vec4\",\n            thickness: \"float\",\n            depthOffset: \"float\"\n        },\n        attributes: {\n            prevHigh: \"vec3\",\n            currentHigh: \"vec3\",\n            nextHigh: \"vec3\",\n            prevLow: \"vec3\",\n            currentLow: \"vec3\",\n            nextLow: \"vec3\",\n            order: \"float\"\n        },\n        vertexShader: `precision highp float;\n                \n                attribute vec3 prevHigh;\n                attribute vec3 currentHigh;\n                attribute vec3 nextHigh;\n                \n                attribute vec3 prevLow;\n                attribute vec3 currentLow;\n                attribute vec3 nextLow;\n\n                attribute float order;\n\n                uniform float thickness;\n                uniform vec4 color;\n                uniform mat4 proj;\n                uniform mat4 view;\n                uniform vec2 viewport;\n                uniform vec3 eyePositionHigh;\n                uniform vec3 eyePositionLow;\n                uniform float depthOffset;\n\n                varying vec4 vColor;\n                varying vec3 vPos;\n                varying vec3 uCamPos;\n               \n                \n                const float NEAR = -1.0;\n                \n                vec2 getIntersection(vec2 start1, vec2 end1, vec2 start2, vec2 end2){\n                    vec2 dir = end2 - start2;\n                    vec2 perp = vec2(-dir.y, dir.x);\n                    float d2 = dot(perp, start2);\n                    float seg = dot(perp, start1) - d2;\n                    float prl = seg - dot(perp, end1) + d2;\n                    if(prl > -1.0 && prl < 1.0){\n                        return start1;\n                    }\n                    float u = seg / prl;\n                    return start1 + u * (end1 - start1);\n                }\n                \n                vec2 project(vec4 p){\n                    return (0.5 * p.xyz / p.w + 0.5).xy * viewport;\n                }\n                \n                void main(){\n\n                    uCamPos = eyePositionHigh + eyePositionLow;\n\n                    vColor = color;\n\n                    vec3 current = currentHigh + currentLow;\n\n                    vPos = current;                    \n\n                    vec3 highDiff, lowDiff;\n\n                    mat4 viewMatrixRTE = view;\n                    viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                    highDiff = currentHigh - eyePositionHigh;\n                    lowDiff = currentLow - eyePositionLow;\n                    vec4 vCurrent = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    highDiff = prevHigh - eyePositionHigh;\n                    lowDiff = prevLow - eyePositionLow;    \n                    vec4 vPrev = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    highDiff = nextHigh - eyePositionHigh;\n                    lowDiff = nextLow - eyePositionLow;    \n                    vec4 vNext = viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n\n                    /*Clip near plane*/\n                    if(vCurrent.z > NEAR) {\n                        if(vPrev.z < NEAR && abs(order) == 1.0){\n                            vCurrent = vPrev + (vCurrent - vPrev) * (NEAR - vPrev.z) / (vCurrent.z - vPrev.z);\n                        } else if(vNext.z < NEAR && abs(order) == 2.0){\n                            vCurrent = vNext + (vCurrent - vNext) * (NEAR - vNext.z) / (vCurrent.z - vNext.z);\n                        }\n                    }\n                    \n                    vec4 dCurrent = proj * vCurrent;\n                    vec2 _next = project(proj * vNext);\n                    vec2 _prev = project(proj * vPrev);\n                    vec2 _current = project(dCurrent);\n                    if(_prev == _current){\n                        if(_next == _current){\n                            _next = _current + vec2(1.0, 0.0);\n                            _prev = _current - _next;\n                        }else{\n                            _prev = _current + normalize(_current - _next);\n                        }\n                    }\n                    if(_next == _current){\n                        _next = _current + normalize(_current - _prev);\n                    }\n                    \n                    vec2 sNext = _next,\n                         sCurrent = _current,\n                         sPrev = _prev;\n\n                    vec2 dirNext = normalize(sNext - sCurrent);\n                    vec2 dirPrev = normalize(sPrev - sCurrent);\n                    float dotNP = dot(dirNext, dirPrev);\n                    \n                    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\n                    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\n                    \n                    float d = thickness * sign(order);\n                    \n                    vec2 m;\n                    if(dotNP >= 0.99991){\n                        m = sCurrent - normalPrev * d;\n                    }else{\n                        m = getIntersection( sCurrent + normalPrev * d, sPrev + normalPrev * d,\n                                sCurrent + normalNext * d, sNext + normalNext * d );\n                        \n                        if( dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0 ){\n                            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\n                            if(occw == -1.0){\n                                m = sCurrent + normalPrev * d;\n                            }else if(occw == 1.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == -2.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == 2.0){\n                                m = sCurrent + normalPrev * d;\n                            }\n                        }\n                        else if(distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))){\n                            m = sCurrent + normalNext * d;\n                        }\n                    }\n                    gl_Position = vec4((2.0 * m / viewport - 1.0) * dCurrent.w, dCurrent.z + depthOffset, dCurrent.w);\n                }`,\n        fragmentShader: `precision highp float;\n                uniform vec2 uFloatParams;\n                varying vec3 uCamPos;\n                varying vec4 vColor;\n                varying vec3 vPos;\n                void main() {\n                    vec3 look = vPos - uCamPos;\n                    float lookLength = length(look);\n                    float a = vColor.a * step(lookLength, sqrt(dot(uCamPos,uCamPos) - uFloatParams[0]) + sqrt(dot(vPos,vPos) - uFloatParams[0]));                    \n                    gl_FragColor = vec4(vColor.rgb, a);\n                }`\n    });\n}\n//# sourceMappingURL=polyline.js.map","import * as shaders from \"../shaders/ray\";\nimport { concatArrays, makeArrayTyped, spliceArray } from \"../utils/shared\";\nconst PICKINGCOLOR_BUFFER = 0;\nconst START_POSITION_BUFFER = 1;\nconst END_POSITION_BUFFER = 2;\nconst RGBA_BUFFER = 3;\nconst THICKNESS_BUFFER = 4;\nconst VERTEX_BUFFER = 5;\n/*\n * og.RayHandler\n *\n *\n */\nclass RayHandler {\n    constructor(entityCollection) {\n        this.__id = RayHandler.__counter__++;\n        /**\n         * Picking rendering option.\n         * @public\n         * @type {boolean}\n         */\n        this.pickingEnabled = true;\n        this._entityCollection = entityCollection;\n        this._renderer = null;\n        this._rays = [];\n        this._vertexBuffer = null;\n        this._startPositionHighBuffer = null;\n        this._startPositionLowBuffer = null;\n        this._endPositionHighBuffer = null;\n        this._endPositionLowBuffer = null;\n        this._thicknessBuffer = null;\n        this._rgbaBuffer = null;\n        this._pickingColorBuffer = null;\n        this._vertexArr = [];\n        this._startPositionHighArr = [];\n        this._startPositionLowArr = [];\n        this._endPositionHighArr = [];\n        this._endPositionLowArr = [];\n        this._thicknessArr = [];\n        this._rgbaArr = [];\n        this._pickingColorArr = [];\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[VERTEX_BUFFER] = this.createVertexBuffer;\n        this._buffersUpdateCallbacks[START_POSITION_BUFFER] = this.createStartPositionBuffer;\n        this._buffersUpdateCallbacks[END_POSITION_BUFFER] = this.createEndPositionBuffer;\n        this._buffersUpdateCallbacks[THICKNESS_BUFFER] = this.createThicknessBuffer;\n        this._buffersUpdateCallbacks[RGBA_BUFFER] = this.createRgbaBuffer;\n        this._buffersUpdateCallbacks[PICKINGCOLOR_BUFFER] = this.createPickingColorBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n    }\n    static concArr(dest, curr) {\n        for (let i = 0; i < curr.length; i++) {\n            dest.push(curr[i]);\n        }\n    }\n    initProgram() {\n        if (this._renderer && this._renderer.handler) {\n            if (!this._renderer.handler.programs.rayScreen) {\n                this._renderer.handler.addProgram(shaders.rayScreen());\n            }\n            // @todo: ray picking\n            // if (!this._renderer.handler.programs.billboardPicking) {\n            //     this._renderer.handler.addProgram(shaders.billboardPicking());\n            // }\n        }\n    }\n    setRenderer(renderer) {\n        this._renderer = renderer;\n        this.initProgram();\n    }\n    refresh() {\n        let i = this._changedBuffers.length;\n        while (i--) {\n            this._changedBuffers[i] = true;\n        }\n    }\n    _removeRays() {\n        let i = this._rays.length;\n        while (i--) {\n            let ri = this._rays[i];\n            ri._handlerIndex = -1;\n            ri._handler = null;\n        }\n        this._rays.length = 0;\n        this._rays = [];\n    }\n    clear() {\n        //@ts-ignore\n        this._vertexArr = null;\n        //@ts-ignore\n        this._startPositionHighArr = null;\n        //@ts-ignore\n        this._startPositionLowArr = null;\n        //@ts-ignore\n        this._endPositionHighArr = null;\n        //@ts-ignore\n        this._endPositionLowArr = null;\n        //@ts-ignore\n        this._thicknessArr = null;\n        //@ts-ignore\n        this._rgbaArr = null;\n        this._vertexArr = new Float32Array([]);\n        this._startPositionHighArr = new Float32Array([]);\n        this._startPositionLowArr = new Float32Array([]);\n        this._endPositionHighArr = new Float32Array([]);\n        this._endPositionLowArr = new Float32Array([]);\n        this._thicknessArr = new Float32Array([]);\n        this._rgbaArr = new Float32Array([]);\n        this._removeRays();\n        this._deleteBuffers();\n        this.refresh();\n    }\n    _deleteBuffers() {\n        if (this._renderer) {\n            let gl = this._renderer.handler.gl;\n            if (gl) {\n                gl.deleteBuffer(this._startPositionHighBuffer);\n                gl.deleteBuffer(this._startPositionLowBuffer);\n                gl.deleteBuffer(this._endPositionHighBuffer);\n                gl.deleteBuffer(this._endPositionLowBuffer);\n                gl.deleteBuffer(this._thicknessBuffer);\n                gl.deleteBuffer(this._rgbaBuffer);\n                gl.deleteBuffer(this._vertexBuffer);\n            }\n            this._startPositionHighBuffer = null;\n            this._startPositionLowBuffer = null;\n            this._endPositionHighBuffer = null;\n            this._endPositionLowBuffer = null;\n            this._thicknessBuffer = null;\n            this._rgbaBuffer = null;\n            this._vertexBuffer = null;\n        }\n    }\n    update() {\n        if (this._renderer) {\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n        }\n    }\n    add(ray) {\n        if (ray._handlerIndex == -1) {\n            ray._handler = this;\n            ray._handlerIndex = this._rays.length;\n            this._rays.push(ray);\n            this._addRayToArrays(ray);\n            this.refresh();\n        }\n    }\n    _addRayToArrays(ray) {\n        if (ray.getVisibility()) {\n            this._vertexArr = concatArrays(this._vertexArr, [-0.5, 1.0, -0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 1.0, -0.5, 1.0]);\n        }\n        else {\n            this._vertexArr = concatArrays(this._vertexArr, [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]);\n        }\n        let x = ray._startPositionHigh.x, y = ray._startPositionHigh.y, z = ray._startPositionHigh.z;\n        this._startPositionHighArr = concatArrays(this._startPositionHighArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n        x = ray._startPositionLow.x;\n        y = ray._startPositionLow.y;\n        z = ray._startPositionLow.z;\n        this._startPositionLowArr = concatArrays(this._startPositionLowArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n        x = ray._endPositionHigh.x;\n        y = ray._endPositionHigh.y;\n        z = ray._endPositionHigh.z;\n        this._endPositionHighArr = concatArrays(this._endPositionHighArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n        x = ray._endPositionLow.x;\n        y = ray._endPositionLow.y;\n        z = ray._endPositionLow.z;\n        this._endPositionLowArr = concatArrays(this._endPositionLowArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n        x = ray._thickness;\n        this._thicknessArr = concatArrays(this._thicknessArr, [x, x, x, x, x, x]);\n        let r0 = ray._startColor.x, g0 = ray._startColor.y, b0 = ray._startColor.z, a0 = ray._startColor.w, r1 = ray._endColor.x, g1 = ray._endColor.y, b1 = ray._endColor.z, a1 = ray._endColor.w;\n        this._rgbaArr = concatArrays(this._rgbaArr, [\n            r1, g1, b1, a1,\n            r0, g0, b0, a0,\n            r0, g0, b0, a0,\n            r0, g0, b0, a0,\n            r1, g1, b1, a1,\n            r1, g1, b1, a1\n        ]);\n        x = ray._entity._pickingColor.x / 255;\n        y = ray._entity._pickingColor.y / 255;\n        z = ray._entity._pickingColor.z / 255;\n        this._pickingColorArr = concatArrays(this._pickingColorArr, [x, y, z, x, y, z, x, y, z, x, y, z, x, y, z, x, y, z]);\n    }\n    _displayPASS() {\n        let r = this._renderer;\n        let h = r.handler;\n        h.programs.rayScreen.activate();\n        let sh = h.programs.rayScreen._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        let gl = h.gl, ec = this._entityCollection;\n        //gl.polygonOffset(ec.polygonOffsetFactor, ec.polygonOffsetUnits);\n        gl.disable(gl.CULL_FACE);\n        gl.uniform1f(shu.uOpacity, ec._fadingOpacity);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, r.activeCamera.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, r.activeCamera.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, r.activeCamera.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, r.activeCamera.eyeLow);\n        gl.uniform1f(shu.resolution, r.activeCamera._tanViewAngle_hradOneByHeight);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._startPositionHighBuffer);\n        gl.vertexAttribPointer(sha.a_startPosHigh, this._startPositionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._startPositionLowBuffer);\n        gl.vertexAttribPointer(sha.a_startPosLow, this._startPositionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._endPositionHighBuffer);\n        gl.vertexAttribPointer(sha.a_endPosHigh, this._endPositionHighBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._endPositionLowBuffer);\n        gl.vertexAttribPointer(sha.a_endPosLow, this._endPositionLowBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._rgbaBuffer);\n        gl.vertexAttribPointer(sha.a_rgba, this._rgbaBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._thicknessBuffer);\n        gl.vertexAttribPointer(sha.a_thickness, this._thicknessBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._vertexBuffer);\n        gl.vertexAttribPointer(sha.a_vertices, this._vertexBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLES, 0, this._vertexBuffer.numItems);\n        gl.enable(gl.CULL_FACE);\n    }\n    _pickingPASS() {\n        // ...\n    }\n    draw() {\n        if (this._rays.length) {\n            this.update();\n            this._displayPASS();\n        }\n    }\n    drawPicking() {\n        if (this._rays.length && this.pickingEnabled) {\n            this._pickingPASS();\n        }\n    }\n    reindexRaysArray(startIndex) {\n        let r = this._rays;\n        for (let i = startIndex; i < r.length; i++) {\n            r[i]._handlerIndex = i;\n        }\n    }\n    _removeRay(ray) {\n        let ri = ray._handlerIndex;\n        this._rays.splice(ri, 1);\n        let i = ri * 24;\n        this._rgbaArr = spliceArray(this._rgbaArr, i, 24);\n        i = ri * 18;\n        this._startPositionHighArr = spliceArray(this._startPositionHighArr, i, 18);\n        this._startPositionLowArr = spliceArray(this._startPositionLowArr, i, 18);\n        this._endPositionHighArr = spliceArray(this._endPositionHighArr, i, 18);\n        this._endPositionLowArr = spliceArray(this._endPositionLowArr, i, 18);\n        this._pickingColorArr = spliceArray(this._pickingColorArr, i, 18);\n        i = ri * 12;\n        this._vertexArr = spliceArray(this._vertexArr, i, 12);\n        i = ri * 6;\n        this._thicknessArr = spliceArray(this._thicknessArr, i, 6);\n        this.reindexRaysArray(ri);\n        this.refresh();\n        ray._handlerIndex = -1;\n        ray._handler = null;\n    }\n    remove(ray) {\n        if (ray._handler && this.__id === ray._handler.__id) {\n            this._removeRay(ray);\n        }\n    }\n    setStartPositionArr(index, positionHigh, positionLow) {\n        let i = index * 18;\n        // High\n        let a = this._startPositionHighArr, x = positionHigh.x, y = positionHigh.y, z = positionHigh.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        // Low\n        a = this._startPositionLowArr;\n        x = positionLow.x;\n        y = positionLow.y;\n        z = positionLow.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[START_POSITION_BUFFER] = true;\n    }\n    setEndPositionArr(index, positionHigh, positionLow) {\n        let i = index * 18;\n        // High\n        let a = this._endPositionHighArr, x = positionHigh.x, y = positionHigh.y, z = positionHigh.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        // Low\n        a = this._endPositionLowArr;\n        x = positionLow.x;\n        y = positionLow.y;\n        z = positionLow.z;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[END_POSITION_BUFFER] = true;\n    }\n    setPickingColorArr(index, color) {\n        let i = index * 18;\n        let a = this._pickingColorArr, x = color.x / 255, y = color.y / 255, z = color.z / 255;\n        a[i] = x;\n        a[i + 1] = y;\n        a[i + 2] = z;\n        a[i + 3] = x;\n        a[i + 4] = y;\n        a[i + 5] = z;\n        a[i + 6] = x;\n        a[i + 7] = y;\n        a[i + 8] = z;\n        a[i + 9] = x;\n        a[i + 10] = y;\n        a[i + 11] = z;\n        a[i + 12] = x;\n        a[i + 13] = y;\n        a[i + 14] = z;\n        a[i + 15] = x;\n        a[i + 16] = y;\n        a[i + 17] = z;\n        this._changedBuffers[PICKINGCOLOR_BUFFER] = true;\n    }\n    setRgbaArr(index, startColor, endColor) {\n        let i = index * 24;\n        let a = this._rgbaArr, r0 = startColor.x, g0 = startColor.y, b0 = startColor.z, a0 = startColor.w, r1 = endColor.x, g1 = endColor.y, b1 = endColor.z, a1 = endColor.w;\n        a[i] = r1;\n        a[i + 1] = g1;\n        a[i + 2] = b1;\n        a[i + 3] = a1;\n        a[i + 4] = r0;\n        a[i + 5] = g0;\n        a[i + 6] = b0;\n        a[i + 7] = a0;\n        a[i + 8] = r0;\n        a[i + 9] = g0;\n        a[i + 10] = b0;\n        a[i + 11] = a0;\n        a[i + 12] = r0;\n        a[i + 13] = g0;\n        a[i + 14] = b0;\n        a[i + 15] = a0;\n        a[i + 16] = r1;\n        a[i + 17] = g1;\n        a[i + 18] = b1;\n        a[i + 19] = a1;\n        a[i + 20] = r1;\n        a[i + 21] = g1;\n        a[i + 22] = b1;\n        a[i + 23] = a1;\n        this._changedBuffers[RGBA_BUFFER] = true;\n    }\n    setThicknessArr(index, thickness) {\n        let i = index * 6;\n        let a = this._thicknessArr;\n        a[i] = thickness;\n        a[i + 1] = thickness;\n        a[i + 2] = thickness;\n        a[i + 3] = thickness;\n        a[i + 4] = thickness;\n        a[i + 5] = thickness;\n        this._changedBuffers[THICKNESS_BUFFER] = true;\n    }\n    setVisibility(index, visibility) {\n        let vArr;\n        if (visibility) {\n            vArr = [-0.5, 1.0, -0.5, 0.0, 0.5, 0.0, 0.5, 0.0, 0.5, 1.0, -0.5, 1.0];\n        }\n        else {\n            vArr = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];\n        }\n        this.setVertexArr(index, vArr);\n    }\n    setVertexArr(index, vertexArr) {\n        let i = index * 12;\n        let a = this._vertexArr;\n        a[i] = vertexArr[0];\n        a[i + 1] = vertexArr[1];\n        a[i + 2] = vertexArr[2];\n        a[i + 3] = vertexArr[3];\n        a[i + 4] = vertexArr[4];\n        a[i + 5] = vertexArr[5];\n        a[i + 6] = vertexArr[6];\n        a[i + 7] = vertexArr[7];\n        a[i + 8] = vertexArr[8];\n        a[i + 9] = vertexArr[9];\n        a[i + 10] = vertexArr[10];\n        a[i + 11] = vertexArr[11];\n        this._changedBuffers[VERTEX_BUFFER] = true;\n    }\n    createStartPositionBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._startPositionHighBuffer);\n        this._startPositionHighArr = makeArrayTyped(this._startPositionHighArr);\n        this._startPositionHighBuffer = h.createArrayBuffer(this._startPositionHighArr, 3, this._startPositionHighArr.length / 3, h.gl.DYNAMIC_DRAW);\n        h.gl.deleteBuffer(this._startPositionLowBuffer);\n        this._startPositionLowArr = makeArrayTyped(this._startPositionLowArr);\n        this._startPositionLowBuffer = h.createArrayBuffer(this._startPositionLowArr, 3, this._startPositionLowArr.length / 3, h.gl.DYNAMIC_DRAW);\n    }\n    createEndPositionBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._endPositionHighBuffer);\n        this._endPositionHighArr = makeArrayTyped(this._endPositionHighArr);\n        this._endPositionHighBuffer = h.createArrayBuffer(this._endPositionHighArr, 3, this._endPositionHighArr.length / 3, h.gl.DYNAMIC_DRAW);\n        h.gl.deleteBuffer(this._endPositionLowBuffer);\n        this._endPositionLowArr = makeArrayTyped(this._endPositionLowArr);\n        this._endPositionLowBuffer = h.createArrayBuffer(this._endPositionLowArr, 3, this._endPositionLowArr.length / 3, h.gl.DYNAMIC_DRAW);\n    }\n    createRgbaBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._rgbaBuffer);\n        this._rgbaArr = makeArrayTyped(this._rgbaArr);\n        this._rgbaBuffer = h.createArrayBuffer(this._rgbaArr, 4, this._rgbaArr.length / 4);\n    }\n    createThicknessBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._thicknessBuffer);\n        this._thicknessArr = makeArrayTyped(this._thicknessArr);\n        this._thicknessBuffer = h.createArrayBuffer(this._thicknessArr, 1, this._thicknessArr.length, h.gl.DYNAMIC_DRAW);\n    }\n    createVertexBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._vertexBuffer);\n        this._vertexArr = makeArrayTyped(this._vertexArr);\n        this._vertexBuffer = h.createArrayBuffer(this._vertexArr, 2, this._vertexArr.length / 2, h.gl.DYNAMIC_DRAW);\n    }\n    createPickingColorBuffer() {\n        let h = this._renderer.handler;\n        h.gl.deleteBuffer(this._pickingColorBuffer);\n        this._pickingColorArr = makeArrayTyped(this._pickingColorArr);\n        this._pickingColorBuffer = h.createArrayBuffer(this._pickingColorArr, 3, this._pickingColorArr.length / 3);\n    }\n}\nRayHandler.__counter__ = 0;\nexport { RayHandler };\n//# sourceMappingURL=RayHandler.js.map","import { Program } from '../webgl/Program';\nexport function rayScreen() {\n    return new Program(\"rayScreen\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            resolution: \"float\",\n            uOpacity: \"float\"\n        },\n        attributes: {\n            a_vertices: \"vec2\",\n            a_startPosHigh: \"vec3\",\n            a_startPosLow: \"vec3\",\n            a_endPosHigh: \"vec3\",\n            a_endPosLow: \"vec3\",\n            a_thickness: \"float\",\n            a_rgba: \"vec4\"\n        },\n        vertexShader: `precision highp float;\n\n            attribute vec4 a_rgba;\n            attribute vec3 a_startPosHigh;\n            attribute vec3 a_startPosLow;\n            attribute vec3 a_endPosHigh;\n            attribute vec3 a_endPosLow;\n            attribute vec2 a_vertices;\n            attribute float a_thickness;\n\n            varying vec4 v_rgba;\n\n            uniform mat4 viewMatrix;\n            uniform mat4 projectionMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float resolution;\n            uniform float uOpacity;\n\n            void main() {\n\n                v_rgba = vec4(a_rgba.rgb, a_rgba.a * uOpacity);\n\n                vec3 v = (a_endPosHigh - a_startPosHigh) + (a_endPosLow - a_startPosLow);\n\n                vec3 look = (a_startPosHigh - eyePositionHigh) + (a_startPosLow - eyePositionLow) + v * a_vertices.y;\n                vec3 up = normalize(normalize(v));\n                vec3 right = normalize(cross(look,up));\n \n                float dist = dot(look, vec3(viewMatrix[0][2], viewMatrix[1][2], viewMatrix[2][2]));\n                float focalSize = 2.0 * dist * resolution;\n                vec3 vert = right * a_thickness * focalSize * a_vertices.x;\n\n                vec3 highDiff;\n                vec3 lowDiff;\n\n                if(a_vertices.y == 0.0){\n                    highDiff = a_startPosHigh - eyePositionHigh;\n                    vert += a_startPosLow - eyePositionLow;\n                }else{\n                    highDiff = a_endPosHigh - eyePositionHigh;\n                    vert += a_endPosLow - eyePositionLow;\n                }\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n                \n                gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + vert, 1.0);\n            }`,\n        fragmentShader: `precision highp float;\n            varying vec4 v_rgba;\n            void main () {\n                gl_FragColor = v_rgba;\n            }`\n    });\n}\n//# sourceMappingURL=ray.js.map","import { Program } from \"../webgl/Program\";\nclass StripHandler {\n    constructor(entityCollection) {\n        this.__id = StripHandler.__counter__++;\n        this.pickingEnabled = true;\n        this._entityCollection = entityCollection;\n        this._renderer = null;\n        this._strips = [];\n    }\n    _initProgram() {\n        if (this._renderer && this._renderer.handler) {\n            !this._renderer.handler.programs.strip &&\n                this._renderer.handler.addProgram(new Program(\"strip\", {\n                    uniforms: {\n                        projectionMatrix: { type: \"mat4\" },\n                        viewMatrix: { type: \"mat4\" },\n                        eyePositionHigh: \"vec3\",\n                        eyePositionLow: \"vec3\",\n                        uColor: { type: \"vec4\" },\n                        uOpacity: { type: \"float\" }\n                    },\n                    attributes: {\n                        aVertexPositionHigh: { type: \"vec3\" },\n                        aVertexPositionLow: { type: \"vec3\" }\n                    },\n                    vertexShader: `attribute vec3 aVertexPositionHigh;\n                        attribute vec3 aVertexPositionLow;\n                        uniform mat4 projectionMatrix;\n                        uniform mat4 viewMatrix;\n                        uniform vec3 eyePositionHigh;\n                        uniform vec3 eyePositionLow;\n                        void main(void) {\n\n                            vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                            vec3 lowDiff = aVertexPositionLow - eyePositionLow;\n\n                            mat4 viewMatrixRTE = viewMatrix;\n                            viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                            gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n                        }`,\n                    fragmentShader: `precision highp float;\n                        uniform vec4 uColor;\n                        uniform float uOpacity;\n                        void main(void) {\n                            gl_FragColor = vec4(uColor.rgb, uColor.a * uOpacity);\n                        }`\n                }));\n        }\n    }\n    setRenderNode(renderNode) {\n        this._renderer = renderNode.renderer;\n        this._initProgram();\n        for (let i = 0; i < this._strips.length; i++) {\n            this._strips[i].setRenderNode(renderNode);\n        }\n    }\n    add(strip) {\n        if (strip._handlerIndex === -1) {\n            strip._handler = this;\n            strip._handlerIndex = this._strips.length;\n            this._strips.push(strip);\n            this._entityCollection &&\n                this._entityCollection.renderNode &&\n                strip.setRenderNode(this._entityCollection.renderNode);\n        }\n    }\n    remove(strip) {\n        let index = strip._handlerIndex;\n        if (index !== -1) {\n            strip._deleteBuffers();\n            strip._handlerIndex = -1;\n            strip._handler = null;\n            this._strips.splice(index, 1);\n            this.reindexStripArray(index);\n        }\n    }\n    reindexStripArray(startIndex) {\n        let pc = this._strips;\n        for (let i = startIndex; i < pc.length; i++) {\n            pc[i]._handlerIndex = i;\n        }\n    }\n    draw() {\n        let i = this._strips.length;\n        while (i--) {\n            this._strips[i].draw();\n        }\n    }\n    drawPicking() {\n        if (this.pickingEnabled) {\n            let i = this._strips.length;\n            while (i--) {\n                this._strips[i].drawPicking();\n            }\n        }\n    }\n    clear() {\n        let i = this._strips.length;\n        while (i--) {\n            this._strips[i]._deleteBuffers();\n            this._strips[i]._handler = null;\n            this._strips[i]._handlerIndex = -1;\n        }\n        this._strips.length = 0;\n        this._strips = [];\n    }\n}\nStripHandler.__counter__ = 0;\nexport { StripHandler };\n//# sourceMappingURL=StripHandler.js.map","import * as math from \"../math\";\nimport { BillboardHandler } from \"./BillboardHandler\";\nimport { createEvents } from \"../Events\";\nimport { GeoObjectHandler } from \"./GeoObjectHandler\";\nimport { LabelHandler } from \"./LabelHandler\";\nimport { PointCloudHandler } from \"./PointCloudHandler\";\nimport { PolylineHandler } from \"./PolylineHandler\";\nimport { RayHandler } from \"./RayHandler\";\nimport { StripHandler } from \"./StripHandler\";\n/**\n * An observable collection of og.Entity instances where each entity has a unique id.\n * Entity collection provide handlers for each type of entity like billboard, label or 3ds object.\n * @constructor\n * @param {Object} [options] - Entity options:\n * @param {Array.<Entity>} [options.entities] - Entities array.\n * @param {boolean} [options.visibility=true] - Entity visibility.\n * @param {Array.<number>} [options.scaleByDistance] - Entity scale by distance parameters. (exactly 3 entries)\n * First index - near distance to the entity, after entity becomes full scale.\n * Second index - far distance to the entity, when entity becomes zero scale.\n * Third index - far distance to the entity, when entity becomes invisible.\n * @param {number} [options.opacity] - Entity global opacity.\n * @param {boolean} [options.pickingEnabled=true] - Entity picking enable.\n * @param {Number} [options.polygonOffsetUnits=0.0] - The multiplier by which an implementation-specific value is multiplied with to create a constant depth offset. The default value is 0.\n * //@fires EntityCollection#entitymove\n * @fires EntityCollection#draw\n * @fires EntityCollection#drawend\n * @fires EntityCollection#add\n * @fires EntityCollection#remove\n * @fires EntityCollection#entityadd\n * @fires EntityCollection#entityremove\n * @fires EntityCollection#visibilitychange\n * @fires EntityCollection#mousemove\n * @fires EntityCollection#mouseenter\n * @fires EntityCollection#mouseleave\n * @fires EntityCollection#lclick\n * @fires EntityCollection#rclick\n * @fires EntityCollection#mclick\n * @fires EntityCollection#ldblclick\n * @fires EntityCollection#rdblclick\n * @fires EntityCollection#mdblclick\n * @fires EntityCollection#lup\n * @fires EntityCollection#rup\n * @fires EntityCollection#mup\n * @fires EntityCollection#ldown\n * @fires EntityCollection#rdown\n * @fires EntityCollection#mdown\n * @fires EntityCollection#lhold\n * @fires EntityCollection#rhold\n * @fires EntityCollection#mhold\n * @fires EntityCollection#mousewheel\n * @fires EntityCollection#touchmove\n * @fires EntityCollection#touchstart\n * @fires EntityCollection#touchend\n * @fires EntityCollection#doubletouch\n * @fires EntityCollection#touchleave\n * @fires EntityCollection#touchenter\n */\nclass EntityCollection {\n    constructor(options = {}) {\n        this.__id = EntityCollection.__counter__++;\n        this._renderNodeIndex = -1;\n        this.renderNode = null;\n        this._visibility = options.visibility == undefined ? true : options.visibility;\n        this.polygonOffsetUnits =\n            options.polygonOffsetUnits != undefined ? options.polygonOffsetUnits : 0.0;\n        this.billboardHandler = new BillboardHandler(this);\n        this.labelHandler = new LabelHandler(this, options.labelMaxLetters);\n        this.polylineHandler = new PolylineHandler(this);\n        this.rayHandler = new RayHandler(this);\n        this.pointCloudHandler = new PointCloudHandler(this);\n        this.stripHandler = new StripHandler(this);\n        this.geoObjectHandler = new GeoObjectHandler(this);\n        if (options.pickingEnabled != undefined) {\n            this.setPickingEnabled(options.pickingEnabled);\n        }\n        this._entities = [];\n        this.scaleByDistance = options.scaleByDistance || [math.MAX32, math.MAX32, math.MAX32];\n        this.pickingScale = options.pickingScale || 1.0;\n        this._opacity = options.opacity == undefined ? 1.0 : options.opacity;\n        this._fadingOpacity = this._opacity;\n        this.events = this.rendererEvents = createEvents(ENTITYCOLLECTION_EVENTS, this);\n        // initialize current entities\n        if (options.entities) {\n            this.addEntities(options.entities);\n        }\n    }\n    get id() {\n        return this.__id;\n    }\n    isEqual(ec) {\n        return this.__id === ec.__id;\n    }\n    /**\n     * Sets collection visibility.\n     * @public\n     * @param {boolean} visibility - Visibility flag.\n     */\n    setVisibility(visibility) {\n        this._visibility = visibility;\n        this._fadingOpacity = this._opacity * (visibility ? 1 : 0);\n        this.events.dispatch(this.events.visibilitychange, this);\n    }\n    /**\n     * Returns collection visibility.\n     * @public\n     * @returns {boolean} -\n     */\n    getVisibility() {\n        return this._visibility;\n    }\n    /**\n     * Sets collection opacity.\n     * @public\n     * @param {number} opacity - Opacity.\n     */\n    setOpacity(opacity) {\n        this._opacity = opacity;\n    }\n    /**\n     * Sets collection picking ability.\n     * @public\n     * @param {boolean} enable - Picking enable flag.\n     */\n    setPickingEnabled(enable) {\n        this.billboardHandler.pickingEnabled = enable;\n        this.labelHandler.pickingEnabled = enable;\n        this.polylineHandler.pickingEnabled = enable;\n        this.rayHandler.pickingEnabled = enable;\n        this.pointCloudHandler.pickingEnabled = enable;\n        this.stripHandler.pickingEnabled = enable;\n        this.geoObjectHandler.pickingEnabled = enable;\n    }\n    /**\n     * Gets collection opacity.\n     * @public\n     * @returns {number} -\n     */\n    getOpacity() {\n        return this._opacity;\n    }\n    /**\n     * Sets scale by distance parameters.\n     * @public\n     * @param {number} near - Full scale entity distance.\n     * @param {number} far - Zero scale entity distance.\n     * @param {number} [farInvisible] - Entity visibility distance.\n     */\n    setScaleByDistance(near, far, farInvisible) {\n        this.scaleByDistance[0] = near;\n        this.scaleByDistance[1] = far;\n        this.scaleByDistance[2] = farInvisible || math.MAX32;\n    }\n    appendChildEntity(entity) {\n        this._addRecursively(entity);\n    }\n    _addRecursively(entity) {\n        // billboard\n        entity.billboard && this.billboardHandler.add(entity.billboard);\n        // label\n        entity.label && this.labelHandler.add(entity.label);\n        // polyline\n        entity.polyline && this.polylineHandler.add(entity.polyline);\n        // ray\n        entity.ray && this.rayHandler.add(entity.ray);\n        // pointCloud\n        entity.pointCloud && this.pointCloudHandler.add(entity.pointCloud);\n        // strip\n        entity.strip && this.stripHandler.add(entity.strip);\n        //geoObject\n        entity.geoObject && this.geoObjectHandler.add(entity.geoObject);\n        this.events.dispatch(this.events.entityadd, entity);\n        for (let i = 0; i < entity.childrenNodes.length; i++) {\n            entity.childrenNodes[i]._entityCollection = this;\n            entity.childrenNodes[i]._entityCollectionIndex = entity._entityCollectionIndex;\n            entity.childrenNodes[i]._pickingColor = entity._pickingColor;\n            this._addRecursively(entity.childrenNodes[i]);\n        }\n    }\n    /**\n     * Adds entity to the collection and returns collection.\n     * @public\n     * @param {Entity} entity - Entity.\n     * @returns {EntityCollection} -\n     */\n    add(entity) {\n        if (!entity._entityCollection) {\n            entity._entityCollection = this;\n            entity._entityCollectionIndex = this._entities.length;\n            this._entities.push(entity);\n            let rn = this.renderNode;\n            if (rn) {\n                rn.renderer && rn.renderer.assignPickingColor(entity);\n                if (rn.ellipsoid && entity._cartesian.isZero()) {\n                    entity.setCartesian3v(rn.ellipsoid.lonLatToCartesian(entity._lonLat));\n                }\n            }\n            this._addRecursively(entity);\n            entity.setPickingColor();\n        }\n        return this;\n    }\n    /**\n     * Adds entities array to the collection and returns collection.\n     * @public\n     * @param {Array.<Entity>} entities - Entities array.\n     * @returns {EntityCollection} -\n     */\n    addEntities(entities) {\n        for (let i = 0, len = entities.length; i < len; i++) {\n            this.add(entities[i]);\n        }\n        return this;\n    }\n    /**\n     * Returns true if the entity belongs this collection, otherwise returns false.\n     * @public\n     * @param {Entity} entity - Entity.\n     * @returns {boolean} -\n     */\n    belongs(entity) {\n        return entity._entityCollection && this._renderNodeIndex === entity._entityCollection._renderNodeIndex;\n    }\n    _removeRecursively(entity) {\n        entity._entityCollection = null;\n        entity._entityCollectionIndex = -1;\n        // billboard\n        entity.billboard && this.billboardHandler.remove(entity.billboard);\n        // label\n        entity.label && this.labelHandler.remove(entity.label);\n        // polyline\n        entity.polyline && this.polylineHandler.remove(entity.polyline);\n        // ray\n        entity.ray && this.rayHandler.remove(entity.ray);\n        // pointCloud\n        entity.pointCloud && this.pointCloudHandler.remove(entity.pointCloud);\n        // strip\n        entity.strip && this.stripHandler.remove(entity.strip);\n        // geoObject\n        entity.geoObject && this.geoObjectHandler.remove(entity.geoObject);\n        for (let i = 0; i < entity.childrenNodes.length; i++) {\n            this._removeRecursively(entity.childrenNodes[i]);\n        }\n    }\n    /**\n     * Removes entity from this collection.\n     * @public\n     * @param {Entity} entity - Entity to remove.\n     */\n    removeEntity(entity) {\n        this._entities.splice(entity._entityCollectionIndex, 1);\n        this.reindexEntitiesArray(entity._entityCollectionIndex);\n        // clear picking color\n        if (this.renderNode && this.renderNode.renderer) {\n            this.renderNode.renderer.clearPickingColor(entity);\n            entity._pickingColor.clear();\n        }\n        if (this.belongs(entity)) {\n            this._removeRecursively(entity);\n        }\n        this.events.dispatch(this.events.entityremove, entity);\n    }\n    _removeEntitySilent(entity) {\n        this._entities.splice(entity._entityCollectionIndex, 1);\n        this.reindexEntitiesArray(entity._entityCollectionIndex);\n        // clear picking color\n        if (this.renderNode && this.renderNode.renderer) {\n            this.renderNode.renderer.clearPickingColor(entity);\n            entity._pickingColor.clear();\n        }\n        if (this.belongs(entity)) {\n            this._removeRecursively(entity);\n        }\n    }\n    /**\n     * Creates or refresh collected entities picking color.\n     * @public\n     */\n    createPickingColors() {\n        if (!(this.renderNode && this.renderNode.renderer))\n            return;\n        let e = this._entities;\n        for (let i = 0; i < e.length; i++) {\n            if (!e[i].parent) {\n                this.renderNode.renderer.assignPickingColor(e[i]);\n                e[i].setPickingColor();\n            }\n        }\n    }\n    /**\n     * Refresh collected entities indexes from startIndex entities collection array position.\n     * @public\n     * @param {number} startIndex - Entities collection array index.\n     */\n    reindexEntitiesArray(startIndex) {\n        let e = this._entities;\n        for (let i = startIndex; i < e.length; i++) {\n            e[i]._entityCollectionIndex = i;\n        }\n    }\n    /**\n     * Adds this collection to render node.\n     * @public\n     * @param {RenderNode} renderNode - Render node.\n     * @param {boolean} [isHidden] - Uses in vector layers that render in planet render specific function.\n     * @returns {EntityCollection} -\n     */\n    addTo(renderNode, isHidden = false) {\n        if (!this.renderNode) {\n            this.renderNode = renderNode;\n            if (!isHidden) {\n                this._renderNodeIndex = renderNode.entityCollections.length;\n                renderNode.entityCollections.push(this);\n            }\n            renderNode.ellipsoid && this._updateGeodeticCoordinates(renderNode.ellipsoid);\n            this.bindRenderNode(renderNode);\n            this.events.dispatch(this.events.add, this);\n        }\n        return this;\n    }\n    /**\n     * This function is called in the RenderNode assign function.\n     * @public\n     * @param {RenderNode} renderNode\n     */\n    bindRenderNode(renderNode) {\n        if (renderNode.renderer && renderNode.renderer.isInitialized()) {\n            this.billboardHandler.setRenderer(renderNode.renderer);\n            this.labelHandler.setRenderer(renderNode.renderer);\n            this.rayHandler.setRenderer(renderNode.renderer);\n            this.geoObjectHandler.setRenderNode(renderNode);\n            this.polylineHandler.setRenderNode(renderNode);\n            this.pointCloudHandler.setRenderNode(renderNode);\n            this.stripHandler.setRenderNode(renderNode);\n            this.updateBillboardsTextureAtlas();\n            this.updateLabelsFontAtlas();\n            this.createPickingColors();\n        }\n    }\n    /**\n     * Updates coordinates all lonLat entities in collection after collection attached to the planet node.\n     * @protected\n     * @param {Ellipsoid} ellipsoid - Globe ellipsoid.\n     */\n    _updateGeodeticCoordinates(ellipsoid) {\n        let e = this._entities;\n        let i = e.length;\n        while (i--) {\n            let ei = e[i];\n            ei._lonLat && ei.setCartesian3v(ellipsoid.lonLatToCartesian(ei._lonLat));\n        }\n    }\n    /**\n     * Updates billboard texture atlas.\n     * @public\n     */\n    updateBillboardsTextureAtlas() {\n        let b = this.billboardHandler.billboards;\n        for (let i = 0; i < b.length; i++) {\n            b[i].setSrc(b[i].getSrc());\n        }\n    }\n    /**\n     * Updates labels font atlas.\n     * @public\n     */\n    updateLabelsFontAtlas() {\n        if (this.renderNode) {\n            // let l = ([] as Label[]).concat(this.labelHandler.labels);\n            // this.labelHandler._billboards = [];\n            // for (let i = 0; i < l.length; i++) {\n            //     this.labelHandler.assignFontAtlas(l[i]);\n            // }\n            this.labelHandler.updateFonts();\n        }\n    }\n    /**\n     * Removes collection from render node.\n     * @public\n     */\n    remove() {\n        if (this.renderNode) {\n            if (this._renderNodeIndex !== -1) {\n                this.renderNode.entityCollections.splice(this._renderNodeIndex, 1);\n                // reindex in the renderNode\n                for (let i = this._renderNodeIndex; i < this.renderNode.entityCollections.length; i++) {\n                    this.renderNode.entityCollections[i]._renderNodeIndex = i;\n                }\n            }\n            this.renderNode = null;\n            this._renderNodeIndex = -1;\n            this.events.dispatch(this.events.remove, this);\n        }\n    }\n    /**\n     * Gets entity array.\n     * @public\n     * @returns {Array.<Entity>} -\n     */\n    getEntities() {\n        return [].concat(this._entities);\n    }\n    /**\n     * Safety entities loop.\n     * @public\n     * @param {function} callback - Entity callback.\n     */\n    each(callback) {\n        let i = this._entities.length;\n        while (i--) {\n            let ei = this._entities[i];\n            ei && callback(ei);\n        }\n    }\n    /**\n     * Removes all entities from collection and clear handlers.\n     * @public\n     */\n    clear() {\n        // TODO: Optimize by replace delete\n        // code to the clearEntity function.\n        this.billboardHandler.clear();\n        this.labelHandler.clear();\n        this.polylineHandler.clear();\n        this.rayHandler.clear();\n        this.pointCloudHandler.clear();\n        this.stripHandler.clear();\n        this.geoObjectHandler.clear();\n        let i = this._entities.length;\n        while (i--) {\n            let ei = this._entities[i];\n            if (this.renderNode && this.renderNode.renderer) {\n                this.renderNode.renderer.clearPickingColor(ei);\n                ei._pickingColor.clear();\n            }\n            this._clearEntity(ei);\n        }\n        this._entities.length = 0;\n        this._entities = [];\n    }\n    /**\n     * Clears entity recursively.\n     * @private\n     * @param {Entity} entity - Entity to clear.\n     */\n    _clearEntity(entity) {\n        entity._entityCollection = null;\n        entity._entityCollectionIndex = -1;\n        for (let i = 0; i < entity.childrenNodes.length; i++) {\n            this._clearEntity(entity.childrenNodes[i]);\n        }\n    }\n}\nEntityCollection.__counter__ = 0;\nconst ENTITYCOLLECTION_EVENTS = [\n    // /**\n    //  * Triggered when entity has moved.\n    //  * @event EntityCollection#entitymove\n    //  */\n    // \"entitymove\",\n    /**\n     * Triggered when collection entities begin draw.\n     * @event EntityCollection#draw\n     */\n    \"draw\",\n    /**\n     * Triggered after collection has drawn.\n     * @event EntityCollection#drawend\n     */\n    \"drawend\",\n    /**\n     * Triggered when added to the render node.\n     * @event EntityCollection#add\n     */\n    \"add\",\n    /**\n     * Triggered when removed from the render node.\n     * @event EntityCollection#remove\n     */\n    \"remove\",\n    /**\n     * Triggered when new entity added to the collection.\n     * @event EntityCollection#entityadd\n     */\n    \"entityadd\",\n    /**\n     * Triggered when entity removes from the collection.\n     * @event EntityCollection#entityremove\n     */\n    \"entityremove\",\n    /**\n     * Triggered when visibility changes.\n     * @event EntityCollection#visibilitychange\n     */\n    \"visibilitychange\",\n    /**\n     * Triggered when mouse moves over the entity.\n     * @event EntityCollection#mousemove\n     */\n    \"mousemove\",\n    /**\n     * Triggered when mouse has entered over the entity.\n     * @event EntityCollection#mouseenter\n     */\n    \"mouseenter\",\n    /**\n     * Triggered when mouse leaves the entity.\n     * @event EntityCollection#mouseleave\n     */\n    \"mouseleave\",\n    /**\n     * Mouse left button clicked.\n     * @event EntityCollection#lclick\n     */\n    \"lclick\",\n    /**\n     * Mouse right button clicked.\n     * @event EntityCollection#rclick\n     */\n    \"rclick\",\n    /**\n     * Mouse right button clicked.\n     * @event EntityCollection#mclick\n     */\n    \"mclick\",\n    /**\n     * Mouse left button double click.\n     * @event EntityCollection#ldblclick\n     */\n    \"ldblclick\",\n    /**\n     * Mouse right button double click.\n     * @event EntityCollection#rdblclick\n     */\n    \"rdblclick\",\n    /**\n     * Mouse middle button double click.\n     * @event EntityCollection#mdblclick\n     */\n    \"mdblclick\",\n    /**\n     * Mouse left button up(stop pressing).\n     * @event EntityCollection#lup\n     */\n    \"lup\",\n    /**\n     * Mouse right button up(stop pressing).\n     * @event EntityCollection#rup\n     */\n    \"rup\",\n    /**\n     * Mouse middle button up(stop pressing).\n     * @event EntityCollection#mup\n     */\n    \"mup\",\n    /**\n     * Mouse left button is just pressed down(start pressing).\n     * @event EntityCollection#ldown\n     */\n    \"ldown\",\n    /**\n     * Mouse right button is just pressed down(start pressing).\n     * @event EntityCollection#rdown\n     */\n    \"rdown\",\n    /**\n     * Mouse middle button is just pressed down(start pressing).\n     * @event EntityCollection#mdown\n     */\n    \"mdown\",\n    /**\n     * Mouse left button is pressing.\n     * @event EntityCollection#lhold\n     */\n    \"lhold\",\n    /**\n     * Mouse right button is pressing.\n     * @event EntityCollection#rhold\n     */\n    \"rhold\",\n    /**\n     * Mouse middle button is pressing.\n     * @event EntityCollection#mhold\n     */\n    \"mhold\",\n    /**\n     * Mouse wheel is rotated.\n     * @event EntityCollection#mousewheel\n     */\n    \"mousewheel\",\n    /**\n     * Triggered when touch moves over the entity.\n     * @event EntityCollection#touchmove\n     */\n    \"touchmove\",\n    /**\n     * Triggered when entity begins to touch.\n     * @event EntityCollection#touchstart\n     */\n    \"touchstart\",\n    /**\n     * Triggered when entity ends touching.\n     * @event EntityCollection#touchend\n     */\n    \"touchend\",\n    /**\n     * Triggered entity double touch.\n     * @event EntityCollection#doubletouch\n     */\n    \"doubletouch\",\n    /**\n     * Triggered when touching leaves entity.\n     * @event EntityCollection#touchleave\n     */\n    \"touchleave\",\n    /**\n     * Triggered when touch enters over the entity.\n     * @event EntityCollection#touchenter\n     */\n    \"touchenter\"\n];\nexport { EntityCollection };\n//# sourceMappingURL=EntityCollection.js.map","import * as mercator from '../mercator';\nimport { NW, NE, SW, SE, RENDERING, VISIBLE_DISTANCE } from './quadTree';\nimport { EntityCollection } from '../entity/EntityCollection';\nimport { Extent } from '../Extent';\nimport { LonLat } from '../LonLat';\nimport { Sphere } from '../bv/Sphere';\nimport { Vec3 } from '../math/Vec3';\n/**\n * @todo: remove planet parameter. It's already available in the layer.\n */\nclass EntityCollectionNode {\n    constructor(layer, partId, parent, id, extent, planet, zoom) {\n        this.layer = layer;\n        this.parentNode = parent;\n        this.childrenNodes = [];\n        this.partId = partId;\n        this.nodeId = partId + id;\n        this.state = null;\n        this.extent = extent;\n        this.count = 0;\n        this.deferredEntities = [];\n        this.entityCollection = null;\n        this.zoom = zoom;\n        this._inTheQueue = false;\n        this.bsphere = new Sphere();\n        planet && this._setExtentBounds();\n    }\n    insertEntity(entity, rightNow = false) {\n        this.buildTree([entity], rightNow);\n    }\n    _addEntitiesToCollection(entities, rightNow = false) {\n        if (entities.length) {\n            const l = this.layer;\n            const p = l._planet;\n            let ec = this.entityCollection;\n            if (!ec) {\n                ec = new EntityCollection({\n                    pickingEnabled: l._pickingEnabled,\n                    labelMaxLetters: l.labelMaxLetters\n                });\n                ec._layer = this.layer;\n                ec.addTo(p, true);\n                ec._quadNode = this;\n                l._bindEventsDefault(ec);\n                this.entityCollection = ec;\n            }\n            if (rightNow || !l.async) {\n                this.entityCollection.addEntities(entities);\n            }\n            else {\n                this.deferredEntities.push.apply(this.deferredEntities, entities);\n            }\n        }\n    }\n    _setExtentBounds() {\n        if (!this.nodeId) {\n            this.bsphere.radius = this.layer._planet.ellipsoid.equatorialSize;\n            this.bsphere.center = new Vec3();\n        }\n        else {\n            this.bsphere.setFromExtent(this.layer._planet.ellipsoid, this.extent.inverseMercator());\n        }\n    }\n    __setLonLat__(entity) {\n        if (entity._lonLat.isZero() && !entity._cartesian.isZero()) {\n            entity._lonLat = this.layer._planet.ellipsoid.cartesianToLonLat(entity._cartesian);\n        }\n        if (Math.abs(entity._lonLat.lat) < mercator.MAX_LAT) {\n            entity._lonLatMerc = entity._lonLat.forwardMercator();\n        }\n        else {\n            entity._lonLatMerc = new LonLat();\n        }\n        return entity._lonLatMerc;\n    }\n    buildTree(entities, rightNow = false) {\n        this.count += entities.length;\n        if (entities.length > this.layer._nodeCapacity) {\n            const cn = this.childrenNodes;\n            if (!cn.length) {\n                this.createChildrenNodes();\n            }\n            let en_nw = [], en_ne = [], en_sw = [], en_se = [];\n            let i = entities.length;\n            while (i--) {\n                const ei = entities[i];\n                if (cn[NW].isInside(ei)) {\n                    ei._nodePtr = cn[NW];\n                    en_nw.push(ei);\n                }\n                else if (cn[NE].isInside(ei)) {\n                    ei._nodePtr = cn[NE];\n                    en_ne.push(ei);\n                }\n                else if (cn[SW].isInside(ei)) {\n                    ei._nodePtr = cn[SW];\n                    en_sw.push(ei);\n                }\n                else if (cn[SE].isInside(ei)) {\n                    ei._nodePtr = cn[SE];\n                    en_se.push(ei);\n                }\n            }\n            en_nw.length && cn[NW].buildTree(en_nw, rightNow);\n            en_ne.length && cn[NE].buildTree(en_ne, rightNow);\n            en_sw.length && cn[SW].buildTree(en_sw, rightNow);\n            en_se.length && cn[SE].buildTree(en_se, rightNow);\n        }\n        else {\n            this._addEntitiesToCollection(entities, rightNow);\n        }\n    }\n    isInside(entity) {\n        if (entity._lonLatMerc) {\n            return this.extent.isInside(entity._lonLatMerc);\n        }\n        else {\n            return false;\n        }\n    }\n    createChildrenNodes() {\n        const l = this.layer;\n        const ext = this.extent;\n        const size_x = ext.getWidth() * 0.5;\n        const size_y = ext.getHeight() * 0.5;\n        const ne = ext.northEast;\n        const sw = ext.southWest;\n        const id = this.nodeId * 4 + 1;\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\n        const nd = this.childrenNodes;\n        const p = this.layer._planet;\n        const z = this.zoom + 1;\n        nd[NW] = new EntityCollectionNode(l, NW, this, id, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)), p, z);\n        nd[NE] = new EntityCollectionNode(l, NE, this, id, new Extent(c, new LonLat(ne.lon, ne.lat)), p, z);\n        nd[SW] = new EntityCollectionNode(l, SW, this, id, new Extent(new LonLat(sw.lon, sw.lat), c), p, z);\n        nd[SE] = new EntityCollectionNode(l, SE, this, id, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)), p, z);\n    }\n    collectRenderCollectionsPASS1(visibleNodes, outArr) {\n        const n = visibleNodes[this.nodeId];\n        if (n) {\n            const cn = this.childrenNodes;\n            if (this.entityCollection) {\n                this.renderCollection(outArr, visibleNodes);\n            }\n            else if (cn.length) {\n                if (n.state === RENDERING) {\n                    this.layer._secondPASS.push(this);\n                }\n                else {\n                    cn[NW].collectRenderCollectionsPASS1(visibleNodes, outArr);\n                    cn[NE].collectRenderCollectionsPASS1(visibleNodes, outArr);\n                    cn[SW].collectRenderCollectionsPASS1(visibleNodes, outArr);\n                    cn[SE].collectRenderCollectionsPASS1(visibleNodes, outArr);\n                }\n            }\n        }\n    }\n    collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId) {\n        const p = this.layer._planet;\n        const cam = p.camera;\n        const altVis = (cam.eye.distance(this.bsphere.center) - this.bsphere.radius <\n            VISIBLE_DISTANCE * Math.sqrt(cam._lonLat.height)) || cam._lonLat.height > 10000;\n        if (this.count > 0 && altVis && cam.frustum.containsSphere(this.bsphere)) {\n            const cn = this.childrenNodes;\n            if (this.entityCollection) {\n                this.renderCollection(outArr, visibleNodes, renderingNodeId);\n            }\n            else if (cn.length) {\n                cn[NW].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\n                cn[NE].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\n                cn[SW].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\n                cn[SE].collectRenderCollectionsPASS2(visibleNodes, outArr, renderingNodeId);\n            }\n        }\n    }\n    applyCollection() {\n        this.entityCollection.addEntities(this.deferredEntities);\n        this.deferredEntities.length = 0;\n        this.deferredEntities = [];\n        this._inTheQueue = false;\n    }\n    traverseTree(callback) {\n        const cn = this.childrenNodes;\n        if (this.entityCollection) {\n            callback(this);\n        }\n        else if (cn.length) {\n            cn[NW].traverseTree(callback);\n            cn[NE].traverseTree(callback);\n            cn[SW].traverseTree(callback);\n            cn[SE].traverseTree(callback);\n        }\n    }\n    renderCollection(outArr, visibleNodes, renderingNodeId) {\n        const l = this.layer;\n        l._renderingNodes[this.nodeId] = true;\n        if (this.deferredEntities.length && !this._inTheQueue) {\n            if (l.async) {\n                l._queueDeferredNode(this);\n            }\n            else {\n                this.applyCollection();\n            }\n        }\n        const ec = this.entityCollection;\n        ec._fadingOpacity = l._fadingOpacity;\n        ec.scaleByDistance = l.scaleByDistance;\n        ec.pickingScale = l.pickingScale;\n        ec.polygonOffsetUnits = l.polygonOffsetUnits;\n        outArr.push(ec);\n        if (l.clampToGround || l.relativeToGround) {\n            const e = ec._entities;\n            let i = e.length;\n            if (visibleNodes[this.nodeId] && visibleNodes[this.nodeId].state === RENDERING) {\n                while (i--) {\n                    let ei = e[i];\n                    this.alignEntityToTheGround(ei, visibleNodes[this.nodeId].segment);\n                }\n            }\n            else if (renderingNodeId) {\n                while (i--) {\n                    let ei = e[i];\n                    this.alignEntityToTheGround(ei, visibleNodes[renderingNodeId].segment);\n                }\n            }\n            else {\n                const n = l._planet._renderedNodes;\n                while (i--) {\n                    let ei = e[i];\n                    let j = n.length;\n                    while (j--) {\n                        if (n[j].segment.isEntityInside(ei)) {\n                            this.alignEntityToTheGround(ei, n[j].segment);\n                            break;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    alignEntityToTheGround(entity, segment) {\n        let res = new Vec3();\n        segment.getEntityTerrainPoint(entity, res);\n        let alt = (Number(this.layer.relativeToGround) && entity._altitude) || 0.0;\n        if (alt) {\n            let n = this.layer._planet.ellipsoid.getSurfaceNormal3v(res);\n            entity._setCartesian3vSilent(res.addA(n.scale(alt)));\n        }\n        else {\n            entity._setCartesian3vSilent(res);\n        }\n    }\n    isVisible() {\n        if (this.layer._renderingNodes[this.nodeId]) {\n            return true;\n        }\n        return false;\n    }\n}\nclass EntityCollectionNodeWGS84 extends EntityCollectionNode {\n    constructor(layer, partId, parent, id, extent, planet, zoom) {\n        super(layer, partId, parent, id, extent, planet, zoom);\n        this.isNorth = false;\n    }\n    createChildrenNodes() {\n        const l = this.layer;\n        const ext = this.extent;\n        const size_x = ext.getWidth() * 0.5;\n        const size_y = ext.getHeight() * 0.5;\n        const ne = ext.northEast;\n        const sw = ext.southWest;\n        const id = this.nodeId * 4 + 1;\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\n        const nd = this.childrenNodes;\n        const p = this.layer._planet;\n        const z = this.zoom + 1;\n        nd[NW] = new EntityCollectionNodeWGS84(l, NW, this, id, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)), p, z);\n        nd[NE] = new EntityCollectionNodeWGS84(l, NE, this, id, new Extent(c, new LonLat(ne.lon, ne.lat)), p, z);\n        nd[SW] = new EntityCollectionNodeWGS84(l, SW, this, id, new Extent(new LonLat(sw.lon, sw.lat), c), p, z);\n        nd[SE] = new EntityCollectionNodeWGS84(l, SE, this, id, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)), p, z);\n    }\n    _setExtentBounds() {\n        if (this.extent.northEast.lat > 0) {\n            this.isNorth = true;\n        }\n        this.bsphere.setFromExtent(this.layer._planet.ellipsoid, this.extent);\n    }\n    __setLonLat__(entity) {\n        if (entity._lonLat.isZero()) {\n            entity._lonLat = this.layer._planet.ellipsoid.cartesianToLonLat(entity._cartesian);\n        }\n        return entity._lonLat;\n    }\n    isVisible() {\n        if (this.isNorth && this.layer._renderingNodesNorth[this.nodeId]) {\n            return true;\n        }\n        else if (this.layer._renderingNodesSouth[this.nodeId]) {\n            return true;\n        }\n        return false;\n    }\n    isInside(entity) {\n        return this.extent.isInside(entity._lonLat);\n    }\n    renderCollection(outArr, visibleNodes, renderingNode) {\n        if (this.isNorth) {\n            this.layer._renderingNodesNorth[this.nodeId] = true;\n        }\n        else {\n            this.layer._renderingNodesSouth[this.nodeId] = true;\n        }\n        if (this.deferredEntities.length && !this._inTheQueue) {\n            if (this.layer.async) {\n                this.layer._queueDeferredNode(this);\n            }\n            else {\n                this.applyCollection();\n            }\n        }\n        const ec = this.entityCollection;\n        ec._fadingOpacity = this.layer._fadingOpacity;\n        ec.scaleByDistance = this.layer.scaleByDistance;\n        ec.pickingScale = this.layer.pickingScale;\n        outArr.push(ec);\n    }\n}\nexport { EntityCollectionNode, EntityCollectionNodeWGS84 };\n//# sourceMappingURL=EntityCollectionNode.js.map","/**\n * @module og/math/coder\n */\nimport * as math from \"../math\";\nimport { Vec4 } from \"./Vec4\";\n/**\n * Encode 32 bit float value to the RGBA vector.\n * @function\n * @param {number} v - 32 bit float value.\n * @returns {Vec4} - RGBA vector value.\n */\nexport function encodeFloatToRGBA(v) {\n    let enc = new Vec4((1.0 * v) % 1, (255.0 * v) % 1, (65025.0 * v) % 1, (160581375.0 * v) % 1);\n    let yzww = new Vec4(enc.y / 255, enc.z / 255, enc.w / 255, 0);\n    return enc.subA(yzww);\n}\n/**\n * Decode RGBA vector to 32 bit float value.\n * @function\n * @param {Vec4} rgba - RGBA encoded 32 bit float value.\n * @returns {number} - Float value.\n */\nexport function decodeFloatFromRGBA(rgba) {\n    let s = 1.0 - math.step(128.0, rgba.x) * 2.0;\n    let e = 2.0 * math.mod(rgba.x, 128.0) + math.step(128.0, rgba.y) - 127.0;\n    let m = math.mod(rgba.y, 128.0) * 65536.0 + rgba.z * 256.0 + rgba.w + 8388608.0;\n    return s * math.exp2(e) * (m * 1.1920928955078125e-7);\n}\n/**\n * Decode RGBA vector to 32 bit float value.\n * @function\n * @param {NumberArray4 | NumberArray3} arr - RGBA encoded 32 bit float value.\n * @param {boolean} [use32=false] Use 32 bit result\n * @returns {number} - Float value.\n */\nexport function decodeFloatFromRGBAArr(arr, use32 = false) {\n    let s = 1.0 - math.step(128.0, arr[0]) * 2.0;\n    let e = 2.0 * math.mod(arr[0], 128.0) + math.step(128.0, arr[1]) - 127.0;\n    let m = math.mod(arr[1], 128.0) * 65536.0 + arr[2] * 256.0 + (use32 ? arr[3] || 0.0 : 0.0) + 8388608.0;\n    return s * math.exp2(e) * (m * 1.1920928955078125e-7);\n}\n/**\n * Separate 64 bit value to two 32-bit float values.\n * @function\n * @param {number} value - Double type value.\n * @returns {Float32Array} Encoded array. (exactly 2 entries)\n */\nexport function doubleToTwoFloats(value) {\n    let high, low;\n    if (value >= 0.0) {\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\n        high = Math.fround(doubleHigh);\n        low = Math.fround(value - doubleHigh);\n    }\n    else {\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\n        high = Math.fround(-doubleHigh);\n        low = Math.fround(value + doubleHigh);\n    }\n    return new Float32Array([high, low]);\n}\n/**\n * Separate 64 bit value to two 32-bit float values.\n * @function\n * @param {number} value - Double type value.\n * @param {NumberArray2 | Float32Array} - Reference out array.\n * @returns {NumberArray2 | Float32Array} Encoded array. (exactly 2 entries)\n */\nexport function doubleToTwoFloats2(value, highLowArr) {\n    if (value >= 0.0) {\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\n        highLowArr[0] = Math.fround(doubleHigh);\n        highLowArr[1] = Math.fround(value - doubleHigh);\n    }\n    else {\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\n        highLowArr[0] = Math.fround(-doubleHigh);\n        highLowArr[1] = Math.fround(value + doubleHigh);\n    }\n    return highLowArr;\n}\n/**\n * Separate 64 bit value to two 32-bit float values.\n * @function\n * @param {number} value - Double type value.\n * @param {Vec2} highLowVec - Reference out vector object.\n * @returns {Vec2} Encoded array. (exactly 2 entries)\n */\nexport function doubleToTwoFloatsV2(value, highLowVec) {\n    if (value >= 0.0) {\n        let doubleHigh = Math.floor(value / 65536.0) * 65536.0;\n        highLowVec.x = Math.fround(doubleHigh);\n        highLowVec.y = Math.fround(value - doubleHigh);\n    }\n    else {\n        let doubleHigh = Math.floor(-value / 65536.0) * 65536.0;\n        highLowVec.x = Math.fround(-doubleHigh);\n        highLowVec.y = Math.fround(value + doubleHigh);\n    }\n    return highLowVec;\n}\n//# sourceMappingURL=coder.js.map","// @ts-nocheck\n/* eslint-disable no-unused-vars */\n/* eslint-disable curly */\n/* eslint-disable operator-linebreak */\n/* eslint-disable no-mixed-operators */\n/**\n * @module og/utils/earcut\n */\n'use strict';\n// ISC License\n//\n// Copyright (c) 2016, Mapbox\n//\n// Permission to use, copy, modify, and/or distribute this software for any purpose\n// with or without fee is hereby granted, provided that the above copyright notice\n// and this permission notice appear in all copies.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\n// REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND\n// FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\n// INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS\n// OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER\n// TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF\n// THIS SOFTWARE.\n//\n//https://github.com/mapbox/earcut\nfunction earcut(data, holeIndices, dim) {\n    dim = dim || 2;\n    var hasHoles = holeIndices && holeIndices.length, outerLen = hasHoles ? holeIndices[0] * dim : data.length, outerNode = linkedList(data, 0, outerLen, dim, true), triangles = [];\n    if (!outerNode)\n        return triangles;\n    var minX, minY, maxX, maxY, x, y, size;\n    if (hasHoles)\n        outerNode = eliminateHoles(data, holeIndices, outerNode, dim);\n    // if the shape is not too simple, we'll use z-order curve hash later; calculate polygon bbox\n    if (data.length > 80 * dim) {\n        minX = maxX = data[0];\n        minY = maxY = data[1];\n        for (let i = dim; i < outerLen; i += dim) {\n            x = data[i];\n            y = data[i + 1];\n            if (x < minX)\n                minX = x;\n            if (y < minY)\n                minY = y;\n            if (x > maxX)\n                maxX = x;\n            if (y > maxY)\n                maxY = y;\n        }\n        // minX, minY and size are later used to transform coords into integers for z-order calculation\n        size = Math.max(maxX - minX, maxY - minY);\n    }\n    earcutLinked(outerNode, triangles, dim, minX, minY, size);\n    return triangles;\n}\n// create a circular doubly linked list from polygon points in the specified winding order\nfunction linkedList(data, start, end, dim, clockwise) {\n    var i, last;\n    if (clockwise === (signedArea(data, start, end, dim) > 0)) {\n        for (i = start; i < end; i += dim)\n            last = insertNode(i, data[i], data[i + 1], last);\n    }\n    else {\n        for (i = end - dim; i >= start; i -= dim)\n            last = insertNode(i, data[i], data[i + 1], last);\n    }\n    if (last && equals(last, last.next)) {\n        removeNode(last);\n        last = last.next;\n    }\n    return last;\n}\n// eliminate colinear or duplicate points\nfunction filterPoints(start, end) {\n    if (!start)\n        return start;\n    if (!end)\n        end = start;\n    var p = start, again;\n    do {\n        again = false;\n        if (!p.steiner && (equals(p, p.next) || area(p.prev, p, p.next) === 0)) {\n            removeNode(p);\n            p = end = p.prev;\n            if (p === p.next)\n                return null;\n            again = true;\n        }\n        else {\n            p = p.next;\n        }\n    } while (again || p !== end);\n    return end;\n}\n// main ear slicing loop which triangulates a polygon (given as a linked list)\nfunction earcutLinked(ear, triangles, dim, minX, minY, size, pass) {\n    if (!ear)\n        return;\n    // interlink polygon nodes in z-order\n    if (!pass && size)\n        indexCurve(ear, minX, minY, size);\n    var stop = ear, prev, next;\n    // iterate through ears, slicing them one by one\n    while (ear.prev !== ear.next) {\n        prev = ear.prev;\n        next = ear.next;\n        if (size ? isEarHashed(ear, minX, minY, size) : isEar(ear)) {\n            // cut off the triangle\n            triangles.push(prev.i / dim);\n            triangles.push(ear.i / dim);\n            triangles.push(next.i / dim);\n            removeNode(ear);\n            // skipping the next vertice leads to less sliver triangles\n            ear = next.next;\n            stop = next.next;\n            continue;\n        }\n        ear = next;\n        // if we looped through the whole remaining polygon and can't find any more ears\n        if (ear === stop) {\n            // try filtering points and slicing again\n            if (!pass) {\n                earcutLinked(filterPoints(ear), triangles, dim, minX, minY, size, 1);\n                // if this didn't work, try curing all small self-intersections locally\n            }\n            else if (pass === 1) {\n                ear = cureLocalIntersections(ear, triangles, dim);\n                earcutLinked(ear, triangles, dim, minX, minY, size, 2);\n                // as a last resort, try splitting the remaining polygon into two\n            }\n            else if (pass === 2) {\n                splitEarcut(ear, triangles, dim, minX, minY, size);\n            }\n            break;\n        }\n    }\n}\n// check whether a polygon node forms a valid ear with adjacent nodes\nfunction isEar(ear) {\n    var a = ear.prev, b = ear, c = ear.next;\n    if (area(a, b, c) >= 0)\n        return false; // reflex, can't be an ear\n    // now make sure we don't have other points inside the potential ear\n    var p = ear.next.next;\n    while (p !== ear.prev) {\n        if (pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0)\n            return false;\n        p = p.next;\n    }\n    return true;\n}\nfunction isEarHashed(ear, minX, minY, size) {\n    var a = ear.prev, b = ear, c = ear.next;\n    if (area(a, b, c) >= 0)\n        return false; // reflex, can't be an ear\n    // triangle bbox; min & max are calculated like this for speed\n    var minTX = a.x < b.x ? (a.x < c.x ? a.x : c.x) : (b.x < c.x ? b.x : c.x), minTY = a.y < b.y ? (a.y < c.y ? a.y : c.y) : (b.y < c.y ? b.y : c.y), maxTX = a.x > b.x ? (a.x > c.x ? a.x : c.x) : (b.x > c.x ? b.x : c.x), maxTY = a.y > b.y ? (a.y > c.y ? a.y : c.y) : (b.y > c.y ? b.y : c.y);\n    // z-order range for the current triangle bbox;\n    var minZ = zOrder(minTX, minTY, minX, minY, size), maxZ = zOrder(maxTX, maxTY, minX, minY, size);\n    // first look for points inside the triangle in increasing z-order\n    var p = ear.nextZ;\n    while (p && p.z <= maxZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0)\n            return false;\n        p = p.nextZ;\n    }\n    // then look for points in decreasing z-order\n    p = ear.prevZ;\n    while (p && p.z >= minZ) {\n        if (p !== ear.prev && p !== ear.next &&\n            pointInTriangle(a.x, a.y, b.x, b.y, c.x, c.y, p.x, p.y) &&\n            area(p.prev, p, p.next) >= 0)\n            return false;\n        p = p.prevZ;\n    }\n    return true;\n}\n// go through all polygon nodes and cure small local self-intersections\nfunction cureLocalIntersections(start, triangles, dim) {\n    var p = start;\n    do {\n        var a = p.prev, b = p.next.next;\n        if (!equals(a, b) && intersects(a, p, p.next, b) && locallyInside(a, b) && locallyInside(b, a)) {\n            triangles.push(a.i / dim);\n            triangles.push(p.i / dim);\n            triangles.push(b.i / dim);\n            // remove two nodes involved\n            removeNode(p);\n            removeNode(p.next);\n            p = start = b;\n        }\n        p = p.next;\n    } while (p !== start);\n    return p;\n}\n// try splitting polygon into two and triangulate them independently\nfunction splitEarcut(start, triangles, dim, minX, minY, size) {\n    // look for a valid diagonal that divides the polygon into two\n    var a = start;\n    do {\n        var b = a.next.next;\n        while (b !== a.prev) {\n            if (a.i !== b.i && isValidDiagonal(a, b)) {\n                // split the polygon in two by the diagonal\n                var c = splitPolygon(a, b);\n                // filter colinear points around the cuts\n                a = filterPoints(a, a.next);\n                c = filterPoints(c, c.next);\n                // run earcut on each half\n                earcutLinked(a, triangles, dim, minX, minY, size);\n                earcutLinked(c, triangles, dim, minX, minY, size);\n                return;\n            }\n            b = b.next;\n        }\n        a = a.next;\n    } while (a !== start);\n}\n// link every hole into the outer loop, producing a single-ring polygon without holes\nfunction eliminateHoles(data, holeIndices, outerNode, dim) {\n    var queue = [], i, len, start, end, list;\n    for (i = 0, len = holeIndices.length; i < len; i++) {\n        start = holeIndices[i] * dim;\n        end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n        list = linkedList(data, start, end, dim, false);\n        if (list === list.next)\n            list.steiner = true;\n        queue.push(getLeftmost(list));\n    }\n    queue.sort(compareX);\n    // process holes from left to right\n    for (i = 0; i < queue.length; i++) {\n        eliminateHole(queue[i], outerNode);\n        outerNode = filterPoints(outerNode, outerNode.next);\n    }\n    return outerNode;\n}\nfunction compareX(a, b) {\n    return a.x - b.x;\n}\n// find a bridge between vertices that connects hole with an outer ring and and link it\nfunction eliminateHole(hole, outerNode) {\n    outerNode = findHoleBridge(hole, outerNode);\n    if (outerNode) {\n        var b = splitPolygon(outerNode, hole);\n        filterPoints(b, b.next);\n    }\n}\n// David Eberly's algorithm for finding a bridge between hole and outer polygon\nfunction findHoleBridge(hole, outerNode) {\n    var p = outerNode, hx = hole.x, hy = hole.y, qx = -Infinity, m;\n    // find a segment intersected by a ray from the hole's leftmost point to the left;\n    // segment's endpoint with lesser x will be potential connection point\n    do {\n        if (hy <= p.y && hy >= p.next.y && p.next.y !== p.y) {\n            var x = p.x + (hy - p.y) * (p.next.x - p.x) / (p.next.y - p.y);\n            if (x <= hx && x > qx) {\n                qx = x;\n                if (x === hx) {\n                    if (hy === p.y)\n                        return p;\n                    if (hy === p.next.y)\n                        return p.next;\n                }\n                m = p.x < p.next.x ? p : p.next;\n            }\n        }\n        p = p.next;\n    } while (p !== outerNode);\n    if (!m)\n        return null;\n    if (hx === qx)\n        return m.prev; // hole touches outer segment; pick lower endpoint\n    // look for points inside the triangle of hole point, segment intersection and endpoint;\n    // if there are no points found, we have a valid connection;\n    // otherwise choose the point of the minimum angle with the ray as connection point\n    var stop = m, mx = m.x, my = m.y, tanMin = Infinity, tan;\n    p = m.next;\n    while (p !== stop) {\n        if (hx >= p.x && p.x >= mx && hx !== p.x &&\n            pointInTriangle(hy < my ? hx : qx, hy, mx, my, hy < my ? qx : hx, hy, p.x, p.y)) {\n            tan = Math.abs(hy - p.y) / (hx - p.x); // tangential\n            if ((tan < tanMin || (tan === tanMin && p.x > m.x)) && locallyInside(p, hole)) {\n                m = p;\n                tanMin = tan;\n            }\n        }\n        p = p.next;\n    }\n    return m;\n}\n// interlink polygon nodes in z-order\nfunction indexCurve(start, minX, minY, size) {\n    var p = start;\n    do {\n        if (p.z === null)\n            p.z = zOrder(p.x, p.y, minX, minY, size);\n        p.prevZ = p.prev;\n        p.nextZ = p.next;\n        p = p.next;\n    } while (p !== start);\n    p.prevZ.nextZ = null;\n    p.prevZ = null;\n    sortLinked(p);\n}\n// Simon Tatham's linked list merge sort algorithm\n// http://www.chiark.greenend.org.uk/~sgtatham/algorithms/listsort.html\nfunction sortLinked(list) {\n    var i, p, q, e, tail, numMerges, pSize, qSize, inSize = 1;\n    do {\n        p = list;\n        list = null;\n        tail = null;\n        numMerges = 0;\n        while (p) {\n            numMerges++;\n            q = p;\n            pSize = 0;\n            for (i = 0; i < inSize; i++) {\n                pSize++;\n                q = q.nextZ;\n                if (!q)\n                    break;\n            }\n            qSize = inSize;\n            while (pSize > 0 || (qSize > 0 && q)) {\n                if (pSize !== 0 && (qSize === 0 || !q || p.z <= q.z)) {\n                    e = p;\n                    p = p.nextZ;\n                    pSize--;\n                }\n                else {\n                    e = q;\n                    q = q.nextZ;\n                    qSize--;\n                }\n                if (tail)\n                    tail.nextZ = e;\n                else\n                    list = e;\n                e.prevZ = tail;\n                tail = e;\n            }\n            p = q;\n        }\n        tail.nextZ = null;\n        inSize *= 2;\n    } while (numMerges > 1);\n    return list;\n}\n// z-order of a point given coords and size of the data bounding box\nfunction zOrder(x, y, minX, minY, size) {\n    // coords are transformed into non-negative 15-bit integer range\n    x = 32767 * (x - minX) / size;\n    y = 32767 * (y - minY) / size;\n    x = (x | (x << 8)) & 0x00FF00FF;\n    x = (x | (x << 4)) & 0x0F0F0F0F;\n    x = (x | (x << 2)) & 0x33333333;\n    x = (x | (x << 1)) & 0x55555555;\n    y = (y | (y << 8)) & 0x00FF00FF;\n    y = (y | (y << 4)) & 0x0F0F0F0F;\n    y = (y | (y << 2)) & 0x33333333;\n    y = (y | (y << 1)) & 0x55555555;\n    return x | (y << 1);\n}\n// find the leftmost node of a polygon ring\nfunction getLeftmost(start) {\n    var p = start, leftmost = start;\n    do {\n        if (p.x < leftmost.x)\n            leftmost = p;\n        p = p.next;\n    } while (p !== start);\n    return leftmost;\n}\n// check if a point lies within a convex triangle\nfunction pointInTriangle(ax, ay, bx, by, cx, cy, px, py) {\n    return (cx - px) * (ay - py) - (ax - px) * (cy - py) >= 0 &&\n        (ax - px) * (by - py) - (bx - px) * (ay - py) >= 0 &&\n        (bx - px) * (cy - py) - (cx - px) * (by - py) >= 0;\n}\n// check if a diagonal between two polygon nodes is valid (lies in polygon interior)\nfunction isValidDiagonal(a, b) {\n    return a.next.i !== b.i && a.prev.i !== b.i && !intersectsPolygon(a, b) &&\n        locallyInside(a, b) && locallyInside(b, a) && middleInside(a, b);\n}\n// signed area of a triangle\nfunction area(p, q, r) {\n    return (q.y - p.y) * (r.x - q.x) - (q.x - p.x) * (r.y - q.y);\n}\n// check if two points are equal\nfunction equals(p1, p2) {\n    return p1.x === p2.x && p1.y === p2.y;\n}\n// check if two segments intersect\nfunction intersects(p1, q1, p2, q2) {\n    if ((equals(p1, q1) && equals(p2, q2)) ||\n        (equals(p1, q2) && equals(p2, q1)))\n        return true;\n    return area(p1, q1, p2) > 0 !== area(p1, q1, q2) > 0 &&\n        area(p2, q2, p1) > 0 !== area(p2, q2, q1) > 0;\n}\n// check if a polygon diagonal intersects any polygon segments\nfunction intersectsPolygon(a, b) {\n    var p = a;\n    do {\n        if (p.i !== a.i && p.next.i !== a.i && p.i !== b.i && p.next.i !== b.i &&\n            intersects(p, p.next, a, b))\n            return true;\n        p = p.next;\n    } while (p !== a);\n    return false;\n}\n// check if a polygon diagonal is locally inside the polygon\nfunction locallyInside(a, b) {\n    return area(a.prev, a, a.next) < 0 ?\n        area(a, b, a.next) >= 0 && area(a, a.prev, b) >= 0 :\n        area(a, b, a.prev) < 0 || area(a, a.next, b) < 0;\n}\n// check if the middle point of a polygon diagonal is inside the polygon\nfunction middleInside(a, b) {\n    var p = a, inside = false, px = (a.x + b.x) / 2, py = (a.y + b.y) / 2;\n    do {\n        if (((p.y > py) !== (p.next.y > py)) && p.next.y !== p.y &&\n            (px < (p.next.x - p.x) * (py - p.y) / (p.next.y - p.y) + p.x))\n            inside = !inside;\n        p = p.next;\n    } while (p !== a);\n    return inside;\n}\n// link two polygon vertices with a bridge; if the vertices belong to the same ring, it splits polygon into two;\n// if one belongs to the outer ring and another to a hole, it merges it into a single ring\nfunction splitPolygon(a, b) {\n    var a2 = new Node(a.i, a.x, a.y), b2 = new Node(b.i, b.x, b.y), an = a.next, bp = b.prev;\n    a.next = b;\n    b.prev = a;\n    a2.next = an;\n    an.prev = a2;\n    b2.next = a2;\n    a2.prev = b2;\n    bp.next = b2;\n    b2.prev = bp;\n    return b2;\n}\n// create a node and optionally link it with previous one (in a circular doubly linked list)\nfunction insertNode(i, x, y, last) {\n    var p = new Node(i, x, y);\n    if (!last) {\n        p.prev = p;\n        p.next = p;\n    }\n    else {\n        p.next = last.next;\n        p.prev = last;\n        last.next.prev = p;\n        last.next = p;\n    }\n    return p;\n}\nfunction removeNode(p) {\n    p.next.prev = p.prev;\n    p.prev.next = p.next;\n    if (p.prevZ)\n        p.prevZ.nextZ = p.nextZ;\n    if (p.nextZ)\n        p.nextZ.prevZ = p.prevZ;\n}\nfunction Node(i, x, y) {\n    // vertice index in coordinates array\n    this.i = i;\n    // vertex coordinates\n    this.x = x;\n    this.y = y;\n    // previous and next vertice nodes in a polygon ring\n    this.prev = null;\n    this.next = null;\n    // z-order curve value\n    this.z = null;\n    // previous and next nodes in z-order\n    this.prevZ = null;\n    this.nextZ = null;\n    // indicates whether this is a steiner point\n    this.steiner = false;\n}\n// return a percentage difference between the polygon area and its triangulation area;\n// used to verify correctness of triangulation\nfunction deviation(data, holeIndices, dim, triangles) {\n    var hasHoles = holeIndices && holeIndices.length;\n    var outerLen = hasHoles ? holeIndices[0] * dim : data.length;\n    var polygonArea = Math.abs(signedArea(data, 0, outerLen, dim));\n    if (hasHoles) {\n        for (let i = 0, len = holeIndices.length; i < len; i++) {\n            var start = holeIndices[i] * dim;\n            var end = i < len - 1 ? holeIndices[i + 1] * dim : data.length;\n            polygonArea -= Math.abs(signedArea(data, start, end, dim));\n        }\n    }\n    var trianglesArea = 0;\n    for (let i = 0; i < triangles.length; i += 3) {\n        var a = triangles[i] * dim;\n        var b = triangles[i + 1] * dim;\n        var c = triangles[i + 2] * dim;\n        trianglesArea += Math.abs((data[a] - data[c]) * (data[b + 1] - data[a + 1]) -\n            (data[a] - data[b]) * (data[c + 1] - data[a + 1]));\n    }\n    return polygonArea === 0 && trianglesArea === 0 ? 0 :\n        Math.abs((trianglesArea - polygonArea) / polygonArea);\n}\nfunction signedArea(data, start, end, dim) {\n    var sum = 0;\n    for (let i = start, j = end - dim; i < end; i += dim) {\n        sum += (data[j] - data[i]) * (data[i + 1] + data[j + 1]);\n        j = i;\n    }\n    return sum;\n}\n// turn a polygon in a multi-dimensional array form (e.g. as in GeoJSON) into a form Earcut accepts\nfunction flatten(data) {\n    var dim = data[0][0].length, result = { vertices: [], holes: [], dimensions: dim }, holeIndex = 0;\n    for (let i = 0; i < data.length; i++) {\n        for (let j = 0; j < data[i].length; j++) {\n            for (let d = 0; d < dim; d++)\n                result.vertices.push(data[i][j][d]);\n        }\n        if (i > 0) {\n            holeIndex += data[i - 1].length;\n            result.holes.push(holeIndex);\n        }\n    }\n    return result;\n}\nexport { earcut, flatten };\n//# sourceMappingURL=earcut.js.map","import * as mercator from \"../mercator\";\nimport * as quadTree from \"../quadTree/quadTree\";\nimport { doubleToTwoFloatsV2 } from \"../math/coder\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { GeometryType } from \"./Geometry\";\nimport { earcut, flatten } from \"../utils/earcut\";\nconst POLYVERTICES_BUFFER = 0;\nconst POLYINDEXES_BUFFER = 1;\nconst POLYCOLORS_BUFFER = 2;\nconst LINEVERTICES_BUFFER = 3;\nconst LINEINDEXES_BUFFER = 4;\nconst LINEORDERS_BUFFER = 5;\nconst LINECOLORS_BUFFER = 6;\nconst LINETHICKNESS_BUFFER = 7;\nconst LINESTROKES_BUFFER = 8;\nconst LINESTROKECOLORS_BUFFER = 9;\nconst POLYPICKINGCOLORS_BUFFER = 10;\nconst LINEPICKINGCOLORS_BUFFER = 11;\nfunction doubleToTwoFloats(v, high, low) {\n    let x = v[0], y = v[1];\n    if (x >= 0.0) {\n        let doubleHigh = Math.floor(x / 65536.0) * 65536.0;\n        high.x = Math.fround(doubleHigh);\n        low.x = Math.fround(x - doubleHigh);\n    }\n    else {\n        let doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\n        high.x = Math.fround(-doubleHigh);\n        low.x = Math.fround(x + doubleHigh);\n    }\n    if (y >= 0.0) {\n        let doubleHigh = Math.floor(y / 65536.0) * 65536.0;\n        high.y = Math.fround(doubleHigh);\n        low.y = Math.fround(y - doubleHigh);\n    }\n    else {\n        let doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\n        high.y = Math.fround(-doubleHigh);\n        low.y = Math.fround(y + doubleHigh);\n    }\n}\nlet tempHigh = new Vec2(), tempLow = new Vec2(), tempHighLow = new Vec2();\nclass GeometryHandler {\n    constructor(layer) {\n        this.__id = GeometryHandler.__counter__++;\n        this._layer = layer;\n        this._handler = null;\n        this._geometries = [];\n        this._updatedGeometryArr = [];\n        this._updatedGeometry = {};\n        this._removeGeometryExtentArr = [];\n        this._removeGeometryExtents = {};\n        // Polygon arrays\n        this._polyVerticesHighMerc = [];\n        this._polyVerticesLowMerc = [];\n        this._polyColors = [];\n        this._polyPickingColors = [];\n        this._polyIndexes = [];\n        // Line arrays\n        this._lineVerticesHighMerc = [];\n        this._lineVerticesLowMerc = [];\n        this._lineOrders = [];\n        this._lineIndexes = [];\n        this._lineColors = [];\n        this._linePickingColors = [];\n        this._lineThickness = [];\n        this._lineStrokes = [];\n        this._lineStrokeColors = [];\n        // Buffers\n        this._polyVerticesHighBufferMerc = null;\n        this._polyVerticesLowBufferMerc = null;\n        this._polyColorsBuffer = null;\n        this._polyPickingColorsBuffer = null;\n        this._polyIndexesBuffer = null;\n        this._lineVerticesHighBufferMerc = null;\n        this._lineVerticesLowBufferMerc = null;\n        this._lineColorsBuffer = null;\n        this._linePickingColorsBuffer = null;\n        this._lineThicknessBuffer = null;\n        this._lineStrokesBuffer = null;\n        this._lineStrokeColorsBuffer = null;\n        this._lineOrdersBuffer = null;\n        this._lineIndexesBuffer = null;\n        this._buffersUpdateCallbacks = [];\n        this._buffersUpdateCallbacks[POLYVERTICES_BUFFER] = this.createPolyVerticesBuffer;\n        this._buffersUpdateCallbacks[POLYINDEXES_BUFFER] = this.createPolyIndexesBuffer;\n        this._buffersUpdateCallbacks[POLYCOLORS_BUFFER] = this.createPolyColorsBuffer;\n        this._buffersUpdateCallbacks[LINEVERTICES_BUFFER] = this.createLineVerticesBuffer;\n        this._buffersUpdateCallbacks[LINEINDEXES_BUFFER] = this.createLineIndexesBuffer;\n        this._buffersUpdateCallbacks[LINEORDERS_BUFFER] = this.createLineOrdersBuffer;\n        this._buffersUpdateCallbacks[LINECOLORS_BUFFER] = this.createLineColorsBuffer;\n        this._buffersUpdateCallbacks[LINETHICKNESS_BUFFER] = this.createLineThicknessBuffer;\n        this._buffersUpdateCallbacks[LINESTROKES_BUFFER] = this.createLineStrokesBuffer;\n        this._buffersUpdateCallbacks[LINESTROKECOLORS_BUFFER] = this.createLineStrokeColorsBuffer;\n        this._buffersUpdateCallbacks[POLYPICKINGCOLORS_BUFFER] = this.createPolyPickingColorsBuffer;\n        this._buffersUpdateCallbacks[LINEPICKINGCOLORS_BUFFER] = this.createLinePickingColorsBuffer;\n        this._changedBuffers = new Array(this._buffersUpdateCallbacks.length);\n    }\n    static appendLineData(pathArr, isClosed, color, pickingColor, thickness, strokeColor, strokeSize, outVerticesHigh, outVerticesLow, outOrders, outIndexes, outColors, outPickingColors, outThickness, outStrokeColors, outStrokes, outVerticesHigh2, outVerticesLow2) {\n        var index = 0;\n        if (outIndexes.length > 0) {\n            index = outIndexes[outIndexes.length - 5] + 9;\n            outIndexes.push(index, index);\n        }\n        else {\n            outIndexes.push(0, 0);\n        }\n        var t = thickness, c = [color.x, color.y, color.z, color.w], s = strokeSize, sc = [strokeColor.x, strokeColor.y, strokeColor.z, strokeColor.w], p = [pickingColor.x, pickingColor.y, pickingColor.z, 1.0];\n        for (let j = 0; j < pathArr.length; j++) {\n            var path = pathArr[j];\n            if (path.length === 0) {\n                continue;\n            }\n            let startIndex = index;\n            let last;\n            if (isClosed) {\n                last = path[path.length - 1];\n            }\n            else {\n                let p0 = path[0], p1 = path[1];\n                if (!p1) {\n                    p1 = p0;\n                }\n                last = [p0[0] + p0[0] - p1[0], p0[1] + p0[1] - p1[1]];\n            }\n            doubleToTwoFloats(last, tempHigh, tempLow);\n            outVerticesHigh.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n            outVerticesLow.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n            outVerticesHigh2.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n            outVerticesLow2.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n            outOrders.push(1, -1, 2, -2);\n            outThickness.push(t, t, t, t);\n            outStrokes.push(s, s, s, s);\n            outColors.push(c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3]);\n            outStrokeColors.push(sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3]);\n            outPickingColors.push(p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3]);\n            for (let i = 0; i < path.length; i++) {\n                let cur = path[i];\n                doubleToTwoFloats(cur, tempHigh, tempLow);\n                outVerticesHigh.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n                outVerticesLow.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n                outVerticesHigh2.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n                outVerticesLow2.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n                outOrders.push(1, -1, 2, -2);\n                outThickness.push(t, t, t, t);\n                outStrokes.push(s, s, s, s);\n                outColors.push(c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3]);\n                outStrokeColors.push(sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3]);\n                outPickingColors.push(p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3]);\n                outIndexes.push(index++, index++, index++, index++);\n            }\n            let first;\n            if (isClosed) {\n                first = path[0];\n                outIndexes.push(startIndex, startIndex + 1, startIndex + 1, startIndex + 1);\n            }\n            else {\n                let p0 = path[path.length - 1], p1 = path[path.length - 2];\n                if (!p1) {\n                    p1 = p0;\n                }\n                first = [p0[0] + p0[0] - p1[0], p0[1] + p0[1] - p1[1]];\n                outIndexes.push(index - 1, index - 1, index - 1, index - 1);\n            }\n            doubleToTwoFloats(first, tempHigh, tempLow);\n            outVerticesHigh.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n            outVerticesLow.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n            outVerticesHigh2.push(tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y, tempHigh.x, tempHigh.y);\n            outVerticesLow2.push(tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y, tempLow.x, tempLow.y);\n            outOrders.push(1, -1, 2, -2);\n            outThickness.push(t, t, t, t);\n            outStrokes.push(s, s, s, s);\n            outColors.push(c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3], c[0], c[1], c[2], c[3]);\n            outStrokeColors.push(sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3], sc[0], sc[1], sc[2], sc[3]);\n            outPickingColors.push(p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3], p[0], p[1], p[2], p[3]);\n            if (j < pathArr.length - 1) {\n                index += 8;\n                outIndexes.push(index, index);\n            }\n        }\n    }\n    assignHandler(handler) {\n        this._handler = handler;\n        this.refresh();\n        if (handler.isInitialized()) {\n            this.update();\n        }\n    }\n    /**\n     * @public\n     * @param {Geometry} geometry - Geometry object.\n     */\n    add(geometry) {\n        //\n        // Triangulates polygon and sets geometry data.\n        if (geometry._handlerIndex === -1) {\n            geometry._handler = this;\n            geometry._handlerIndex = this._geometries.length;\n            this._geometries.push(geometry);\n            let pickingColor = geometry._entity._pickingColor.scaleTo(1 / 255);\n            geometry._polyVerticesHighMerc = [];\n            geometry._polyVerticesLowMerc = [];\n            geometry._lineVerticesHighMerc = [];\n            geometry._lineVerticesLowMerc = [];\n            if (geometry._coordinates[0].length) {\n                if (geometry.type === GeometryType.POLYGON) {\n                    let coordinates = geometry._coordinates;\n                    let ci = [];\n                    for (let j = 0; j < coordinates.length; j++) {\n                        ci[j] = [];\n                        for (let k = 0; k < coordinates[j].length; k++) {\n                            ci[j][k] = [mercator.forward_lon(coordinates[j][k][0]), mercator.forward_lat(coordinates[j][k][1])];\n                        }\n                    }\n                    let data = flatten(ci);\n                    let indexes = earcut(data.vertices, data.holes, 2);\n                    geometry._polyVerticesHandlerIndex = this._polyVerticesHighMerc.length;\n                    geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\n                    for (let i = 0; i < indexes.length; i++) {\n                        this._polyIndexes.push(indexes[i] + geometry._polyVerticesHandlerIndex * 0.5);\n                    }\n                    let color = geometry._style.fillColor;\n                    let verticesHigh = [], verticesLow = [];\n                    for (let i = 0; i < data.vertices.length * 0.5; i++) {\n                        this._polyColors.push(color.x, color.y, color.z, color.w);\n                        this._polyPickingColors.push(pickingColor.x, pickingColor.y, pickingColor.z, 1.0);\n                    }\n                    for (let i = 0; i < data.vertices.length; i++) {\n                        doubleToTwoFloatsV2(data.vertices[i], tempHighLow);\n                        verticesHigh[i] = tempHighLow.x;\n                        verticesLow[i] = tempHighLow.y;\n                    }\n                    geometry._polyVerticesHighMerc = verticesHigh;\n                    geometry._polyVerticesLowMerc = verticesLow;\n                    this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc, verticesHigh);\n                    this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc, verticesLow);\n                    geometry._polyVerticesLength = data.vertices.length;\n                    geometry._polyIndexesLength = indexes.length;\n                    // Creates polygon stroke data\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\n                    GeometryHandler.appendLineData(ci, true, geometry._style.lineColor, pickingColor, geometry._style.lineWidth, geometry._style.strokeColor, geometry._style.strokeWidth, this._lineVerticesHighMerc, this._lineVerticesLowMerc, this._lineOrders, this._lineIndexes, this._lineColors, this._linePickingColors, this._lineThickness, this._lineStrokeColors, this._lineStrokes, geometry._lineVerticesHighMerc, geometry._lineVerticesLowMerc);\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\n                }\n                else if (geometry.type === GeometryType.MULTIPOLYGON) {\n                    let coordinates = geometry._coordinates;\n                    let vertices = [], indexes = [];\n                    // Creates polygon stroke data\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\n                    for (let i = 0; i < coordinates.length; i++) {\n                        let cci = coordinates[i];\n                        let ci = [];\n                        for (let j = 0; j < cci.length; j++) {\n                            ci[j] = [];\n                            for (let k = 0; k < coordinates[i][j].length; k++) {\n                                ci[j][k] = [mercator.forward_lon(cci[j][k][0]), mercator.forward_lat(cci[j][k][1])];\n                            }\n                        }\n                        let data = flatten(ci);\n                        let dataIndexes = earcut(data.vertices, data.holes, 2);\n                        for (let j = 0; j < dataIndexes.length; j++) {\n                            indexes.push(dataIndexes[j] + vertices.length * 0.5);\n                        }\n                        vertices.push.apply(vertices, data.vertices);\n                        GeometryHandler.appendLineData(ci, true, geometry._style.lineColor, pickingColor, geometry._style.lineWidth, geometry._style.strokeColor, geometry._style.strokeWidth, this._lineVerticesHighMerc, this._lineVerticesLowMerc, this._lineOrders, this._lineIndexes, this._lineColors, this._linePickingColors, this._lineThickness, this._lineStrokeColors, this._lineStrokes, geometry._lineVerticesHighMerc, geometry._lineVerticesLowMerc);\n                    }\n                    geometry._polyVerticesHandlerIndex = this._polyVerticesHighMerc.length;\n                    geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\n                    for (let i = 0; i < indexes.length; i++) {\n                        this._polyIndexes.push(indexes[i] + geometry._polyVerticesHandlerIndex * 0.5);\n                    }\n                    let color = geometry._style.fillColor;\n                    let verticesHigh = [], verticesLow = [];\n                    for (let i = 0; i < vertices.length * 0.5; i++) {\n                        this._polyColors.push(color.x, color.y, color.z, color.w);\n                        this._polyPickingColors.push(pickingColor.x, pickingColor.y, pickingColor.z, 1.0);\n                    }\n                    for (let i = 0; i < vertices.length; i++) {\n                        doubleToTwoFloatsV2(vertices[i], tempHighLow);\n                        verticesHigh[i] = tempHighLow.x;\n                        verticesLow[i] = tempHighLow.y;\n                    }\n                    geometry._polyVerticesHighMerc = verticesHigh;\n                    geometry._polyVerticesLowMerc = verticesLow;\n                    this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc, verticesHigh);\n                    this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc, verticesLow);\n                    geometry._polyVerticesLength = vertices.length;\n                    geometry._polyIndexesLength = indexes.length;\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\n                }\n                else if (geometry.type === GeometryType.LINESTRING) {\n                    let coordinates = geometry._coordinates;\n                    let ci = new Array(coordinates.length);\n                    for (let j = 0; j < coordinates.length; j++) {\n                        ci[j] = [mercator.forward_lon(coordinates[j][0]), mercator.forward_lat(coordinates[j][1])];\n                    }\n                    // Creates polygon stroke data\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\n                    GeometryHandler.appendLineData([ci], false, geometry._style.lineColor, pickingColor, geometry._style.lineWidth, geometry._style.strokeColor, geometry._style.strokeWidth, this._lineVerticesHighMerc, this._lineVerticesLowMerc, this._lineOrders, this._lineIndexes, this._lineColors, this._linePickingColors, this._lineThickness, this._lineStrokeColors, this._lineStrokes, geometry._lineVerticesHighMerc, geometry._lineVerticesLowMerc);\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\n                }\n                else if (geometry.type === GeometryType.MULTILINESTRING) {\n                    let coordinates = geometry._coordinates;\n                    let ci = [];\n                    for (let j = 0; j < coordinates.length; j++) {\n                        ci[j] = [];\n                        for (let k = 0; k < coordinates[j].length; k++) {\n                            ci[j][k] = [mercator.forward_lon(coordinates[j][k][0]), mercator.forward_lat(coordinates[j][k][1])];\n                        }\n                    }\n                    // Creates polygon stroke data\n                    geometry._lineVerticesHandlerIndex = this._lineVerticesHighMerc.length;\n                    geometry._lineOrdersHandlerIndex = this._lineOrders.length;\n                    geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\n                    geometry._lineColorsHandlerIndex = this._lineColors.length;\n                    geometry._lineThicknessHandlerIndex = this._lineThickness.length;\n                    GeometryHandler.appendLineData(ci, false, geometry._style.lineColor, pickingColor, geometry._style.lineWidth, geometry._style.strokeColor, geometry._style.strokeWidth, this._lineVerticesHighMerc, this._lineVerticesLowMerc, this._lineOrders, this._lineIndexes, this._lineColors, this._linePickingColors, this._lineThickness, this._lineStrokeColors, this._lineStrokes, geometry._lineVerticesHighMerc, geometry._lineVerticesLowMerc);\n                    geometry._lineVerticesLength = this._lineVerticesHighMerc.length - geometry._lineVerticesHandlerIndex;\n                    geometry._lineOrdersLength = this._lineOrders.length - geometry._lineOrdersHandlerIndex;\n                    geometry._lineIndexesLength = this._lineIndexes.length - geometry._lineIndexesHandlerIndex;\n                    geometry._lineColorsLength = this._lineColors.length - geometry._lineColorsHandlerIndex;\n                    geometry._lineThicknessLength = this._lineThickness.length - geometry._lineThicknessHandlerIndex;\n                }\n            }\n            // Refresh visibility\n            this.setGeometryVisibility(geometry);\n            !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n            this._updatedGeometry[geometry.__id] = true;\n            this.refresh();\n        }\n    }\n    remove(geometry) {\n        const index = geometry._handlerIndex;\n        if (index !== -1) {\n            this._geometries.splice(index, 1);\n            // polygon\n            // this._polyVerticesLonLat.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\n            this._polyVerticesHighMerc.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\n            this._polyVerticesLowMerc.splice(geometry._polyVerticesHandlerIndex, geometry._polyVerticesLength);\n            this._polyColors.splice(geometry._polyVerticesHandlerIndex * 2, geometry._polyVerticesLength * 2);\n            this._polyPickingColors.splice(geometry._polyVerticesHandlerIndex * 2, geometry._polyVerticesLength * 2);\n            this._polyIndexes.splice(geometry._polyIndexesHandlerIndex, geometry._polyIndexesLength);\n            let di = geometry._polyVerticesLength * 0.5;\n            for (let i = geometry._polyIndexesHandlerIndex; i < this._polyIndexes.length; i++) {\n                this._polyIndexes[i] -= di;\n            }\n            // line\n            // this._lineVerticesLonLat.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\n            this._lineVerticesHighMerc.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\n            this._lineVerticesLowMerc.splice(geometry._lineVerticesHandlerIndex, geometry._lineVerticesLength);\n            this._lineOrders.splice(geometry._lineOrdersHandlerIndex, geometry._lineOrdersLength);\n            this._lineColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\n            this._linePickingColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\n            this._lineStrokeColors.splice(geometry._lineColorsHandlerIndex, geometry._lineColorsLength);\n            this._lineThickness.splice(geometry._lineThicknessHandlerIndex, geometry._lineThicknessLength);\n            this._lineStrokes.splice(geometry._lineThicknessHandlerIndex, geometry._lineThicknessLength);\n            this._lineIndexes.splice(geometry._lineIndexesHandlerIndex, geometry._lineIndexesLength);\n            di = geometry._lineVerticesLength * 0.5;\n            for (let i = geometry._lineIndexesHandlerIndex; i < this._lineIndexes.length; i++) {\n                this._lineIndexes[i] -= di;\n            }\n            // reindex\n            let g = this._geometries;\n            for (let i = index; i < g.length; i++) {\n                let gi = g[i];\n                gi._handlerIndex = i;\n                gi._polyVerticesHandlerIndex -= geometry._polyVerticesLength;\n                gi._polyIndexesHandlerIndex -= geometry._polyIndexesLength;\n                gi._lineVerticesHandlerIndex -= geometry._lineVerticesLength;\n                gi._lineOrdersHandlerIndex -= geometry._lineOrdersLength;\n                gi._lineColorsHandlerIndex -= geometry._lineColorsLength;\n                gi._lineThicknessHandlerIndex -= geometry._lineThicknessLength;\n                gi._lineIndexesHandlerIndex -= geometry._lineIndexesLength;\n            }\n            geometry._pickingReady = false;\n            geometry._handler = null;\n            geometry._handlerIndex = -1;\n            geometry._polyVerticesHighMerc = [];\n            geometry._polyVerticesLowMerc = [];\n            geometry._polyVerticesLength = -1;\n            geometry._polyIndexesLength = -1;\n            geometry._polyVerticesHandlerIndex = -1;\n            geometry._polyIndexesHandlerIndex = -1;\n            geometry._lineVerticesHighMerc = [];\n            geometry._lineVerticesLowMerc = [];\n            geometry._lineVerticesLength = -1;\n            geometry._lineOrdersLength = -1;\n            geometry._lineIndexesLength = -1;\n            geometry._lineColorsLength = -1;\n            geometry._lineThicknessLength = -1;\n            geometry._lineVerticesHandlerIndex = -1;\n            geometry._lineOrdersHandlerIndex = -1;\n            geometry._lineIndexesHandlerIndex = -1;\n            geometry._lineThicknessHandlerIndex = -1;\n            geometry._lineColorsHandlerIndex = -1;\n            !this._removeGeometryExtents[geometry.__id] && this._removeGeometryExtentArr.push(geometry.getExtent());\n            this._removeGeometryExtents[geometry.__id] = true;\n            this.refresh();\n        }\n    }\n    _refreshRecursevely(geometry, treeNode) {\n        if (treeNode.ready) {\n            let lid = this._layer._id;\n            for (let i = 0; i < treeNode.nodes.length; i++) {\n                let ni = treeNode.nodes[i];\n                if (geometry.overlaps(ni.segment.getExtentLonLat())) {\n                    this._refreshRecursevely(geometry, ni);\n                    let m = ni.segment.materials[lid];\n                    if (m && m.isReady) {\n                        if (m.segment.node.getState() !== quadTree.RENDERING) {\n                            m.layer.clearMaterial(m);\n                        }\n                        else {\n                            m.pickingReady = m.pickingReady && geometry._pickingReady;\n                            m.isReady = false;\n                            m._updateTexture = m.texture;\n                            m._updatePickingMask = m.pickingMask;\n                        }\n                        geometry._pickingReady = true;\n                    }\n                }\n            }\n        }\n    }\n    _refreshRecursevelyExt(extent, treeNode) {\n        if (treeNode.ready) {\n            let lid = this._layer.__id;\n            for (let i = 0; i < treeNode.nodes.length; i++) {\n                let ni = treeNode.nodes[i];\n                if (extent.overlaps(ni.segment.getExtentLonLat())) {\n                    this._refreshRecursevelyExt(extent, ni);\n                    let m = ni.segment.materials[lid];\n                    if (m && m.isReady) {\n                        m.layer.clearMaterial(m);\n                        // m.pickingReady = false;\n                        // m.isReady = false;\n                        // m._updateTexture = m.texture;\n                        // m._updatePickingMask = m.pickingMask;\n                    }\n                }\n            }\n        }\n    }\n    _refreshPlanetNode(treeNode) {\n        let i;\n        let e = this._removeGeometryExtentArr;\n        for (i = 0; i < e.length; i++) {\n            this._refreshRecursevelyExt(e[i], treeNode);\n        }\n        let g = this._updatedGeometryArr;\n        for (i = 0; i < g.length; i++) {\n            this._refreshRecursevely(g[i], treeNode);\n        }\n    }\n    _updatePlanet() {\n        let p = this._layer._planet;\n        if (p) {\n            let ql = p.quadTreeStrategy.quadTreeList;\n            for (let i = 0; i < ql.length; i++) {\n                this._refreshPlanetNode(ql[i]);\n            }\n            // p.quadTreeStrategy.quadTreeList.forEach((quadTree: Node) => {\n            //     this._refreshPlanetNode(quadTree);\n            // });\n        }\n        this._updatedGeometryArr.length = 0;\n        this._updatedGeometryArr = [];\n        this._updatedGeometry = {};\n        this._removeGeometryExtentArr.length = 0;\n        this._removeGeometryExtentArr = [];\n        this._removeGeometryExtents = {};\n    }\n    refresh() {\n        let i = this._changedBuffers.length;\n        while (i--) {\n            this._changedBuffers[i] = true;\n        }\n    }\n    update() {\n        if (this._handler) {\n            let needUpdate = false;\n            let i = this._changedBuffers.length;\n            while (i--) {\n                if (this._changedBuffers[i]) {\n                    needUpdate = true;\n                    this._buffersUpdateCallbacks[i].call(this);\n                    this._changedBuffers[i] = false;\n                }\n            }\n            needUpdate && this._updatePlanet();\n        }\n    }\n    setGeometryVisibility(geometry) {\n        let v = geometry.getVisibility() ? 1.0 : 0.0;\n        let a = this._polyVerticesHighMerc, b = this._polyVerticesLowMerc;\n        let l = geometry._polyVerticesLength;\n        let ind = geometry._polyVerticesHandlerIndex;\n        for (let i = 0; i < l; i++) {\n            a[ind + i] = geometry._polyVerticesHighMerc[i] * v;\n            b[ind + i] = geometry._polyVerticesLowMerc[i] * v;\n        }\n        a = this._lineVerticesHighMerc;\n        b = this._lineVerticesLowMerc;\n        l = geometry._lineVerticesLength;\n        ind = geometry._lineVerticesHandlerIndex;\n        for (let i = 0; i < l; i++) {\n            a[ind + i] = geometry._lineVerticesHighMerc[i] * v;\n            b[ind + i] = geometry._lineVerticesLowMerc[i] * v;\n        }\n        this._changedBuffers[POLYVERTICES_BUFFER] = true;\n        this._changedBuffers[LINEVERTICES_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    setPolyColorArr(geometry, color) {\n        let index = geometry._polyVerticesHandlerIndex * 2, // ... / 2 * 4\n        size = index + geometry._polyVerticesLength * 2; // ... / 2 * 4\n        let a = this._polyColors;\n        for (let i = index; i < size; i += 4) {\n            a[i] = color.x;\n            a[i + 1] = color.y;\n            a[i + 2] = color.z;\n            a[i + 3] = color.w;\n        }\n        this._changedBuffers[POLYCOLORS_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    setLineStrokeColorArr(geometry, color) {\n        let index = geometry._lineColorsHandlerIndex, size = index + geometry._lineColorsLength;\n        let a = this._lineStrokeColors;\n        for (let i = index; i < size; i += 4) {\n            a[i] = color.x;\n            a[i + 1] = color.y;\n            a[i + 2] = color.z;\n            a[i + 3] = color.w;\n        }\n        this._changedBuffers[LINESTROKECOLORS_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    setLineColorArr(geometry, color) {\n        let index = geometry._lineColorsHandlerIndex, size = index + geometry._lineColorsLength;\n        let a = this._lineColors;\n        for (let i = index; i < size; i += 4) {\n            a[i] = color.x;\n            a[i + 1] = color.y;\n            a[i + 2] = color.z;\n            a[i + 3] = color.w;\n        }\n        this._changedBuffers[LINECOLORS_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    setLineStrokeArr(geometry, width) {\n        // let index = geometry._lineStrokesHandlerIndex,\n        //     size = index + geometry._lineStrokesLength;\n        // let a = this._lineStrokes;\n        // for (let i = index; i < size; i++) {\n        //     a[i] = width;\n        // }\n        // this._changedBuffers[LINESTROKES_BUFFER] = true;\n        // !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        // this._updatedGeometry[geometry.__id] = true;\n    }\n    setLineThicknessArr(geometry, width) {\n        let index = geometry._lineThicknessHandlerIndex, size = index + geometry._lineThicknessLength;\n        let a = this._lineThickness;\n        for (let i = index; i < size; i++) {\n            a[i] = width;\n        }\n        this._changedBuffers[LINETHICKNESS_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    bringToFront(geometry) {\n        let polyIndexes = this._polyIndexes.splice(geometry._polyIndexesHandlerIndex, geometry._polyIndexesLength);\n        let lineIndexes = this._lineIndexes.splice(geometry._lineIndexesHandlerIndex, geometry._lineIndexesLength);\n        this._geometries.splice(geometry._handlerIndex, 1);\n        let g = this._geometries;\n        for (let i = geometry._handlerIndex; i < g.length; i++) {\n            let gi = g[i];\n            gi._handlerIndex = i;\n            gi._polyIndexesHandlerIndex -= geometry._polyIndexesLength;\n            gi._lineIndexesHandlerIndex -= geometry._lineIndexesLength;\n        }\n        geometry._polyIndexesHandlerIndex = this._polyIndexes.length;\n        geometry._lineIndexesHandlerIndex = this._lineIndexes.length;\n        geometry._handlerIndex = this._geometries.length;\n        this._geometries.push(geometry);\n        this._polyIndexes.push.apply(this._polyIndexes, polyIndexes);\n        this._lineIndexes.push.apply(this._lineIndexes, lineIndexes);\n        this._changedBuffers[POLYINDEXES_BUFFER] = true;\n        this._changedBuffers[LINEINDEXES_BUFFER] = true;\n        !this._updatedGeometry[geometry.__id] && this._updatedGeometryArr.push(geometry);\n        this._updatedGeometry[geometry.__id] = true;\n    }\n    createPolyVerticesBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._polyVerticesHighBufferMerc);\n        this._polyVerticesHighBufferMerc = h.createArrayBuffer(new Float32Array(this._polyVerticesHighMerc), 2, this._polyVerticesHighMerc.length / 2);\n        h.gl.deleteBuffer(this._polyVerticesLowBufferMerc);\n        this._polyVerticesLowBufferMerc = h.createArrayBuffer(new Float32Array(this._polyVerticesLowMerc), 2, this._polyVerticesLowMerc.length / 2);\n    }\n    createPolyIndexesBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._polyIndexesBuffer);\n        this._polyIndexesBuffer = h.createElementArrayBuffer(new Uint32Array(this._polyIndexes), 1, this._polyIndexes.length);\n    }\n    createPolyColorsBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._polyColorsBuffer);\n        this._polyColorsBuffer = h.createArrayBuffer(new Float32Array(this._polyColors), 4, this._polyColors.length / 4);\n    }\n    createPolyPickingColorsBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._polyPickingColorsBuffer);\n        this._polyPickingColorsBuffer = h.createArrayBuffer(new Float32Array(this._polyPickingColors), 4, this._polyPickingColors.length / 4);\n    }\n    createLineVerticesBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineVerticesHighBufferMerc);\n        this._lineVerticesHighBufferMerc = h.createArrayBuffer(new Float32Array(this._lineVerticesHighMerc), 2, this._lineVerticesHighMerc.length / 2);\n        h.gl.deleteBuffer(this._lineVerticesLowBufferMerc);\n        this._lineVerticesLowBufferMerc = h.createArrayBuffer(new Float32Array(this._lineVerticesLowMerc), 2, this._lineVerticesLowMerc.length / 2);\n    }\n    createLineIndexesBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineIndexesBuffer);\n        this._lineIndexesBuffer = h.createElementArrayBuffer(new Uint32Array(this._lineIndexes), 1, this._lineIndexes.length);\n    }\n    createLineOrdersBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineOrdersBuffer);\n        this._lineOrdersBuffer = h.createArrayBuffer(new Float32Array(this._lineOrders), 1, this._lineOrders.length / 2);\n    }\n    createLineColorsBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineColorsBuffer);\n        this._lineColorsBuffer = h.createArrayBuffer(new Float32Array(this._lineColors), 4, this._lineColors.length / 4);\n    }\n    createLinePickingColorsBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._linePickingColorsBuffer);\n        this._linePickingColorsBuffer = h.createArrayBuffer(new Float32Array(this._linePickingColors), 4, this._linePickingColors.length / 4);\n    }\n    createLineThicknessBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineThicknessBuffer);\n        this._lineThicknessBuffer = h.createArrayBuffer(new Float32Array(this._lineThickness), 1, this._lineThickness.length);\n    }\n    createLineStrokesBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineStrokesBuffer);\n        this._lineStrokesBuffer = h.createArrayBuffer(new Float32Array(this._lineStrokes), 1, this._lineStrokes.length);\n    }\n    createLineStrokeColorsBuffer() {\n        let h = this._handler;\n        h.gl.deleteBuffer(this._lineStrokeColorsBuffer);\n        this._lineStrokeColorsBuffer = h.createArrayBuffer(new Float32Array(this._lineStrokeColors), 4, this._lineStrokeColors.length / 4);\n    }\n}\nGeometryHandler.__counter__ = 0;\nexport { GeometryHandler };\n//# sourceMappingURL=GeometryHandler.js.map","class QueueArray {\n    constructor(size = 2048) {\n        this._size = size;\n        this._array = new Array(this._size);\n        this._popIndex = Math.floor(this._size * 0.5);\n        this._shiftIndex = this._popIndex;\n        this.length = 0;\n    }\n    reset() {\n        this._popIndex = Math.floor(this._size * 0.5);\n        this._shiftIndex = this._popIndex;\n        this.length = 0;\n    }\n    clear() {\n        this._array.length = 0;\n        this._array = new Array(this._size);\n        this._popIndex = Math.floor(this._size * 0.5);\n        this._shiftIndex = this._popIndex;\n        this.length = 0;\n    }\n    push(data) {\n        this.length++;\n        this._array[this._popIndex++] = data;\n    }\n    pop() {\n        if (this.length) {\n            this.length--;\n            let res = this._array[--this._popIndex];\n            // @ts-ignore\n            this._array[this._popIndex] = null;\n            if (!this._array[this._popIndex - 1]) {\n                this._popIndex = Math.floor(this._size * 0.5);\n                this._shiftIndex = this._popIndex;\n            }\n            return res;\n        }\n        return undefined;\n    }\n    unshift(data) {\n        this.length++;\n        this._array[--this._shiftIndex] = data;\n    }\n    shift() {\n        if (this.length) {\n            this.length--;\n            let res = this._array[this._shiftIndex];\n            // @ts-ignore\n            this._array[this._shiftIndex++] = null;\n            if (!this._array[this._shiftIndex]) {\n                this._popIndex = Math.floor(this._size * 0.5);\n                this._shiftIndex = this._popIndex;\n            }\n            return res;\n        }\n        return undefined;\n    }\n    forEach(callback) {\n        for (let i = this._shiftIndex; i < this._popIndex; i++) {\n            callback(this._array[i]);\n        }\n    }\n}\nexport { QueueArray };\n//# sourceMappingURL=QueueArray.js.map","import * as math from \"../math\";\nimport * as mercator from \"../mercator\";\nimport * as quadTree from \"../quadTree/quadTree\";\nimport { Entity } from \"../entity/Entity\";\nimport { EntityCollection } from \"../entity/EntityCollection\";\nimport { EntityCollectionNode, EntityCollectionNodeWGS84 } from \"../quadTree/EntityCollectionNode\";\nimport { Extent } from \"../Extent\";\nimport { GeometryHandler } from \"../entity/GeometryHandler\";\nimport { Layer } from \"./Layer\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { QueueArray } from \"../QueueArray\";\n/**\n * Creates entity instance array.\n * @param {Entity[] | IEntityParams[]} entities - Entity array.\n * @returns {Entity[]} - Entity array.\n */\nfunction _entitiesConstructor(entities) {\n    let res = [];\n    for (let i = 0; i < entities.length; i++) {\n        let ei = entities[i];\n        if (ei.instanceName === \"Entity\") {\n            res.push(ei);\n        }\n        else {\n            res.push(new Entity(ei));\n        }\n    }\n    return res;\n}\n/**\n * Vector layer represents alternative entities store. Used for geospatial data rendering like\n * points, lines, polygons, geometry objects etc.\n * @class\n * @extends {Layer}\n * @param {string} [name=\"noname\"] - Layer name.\n * @param {IVectorParams} [options] - Layer options:\n * @param {number} [options.minZoom=0] - Minimal visible zoom. 0 is default\n * @param {number} [options.maxZoom=50] - Maximal visible zoom. 50 is default.\n * @param {string} [options.attribution] - Layer attribution.\n * @param {string} [options.zIndex=0] - Layer Z-order index. 0 is default.\n * @param {boolean} [options.visibility=true] - Layer visibility. True is default.\n * @param {boolean} [options.isBaseLayer=false] - Layer base layer. False is default.\n * @param {Array.<Entity>} [options.entities] - Entities array.\n * @param {Array.<number>} [options.scaleByDistance] - Scale by distance parameters. (exactly 3 entries)\n *      First index - near distance to the entity, after entity becomes full scale.\n *      Second index - far distance to the entity, when entity becomes zero scale.\n *      Third index - far distance to the entity, when entity becomes invisible.\n * @param {number} [options.nodeCapacity=30] - Maximum entities quantity in the tree node. Rendering optimization parameter. 30 is default.\n * @param {boolean} [options.async=true] - Asynchronous vector data handling before rendering. True for optimization huge data.\n * @param {boolean} [options.clampToGround = false] - Clamp vector data to the ground.\n * @param {boolean} [options.relativeToGround = false] - Place vector data relative to the ground relief.\n * @param {Number} [options.polygonOffsetUnits=0.0] - The multiplier by which an implementation-specific value is multiplied with to create a constant depth offset.\n *\n * //@fires EventsHandler<VectorEventsList>#entitymove\n * @fires EventsHandler<VectorEventsList>#draw\n * @fires EventsHandler<VectorEventsList>#add\n * @fires EventsHandler<VectorEventsList>#remove\n * @fires EventsHandler<VectorEventsList>#entityadd\n * @fires EventsHandler<VectorEventsList>#entityremove\n * @fires EventsHandler<VectorEventsList>#visibilitychange\n */\nclass Vector extends Layer {\n    constructor(name, options = {}) {\n        super(name, options);\n        // @ts-ignore\n        this.events = this.events.registerNames(VECTOR_EVENTS);\n        this.isVector = true;\n        this._hasImageryTiles = false;\n        this.scaleByDistance = options.scaleByDistance || [math.MAX32, math.MAX32, math.MAX32];\n        this.pickingScale = options.pickingScale || 1;\n        this.async = options.async !== undefined ? options.async : true;\n        this.clampToGround = options.clampToGround || false;\n        this.relativeToGround = options.relativeToGround || false;\n        this._nodeCapacity = options.nodeCapacity || 30;\n        this._entities = _entitiesConstructor(options.entities || []);\n        this._labelMaxLetters = options.labelMaxLetters || 24;\n        this._stripEntityCollection = new EntityCollection({\n            pickingEnabled: this.pickingEnabled\n        });\n        this._bindEventsDefault(this._stripEntityCollection);\n        this._polylineEntityCollection = new EntityCollection({\n            pickingEnabled: this.pickingEnabled\n        });\n        this._bindEventsDefault(this._polylineEntityCollection);\n        this._geoObjectEntityCollection = new EntityCollection({\n            pickingEnabled: this.pickingEnabled\n        });\n        this._bindEventsDefault(this._geoObjectEntityCollection);\n        this._geometryHandler = new GeometryHandler(this);\n        this._entityCollectionsTree = null;\n        this._entityCollectionsTreeNorth = null;\n        this._entityCollectionsTreeSouth = null;\n        this._renderingNodes = {};\n        this._renderingNodesNorth = {};\n        this._renderingNodesSouth = {};\n        this._counter = 0;\n        this._deferredEntitiesPendingQueue = new QueueArray();\n        this._pendingsQueue = [];\n        this.setEntities(this._entities);\n        this.polygonOffsetUnits = options.polygonOffsetUnits != undefined ? options.polygonOffsetUnits : 0.0;\n        this.pickingEnabled = this._pickingEnabled;\n        this._secondPASS = [];\n    }\n    get labelMaxLetters() {\n        return this._labelMaxLetters;\n    }\n    get instanceName() {\n        return \"Vector\";\n    }\n    _bindPicking() {\n        this._pickingColor.clear();\n    }\n    /**\n     * Adds layer to the planet.\n     * @public\n     * @param {Planet} planet - Planet scene object.\n     * @returns {Vector} -\n     */\n    addTo(planet) {\n        if (!this._planet) {\n            this._assignPlanet(planet);\n            this._geometryHandler.assignHandler(planet.renderer.handler);\n            this._polylineEntityCollection.addTo(planet, true);\n            this._stripEntityCollection.addTo(planet, true);\n            this._geoObjectEntityCollection.addTo(planet, true);\n            this.setEntities(this._entities);\n        }\n    }\n    remove() {\n        super.remove();\n        this._polylineEntityCollection.remove();\n        this._stripEntityCollection.remove();\n        this._geoObjectEntityCollection.remove();\n        return this;\n    }\n    /**\n     * Returns stored entities.\n     * @public\n     * @returns {Array.<Entity>} -\n     */\n    getEntities() {\n        return [].concat(this._entities);\n    }\n    //_fitExtent(entity) {\n    //    var ee = entity.getExtent(),\n    //        e = this._extent,\n    //        maxLon = -180, maxLat = -90,\n    //        minLon = 180, minLat = 90;\n    //    if (this._entities.length !== 0) {\n    //        maxLon = e.southWest.lon;\n    //        minLon = e.northEast.lon;\n    //        maxLat = e.northEast.lat;\n    //        minLat = e.southWest.lat;\n    //    }\n    //    if (ee.southWest.lon < minLon) {\n    //        e.southWest.lon = ee.southWest.lon;\n    //    }\n    //    if (ee.southWest.lat < minLat) {\n    //        e.southWest.lat = ee.southWest.lat;\n    //    }\n    //    if (ee.northEast.lon > maxLon) {\n    //        e.northEast.lon = ee.northEast.lon;\n    //    }\n    //    if (ee.northEast.lat > maxLat) {\n    //        e.northEast.lat = ee.northEast.lat;\n    //    }\n    //    this.setExtent(this._extent);\n    //}\n    /**\n     * Adds entity to the layer.\n     * @public\n     * @param {Entity} entity - Entity.\n     * @param {boolean} [rightNow=false] - Entity insertion option. False is default.\n     * @returns {Vector} - Returns this layer.\n     */\n    add(entity, rightNow = false) {\n        if (!(entity._layer || entity._entityCollection)) {\n            entity._layer = this;\n            entity._layerIndex = this._entities.length;\n            //this._fitExtent(entity);\n            this._entities.push(entity);\n            this._proceedEntity(entity, rightNow);\n        }\n        return this;\n    }\n    /**\n     * Adds entity to the layer in the index position.\n     * @public\n     * @param {Entity} entity - Entity.\n     * @param {Number} index - Index position.\n     * @param {boolean} [rightNow] - Entity insertion option. False is default.\n     * @returns {Vector} - Returns this layer.\n     */\n    insert(entity, index, rightNow = false) {\n        if (!(entity._layer || entity._entityCollection)) {\n            entity._layer = this;\n            entity._layerIndex = index;\n            //this._fitExtent(entity);\n            this._entities.splice(index, 0, entity);\n            for (let i = index + 1, len = this._entities.length; i < len; i++) {\n                this._entities[i]._layerIndex = i;\n            }\n            this._proceedEntity(entity, rightNow);\n        }\n        return this;\n    }\n    _proceedEntity(entity, rightNow = false) {\n        let temp = this._hasImageryTiles;\n        if (entity.strip) {\n            this._stripEntityCollection.add(entity);\n        }\n        if (entity.polyline || entity.ray) {\n            this._polylineEntityCollection.add(entity);\n        }\n        if (entity.geoObject) {\n            this._geoObjectEntityCollection.add(entity);\n        }\n        if (entity.geometry) {\n            this._hasImageryTiles = true;\n            if (this._planet) {\n                this._planet.renderer.assignPickingColor(entity);\n                this._geometryHandler.add(entity.geometry);\n            }\n        }\n        if (entity.billboard || entity.label || entity.geoObject) {\n            if (this._planet) {\n                if (entity._cartesian.isZero() && !entity._lonLat.isZero()) {\n                    entity._setCartesian3vSilent(this._planet.ellipsoid.lonLatToCartesian(entity._lonLat));\n                }\n                else {\n                    entity._lonLat = this._planet.ellipsoid.cartesianToLonLat(entity._cartesian);\n                }\n                // north tree\n                if (entity._lonLat.lat > mercator.MAX_LAT) {\n                    this._entityCollectionsTreeNorth.__setLonLat__(entity);\n                    this._entityCollectionsTreeNorth.insertEntity(entity, rightNow);\n                }\n                else if (entity._lonLat.lat < mercator.MIN_LAT) {\n                    this._entityCollectionsTreeSouth.__setLonLat__(entity);\n                    this._entityCollectionsTreeSouth.insertEntity(entity, rightNow);\n                }\n                else {\n                    this._entityCollectionsTree.__setLonLat__(entity);\n                    this._entityCollectionsTree.insertEntity(entity, rightNow);\n                }\n            }\n        }\n        if (this._planet && this._hasImageryTiles !== temp) {\n            this._planet.updateVisibleLayers();\n        }\n        this.events.dispatch(this.events.entityadd, entity);\n    }\n    /**\n     * Adds entity array to the layer.\n     * @public\n     * @param {Array.<Entity>} entities - Entities array.\n     * @param {boolean} [rightNow=false] - Entity insertion option. False is default.\n     * @returns {Vector} - Returns this layer.\n     */\n    addEntities(entities, rightNow = false) {\n        let i = entities.length;\n        while (i--) {\n            this.add(entities[i], rightNow);\n        }\n        return this;\n    }\n    /**\n     * Remove entity from layer.\n     * TODO: memory leaks.\n     * @public\n     * @param {Entity} entity - Entity to remove.\n     * @returns {Vector} - Returns this layer.\n     */\n    removeEntity(entity) {\n        if (entity._layer && this.isEqual(entity._layer)) {\n            this._entities.splice(entity._layerIndex, 1);\n            this._reindexEntitiesArray(entity._layerIndex);\n            entity._layer = null;\n            entity._layerIndex = -1;\n            if (entity._entityCollection) {\n                entity._entityCollection._removeEntitySilent(entity);\n                let node = entity._nodePtr;\n                while (node) {\n                    node.count--;\n                    node = node.parentNode;\n                }\n                if (entity._nodePtr &&\n                    entity._nodePtr.count === 0 &&\n                    entity._nodePtr.deferredEntities.length === 0) {\n                    entity._nodePtr.entityCollection = null;\n                    //\n                    // ...\n                    //\n                }\n            }\n            else if (entity._nodePtr && entity._nodePtr.deferredEntities.length) {\n                let defEntities = entity._nodePtr.deferredEntities;\n                let j = defEntities.length;\n                while (j--) {\n                    if (defEntities[j].id === entity.id) {\n                        defEntities.splice(j, 1);\n                        let node = entity._nodePtr;\n                        while (node) {\n                            node.count--;\n                            node = node.parentNode;\n                        }\n                        break;\n                    }\n                }\n            }\n            if (entity.geometry) {\n                if (this._planet) {\n                    this._geometryHandler.remove(entity.geometry);\n                    this._planet.renderer.clearPickingColor(entity);\n                }\n            }\n            entity._nodePtr = undefined;\n            this.events.dispatch(this.events.entityremove, entity);\n        }\n        return this;\n    }\n    /**\n     * Set layer picking events active.\n     * @public\n     * @param {boolean} picking - Picking enable flag.\n     */\n    set pickingEnabled(picking) {\n        this._pickingEnabled = picking;\n        this._stripEntityCollection.setPickingEnabled(picking);\n        this._polylineEntityCollection.setPickingEnabled(picking);\n        this._geoObjectEntityCollection.setPickingEnabled(picking);\n        this._entityCollectionsTree && this._entityCollectionsTree.traverseTree((node) => {\n            node.entityCollection.setPickingEnabled(picking);\n        });\n        this._entityCollectionsTreeNorth && this._entityCollectionsTreeNorth.traverseTree((node) => {\n            node.entityCollection.setPickingEnabled(picking);\n        });\n        this._entityCollectionsTreeSouth && this._entityCollectionsTreeSouth.traverseTree((node) => {\n            node.entityCollection.setPickingEnabled(picking);\n        });\n    }\n    /**\n     * Refresh collected entities indexes from startIndex entities collection array position.\n     * @protected\n     * @param {number} startIndex - Entity array index.\n     */\n    _reindexEntitiesArray(startIndex) {\n        const e = this._entities;\n        for (let i = startIndex; i < e.length; i++) {\n            e[i]._layerIndex = i;\n        }\n    }\n    /**\n     * Removes entities from layer.\n     * @public\n     * @param {Array.<Entity>} entities - Entity array.\n     * @returns {Vector} - Returns this layer.\n     */\n    removeEntities(entities) {\n        let i = entities.length;\n        while (i--) {\n            this.removeEntity(entities[i]);\n        }\n        return this;\n    }\n    // public setScaleByDistance(near, far, farInvisible) {\n    //     this.scaleByDistance[0] = near;\n    //     this.scaleByDistance[1] = far;\n    //     this.scaleByDistance[2] = farInvisible || math.MAX32;\n    // }\n    /**\n     * TODO: Clear the layer.\n     * @public\n     */\n    clear() {\n        let temp = new Array(this._entities.length);\n        for (let i = 0; i < temp.length; i++) {\n            temp[i] = this._entities[i];\n        }\n        let i = this._entities.length;\n        while (i--) {\n            this._entities[i].remove();\n        }\n        this._entities.length = 0;\n        this._entities = [];\n        for (let i = 0; i < temp.length; i++) {\n            this._entities[i] = temp[i];\n        }\n        this._entityCollectionsTree = null;\n        this._entityCollectionsTreeNorth = null;\n        this._entityCollectionsTreeSouth = null;\n    }\n    /**\n     * Safety entities loop.\n     * @public\n     * @param {(entity: Entity, index?: number) => void} callback - Entity callback.\n     */\n    each(callback) {\n        let e = this._entities;\n        let i = e.length;\n        while (i--) {\n            callback(e[i], i);\n        }\n    }\n    /**\n     * Removes current entities from layer and adds new entities.\n     * @public\n     * @param {Array.<Entity>} entities - New entity array.\n     * @returns {Vector} - Returns layer instance.\n     */\n    setEntities(entities) {\n        let temp = new Array(entities.length);\n        for (let i = 0, len = entities.length; i < len; i++) {\n            temp[i] = entities[i];\n        }\n        this.clear();\n        this._entities = new Array(temp.length);\n        let entitiesForTree = [];\n        for (let i = 0; i < temp.length; i++) {\n            let ei = temp[i];\n            ei._layer = this;\n            ei._layerIndex = i;\n            if (ei.strip) {\n                this._stripEntityCollection.add(ei);\n            }\n            else if (ei.polyline || ei.ray) {\n                this._polylineEntityCollection.add(ei);\n            }\n            else if (ei.geoObject) {\n                this._geoObjectEntityCollection.add(ei);\n            }\n            else if (ei.billboard || ei.label) {\n                entitiesForTree.push(ei);\n            }\n            if (ei.geometry) {\n                this._hasImageryTiles = true;\n                if (this._planet) {\n                    this._planet.renderer.assignPickingColor(ei);\n                    this._geometryHandler.add(ei.geometry);\n                }\n            }\n            this._entities[i] = ei;\n        }\n        this._createEntityCollectionsTree(entitiesForTree);\n        return this;\n    }\n    /**\n     * @todo: replace to a strategy node collecting algorithm\n     */\n    _createEntityCollectionsTree(entitiesForTree) {\n        if (this._planet) {\n            this._entityCollectionsTree = new EntityCollectionNode(this, quadTree.NW, null, 0, Extent.createFromArray([-20037508.34, -20037508.34, 20037508.34, 20037508.34]), this._planet, 0);\n            this._entityCollectionsTreeNorth = new EntityCollectionNodeWGS84(this, quadTree.NW, null, 0, Extent.createFromArray([-180, mercator.MAX_LAT, 180, 90]), this._planet, 0);\n            this._entityCollectionsTreeSouth = new EntityCollectionNodeWGS84(this, quadTree.NW, null, 0, Extent.createFromArray([-180, -90, 180, mercator.MIN_LAT]), this._planet, 0);\n            for (let i = 0, len = entitiesForTree.length; i < len; i++) {\n                let entity = entitiesForTree[i];\n                // north tree\n                if (entity._lonLat.lat > mercator.MAX_LAT) {\n                    this._entityCollectionsTreeNorth.__setLonLat__(entity);\n                }\n                else if (entity._lonLat.lat < mercator.MIN_LAT) {\n                    // south tree\n                    this._entityCollectionsTreeSouth.__setLonLat__(entity);\n                }\n                else {\n                    this._entityCollectionsTree.__setLonLat__(entity);\n                }\n            }\n            this._entityCollectionsTree.buildTree(entitiesForTree);\n            this._entityCollectionsTreeNorth.buildTree(entitiesForTree);\n            this._entityCollectionsTreeSouth.buildTree(entitiesForTree);\n        }\n    }\n    /**\n     * @todo (refactoring) could be used in somethig like bindEntityCollectionQuad(...)\n     * @param entityCollection\n     */\n    _bindEventsDefault(entityCollection) {\n        let ve = this.events;\n        //\n        // @todo: replace with arrow functions and '...e'\n        //\n        // entityCollection.events.on(\"entitymove\", (e: any) => {\n        //     ve.dispatch(ve.entitymove, e);\n        // });\n        entityCollection.events.on(\"mousemove\", (e) => {\n            ve.dispatch(ve.mousemove, e);\n        });\n        entityCollection.events.on(\"mouseenter\", (e) => {\n            ve.dispatch(ve.mouseenter, e);\n        });\n        entityCollection.events.on(\"mouseleave\", (e) => {\n            ve.dispatch(ve.mouseleave, e);\n        });\n        entityCollection.events.on(\"lclick\", (e) => {\n            ve.dispatch(ve.lclick, e);\n        });\n        entityCollection.events.on(\"rclick\", (e) => {\n            ve.dispatch(ve.rclick, e);\n        });\n        entityCollection.events.on(\"mclick\", (e) => {\n            ve.dispatch(ve.mclick, e);\n        });\n        entityCollection.events.on(\"ldblclick\", (e) => {\n            ve.dispatch(ve.ldblclick, e);\n        });\n        entityCollection.events.on(\"rdblclick\", (e) => {\n            ve.dispatch(ve.rdblclick, e);\n        });\n        entityCollection.events.on(\"mdblclick\", (e) => {\n            ve.dispatch(ve.mdblclick, e);\n        });\n        entityCollection.events.on(\"lup\", (e) => {\n            ve.dispatch(ve.lup, e);\n        });\n        entityCollection.events.on(\"rup\", (e) => {\n            ve.dispatch(ve.rup, e);\n        });\n        entityCollection.events.on(\"mup\", (e) => {\n            ve.dispatch(ve.mup, e);\n        });\n        entityCollection.events.on(\"ldown\", (e) => {\n            ve.dispatch(ve.ldown, e);\n        });\n        entityCollection.events.on(\"rdown\", (e) => {\n            ve.dispatch(ve.rdown, e);\n        });\n        entityCollection.events.on(\"mdown\", (e) => {\n            ve.dispatch(ve.mdown, e);\n        });\n        entityCollection.events.on(\"lhold\", (e) => {\n            ve.dispatch(ve.lhold, e);\n        });\n        entityCollection.events.on(\"rhold\", (e) => {\n            ve.dispatch(ve.rhold, e);\n        });\n        entityCollection.events.on(\"mhold\", (e) => {\n            ve.dispatch(ve.mhold, e);\n        });\n        entityCollection.events.on(\"mousewheel\", (e) => {\n            ve.dispatch(ve.mousewheel, e);\n        });\n        entityCollection.events.on(\"touchmove\", (e) => {\n            ve.dispatch(ve.touchmove, e);\n        });\n        entityCollection.events.on(\"touchstart\", (e) => {\n            ve.dispatch(ve.touchstart, e);\n        });\n        entityCollection.events.on(\"touchend\", (e) => {\n            ve.dispatch(ve.touchend, e);\n        });\n        entityCollection.events.on(\"doubletouch\", (e) => {\n            ve.dispatch(ve.doubletouch, e);\n        });\n        entityCollection.events.on(\"touchleave\", (e) => {\n            ve.dispatch(ve.touchleave, e);\n        });\n        entityCollection.events.on(\"touchenter\", (e) => {\n            ve.dispatch(ve.touchenter, e);\n        });\n    }\n    _collectStripCollectionPASS(outArr) {\n        let ec = this._stripEntityCollection;\n        ec._fadingOpacity = this._fadingOpacity;\n        ec.scaleByDistance = this.scaleByDistance;\n        ec.pickingScale = this.pickingScale;\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\n        outArr.push(ec);\n    }\n    _collectPolylineCollectionPASS(outArr) {\n        let ec = this._polylineEntityCollection;\n        ec._fadingOpacity = this._fadingOpacity;\n        ec.scaleByDistance = this.scaleByDistance;\n        ec.pickingScale = this.pickingScale;\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\n        outArr.push(ec);\n        if (this.clampToGround || this.relativeToGround) {\n            let rtg = Number(this.relativeToGround);\n            const nodes = this._planet._renderedNodes;\n            const visibleExtent = this._planet.getViewExtent();\n            let e = ec._entities;\n            let e_i = e.length;\n            let res = new Vec3();\n            while (e_i--) {\n                let p = e[e_i].polyline;\n                if (p && visibleExtent.overlaps(p._extent)) {\n                    // TODO:this works only for mercator area.\n                    // needs to be working on poles.\n                    let coords = p._pathLonLatMerc, c_j = coords.length;\n                    while (c_j--) {\n                        let c_j_h = coords[c_j].length;\n                        while (c_j_h--) {\n                            let ll = coords[c_j][c_j_h], n_k = nodes.length;\n                            while (n_k--) {\n                                let seg = nodes[n_k].segment;\n                                if (seg._extent.isInside(ll)) {\n                                    let cart = p._path3v[c_j][c_j_h];\n                                    seg.getTerrainPoint(cart, ll, res);\n                                    let alt = (rtg && p.altitude) || 0.0;\n                                    if (alt) {\n                                        let n = this._planet.ellipsoid.getSurfaceNormal3v(res);\n                                        p.setPoint3v(res.addA(n.scale(alt)), c_j_h, c_j, true);\n                                    }\n                                    else {\n                                        p.setPoint3v(res, c_j_h, c_j, true);\n                                    }\n                                    break;\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n    _collectGeoObjectCollectionPASS(outArr) {\n        let ec = this._geoObjectEntityCollection;\n        ec._fadingOpacity = this._fadingOpacity;\n        ec.scaleByDistance = this.scaleByDistance;\n        ec.pickingScale = this.pickingScale;\n        ec.polygonOffsetUnits = this.polygonOffsetUnits;\n        outArr.push(ec);\n        // if (this.clampToGround || this.relativeToGround) {\n        //     let rtg = Number(this.relativeToGround);\n        //\n        //     var nodes = this._planet._renderedNodes;\n        //     var visibleExtent = this._planet.getViewExtent();\n        //     var e = ec._entities;\n        //     var e_i = e.length;\n        //     let res = new Vec3();\n        //\n        //     while (e_i--) {\n        //         var p = e[e_i].polyline;\n        //         if (visibleExtent.overlaps(p._extent)) {\n        //             // TODO:this works only for mercator area.\n        //             // needs to be working on poles.\n        //             let coords = p._pathLonLatMerc,\n        //                 c_j = coords.length;\n        //             while (c_j--) {\n        //                 var c_j_h = coords[c_j].length;\n        //                 while (c_j_h--) {\n        //                     let ll = coords[c_j][c_j_h],\n        //                         n_k = nodes.length;\n        //                     while (n_k--) {\n        //                         var seg = nodes[n_k].segment;\n        //                         if (seg._extent.isInside(ll)) {\n        //                             let cart = p._path3v[c_j][c_j_h];\n        //                             seg.getTerrainPoint(cart, ll, res);\n        //                             p.setPoint3v(\n        //                                 res.addA(res.normal().scale((rtg && p.altitude) || 0.0)),\n        //                                 c_j_h,\n        //                                 c_j,\n        //                                 true\n        //                             );\n        //                             break;\n        //                         }\n        //                     }\n        //                 }\n        //             }\n        //         }\n        //     }\n        // }\n    }\n    collectVisibleCollections(outArr) {\n        let p = this._planet;\n        if ((this._fading && this._fadingOpacity > 0.0) ||\n            (this.minZoom <= p.maxCurrZoom && this.maxZoom >= p.maxCurrZoom)) {\n            this._renderingNodes = {};\n            this._renderingNodesNorth = {};\n            this._renderingNodesSouth = {};\n            // Common collections first\n            this._collectStripCollectionPASS(outArr);\n            this._collectPolylineCollectionPASS(outArr);\n            this._collectGeoObjectCollectionPASS(outArr);\n            // Merc nodes\n            this._secondPASS = [];\n            this._entityCollectionsTree && this._entityCollectionsTree.collectRenderCollectionsPASS1(p._visibleNodes, outArr);\n            let i = this._secondPASS.length;\n            while (i--) {\n                this._secondPASS[i].collectRenderCollectionsPASS2(p._visibleNodes, outArr, this._secondPASS[i].nodeId);\n            }\n            // North nodes\n            this._secondPASS = [];\n            this._entityCollectionsTreeNorth && this._entityCollectionsTreeNorth.collectRenderCollectionsPASS1(p._visibleNodesNorth, outArr);\n            i = this._secondPASS.length;\n            while (i--) {\n                this._secondPASS[i].collectRenderCollectionsPASS2(p._visibleNodesNorth, outArr, this._secondPASS[i].nodeId);\n            }\n            // South nodes\n            this._secondPASS = [];\n            this._entityCollectionsTreeSouth && this._entityCollectionsTreeSouth.collectRenderCollectionsPASS1(p._visibleNodesSouth, outArr);\n            i = this._secondPASS.length;\n            while (i--) {\n                this._secondPASS[i].collectRenderCollectionsPASS2(p._visibleNodesSouth, outArr, this._secondPASS[i].nodeId);\n            }\n        }\n    }\n    _queueDeferredNode(node) {\n        if (this._visibility) {\n            node._inTheQueue = true;\n            if (this._counter >= 1) {\n                this._deferredEntitiesPendingQueue.push(node);\n            }\n            else {\n                this._execDeferredNode(node);\n            }\n        }\n    }\n    _execDeferredNode(node) {\n        this._counter++;\n        setTimeout(() => {\n            node.applyCollection();\n            this._counter--;\n            if (this._deferredEntitiesPendingQueue.length && this._counter < 1) {\n                while (this._deferredEntitiesPendingQueue.length) {\n                    let n = this._deferredEntitiesPendingQueue.pop();\n                    n._inTheQueue = false;\n                    if (n.isVisible()) {\n                        this._execDeferredNode(n);\n                        return;\n                    }\n                }\n            }\n        }, 0);\n    }\n    /**\n     * Start to load tile material.\n     * @public\n     * @virtual\n     * @param {Material} material - Current material.\n     */\n    loadMaterial(material) {\n        const seg = material.segment;\n        if (this._isBaseLayer) {\n            material.texture = seg._isNorth ? seg.planet.solidTextureOne : seg.planet.solidTextureTwo;\n        }\n        else {\n            material.texture = seg.planet.transparentTexture;\n        }\n        if (this._planet.layerLock.isFree()) {\n            material.isReady = false;\n            material.isLoading = true;\n            this._planet._vectorTileCreator.add(material);\n        }\n    }\n    /**\n     * Abort exact material loading.\n     * @public\n     * @override\n     * @param {Material} material - Segment material.\n     */\n    abortMaterialLoading(material) {\n        material.isLoading = false;\n        material.isReady = false;\n    }\n    applyMaterial(material, isForced = false) {\n        if (material.isReady) {\n            return [0, 0, 1, 1];\n        }\n        else {\n            !material.isLoading && this.loadMaterial(material);\n            const segment = material.segment;\n            let pn = segment.node, notEmpty = false;\n            let mId = this.__id;\n            let psegm = material;\n            while (pn.parentNode) {\n                if (psegm && psegm.isReady) {\n                    notEmpty = true;\n                    break;\n                }\n                pn = pn.parentNode;\n                psegm = pn.segment.materials[mId];\n            }\n            if (notEmpty) {\n                material.appliedNodeId = pn.nodeId;\n                material.texture = psegm.texture;\n                material.pickingMask = psegm.pickingMask;\n                const dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\n                return [\n                    segment.tileX * dZ2 - pn.segment.tileX,\n                    segment.tileY * dZ2 - pn.segment.tileY,\n                    dZ2,\n                    dZ2\n                ];\n            }\n            else {\n                if (material.textureExists && material._updateTexture) {\n                    material.texture = material._updateTexture;\n                    material.pickingMask = material._updatePickingMask;\n                }\n                else {\n                    material.texture = segment.planet.transparentTexture;\n                    material.pickingMask = segment.planet.transparentTexture;\n                }\n                material.pickingReady = true;\n                return [0, 0, 1, 1];\n            }\n        }\n    }\n    clearMaterial(material) {\n        if (material.isReady) {\n            const gl = material.segment.handler.gl;\n            material.isReady = false;\n            material.pickingReady = false;\n            let t = material.texture;\n            material.texture = null;\n            t && !t.default && gl.deleteTexture(t);\n            t = material.pickingMask;\n            material.pickingMask = null;\n            t && !t.default && gl.deleteTexture(t);\n            t = material._updateTexture;\n            material._updateTexture = null;\n            t && !t.default && gl.deleteTexture(t);\n            t = material._updatePickingMask;\n            material._updatePickingMask = null;\n            t && !t.default && gl.deleteTexture(t);\n        }\n        this.abortMaterialLoading(material);\n        material.isLoading = false;\n        material.textureExists = false;\n    }\n    update() {\n        this._geometryHandler.update();\n        this.events.dispatch(this.events.draw, this);\n    }\n}\nconst VECTOR_EVENTS = [\n    // /**\n    //  * Triggered when entity has moved.\n    //  * @event EventsHandler<VectorEventsList>#draw\n    //  */\n    // \"entitymove\",\n    /**\n     * Triggered when layer begin draw.\n     * @event EventsHandler<VectorEventsList>#draw\n     */\n    \"draw\",\n    /**\n     * Triggered when new entity added to the layer.\n     * @event EventsHandler<VectorEventsList>#entityadd\n     */\n    \"entityadd\",\n    /**\n     * Triggered when entity removes from the collection.\n     * @event EventsHandler<VectorEventsList>#entityremove\n     */\n    \"entityremove\"\n];\nexport { Vector };\n//# sourceMappingURL=Vector.js.map","import * as math from \"../../math\";\nimport { createEvents } from '../../Events';\nimport { Entity } from '../../entity/Entity';\nimport { LonLat } from '../../LonLat';\nimport { Line3 } from '../../math/Line3';\nimport { Object3d } from '../../Object3d';\nimport { RenderNode } from '../../scene/RenderNode';\nimport { Vec2 } from '../../math/Vec2';\nimport { Vec3 } from '../../math/Vec3';\nimport { Vector } from '../../layer/Vector';\nconst POLYGONDRAWINGSCENE_EVENTS = [\"change\", \"startpoint\"];\nconst POINTER_OBJ3D = Object3d.createCylinder(1, 1, 2.0, 20, 1, true, false, 0, -0.5, 0);\nexport const NUM_SEGMENTS = 200;\nexport const OUTLINE_ALT = 0.3;\nexport const COORDINATES_COLOR = \"rgb(350, 350, 0)\";\nexport const CENTER_COLOR = \"rgb(0, 350, 50)\";\nexport const OUTLINE_COLOR = \"rgb(0, 350, 50)\";\nexport const OUTLINE_THICKNESS = 3.5;\nexport const CORNER_OPTIONS = {\n    scale: 0.5,\n    instanced: true,\n    tag: \"corners\",\n    color: COORDINATES_COLOR,\n    object3d: POINTER_OBJ3D\n};\nexport const CENTER_OPTIONS = {\n    scale: 0.4,\n    instanced: true,\n    tag: \"centers\",\n    color: CENTER_COLOR,\n    object3d: POINTER_OBJ3D\n};\nexport const OUTLINE_OPTIONS = {\n    thickness: OUTLINE_THICKNESS,\n    color: OUTLINE_COLOR\n};\nclass PolygonDrawingScene extends RenderNode {\n    constructor(options) {\n        super(options.name);\n        this._cornerDblClick = false;\n        this._onChange = (e) => {\n            if (e.geometryType === \"Polygon\") {\n                let coords = this.getCoordinates();\n                let entity = new Entity({\n                    'geometry': {\n                        'type': e.geometryType,\n                        'coordinates': [coords],\n                        'style': {\n                            'fillColor': \"rgba(0,146,247,0.2)\"\n                        }\n                    }\n                });\n                this._geometryLayer.clear();\n                this._geometryLayer.add(entity);\n            }\n        };\n        this._onCornerMouseEnter = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"pointer\";\n            this.hideGhostPointer();\n        };\n        this._onCornerMouseLeave = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"default\";\n            this.showGhostPointer();\n        };\n        this._onCenterMouseEnter = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"pointer\";\n            this.hideGhostPointer();\n        };\n        this._onCenterMouseLeave = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"default\";\n            if (!(this._pickedCenter || this._pickedCorner)) {\n                this.showGhostPointer();\n            }\n        };\n        this._onLup = (e) => {\n            this._planet.renderer.controls.mouseNavigation.activate();\n            if (this._pickedCorner || this._pickedCenter) {\n                this.events.dispatch(this.events.change, this);\n                this.setGhostPointerPosition(this._planet.getCartesianFromPixelTerrain(e));\n                this.showGhostPointer();\n                this._pickedCorner = null;\n                this._pickedCenter = null;\n            }\n        };\n        this._onCornerLdown = (e) => {\n            this._pickedCorner = this._getLdown(e);\n        };\n        this._onCenterLdown = (e) => {\n            this._pickedCenter = this._getLdown(e);\n        };\n        this._onMouseMove = (e) => {\n            if (this._pickedCenter) {\n                this._moveCenterPoint();\n            }\n            else if (this._pickedCorner) {\n                this._moveCornerPoint(e.pos);\n            }\n            else {\n                this.setGhostPointerPosition(this._planet.getCartesianFromPixelTerrain(e.pos));\n            }\n        };\n        this._onCornerLdblclick = (e) => {\n            this._cornerDblClick = true;\n            let coords = this.getCoordinates();\n            coords.splice(e.pickingObject.layerIndex, 1);\n            this.setCoordinates(coords);\n        };\n        this._onMouseDblClick = (e) => {\n            if (this._cornerDblClick) {\n                this._cornerDblClick = false;\n                return;\n            }\n            if (!this._showGhostPointer) {\n                return;\n            }\n            let cart = this._planet.getCartesianFromPixelTerrain(e);\n            if (cart) {\n                this._addNew(cart);\n                if (!this._isStartPoint && this._cornerLayer.getEntities().length > 2) {\n                    this._isStartPoint = true;\n                    this.events.dispatch(this.events.startpoint, this);\n                }\n                this.events.dispatch(this.events.change, this);\n            }\n        };\n        this.events = createEvents(POLYGONDRAWINGSCENE_EVENTS);\n        this._planet = null;\n        this._initCoordinates = options.coordinates || [];\n        this._pickedCorner = null;\n        this._pickedCenter = null;\n        this._startPos = null;\n        this._startClick = new Vec2();\n        this._geometryLayer = new Vector();\n        //\n        // outline vectors\n        //\n        this._cornerLayer = new Vector(\"corners\", {\n            pickingScale: 3,\n            pickingEnabled: true,\n            polygonOffsetUnits: -5,\n            relativeToGround: true,\n            scaleByDistance: [100, 4000000, 1.0]\n        });\n        this._centerLayer = new Vector(\"centers\", {\n            pickingScale: 3,\n            pickingEnabled: true,\n            polygonOffsetUnits: -5,\n            relativeToGround: true,\n            scaleByDistance: [100, 4000000, 1.0]\n        });\n        this._outlineLayer = new Vector(\"outline\", {\n            entities: [new Entity({\n                    polyline: {\n                        path3v: [],\n                        isClosed: false,\n                        ...OUTLINE_OPTIONS\n                    }\n                })],\n            pickingEnabled: false,\n            polygonOffsetUnits: -5,\n            relativeToGround: true\n        });\n        this._outlineLayer.getEntities()[0].polyline.altitude = OUTLINE_ALT;\n        //\n        // Ghost cursor pointer\n        //\n        this._ghostCorner = new Entity({\n            geoObject: CORNER_OPTIONS\n        });\n        this._ghostOutlineLayer = new Vector(\"ghost-pointer\", {\n            pickingEnabled: false,\n            polygonOffsetUnits: -5,\n            relativeToGround: true,\n            scaleByDistance: [100, 4000000, 1.0],\n            opacity: 0.5\n        });\n        this._showGhostPointer = false;\n        this._isStartPoint = false;\n        this._insertCornerIndex = -1;\n    }\n    get geometryType() {\n        return \"Polygon\";\n    }\n    getCoordinates() {\n        let corners = this._cornerLayer.getEntities();\n        if (corners.length > 0) {\n            return corners.map((c) => {\n                let ll = c.getLonLat();\n                return [ll.lon, ll.lat, ll.height];\n            });\n        }\n        else {\n            return this._initCoordinates;\n        }\n    }\n    bindPlanet(planet) {\n        this._planet = planet;\n    }\n    init() {\n        this._initEvents();\n        this._initGhostLayerPointer();\n        if (this._initCoordinates.length) {\n            this.setCoordinates(this._initCoordinates);\n        }\n        this._planet.addLayer(this._outlineLayer);\n        this._planet.addLayer(this._cornerLayer);\n        this._planet.addLayer(this._centerLayer);\n        this.showGhostPointer();\n        this.startNewPoint();\n        this._planet.renderer.controls.mouseNavigation.deactivateDoubleClickZoom();\n        this._geometryLayer.addTo(this._planet);\n        this.events.on(\"change\", this._onChange, this);\n    }\n    onremove() {\n        this._clearEvents();\n        this.hideGhostPointer();\n        this.stopNewPoint();\n        this.clear();\n        this._geometryLayer.remove();\n    }\n    clear() {\n        this._geometryLayer.clear();\n        let corners = this._cornerLayer.getEntities();\n        let i = corners.length;\n        while (i--) {\n            corners[i].remove();\n        }\n        let centers = this._centerLayer.getEntities();\n        i = centers.length;\n        while (i--) {\n            centers[i].remove();\n        }\n        let entities = this._outlineLayer.getEntities();\n        i = entities.length;\n        while (i--) {\n            entities[i].polyline.clear();\n            if (i > 0) {\n                entities[i].remove();\n            }\n        }\n        this._clearGhostPointer();\n    }\n    setCoordinates(coords) {\n        this.clear();\n        for (let i = 0; i < coords.length; i++) {\n            let ci = coords[i];\n            let cart = this._planet.ellipsoid.lonLatToCartesian(new LonLat(ci[0], ci[1], ci[2]));\n            this._appendCart(cart);\n        }\n        this.events.dispatch(this.events.change, this);\n    }\n    stopNewPoint() {\n        if (this.renderer) {\n            this.renderer.events.off(\"ldblclick\", this._onMouseDblClick);\n        }\n    }\n    startNewPoint() {\n        this.renderer.events.on(\"ldblclick\", this._onMouseDblClick, this);\n    }\n    showGhostPointer() {\n        this._showGhostPointer = true;\n        this._planet.addLayer(this._ghostOutlineLayer);\n        this._insertCornerIndex = this._cornerLayer.getEntities().length;\n    }\n    hideGhostPointer() {\n        this._showGhostPointer = false;\n        this._ghostOutlineLayer.remove();\n        this._insertCornerIndex = -1;\n    }\n    setGhostPointerPosition(groundPos) {\n        if (groundPos) {\n            this._ghostCorner.setCartesian3v(groundPos);\n            this._updateGhostOutlinePointer(groundPos);\n        }\n    }\n    _getLdown(e) {\n        this._planet.renderer.controls.mouseNavigation.deactivate();\n        this._startClick.set(e.x, e.y);\n        let coords = e.pickingObject.getCartesian();\n        this._startPos = this._planet.getPixelFromCartesian(coords);\n        return e.pickingObject;\n    }\n    _initEvents() {\n        this._cornerLayer.events.on(\"ldblclick\", this._onCornerLdblclick, this);\n        this._cornerLayer.events.on(\"ldown\", this._onCornerLdown, this);\n        this._centerLayer.events.on(\"ldown\", this._onCenterLdown, this);\n        this.renderer.events.on(\"lup\", this._onLup, this);\n        this.renderer.events.on(\"mousemove\", this._onMouseMove, this);\n        this._cornerLayer.events.on(\"mouseenter\", this._onCornerMouseEnter, this);\n        this._cornerLayer.events.on(\"mouseleave\", this._onCornerMouseLeave, this);\n        this._centerLayer.events.on(\"mouseenter\", this._onCenterMouseEnter, this);\n        this._centerLayer.events.on(\"mouseleave\", this._onCenterMouseLeave, this);\n    }\n    _clearEvents() {\n        this._cornerLayer.events.off(\"ldblclick\", this._onCornerLdblclick);\n        this._cornerLayer.events.off(\"ldown\", this._onCornerLdown);\n        this._centerLayer.events.off(\"ldown\", this._onCenterLdown);\n        this.renderer.events.off(\"lup\", this._onLup);\n        this.renderer.events.off(\"mousemove\", this._onMouseMove);\n        this._cornerLayer.events.off(\"mouseenter\", this._onCornerMouseEnter);\n        this._cornerLayer.events.off(\"mouseleave\", this._onCornerMouseLeave);\n        this._centerLayer.events.off(\"mouseenter\", this._onCenterMouseEnter);\n        this._centerLayer.events.off(\"mouseleave\", this._onCenterMouseLeave);\n    }\n    _drawCorners() {\n        let corners = this._cornerLayer.getEntities();\n        for (let i = 0; i < corners.length; i++) {\n            let ai = corners[i];\n            this._checkTerrainCollision(ai);\n        }\n    }\n    _drawCenters() {\n        let centers = this._centerLayer.getEntities();\n        for (let i = 0; i < centers.length; i++) {\n            let ai = centers[i];\n            this._checkTerrainCollision(ai);\n        }\n    }\n    _drawGhostCorner() {\n        if (this._showGhostPointer) {\n            this._checkTerrainCollision(this._ghostCorner);\n        }\n    }\n    frame() {\n        this._drawCorners();\n        this._drawCenters();\n        this._drawGhostCorner();\n    }\n    _checkTerrainCollision(entity) {\n        let _tempTerrPoint = new Vec3();\n        let nodes = this._planet._renderedNodes;\n        for (let j = 0; j < nodes.length; j++) {\n            let seg = nodes[j].segment;\n            if (seg && seg._extentLonLat.isInside(entity.getLonLat())) {\n                seg.getEntityTerrainPoint(entity, _tempTerrPoint);\n                entity.setCartesian3v(_tempTerrPoint);\n                break;\n            }\n        }\n    }\n    _moveCenterPoint() {\n        let coords = this.getCoordinates(), index = this._pickedCenter.layerIndex + 1, ll = this._pickedCenter.getLonLat();\n        let newCorner = [ll.lon, ll.lat, ll.height];\n        coords.splice(index, 0, newCorner);\n        this.setCoordinates(coords);\n        this._pickedCenter = null;\n        this._pickedCorner = this._cornerLayer.getEntities()[index];\n    }\n    _addNew(cart) {\n        if (this._insertCornerIndex === -1 || this._cornerLayer.getEntities().length < 2) {\n            this._appendCart(cart);\n        }\n        else {\n            let area = this.getCoordinates(), index = this._insertCornerIndex;\n            let ll = this._planet.ellipsoid.cartesianToLonLat(cart);\n            let newCorner = [ll.lon, ll.lat, ll.height];\n            area.splice(index, 0, newCorner);\n            this.clear();\n            this.setCoordinates(area);\n        }\n    }\n    _appendCart(cart) {\n        let corners = this._cornerLayer.getEntities();\n        let segNum = corners.length - 1;\n        let prevCorn = corners[segNum];\n        let corner = new Entity({\n            geoObject: CORNER_OPTIONS,\n        });\n        corner.setCartesian3v(cart);\n        corner.addTo(this._cornerLayer);\n        this._checkTerrainCollision(corner);\n        if (prevCorn) {\n            let firstCart = corners[0].getCartesian(), prevCart = prevCorn.getCartesian();\n            let vecPrev = corner.getCartesian().sub(prevCart), vecFirst = corner.getCartesian().sub(firstCart);\n            let distPrev = vecPrev.length(), distFirst = vecFirst.length();\n            vecPrev.normalize();\n            vecFirst.normalize();\n            let prevPath = [], firstPath = [];\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(prevCart);\n                prevPath.push(p);\n                let f = vecFirst.scaleTo(i * distFirst / NUM_SEGMENTS).addA(firstCart);\n                firstPath.push(f);\n            }\n            this._outlineLayer.getEntities()[0].polyline.setPath3v([firstPath]);\n            let entity = new Entity({\n                polyline: {\n                    path3v: [prevPath],\n                    isClosed: false,\n                    ...OUTLINE_OPTIONS\n                }\n            });\n            entity.polyline.altitude = OUTLINE_ALT;\n            this._outlineLayer.add(entity);\n            let centers = this._centerLayer.getEntities();\n            let firstCenter = centers[centers.length - 1];\n            let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(prevCart), firstCenterCart = vecFirst.scaleTo(distFirst * 0.5).addA(firstCart);\n            let center = new Entity({\n                geoObject: CENTER_OPTIONS,\n            });\n            center.setCartesian3v(prevCenterCart);\n            center.addTo(this._centerLayer);\n            this._checkTerrainCollision(center);\n            //moveToEnd\n            firstCenter.remove();\n            firstCenter.addTo(this._centerLayer);\n            firstCenter.setCartesian3v(firstCenterCart);\n        }\n        else {\n            let center = new Entity({\n                geoObject: CENTER_OPTIONS,\n            });\n            center.addTo(this._centerLayer);\n        }\n    }\n    _clearGhostPointer() {\n        const g = this._ghostOutlineLayer;\n        g.getEntities()[0].polyline.clear();\n        g.getEntities()[1].polyline.clear();\n    }\n    _moveCornerPoint(e) {\n        let d = new Vec2(e.x, e.y).sub(this._startClick), p = this._startPos.add(d);\n        let groundCoords = this._planet.getCartesianFromPixelTerrain(p);\n        if (groundCoords) {\n            this._pickedCorner.setCartesian3v(groundCoords);\n            let corners = this._cornerLayer.getEntities();\n            if (corners.length) {\n                let ind = this._pickedCorner.layerIndex;\n                let size = corners.length;\n                let cartPrev = corners[ind === 0 ? (size - 1) : (ind - 1)].getCartesian(), cartNext = corners[(ind + 1) % size].getCartesian();\n                let vecPrev = this._pickedCorner.getCartesian().sub(cartPrev), vecNext = this._pickedCorner.getCartesian().sub(cartNext);\n                let distPrev = vecPrev.length(), distNext = vecNext.length();\n                vecPrev.normalize();\n                vecNext.normalize();\n                let pathPrev = [], pathNext = [];\n                for (let i = 0; i <= NUM_SEGMENTS; i++) {\n                    let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\n                    pathPrev.push(p);\n                    let f = vecNext.scaleTo(i * distNext / NUM_SEGMENTS).addA(cartNext);\n                    pathNext.push(f);\n                }\n                let entities = this._outlineLayer.getEntities();\n                let prevPolyline = entities[ind].polyline, nextPolyline = entities[(ind + 1) % size].polyline;\n                prevPolyline?.setPath3v([pathPrev]);\n                nextPolyline?.setPath3v([pathNext]);\n                //\n                // Move center points\n                let centers = this._centerLayer.getEntities();\n                let prevCenter = centers[ind === 0 ? (size - 1) : (ind - 1)], nextCenter = centers[ind];\n                let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(cartPrev), nextCenterCart = vecNext.scaleTo(distNext * 0.5).addA(cartNext);\n                prevCenter.setCartesian3v(prevCenterCart);\n                this._checkTerrainCollision(prevCenter);\n                nextCenter.setCartesian3v(nextCenterCart);\n                this._checkTerrainCollision(nextCenter);\n            }\n        }\n    }\n    _updateGhostOutlinePointer(groundPos) {\n        let corners = this._cornerLayer.getEntities();\n        let size = corners.length;\n        if (size > 0) {\n            let ind = 0;\n            let minDist = math.MAX;\n            for (let i = 0; i < size; i++) {\n                let ci = corners[i];\n                let dist = ci.getCartesian().distance(groundPos);\n                if (dist < minDist) {\n                    minDist = dist;\n                    ind = i;\n                }\n            }\n            let cCurr = corners[ind].getCartesian(), cNext = corners[(ind + 1) % size].getCartesian(), cPrev = corners[ind === 0 ? (size - 1) : (ind - 1)].getCartesian();\n            let nPrev = cPrev.sub(cCurr).normalize(), nNext = cNext.sub(cCurr).normalize(), nGround = groundPos.sub(cCurr).normalize();\n            let midVec = nPrev.add(nNext).normalize();\n            let toMid = nGround.cross(midVec), up = nPrev.cross(nNext);\n            if (toMid.dot(up) > 0) {\n                ind--;\n                if (ind < 0) {\n                    ind = size - 1;\n                }\n            }\n            let temp = new Vec3();\n            for (let i = 0; i < size; i++) {\n                let side = new Line3(corners[i].getCartesian(), corners[(i + 1) % size].getCartesian());\n                let u = side.getNearestDistancePoint(groundPos, temp);\n                if (u) {\n                    let dist = temp.distance(groundPos);\n                    if (dist < minDist) {\n                        minDist = dist;\n                        ind = i;\n                    }\n                }\n            }\n            this._insertCornerIndex = (ind + 1) % size;\n            let cartPrev = corners[ind % size].getCartesian(), cartNext = corners[(ind + 1) % size].getCartesian();\n            let vecPrev = this._ghostCorner.getCartesian().sub(cartPrev), vecNext = this._ghostCorner.getCartesian().sub(cartNext);\n            let distPrev = vecPrev.length(), distNext = vecNext.length();\n            vecPrev.normalize();\n            vecNext.normalize();\n            let pathPrev = [], pathNext = [];\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\n                pathPrev.push(p);\n                let f = vecNext.scaleTo(i * distNext / NUM_SEGMENTS).addA(cartNext);\n                pathNext.push(f);\n            }\n            let entities = this._ghostOutlineLayer.getEntities();\n            let prevPolyline = entities[0].polyline, nextPolyline = entities[1].polyline;\n            prevPolyline?.setPath3v([pathPrev]);\n            nextPolyline?.setPath3v([pathNext]);\n        }\n    }\n    _initGhostLayerPointer() {\n        this._ghostOutlineLayer.setEntities([\n            new Entity({\n                polyline: {\n                    path3v: [],\n                    isClosed: false,\n                    ...OUTLINE_OPTIONS\n                }\n            }), new Entity({\n                polyline: {\n                    path3v: [],\n                    isClosed: false,\n                    ...OUTLINE_OPTIONS\n                }\n            }),\n            this._ghostCorner\n        ]);\n        const g = this._ghostOutlineLayer;\n        g.getEntities()[0].polyline.altitude = g.getEntities()[1].polyline.altitude = OUTLINE_ALT;\n    }\n}\nexport { PolygonDrawingScene };\n//# sourceMappingURL=PolygonDrawingScene.js.map","import { Entity } from \"../../entity/Entity\";\nimport { Vec2 } from \"../../math/Vec2\";\nimport { CENTER_OPTIONS, CORNER_OPTIONS, NUM_SEGMENTS, OUTLINE_ALT, OUTLINE_OPTIONS, PolygonDrawingScene } from \"./PolygonDrawingScene\";\nclass LineStringDrawingScene extends PolygonDrawingScene {\n    constructor(props) {\n        super(props);\n    }\n    get geometryType() {\n        return \"LineString\";\n    }\n    _addNew(cart) {\n        this._appendCart(cart);\n    }\n    _appendCart(cart) {\n        let corners = this._cornerLayer.getEntities();\n        let segNum = corners.length - 1;\n        let prevCorn = corners[segNum];\n        let corner = new Entity({\n            geoObject: CORNER_OPTIONS,\n        });\n        corner.setCartesian3v(cart);\n        corner.addTo(this._cornerLayer);\n        this._checkTerrainCollision(corner);\n        if (prevCorn) {\n            let prevCart = prevCorn.getCartesian();\n            let vecPrev = corner.getCartesian().sub(prevCart);\n            let distPrev = vecPrev.length();\n            vecPrev.normalize();\n            let prevPath = [];\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(prevCart);\n                prevPath.push(p);\n            }\n            let entity = new Entity({\n                polyline: {\n                    path3v: [prevPath],\n                    isClosed: false,\n                    ...OUTLINE_OPTIONS\n                }\n            });\n            entity.polyline.altitude = OUTLINE_ALT;\n            this._outlineLayer.add(entity);\n            let prevCenterCart = vecPrev.scaleTo(distPrev * 0.5).addA(prevCart);\n            let center = new Entity({\n                geoObject: CENTER_OPTIONS,\n            });\n            center.setCartesian3v(prevCenterCart);\n            center.addTo(this._centerLayer);\n            this._checkTerrainCollision(center);\n        }\n    }\n    _clearGhostPointer() {\n        this._ghostOutlineLayer.getEntities()[0].polyline.clear();\n    }\n    _moveCorner(indexCurrent, indexPrev, indexCenter) {\n        let corners = this._cornerLayer.getEntities();\n        if (corners.length == 0)\n            return;\n        if (corners.length == 1) {\n            indexCurrent = indexPrev = indexCenter = 0;\n        }\n        let cartCurr = corners[indexCurrent].getCartesian();\n        let vecCurr = this._pickedCorner.getCartesian().sub(cartCurr);\n        let distCurr = vecCurr.length();\n        vecCurr.normalize();\n        let path = [];\n        for (let i = 0; i <= NUM_SEGMENTS; i++) {\n            let p = vecCurr.scaleTo(i * distCurr / NUM_SEGMENTS).addA(cartCurr);\n            path.push(p);\n        }\n        let entities = this._outlineLayer.getEntities();\n        let prevPolyline = entities[indexPrev].polyline;\n        prevPolyline?.setPath3v([path]);\n        //\n        // Move center points\n        let centers = this._centerLayer.getEntities();\n        let center = centers[indexCenter];\n        if (center) {\n            let centerCart = vecCurr.scaleTo(distCurr * 0.5).addA(cartCurr);\n            center.setCartesian3v(centerCart);\n            this._checkTerrainCollision(center);\n        }\n    }\n    _moveCornerPoint(e) {\n        let d = new Vec2(e.x, e.y).sub(this._startClick), p = this._startPos.add(d);\n        let groundCoords = this._planet.getCartesianFromPixelTerrain(p);\n        if (groundCoords) {\n            this._pickedCorner.setCartesian3v(groundCoords);\n            let corners = this._cornerLayer.getEntities();\n            if (corners.length) {\n                let ind = this._pickedCorner.layerIndex;\n                if (ind === 0) {\n                    this._moveCorner(ind + 1, ind + 1, ind);\n                }\n                else if (ind === corners.length - 1) {\n                    this._moveCorner(ind - 1, ind, ind - 1);\n                }\n                else {\n                    this._moveCorner(ind + 1, ind + 1, ind);\n                    this._moveCorner(ind - 1, ind, ind - 1);\n                }\n            }\n        }\n    }\n    _updateGhostOutlinePointer(groundPos) {\n        let corners = this._cornerLayer.getEntities();\n        let size = corners.length;\n        if (size > 0) {\n            let ind = size - 1;\n            this._insertCornerIndex = ind;\n            let cartPrev = corners[ind].getCartesian();\n            let vecPrev = this._ghostCorner.getCartesian().sub(cartPrev);\n            let distPrev = vecPrev.length();\n            vecPrev.normalize();\n            let pathPrev = [];\n            for (let i = 0; i <= NUM_SEGMENTS; i++) {\n                let p = vecPrev.scaleTo(i * distPrev / NUM_SEGMENTS).addA(cartPrev);\n                pathPrev.push(p);\n            }\n            let entities = this._ghostOutlineLayer.getEntities();\n            let prevPolyline = entities[0].polyline;\n            prevPolyline.setPath3v([pathPrev]);\n        }\n    }\n    _initGhostLayerPointer() {\n        this._ghostOutlineLayer.setEntities([\n            new Entity({\n                polyline: {\n                    path3v: [],\n                    isClosed: false,\n                    ...OUTLINE_OPTIONS\n                }\n            }),\n            this._ghostCorner\n        ]);\n        this._ghostOutlineLayer.getEntities()[0].polyline.altitude = OUTLINE_ALT;\n    }\n}\nexport { LineStringDrawingScene };\n//# sourceMappingURL=LineStringDrawingScene.js.map","import { Control } from \"../Control\";\nimport { LineStringDrawingScene } from \"./LineStringDrawingScene\";\nimport { PolygonDrawingScene } from \"./PolygonDrawingScene\";\nclass DrawingControl extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._drawingScene = new LineStringDrawingScene({\n            name: `drawingScene:${this.__id}`\n        });\n    }\n    activatePolygonDrawing() {\n        this.deactivate();\n        this._drawingScene = new PolygonDrawingScene({\n            name: `polygonDrawingScene:${this.__id}`\n        });\n        this.activate();\n    }\n    activateLineStringDrawing() {\n        this.deactivate();\n        this._drawingScene = new LineStringDrawingScene({\n            name: `linestringDrawingScene:${this.__id}`\n        });\n        this.activate();\n    }\n    oninit() {\n    }\n    onactivate() {\n        this.planet && this._drawingScene.bindPlanet(this.planet);\n        this.renderer && this.renderer.addNode(this._drawingScene);\n    }\n    ondeactivate() {\n        this.renderer && this.renderer.removeNode(this._drawingScene);\n    }\n}\nexport { DrawingControl };\n//# sourceMappingURL=DrawingControl.js.map","export const ELL = 0;\nexport const MSL = 1;\nexport const GND = 2;\nexport const heightMode = {\n    \"ell\": ELL,\n    \"msl\": MSL,\n    \"gnd\": GND\n};\nconst KM_to_M = 1000.0;\nconst M_to_KM = 1.0 / KM_to_M;\nconst FT_to_M = 0.3048;\nconst M_to_FT = 1.0 / FT_to_M;\nconst MS_to_KMH = 3.6;\nconst KMH_to_MS = 1.0 / MS_to_KMH;\nconst MS_to_FTS = 3.28084;\nconst FT_to_KM = FT_to_M * M_to_KM;\nconst KM_to_FT = 1.0 / FT_to_KM;\nexport const m = 0;\nexport const km = 1;\nexport const ft = 2;\nexport const s = 3;\nexport const h = 4;\nexport const ms = 5;\nexport const kmh = 6;\nexport const fts = 7;\nconst DEFAULT_NAN = \"--\";\nconst _abbr = [\"m\", \"km\", \"ft\", \"s\", \"h\", \"m/s\", \"km/h\", \"ft/s\"];\nexport const _tenth = [0, 2, 0, 0, 0, 0, 0, 0];\nlet _convFn = [];\n_convFn[m] = [];\n_convFn[m][m] = (v) => v;\n_convFn[m][km] = (v) => v * M_to_KM;\n_convFn[m][ft] = (v) => v * M_to_FT;\n_convFn[ft] = [];\n_convFn[ft][m] = (v) => v * FT_to_M;\n_convFn[ft][km] = (v) => v * FT_to_KM;\n_convFn[ft][ft] = (v) => v;\n_convFn[km] = [];\n_convFn[km][m] = (v) => v * KM_to_M;\n_convFn[km][km] = (v) => v;\n_convFn[km][ft] = (v) => v * KM_to_FT;\n_convFn[ms] = [];\n_convFn[ms][ms] = (v) => v;\n_convFn[ms][kmh] = (v) => v * MS_to_KMH;\n_convFn[ms][fts] = (v) => v * MS_to_FTS;\n_convFn[kmh] = [];\n_convFn[kmh][ms] = (v) => v * KMH_to_MS;\n_convFn[kmh][kmh] = (v) => v;\n//_convFn[kmh][fts] = (v) => v * KMH_to_FTS;\nexport function convert(from, to, val) {\n    return _convFn[from][to](val);\n}\nexport function convertExt(isNotNaN, unitFrom, unitTo, val, fixed) {\n    if (isNotNaN) {\n        return convert(unitFrom, unitTo, val).toFixed(fixed || _tenth[unitTo]);\n    }\n    return DEFAULT_NAN;\n}\nexport function toString(u) {\n    return _abbr[u];\n}\n//# sourceMappingURL=units.js.map","import * as units from '../utils/units';\nimport { Control } from './Control';\nimport { heightMode } from '../utils/units';\nimport { throttle } from '../utils/shared';\nconst DECIMAL_TEMPLATE = `<div class=\"og-lat-side\"></div><div class=\"og-lat-val\"></div>\n    <div class=\"og-lon-side\"></div><div class=\"og-lon-val\"></div>\n    <div class=\"og-height\"></div>\n    <div class=\"og-units-height\"></div>`;\nconst DEGREE_TEMPLATE = `<div class=\"og-lat-side\"></div><div class=\"og-lat-val\"></div>\n    <div class=\"og-lon-side\"></div><div class=\"og-lon-val\"></div>\n    <div class=\"og-height\"></div>\n    <div class=\"og-units-height\"></div>`;\nconst CENTER_SVG = '<svg width=\"12\" height=\"12\"><g><path stroke-width=\"1\" stroke-opacity=\"1\" d=\"M6 0L6 12M0 6L12 6\" stroke=\"#337ab7\"></path></g></svg>';\nconst TYPE_HTML = [DECIMAL_TEMPLATE, DEGREE_TEMPLATE];\n/**\n * Control displays mouse or screen center Earth coordinates.\n * @param {Boolean} [options.center] - Earth coordinates by screen center otherwise mouse pointer. False is default.\n * @param {Boolean} [options.type] - Coordinates shown: 0 - is decimal degrees, 1 - degrees, 2 - mercator geodetic coordinates.\n */\nexport class EarthCoordinates extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._type = options.type || 0;\n        this._TYPE_FUNC = [this._SHOW_DECIMAL, this._SHOW_DEGREE];\n        this._showFn = null;\n        this._el = null;\n        this._latSideEl = null;\n        this._lonSideEl = null;\n        this._latValEl = null;\n        this._lonValEl = null;\n        this._heightEl = null;\n        this._altUnitVal = options.altitudeUnit || \"m\";\n        this._heightModeVal = options.heightMode || \"ell\";\n        this._altUnit = units[this._altUnitVal];\n        this._heightMode = heightMode[this._heightModeVal];\n        this._lonLat = null;\n        this._centerMode = options.centerMode != undefined ? options.centerMode : true;\n    }\n    _SHOW_DECIMAL(ll) {\n        if (ll) {\n            let lat = ll.lat, lon = ll.lon;\n            if (lat >= 0) {\n                this._latSideEl.innerHTML = 'N';\n            }\n            else {\n                this._latSideEl.innerHTML = 'S';\n            }\n            if (lon >= 0) {\n                this._lonSideEl.innerHTML = 'E';\n            }\n            else {\n                this._lonSideEl.innerHTML = 'W';\n            }\n            this._latValEl.innerHTML = Math.abs(lat).toFixed(7) + '¬∞';\n            this._lonValEl.innerHTML = Math.abs(lon).toFixed(7) + '¬∞';\n        }\n    }\n    _SHOW_DEGREE(ll) {\n        if (ll) {\n            let lat = ll.lat, lon = ll.lon;\n            if (lat >= 0) {\n                this._latSideEl.innerHTML = 'N';\n            }\n            else {\n                this._latSideEl.innerHTML = 'S';\n            }\n            if (lon >= 0) {\n                this._lonSideEl.innerHTML = 'E';\n            }\n            else {\n                this._lonSideEl.innerHTML = 'W';\n            }\n            let t = 0;\n            let deg = lat < 0 ? Math.ceil(lat) : Math.floor(lat);\n            let min = Math.floor(t = Math.abs((lat - deg)) * 60);\n            let sec = Math.floor((t - min) * 6000) / 100.0;\n            this._latValEl.innerHTML = Math.abs(deg) + '¬∞' + min + \"'\" + sec.toFixed(0) + '\"';\n            deg = lon < 0 ? Math.ceil(lon) : Math.floor(lon);\n            min = Math.floor(t = Math.abs((lon - deg)) * 60);\n            sec = Math.floor((t - min) * 6000) / 100.0;\n            this._lonValEl.innerHTML = Math.abs(deg) + '¬∞' + min + \"'\" + sec.toFixed(0) + '\"';\n        }\n    }\n    _createCenterEl() {\n        let el = document.createElement('div');\n        el.className = 'og-center-icon';\n        el.innerHTML = CENTER_SVG;\n        return el;\n    }\n    _updateUnits() {\n        this._heightMode = heightMode[this._heightModeVal];\n        this._altUnit = units[this._altUnitVal];\n        this._el.querySelector(\".og-units-height\").innerHTML = units.toString(this._altUnit);\n        this._showHeight();\n    }\n    _refreshCoordinates() {\n        if (this._type >= this._TYPE_FUNC.length) {\n            this._type = 0;\n        }\n        let el = this._el;\n        el.innerHTML = TYPE_HTML[this._type];\n        this._latSideEl = el.querySelector(\".og-lat-side\");\n        this._lonSideEl = el.querySelector(\".og-lon-side\");\n        this._latValEl = el.querySelector(\".og-lat-val\");\n        this._lonValEl = el.querySelector(\".og-lon-val\");\n        this._heightEl = el.querySelector(\".og-height\");\n        this._showFn = this._TYPE_FUNC[this._type];\n        this._showFn(this._lonLat);\n    }\n    oninit() {\n        this._el = document.createElement('div');\n        this._el.classList.add(\"og-coordinates\");\n        this.renderer.div.appendChild(this._el);\n        this._el.addEventListener(\"click\", () => {\n            this._type++;\n            this._refreshCoordinates();\n            this._updateUnits();\n            this._showHeight();\n        });\n        if (this._centerMode) {\n            this.renderer.div.appendChild(this._createCenterEl());\n            this.planet.camera.events.on(\"moveend\", this._grabCoordinates, this);\n            this.planet.camera.events.on(\"moveend\", throttle(() => this._showHeight(), 400, true), this);\n        }\n        else {\n            this.renderer.events.on(\"mousemove\", this._grabCoordinates, this);\n            this.renderer.events.on(\"mousestop\", throttle(() => this._showHeight(), 400, true), this);\n        }\n        this._refreshCoordinates();\n        this._updateUnits();\n    }\n    _grabCoordinates(e) {\n        let px = e.pos;\n        let scrPx;\n        let r = this.renderer;\n        if (this._centerMode) {\n            scrPx = r.handler.getCenter();\n        }\n        else {\n            scrPx = px;\n        }\n        this._lonLat = this.planet.getLonLatFromPixelTerrain(scrPx) || null;\n        this._showFn(this._lonLat);\n    }\n    async _showHeight() {\n        if (this._lonLat && this.planet) {\n            let alt = 0;\n            this._heightEl.style.opacity = \"0.7\";\n            if (this._heightMode === heightMode.ell) {\n                alt = await this.planet.getHeightAboveELL(this._lonLat);\n                alt = Number(units.convertExt(true, units.m, this._altUnit, alt));\n            }\n            else if (this._heightMode === heightMode.msl) {\n                alt = await this.planet.getHeightDefault(this._lonLat);\n                alt = Number(units.convertExt(true, units.m, this._altUnit, alt));\n            }\n            this._heightEl.style.opacity = \"1.0\";\n            this._heightEl.innerHTML = alt.toString();\n        }\n    }\n}\n//# sourceMappingURL=EarthCoordinates.js.map","import { Control } from \"./Control\";\nimport { LonLat } from \"../LonLat\";\nimport { Quat } from \"../math/Quat\";\nimport { Ray } from \"../math/Ray\";\nimport { Sphere } from \"../bv/Sphere\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nclass TouchExt {\n    constructor() {\n        this.x = 0;\n        this.y = 0;\n        this.prev_x = 0;\n        this.prev_y = 0;\n        this.grabbedPoint = new Vec3();\n        this.grabbedSpheroid = new Sphere();\n    }\n    dX() {\n        return this.x - this.prev_x;\n    }\n    dY() {\n        return this.y - this.prev_y;\n    }\n}\nexport class EarthNavigation extends Control {\n    constructor(options = {}) {\n        super(options);\n        this.grabbedPoint = new Vec3();\n        this.grabbedDir = new Vec3();\n        this.inertia = 0.007;\n        this.grabbedSpheroid = new Sphere();\n        this.planet = null;\n        this._vRot = new Quat();\n        this._hRot = new Quat();\n        this._a = 0.0;\n        this.scaleRot = 0;\n        this.currState = 0;\n        this.positionState = [\n            { h: 17119745.303455353, max: 0.98, min: -0.98 },\n            { h: 6866011, max: 0.98, min: -0.98 },\n            { h: 3000000, max: 0.98, min: -0.98 },\n            { h: 1000000, max: 0.98, min: -0.98 },\n            { h: 500000, max: 0.98, min: -0.98 }\n        ];\n        this.touches = [new TouchExt(), new TouchExt()];\n    }\n    switchZoomState(wheelDelta) {\n        this.stopRotation();\n        if (wheelDelta > 0) {\n            this.currState++;\n        }\n        else {\n            this.currState--;\n        }\n        if (this.currState <= 0)\n            this.currState = 0;\n        if (this.currState >= this.positionState.length) {\n            this.currState = this.positionState.length - 1;\n        }\n        this.planet.stopFlying();\n        const ll = this.planet.camera._lonLat;\n        this.planet.flyLonLat(new LonLat(ll.lon, ll.lat, this.positionState[this.currState].h));\n    }\n    onMouseWheel(event) {\n        this.switchZoomState(event.wheelDelta);\n    }\n    oninit() {\n        this.activate();\n    }\n    onactivate() {\n        let r = this.renderer;\n        r.events.on(\"mousewheel\", this.onMouseWheel, this);\n        r.events.on(\"lhold\", this.onMouseLeftButtonDown, this);\n        r.events.on(\"ldown\", this.onMouseLeftButtonClick, this);\n        r.events.on(\"lup\", this.onMouseLeftButtonUp, this);\n        r.events.on(\"touchstart\", this.onTouchStart, this);\n        r.events.on(\"touchend\", this.onTouchEnd, this);\n        r.events.on(\"touchmove\", this.onTouchMove, this);\n        r.events.on(\"draw\", this.onDraw, this);\n    }\n    onTouchStart(e) {\n        if (e.sys.touches.length == 1) {\n            const t = this.touches[0];\n            t.x = e.sys.touches.item(0).pageX - e.sys.offsetLeft;\n            t.y = e.sys.touches.item(0).pageY - e.sys.offsetTop;\n            t.prev_x = e.sys.touches.item(0).pageX - e.sys.offsetLeft;\n            t.prev_y = e.sys.touches.item(0).pageY - e.sys.offsetTop;\n            // t.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(t, true);\n            t.grabbedPoint = this.planet.getCartesianFromPixelTerrain(new Vec2(t.x, t.y)) || null;\n            if (t.grabbedPoint) {\n                t.grabbedSpheroid.radius = t.grabbedPoint.length();\n                this.stopRotation();\n            }\n        }\n    }\n    onTouchEnd(e) {\n        if (e.sys.touches.length == 0) {\n            this.scaleRot = 1;\n            if (Math.abs(this.touches[0].x - this.touches[0].prev_x) < 3 &&\n                Math.abs(this.touches[0].y - this.touches[0].prev_y) < 3)\n                this.stopRotation();\n        }\n    }\n    onTouchMove(e) {\n        if (e.sys.touches.length == 1) {\n            let cam = this.planet.camera;\n            let t = this.touches[0];\n            t.prev_x = t.x;\n            t.prev_y = t.y;\n            t.x = e.sys.touches.item(0).pageX - e.sys.offsetLeft;\n            t.y = e.sys.touches.item(0).pageY - e.sys.offsetTop;\n            if (!t.grabbedPoint)\n                return;\n            let direction = cam.unproject(t.x, t.y);\n            let targetPoint = new Ray(cam.eye, direction).hitSphere(t.grabbedSpheroid);\n            if (targetPoint) {\n                this._a =\n                    Math.acos(t.grabbedPoint.y / t.grabbedSpheroid.radius) -\n                        Math.acos(targetPoint.y / t.grabbedSpheroid.radius);\n                this._vRot = Quat.axisAngleToQuat(cam._u, this._a);\n                this._hRot = Quat.getRotationBetweenVectors(new Vec3(targetPoint.x, 0.0, targetPoint.z).normal(), new Vec3(t.grabbedPoint.x, 0.0, t.grabbedPoint.z).normal());\n                let rot = this._hRot.mul(this._vRot);\n                let state = this.positionState[this.currState];\n                let lim = rot.mulVec3(cam.eye).normal().dot(Vec3.NORTH);\n                if (lim > state.max || lim < state.min) {\n                    rot = Quat.yRotation(rot.getYaw());\n                }\n                cam.set(rot.mulVec3(cam.eye), Vec3.ZERO, Vec3.NORTH);\n                cam.update();\n            }\n        }\n    }\n    onMouseLeftButtonClick(e) {\n        this.renderer.handler.canvas.classList.add(\"ogGrabbingPoiner\");\n        this.grabbedPoint = this.planet.getCartesianFromMouseTerrain() || null;\n        this.grabbedDir.copy(e.direction);\n        if (this.grabbedPoint) {\n            this.grabbedSpheroid.radius = this.grabbedPoint.length();\n            this.stopRotation();\n        }\n    }\n    stopRotation() {\n        this.scaleRot = 0.0;\n        this._a = 0.0;\n        this._vRot.clear();\n        this._hRot.clear();\n    }\n    onMouseLeftButtonUp(e) {\n        this.scaleRot = 1;\n        this.renderer.handler.canvas.classList.remove(\"ogGrabbingPoiner\");\n        if (Math.abs(e.x - e.prev_x) < 3 && Math.abs(e.y - e.prev_y) < 3)\n            this.stopRotation();\n    }\n    onMouseLeftButtonDown(e) {\n        let cam = this.planet.camera;\n        if (!this.grabbedPoint || cam.isFlying())\n            return;\n        if (this.renderer.events.mouseState.moving) {\n            let targetPoint = new Ray(cam.eye, e.direction).hitSphere(this.grabbedSpheroid);\n            if (targetPoint) {\n                this._a = Math.acos(this.grabbedPoint.y / this.grabbedSpheroid.radius) -\n                    Math.acos(targetPoint.y / this.grabbedSpheroid.radius);\n                let rot = this._vRot = Quat.axisAngleToQuat(cam._u, this._a);\n                cam.set(rot.mulVec3(cam.eye), Vec3.ZERO, rot.mulVec3(cam.getUp()));\n                this._hRot = Quat.getRotationBetweenVectors(new Vec3(targetPoint.x, 0.0, targetPoint.z).normal(), new Vec3(this.grabbedPoint.x, 0.0, this.grabbedPoint.z).normal());\n                rot = this._hRot;\n                cam.set(rot.mulVec3(cam.eye), Vec3.ZERO, rot.mulVec3(cam.getUp()));\n                cam.update();\n            }\n        }\n        else {\n            this.scaleRot = 0;\n        }\n    }\n    onDraw() {\n        let r = this.renderer;\n        let cam = this.planet.camera;\n        if (r.events.mouseState.leftButtonDown || !this.scaleRot || cam.isFlying())\n            return;\n        this.scaleRot -= this.inertia;\n        if (this.scaleRot <= 0) {\n            this.scaleRot = 0;\n        }\n        else {\n            this._vRot = Quat.axisAngleToQuat(cam._u, this._a);\n            let rot = this._vRot.mul(this._hRot);\n            let lim = rot.mulVec3(cam.eye).normal().dot(Vec3.NORTH);\n            let state = this.positionState[this.currState];\n            if (lim > state.max || lim < state.min) {\n                rot = Quat.yRotation(rot.getYaw());\n            }\n            r.controlsBag.scaleRot = this.scaleRot;\n            rot = rot\n                .slerp(Quat.IDENTITY, 1 - this.scaleRot * this.scaleRot * this.scaleRot)\n                .normalize();\n            if (!(rot.x || rot.y || rot.z)) {\n                this.scaleRot = 0;\n            }\n            cam.set(rot.mulVec3(cam.eye), Vec3.ZERO, Vec3.NORTH);\n            cam.update();\n        }\n    }\n}\n//# sourceMappingURL=EarthNavigation.js.map","import * as mercator from \"../mercator\";\nimport { doubleToTwoFloats2 } from \"../math/coder\";\nimport { Extent } from \"../Extent\";\nimport { Layer } from \"./Layer\";\nimport { LonLat } from \"../LonLat\";\nconst BASEGEOIMAGE_EVENTS = [\n    /**\n     * Triggered when image data is loaded\n     * @event EventsHandler<BaseGeoImageEventsList>#loadend\n     */\n    \"loadend\"\n];\n/**\n * BaseGeoImage layer represents square imagery layer that\n * could be a static image, or animated video or webgl buffer\n * object displayed on the globe.\n * @class\n * @extends {Layer}\n */\nclass BaseGeoImage extends Layer {\n    constructor(name, options = {}) {\n        super(name, options);\n        // @ts-ignore\n        this.events = this.events.registerNames(BASEGEOIMAGE_EVENTS);\n        this._projType = 0;\n        this._frameWidth = 256;\n        this._frameHeight = 256;\n        this._sourceReady = false;\n        this._sourceTexture = null;\n        this._materialTexture = null;\n        this._gridBufferLow = null;\n        this._gridBufferHigh = null;\n        this._extentWgs84ParamsHigh = new Float32Array(4);\n        this._extentWgs84ParamsLow = new Float32Array(4);\n        this._extentMercParamsHigh = new Float32Array(4);\n        this._extentMercParamsLow = new Float32Array(4);\n        this._refreshFrame = true;\n        this._frameCreated = false;\n        this._sourceCreated = false;\n        this._animate = false;\n        this._ready = false;\n        this._creationProceeding = false;\n        this._isRendering = false;\n        this._extentWgs84 = new Extent();\n        this._cornersWgs84 = [];\n        this._cornersMerc = [];\n        this._isFullExtent = options.fullExtent ? 1 : 0;\n        /**\n         * rendering function pointer\n         */\n        this.rendering = this._renderingProjType0.bind(this);\n        this._onLoadend_ = null;\n        options.corners && this.setCorners(options.corners);\n    }\n    get isIdle() {\n        return super.isIdle && this._ready;\n    }\n    addTo(planet) {\n        this._onLoadend_ = this._onLoadend.bind(this);\n        this.events.on(\"loadend\", this._onLoadend_, this);\n        return super.addTo(planet);\n    }\n    _onLoadend() {\n        if (this._planet) {\n            this._planet.events.dispatch(this._planet.events.layerloadend, this);\n        }\n    }\n    remove() {\n        this.events.off(\"loadend\", this._onLoadend_);\n        this._onLoadend_ = null;\n        return super.remove();\n    }\n    get instanceName() {\n        return \"BaseGeoImage\";\n    }\n    /**\n     * Gets corners coordinates.\n     * @public\n     * @return {Array.<LonLat>} - (exactly 4 entries)\n     */\n    getCornersLonLat() {\n        let c = this._cornersWgs84;\n        return [\n            new LonLat(c[0].lon, c[0].lat),\n            new LonLat(c[1].lon, c[1].lat),\n            new LonLat(c[2].lon, c[2].lat),\n            new LonLat(c[3].lon, c[3].lat)\n        ];\n    }\n    /**\n     * Gets corners coordinates.\n     * @public\n     * @return {Array.<Array<number>>} - (exactly 3 entries)\n     */\n    getCorners() {\n        let c = this._cornersWgs84;\n        return [\n            [c[0].lon, c[0].lat],\n            [c[1].lon, c[1].lat],\n            [c[2].lon, c[2].lat],\n            [c[3].lon, c[3].lat]\n        ];\n    }\n    /**\n     * Sets geoImage geographical corners coordinates.\n     * @public\n     * @param {Array.<Array.<number>>} corners - GeoImage corners coordinates. Where first coordinate (exactly 3 entries)\n     * coincedents to the left top image corner, secont to the right top image corner, third to the right bottom\n     * and fourth - left bottom image corner.\n     */\n    setCorners(corners) {\n        this.setCornersLonLat(LonLat.join(corners));\n    }\n    /**\n     * Sets geoImage geographical corners coordinates.\n     * @public\n     * @param {Array.<LonLat>} corners - GeoImage corners coordinates. Where first coordinate\n     * coincedents to the left top image corner, secont to the right top image corner, third to the right bottom\n     * and fourth - left bottom image corner. (exactly 4 entries)\n     */\n    setCornersLonLat(corners) {\n        this._refreshFrame = true;\n        this._cornersWgs84 = [\n            corners[0].clone(),\n            corners[1].clone(),\n            corners[2].clone(),\n            corners[3].clone()\n        ];\n        for (let i = 0; i < this._cornersWgs84.length; i++) {\n            if (this._cornersWgs84[i].lat >= 89.9) {\n                this._cornersWgs84[i].lat = 89.9;\n            }\n            if (this._cornersWgs84[i].lat <= -89.9) {\n                this._cornersWgs84[i].lat = -89.9;\n            }\n        }\n        this._extent.setByCoordinates(this._cornersWgs84);\n        let me = this._extent;\n        if (me.southWest.lat > mercator.MAX_LAT || me.northEast.lat < mercator.MIN_LAT) {\n            this._projType = 0;\n            this.rendering = this._renderingProjType0;\n        }\n        else {\n            this._projType = 1;\n            this.rendering = this._renderingProjType1;\n        }\n        if (this._ready && !this._creationProceeding) {\n            this._planet._geoImageCreator.add(this);\n        }\n    }\n    /**\n     * Creates geoImage frame.\n     * @protected\n     */\n    _createFrame() {\n        this._extentWgs84 = this._extent.clone();\n        this._cornersMerc = [\n            this._cornersWgs84[0].forwardMercatorEPS01(),\n            this._cornersWgs84[1].forwardMercatorEPS01(),\n            this._cornersWgs84[2].forwardMercatorEPS01(),\n            this._cornersWgs84[3].forwardMercatorEPS01()\n        ];\n        this._extentMerc = new Extent(this._extentWgs84.southWest.forwardMercatorEPS01(), this._extentWgs84.northEast.forwardMercatorEPS01());\n        let tempArr = new Float32Array(2);\n        if (this._projType === 0) {\n            doubleToTwoFloats2(this._extentWgs84.southWest.lon, tempArr);\n            this._extentWgs84ParamsHigh[0] = tempArr[0];\n            this._extentWgs84ParamsLow[0] = tempArr[1];\n            doubleToTwoFloats2(this._extentWgs84.southWest.lat, tempArr);\n            this._extentWgs84ParamsHigh[1] = tempArr[0];\n            this._extentWgs84ParamsLow[1] = tempArr[1];\n            this._extentWgs84ParamsHigh[2] = 2.0 / this._extentWgs84.getWidth();\n            this._extentWgs84ParamsHigh[3] = 2.0 / this._extentWgs84.getHeight();\n        }\n        else {\n            doubleToTwoFloats2(this._extentMerc.southWest.lon, tempArr);\n            this._extentMercParamsHigh[0] = tempArr[0];\n            this._extentMercParamsLow[0] = tempArr[1];\n            doubleToTwoFloats2(this._extentMerc.southWest.lat, tempArr);\n            this._extentMercParamsHigh[1] = tempArr[0];\n            this._extentMercParamsLow[1] = tempArr[1];\n            this._extentMercParamsHigh[2] = 2.0 / this._extentMerc.getWidth();\n            this._extentMercParamsHigh[3] = 2.0 / this._extentMerc.getHeight();\n        }\n        // creates material frame textures\n        if (this._planet) {\n            let p = this._planet, h = p.renderer.handler, gl = h.gl;\n            gl.deleteTexture(this._materialTexture);\n            this._materialTexture = h.createEmptyTexture_l(this._frameWidth, this._frameHeight);\n            let gridBufferArr = this._planet._geoImageCreator.createGridBuffer(this._cornersWgs84, this._projType === 1);\n            this._gridBufferHigh = gridBufferArr[0];\n            this._gridBufferLow = gridBufferArr[1];\n            this._refreshFrame = false;\n        }\n    }\n    /**\n     * @public\n     * @override\n     * @param {Material} material - GeoImage material.\n     */\n    abortMaterialLoading(material) {\n        this._creationProceeding = false;\n        material.isLoading = false;\n        material.isReady = false;\n    }\n    /**\n     * Clear layer material.\n     * @public\n     * @override\n     */\n    clear() {\n        let p = this._planet;\n        if (p) {\n            let gl = p.renderer.handler.gl;\n            this._creationProceeding && p._geoImageCreator.remove(this);\n            p._clearLayerMaterial(this);\n            if (gl) {\n                gl.deleteBuffer(this._gridBufferHigh);\n                gl.deleteBuffer(this._gridBufferLow);\n                gl.deleteTexture(this._sourceTexture);\n                this._materialTexture && !this._materialTexture.default && gl.deleteTexture(this._materialTexture);\n            }\n        }\n        this._sourceTexture = null;\n        this._materialTexture = null;\n        this._gridBufferHigh = null;\n        this._gridBufferLow = null;\n        this._refreshFrame = true;\n        this._sourceCreated = false;\n        this._ready = false;\n        this._creationProceeding = false;\n    }\n    /**\n     * Sets layer visibility.\n     * @public\n     * @override\n     * @param {boolean} visibility - GeoImage visibility.\n     */\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            super.setVisibility(visibility);\n            // remove from creator\n            if (this._planet && this._sourceReady) {\n                if (visibility) {\n                    this._planet._geoImageCreator.add(this);\n                }\n                else {\n                    this._planet._geoImageCreator.remove(this);\n                }\n            }\n        }\n    }\n    /**\n     * @public\n     * @param {Material} material - GeoImage material.\n     */\n    clearMaterial(material) {\n        material.texture = null;\n        material.isLoading = false;\n        material.isReady = false;\n    }\n    /**\n     * @public\n     * @override\n     * @returns {Array<number>} -\n     */\n    applyMaterial(material) {\n        let segment = material.segment;\n        if (this._ready) {\n            material.applyTexture(this._materialTexture);\n        }\n        else {\n            material.texture = this._planet.transparentTexture;\n            !this._creationProceeding && this.loadMaterial(material);\n        }\n        let v0s, v0t;\n        if (this._projType === 0) {\n            v0s = this._extentWgs84;\n            v0t = segment._extent;\n        }\n        else {\n            v0s = this._extentMerc;\n            v0t = segment.getExtentMerc();\n        }\n        let sSize_x = v0s.northEast.lon - v0s.southWest.lon;\n        let sSize_y = v0s.northEast.lat - v0s.southWest.lat;\n        let dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\n        let dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\n        let dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\n        let dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\n    }\n    /**\n     * Gets frame width size in pixels.\n     * @public\n     * @returns {Number} Frame width.\n     */\n    get getFrameWidth() {\n        return this._frameWidth;\n    }\n    /**\n     * Gets frame height size in pixels.\n     * @public\n     * @returns {Number} Frame height.\n     */\n    get getFrameHeight() {\n        return this._frameHeight;\n    }\n    /**\n     * Method depends on GeoImage instance\n     * @protected\n     */\n    _createSourceTexture() {\n        //empty\n    }\n    _renderingProjType1() {\n        let p = this._planet, h = p.renderer.handler, gl = h.gl, creator = p._geoImageCreator;\n        this._refreshFrame && this._createFrame();\n        this._createSourceTexture();\n        let f = creator._framebuffer;\n        f.setSize(this._frameWidth, this._frameHeight);\n        f.activate();\n        h.programs.geoImageTransform.activate();\n        let sh = h.programs.geoImageTransform._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        gl.disable(gl.CULL_FACE);\n        f.bindOutputTexture(this._materialTexture);\n        gl.clearColor(0.0, 0.0, 0.0, 0.0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        gl.uniform1i(shu.isFullExtent, this._isFullExtent);\n        gl.bindBuffer(gl.ARRAY_BUFFER, creator._texCoordsBuffer);\n        gl.vertexAttribPointer(sha.texCoords, 2, gl.UNSIGNED_SHORT, true, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferHigh);\n        gl.vertexAttribPointer(sha.cornersHigh, this._gridBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferLow);\n        gl.vertexAttribPointer(sha.cornersLow, this._gridBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n        gl.uniform4fv(shu.extentParamsHigh, this._extentMercParamsHigh);\n        gl.uniform4fv(shu.extentParamsLow, this._extentMercParamsLow);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture);\n        gl.uniform1i(shu.sourceTexture, 0);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creator._indexBuffer);\n        gl.drawElements(gl.TRIANGLE_STRIP, creator._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n        f.deactivate();\n        gl.enable(gl.CULL_FACE);\n        this._ready = true;\n        this._creationProceeding = false;\n    }\n    _renderingProjType0() {\n        let p = this._planet, h = p.renderer.handler, gl = h.gl, creator = p._geoImageCreator;\n        this._refreshFrame && this._createFrame();\n        this._createSourceTexture();\n        let f = creator._framebuffer;\n        f.setSize(this._frameWidth, this._frameHeight);\n        f.activate();\n        h.programs.geoImageTransform.activate();\n        let sh = h.programs.geoImageTransform._program;\n        let sha = sh.attributes, shu = sh.uniforms;\n        gl.disable(gl.CULL_FACE);\n        f.bindOutputTexture(this._materialTexture);\n        gl.clearColor(0.0, 0.0, 0.0, 0.0);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n        gl.bindBuffer(gl.ARRAY_BUFFER, creator._texCoordsBuffer);\n        gl.vertexAttribPointer(sha.texCoords, 2, gl.UNSIGNED_SHORT, true, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferHigh);\n        gl.vertexAttribPointer(sha.cornersHigh, this._gridBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this._gridBufferLow);\n        gl.vertexAttribPointer(sha.cornersLow, this._gridBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n        gl.uniform4fv(shu.extentParamsHigh, this._extentWgs84ParamsHigh);\n        gl.uniform4fv(shu.extentParamsLow, this._extentWgs84ParamsLow);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture);\n        gl.uniform1i(shu.sourceTexture, 0);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, creator._indexBuffer);\n        gl.drawElements(gl.TRIANGLE_STRIP, creator._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n        f.deactivate();\n        gl.enable(gl.CULL_FACE);\n        this._ready = true;\n        this._creationProceeding = false;\n    }\n}\nexport { BaseGeoImage };\n//# sourceMappingURL=BaseGeoImage.js.map","export const input = {\n    MB_LEFT: 0,\n    MB_RIGHT: 2,\n    MB_MIDDLE: 1,\n    KEY_CTRL: 17,\n    KEY_ALT: 18,\n    KEY_SHIFT: 16,\n    KEY_SPACE: 32,\n    KEY_PGUP: 33,\n    KEY_PGDN: 34,\n    KEY_LEFT: 37,\n    KEY_UP: 38,\n    KEY_RIGHT: 39,\n    KEY_DOWN: 40,\n    KEY_PRINTSCREEN: 44,\n    KEY_EQUALS: 61,\n    KEY_A: 65,\n    KEY_C: 67,\n    KEY_D: 68,\n    KEY_E: 69,\n    KEY_F: 70,\n    KEY_H: 72,\n    KEY_I: 73,\n    KEY_K: 75,\n    KEY_L: 76,\n    KEY_N: 78,\n    KEY_O: 79,\n    KEY_P: 80,\n    KEY_Q: 81,\n    KEY_R: 82,\n    KEY_S: 83,\n    KEY_V: 86,\n    KEY_W: 87,\n    KEY_X: 88,\n    KEY_Z: 90,\n    KEY_PLUS: 107,\n    KEY_F1: 112,\n    KEY_MINUS: 173,\n    KEY_APOSTROPHE: 192,\n    KEY_BACK_SLASH: 220,\n    KEY_MORE: 190,\n    KEY_SLASH: 191,\n    KEY_LESS: 188,\n    KEY_LEFT_SQUARE_BRACKET: 219,\n    KEY_RIGHT_SQUARE_BRACKET: 221,\n    KEY_SINGLE_QUOTE: 222\n};\n//# sourceMappingURL=input.js.map","import { createEvents } from '../Events';\nimport { Control } from \"./Control\";\nconst LAYERANIMATION_EVENTS = [\"change\", \"idle\", \"play\", \"pause\", \"stop\"];\nexport class LayerAnimation extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._currVisibleIndex = 0;\n        this._onViewchange = () => {\n            this._timeoutStart = performance.now();\n        };\n        this._onVisibilityChange = (isVisible) => {\n            if (!isVisible) {\n                this.pause();\n            }\n        };\n        /**\n         * Waiting for the current index layer loadend and make it non-transparent,\n         * and make prev layer transparent, also check previous frame index to clean up.\n         */\n        this._onLayerLoadend = (layer) => {\n            let currLayer = this._layersArr[this._currentIndex];\n            if (currLayer && currLayer.isEqual(layer)) {\n                // BRUTE\n                let currFrame = this._getFrameIndex(this._currentIndex);\n                let from = currFrame * this._frameSize, to = this._currentIndex;\n                for (let i = from; i < to; i++) {\n                    let li = this._layersArr[i];\n                    li.opacity = 0;\n                    li.setVisibility(false);\n                }\n                // * Make CURRENT Layer VISIBLE *\n                currLayer.opacity = 1.0;\n                let currVisibleLayer = this._layersArr[this._currVisibleIndex];\n                if (currVisibleLayer) {\n                    currVisibleLayer.opacity = 0.0;\n                    currVisibleLayer.setVisibility(false);\n                    // If frame is changed - remove it from the planet\n                    let prevFrame = this._getFrameIndex(this._currVisibleIndex);\n                    if (this._getFrameIndex(this._currentIndex) !== prevFrame) {\n                        this._removeFrameFromPlanet(prevFrame);\n                    }\n                }\n                this.events.dispatch(this.events.idle, currLayer);\n            }\n        };\n        this.events = createEvents(LAYERANIMATION_EVENTS);\n        this._name = options.name || `layerAnimation-${this.__id}`;\n        this._layersArr = options.layers ? [].concat(options.layers) : [];\n        this._currentIndex = -1;\n        this._playInterval = options.playInterval || 120;\n        this._playIntervalHandler = -1;\n        this._playIndex = 0;\n        this._frameSize = options.frameSize || 50;\n        this.repeat = options.repeat != undefined ? options.repeat : true;\n        this.skipTimeout = options.skipTimeout || 5000;\n        this._timeoutStart = 0;\n    }\n    _getFramesNum() {\n        return Math.ceil(this._layersArr.length / this._frameSize);\n    }\n    _setFrame(frameIndex) {\n        for (let i = 0, len = this._getFramesNum(); i < len; i++) {\n            if (i !== frameIndex) {\n                this._removeFrameFromPlanet(i);\n            }\n            else {\n                this._appendFrameToPlanet(i);\n            }\n        }\n    }\n    _getFrameIndex(layerIndex) {\n        return Math.floor(layerIndex / this._frameSize);\n    }\n    _appendFrameToPlanet(frameIndex) {\n        if (this.planet) {\n            let minIndex = frameIndex * this._frameSize;\n            let maxIndex = minIndex + this._frameSize;\n            for (let i = minIndex, len = maxIndex > this._layersArr.length ? this._layersArr.length : maxIndex; i < len; i++) {\n                this.planet.addLayer(this._layersArr[i]);\n            }\n        }\n    }\n    _removeFrameFromPlanet(frameIndex) {\n        if (this.planet) {\n            let minIndex = frameIndex * this._frameSize;\n            let maxIndex = minIndex + this._frameSize;\n            for (let i = minIndex, len = maxIndex > this._layersArr.length ? this._layersArr.length : maxIndex; i < len; i++) {\n                this._layersArr[i].abortLoading();\n                this._layersArr[i].remove();\n                this._layersArr[i].setVisibility(false);\n            }\n        }\n    }\n    oninit() {\n        super.oninit();\n        this.onactivate();\n        this._initLayers();\n        this.planet.events.on(\"layerloadend\", this._onLayerLoadend);\n        this._setCurrentIndexAsync(0, false, true);\n    }\n    onactivate() {\n        super.onactivate();\n        this.planet.camera.events.on(\"viewchange\", this._onViewchange);\n        this.planet.renderer.handler.events.on(\"visibilitychange\", this._onVisibilityChange);\n    }\n    ondeactivate() {\n        super.ondeactivate();\n        this.planet.camera.events.off(\"viewchange\", this._onViewchange);\n        for (let i = 0; i < this._layersArr.length; i++) {\n            this._layersArr[i].setVisibility(false);\n        }\n        this.planet.events.off(\"layerloadend\", this._onLayerLoadend);\n        this.planet.renderer.handler.events.off(\"visibilitychange\", this._onVisibilityChange);\n    }\n    clear() {\n        this.stop();\n        this._currentIndex = -1;\n        this._currVisibleIndex = -1;\n        let layersToRemove = this._layersArr;\n        this._layersArr = [];\n        for (let i = 0; i < layersToRemove.length; i++) {\n            layersToRemove[i].remove();\n        }\n    }\n    _initLayers() {\n        if (this.planet) {\n            for (let i = 0, len = this._layersArr.length; i < len; i++) {\n                let li = this._layersArr[i];\n                li.setVisibility(false);\n                li.setBaseLayer(false);\n                li.opacity = 0.0;\n            }\n            this._appendFrameToPlanet(0);\n        }\n    }\n    setLayers(layers) {\n        this.clear();\n        this._layersArr = [].concat(layers);\n        this._initLayers();\n    }\n    appendLayer(layer) {\n        this._layersArr.push(layer);\n        layer.setVisibility(false);\n        layer.setBaseLayer(false);\n        layer.opacity = 0.0;\n        //check current frame\n        this.planet?.addLayer(layer);\n    }\n    /**\n     * warning: Use XYZ.isIdle in requestAnimationFrame(after setVisibility)\n     * @returns Returns true if current layer is idle\n     */\n    get isIdle() {\n        let currLayer = this._layersArr[this._currentIndex];\n        return currLayer && currLayer.isIdle || !currLayer;\n    }\n    get playInterval() {\n        return this._playInterval;\n    }\n    set playInterval(val) {\n        if (val !== this._playInterval) {\n            this._playInterval = val;\n            if (this.isPlaying) {\n                this.pause();\n                this.play();\n            }\n        }\n    }\n    get isPlaying() {\n        return this._playIntervalHandler !== -1;\n    }\n    get layers() {\n        return this._layersArr;\n    }\n    _checkEnd() {\n        if (this._playIndex > this._layersArr.length) {\n            if (this.repeat) {\n                this._playIndex = 0;\n            }\n            else {\n                this.pause();\n            }\n        }\n    }\n    play() {\n        if (!this.isPlaying) {\n            if (this._currentIndex >= this._layersArr.length - 1) {\n                this.stop();\n            }\n            this._timeoutStart = performance.now();\n            this._playIntervalHandler = setInterval(() => {\n                this._checkEnd();\n                this._setCurrentIndexAsync(this._playIndex, false, false);\n                requestAnimationFrame(() => {\n                    if (this.isIdle || (performance.now() - this._timeoutStart > this.skipTimeout)) {\n                        this._playIndex++;\n                        this._timeoutStart = performance.now();\n                    }\n                });\n            }, this._playInterval);\n            this.events.dispatch(this.events.play);\n        }\n    }\n    stop() {\n        if (this._playIndex > 0) {\n            this._clearInterval();\n            this._playIndex = 0;\n            this.setCurrentIndex(0);\n            this.events.dispatch(this.events.stop);\n        }\n    }\n    pause() {\n        if (this.isPlaying) {\n            this._clearInterval();\n            this.events.dispatch(this.events.pause);\n        }\n    }\n    _clearInterval() {\n        clearInterval(this._playIntervalHandler);\n        this._playIntervalHandler = -1;\n    }\n    /**\n     * Function sets layer index visible.\n     * @param {number} index\n     * @param {boolean} [stopPropagation=false]\n     */\n    setCurrentIndex(index, stopPropagation = false) {\n        this._setCurrentIndexAsync(index, true, stopPropagation);\n    }\n    /**\n     * Function sets layer index visible. If the layer is idle (all visible tiles loaded), sets opacity to one,\n     * otherwise to ZERO it means that when all visible tiles will be loaded the opacity becomes ONE. So, previous\n     * layer remains not transparent (opacity = 1) till current layer is loading.\n     */\n    _setCurrentIndexAsync(index, forceVisibility = false, stopPropagation = false) {\n        if (index != this._currentIndex && index >= 0 && index < this._layersArr.length) {\n            let prevCurrIndex = this._currentIndex;\n            this._currentIndex = index;\n            this._playIndex = index;\n            let prevCurrFrame = this._getFrameIndex(prevCurrIndex);\n            let currFrame = this._getFrameIndex(this._currentIndex);\n            let prevCurrLayer = this._layersArr[prevCurrIndex], currLayer = this._layersArr[index];\n            let frameChanged = currFrame != prevCurrFrame;\n            if (frameChanged) {\n                this._appendFrameToPlanet(currFrame);\n            }\n            if (prevCurrLayer) {\n                if (prevCurrLayer.isIdle) {\n                    this._currVisibleIndex = prevCurrIndex;\n                }\n                else {\n                    prevCurrLayer.opacity = 0;\n                    prevCurrLayer.setVisibility(false);\n                }\n            }\n            if (currLayer) {\n                currLayer.opacity = 0.0;\n                currLayer.setVisibility(true);\n                requestAnimationFrame(() => {\n                    if (currLayer.isIdle || forceVisibility) {\n                        currLayer.opacity = 1.0;\n                        // If frame is changed - remove it from the planet\n                        if (frameChanged) {\n                            this._removeFrameFromPlanet(prevCurrFrame);\n                        }\n                        if (prevCurrLayer) {\n                            prevCurrLayer.opacity = 0.0;\n                            prevCurrLayer.setVisibility(false);\n                        }\n                        let currVisibleLayer = this._layersArr[this._currVisibleIndex];\n                        if (currVisibleLayer) {\n                            currVisibleLayer.opacity = 0.0;\n                            currVisibleLayer.setVisibility(false);\n                        }\n                    }\n                });\n                if (!stopPropagation) {\n                    this.events.dispatch(this.events.change, this._currentIndex, prevCurrIndex);\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=LayerAnimation.js.map","import { Control } from \"./Control\";\nimport { Dialog } from \"../ui/Dialog\";\nimport { ToggleButton } from \"../ui/ToggleButton\";\nimport { View } from \"../ui/View\";\nimport { stringTemplate } from \"../utils/shared\";\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 1000 1000\" enable-background=\"new 0 0 1000 1000\" xml:space=\"preserve\">\n<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\n<g><path d=\"M500,573.5c-3.2,0-6.5-0.6-9.5-1.9L25,375.6c-9.1-3.8-15-12.7-15-22.6s5.9-18.8,15-22.6l465.5-196c6.1-2.5,12.9-2.5,19,0l465.5,196c9.1,3.8,15,12.7,15,22.6s-5.9,18.8-15,22.6l-465.5,196C506.5,572.9,503.2,573.5,500,573.5L500,573.5z M97.6,353L500,522.4L902.4,353L500,183.6L97.6,353L97.6,353z\"/><path d=\"M500,720.5c-3.2,0-6.5-0.6-9.5-1.9L25,522.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1s-0.6,26.9-13.1,32.1l-465.5,196C506.5,719.9,503.2,720.5,500,720.5L500,720.5z\"/><path d=\"M500,867.5c-3.2,0-6.5-0.6-9.5-1.9L25,669.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1c5.2,12.5-0.6,26.8-13.1,32.1l-465.5,196C506.5,866.9,503.2,867.5,500,867.5L500,867.5z\"/></g>\n</svg>`;\nconst TEMPLATE = `<div class=\"og-layerSwitcher\">\n      <div class=\"og-layerSwitcher__title\">Base Layers</div>\n      <div class=\"og-layerSwitcher__list og-layerSwitcher__baseLayers\"></div>        \n        \n      <div class=\"og-layerSwitcher__title\">Overlays</div>\n      <div class=\"og-layerSwitcher__list og-layerSwitcher__overlays\"></div>\n         \n    </div>`;\nconst LAYER_BUTTON_TEMPLATE = `<button title={title} class=\"og-layerSwitcher__layerButton\">{icon}<div class=\"og-layerSwitcher__name\">{name}</div></button>`;\nclass LayerButtonView extends View {\n    constructor(params) {\n        super({\n            template: stringTemplate(LAYER_BUTTON_TEMPLATE, {\n                title: params.model.name,\n                name: params.model.name,\n                icon: params.model.iconSrc ? `<img src=\"${params.model.iconSrc}\" />` : \"\"\n            }),\n            ...params\n        });\n        this._onVisibilityChange = (layer) => {\n            if (this.el) {\n                if (this.model.getVisibility()) {\n                    this.el.classList.add(\"og-layerSwitcher__visible\");\n                }\n                else {\n                    this.el.classList.remove(\"og-layerSwitcher__visible\");\n                }\n            }\n        };\n        this._onClick = () => {\n            if (this.model.isBaseLayer()) {\n                this.model.setVisibility(true);\n            }\n            else {\n                this.model.setVisibility(!this.model.getVisibility());\n            }\n        };\n        this._onDblClick = () => {\n            this.model.flyExtent();\n        };\n    }\n    render(params) {\n        super.render(params);\n        this.model.events.on(\"visibilitychange\", this._onVisibilityChange);\n        this._onVisibilityChange(this.model);\n        this.el.addEventListener(\"click\", this._onClick);\n        this.el.addEventListener(\"dblclick\", this._onDblClick);\n        return this;\n    }\n    remove() {\n        super.remove();\n        this.model.events.off(\"visibilitychange\", this._onVisibilityChange);\n    }\n}\n/**\n * Advanced :) layer switcher, includes base layers, overlays, geo images etc. groups.\n * Double click for zoom, drag-and-drop to change zIndex\n */\nexport class LayerSwitcher extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"LayerSwitcher\",\n            ...options\n        });\n        this.addLayer = (layer) => {\n            if (!layer.hideInLayerSwitcher) {\n                let layerView = this._createLayerButton(layer);\n                this._layerViews.push(layerView);\n                if (layer.isBaseLayer()) {\n                    layerView.appendTo(this.$baseLayers);\n                }\n                else {\n                    layerView.appendTo(this.$overlays);\n                }\n            }\n        };\n        this.removeLayer = (layer) => {\n            for (let i = 0; i < this._layerViews.length; i++) {\n                let li = this._layerViews[i];\n                if (li.model.isEqual(layer)) {\n                    li.remove();\n                    this._layerViews.splice(i, 1);\n                    break;\n                }\n            }\n        };\n        this._dialog = new Dialog({\n            title: \"Layer Switcher\",\n            top: 15,\n            useHide: true,\n            visible: false,\n            width: 300,\n            maxHeight: 500\n        });\n        this._panel = new View({\n            template: TEMPLATE\n        });\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-layerSwitcher_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        this.$baseLayers = null;\n        this.$overlays = null;\n        this._layerViews = [];\n    }\n    oninit() {\n        this._toggleBtn.appendTo(this.renderer.div);\n        this._dialog.appendTo(this.planet.renderer.div);\n        this._panel.appendTo(this._dialog.container);\n        this.$baseLayers = this._panel.el.querySelector(\".og-layerSwitcher__baseLayers\");\n        this.$overlays = this._panel.el.querySelector(\".og-layerSwitcher__overlays\");\n        this._dialog.setPosition(this.planet.renderer.div.clientWidth - this._dialog.width - 67);\n        this._dialog.events.on(\"visibility\", (v) => {\n            this._toggleBtn.setActive(v);\n        });\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            this._dialog.setVisibility(isActive);\n        });\n        this.planet.events.on(\"layeradd\", this.addLayer, this);\n        this.planet.events.on(\"layerremove\", this.removeLayer, this);\n        this._initLayers();\n    }\n    _initLayers() {\n        let layers = this.planet.layers;\n        for (let i = 0; i < layers.length; i++) {\n            this.addLayer(layers[i]);\n        }\n    }\n    _createLayerButton(layer) {\n        return new LayerButtonView({\n            model: layer\n        });\n    }\n    onactivate() {\n    }\n    ondeactivate() {\n        this._dialog.hide();\n    }\n}\n//# sourceMappingURL=LayerSwitcher.js.map","import { clamp } from '../math';\nimport { View } from './View';\nimport { stringTemplate } from '../utils/shared';\nconst SLIDER_EVENTS = [\"change\"];\nconst TEMPLATE = `<div class=\"og-slider\">\n      <div class=\"og-slider-label\">{label}</div>\n      <div class=\"og-slider-panel\">\n        <div class=\"og-slider-progress\"></div>      \n        <div class=\"og-slider-pointer\"></div>\n      </div>\n      <input type=\"number\"/>\n    </div>`;\nclass Slider extends View {\n    constructor(options = {}) {\n        super({\n            template: stringTemplate(TEMPLATE, {\n                label: options.label || \"\"\n            })\n        });\n        this._onResize = () => {\n            this._setOffset(this._value * this.$panel.clientWidth / (this._max - this._min));\n        };\n        this._onMouseWheel = (e) => {\n            //@ts-ignore\n            e = e || window.event;\n            e.preventDefault();\n            e.stopPropagation();\n            //@ts-ignore\n            this.value = this._value + Math.sign(e.wheelDelta) * (this._max - this._min) / 100.0;\n        };\n        this._onMouseWheelFF = (e) => {\n            this._onMouseWheel(e);\n        };\n        this._onInput = (e) => {\n            //@ts-ignore\n            e = e || window.event;\n            e.preventDefault();\n            e.stopPropagation();\n            //@ts-ignore\n            this.value = parseFloat(e.target.value);\n        };\n        this._onMouseDown = (e) => {\n            //@ts-ignore\n            e = e || window.event;\n            e.preventDefault();\n            this._startPosX = e.clientX;\n            this.value = this._min + (this._max - this._min) * (e.offsetX / this.$panel.clientWidth);\n            document.addEventListener(\"mousemove\", this._onMouseMove);\n            document.addEventListener(\"mouseup\", this._onMouseUp);\n        };\n        this._onMouseMove = (e) => {\n            //@ts-ignore\n            e = e || window.event;\n            e.preventDefault();\n            e.stopPropagation();\n            let rect = this.$panel.getBoundingClientRect();\n            let clientX = clamp(e.clientX, rect.left, rect.right);\n            let dx = this._startPosX - clientX;\n            this._startPosX = clientX;\n            this.value = (this.$pointer.offsetLeft - dx) * (this._max - this._min) / this.$panel.clientWidth;\n        };\n        this._onMouseUp = () => {\n            document.removeEventListener(\"mouseup\", this._onMouseUp);\n            document.removeEventListener(\"mousemove\", this._onMouseMove);\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(SLIDER_EVENTS);\n        this._value = options.value || 0.0;\n        this._min = options.min || 0.0;\n        this._max = options.max || 1.0;\n        //this._step = options.step || ((this._max - this._min) / 10.0);\n        this._resizeObserver = new ResizeObserver(this._onResize);\n        this._startPosX = 0;\n        this.$label = null;\n        this.$pointer = null;\n        this.$progress = null;\n        this.$input = null;\n        this.$panel = null;\n    }\n    render(params) {\n        super.render(params);\n        this.$label = this.select(\".og-slider-label\");\n        if (this.$label.innerHTML === \"\") {\n            this.$label.style.display = \"none\";\n        }\n        this.$pointer = this.select(\".og-slider-pointer\");\n        this.$progress = this.select(\".og-slider-progress\");\n        this.$panel = this.select(\".og-slider-panel\");\n        this.$input = this.select(\"input\");\n        this._resizeObserver.observe(this.el);\n        this._initEvents();\n        return this;\n    }\n    set value(val) {\n        if (val !== this._value) {\n            this._value = clamp(val, this._min, this._max);\n            this.$input.value = this._value.toString();\n            this._setOffset(this._value * this.$panel.clientWidth / (this._max - this._min));\n            this.events.dispatch(this.events.change, this._value, this);\n        }\n    }\n    get value() {\n        return this._value;\n    }\n    _initEvents() {\n        this.$panel.addEventListener(\"mousedown\", this._onMouseDown);\n        //@ts-ignore\n        this.$panel.addEventListener(\"mousewheel\", this._onMouseWheel);\n        this.$panel.addEventListener(\"wheel\", this._onMouseWheelFF);\n        this.$input.addEventListener(\"input\", this._onInput);\n    }\n    _clearEvents() {\n        this.$panel.removeEventListener(\"mousedown\", this._onMouseDown);\n        //@ts-ignore\n        this.$panel.removeEventListener(\"mousewheel\", this._onMouseWheel);\n        this.$panel.removeEventListener(\"wheel\", this._onMouseWheelFF);\n        this.$input.removeEventListener(\"input\", this._onInput);\n    }\n    _setOffset(x) {\n        if (x >= 0 && x <= this.$panel.clientWidth) {\n            this.$pointer.style.left = this.$progress.style.width = `${x * 100 / this.$panel.clientWidth}%`;\n        }\n    }\n    remove() {\n        this._clearEvents();\n        super.remove();\n    }\n}\nexport { Slider };\n//# sourceMappingURL=Slider.js.map","class Lock {\n    constructor() {\n        this._lock = 0;\n    }\n    lock(key) {\n        this._lock |= (1 << key.id);\n    }\n    free(key) {\n        this._lock &= ~(1 << key.id);\n    }\n    isFree() {\n        return this._lock === 0;\n    }\n    isLocked() {\n        return this._lock !== 0;\n    }\n}\nclass Key {\n    constructor() {\n        this.__id = Key.__counter__++;\n    }\n    get id() {\n        return this.__id;\n    }\n}\nKey.__counter__ = 0;\nexport { Lock, Key };\n//# sourceMappingURL=Lock.js.map","import * as math from \"../math\";\nimport { Control } from \"./Control\";\nimport { input } from \"../input/input\";\nimport { Key } from \"../Lock\";\nimport { LonLat } from \"../LonLat\";\nimport { Mat4 } from \"../math/Mat4\";\nimport { Quat } from \"../math/Quat\";\nimport { Ray } from \"../math/Ray\";\nimport { Sphere } from \"../bv/Sphere\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Mouse planet camera dragging control.\n */\nexport class MouseNavigation extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._deactivate = false;\n        this._shiftBusy = false;\n        this._name = \"mouseNavigation\";\n        this.grabbedPoint = new Vec3();\n        this._eye0 = new Vec3();\n        this.pointOnEarth = new Vec3();\n        this.earthUp = new Vec3();\n        this.inertia = 0.007;\n        this.grabbedSpheroid = new Sphere();\n        this.qRot = new Quat();\n        this.scaleRot = 0.0;\n        this.distDiff = 0.3;\n        this.stepsCount = 8;\n        this.stepsForward = null;\n        this.stepIndex = 0;\n        this._lmbDoubleClickActive = true;\n        this.minSlope = options.minSlope || 0.1;\n        this._wheelDirection = +1;\n        this._keyLock = new Key();\n    }\n    static getMovePointsFromPixelTerrain(cam, planet, stepsCount, delta, point, forward, dir) {\n        const steps = [];\n        let eye = cam.eye.clone(), n = cam._b.clone(), u = cam._r.clone(), v = cam._u.clone();\n        let a = planet.getCartesianFromPixelTerrain(point);\n        if (!a) {\n            a = planet.getCartesianFromPixelTerrain(planet.renderer.handler.getCenter());\n        }\n        if (a) {\n            if (!dir) {\n                dir = Vec3.sub(a, cam.eye).normalize();\n            }\n            let d = (delta * cam.eye.distance(a)) / stepsCount;\n            if (forward) {\n                d = -1.25 * d;\n            }\n            else {\n                d *= 2;\n            }\n            const scaled_n = n.scaleTo(d);\n            const slope = dir.dot(cam.eye.normal().negate());\n            if (slope >= 0.1) {\n                const grabbedSpheroid = new Sphere();\n                grabbedSpheroid.radius = a.length();\n                let rotArr = [], eyeArr = [];\n                let breaked = false;\n                for (let i = 0; i < stepsCount; i++) {\n                    eye.addA(scaled_n);\n                    const b = new Ray(eye, dir).hitSphere(grabbedSpheroid);\n                    eyeArr[i] = eye.clone();\n                    if (b) {\n                        rotArr[i] = new Mat4().rotateBetweenVectors(a.normal(), b.normal());\n                    }\n                    else {\n                        breaked = true;\n                        break;\n                    }\n                }\n                if (!breaked) {\n                    for (let i = 0; i < stepsCount; i++) {\n                        let rot = rotArr[i];\n                        steps[i] = {\n                            eye: rot.mulVec3(eyeArr[i]),\n                            v: rot.mulVec3(v),\n                            u: rot.mulVec3(u),\n                            n: rot.mulVec3(n)\n                        };\n                    }\n                }\n                else {\n                    eye = cam.eye.clone();\n                    for (let i = 0; i < stepsCount; i++) {\n                        steps[i] = {\n                            eye: eye.addA(scaled_n).clone(),\n                            v: v,\n                            u: u,\n                            n: n,\n                        };\n                    }\n                }\n            }\n            else {\n                for (let i = 0; i < stepsCount; i++) {\n                    steps[i] = {\n                        eye: eye.addA(dir.scaleTo(-d)).clone(),\n                        v: v,\n                        u: u,\n                        n: n,\n                    };\n                }\n            }\n            return steps;\n        }\n    }\n    onactivate() {\n        if (this.renderer) {\n            this.renderer.events.on(\"mousewheel\", this.onMouseWheel, this);\n            this.renderer.events.on(\"lhold\", this.onMouseLeftButtonDown, this);\n            this.renderer.events.on(\"rhold\", this.onMouseRightButtonDown, this);\n            this.renderer.events.on(\"ldown\", this.onMouseLeftButtonClick, this);\n            this.renderer.events.on(\"lup\", this.onMouseLeftButtonUp, this);\n            this.renderer.events.on(\"rdown\", this.onMouseRightButtonClick, this);\n            this.renderer.events.on(\"draw\", this.onDraw, this, -1000);\n            this.renderer.events.on(\"mousemove\", this.onMouseMove, this);\n            this.renderer.events.on(\"mouseleave\", this.onMouseLeave, this);\n            this.renderer.events.on(\"mouseenter\", this.onMouseEnter, this);\n            if (this._lmbDoubleClickActive) {\n                this.renderer.events.on(\"ldblclick\", this.onMouseLeftButtonDoubleClick, this);\n            }\n        }\n    }\n    ondeactivate() {\n        if (this.renderer) {\n            this.renderer.events.off(\"mousewheel\", this.onMouseWheel);\n            this.renderer.events.off(\"lhold\", this.onMouseLeftButtonDown);\n            this.renderer.events.off(\"rhold\", this.onMouseRightButtonDown);\n            this.renderer.events.off(\"ldown\", this.onMouseLeftButtonClick);\n            this.renderer.events.off(\"lup\", this.onMouseLeftButtonUp);\n            this.renderer.events.off(\"rdown\", this.onMouseRightButtonClick);\n            this.renderer.events.off(\"draw\", this.onDraw);\n            this.renderer.events.off(\"ldblclick\", this.onMouseLeftButtonDoubleClick);\n            this.renderer.events.off(\"mouseleave\", this.onMouseLeave);\n            this.renderer.events.off(\"mouseenter\", this.onMouseEnter);\n        }\n    }\n    activateDoubleClickZoom() {\n        if (!this._lmbDoubleClickActive) {\n            this._lmbDoubleClickActive = true;\n            this.renderer && this.renderer.events.on(\"ldblclick\", this.onMouseLeftButtonDoubleClick, this);\n        }\n    }\n    deactivateDoubleClickZoom() {\n        if (this._lmbDoubleClickActive) {\n            this._lmbDoubleClickActive = false;\n            this.renderer && this.renderer.events.off(\"ldblclick\", this.onMouseLeftButtonDoubleClick);\n        }\n    }\n    onMouseEnter(e) {\n        const renderEvents = this.renderer.events;\n        if (renderEvents.isKeyPressed(input.KEY_ALT)) {\n            renderEvents.releaseKeys();\n        }\n        renderEvents.updateButtonsStates(e.sys.buttons);\n        if (renderEvents.mouseState.leftButtonDown) {\n            this.renderer.handler.canvas.classList.add(\"ogGrabbingPoiner\");\n        }\n        else {\n            this.renderer.handler.canvas.classList.remove(\"ogGrabbingPoiner\");\n        }\n    }\n    onMouseLeave() {\n        if (this.renderer.events.mouseState.leftButtonDown) {\n            this.scaleRot = 0;\n        }\n        this.renderer.handler.canvas.classList.remove(\"ogGrabbingPoiner\");\n    }\n    onMouseWheel(e) {\n        if (this.stepIndex) {\n            return;\n        }\n        this.planet.stopFlying();\n        this.stopRotation();\n        this._deactivate = true;\n        this.lockPlanet(true);\n        this.stepsForward = MouseNavigation.getMovePointsFromPixelTerrain(this.planet.camera, this.planet, this.stepsCount, this.distDiff, e.pos, e.wheelDelta > 0, e.direction) || null;\n        this._wheelDirection = e.wheelDelta;\n        if (this.stepsForward) {\n            this.stepIndex = this.stepsCount;\n        }\n    }\n    oninit() {\n        this.activate();\n        if (this.renderer) {\n            this.renderer.events.on(\"keyfree\", input.KEY_ALT, this.onShiftFree, this);\n            this.renderer.events.on(\"keyfree\", input.KEY_PRINTSCREEN, this.onShiftFree, this);\n        }\n    }\n    onMouseLeftButtonDoubleClick(e) {\n        this.planet.stopFlying();\n        this.stopRotation();\n        const p = this.planet.getCartesianFromPixelTerrain(e.pos);\n        if (p) {\n            const cam = this.planet.camera;\n            let maxAlt = cam.maxAltitude + this.planet.ellipsoid.polarSize;\n            let minAlt = cam.minAltitude + this.planet.ellipsoid.polarSize;\n            const camAlt = cam.eye.length();\n            const g = this.planet.ellipsoid.cartesianToLonLat(p);\n            if (camAlt > maxAlt || camAlt < minAlt) {\n                this.planet.flyLonLat(new LonLat(g.lon, g.lat));\n                return;\n            }\n            if (this.renderer.events.isKeyPressed(input.KEY_ALT)) {\n                this.planet.flyLonLat(new LonLat(g.lon, g.lat, cam.eye.distance(p) * 2.0));\n            }\n            else {\n                this.planet.flyLonLat(new LonLat(g.lon, g.lat, cam.eye.distance(p) * 0.57));\n            }\n        }\n    }\n    onMouseLeftButtonClick() {\n        if (this._active) {\n            this.renderer.handler.canvas.classList.add(\"ogGrabbingPoiner\");\n            this.grabbedPoint = this.planet.getCartesianFromMouseTerrain();\n            if (this.grabbedPoint) {\n                this._eye0.copy(this.planet.camera.eye);\n                this.grabbedSpheroid.radius = this.grabbedPoint.length();\n                this.stopRotation();\n            }\n        }\n    }\n    stopRotation() {\n        this.qRot.clear();\n        this.freePlanet();\n    }\n    onMouseLeftButtonUp(e) {\n        this.renderer.handler.canvas.classList.remove(\"ogGrabbingPoiner\");\n        if (e.x === e.prev_x && e.y === e.prev_y) {\n            this.scaleRot = 0.0;\n        }\n    }\n    onMouseLeftButtonDown(e) {\n        if (this._active) {\n            if (!this.grabbedPoint) {\n                return;\n            }\n            this.planet.stopFlying();\n            if (e.moving) {\n                let cam = this.planet.camera;\n                if (cam.slope > 0.2) {\n                    const targetPoint = new Ray(cam.eye, e.direction).hitSphere(this.grabbedSpheroid);\n                    if (targetPoint) {\n                        this.scaleRot = 1.0;\n                        this.qRot = Quat.getRotationBetweenVectors(targetPoint.normal(), this.grabbedPoint.normal());\n                        let rot = this.qRot;\n                        cam.eye = rot.mulVec3(cam.eye);\n                        cam._u = rot.mulVec3(cam._u);\n                        cam._r = rot.mulVec3(cam._r);\n                        cam._b = rot.mulVec3(cam._b);\n                    }\n                }\n                else {\n                    let p0 = this.grabbedPoint, p1 = Vec3.add(p0, cam._r), p2 = Vec3.add(p0, p0.normal());\n                    let px = new Vec3();\n                    if (new Ray(cam.eye, e.direction).hitPlane(p0, p1, p2, px) === Ray.INSIDE) {\n                        cam.eye = this._eye0.addA(px.subA(p0).negate());\n                    }\n                }\n            }\n        }\n    }\n    onMouseRightButtonClick(e) {\n        this.stopRotation();\n        this.planet.stopFlying();\n        this.pointOnEarth = this.planet.getCartesianFromPixelTerrain(e.pos);\n        if (this.pointOnEarth) {\n            this.earthUp = this.pointOnEarth.normal();\n        }\n    }\n    onMouseRightButtonDown(e) {\n        const cam = this.planet.camera;\n        if (this.pointOnEarth && e.moving) {\n            this.renderer.controlsBag.scaleRot = 1.0;\n            let l = (0.5 / cam.eye.distance(this.pointOnEarth)) * (cam._lonLat.height < 5.0 ? 5.0 : cam._lonLat.height) * math.RADIANS;\n            if (l > 0.007) {\n                l = 0.007;\n            }\n            cam.rotateHorizontal(l * (e.x - e.prev_x), false, this.pointOnEarth, this.earthUp);\n            cam.rotateVertical(l * (e.y - e.prev_y), this.pointOnEarth, this.minSlope);\n        }\n    }\n    onShiftFree() {\n        this._shiftBusy = false;\n    }\n    onMouseMove(e) {\n        if (this._active && this.renderer.events.isKeyPressed(input.KEY_ALT)) {\n            if (!this._shiftBusy) {\n                this._shiftBusy = true;\n                this.onMouseRightButtonClick(e);\n            }\n            this.onMouseRightButtonDown(e);\n        }\n    }\n    onDraw() {\n        if (this._active) {\n            const r = this.renderer;\n            const cam = this.planet.camera;\n            let prevEye = cam.eye.clone();\n            if (this.stepIndex) {\n                r.controlsBag.scaleRot = 1.0;\n                const sf = this.stepsForward[this.stepsCount - this.stepIndex--];\n                let maxAlt = cam.maxAltitude + this.planet.ellipsoid.polarSize;\n                let minAlt = cam.minAltitude + this.planet.ellipsoid.polarSize;\n                const camAlt = sf.eye.length();\n                if (camAlt > maxAlt || camAlt < minAlt && this._wheelDirection > 0) {\n                    this._wheelDirection = +1;\n                    return;\n                }\n                cam.eye = sf.eye;\n                cam._u = sf.v;\n                cam._r = sf.u;\n                cam._b = sf.n;\n            }\n            else {\n                if (this._deactivate) {\n                    this._deactivate = false;\n                    this.freePlanet();\n                }\n            }\n            if (r.events.mouseState.leftButtonDown || !this.scaleRot) {\n                return;\n            }\n            this.scaleRot -= this.inertia;\n            if (this.scaleRot <= 0.0) {\n                this.scaleRot = 0.0;\n            }\n            else {\n                r.controlsBag.scaleRot = this.scaleRot;\n                let rot = this.qRot\n                    .slerp(Quat.IDENTITY, 1.0 - this.scaleRot * this.scaleRot * this.scaleRot)\n                    .normalize();\n                if (!(rot.x || rot.y || rot.z)) {\n                    this.scaleRot = 0.0;\n                }\n                cam.eye = rot.mulVec3(cam.eye);\n                cam._u = rot.mulVec3(cam._u);\n                cam._r = rot.mulVec3(cam._r);\n                cam._b = rot.mulVec3(cam._b);\n            }\n            if (cam.eye.distance(prevEye) / cam.getAltitude() > 0.01) {\n                this.lockPlanet();\n            }\n            else {\n                this.freePlanet();\n            }\n        }\n    }\n    lockPlanet(skipTerrain) {\n        this.planet.layerLock.lock(this._keyLock);\n        !skipTerrain && this.planet.terrainLock.lock(this._keyLock);\n        this.planet._normalMapCreator.lock(this._keyLock);\n    }\n    freePlanet() {\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet._normalMapCreator.free(this._keyLock);\n    }\n}\n//# sourceMappingURL=MouseNavigation.js.map","import { Entity } from '../../entity/Entity';\nimport { createEvents } from '../../Events';\nimport { Object3d } from '../../Object3d';\nimport { RenderNode } from '../../scene/RenderNode';\nimport { Vector } from '../../layer/Vector';\nimport { Vec2 } from '../../math/Vec2';\nconst OUTLINE_COUNT = 120;\nexport const distanceFormat = (v) => {\n    if (v > 1000) {\n        return `${(v / 1000).toFixed(1)} km`;\n    }\n    else if (v > 9) {\n        return `${Math.round(v)} m`;\n    }\n    else {\n        return `${v.toFixed(1)} m`;\n    }\n};\nlet obj3d = Object3d.createCylinder(1.1, 0, 2.7, 20, 1, true, false, 0, 0, 0);\nconst LABEL_OPTIONS = {\n    text: \"\",\n    size: 11,\n    color: \"rgba(455,455,455,1.0)\",\n    outlineColor: \"rgba(0,0,0,0.34)\",\n    outline: 0.23,\n    align: \"center\",\n    offset: [0, 20, 0]\n};\nconst RULER_CORNER_OPTIONS = {\n    scale: 1,\n    instanced: true,\n    tag: \"ruler\",\n    color: \"rgb(0,305,0)\",\n    object3d: obj3d\n};\nclass RulerScene extends RenderNode {\n    constructor(options = {}) {\n        super(options.name);\n        this._onCornerLdown = (e) => {\n            if (!this._startLonLat) {\n                this.renderer?.controls.mouseNavigation?.deactivate();\n                this._startClick.set(e.x, e.y);\n                let coords = e.pickingObject.getCartesian();\n                this._startPos = this._planet.getPixelFromCartesian(coords);\n                this._pickedCorner = e.pickingObject;\n                if (e.pickingObject.properties.name == \"start\") {\n                    this._anchorLonLat = this._cornerEntity[1].getLonLat().clone();\n                }\n                else {\n                    this._anchorLonLat = this._cornerEntity[0].getLonLat().clone();\n                }\n            }\n        };\n        this._onLUp = () => {\n            if (this._pickedCorner) {\n                this.renderer.controls.mouseNavigation?.activate();\n                this._pickedCorner = null;\n                this._anchorLonLat = null;\n            }\n        };\n        this._onCornerLup = () => {\n            this._onLUp();\n        };\n        this._onCornerEnter = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"pointer\";\n        };\n        this._onCornerLeave = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"default\";\n        };\n        this._onLdblclick = () => {\n            this._preventClick = true;\n        };\n        this._onLclick = (e) => {\n            let startLonLat = this._planet.getLonLatFromPixelTerrain(e.pos);\n            if (!startLonLat)\n                return;\n            this._timeout = setTimeout(() => {\n                if (!this._preventClick) {\n                    if (!this._startLonLat) {\n                        this.setVisibility(true);\n                        this._stopDrawing = false;\n                        this._startLonLat = startLonLat;\n                    }\n                    else {\n                        this._startLonLat = null;\n                    }\n                }\n                this._preventClick = false;\n                this._stopDrawing = false;\n                clearTimeout(this._timeout);\n            }, 200);\n            if (this._startLonLat) {\n                this._stopDrawing = true;\n            }\n        };\n        this._onMouseMove = (e) => {\n            if (this._startLonLat && !this._stopDrawing) {\n                this._propsLabel.label.setVisibility(true);\n                let endLonLat = this._planet.getLonLatFromPixelTerrain(e.pos);\n                if (!endLonLat)\n                    return;\n                this._drawLine(this._startLonLat, endLonLat);\n            }\n            else if (this._pickedCorner) {\n                let newLonLat = this._planet.getLonLatFromPixelTerrain(e.pos);\n                if (newLonLat) {\n                    if (this._pickedCorner.properties.name === \"start\") {\n                        this._drawLine(newLonLat, this._anchorLonLat);\n                    }\n                    else {\n                        this._drawLine(this._anchorLonLat, newLonLat);\n                    }\n                }\n            }\n        };\n        this.events = createEvents(RULERSCENE_EVENTS);\n        this._ignoreTerrain = options.ignoreTerrain != undefined ? options.ignoreTerrain : true;\n        this._planet = options.planet || null;\n        this._startLonLat = null;\n        this._preventClick = false;\n        this._stopDrawing = false;\n        this._pickedCorner = null;\n        this._startPos = null;\n        this._startClick = new Vec2();\n        this._anchorLonLat = null;\n        this._heading = 0;\n        this._trackLayer = new Vector(\"track\", {\n            entities: [],\n            pickingEnabled: false,\n            polygonOffsetUnits: -1.0,\n            relativeToGround: true,\n            hideInLayerSwitcher: true\n        });\n        this._labelLayer = new Vector(\"ruler-label\", {\n            entities: [],\n            pickingEnabled: false,\n            polygonOffsetUnits: -100.0,\n            relativeToGround: true,\n            hideInLayerSwitcher: true\n        });\n        this._cornersLayer = new Vector(\"corners\", {\n            entities: [],\n            pickingEnabled: true,\n            hideInLayerSwitcher: true,\n            scaleByDistance: [100, 4000000, 1.0],\n            pickingScale: 2\n        });\n        this._propsLabel = new Entity({\n            name: 'propsLabel',\n            label: LABEL_OPTIONS\n        });\n        this._trackEntity = new Entity({\n            polyline: {\n                path3v: [],\n                thickness: 4.8,\n                color: \"rgb(255,131,0)\",\n                isClosed: false\n            }\n        });\n        this._trackEntity.polyline.altitude = 0.01;\n        this._cornerEntity = [\n            new Entity({\n                geoObject: RULER_CORNER_OPTIONS,\n                properties: {\n                    name: \"start\"\n                }\n            }),\n            new Entity({\n                geoObject: RULER_CORNER_OPTIONS,\n                properties: {\n                    name: \"end\"\n                }\n            })\n        ];\n    }\n    set ignoreTerrain(v) {\n        this._ignoreTerrain = v;\n        if (v) {\n            //...redraw line\n        }\n    }\n    bindPlanet(planet) {\n        this._planet = planet;\n    }\n    _createCorners() {\n        this._cornersLayer.addEntities(this._cornerEntity);\n    }\n    init() {\n        this._createCorners();\n        this._trackLayer.addEntities([this._trackEntity]);\n        this._labelLayer.addEntities([this._propsLabel]);\n        this._planet.addLayer(this._labelLayer);\n        this._planet.addLayer(this._trackLayer);\n        this._planet.addLayer(this._cornersLayer);\n        this._activate();\n    }\n    onremove() {\n        this._deactivate();\n    }\n    _activate() {\n        this._propsLabel.label.setVisibility(false);\n        this.setVisibility(false);\n        this.renderer.events.on(\"lclick\", this._onLclick, this);\n        this.renderer.events.on(\"mousemove\", this._onMouseMove, this);\n        this.renderer.events.on(\"ldblclick\", this._onLdblclick, this);\n        this.renderer.events.on(\"lup\", this._onLUp, this);\n        this._cornersLayer.events.on(\"mouseenter\", this._onCornerEnter, this);\n        this._cornersLayer.events.on(\"mouseleave\", this._onCornerLeave, this);\n        this._cornersLayer.events.on(\"ldown\", this._onCornerLdown, this);\n        this._cornersLayer.events.on(\"lup\", this._onCornerLup, this);\n    }\n    _deactivate() {\n        this._startLonLat = null;\n        this._preventClick = false;\n        this._stopDrawing = false;\n        this._pickedCorner = null;\n        // this._trackLayer.remove();\n        // this._cornersLayer.remove();\n        this.renderer.events.off(\"lclick\", this._onLclick);\n        this.renderer.events.off(\"mousemove\", this._onMouseMove);\n        this.renderer.events.off(\"lup\", this._onLUp);\n        this._cornersLayer.events.off(\"mouseenter\", this._onCornerEnter);\n        this._cornersLayer.events.off(\"mouseleave\", this._onCornerLeave);\n        this._cornersLayer.events.off(\"ldown\", this._onCornerLdown);\n        this._cornersLayer.events.off(\"lup\", this._onCornerLup);\n        this.clear();\n    }\n    setVisibility(visibility) {\n        this._cornersLayer.setVisibility(visibility);\n        this._trackLayer.setVisibility(visibility);\n        this._labelLayer.setVisibility(visibility);\n    }\n    _drawLine(startLonLat, endLonLat, startPos) {\n        if (!startPos) {\n            startPos = this._planet.ellipsoid.lonLatToCartesian(startLonLat);\n        }\n        let endPos = this._planet.ellipsoid.lonLatToCartesian(endLonLat);\n        let res = this._planet.ellipsoid.inverse(startLonLat, endLonLat);\n        let length = res.distance;\n        this._heading = res.initialAzimuth;\n        let path = [];\n        let dir = endPos.sub(startPos);\n        let dist = dir.length();\n        dir.normalize();\n        for (let i = 0; i < OUTLINE_COUNT; i++) {\n            let f = dir.scaleTo(i * dist / OUTLINE_COUNT).addA(startPos);\n            path.push(f);\n        }\n        path.push(endPos);\n        this._trackEntity.polyline.setPath3v([path]);\n        if (this._ignoreTerrain) {\n            this._propsLabel.setCartesian3v(path[Math.floor(path.length / 2)]);\n            this._propsLabel.label.setText(`${distanceFormat(length)}, ${Math.round(this._heading)} deg`);\n        }\n    }\n    clear() {\n        this._trackEntity.remove();\n        this._cornerEntity[0].remove();\n        this._cornerEntity[1].remove();\n        this._propsLabel.remove();\n        this._planet.removeLayer(this._trackLayer);\n        this._planet.removeLayer(this._cornersLayer);\n    }\n    isCornersPositionChanged() {\n        let t = this._trackEntity.polyline.getPath3v()[0];\n        if (t) {\n            const startPos = t[0].clone(), endPos = t[t.length - 1].clone();\n            return this._cornerEntity[0].getCartesian().equal(startPos) &&\n                this._cornerEntity[1].getCartesian().equal(endPos);\n        }\n        return false;\n    }\n    frame() {\n        let t = this._trackEntity.polyline.getPath3v()[0];\n        if (t) {\n            const startPos = t[0].clone(), endPos = t[t.length - 1].clone();\n            if (!this.isCornersPositionChanged()) {\n                this._cornerEntity[0].setCartesian3v(startPos);\n                this._cornerEntity[1].setCartesian3v(endPos);\n                if (!this._ignoreTerrain) {\n                    let res = 0;\n                    for (let i = 0, len = t.length - 1; i < len; i++) {\n                        res += t[i + 1].distance(t[i]);\n                    }\n                    this._propsLabel.setCartesian3v(t[Math.floor(t.length / 2)]);\n                    this._propsLabel.label.setText(`${distanceFormat(res)}, ${Math.round(this._heading)} deg`);\n                }\n            }\n        }\n    }\n    get ellipsoid() {\n        return this._planet ? this._planet.ellipsoid : null;\n    }\n}\nconst RULERSCENE_EVENTS = [\n    \"add\",\n    \"remove\",\n    \"mousemove\",\n    \"mouseenter\",\n    \"mouseleave\",\n    \"lclick\",\n    \"rclick\",\n    \"mclick\",\n    \"ldblclick\",\n    \"rdblclick\",\n    \"mdblclick\",\n    \"lup\",\n    \"rup\",\n    \"mup\",\n    \"ldown\",\n    \"rdown\",\n    \"mdown\",\n    \"lhold\",\n    \"rhold\",\n    \"mhold\",\n    \"mousewheel\",\n    \"touchmove\",\n    \"touchstart\",\n    \"touchend\",\n    \"doubletouch\",\n    \"touchleave\",\n    \"touchenter\"\n];\nexport { RulerScene };\n//# sourceMappingURL=RulerScene.js.map","import { Control } from \"../Control\";\nimport { RulerScene } from \"./RulerScene\";\nexport class Ruler extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._rulerScene = new RulerScene({\n            name: `rulerScene:${this.__id}`,\n            ignoreTerrain: options.ignoreTerrain\n        });\n    }\n    set ignoreTerrain(v) {\n        this._rulerScene.ignoreTerrain = v;\n    }\n    oninit() {\n        this._rulerScene.bindPlanet(this.planet);\n    }\n    onactivate() {\n        this.renderer && this.renderer.addNode(this._rulerScene);\n    }\n    ondeactivate() {\n        this.renderer && this.renderer.removeNode(this._rulerScene);\n    }\n}\n//# sourceMappingURL=Ruler.js.map","import { Entity } from '../../entity/Entity';\nimport { Object3d } from \"../../Object3d\";\nimport { RulerScene } from \"../ruler/RulerScene\";\nimport { Vector } from \"../../layer/Vector\";\nlet obj3d = Object3d.createCylinder(1.1, 0, 2, 6, 1, true, true, 0, 0, 0);\nconst RAYS_OPTIONS = {\n    startColor: \"rgb(255,131,0)\",\n    endColor: \"rgb(255,131,0)\",\n    thickness: 5\n};\nconst LABEL_OPTIONS = {\n    text: \"\",\n    size: 11,\n    color: \"rgba(455,455,455,1.0)\",\n    outlineColor: \"rgba(0,0,0,0.34)\",\n    outline: 0.23,\n    align: \"center\",\n    offset: [0, 18, 0]\n};\nconst RULER_CORNER_OPTIONS = {\n    scale: 1,\n    instanced: true,\n    tag: \"height-ruler\",\n    color: \"rgb(255,131,0)\",\n    object3d: obj3d\n};\nclass HeightRulerScene extends RulerScene {\n    constructor(options = {}) {\n        super(options);\n        this._geoRulerLayer = new Vector(\"rayHeightRuler\", {\n            entities: [],\n            pickingEnabled: false,\n            polygonOffsetUnits: -2.0,\n            relativeToGround: false,\n            hideInLayerSwitcher: true\n        });\n        this._rayV = new Entity({\n            name: 'verticalRay',\n            ray: RAYS_OPTIONS\n        });\n        this._rayH = new Entity({\n            name: 'heightRay',\n            ray: RAYS_OPTIONS\n        });\n        this._heightLabels = [\n            new Entity({\n                name: 'startCornerLabel',\n                label: {\n                    ...LABEL_OPTIONS\n                }\n            }),\n            new Entity({\n                name: 'endCornerLabel',\n                label: {\n                    ...LABEL_OPTIONS\n                }\n            }),\n            new Entity({\n                name: 'deltaLabel',\n                label: {\n                    ...LABEL_OPTIONS\n                }\n            })\n        ];\n    }\n    setVisibility(visibility) {\n        super.setVisibility(visibility);\n        this._geoRulerLayer.setVisibility(visibility);\n    }\n    get deltaLabel() {\n        return this._heightLabels[2];\n    }\n    get startLabel() {\n        return this._heightLabels[0];\n    }\n    get endLabel() {\n        return this._heightLabels[1];\n    }\n    get corners() {\n        return this._cornerEntity;\n    }\n    get startCorner() {\n        return this.corners[0];\n    }\n    get endCorner() {\n        return this.corners[1];\n    }\n    get startCornerLonLat() {\n        return this.startCorner.getLonLat();\n    }\n    get startCornerHeight() {\n        return this.startCornerLonLat.height;\n    }\n    get endCornerLonLat() {\n        return this.endCorner.getLonLat();\n    }\n    get endCornerHeight() {\n        return this.endCornerLonLat.height;\n    }\n    get maxHeightCornerLonLat() {\n        if (this.startCornerHeight <= this.endCornerHeight) {\n            return this.endCornerLonLat;\n        }\n        else {\n            return this.startCornerLonLat;\n        }\n    }\n    get minHeightCornerLonLat() {\n        if (this.startCornerHeight > this.endCornerHeight) {\n            return this.endCornerLonLat;\n        }\n        else {\n            return this.startCornerLonLat;\n        }\n    }\n    get deltaHeight() {\n        return Math.abs(this.startCornerHeight - this.endCornerHeight);\n    }\n    _drawLine(startLonLat, endLonLat, startPos) {\n        super._drawLine(startLonLat, endLonLat, startPos);\n        this._updateHeightRaysAndLabels();\n    }\n    async _updateHeightRaysAndLabels() {\n        const middleLonLat = this.minHeightCornerLonLat.clone();\n        middleLonLat.height = this.maxHeightCornerLonLat.height;\n        this._rayH.ray.setStartPosition3v(this._planet.ellipsoid.lonLatToCartesian(this.maxHeightCornerLonLat));\n        this._rayH.ray.setEndPosition3v(this._planet.ellipsoid.lonLatToCartesian(middleLonLat));\n        this._rayV.ray.setStartPosition3v(this._planet.ellipsoid.lonLatToCartesian(this.minHeightCornerLonLat));\n        this._rayV.ray.setEndPosition3v(this._planet.ellipsoid.lonLatToCartesian(middleLonLat));\n        middleLonLat.height = this.minHeightCornerLonLat.height + this.deltaHeight / 2;\n        this.deltaLabel.setLonLat(middleLonLat);\n        this.startLabel.setLonLat(this.startCornerLonLat);\n        this.endLabel.setLonLat(this.endCornerLonLat);\n        const startHeight = await this._planet.getHeightDefault(this.startCornerLonLat), endHeight = await this._planet.getHeightDefault(this.endCornerLonLat);\n        this.deltaLabel.label.setText(`\\u0394 ${Math.abs(startHeight - endHeight).toFixed(1)} m`);\n        this.startLabel.label.setText(`P1 ${startHeight.toFixed(1)} m`);\n        this.endLabel.label.setText(`P2 ${endHeight.toFixed(1)} m`);\n    }\n    clear() {\n        this._rayH.remove();\n        this._rayV.remove();\n        this.startCorner.remove();\n        this.endCorner.remove();\n        this.startLabel.remove();\n        this.endLabel.remove();\n        this.deltaLabel.remove();\n        super.clear();\n        // this._rayH = null;\n        // this._rayV = null;\n        this._planet.removeLayer(this._geoRulerLayer);\n    }\n    _createCorners() {\n        this._cornerEntity = [\n            new Entity({\n                geoObject: RULER_CORNER_OPTIONS,\n                properties: {\n                    name: \"start\"\n                }\n            }),\n            new Entity({\n                geoObject: RULER_CORNER_OPTIONS,\n                properties: {\n                    name: \"end\"\n                }\n            })\n        ];\n        this._cornersLayer.setEntities(this._cornerEntity);\n    }\n    init() {\n        super.init();\n        this._createCorners();\n        this._labelLayer.addEntities(this._heightLabels);\n        this._geoRulerLayer.addEntities([this._rayH, this._rayV]);\n        this._planet.addLayer(this._geoRulerLayer);\n    }\n    frame() {\n        super.frame();\n        this._updateHeightRaysAndLabels();\n    }\n}\nexport { HeightRulerScene };\n//# sourceMappingURL=HeightRulerScene.js.map","import { Ruler } from \"../ruler/Ruler\";\nimport { HeightRulerScene } from \"./HeightRulerScene\";\nexport class HeightRuler extends Ruler {\n    constructor(options = {}) {\n        super(options);\n        this._rulerScene = new HeightRulerScene({\n            name: `heightRulerScene:${this.__id}`,\n            ignoreTerrain: false\n        });\n    }\n}\n//# sourceMappingURL=HeightRuler.js.map","import { binarySearch, parseHTML } from \"../utils/shared\";\nimport { Control } from \"./Control\";\nimport { RADIANS } from \"../math\";\nimport { Vec3 } from \"../math/Vec3\";\nconst scale = [\n    1, 2, 3, 5, 10, 20, 30, 50, 100, 200, 300, 500, 1e3, 2e3, 3e3, 5e3, 10e3, 20e3, 30e3, 50e3,\n    100e3, 200e3, 300e3, 500e3, 1000e3, 2000e3, 3000e3, 5000e3, 10000e3\n];\nconst TEMPLATE = `<div class=\"og-scale-container\">\n      <div class=\"og-scale-label\"></div>\n      <div class=\"og-scale-ruler\"></div>\n    </div>`;\n/**\n * Planet zoom buttons control.\n */\nexport class ScaleControl extends Control {\n    constructor(options = {}) {\n        if (!options.name || options.name === \"\") {\n            options.name = \"scaleControl\";\n        }\n        super(options);\n        this._template = TEMPLATE;\n        this._minWidth = 100;\n        this._maxWidth = 150;\n        this._isCenter = options.isCenter != undefined ? options.isCenter : true;\n        this._mPx = 0;\n        this.currWidth = 0;\n        this._metersInMinSize = 0;\n        this.el = null;\n        this._scaleLabelEl = null;\n    }\n    _renderTemplate() {\n        return parseHTML(this._template)[0];\n    }\n    oninit() {\n        this.el = this._renderTemplate();\n        this._scaleLabelEl = this.el.querySelector(\".og-scale-label\");\n        this.renderer.div.appendChild(this.el);\n        if (this._isCenter) {\n            this.planet.camera.events.on(\"moveend\", () => {\n                this._drawScreen(this.planet.renderer.handler.getCenter());\n            });\n            !this.planet.terrain.isEmpty && this.planet.terrain.events.on(\"loadend\", () => {\n                this._drawScreen(this.planet.renderer.handler.getCenter());\n            });\n        }\n        else {\n            this.renderer.events.on(\"mousemove\", (e) => {\n                if (!e.leftButtonHold && !e.rightButtonHold) {\n                    this._drawScreen(e.pos);\n                }\n            });\n            this.planet.camera.events.on(\"moveend\", () => {\n                let ms = this.renderer.events.mouseState;\n                if (!ms.leftButtonHold && !ms.rightButtonHold) {\n                    this._drawScreen(ms.pos);\n                }\n            });\n        }\n    }\n    _drawScreen(px) {\n        let cam = this.planet.camera;\n        let s0 = px;\n        let dist = this.planet.getDistanceFromPixel(s0) || 0;\n        if (dist === 0) {\n            s0 = cam.project(Vec3.ZERO);\n            dist = this.planet.getDistanceFromPixel(s0) || 0;\n        }\n        let p0 = cam.getForward().scaleTo(dist).addA(cam.eye);\n        let tempSize = dist * Math.tan(cam.viewAngle * RADIANS);\n        let p1 = p0.add(cam.getRight().scaleTo(tempSize));\n        let s1 = cam.project(p1);\n        this._mPx = tempSize / s1.distance(s0);\n        let metersInMinSize = this._mPx * this._minWidth;\n        let index = binarySearch(scale, metersInMinSize, (a, b) => a - b);\n        if (index < 0) {\n            index = ~index;\n        }\n        let minMeters = scale[index], maxMeters = scale[index + 1];\n        let t = (minMeters - metersInMinSize) / (maxMeters - minMeters);\n        this.currWidth = this._minWidth + t * (this._maxWidth - this._minWidth);\n        if (minMeters > 1000) {\n            this._scaleLabelEl.innerText = `${minMeters / 1000} km`;\n        }\n        else {\n            this._scaleLabelEl.innerText = `${minMeters} m`;\n        }\n        this._metersInMinSize = metersInMinSize;\n        this.el.style.width = this.currWidth + \"px\";\n    }\n}\n//# sourceMappingURL=ScaleControl.js.map","import { Control } from \"./Control\";\nimport { htmlColorToRgb } from \"../utils/shared\";\nimport { Program } from '../webgl/Program';\nexport class SimpleSkyBackground extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"SimpleSkyBackground\",\n            ...options\n        });\n        this._colorOne = new Float32Array([1.0, 1.0, 1.0]);\n        this._colorTwo = new Float32Array([0.0, 153.0 / 255.0, 221.0 / 255.0]);\n    }\n    set colorOne(htmlColor) {\n        let rgb = htmlColorToRgb(htmlColor);\n        this._colorOne[0] = rgb.x;\n        this._colorOne[1] = rgb.y;\n        this._colorOne[2] = rgb.z;\n    }\n    set colorTwo(htmlColor) {\n        let rgb = htmlColorToRgb(htmlColor);\n        this._colorTwo[0] = rgb.x;\n        this._colorTwo[1] = rgb.y;\n        this._colorTwo[2] = rgb.z;\n    }\n    oninit() {\n        this.renderer.handler.addProgram(simpleSkyBackgroundShader());\n        this.activate();\n    }\n    onactivate() {\n        super.onactivate();\n        this.planet.events.on(\"draw\", this._drawBackground, this);\n    }\n    ondeactivate() {\n        super.ondeactivate();\n        this.planet.events.off(\"draw\", this._drawBackground);\n    }\n    _drawBackground() {\n        let h = this.renderer.handler;\n        let sh = h.programs.simpleSkyBackground, p = sh._program, shu = p.uniforms, gl = h.gl;\n        let cam = this.planet.camera;\n        gl.disable(gl.DEPTH_TEST);\n        sh.activate();\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.renderer.screenFramePositionBuffer);\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\n        gl.uniform3fv(shu.camPos, [cam.eye.x, cam.eye.y, cam.eye.z]);\n        gl.uniform2fv(shu.iResolution, [h.getWidth(), h.getHeight()]);\n        gl.uniform1f(shu.fov, cam.getViewAngle());\n        gl.uniform1f(shu.earthRadius, this.planet.ellipsoid.getPolarSize() + 1);\n        gl.uniform3fv(shu.colorOne, this._colorOne);\n        gl.uniform3fv(shu.colorTwo, this._colorTwo);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        gl.enable(gl.DEPTH_TEST);\n    }\n}\nfunction simpleSkyBackgroundShader() {\n    return new Program(\"simpleSkyBackground\", {\n        uniforms: {\n            iResolution: \"vec2\", fov: \"float\",\n            camPos: \"vec3\",\n            earthRadius: \"float\",\n            viewMatrix: \"mat4\",\n            colorOne: \"vec3\",\n            colorTwo: \"vec3\"\n        }, attributes: {\n            corners: \"vec3\"\n        },\n        vertexShader: `attribute vec2 corners;\n                        \n            varying vec2 tc;\n            \n            void main(void) {\n                gl_Position = vec4(corners, 0.0, 1.0);\n                tc = corners * 0.5 + 0.5;\n            }`,\n        fragmentShader: `precision highp float;\n            \n            #define MAX 10e10\n            #define PI 3.14159265359\n            #define rad(x) x * PI / 180.\n            #define ZERO vec3(0.0)          \n           \n            #define RED vec4(1.0, 0.0, 0.0, 1.0)\n            #define GREEN vec4(0.0, 1.0, 0.0, 1.0)         \n            \n            uniform vec3 camPos;            \n            uniform vec2 iResolution;\n            uniform float fov;\n            uniform float earthRadius;\n            uniform mat4 viewMatrix;\n            \n            uniform vec3 colorOne;\n            uniform vec3 colorTwo;\n                         \n            varying vec2 tc;\n                        \n            // compute the view ray in the camera coordinate\n            vec3 computeView(vec2 uv){\n                float w_h_ratio = iResolution.x / iResolution.y;   \n                float h = tan(rad(fov/2.));\n                return normalize(vec3(-w_h_ratio * h, -h, -1.) + vec3(uv.x * 2. * h * w_h_ratio, uv.y*2.*h, 0.));\n            }\n\n            // sphere of size ra centered at point ce\n            vec2 sphIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra )\n            {\n                vec3 oc = ro - ce;\n                float b = dot( oc, rd );\n                float c = dot( oc, oc ) - ra * ra;\n                float h = b * b - c;\n                if( h < 0.0 ) return vec2(MAX); // no intersection\n                h = sqrt( h );\n                return vec2( -b-h, -b+h );\n            }\n            \n            mat3 transpose(mat3 matrix) {\n                vec3 row0 = matrix[0];\n                vec3 row1 = matrix[1];\n                vec3 row2 = matrix[2];\n                mat3 result = mat3(\n                    vec3(row0.x, row1.x, row2.x),\n                    vec3(row0.y, row1.y, row2.y),\n                    vec3(row0.z, row1.z, row2.z)\n                );\n                return result;\n            }\n            \n            float det(mat2 matrix) {\n                return matrix[0].x * matrix[1].y - matrix[0].y * matrix[1].x;\n            }\n            \n            mat3 inverse(mat3 matrix) {\n                vec3 row0 = matrix[0];\n                vec3 row1 = matrix[1];\n                vec3 row2 = matrix[2];\n            \n                vec3 minors0 = vec3(\n                    det(mat2(row1.y, row1.z, row2.y, row2.z)),\n                    det(mat2(row1.z, row1.x, row2.z, row2.x)),\n                    det(mat2(row1.x, row1.y, row2.x, row2.y))\n                );\n                vec3 minors1 = vec3(\n                    det(mat2(row2.y, row2.z, row0.y, row0.z)),\n                    det(mat2(row2.z, row2.x, row0.z, row0.x)),\n                    det(mat2(row2.x, row2.y, row0.x, row0.y))\n                );\n                vec3 minors2 = vec3(\n                    det(mat2(row0.y, row0.z, row1.y, row1.z)),\n                    det(mat2(row0.z, row0.x, row1.z, row1.x)),\n                    det(mat2(row0.x, row0.y, row1.x, row1.y))\n                );\n            \n                mat3 adj = transpose(mat3(minors0, minors1, minors2));\n            \n                return (1.0 / dot(row0, minors0)) * adj;\n            }\n            \n            void main(void) {\n            \n                vec3 dir = computeView(tc);\n                dir = inverse(mat3(viewMatrix)) * dir;\n                \n                vec2 ER = sphIntersect(camPos, dir, vec3(0.0), earthRadius);\n                \n                float bigRadius = earthRadius * 2.5;\n                vec3 bigCenter = normalize(camPos) * bigRadius * 1.3;                \n                               \n                vec2 BIG = sphIntersect(camPos, dir, bigCenter, bigRadius);\n                \n                float Ix = distance(camPos + dir * BIG.y, ZERO);               \n                \n                float maxI = sqrt(bigRadius * bigRadius + bigRadius * bigRadius);\n                                   \n                gl_FragColor = vec4(mix(colorOne, colorTwo, Ix / maxI), 1.0);\n            }`\n    });\n}\n//# sourceMappingURL=SimpleSkyBackground.js.map","import { ONE_BY_SECONDS_PER_DAY, J2000 } from \"./jd\";\n/**\n * Angle between J2000 mean equator and the ecliptic plane.\n * 23 deg 26' 21\".448 (Seidelmann, _Explanatory Supplement to the\n * Astronomical Almanac_ (1992), eqn 3.222-1.\n * @const\n * @type{number}\n */\nexport const J2000_OBLIQUITY = 23.4392911;\n/**\n * IAU 1976 value\n * @const\n * @type{number}\n */\nexport const AU_TO_METERS = 1.4959787e11;\n/**\n * Terrestrial and atomic time difference.\n * @const\n * @type{number}\n */\nexport const TDT_TAI = 32.184;\n/**\n * Earth gravitational parameter product of gravitational constant G and the mass M of the Earth.\n * @const\n * @type{number}\n */\nexport const EARTH_GRAVITATIONAL_PARAMETER = 3.98600435e14;\n/**\n * Sun gravitational parameter product of gravitational constant G and the mass M of the Sun.\n * @const\n * @type{number}\n */\nexport const SUN_GRAVITATIONAL_PARAMETER = 1.32712440018e20;\n/**\n * Converts atomic time to barycentric dynamical time.\n * @param {JulianDate} tai - Atomic time.\n * @returns {JulianDate} - returns barycentric dynamical time.\n */\nexport function TAItoTDB(tai) {\n    tai += TDT_TAI * ONE_BY_SECONDS_PER_DAY;\n    const g = 6.239996 + 0.0172019696544 * (tai - J2000);\n    return tai + 0.001658 * Math.sin(g + 1.671e-2 * Math.sin(g)) * ONE_BY_SECONDS_PER_DAY;\n}\n//# sourceMappingURL=astro.js.map","import * as math from \"../math\";\nimport { Quat } from \"../math/Quat\";\nimport { Vec3 } from \"../math/Vec3\";\nimport * as astro from \"./astro\";\nimport * as jd from \"./jd\";\n/**\n * Returns Sun position in the geocentric coordinate system by the time.\n * @param {JulianDate} jDate - Julian date time.\n * @returns {Vec3} - Sun geocentric coordinates.\n */\nexport function getSunPosition(jDate) {\n    // http://stjarnhimlen.se/comp/tutorial.html\n    // a  Mean distance, or semi-major axis\n    // e  Eccentricity\n    // T  Time at perihelion\n    // q  Perihelion distance  = a * (1 - e)\n    // Q  Aphelion distance    = a * (1 + e)\n    // i  Inclination, i.e. the \"tilt\" of the orbit relative to the\n    //    ecliptic.  The inclination varies from 0 to 180 degrees. If\n    //    the inclination is larger than 90 degrees, the planet is in\n    //    a retrogade orbit, i.e. it moves \"backwards\".  The most\n    //    well-known celestial body with retrogade motion is Comet Halley.\n    // N  (usually written as \"Capital Omega\") Longitude of Ascending\n    //    Node. This is the angle, along the ecliptic, from the Vernal\n    //    Point to the Ascending Node, which is the intersection between\n    //    the orbit and the ecliptic, where the planet moves from south\n    //    of to north of the ecliptic, i.e. from negative to positive\n    //    latitudes.\n    // w  (usually written as \"small Omega\") The angle from the Ascending\n    //    node to the Perihelion, along the orbit.\n    // P  Orbital period       = 365.256898326 * a**1.5/sqrt(1+m) days,\n    //    where m = the mass of the planet in solar masses (0 for\n    //    comets and asteroids). sqrt() is the square root function.\n    // n  Daily motion         = 360_deg / P    degrees/day\n    // t  Some epoch as a day count, e.g. Julian Day Number. The Time\n    //    at Perihelion, T, should then be expressed as the same day count.\n    // t - T   Time since Perihelion, usually in days\n    // M  Mean Anomaly         = n * (t - T)  =  (t - T) * 360_deg / P\n    //    Mean Anomaly is 0 at perihelion and 180 degrees at aphelion\n    // L  Mean Longitude       = M + w + N\n    // E  Eccentric anomaly, defined by Kepler's equation:   M = E - e * sin(E)\n    //    An auxiliary angle to compute the position in an elliptic orbit\n    // v  True anomaly: the angle from perihelion to the planet, as seen\n    //    from the Sun\n    // r  Heliocentric distance: the planet's distance from the Sun.\n    // x,y,z  Rectangular coordinates. Used e.g. when a heliocentric\n    //        position (seen from the Sun) should be converted to a\n    //        corresponding geocentric position (seen from the Earth).\n    var d = jDate - jd.J2000;\n    var w = 282.9404 + 4.70935e-5 * d; // longitude of perihelion\n    // var a = 1.000000; // mean distance, a.u.\n    var e = 0.016709 - 1.151e-9 * d; // eccentricity\n    var M = math.rev(356.047 + 0.9856002585 * d); // mean anomaly\n    var oblecl = astro.J2000_OBLIQUITY - 3.563e-7 * d; // obliquity of the ecliptic\n    // var L = math.rev(w + M); // Sun's mean longitude\n    var E = M + math.DEGREES * e * Math.sin(M * math.RADIANS) * (1 + e * Math.cos(M * math.RADIANS)); // eccentric anomaly\n    // Sun rectangular coordinates, where the X axis points towards the perihelion\n    var x = Math.cos(E * math.RADIANS) - e;\n    var y = Math.sin(E * math.RADIANS) * Math.sqrt(1 - e * e);\n    var r = Math.sqrt(x * x + y * y); // distance\n    var v = Math.atan2(y, x) * math.DEGREES; // true anomaly\n    var lon = math.rev(v + w); // longitude of the Sun\n    // the Sun's ecliptic rectangular coordinates\n    x = r * Math.cos(lon * math.RADIANS);\n    y = r * Math.sin(lon * math.RADIANS);\n    // We use oblecl, and rotate these coordinates\n    var xequat = x;\n    var yequat = y * Math.cos(oblecl * math.RADIANS);\n    var zequat = y * Math.sin(oblecl * math.RADIANS);\n    var theta = math.TWO_PI * ((d * 24.0) / 23.9344694 - 259.853 / 360.0); // Siderial spin time\n    return Quat.zRotation(-theta).mulVec3(new Vec3(-xequat * astro.AU_TO_METERS, -yequat * astro.AU_TO_METERS, zequat * astro.AU_TO_METERS));\n    // Convert to RA and Decl\n    // var RA = Math.atan2(yequat, xequat) * math.DEGREES;\n    // var Decl = Math.atan2(zequat, Math.sqrt(xequat * xequat + yequat * yequat)) * math.DEGREES;\n}\n//# sourceMappingURL=earth.js.map","import { Vec3 } from \"../math/Vec3\";\n/**\n * Represents basic light source.\n * @class\n * @param {string} [name] - Light source name.\n * @param {ILightSourceParams} [params] - Light parameters:\n * @param {Vec3} [params.position] - Light source position if it is a point light, otherwise it is a light direction vector.\n * @param {Vec3} [params.ambient]  - Ambient RGB color.\n * @param {Vec3} [params.diffuse]  - Diffuse RGB color.\n * @param {Vec3} [params.specular]  - Specular RGB color.\n * @param {number} [params.shininess]  - Specular shininess.\n */\nclass LightSource {\n    constructor(name, params) {\n        /**\n         * Light name.\n         * @protected\n         * @type {string}\n         */\n        this._name = name || \"light_\" + LightSource.__counter__++;\n        /**\n         * Render node where light is shines.\n         * @protected\n         * @type {RenderNode}\n         */\n        this._renderNode = null;\n        /**\n         * Light position.\n         * @public\n         * @type {Vec3}\n         */\n        this._position = params.position || new Vec3();\n        /**\n         * True if the light is directional.\n         * @public\n         * @type {boolean}\n         */\n        this.directional = params.directional != undefined ? params.directional : true;\n        /**\n         * Ambient color.\n         * @protected\n         * @type {Vec3}\n         */\n        this._ambient = params.ambient || new Vec3();\n        /**\n         * Diffuse color.\n         * @protected\n         * @type {Vec3}\n         */\n        this._diffuse = params.diffuse || new Vec3(0.8, 0.8, 0.8);\n        /**\n         * Specular color.\n         * @protected\n         * @type {Vec3}\n         */\n        this._specular = params.specular || new Vec3(0.18, 0.18, 0.18);\n        /**\n         * Shininess.\n         * @protected\n         * @type {number}\n         */\n        this._shininess = params.shininess != undefined ? params.shininess : 3.3;\n        /**\n         * Light activity.\n         * @protected\n         * @type {boolean}\n         */\n        this._active = true;\n        this._tempAmbient = this._ambient.clone();\n        this._tempDiffuse = this._diffuse.clone();\n        this._tempSpecular = this._specular.clone();\n        this._tempShininess = this._shininess;\n    }\n    /**\n     * Creates clone of the current light object.\n     * @todo: TODO\n     * @public\n     * @returns {LightSource}\n     */\n    clone() {\n        // TODO\n    }\n    /**\n     * Set light activity. If activity is false the light doesn't shine.\n     * @public\n     * @param {boolean} active - Light activity.\n     */\n    setActive(active) {\n        if (active && !this._active) {\n            const rn = this._renderNode;\n            if (rn) {\n                let index = rn._lightsNames.indexOf(this._name);\n                this._shininess = rn._lightsParamsf[index] = this._tempShininess;\n                if (index != -1) {\n                    index *= 9;\n                    this._ambient.x = rn._lightsParamsv[index] = this._tempAmbient.x;\n                    this._ambient.y = rn._lightsParamsv[index + 1] = this._tempAmbient.y;\n                    this._ambient.z = rn._lightsParamsv[index + 2] = this._tempAmbient.z;\n                    this._diffuse.x = rn._lightsParamsv[index + 3] = this._tempDiffuse.x;\n                    this._diffuse.y = rn._lightsParamsv[index + 4] = this._tempDiffuse.y;\n                    this._diffuse.z = rn._lightsParamsv[index + 5] = this._tempDiffuse.z;\n                    this._specular.x = rn._lightsParamsv[index + 6] = this._tempSpecular.x;\n                    this._specular.y = rn._lightsParamsv[index + 7] = this._tempSpecular.y;\n                    this._specular.z = rn._lightsParamsv[index + 8] = this._tempSpecular.z;\n                }\n            }\n            this._active = true;\n        }\n        else if (!active && this._active) {\n            this._tempAmbient = this._ambient.clone();\n            this._tempDiffuse = this._diffuse.clone();\n            this._tempSpecular = this._specular.clone();\n            this._tempShininess = this._shininess;\n            this.setBlack();\n            this._active = false;\n        }\n    }\n    /**\n     * Gets light activity.\n     * @public\n     * @returns {boolean}\n     */\n    isActive() {\n        return this._active;\n    }\n    /**\n     * Set light source position, or if it is a directional type sets light direction vector.\n     * @public\n     * @param {Vec3} position - Light position or direction vector.\n     */\n    setPosition3v(position) {\n        this._position.x = position.x;\n        this._position.y = position.y;\n        this._position.z = position.z;\n    }\n    /**\n     * Set light source position, or if it is a directional type sets light direction vector.\n     * @public\n     */\n    setPosition(x, y, z) {\n        this._position.x = x;\n        this._position.y = y;\n        this._position.z = z;\n    }\n    /**\n     * Returns light source position, or if it is a directional type sets light direction vector.\n     * @public\n     * @returns {Vec3} - Light source position/direction.\n     */\n    getPosition() {\n        return this._position.clone();\n    }\n    /**\n     * Set ambient color.\n     * @public\n     * @param {Vec3} rgb - Ambient color.\n     */\n    setAmbient3v(rgb) {\n        this.setAmbient(rgb.x, rgb.y, rgb.z);\n    }\n    /**\n     * Set diffuse color.\n     * @public\n     * @param {Vec3} rgb - Diffuse color.\n     */\n    setDiffuse3v(rgb) {\n        this.setDiffuse(rgb.x, rgb.y, rgb.z);\n    }\n    /**\n     * Set specular color.\n     * @public\n     * @param {Vec3} rgb - Specular color.\n     */\n    setSpecular3v(rgb) {\n        this.setSpecular(rgb.x, rgb.y, rgb.z);\n    }\n    /**\n     * Set ambient color.\n     * @public\n     */\n    setAmbient(r, g, b) {\n        this._ambient.set(r, g, b);\n        const rn = this._renderNode;\n        if (rn) {\n            let index = 9 * rn._lightsNames.indexOf(this._name);\n            if (index != -1) {\n                rn._lightsParamsv[index] = r;\n                rn._lightsParamsv[index + 1] = g;\n                rn._lightsParamsv[index + 2] = b;\n            }\n        }\n    }\n    /**\n     * Set diffuse color.\n     * @public\n     */\n    setDiffuse(r, g, b) {\n        this._diffuse.set(r, g, b);\n        const rn = this._renderNode;\n        if (rn) {\n            let index = 9 * rn._lightsNames.indexOf(this._name);\n            if (index != -1) {\n                rn._lightsParamsv[index + 3] = r;\n                rn._lightsParamsv[index + 4] = g;\n                rn._lightsParamsv[index + 5] = b;\n            }\n        }\n    }\n    /**\n     * Set specular color.\n     * @public\n     */\n    setSpecular(r, g, b) {\n        this._specular.set(r, g, b);\n        const rn = this._renderNode;\n        if (rn) {\n            let index = 9 * rn._lightsNames.indexOf(this._name);\n            if (index != -1) {\n                rn._lightsParamsv[index + 6] = r;\n                rn._lightsParamsv[index + 7] = g;\n                rn._lightsParamsv[index + 8] = b;\n            }\n        }\n    }\n    /**\n     * Set material shininess.\n     * @public\n     */\n    setShininess(shininess) {\n        this._shininess = shininess;\n        const rn = this._renderNode;\n        if (rn) {\n            let index = rn._lightsNames.indexOf(this._name);\n            if (index != -1) {\n                rn._lightsParamsf[index] = shininess;\n            }\n        }\n    }\n    /**\n     * Sets light to black.\n     * @public\n     */\n    setBlack() {\n        this._ambient.clear();\n        this._diffuse.clear();\n        this._specular.clear();\n        this._shininess = 0;\n        const rn = this._renderNode;\n        if (rn) {\n            let index = 9 * rn._lightsNames.indexOf(this._name);\n            if (index !== -1) {\n                rn._lightsParamsv[index] = rn._lightsParamsv[index + 1] = rn._lightsParamsv[index + 2] =\n                    rn._lightsParamsv[index + 3] = rn._lightsParamsv[index + 4] = rn._lightsParamsv[index + 5] =\n                        rn._lightsParamsv[index + 6] = rn._lightsParamsv[index + 7] = rn._lightsParamsv[index + 8] = 0;\n            }\n        }\n    }\n    /**\n     * Adds current light to the render node scene.\n     * @public\n     * @param {RenderNode} renderNode - Render node scene.\n     */\n    addTo(renderNode) {\n        this._renderNode = renderNode;\n        renderNode._lights.push(this);\n        renderNode._lightsNames.push(this._name);\n        renderNode._lightsParamsf.push(this._shininess);\n        renderNode._lightsParamsv.push.apply(renderNode._lightsParamsv, this._ambient.toArray());\n        renderNode._lightsParamsv.push.apply(renderNode._lightsParamsv, this._diffuse.toArray());\n        renderNode._lightsParamsv.push.apply(renderNode._lightsParamsv, this._specular.toArray());\n        renderNode.transformLights();\n    }\n    /**\n     * Removes from render node scene.\n     * @public\n     */\n    remove() {\n        const rn = this._renderNode;\n        if (rn) {\n            // let li = rn.getLightById(this._name);\n            // if (li != -1) {\n            //     rn._lights.splice(li, 1);\n            //     rn._lightsNames.splice(li, 1);\n            //     rn._lightsParamsf.splice(li, 1);\n            //     rn._lightsParamsv.splice(li, 9);\n            // }\n        }\n        this._renderNode = null;\n    }\n}\nLightSource.__counter__ = 0;\nexport { LightSource };\n//# sourceMappingURL=LightSource.js.map","import { Control } from \"./Control\";\nimport { getSunPosition } from \"../astro/earth\";\nimport { LightSource } from \"../light/LightSource\";\nimport { Quat } from \"../math/Quat\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Real Sun geocentric position control that place the Sun on the right place by the Earth.\n */\nexport class Sun extends Control {\n    constructor(options = {}) {\n        super({ autoActivate: true, ...options });\n        this._name = \"sun\";\n        this.activationHeight = options.activationHeight || 12079000.0;\n        this.offsetVertical = options.offsetVertical || -5000000;\n        this.offsetHorizontal = options.offsetHorizontal || 5000000;\n        this.sunlight = new LightSource(\"Sun\", {\n            ambient: new Vec3(0.15, 0.15, 0.25),\n            diffuse: new Vec3(0.9, 0.9, 0.8),\n            specular: new Vec3(0.1, 0.1, 0.06),\n            shininess: 110\n        });\n        /**\n         * Current frame handler clock date and time.\n         * @private\n         * @type {Number}\n         */\n        this._currDate = 0;\n        /**\n         * Previous frame handler clock date and time.\n         * @private\n         * @type {Number}\n         */\n        this._prevDate = 0;\n        this._clockPtr = null;\n        this._lightOn = false;\n        this._f = 0;\n        this._k = 0;\n        this._stopped = options.stopped || false;\n    }\n    oninit() {\n        this.planet.lightEnabled = true;\n        // sunlight initialization\n        this.sunlight.addTo(this.planet);\n        this.renderer.events.on(\"draw\", this._draw, this);\n        if (!this._clockPtr) {\n            this._clockPtr = this.renderer.handler.defaultClock;\n        }\n    }\n    stop() {\n        this._stopped = true;\n        this.deactivate();\n    }\n    start() {\n        this._stopped = false;\n        this.activate();\n    }\n    onactivate() {\n        super.onactivate();\n        this._stopped = false;\n    }\n    bindClock(clock) {\n        this._clockPtr = clock;\n    }\n    _draw() {\n        if (!this._clockPtr)\n            return;\n        this._currDate = this._clockPtr.currentDate;\n        if (!this._stopped) {\n            let cam = this.planet.camera;\n            if (cam.getHeight() < this.activationHeight || !this._active) {\n                this._lightOn = true;\n                this._f = 1;\n                let n = cam.eye.normal(), u = cam.getForward();\n                u.scale(Math.sign(cam._u.dot(n))); // up\n                if (cam.slope > 0.99) {\n                    u = cam._u;\n                }\n                let tu = Vec3.proj_b_to_plane(u, n, u).normalize().scale(this.offsetVertical);\n                let tr = Vec3.proj_b_to_plane(cam._r, n, cam._r)\n                    .normalize()\n                    .scale(this.offsetHorizontal); // right\n                let d = tu.add(tr);\n                let pos = cam.eye.add(d);\n                if (this._k > 0) {\n                    this._k -= 0.01;\n                    let rot = Quat.getRotationBetweenVectors(this.sunlight._position.normal(), pos.normal());\n                    let r = rot.slerp(Quat.IDENTITY, this._k).normalize();\n                    this.sunlight.setPosition3v(r.mulVec3(this.sunlight._position));\n                }\n                else {\n                    this.sunlight.setPosition3v(pos);\n                }\n            }\n            else {\n                this._k = 1;\n                if (this._f > 0) {\n                    this._f -= 0.01;\n                    let rot = Quat.getRotationBetweenVectors(this.sunlight._position.normal(), getSunPosition(this._currDate).normal());\n                    let r = rot.slerp(Quat.IDENTITY, this._f).normalize();\n                    this.sunlight.setPosition3v(r.mulVec3(this.sunlight._position));\n                }\n                else {\n                    if ((Math.abs(this._currDate - this._prevDate) > 0.00034 && this._active) ||\n                        this._lightOn) {\n                        this._lightOn = false;\n                        this._prevDate = this._currDate;\n                        this.sunlight.setPosition3v(getSunPosition(this._currDate));\n                        this._f = 0;\n                    }\n                }\n            }\n        }\n        else {\n            this.sunlight.setPosition3v(getSunPosition(this._currDate));\n        }\n    }\n}\n//# sourceMappingURL=Sun.js.map","import { Control } from \"./Control\";\nimport { Key } from \"../Lock\";\nimport { LonLat } from \"../LonLat\";\nimport { math } from \"../index\";\nimport { Quat } from \"../math/Quat\";\nimport { Ray } from \"../math/Ray\";\nimport { Sphere } from \"../bv/Sphere\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nclass TouchExt {\n    constructor() {\n        this.x = 0;\n        this.y = 0;\n        this.prev_x = 0;\n        this.prev_y = 0;\n        this.grabbedPoint = null;\n        this.grabbedSpheroid = new Sphere();\n        this._vec = new Vec2();\n        this._vecPrev = new Vec2();\n    }\n    get dY() {\n        return this.y - this.prev_y;\n    }\n    get dX() {\n        return this.x - this.prev_x;\n    }\n    get vec() {\n        return this._vec.set(this.x, this.y);\n    }\n    get vecPrev() {\n        return this._vecPrev.set(this.prev_x, this.prev_y);\n    }\n}\n/**\n * Touch pad planet camera dragging control.\n */\nexport class TouchNavigation extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._name = \"touchNavigation\";\n        this.grabbedPoint = new Vec3();\n        this.inertia = 0.007;\n        this.grabbedSpheroid = new Sphere();\n        this.planet = null;\n        this.qRot = new Quat();\n        this.scaleRot = 0;\n        this.rot = 1;\n        this._eye0 = new Vec3();\n        this.pointOnEarth = null;\n        this.earthUp = null;\n        this.touches = [new TouchExt(), new TouchExt()];\n        this._keyLock = new Key();\n        this._touching = false;\n    }\n    oninit() {\n        if (this.renderer) {\n            this.renderer.events.on(\"touchstart\", this.onTouchStart, this);\n            this.renderer.events.on(\"touchend\", this.onTouchEnd, this);\n            this.renderer.events.on(\"doubletouch\", this.onDoubleTouch, this);\n            this.renderer.events.on(\"touchcancel\", this.onTouchCancel, this);\n            this.renderer.events.on(\"touchmove\", this.onTouchMove, this);\n            this.renderer.events.on(\"draw\", this.onDraw, this);\n        }\n    }\n    onTouchStart(e) {\n        const handler = this.renderer.handler;\n        this._touching = true;\n        if (e.sys.touches.length === 2) {\n            const t0 = this.touches[0];\n            const t1 = this.touches[1];\n            t0.x = (e.sys.touches.item(0).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n            t0.y = (e.sys.touches.item(0).clientY - e.sys.offsetTop) * handler.pixelRatio;\n            t0.prev_x = t0.x;\n            t0.prev_y = t0.y;\n            t0.grabbedPoint = this.planet.getCartesianFromPixelTerrain(new Vec2(t0.x, t0.y)) || null;\n            t1.x = (e.sys.touches.item(1).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n            t1.y = (e.sys.touches.item(1).clientY - e.sys.offsetTop) * handler.pixelRatio;\n            t1.prev_x = t1.x;\n            t1.prev_y = t1.y;\n            t1.grabbedPoint = this.planet.getCartesianFromPixelTerrain(new Vec2(t1.x, t1.y)) || null;\n            this.pointOnEarth = this.planet.getCartesianFromPixelTerrain(this.renderer.handler.getCenter()) || null;\n            if (this.pointOnEarth) {\n                this.earthUp = this.pointOnEarth.normal();\n            }\n            if (t0.grabbedPoint && t1.grabbedPoint) {\n                t0.grabbedSpheroid.radius = t0.grabbedPoint.length();\n                t1.grabbedSpheroid.radius = t1.grabbedPoint.length();\n                this.stopRotation();\n            }\n        }\n        else if (e.sys.touches.length === 1) {\n            this._startTouchOne(e);\n        }\n    }\n    _startTouchOne(e) {\n        const t = this.touches[0];\n        const handler = this.renderer.handler;\n        t.x = (e.sys.touches.item(0).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n        t.y = (e.sys.touches.item(0).clientY - e.sys.offsetTop) * handler.pixelRatio;\n        t.prev_x = t.x;\n        t.prev_y = t.y;\n        // t.grabbedPoint = this.planet!.getCartesianFromPixelTerrain(e, true);\n        t.grabbedPoint = this.planet.getCartesianFromPixelTerrain(e) || null;\n        this._eye0.copy(this.planet.camera.eye);\n        if (t.grabbedPoint) {\n            t.grabbedSpheroid.radius = t.grabbedPoint.length();\n            this.stopRotation();\n        }\n    }\n    stopRotation() {\n        this.qRot.clear();\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet._normalMapCreator.free(this._keyLock);\n    }\n    onDoubleTouch(e) {\n        this.planet.stopFlying();\n        this.stopRotation();\n        const p = this.planet.getCartesianFromPixelTerrain(e);\n        if (p) {\n            const g = this.planet.ellipsoid.cartesianToLonLat(p);\n            this.planet.flyLonLat(new LonLat(g.lon, g.lat, this.planet.camera.eye.distance(p) * 0.57));\n        }\n    }\n    onTouchEnd(e) {\n        if (e.sys.touches.length === 0) {\n            this._touching = false;\n        }\n        if (e.sys.touches.length === 1) {\n            this._startTouchOne(e);\n        }\n        if (Math.abs(this.touches[0].x - this.touches[0].prev_x) < 3 &&\n            Math.abs(this.touches[0].y - this.touches[0].prev_y) < 3) {\n            this.scaleRot = 0;\n        }\n    }\n    onTouchCancel(e) {\n    }\n    onTouchMove(e) {\n        let cam = this.planet.camera;\n        const handler = this.renderer.handler;\n        if (e.sys.touches.length === 2) {\n            this.renderer.controlsBag.scaleRot = 1;\n            let t0 = this.touches[0], t1 = this.touches[1];\n            if (!t0.grabbedPoint || !t1.grabbedPoint) {\n                return;\n            }\n            this.planet.stopFlying();\n            t0.prev_x = t0.x;\n            t0.prev_y = t0.y;\n            t0.x = (e.sys.touches.item(0).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n            t0.y = (e.sys.touches.item(0).clientY - e.sys.offsetTop) * handler.pixelRatio;\n            t1.prev_x = t1.x;\n            t1.prev_y = t1.y;\n            t1.x = (e.sys.touches.item(1).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n            t1.y = (e.sys.touches.item(1).clientY - e.sys.offsetTop) * handler.pixelRatio;\n            const middle = t0.vec.add(t1.vec).scale(0.5);\n            const earthMiddlePoint = this.planet.getCartesianFromPixelTerrain(middle);\n            if (earthMiddlePoint) {\n                this.pointOnEarth = earthMiddlePoint;\n                const prevAngle = Math.atan2(t0.prev_y - t1.prev_y, t0.prev_x - t1.prev_x);\n                const curAngle = Math.atan2(t0.y - t1.y, t0.x - t1.x);\n                const deltaAngle = curAngle - prevAngle;\n                const distanceToPointOnEarth = cam.eye.distance(this.pointOnEarth);\n                const zoomCur = t0.vec.sub(t1.vec);\n                const zoomPrev = t0.vecPrev.sub(t1.vecPrev);\n                const scale = zoomCur.length() / zoomPrev.length();\n                let d = distanceToPointOnEarth * -(1 - scale);\n                cam.eye.addA(cam.getForward().scale(d));\n                cam.rotateAround(-deltaAngle, false, this.pointOnEarth, this.earthUp);\n                const panCur = t0.vec.add(t1.vec).scale(0.5);\n                const panPrev = t0.vecPrev.add(t1.vecPrev).scale(0.5);\n                const panOffset = panCur.sub(panPrev).scale(-1);\n                var l = 0.5 / distanceToPointOnEarth * cam._lonLat.height * math.RADIANS;\n                if (l > 0.003)\n                    l = 0.003;\n                cam.rotateHorizontal(l * -panOffset.x, false, this.pointOnEarth, this.earthUp);\n                cam.rotateVertical(l * -panOffset.y, this.pointOnEarth);\n                cam.checkTerrainCollision();\n                cam.update();\n            }\n            this.scaleRot = 0;\n        }\n        else if (e.sys.touches.length === 1) {\n            let t = this.touches[0];\n            t.prev_x = t.x;\n            t.prev_y = t.y;\n            t.x = (e.sys.touches.item(0).clientX - e.sys.offsetLeft) * handler.pixelRatio;\n            t.y = (e.sys.touches.item(0).clientY - e.sys.offsetTop) * handler.pixelRatio;\n            if (!t.grabbedPoint) {\n                return;\n            }\n            this.planet.stopFlying();\n            let direction = e.direction;\n            let targetPoint = new Ray(cam.eye, direction).hitSphere(t.grabbedSpheroid);\n            if (targetPoint) {\n                if (cam.slope > 0.2) {\n                    this.qRot = Quat.getRotationBetweenVectors(targetPoint.normal(), t.grabbedPoint.normal());\n                    let rot = this.qRot;\n                    cam.eye = rot.mulVec3(cam.eye);\n                    cam._r = rot.mulVec3(cam._r);\n                    cam._u = rot.mulVec3(cam._u);\n                    cam._b = rot.mulVec3(cam._b);\n                    cam.checkTerrainCollision();\n                    cam.update();\n                    this.scaleRot = 1;\n                }\n                else {\n                    let p0 = t.grabbedPoint, p1 = Vec3.add(p0, cam._u), p2 = Vec3.add(p0, p0.normal());\n                    let dir = cam.unproject(t.x, t.y);\n                    let px = new Vec3();\n                    if (new Ray(cam.eye, dir).hitPlane(p0, p1, p2, px) === Ray.INSIDE) {\n                        cam.eye = this._eye0.addA(px.subA(p0).negate());\n                        cam.checkTerrainCollision();\n                        cam.update();\n                        this.scaleRot = 0;\n                    }\n                }\n            }\n        }\n    }\n    onDraw() {\n        const r = this.renderer;\n        r.controlsBag.scaleRot = this.scaleRot;\n        if (this._touching) {\n            return;\n        }\n        let cam = this.planet.camera;\n        let prevEye = cam.eye.clone();\n        if (r.events.mouseState.leftButtonDown || !this.scaleRot) {\n            return;\n        }\n        this.scaleRot -= this.inertia;\n        if (this.scaleRot <= 0) {\n            this.scaleRot = 0;\n        }\n        else {\n            r.controlsBag.scaleRot = this.scaleRot;\n            let rot = this.qRot\n                .slerp(Quat.IDENTITY, 1 - this.scaleRot * this.scaleRot * this.scaleRot)\n                .normalize();\n            if (!(rot.x || rot.y || rot.z)) {\n                this.scaleRot = 0;\n            }\n            cam.eye = rot.mulVec3(cam.eye);\n            cam._r = rot.mulVec3(cam._r);\n            cam._u = rot.mulVec3(cam._u);\n            cam._b = rot.mulVec3(cam._b);\n            cam.checkTerrainCollision();\n            cam.update();\n        }\n        if (cam.eye.distance(prevEye) / cam.getAltitude() > 0.01) {\n            this.planet.layerLock.lock(this._keyLock);\n            this.planet.terrainLock.lock(this._keyLock);\n            this.planet._normalMapCreator.lock(this._keyLock);\n        }\n        else {\n            this.planet.layerLock.free(this._keyLock);\n            this.planet.terrainLock.free(this._keyLock);\n            this.planet._normalMapCreator.free(this._keyLock);\n        }\n    }\n}\n//# sourceMappingURL=TouchNavigation.js.map","import { Key } from \"../Lock\";\nimport { Button } from \"../ui/Button\";\nimport { Control } from \"./Control\";\nconst ICON_PLUS_SVG = '<?xml version=\"1.0\"?>' +\n    '<svg width=24 height=24 xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">' +\n    '    <path d=\"M 11 5 L 11 11 L 5 11 L 5 13 L 11 13 L 11 19 L 13 19 L 13 13 L 19 13 L 19 11 L 13 11 L 13 5 L 11 5 z\"/>' +\n    '</svg>';\nconst ICON_MINUS_SVG = '<?xml version=\"1.0\"?>' +\n    '<svg width=24 height=24 xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">' +\n    '    <path d=\"M 5 11 L 5 13 L 19 13 L 19 11 L 5 11 z\"/>' +\n    '</svg>';\n/**\n * Planet zoom buttons control.\n */\nclass ZoomControl extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._keyLock = new Key();\n        this._move = 0;\n        this._targetPoint = null;\n    }\n    oninit() {\n        let zoomInBtn = new Button({\n            classList: [\"og-map-button\", \"og-zoomin-button\"],\n            icon: ICON_PLUS_SVG\n        });\n        zoomInBtn.appendTo(this.renderer.div);\n        let zoomOutBtn = new Button({\n            classList: [\"og-map-button\", \"og-zoomout-button\"],\n            icon: ICON_MINUS_SVG\n        });\n        zoomOutBtn.appendTo(this.renderer.div);\n        zoomInBtn.events.on(\"mousedown\", () => this.zoomIn());\n        zoomInBtn.events.on(\"mouseup\", () => this.stopZoom());\n        zoomOutBtn.events.on(\"mousedown\", () => this.zoomOut());\n        zoomOutBtn.events.on(\"mouseup\", () => this.stopZoom());\n        zoomInBtn.events.on(\"touchstart\", () => this.zoomIn());\n        zoomInBtn.events.on(\"touchend\", () => this.stopZoom());\n        zoomInBtn.events.on(\"touchcancel\", () => this.stopZoom());\n        zoomOutBtn.events.on(\"touchstart\", () => this.zoomOut());\n        zoomOutBtn.events.on(\"touchend\", () => this.stopZoom());\n        zoomOutBtn.events.on(\"touchcancel\", () => this.stopZoom());\n        this.renderer.events.on(\"draw\", this._draw, this);\n    }\n    /**\n     * Planet zoom in.\n     * @public\n     */\n    zoomIn() {\n        this.planet.layerLock.lock(this._keyLock);\n        this.planet.terrainLock.lock(this._keyLock);\n        this.planet._normalMapCreator.lock(this._keyLock);\n        this._targetPoint = this.renderer.getCenter();\n        this._move = 1;\n    }\n    /**\n     * Planet zoom out.\n     * @public\n     */\n    zoomOut() {\n        this.planet.layerLock.lock(this._keyLock);\n        this.planet.terrainLock.lock(this._keyLock);\n        this.planet._normalMapCreator.lock(this._keyLock);\n        this._targetPoint = this.renderer.getCenter();\n        this._move = -1;\n    }\n    stopZoom() {\n        this._move = 0;\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet._normalMapCreator.free(this._keyLock);\n    }\n    _draw(e) {\n        const cam = this.planet.camera;\n        if (this._move !== 0) {\n            const pos = this.planet.getCartesianFromPixelTerrain(e.getCenter());\n            if (pos) {\n                let d = cam.eye.distance(pos) * 0.035;\n                cam.eye.addA(cam.getForward().scale(this._move * d));\n                cam.checkTerrainCollision();\n                cam.update();\n            }\n        }\n    }\n}\nexport { ZoomControl };\n//# sourceMappingURL=ZoomControl.js.map","import { Entity } from '../../entity/Entity';\nimport { Events } from '../../Events';\nimport { Vector } from '../../layer/Vector';\nimport { LonLat } from '../../LonLat';\nimport { Object3d } from '../../Object3d';\nimport { RenderNode } from '../../scene/RenderNode';\nconst OUTLINE_COUNT = 120;\nconst MAX_SCALE = 0.005;\nconst MIN_SCALE = 0.001;\nconst MAX_SCALE_HEIGHT = 3000.0;\nconst MIN_SCALE_HEIGHT = 19000000.0;\nfunction distanceFormat(v) {\n    if (v > 1000) {\n        return `${(v / 1000).toFixed(1)} km`;\n    }\n    else if (v > 9) {\n        return `${Math.round(v)} m`;\n    }\n    else {\n        return `${v.toFixed(1)} m`;\n    }\n}\nclass SelectionScene extends RenderNode {\n    constructor(options = {}) {\n        super(options.name);\n        this._ignoreTerrain = false;\n        this.events = new Events(EVENT_NAMES);\n        this._ignoreTerrain = options.ignoreTerrain != undefined ? options.ignoreTerrain : true;\n        this._onSelect = options.onSelect || null;\n        this._autoSelectionHide = options.autoSelectionHide || false;\n        this._planet = options.planet || null;\n        this._startLonLat = null;\n        this._heading = 0;\n        this._propsLabel = new Entity({\n            'name': 'propsLabel',\n            'label': {\n                text: \"\",\n                size: 11,\n                color: \"rgba(455,455,455,1.0)\",\n                outlineColor: \"rgba(0,0,0,0.34)\",\n                outline: 0.23,\n                align: \"center\",\n                offset: [0, 18]\n            }\n        });\n        this._propsLabel?.label?.setVisibility(false);\n        this._trackEntity = new Entity({\n            polyline: {\n                path3v: [],\n                thickness: 3.8,\n                color: \"rgb(455,455,455)\",\n                isClosed: false\n            }\n        });\n        this._trackEntity.polyline.altitude = 0.01;\n        let obj3d = Object3d.createCylinder(1.1, 0, 2.7, 20, 1, true, false, 0, 0, 0);\n        this._cornerEntity = [\n            new Entity({\n                geoObject: {\n                    scale: 1,\n                    instanced: true,\n                    tag: \"selection\",\n                    color: \"rgb(0,305,0)\",\n                    object3d: obj3d\n                },\n                properties: {\n                    name: \"start\"\n                }\n            }),\n            new Entity({\n                geoObject: {\n                    scale: 1,\n                    instanced: true,\n                    tag: \"selection\",\n                    color: \"rgb(455,0,0)\",\n                    object3d: obj3d\n                },\n                properties: {\n                    name: \"end\"\n                }\n            })\n        ];\n        this._trackLayer = new Vector(\"track\", {\n            entities: [this._trackEntity, this._propsLabel],\n            pickingEnabled: false,\n            polygonOffsetUnits: -1.0,\n            relativeToGround: true,\n            hideInLayerSwitcher: false\n        });\n        this._cornersLayer = new Vector(\"corners\", {\n            entities: [this._cornerEntity[0], this._cornerEntity[1]],\n            pickingEnabled: true,\n            hideInLayerSwitcher: true,\n            scaleByDistance: [1.0, 4000000, 0.01],\n            pickingScale: 2\n        });\n    }\n    set ignoreTerrain(v) {\n        this._ignoreTerrain = v;\n        if (v) {\n            //...redraw line\n        }\n    }\n    bindPlanet(planet) {\n        this._planet = planet;\n    }\n    init() {\n        this._activate();\n    }\n    onremove() {\n        this._deactivate();\n    }\n    _activate() {\n        this._propsLabel?.label?.setVisibility(false);\n        this._onMouseMove_ = this._onMouseMove.bind(this);\n        this.renderer?.events.on(\"mousemove\", this._onMouseMove_, this);\n        this._onMouseLdown_ = this._onMouseLdown.bind(this);\n        this.renderer?.events.on(\"ldown\", this._onMouseLdown_, this);\n        this._onMouseLup_ = this._onMouseLup.bind(this);\n        this.renderer?.events.on(\"lup\", this._onMouseLup_, this);\n        this._planet.addLayer(this._trackLayer);\n        this._planet.addLayer(this._cornersLayer);\n    }\n    _deactivate() {\n        this._startLonLat = null;\n        this._trackLayer.remove();\n        this._cornersLayer.remove();\n        this.renderer?.events.off(\"mousemove\", this._onMouseMove_);\n        this.renderer?.events.off(\"ldown\", this._onMouseLdown_);\n        this.renderer?.events.off(\"lup\", this._onMouseLup_);\n        this.clear();\n        this._onMouseMove_ = null;\n        this._onMouseLdown_ = null;\n        this._onMouseLup_ = null;\n    }\n    _onMouseLdown(e) {\n        //workaround to show pointer, because ogGrabbingPoiner keep !importanti which override pointer style\n        e.renderer.handler.canvas.classList.remove('ogGrabbingPoiner');\n        e.renderer.handler.canvas.style.cursor = 'pointer';\n        if (!this._startLonLat) {\n            this._propsLabel.label?.setVisibility(false);\n            this._trackEntity.polyline?.setPath3v([]);\n            this._cornerEntity[0].geoObject?.setVisibility(true);\n            this._cornerEntity[1].geoObject?.setVisibility(true);\n            this.renderer?.controls.mouseNavigation?.deactivate();\n            this._startLonLat = this._planet.getLonLatFromPixelTerrain(e);\n            let startPos = this._planet.ellipsoid.lonLatToCartesian(this._startLonLat);\n            this._cornerEntity[0].setCartesian3v(startPos);\n            this._cornerEntity[1].setCartesian3v(startPos);\n        }\n    }\n    _onMouseLup(e) {\n        if (this._startLonLat) {\n            this._pickedCorner = null;\n            this._anchorLonLat = null;\n            this._propsLabel.label?.setVisibility(true);\n            if (this._onSelect && typeof this._onSelect === 'function') {\n                let startLonLat = this._cornerEntity[0].getLonLat();\n                let endLonLat = this._cornerEntity[1].getLonLat();\n                let extent = [\n                    Math.min(startLonLat.lon, endLonLat.lon),\n                    Math.min(startLonLat.lat, endLonLat.lat),\n                    Math.max(startLonLat.lon, endLonLat.lon),\n                    Math.max(startLonLat.lat, endLonLat.lat)\n                ];\n                this._onSelect(extent);\n            }\n            if (this._autoSelectionHide) {\n                this.clear();\n            }\n            this._startLonLat = null;\n        }\n        e.renderer.handler.canvas.style.cursor = 'default';\n        this.renderer?.controls.mouseNavigation?.activate();\n    }\n    _drawLine(startLonLat, endLonLat, startPos) {\n        if (!startPos) {\n            startPos = this._planet.ellipsoid.lonLatToCartesian(startLonLat);\n        }\n        let endPos = this._planet.ellipsoid.lonLatToCartesian(endLonLat);\n        let res = this._planet.ellipsoid.direct(startLonLat, endLonLat);\n        this._heading = res.initialAzimuth;\n        let path = [];\n        this._cornerEntity[0].setCartesian3v(startPos);\n        this._cornerEntity[1].setCartesian3v(endPos);\n        let corners = [\n            startPos,\n            this._planet.ellipsoid.lonLatToCartesian(new LonLat(endLonLat.lon, startLonLat.lat, startLonLat.height)),\n            endPos,\n            this._planet.ellipsoid.lonLatToCartesian(new LonLat(startLonLat.lon, endLonLat.lat, startLonLat.height)),\n            startPos\n        ];\n        path.push(startPos);\n        let createPath = (sideA, sideB) => {\n            let dir = sideB.sub(sideA);\n            let dist = dir.length();\n            dir.normalize();\n            for (let i = 0; i < OUTLINE_COUNT; i++) {\n                let f = dir.scaleTo(i * dist / OUTLINE_COUNT).addA(sideA);\n                path.push(f);\n            }\n        };\n        for (let i = 0; i < corners.length - 1; i++) {\n            createPath(corners[i], corners[i + 1]);\n        }\n        this._trackEntity.polyline?.setPath3v([path]);\n        if (this._ignoreTerrain) {\n            // this._propsLabel.setCartesian3v(path[Math.floor(path.length / 2)]);\n            // this._propsLabel.label.setText(`${distanceFormat(length)}, ${Math.round(this._heading)} deg`);\n        }\n    }\n    _onMouseMove(e) {\n        if (this._startLonLat) {\n            this._propsLabel.label?.setVisibility(true);\n            let endLonLat = this._planet.getLonLatFromPixelTerrain(e);\n            if (!endLonLat)\n                return;\n            this._drawLine(this._startLonLat, endLonLat);\n        }\n    }\n    clear() {\n        this._trackEntity.polyline?.clear();\n        this._cornerEntity[0].geoObject?.setVisibility(false);\n        this._cornerEntity[1].geoObject?.setVisibility(false);\n    }\n    frame() {\n        let t = this._trackEntity.polyline?.getPath3v()[0];\n        if (t) {\n            if (!this._ignoreTerrain) {\n                let res = 0;\n                for (let i = 0, len = t.length - 1; i < len; i++) {\n                    res += t[i + 1].distance(t[i]);\n                }\n                this._propsLabel.setCartesian3v(t[Math.floor(t.length / 2)]);\n                this._propsLabel.label?.setText(`${distanceFormat(res)}, ${Math.round(this._heading)} deg`);\n            }\n        }\n    }\n    get ellipsoid() {\n        return this._planet ? this._planet.ellipsoid : null;\n    }\n}\nconst EVENT_NAMES = [\n    \"add\",\n    \"remove\",\n    \"mousemove\",\n    \"mouseenter\",\n    \"mouseleave\",\n    \"lclick\",\n    \"rclick\",\n    \"mclick\",\n    \"ldblclick\",\n    \"rdblclick\",\n    \"mdblclick\",\n    \"lup\",\n    \"rup\",\n    \"mup\",\n    \"ldown\",\n    \"rdown\",\n    \"mdown\",\n    \"lhold\",\n    \"rhold\",\n    \"mhold\",\n    \"mousewheel\",\n    \"touchmove\",\n    \"touchstart\",\n    \"touchend\",\n    \"doubletouch\",\n    \"touchleave\",\n    \"touchenter\"\n];\nexport { SelectionScene };\n//# sourceMappingURL=SelectionScene.js.map","import * as math from '../../math';\nexport function addSeconds(date, seconds) {\n    return new Date(+date + seconds * 1000);\n}\nexport function dateToStr(date, showTime = true, showMilliseconds = false) {\n    let month = MONTHS[date.getMonth()], day = date.getUTCDate(), year = date.getUTCFullYear();\n    if (showTime) {\n        let h = date.getUTCHours().toString().padStart(2, '0'), m = date.getUTCMinutes().toString().padStart(2, '0'), s = date.getUTCSeconds().toString().padStart(2, '0');\n        if (showMilliseconds) {\n            let ms = date.getUTCMilliseconds().toString().padStart(3, '0');\n            return `${month} ${day} ${year} ${h}:${m}:${s}.${ms}`;\n        }\n        return `${month} ${day} ${year} ${h}:${m}:${s}`;\n    }\n    return `${month} ${day} ${year}`;\n}\nexport function createCanvasHTML() {\n    return document.createElement(\"canvas\");\n}\nexport function getNearestTimeLeft(t, div) {\n    return t - (t % div);\n}\nexport function drawNotch(ctx, xOffset = 0, size = 10, thickness = 2, color = \"white\") {\n    ctx.lineWidth = thickness;\n    ctx.strokeStyle = color;\n    ctx.beginPath();\n    ctx.moveTo(xOffset, 0);\n    ctx.lineTo(xOffset, size);\n    ctx.stroke();\n}\nexport function drawText(ctx, text, x, y, font = \"12px Arial\", fillStyle = \"black\", align = \"left\", baseLine = \"bottom\", rotDeg = 0) {\n    ctx.save();\n    ctx.translate(x, y);\n    ctx.rotate(rotDeg * math.RADIANS);\n    ctx.fillStyle = fillStyle;\n    ctx.textBaseline = baseLine;\n    ctx.font = font;\n    ctx.textAlign = align;\n    ctx.fillText(text, 0, 0);\n    ctx.restore();\n}\nexport const SCALES = [\n    [0.001, 10],\n    [0.002, 10],\n    [0.005, 10],\n    [0.01, 10],\n    [0.02, 10],\n    [0.05, 10],\n    [0.1, 10],\n    [0.25, 10],\n    [0.5, 5],\n    [1.0, 10],\n    [2.0, 10],\n    [5.0, 5],\n    [10.0, 10],\n    [15.0, 15],\n    [30.0, 6],\n    [60.0, 12],\n    [120.0, 12],\n    [300.0, 5],\n    [600.0, 10],\n    [900.0, 15],\n    [1800.0, 6],\n    [3600.0, 12],\n    [7200.0, 10],\n    [14400.0, 4],\n    [21600.0, 6],\n    [43200.0, 12],\n    [86400.0, 24],\n    [172800.0, 2],\n    [345600.0, 4],\n    [604800.0, 7],\n    [1296000.0, 15],\n    [2592000.0, 5],\n    [5184000.0, 6],\n    [7776000.0, 9],\n    [15552000.0, 18],\n    [31536000.0, 12],\n    [63072000.0, 2],\n    [126144000.0, 4],\n    [157680000.0, 5],\n    [315360000.0, 10],\n    [630720000.0, 2],\n    [1261440000.0, 4],\n    [1576800000.0, 5],\n    [3153600000.0, 10],\n    [6307200000.0, 2],\n    [12614400000.0, 4],\n    [15768000000.0, 5],\n    [31536000000.0, 10], // 1000years\n];\nexport function getScale(seconds) {\n    for (let i = 0, len = SCALES.length; i < len; i++) {\n        if (SCALES[i][0] > seconds) {\n            return SCALES[i - 1];\n        }\n    }\n}\nexport const MONTHS = [\n    \"Jan\",\n    \"Feb\",\n    \"Mar\",\n    \"Apr\",\n    \"May\",\n    \"Jun\",\n    \"Jul\",\n    \"Aug\",\n    \"Sep\",\n    \"Oct\",\n    \"Nov\",\n    \"Dec\",\n];\n//# sourceMappingURL=timelineUtils.js.map","import { createEvents } from '../../Events';\nimport { addSeconds } from \"./timelineUtils\";\nconst TIMELINE_EVENTS = [\"change\", \"current\" /*, \"tick\"*/];\nclass TimelineModel {\n    constructor(options = {}) {\n        this.events = createEvents(TIMELINE_EVENTS);\n        this._current = options.current || new Date();\n        this._rangeStart = options.rangeStart || new Date();\n        this._rangeEnd = options.rangeEnd || addSeconds(this._rangeStart, 3600);\n        this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\n        this._minDate = options.minDate || null;\n        this._maxDate = options.maxDate || null;\n        this.multiplier = options.multiplier != undefined ? options.multiplier : 1.0;\n        this._requestAnimationFrameId = 0;\n        this._prevNow = 0;\n        this.dt = 0;\n    }\n    play() {\n        if (!this._requestAnimationFrameId) {\n            this._prevNow = window.performance.now();\n            this._animationFrameCallback();\n        }\n    }\n    stop() {\n        if (this._requestAnimationFrameId) {\n            window.cancelAnimationFrame(this._requestAnimationFrameId);\n            this._requestAnimationFrameId = 0;\n        }\n    }\n    stopped() {\n        return this._requestAnimationFrameId == 0;\n    }\n    _animationFrameCallback() {\n        this._requestAnimationFrameId = window.requestAnimationFrame(() => {\n            this._frame();\n            this._animationFrameCallback();\n        });\n    }\n    _frame() {\n        let now = window.performance.now();\n        this.dt = now - this._prevNow;\n        this._prevNow = now;\n        this.current = new Date(this.currentTime + this.dt * this.multiplier);\n        // this._events.dispatch(this._events.tick, this._current);\n    }\n    get range() {\n        return this._range;\n    }\n    set(rangeStart, rangeEnd) {\n        if (rangeStart !== this._rangeStart || rangeEnd !== this._rangeEnd) {\n            this._rangeStart = rangeStart;\n            this._rangeEnd = rangeEnd;\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\n            this.events.dispatch(this.events.change, rangeStart, rangeEnd);\n        }\n    }\n    get current() {\n        return this._current;\n    }\n    get rangeStart() {\n        return this._rangeStart;\n    }\n    get rangeEnd() {\n        return this._rangeEnd;\n    }\n    get rangeStartTime() {\n        return this._rangeStart.getTime();\n    }\n    get rangeEndTime() {\n        return this._rangeEnd.getTime();\n    }\n    get currentTime() {\n        return this._current.getTime();\n    }\n    set current(current) {\n        if (current !== this._current) {\n            if (this._maxDate && current > this._maxDate) {\n                this._current = this._maxDate;\n            }\n            else if (this._minDate && current < this._minDate) {\n                this._current = this._minDate;\n            }\n            else {\n                this._current = current;\n            }\n            this.events.dispatch(this.events.current, this._current);\n        }\n    }\n    set rangeStart(date) {\n        if (date !== this._rangeStart) {\n            this._rangeStart = date;\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\n            this.events.dispatch(this.events.change, date);\n        }\n    }\n    set rangeEnd(date) {\n        if (date !== this._rangeEnd) {\n            this._rangeEnd = date;\n            this._range = this._rangeEnd.getTime() - this._rangeStart.getTime();\n            this.events.dispatch(this.events.change, date);\n        }\n    }\n}\nexport { TimelineModel };\n//# sourceMappingURL=TimelineModel.js.map","import { ButtonGroup } from \"../../ui/ButtonGroup\";\nimport { View } from '../../ui/View';\nimport { ToggleButton } from \"../../ui/ToggleButton\";\nimport { TimelineModel } from './TimelineModel';\nimport { addSeconds, createCanvasHTML, dateToStr, drawNotch, drawText, getNearestTimeLeft, getScale } from './timelineUtils';\nconst SECONDS_TO_MILLISECONDS = 1000.0;\nconst MILLISECONDS_TO_SECONDS = 1.0 / SECONDS_TO_MILLISECONDS;\nconst TIMELINEVIEW_EVENTS = [\n    'startdrag',\n    'stopdrag',\n    'startdragcurrent',\n    'stopdragcurrent',\n    'setcurrent',\n    'reset',\n    'play',\n    'playback',\n    'pause',\n    'visibility'\n];\nconst ICON_PLAY_SVG = '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M8 5v14l11-7z\" style=\"fill: black;\"/></svg>';\nconst ICON_PAUSE_SVG = '<?xml version=\"1.0\" ?><!DOCTYPE svg  PUBLIC \\'-//W3C//DTD SVG 1.1//EN\\'  \\'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\\'><svg enable-background=\"new 0 0 512 512\" height=\"512px\" version=\"1.1\" viewBox=\"0 0 512 512\" width=\"512px\" xml:space=\"preserve\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"><g id=\"Layer_6\"><rect fill=\"#252525\" height=\"320\" width=\"60\" x=\"153\" y=\"96\"/><rect fill=\"#252525\" height=\"320\" width=\"60\" x=\"299\" y=\"96\"/></g></svg>';\nconst SCALE_FILL_COLOR = \"rgba(64, 59, 59, 1.0)\";\nconst SCALE_NOTCH_COLOR = \"#bfbfbf\";\nconst SCALE_TIME_COLOR = \"#bfbfbf\";\nconst TEMPLATE = `<div class=\"og-timeline\">\n\n  <div class=\"og-timeline-top\">\n  </div>\n\n  <div class=\"og-timeline-frame\">\n    <div class=\"og-timeline-current\">\n      <div class=\"og-timeline-current-spin\">\n        <div class=\"og-timeline-current-arrow\"></div>\n      </div>\n    </div>\n    <div class=\"og-timeline-scale\"></div>\n  </div>\n\n  <div class=\"og-timeline-bottom\">\n    <div class=\"og-timeline-controls\">\n    </div>\n  </div>\n\n</div>`;\nclass TimelineView extends View {\n    constructor(options = {}) {\n        super({\n            template: TEMPLATE,\n            model: new TimelineModel({\n                rangeStart: options.rangeStart,\n                rangeEnd: options.rangeEnd,\n                current: options.currentDate,\n                minDate: options.minDate,\n                maxDate: options.maxDate\n            })\n        });\n        this._onMouseWheel = (e) => {\n            if (this._isMouseOver) {\n                let rect = this._canvasEl.getBoundingClientRect();\n                let pointerPosX = e.clientX - rect.left, pointerCenterOffsetX = -(pointerPosX - this.clientWidth * 0.5);\n                let pointerTime = this.model.rangeStartTime + this._millisecondsInPixel * pointerPosX;\n                this._zoom(pointerTime, pointerCenterOffsetX, Math.sign(e.wheelDelta));\n            }\n            else if (this._isCurrentMouseOver) {\n                let pointerCenterOffsetX = -((this.model.currentTime - this.model.rangeStartTime) / this._millisecondsInPixel - this.clientWidth * 0.5);\n                this._zoom(this.model.currentTime, pointerCenterOffsetX, Math.sign(e.wheelDelta));\n            }\n        };\n        this._onMouseWheelFF = (e) => {\n            this._onMouseWheel(e);\n        };\n        this._onMouseDown = (e) => {\n            if (this._isMouseOver) {\n                this._isDragging = true;\n                document.body.classList.add(\"og-timeline-unselectable\");\n                this._clickPosX = e.clientX;\n                this._clickTime = Date.now();\n                this._clickRangeStart = this.model.rangeStart;\n                this._clickRangeEnd = this.model.rangeEnd;\n                this.events.dispatch(this.events.startdrag, e);\n            }\n            else if (this._isCurrentMouseOver) {\n                this._isCurrentDragging = true;\n                document.body.classList.add(\"og-timeline-unselectable\");\n                this._clickPosX = e.clientX;\n                this._clickCurrentDate = this.model.current;\n                this.events.dispatch(this.events.startdragcurrent, e);\n            }\n        };\n        this._onMouseUp = (e) => {\n            if (this._isDragging) {\n                this._isDragging = false;\n                document.body.classList.remove(\"og-timeline-unselectable\");\n                if (this._clickPosX === e.clientX && (Date.now() - this._clickTime) < this._clickDelay) {\n                    let rect = this._canvasEl.getBoundingClientRect();\n                    let current = new Date(this.model.rangeStartTime + (e.clientX - rect.left) * this._millisecondsInPixel);\n                    this.model.current = current;\n                    this.events.dispatch(this.events.stopdrag, current);\n                    this.events.dispatch(this.events.setcurrent, current);\n                }\n                else {\n                    this.events.dispatch(this.events.stopdrag, this.model.current);\n                }\n            }\n            else if (this._isCurrentDragging) {\n                this._isCurrentDragging = false;\n                document.body.classList.remove(\"og-timeline-unselectable\");\n                this.events.dispatch(this.events.stopdragcurrent, this.model.current);\n            }\n        };\n        this._onMouseEnter = () => {\n            this._isMouseOver = true;\n        };\n        this._onMouseOut = () => {\n            this._isMouseOver = false;\n        };\n        this._onCurrentMouseEnter = () => {\n            this._isCurrentMouseOver = true;\n        };\n        this._onCurrentMouseOut = () => {\n            this._isCurrentMouseOver = false;\n        };\n        this._onMouseMove = (e) => {\n            if (this._isDragging) {\n                let offsetSec = (this._clickPosX - e.clientX) * this._millisecondsInPixel * MILLISECONDS_TO_SECONDS;\n                this.model.set(addSeconds(this._clickRangeStart, offsetSec), addSeconds(this._clickRangeEnd, offsetSec));\n            }\n            else if (this._isCurrentDragging) {\n                let offsetSec = (this._clickPosX - e.clientX) * this._millisecondsInPixel * MILLISECONDS_TO_SECONDS;\n                let newCurrent = addSeconds(this._clickCurrentDate, -offsetSec);\n                if (newCurrent >= this.model.rangeStart && newCurrent <= this.model.rangeEnd) {\n                    this.model.current = addSeconds(this._clickCurrentDate, -offsetSec);\n                }\n            }\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(TIMELINEVIEW_EVENTS);\n        this.fillStyle = options.fillStyle || SCALE_FILL_COLOR;\n        this.$controls = null;\n        this._frameEl = null;\n        this._currentEl = null;\n        this._canvasEl = createCanvasHTML();\n        this._ctx = this._canvasEl.getContext('2d');\n        this._isMouseOver = false;\n        this._isDragging = false;\n        this._isCurrentDragging = false;\n        this._isCurrentMouseOver = false;\n        this._minWidth = 330;\n        this._canvasScale = 2;\n        this._millisecondsInPixel = 0;\n        this._clickPosX = 0;\n        this._clickRangeStart = new Date();\n        this._clickRangeEnd = new Date();\n        this._clickCurrentDate = new Date();\n        this._clickTime = 0;\n        this._clickDelay = 450;\n        this._onResizeObserver_ = this._onResizeObserver.bind(this);\n        this._resizeObserver = new ResizeObserver(this._onResizeObserver_);\n        this._pauseBtn = new ToggleButton({\n            classList: [\"og-timeline-control_button\"],\n            icon: ICON_PAUSE_SVG,\n            name: \"pause\"\n        });\n        this._playBtn = new ToggleButton({\n            classList: [\"og-timeline-control_button\"],\n            icon: ICON_PLAY_SVG,\n            name: \"play\"\n        });\n        this._buttons = new ButtonGroup({\n            buttons: [this._pauseBtn, this._playBtn]\n        });\n        this._visibility = false;\n    }\n    _onResizeObserver() {\n        this.resize();\n    }\n    get canvasScale() {\n        return this._canvasScale;\n    }\n    set canvasScale(scale) {\n        if (scale !== this._canvasScale) {\n            this._canvasScale = scale;\n            this.resize();\n        }\n    }\n    resize() {\n        this._resize();\n        this.draw();\n    }\n    afterRender(parentNode) {\n        this.resize();\n    }\n    render() {\n        super.render();\n        this.$controls = this.select(\".og-timeline-controls\");\n        this._frameEl = this.select(\".og-timeline-frame\");\n        this._currentEl = this.select(\".og-timeline-current\");\n        this.select(\".og-timeline-frame .og-timeline-scale\").appendChild(this._canvasEl);\n        this._resizeObserver.observe(this.el);\n        this.model.events.on(\"change\", () => {\n            this.draw();\n        });\n        this.model.events.on(\"current\", (d) => {\n            this._drawCurrent();\n            this.events.dispatch(this.events.setcurrent, d);\n        });\n        this._canvasEl.addEventListener(\"mouseenter\", this._onMouseEnter);\n        this._canvasEl.addEventListener(\"mouseout\", this._onMouseOut);\n        this._currentEl.addEventListener(\"mouseenter\", this._onCurrentMouseEnter);\n        this._currentEl.addEventListener(\"mouseout\", this._onCurrentMouseOut);\n        document.body.addEventListener(\"mousemove\", this._onMouseMove);\n        document.body.addEventListener(\"mousedown\", this._onMouseDown);\n        document.body.addEventListener(\"mouseup\", this._onMouseUp);\n        document.body.addEventListener(\"wheel\", this._onMouseWheelFF);\n        this._playBtn.appendTo(this.$controls);\n        this._pauseBtn.appendTo(this.$controls);\n        if (this.model.stopped()) {\n            this._pauseBtn.setActive(true, true);\n            this._pauseBtn.preventClick = true;\n        }\n        else {\n            this._playBtn.setActive(true, true);\n            this._playBtn.preventClick = true;\n        }\n        this._buttons.events.on(\"change\", (btn) => {\n            switch (btn.name) {\n                case \"play\":\n                    this.play();\n                    break;\n                case \"pause\":\n                    this.pause();\n                    break;\n            }\n        });\n        // let mltView = new View({\n        //     template: `<div class=\"og-timeline-multiplier\">\n        //                 <select>\n        //                     <option value=\"0.25\">0.25</option>\n        //                     <option value=\"0.5\">0.5</option>\n        //                     <option value=\"1\" selected>1.0</option>\n        //                     <option value=\"2\">2.0</option>\n        //                     <option value=\"3\">3.0</option>\n        //                     <option value=\"5\">5.0</option>\n        //                 </select>\n        //                 </div>`\n        // });\n        //mltView.appendTo($ctl)\n        // let multiplierEl = this.select(\".og-timeline-multiplier select\");\n        //\n        // multiplierEl.value = this.model.multiplier.toString();\n        // multiplierEl.addEventListener(\"change\", (e) => {\n        //     this.model.multiplier = Math.sign(this.model.multiplier) * Number(e.target.value);\n        // });\n        this.setVisibility(true);\n        return this;\n    }\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            this._visibility = visibility;\n            if (this.el) {\n                if (visibility) {\n                    this.el.style.display = \"block\";\n                }\n                else {\n                    this.el.style.display = \"none\";\n                }\n            }\n            this.events.dispatch(this.events.visibility, visibility);\n        }\n    }\n    reset() {\n        this.model.stop();\n        this.events.dispatch(this.events.reset, this.model);\n    }\n    play() {\n        this.model.multiplier = Math.abs(this.model.multiplier);\n        this.model.play();\n        this.events.dispatch(this.events.play, this.model);\n    }\n    pause() {\n        this.model.stop();\n        this.events.dispatch(this.events.pause, this.model);\n    }\n    playBack() {\n        this.model.multiplier = -1 * Math.abs(this.model.multiplier);\n        this.model.play();\n        this.events.dispatch(this.events.playback, this.model);\n    }\n    _zoom(pointerTime, pointerCenterOffsetX, dir) {\n        let centerTime = this.model.rangeStartTime + 0.5 * this.model.range;\n        let centerTimeOffset = (pointerTime - centerTime) * MILLISECONDS_TO_SECONDS;\n        let rangeStart = addSeconds(this.model.rangeStart, centerTimeOffset), rangeEnd = addSeconds(this.model.rangeEnd, centerTimeOffset);\n        let delta = ((rangeEnd.getTime() - rangeStart.getTime()) / 20) * MILLISECONDS_TO_SECONDS;\n        let newRangeStart = addSeconds(rangeStart, delta * dir);\n        let newRangeEnd = addSeconds(rangeEnd, -delta * dir);\n        let msPx = (newRangeEnd.getTime() - newRangeStart.getTime()) / this.clientWidth;\n        if (msPx < 31536000000 && msPx > 0.1) {\n            let timeOffset = msPx * pointerCenterOffsetX * MILLISECONDS_TO_SECONDS;\n            this.model.set(addSeconds(newRangeStart, timeOffset), addSeconds(newRangeEnd, timeOffset));\n        }\n    }\n    get clientWidth() {\n        return this._canvasEl ? this._canvasEl.width / this._canvasScale : 0;\n    }\n    get clientHeight() {\n        return this._canvasEl ? this._canvasEl.height / this._canvasScale : 0;\n    }\n    _resize() {\n        if (this._frameEl) {\n            this._canvasEl.width = this._frameEl.clientWidth * this._canvasScale;\n            this._canvasEl.height = this._frameEl.clientHeight * this._canvasScale;\n            this._canvasEl.style.width = `${this._frameEl.clientWidth}px`;\n            this._canvasEl.style.height = `${this._frameEl.clientHeight}px`;\n        }\n    }\n    getOffsetByTime(milliseconds) {\n        return (milliseconds - this.model.rangeStartTime) / this._millisecondsInPixel;\n    }\n    remove() {\n        super.remove();\n        this.model.stop();\n    }\n    _clearCanvas() {\n        this._ctx.fillStyle = this.fillStyle;\n        this._ctx.fillRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\n    }\n    _drawCurrent() {\n        let curPosX = (this.model.currentTime - this.model.rangeStartTime) / this._millisecondsInPixel;\n        if (this.model.current < this.model.rangeStart || this.model.current > this.model.rangeEnd) {\n            this._currentEl.style.display = \"none\";\n        }\n        else {\n            this._currentEl.style.display = \"block\";\n            this._currentEl.style.transform = `translateX(${curPosX}px)`;\n        }\n    }\n    draw() {\n        this._millisecondsInPixel = (this.model.range / this.clientWidth);\n        let minWidthMs = this._minWidth * this._millisecondsInPixel;\n        let scaleData = getScale(minWidthMs * MILLISECONDS_TO_SECONDS);\n        if (scaleData) {\n            this._clearCanvas();\n            let scaleMs = scaleData[0] * SECONDS_TO_MILLISECONDS, scalePx = scaleMs / this._millisecondsInPixel, segCount = scaleData[1];\n            let originTime = getNearestTimeLeft(this.model.rangeStartTime, scaleMs);\n            let showMilliseconds = scaleData[0] < 1.0, showTime = scaleData[0] < 86400.0;\n            for (let i = originTime, rangeEnd = this.model.rangeEndTime + scaleMs; i < rangeEnd; i += scaleMs) {\n                let x = this.getOffsetByTime(i);\n                if (x >= 0 && x <= this.clientWidth * this._canvasScale) {\n                    drawNotch(this._ctx, x * this._canvasScale, 10 * this._canvasScale, 2 * this._canvasScale, SCALE_NOTCH_COLOR);\n                }\n                for (let j = 1; j < segCount; j++) {\n                    let xx = x + j * (scalePx / segCount);\n                    if (xx >= 0 && xx <= this.clientWidth * this._canvasScale) {\n                        drawNotch(this._ctx, xx * this._canvasScale, 5 * this._canvasScale, 1 * this._canvasScale, SCALE_NOTCH_COLOR);\n                    }\n                }\n                drawText(this._ctx, dateToStr(new Date(i), showTime, showMilliseconds), x * this._canvasScale, 26 * this._canvasScale, \"24px monospace\", SCALE_TIME_COLOR, \"center\");\n            }\n            this._drawCurrent();\n        }\n    }\n}\nexport { TimelineView };\n//# sourceMappingURL=TimelineView.js.map","import { Dialog } from \"../../ui/Dialog\";\nimport { ToggleButton } from \"../../ui/ToggleButton\";\nimport { Control } from '../Control';\nimport { TimelineView } from './TimelineView';\nfunction addHours(date, hours) {\n    const temp = new Date(date);\n    temp.setHours(temp.getHours() + hours);\n    return temp;\n}\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\n    <!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 1000 1000\" enable-background=\"new 0 0 1000 1000\" xml:space=\"preserve\">\n    <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\n    <g><path d=\"M500,10C229.4,10,10,229.4,10,500s219.4,490,490,490s490-219.4,490-490S770.6,10,500,10z M800.3,800.3c-39,39-84.5,69.7-135,91C613,913.5,557.4,924.7,500,924.7s-112.9-11.2-165.3-33.3c-50.5-21.3-95.9-52-135-91c-39-39-69.7-84.5-91-135C86.5,612.9,75.3,557.4,75.3,500s11.2-112.9,33.3-165.3c21.3-50.5,52-95.9,91-135c39-39,84.5-69.7,135-91C387.1,86.5,442.6,75.3,500,75.3s112.9,11.2,165.3,33.3c50.5,21.3,95.9,52,135,91c39,39,69.7,84.5,91,135c22.1,52.3,33.3,107.9,33.3,165.3s-11.2,112.9-33.3,165.3C869.9,715.8,839.3,761.2,800.3,800.3z\"/><path d=\"M761.3,532.7H532.7V304c0-18.1-14.6-32.7-32.7-32.7s-32.7,14.6-32.7,32.7v261.3l0,0c0,18.1,14.6,32.7,32.7,32.7h261.3c18.1,0,32.7-14.6,32.7-32.7l0,0C794,547.3,779.4,532.7,761.3,532.7z\"/></g>\n</svg>`;\nclass TimelineControl extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"timeline\",\n            ...options\n        });\n        let currentDate = options.current || new Date();\n        let startDate = options.rangeStart || addHours(currentDate, -12);\n        let endDate = options.rangeEnd || addHours(currentDate, 12);\n        this._timelineView = new TimelineView({\n            rangeStart: startDate,\n            rangeEnd: endDate,\n            currentDate: currentDate\n        });\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-timeline_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        this._dialog = new Dialog({\n            title: \"Timeline\",\n            visible: false,\n            resizable: true,\n            useHide: true,\n            top: 10,\n            left: 60,\n            width: 600,\n            height: 115,\n            minHeight: 115,\n            maxHeight: 110\n        });\n        this._dialog.events.on(\"visibility\", (v) => {\n            this._toggleBtn.setActive(v);\n        });\n    }\n    oninit() {\n        let $container = this.renderer.div;\n        this._toggleBtn.appendTo($container);\n        this._dialog.appendTo($container);\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            this._dialog.setVisibility(isActive);\n            if (isActive) {\n                this._timelineView.resize();\n            }\n        });\n        this._timelineView.appendTo(this._dialog.container);\n        this._timelineView.events.on(\"setcurrent\", (d) => {\n            this.renderer && this.renderer.handler.defaultClock.setDate(d);\n        });\n        this._timelineView.events.on(\"startdrag\", () => {\n            this.renderer && this.renderer.controls.mouseNavigation.deactivate();\n        });\n        this._timelineView.events.on(\"stopdrag\", () => {\n            this.renderer && this.renderer.controls.mouseNavigation.activate();\n        });\n        this._timelineView.events.on(\"startdragcurrent\", () => {\n            this.renderer && this.renderer.controls.mouseNavigation.deactivate();\n        });\n        this._timelineView.events.on(\"stopdragcurrent\", () => {\n            this.renderer && this.renderer.controls.mouseNavigation.activate();\n        });\n    }\n}\nexport { TimelineControl };\n//# sourceMappingURL=TimelineControl.js.map","export class Deferred {\n    constructor() {\n        this.resolve = () => {\n        };\n        this.reject = () => {\n        };\n        this.promise = new Promise((resolve, reject) => {\n            this.resolve = resolve;\n            this.reject = reject;\n        });\n        Object.freeze(this);\n    }\n}\n//# sourceMappingURL=Deferred.js.map","import { Deferred } from '../../Deferred';\nimport { createEvents } from '../../Events';\nimport { Vec3 } from \"../../math/Vec3\";\nconst DEFAULT_WARNING_HEIGHT_LEVEL = 5;\nconst ELEVATIONPROFILE_EVENTS = [\"startcollecting\", \"profilecollected\", \"clear\"];\n/**\n * Point types\n */\nexport const SAFE = 0;\nexport const WARNING = 1;\nexport const COLLISION = 2;\n/**\n * drawData index names\n */\nconst TRACK = 0;\nconst GROUND = 1;\nconst SEGMMENT_LENGTH = 1.0; // Distance between query points on the ground\nconst GROUND_OFFSET = 1.0; // Ground level offset\nconst BOTTOM_PADDING = 0.1; // Range minY padding in percentage from the bottom\nconst TOP_PADDING = 0.2; // Range maxY padding in percentage from the top\nconst HEIGHT_EPS = 0.1; // Warning height level error\nexport class ElevationProfile {\n    constructor(options = {}) {\n        this.events = createEvents(ELEVATIONPROFILE_EVENTS);\n        this.planet = options.planet || null;\n        this._warningHeightLevel = DEFAULT_WARNING_HEIGHT_LEVEL;\n        this._pointsReady = false;\n        this._isWarning = false;\n        this._minX = 0;\n        this._planeDistance = this._maxX = 1000;\n        this._minY = 0;\n        this._maxY = 200;\n        this._drawData = [[], []];\n        this._promiseArr = [];\n        this._promiseCounter = 0;\n        this._pMaxY = 0;\n        this._pMinY = 0;\n        this._pDist = 0;\n        this._pTrackCoords = [];\n        this._pGroundCoords = [];\n        this._pIndex = 0;\n    }\n    bindPlanet(planet) {\n        this.planet = planet;\n    }\n    setWarningHeightLevel(warningHeight = 0) {\n        this._warningHeightLevel = warningHeight;\n    }\n    setRange(minX, maxX, minY, maxY) {\n        this._minX = minX;\n        this._maxX = maxX;\n        if (minY) {\n            this._minY = minY;\n        }\n        if (maxY) {\n            this._maxY = maxY;\n        }\n    }\n    _getHeightAsync(ll, pIndex, promiseCounter) {\n        let def = new Deferred();\n        if (this.planet) {\n            let msl = this.planet.terrain.geoid.getHeightLonLat(ll);\n            this.planet.terrain.getHeightAsync(ll, (elv) => {\n                if (this.planet && promiseCounter === this._promiseCounter) {\n                    elv += msl;\n                    this._pGroundCoords[pIndex][1] = elv;\n                    this._pGroundCoords[pIndex][2] = SAFE;\n                    this._pGroundCoords[pIndex][3] = ll.height;\n                    if (elv > this._pMaxY)\n                        this._pMaxY = elv;\n                    if (elv < this._pMinY)\n                        this._pMinY = elv;\n                    this._updatePointType(pIndex);\n                    def.resolve(elv);\n                }\n                else {\n                    def.reject();\n                }\n            });\n        }\n        else {\n            def.reject();\n        }\n        return def.promise;\n    }\n    _collectCoordsBetweenTwoTrackPoints(index, internalPoints, scaleFactor, p0, trackDir, promiseCounter) {\n        if (!this.planet)\n            return;\n        for (let j = 1; j <= internalPoints; j++) {\n            this._pDist += SEGMMENT_LENGTH;\n            this._pIndex++;\n            // Point on the track segment\n            let dirSegLen = j * scaleFactor;\n            let pjd = p0.add(trackDir.scaleTo(dirSegLen));\n            let llx = this.planet.ellipsoid.cartesianToLonLat(pjd);\n            this._pGroundCoords[this._pIndex] = [this._pDist, 0, SAFE, 0, index];\n            ((lonlat, index) => {\n                this._promiseArr.push(this._getHeightAsync(lonlat, index, promiseCounter));\n            })(llx, this._pIndex);\n        }\n    }\n    _collectAllPoints(pointsLonLat, promiseCounter) {\n        if (!this.planet)\n            return;\n        if (promiseCounter !== this._promiseCounter)\n            return;\n        let p0 = new Vec3(), p1 = new Vec3();\n        for (let i = 1, len = pointsLonLat.length; i < len; i++) {\n            let lonlat0 = pointsLonLat[i - 1], lonlat1 = pointsLonLat[i];\n            this.planet.ellipsoid.lonLatToCartesianRes(lonlat0, p0);\n            this.planet.ellipsoid.lonLatToCartesianRes(lonlat1, p1);\n            let trackDir = p1.sub(p0);\n            let dirLength = trackDir.length();\n            let n0 = this.planet.ellipsoid.getSurfaceNormal3v(p0);\n            let proj = Vec3.proj_b_to_plane(trackDir, n0);\n            let projLen = proj.length();\n            let internalPoints = Math.floor(projLen / SEGMMENT_LENGTH);\n            let scaleFactor = SEGMMENT_LENGTH * dirLength / projLen;\n            this._getGroundElevation(lonlat0, i - 1, promiseCounter);\n            proj.normalize();\n            trackDir.normalize();\n            // Getting internal point elevations and looking for the collisions\n            this._collectCoordsBetweenTwoTrackPoints(i - 1, internalPoints, scaleFactor, p0, trackDir, promiseCounter);\n            this._pDist += projLen - internalPoints * SEGMMENT_LENGTH;\n            this._pIndex++;\n            let elv = lonlat1.height;\n            if (elv > this._pMaxY)\n                this._pMaxY = elv;\n            if (elv < this._pMinY)\n                this._pMinY = elv;\n            this._pTrackCoords[i] = [this._pDist, elv, this._pIndex];\n        }\n    }\n    _getGroundElevation(lonLat, index, promiseCounter) {\n        this._pGroundCoords[this._pIndex] = [this._pDist, 0, SAFE, 0, index];\n        this._promiseArr.push(this._getHeightAsync(lonLat, this._pIndex, promiseCounter));\n    }\n    _calcPointsAsync(pointsLonLat, promiseCounter) {\n        return new Promise((resolve, reject) => {\n            this._pTrackCoords = [[0, pointsLonLat[0].height, 0]];\n            this._pMaxY = pointsLonLat[0].height;\n            this._pMinY = this._pMaxY;\n            this._pDist = 0;\n            this._pGroundCoords = [];\n            this._pIndex = 0;\n            this._promiseArr = [];\n            this._collectAllPoints(pointsLonLat, promiseCounter);\n            this._getGroundElevation(pointsLonLat[pointsLonLat.length - 1], pointsLonLat.length - 1, promiseCounter);\n            Promise.all(this._promiseArr).then(() => {\n                resolve({\n                    dist: this._pDist,\n                    minY: this._pMinY,\n                    maxY: this._pMaxY,\n                    trackCoords: this._pTrackCoords,\n                    groundCoords: this._pGroundCoords\n                });\n            });\n        });\n    }\n    get minX() {\n        return this._minX;\n    }\n    get planeDistance() {\n        return this._planeDistance;\n    }\n    get maxX() {\n        return this._maxX;\n    }\n    get minY() {\n        return this._minY;\n    }\n    get maxY() {\n        return this._maxY;\n    }\n    get pointsReady() {\n        return this._pointsReady;\n    }\n    get isWarningOrCollision() {\n        return this._isWarning;\n    }\n    get drawData() {\n        return this._drawData;\n    }\n    collectProfile(pointsLonLat) {\n        let def = new Deferred();\n        if (!this.planet)\n            def.reject();\n        this._pointsReady = false;\n        this._isWarning = false;\n        if (!pointsLonLat || !pointsLonLat.length) {\n            def.reject();\n            return def.promise;\n        }\n        this.events.dispatch(this.events.startcollecting, this);\n        this._promiseCounter++;\n        ((counter) => {\n            this._calcPointsAsync(pointsLonLat, counter).then((p) => {\n                if (counter === this._promiseCounter) {\n                    this._planeDistance = p.dist;\n                    this.setRange(0, p.dist, p.minY - BOTTOM_PADDING * Math.abs(p.minY), p.maxY + Math.abs(p.maxY) * TOP_PADDING);\n                    this._pointsReady = true;\n                    this._drawData = [p.trackCoords, p.groundCoords];\n                    this.events.dispatch(this.events.profilecollected, this._drawData, this);\n                    def.resolve(this._drawData);\n                }\n            });\n        })(this._promiseCounter);\n        return def.promise;\n    }\n    _updatePointType(pIndex) {\n        if ((this._pGroundCoords[pIndex][3] >= this._pGroundCoords[pIndex][1]) &&\n            (this._pGroundCoords[pIndex][3] < this._pGroundCoords[pIndex][1] + this._warningHeightLevel - HEIGHT_EPS)) {\n            this._pGroundCoords[pIndex][2] = WARNING;\n        }\n        if (this._pGroundCoords[pIndex][3] <= this._pGroundCoords[pIndex][1] + GROUND_OFFSET) {\n            this._pGroundCoords[pIndex][2] = COLLISION;\n        }\n        if (this._pGroundCoords[pIndex][2] === WARNING || this._pGroundCoords[pIndex][2] === COLLISION) {\n            this._isWarning = true;\n        }\n    }\n    /**\n     * @deprecated\n     */\n    _setPointsType() {\n        this._isWarning = false;\n        this._pTrackCoords = this._drawData[TRACK];\n        this._pGroundCoords = this._drawData[GROUND];\n        for (let i = 0; i < this._pGroundCoords.length; i++) {\n            this._updatePointType(i);\n        }\n        this._drawData[GROUND] = this._pGroundCoords;\n        this.events.dispatch(this.events.profilecollected, this._drawData, this);\n    }\n    clear() {\n        this._promiseCounter = 0;\n        this._pointsReady = false;\n        this._isWarning = false;\n        this._drawData = [[], []];\n        this._pMaxY = 0;\n        this._pMinY = 0;\n        this._pDist = 0;\n        this._pTrackCoords = [];\n        this._pGroundCoords = [];\n        this._pIndex = 0;\n        this.events.dispatch(this.events.clear, this._drawData, this);\n    }\n}\n//# sourceMappingURL=ElevationProfile.js.map","import { View } from '../../ui/View';\nimport { SAFE, WARNING, COLLISION, ElevationProfile } from './ElevationProfile';\nimport { distanceFormatExt, binarySearch } from \"../../utils/shared\";\nconst FILL_COLOR = \"rgb(63, 63, 63)\";\nconst TRACK_COLOR = \"rgb(0, 255, 50)\";\nconst TERRAIN_COLOR = \"rgb(198, 198, 198)\";\nconst TERRAIN_FILL_COLOR = \"rgb(64, 68, 82)\";\nconst WARNING_COLOR = \"rgb(255, 255, 0)\";\nconst COLLISION_COLOR = \"rgb(255, 0, 0)\";\nconst LINE_COLORS = [TERRAIN_COLOR, WARNING_COLOR, COLLISION_COLOR];\nconst TERRAIN_ALPHA = 0.5;\nconst LINE_WIDTH = 5;\nconst ELEVATIONPROFILEVIEW_EVENTS = [\"startdrag\", \"stopdrag\", \"pointer\", \"mouseenter\", \"mouseleave\", \"dblclick\", \"tracklength\", \"groundlength\", \"warninglength\", \"collisionlength\"];\nconst TEMPLATE = `<div class=\"og-elevationprofile\">\n      <div class=\"og-elevationprofile-loading\" style=\"display: none;\">\n        <div class=\"loadingio-spinner-bars-r354qqyl5v\">\n          <div class=\"ldio-p0v5a1f6oz\">\n            <div></div>\n            <div></div>\n            <div></div>\n            <div></div>\n          </div>\n        </div> \n      </div>     \n    </div>`;\nclass ElevationProfileView extends View {\n    constructor(options = {}) {\n        super({\n            template: TEMPLATE,\n            model: new ElevationProfile()\n        });\n        this._onMouseDblClick = (e) => {\n            //\n            // @todo: The same code as in the pointer mouse move\n            //\n            let rect = this.$canvas.getBoundingClientRect();\n            let x = e.clientX - rect.left;\n            let pointerDistance = this._leftDistance + (this._rightDistance - this._leftDistance) * x / this.clientWidth;\n            let groundData = this.model.drawData[1];\n            let trackData = this.model.drawData[0];\n            let groundPoiIndex;\n            if (pointerDistance < 0) {\n                groundPoiIndex = 1;\n                pointerDistance = 0;\n                x = (0 - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\n            }\n            else if (pointerDistance > this.model.planeDistance) {\n                groundPoiIndex = groundData.length - 1;\n                pointerDistance = this.model.planeDistance;\n                x = (pointerDistance - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\n            }\n            else {\n                groundPoiIndex = -1 - binarySearch(groundData, pointerDistance, (a, b) => {\n                    return a - b[0];\n                });\n            }\n            // Ground point\n            let gp0 = groundData[groundPoiIndex - 1], gp1 = groundData[groundPoiIndex];\n            let d = (pointerDistance - gp0[0]) / (gp1[0] - gp0[0]);\n            let groundElv = gp0[1] + d * (gp1[1] - gp0[1]);\n            // track point\n            let trackPoiIndex = gp0[4];\n            let tp0 = trackData[trackPoiIndex], tp1 = trackData[trackPoiIndex + 1];\n            d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\n            let trackElv = tp0[1] + d * (tp1[1] - tp0[1]);\n            this.events.dispatch(this.events.dblclick, pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex - 1, trackElv - groundElv);\n        };\n        this._onMouseEnter = (e) => {\n            this._isMouseOver = true;\n            this.events.dispatch(this.events.mouseenter, e);\n        };\n        this._onMouseOut = (e) => {\n            this._isMouseOver = false;\n            this.events.dispatch(this.events.mouseleave, e);\n        };\n        this._onMouseDown = (e) => {\n            if (this._isMouseOver) {\n                this._isDragging = true;\n                document.body.classList.add(\"og-timeline-unselectable\");\n                this._clickPosX = e.clientX;\n                if (!this._customFrame) {\n                    this._leftDistance = this.model.minX;\n                    this._rightDistance = this.model.maxX;\n                }\n                this._clickLeftDistance = this._leftDistance;\n                this._clickRightDistance = this._rightDistance;\n                this.events.dispatch(this.events.startdrag, e);\n            }\n        };\n        this._onMouseUp = (e) => {\n            if (this._isDragging) {\n                this._isDragging = false;\n                document.body.classList.remove(\"og-timeline-unselectable\");\n                this.events.dispatch(this.events.stopdrag, e);\n            }\n        };\n        this._onCanvasMouseMove = (e) => {\n            if (this.model.pointsReady) {\n                if (!this._isDragging) {\n                    if (!this._customFrame) {\n                        this._leftDistance = this.model.minX;\n                        this._rightDistance = this.model.maxX;\n                    }\n                    let rect = this.$pointerCanvas.getBoundingClientRect();\n                    let x = e.clientX - rect.left;\n                    this.redrawPointerCanvas(x);\n                }\n                else {\n                    this.clearPointerCanvas();\n                }\n            }\n        };\n        this._onMouseMove = (e) => {\n            if (this._isDragging && this.model.pointsReady) {\n                let offset = (this._clickPosX - e.clientX);\n                let distanceOffset = offset * this._canvasScale / this._pixelsInMeter_x;\n                this.setFrame(this._clickLeftDistance + distanceOffset, this._clickRightDistance + distanceOffset);\n            }\n        };\n        this._onMouseWheelFF = (e) => {\n            this._onMouseWheel(e);\n        };\n        this._onMouseWheel = (e) => {\n            if (this._isMouseOver && this.model.pointsReady) {\n                if (!this._customFrame) {\n                    this._leftDistance = this.model.minX;\n                    this._rightDistance = this.model.maxX;\n                }\n                this._customFrame = true;\n                let padDist = Math.sign(e.wheelDelta) * (this._rightDistance - this._leftDistance) / 20;\n                let rect = this.$canvas.getBoundingClientRect();\n                let pointerPosX = e.clientX - rect.left, pointerCenterOffsetX = pointerPosX - this.$canvas.clientWidth * 0.5;\n                let distanceCenterOffsetX = pointerCenterOffsetX * this._canvasScale / this._pixelsInMeter_x;\n                // Move distance under pointer to a screen center\n                let leftDistance = distanceCenterOffsetX + this._leftDistance + padDist;\n                let rightDistance = distanceCenterOffsetX + this._rightDistance - padDist;\n                // move center back to the mouse pointer\n                distanceCenterOffsetX = -pointerCenterOffsetX * (rightDistance - leftDistance) / this.clientWidth;\n                this.setFrame(leftDistance + distanceCenterOffsetX, rightDistance + distanceCenterOffsetX);\n                this.redrawPointerCanvas(pointerPosX);\n            }\n        };\n        //@ts-ignore\n        this.events = this.events.registerNames(ELEVATIONPROFILEVIEW_EVENTS);\n        this.fillStyle = options.fillStyle || FILL_COLOR;\n        this._customFrame = false;\n        this._leftDistance = 0;\n        this._rightDistance = 0;\n        this._pixelsInMeter_x = 0;\n        this._pixelsInMeter_y = 0;\n        this._canvasScale = 2;\n        this.$canvas = document.createElement(\"canvas\");\n        this.$canvas.style.position = \"absolute\";\n        this._ctx = this.$canvas.getContext('2d');\n        this.$pointerCanvas = document.createElement(\"canvas\");\n        this.$pointerCanvas.style.pointerEvents = \"none\";\n        this.$pointerCanvas.style.position = \"absolute\";\n        this._pointerCtx = this.$pointerCanvas.getContext('2d');\n        this.$loading = null;\n        this._isMouseOver = false;\n        this._isDragging = false;\n        this._clickPosX = 0;\n        this._clickLeftDistance = 0;\n        this._clickRightDistance = 0;\n        this._timeStartHandler = 0;\n        this._onResizeObserver_ = this._onResizeObserver.bind(this);\n        this._resizeObserver = new ResizeObserver(this._onResizeObserver_);\n    }\n    _onResizeObserver() {\n        this.resize();\n    }\n    get canvasScale() {\n        return this._canvasScale;\n    }\n    set canvasScale(scale) {\n        if (scale !== this._canvasScale) {\n            this._canvasScale = scale;\n            this.resize();\n        }\n    }\n    resize() {\n        this._resize();\n        this.draw();\n    }\n    render() {\n        super.render();\n        this._resizeObserver.observe(this.el);\n        this.el.appendChild(this.$canvas);\n        this.el.appendChild(this.$pointerCanvas);\n        this.model.events.on(\"profilecollected\", (data) => {\n            this._hideLoading();\n            this.clearPointerCanvas();\n            this.draw();\n        });\n        this.model.events.on(\"startcollecting\", () => {\n            clearTimeout(this._timeStartHandler);\n            //@ts-ignore\n            this._timeStartHandler = setTimeout(() => {\n                this._showLoading();\n            }, 450);\n        });\n        this.model.events.on(\"clear\", () => {\n            this._customFrame = false;\n            this._leftDistance = 0;\n            this.clearCanvas();\n            this.clearPointerCanvas();\n        });\n        this.$loading = this.select(\".og-elevationprofile-loading\");\n        this.$canvas.addEventListener(\"mouseenter\", this._onMouseEnter);\n        this.$canvas.addEventListener(\"mouseout\", this._onMouseOut);\n        this.$canvas.addEventListener(\"dblclick\", this._onMouseDblClick);\n        this.$canvas.addEventListener(\"mousemove\", this._onCanvasMouseMove);\n        document.body.addEventListener(\"mousemove\", this._onMouseMove);\n        document.body.addEventListener(\"mousedown\", this._onMouseDown);\n        document.body.addEventListener(\"mouseup\", this._onMouseUp);\n        document.body.addEventListener(\"wheel\", this._onMouseWheelFF);\n        return this;\n    }\n    _hideLoading() {\n        clearTimeout(this._timeStartHandler);\n        this.$loading.style.display = \"none\";\n    }\n    _showLoading() {\n        this.$loading.style.display = \"flex\";\n    }\n    redrawPointerCanvas(x) {\n        this.clearPointerCanvas();\n        let pointerDistance = this._leftDistance + (this._rightDistance - this._leftDistance) * x / this.clientWidth;\n        let groundData = this.model.drawData[1];\n        let trackData = this.model.drawData[0];\n        let groundPoiIndex;\n        if (pointerDistance < 0) {\n            groundPoiIndex = 1;\n            pointerDistance = 0;\n            x = (0 - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\n        }\n        else if (pointerDistance > this.model.planeDistance) {\n            groundPoiIndex = groundData.length - 1;\n            pointerDistance = this.model.planeDistance;\n            x = (pointerDistance - this._leftDistance) * this.clientWidth / (this._rightDistance - this._leftDistance);\n        }\n        else {\n            groundPoiIndex = -1 - binarySearch(groundData, pointerDistance, (a, b) => {\n                return a - b[0];\n            });\n        }\n        // Ground point\n        let gp0 = groundData[groundPoiIndex - 1], gp1 = groundData[groundPoiIndex];\n        let d = (pointerDistance - gp0[0]) / (gp1[0] - gp0[0]);\n        let groundElv = gp0[1] + d * (gp1[1] - gp0[1]);\n        // track point\n        let trackPoiIndex = gp0[4];\n        let tp0 = trackData[trackPoiIndex], tp1 = trackData[trackPoiIndex + 1];\n        d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\n        let trackElv = tp0[1] + d * (tp1[1] - tp0[1]);\n        let trackY = (this.model.maxY - trackElv) * this._pixelsInMeter_y;\n        let groundY = (this.model.maxY - groundElv) * this._pixelsInMeter_y;\n        this.events.dispatch(this.events.pointer, pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex - 1, trackElv - groundElv);\n        let ctx = this._pointerCtx;\n        // Vertical grey line\n        ctx.lineWidth = 3;\n        ctx.strokeStyle = \"rgba(64,64,64,0.6)\";\n        ctx.beginPath();\n        ctx.moveTo(x * this._canvasScale, 0);\n        ctx.lineTo(x * this._canvasScale, this.clientHeight * this._canvasScale);\n        ctx.stroke();\n        // Ground point\n        ctx.beginPath();\n        ctx.arc(x * this._canvasScale, groundY, 4, 0, 2 * Math.PI, false);\n        ctx.fillStyle = '#FFB277';\n        ctx.fill();\n        ctx.lineWidth = 4;\n        ctx.strokeStyle = '#FFB277';\n        ctx.stroke();\n        // Track point\n        ctx.beginPath();\n        ctx.arc(x * this._canvasScale, trackY, 4, 0, 2 * Math.PI, false);\n        ctx.fillStyle = '#FFB277';\n        ctx.fill();\n        ctx.lineWidth = 4;\n        ctx.strokeStyle = '#FFB277';\n        ctx.stroke();\n        // Vertical white line\n        ctx.lineWidth = 3;\n        ctx.strokeStyle = \"#FFB277\";\n        ctx.beginPath();\n        ctx.moveTo(x * this._canvasScale, groundY);\n        ctx.lineTo(x * this._canvasScale, trackY);\n        ctx.stroke();\n        // Altitude label\n        ctx.fillStyle = \"white\";\n        ctx.font = `${28 / devicePixelRatio}px Arial`;\n        ctx.textBaseline = \"middle\";\n        ctx.textAlign = \"left\";\n        ctx.fillText(`${Math.round(trackElv - groundElv).toString()} m`, (x + 5) * this._canvasScale, groundY + (trackY - groundY) * 0.5);\n        // distance from the begining label\n        ctx.fillStyle = \"white\";\n        ctx.font = `${28 / devicePixelRatio}px Arial`;\n        ctx.textAlign = \"right\";\n        let distStr = distanceFormatExt(pointerDistance);\n        ctx.fillText(`${distStr[0]} ${distStr[1]}`, (x - 5) * this._canvasScale, (this.clientHeight - 7) * this._canvasScale);\n    }\n    get clientWidth() {\n        return this.$canvas ? this.$canvas.width / this._canvasScale : 0;\n    }\n    get clientHeight() {\n        return this.$canvas ? this.$canvas.height / this._canvasScale : 0;\n    }\n    _resize() {\n        if (this.el) {\n            this.$canvas.width = this.el.clientWidth * this._canvasScale;\n            this.$canvas.height = this.el.clientHeight * this._canvasScale;\n            this.$canvas.style.width = `${this.el.clientWidth}px`;\n            this.$canvas.style.height = `${this.el.clientHeight}px`;\n            this.$pointerCanvas.width = this.el.clientWidth * this._canvasScale;\n            this.$pointerCanvas.height = this.el.clientHeight * this._canvasScale;\n            this.$pointerCanvas.style.width = `${this.el.clientWidth}px`;\n            this.$pointerCanvas.style.height = `${this.el.clientHeight}px`;\n            if (this._customFrame) {\n                this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this._rightDistance - this._leftDistance);\n            }\n        }\n    }\n    clearPointerCanvas() {\n        this._pointerCtx.fillStyle = \"rgba(0,0,0,0)\";\n        this._pointerCtx.clearRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\n    }\n    clearCanvas() {\n        const grd = this._ctx.createLinearGradient(0, 0, 0, this.clientHeight * this._canvasScale);\n        grd.addColorStop(0, \"black\");\n        grd.addColorStop(1, this.fillStyle);\n        this._ctx.fillStyle = grd;\n        this._ctx.fillRect(0, 0, this.clientWidth * this._canvasScale, this.clientHeight * this._canvasScale);\n    }\n    setFrame(leftDistance, rightDistance) {\n        this._leftDistance = leftDistance;\n        this._rightDistance = rightDistance;\n        this._customFrame = true;\n        this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this._rightDistance - this._leftDistance);\n        this.model.setRange(leftDistance, rightDistance);\n        this.draw();\n    }\n    _updateUnits() {\n        if (!this._customFrame) {\n            this._pixelsInMeter_x = this._canvasScale * this.clientWidth / (this.model.maxX - this.model.minX);\n        }\n        this._pixelsInMeter_y = this._canvasScale * this.clientHeight / (this.model.maxY - this.model.minY);\n    }\n    clear() {\n        this.model.clear();\n        this.clearCanvas();\n    }\n    draw() {\n        let trackCoords = this.model.drawData[0];\n        if (trackCoords.length > 1) {\n            this._updateUnits();\n            this.clearCanvas();\n            let groundCoords = this.model.drawData[1];\n            this._drawTrack(trackCoords, groundCoords);\n            this._drawTerrain(groundCoords);\n            this._drawWarningAndCollision(groundCoords);\n            this._drawLabels(trackCoords, groundCoords);\n        }\n        else {\n            this.clearCanvas();\n        }\n    }\n    _drawLabels(coords, groundCoords) {\n        let ctx = this._ctx;\n        if (ctx) {\n            let p0 = coords[0];\n            const maxY = this.model.maxY;\n            let x = (-this._leftDistance + p0[0]) * this._pixelsInMeter_x, yt = (maxY - p0[1]) * this._pixelsInMeter_y, yg = (maxY - groundCoords[p0[2]][1]) * this._pixelsInMeter_y;\n            // Track points\n            ctx.beginPath();\n            ctx.fillStyle = '#F7F718';\n            ctx.fillRect(x - 4, yt - 4, 8, 8);\n            ctx.stroke();\n            // Alt label\n            ctx.fillStyle = \"white\";\n            ctx.font = `${26 / devicePixelRatio}px Arial`;\n            ctx.textBaseline = \"bottom\";\n            ctx.textAlign = \"left\";\n            ctx.fillText(`${Math.round(p0[1] - groundCoords[p0[2]][1]).toString()} m`, x + 1, yt - 10);\n            ctx.stroke();\n            for (let i = 1, len = coords.length; i < len; i++) {\n                let pi = coords[i];\n                x = (-this._leftDistance + pi[0]) * this._pixelsInMeter_x;\n                yt = (maxY - pi[1]) * this._pixelsInMeter_y;\n                yg = (maxY - groundCoords[pi[2]][1]) * this._pixelsInMeter_y;\n                // Track points\n                ctx.beginPath();\n                ctx.fillStyle = '#F7F718';\n                ctx.fillRect(x - 4, yt - 4, 8, 8);\n                ctx.stroke();\n                // Alt label\n                ctx.fillStyle = \"white\";\n                ctx.fillText(`${Math.round(pi[1] - groundCoords[pi[2]][1]).toString()} m`, x + 1, yt - 10);\n                ctx.stroke();\n            }\n        }\n    }\n    _drawTrack(coords, groundCoords) {\n        let p0 = coords[0];\n        let ctx = this._ctx;\n        if (ctx) {\n            const maxY = this.model.maxY;\n            ctx.lineWidth = LINE_WIDTH;\n            ctx.strokeStyle = TRACK_COLOR;\n            ctx.beginPath();\n            ctx.moveTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, (maxY - p0[1]) * this._pixelsInMeter_y);\n            let trackLength = 0;\n            for (let i = 1, len = coords.length; i < len; i++) {\n                let pi = coords[i];\n                ctx.lineTo((-this._leftDistance + pi[0]) * this._pixelsInMeter_x, (maxY - pi[1]) * this._pixelsInMeter_y);\n                let prevP = coords[i - 1];\n                let a = pi[0] - prevP[0], b = pi[1] - prevP[1], aa = a * a, bb = b * b;\n                trackLength += Math.sqrt(aa + bb);\n            }\n            ctx.stroke();\n            // Track points lines\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = \"rgba(255,255,255,0.7)\";\n            ctx.beginPath();\n            let x = (-this._leftDistance + p0[0]) * this._pixelsInMeter_x, yt = (maxY - p0[1]) * this._pixelsInMeter_y, yg = (maxY - groundCoords[p0[2]][1]) * this._pixelsInMeter_y;\n            ctx.moveTo(x, yt);\n            ctx.lineTo(x, yg);\n            for (let i = 1, len = coords.length; i < len; i++) {\n                let pi = coords[i];\n                x = (-this._leftDistance + pi[0]) * this._pixelsInMeter_x;\n                yt = (maxY - pi[1]) * this._pixelsInMeter_y;\n                yg = (maxY - groundCoords[pi[2]][1]) * this._pixelsInMeter_y;\n                ctx.strokeStyle = \"rgba(255,255,255,0.7)\";\n                ctx.moveTo(x, yt);\n                ctx.lineTo(x, yg);\n            }\n            ctx.stroke();\n            this.events.dispatch(this.events.tracklength, trackLength);\n        }\n    }\n    _drawTerrain(coords) {\n        let p0 = coords[0];\n        let ctx = this._ctx;\n        if (ctx) {\n            const maxY = this.model.maxY;\n            ctx.lineWidth = LINE_WIDTH;\n            ctx.strokeStyle = TERRAIN_COLOR;\n            ctx.beginPath();\n            ctx.moveTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, this.$canvas.height);\n            ctx.lineTo((-this._leftDistance + p0[0]) * this._pixelsInMeter_x, (maxY - p0[1]) * this._pixelsInMeter_y);\n            let groundLength = 0;\n            for (let i = 1, len = coords.length; i < len; i++) {\n                let pi = coords[i];\n                ctx.lineTo((-this._leftDistance + pi[0]) * this._pixelsInMeter_x, (maxY - pi[1]) * this._pixelsInMeter_y);\n                let prevP = coords[i - 1];\n                let a = pi[0] - prevP[0], b = pi[1] - prevP[1], aa = a * a, bb = b * b;\n                groundLength += Math.sqrt(aa + bb);\n            }\n            ctx.lineTo((-this._leftDistance + coords[coords.length - 1][0]) * this._pixelsInMeter_x, this.$canvas.height);\n            ctx.closePath();\n            ctx.stroke();\n            ctx.save();\n            ctx.fillStyle = TERRAIN_FILL_COLOR;\n            ctx.globalAlpha = TERRAIN_ALPHA;\n            ctx.fill();\n            ctx.restore();\n            ctx.globalAlpha = 1;\n            this.events.dispatch(this.events.groundlength, groundLength);\n        }\n    }\n    _drawWarningAndCollision(coords) {\n        let ctx = this._ctx;\n        if (ctx && coords.length > 1) {\n            let maxY = this.model.maxY;\n            ctx.lineWidth = LINE_WIDTH;\n            ctx.beginPath();\n            let warningLength = 0, collisionLength = 0;\n            for (let i = 0, len = coords.length - 1; i < len; i++) {\n                let pi0 = coords[i], pi1 = coords[i + 1];\n                if (pi0[2] !== SAFE && pi1[2] !== SAFE) {\n                    let a = pi1[0] - pi0[0], b = pi1[1] - pi0[1], aa = a * a, bb = b * b;\n                    if (pi0[2] === COLLISION) {\n                        ctx.stroke();\n                        ctx.beginPath();\n                        ctx.strokeStyle = LINE_COLORS[COLLISION];\n                        collisionLength += Math.sqrt(aa + bb);\n                    }\n                    else if (pi0[2] === WARNING) {\n                        ctx.stroke();\n                        ctx.beginPath();\n                        ctx.strokeStyle = LINE_COLORS[WARNING];\n                        warningLength += Math.sqrt(aa + bb);\n                    }\n                    ctx.moveTo((-this._leftDistance + pi0[0]) * this._pixelsInMeter_x, (maxY - pi0[1]) * this._pixelsInMeter_y);\n                    ctx.lineTo((-this._leftDistance + pi1[0]) * this._pixelsInMeter_x, (maxY - pi1[1]) * this._pixelsInMeter_y);\n                }\n            }\n            ctx.stroke();\n            this.events.dispatch(this.events.warninglength, warningLength);\n            this.events.dispatch(this.events.collisionlength, collisionLength);\n        }\n    }\n}\nexport { ElevationProfileView };\n//# sourceMappingURL=ElevationProfileView.js.map","import { Entity } from '../../entity/Entity';\nimport { createEvents } from '../../Events';\nimport { LonLat } from \"../../LonLat\";\nimport { Extent } from \"../../Extent\";\nimport { Object3d } from '../../Object3d';\nimport { RenderNode } from '../../scene/RenderNode';\nimport { Vector } from '../../layer/Vector';\nimport { Vec2 } from '../../math/Vec2';\nimport { Vec3 } from '../../math/Vec3';\nimport { Ray } from \"../../math/Ray\";\nlet groundObj3d = Object3d.createCylinder(0.33, 0, 1.0, 20, 1, true, false, 0, 0, 0);\nlet headObj3d = Object3d.createCylinder(0.33, 0.33, 1.1, 20, 1, true, true, 0, -0.55, 0);\nconst POINTER_RAY_OPTIONS = {\n    startPosition: new Vec3(),\n    endPosition: new Vec3(),\n    startColor: \"rgba(255,131,0,0.2)\",\n    endColor: \"rgba(255,131,0,1.0)\",\n    thickness: 2.7\n};\nconst POINTER_BILLBOARD_OPTIONS = {\n    src: \"data:image/png;base64,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\",\n    color: \"rgb(255,131,0)\",\n    size: [8, 8]\n};\nconst POINTER_LABEL_OPTIONS = {\n    text: \"\",\n    size: 10.5,\n    color: \"rgba(455,455,455,1.0)\",\n    outlineColor: \"rgba(0,0,0,0.34)\",\n    outline: 0.23,\n    align: \"left\",\n    offset: [5, 15, -5]\n};\nconst LABEL_OPTIONS = {\n    text: \"\",\n    size: 10.5,\n    color: \"rgba(455,455,455,1.0)\",\n    outlineColor: \"rgba(0,0,0,0.34)\",\n    outline: 0.23,\n    align: \"right\",\n    offset: [-47, 25, 0]\n};\nconst GROUND_POINTER_OPTIONS = {\n    instanced: true,\n    tag: \"ground-pointer\",\n    color: \"rgb(0,305,0)\",\n    object3d: groundObj3d\n};\nconst HEAD_POINTER_OPTIONS = {\n    instanced: true,\n    tag: \"head-pointer\",\n    color: \"rgb(305,305,0)\",\n    object3d: headObj3d\n};\nclass ElevationProfileScene extends RenderNode {\n    constructor(options = {}) {\n        super(\"ElevationProfileScene\");\n        this._onLClick = (e) => {\n            let groundPos = this._planet.getCartesianFromPixelTerrain(e.pos);\n            if (groundPos) {\n                this.addGroundPoint3vAsync(groundPos);\n            }\n        };\n        this._onMouseMove = (e) => {\n            let mouseCart = this._planet.getCartesianFromMouseTerrain();\n            if (this._pickedGroundEntity) {\n                let d = new Vec2(e.x, e.y).sub(this._startClickPos), p = this._startEntityPos.add(d);\n                let groundCart = this._planet.getCartesianFromPixelTerrain(p);\n                if (groundCart) {\n                    this.setGroundPointCartesian3v(this._pickedGroundEntity.properties.index, groundCart);\n                }\n            }\n            else if (this._pickedHeadEntity) {\n                let cam = this._planet.camera;\n                let p0 = this._pickedHeadEntity.properties.groundEntity.getCartesian();\n                let groundNormal = this._planet.ellipsoid.getSurfaceNormal3v(p0);\n                let p1 = p0.add(groundNormal);\n                let p2 = p0.add(cam.getRight());\n                let px = new Vec3();\n                if (new Ray(cam.eye, e.direction).hitPlane(p0, p1, p2, px) === Ray.INSIDE) {\n                    let h = Vec3.proj_b_to_a(px, p0);\n                    let s = h.sub(p0).dot(p0);\n                    let headPos = p0.add(groundNormal.scale(Math.sign(s) * h.distance(p0)));\n                    this.setHeadPointCartesian3v(this._pickedHeadEntity.properties.index, headPos);\n                }\n            }\n        };\n        this._onLUp = (e) => {\n        };\n        this._onGroundPointerEnter = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"pointer\";\n        };\n        this._onGroundPointerLeave = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"default\";\n        };\n        this._onGroundPointerLDown = (e) => {\n            this._clampToGround = false;\n            this.renderer.controls.mouseNavigation.deactivate();\n            this._pickedGroundEntity = e.pickingObject;\n            const coords = this._pickedGroundEntity.getCartesian();\n            this._startClickPos.set(e.x, e.y);\n            this._startEntityPos = this._planet.getPixelFromCartesian(coords);\n        };\n        this._onGroundPointerLUp = (e) => {\n            this._clampToGround = true;\n            this.renderer.controls.mouseNavigation.activate();\n            this._pickedGroundEntity = null;\n        };\n        this._onHeadPointerEnter = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"pointer\";\n        };\n        this._onHeadPointerLeave = (e) => {\n            e.renderer.handler.canvas.style.cursor = \"default\";\n        };\n        this._onHeadPointerLDown = (e) => {\n            this.renderer.controls.mouseNavigation.deactivate();\n            this._pickedHeadEntity = e.pickingObject;\n        };\n        this._onHeadPointerLUp = (e) => {\n            this.renderer.controls.mouseNavigation.activate();\n            this._pickedHeadEntity = null;\n        };\n        this.events = createEvents(ELEVATIONPROFILESCENE_EVENTS);\n        this._planet = options.planet || null;\n        this._pickedGroundEntity = null;\n        this._pickedHeadEntity = null;\n        this._startClickPos = new Vec2();\n        this._startEntityPos = new Vec2();\n        this._clampToGround = true;\n        this._trackLayer = new Vector(\"track\", {\n            entities: [],\n            pickingEnabled: false,\n            polygonOffsetUnits: -1.0,\n            relativeToGround: true,\n            hideInLayerSwitcher: true\n        });\n        this._groundPointersLayer = new Vector(\"ground-pointers\", {\n            entities: [],\n            pickingEnabled: true,\n            hideInLayerSwitcher: true,\n            scaleByDistance: [1, 5000, 0.02],\n            pickingScale: 1.5\n        });\n        this._headPointersLayer = new Vector(\"head-pointers\", {\n            entities: [],\n            pickingEnabled: true,\n            hideInLayerSwitcher: true,\n            scaleByDistance: [1, 10000, 0.02],\n            pickingScale: 1\n        });\n        this._columnPointersLayer = new Vector(\"column-pointers\", {\n            entities: [],\n            pickingEnabled: false,\n            hideInLayerSwitcher: true\n        });\n        this._trackEntity = new Entity({\n            polyline: {\n                path3v: [],\n                thickness: 3.8,\n                color: \"rgba(0,305,0,0.8)\",\n                isClosed: false\n            }\n        });\n        this._trackLayer = new Vector(\"column-pointers\", {\n            entities: [this._trackEntity],\n            pickingEnabled: false,\n            hideInLayerSwitcher: true\n        });\n        this._heightsLayer = new Vector(\"heights-labels\", {\n            entities: [],\n            pickingEnabled: false,\n            hideInLayerSwitcher: true\n        });\n        this._pointerHeadEntity = new Entity({\n            cartesian: new Vec3(),\n            billboard: POINTER_BILLBOARD_OPTIONS\n        });\n        this._pointerLabelEntity = new Entity({\n            cartesian: new Vec3(),\n            label: POINTER_LABEL_OPTIONS\n        });\n        this._pointerRayEntity = new Entity({\n            cartesian: new Vec3(),\n            ray: POINTER_RAY_OPTIONS\n        });\n        this._pointerLayer = new Vector(\"pointer\", {\n            entities: [this._pointerHeadEntity, this._pointerLabelEntity, this._pointerRayEntity],\n            pickingEnabled: false,\n            hideInLayerSwitcher: true\n        });\n    }\n    flyExtent() {\n        let entities = this._headPointersLayer.getEntities();\n        let minLon = 180, minLat = 180, maxLon = -180, maxLat = -180, maxHeight = -1000000;\n        if (entities.length > 1) {\n            for (let i = 0; i < entities.length; i++) {\n                let ll = entities[i].getLonLat();\n                if (ll.lon < minLon)\n                    minLon = ll.lon;\n                if (ll.lat < minLat)\n                    minLat = ll.lat;\n                if (ll.lon > maxLon)\n                    maxLon = ll.lon;\n                if (ll.lat > maxLat)\n                    maxLat = ll.lat;\n                if (ll.height > maxHeight)\n                    maxHeight = ll.height;\n            }\n            this._planet.camera.flyExtent(new Extent(new LonLat(minLon, minLat), new LonLat(maxLon, maxLat)), maxHeight, null, 0);\n        }\n    }\n    get planet() {\n        return this._planet;\n    }\n    _createGroundPointer(groundCart, altitude = 10) {\n        let surfaceNormal = this.ellipsoid.getSurfaceNormal3v(groundCart);\n        let headCart = groundCart.add(surfaceNormal.scale(altitude));\n        let columnEntity = new Entity({\n            ray: {\n                startPosition: groundCart,\n                endPosition: headCart,\n                startColor: \"rgba(255,255,255,0.2)\",\n                endColor: \"rgba(355,355,355,1.0)\",\n                thickness: 3.2\n            }\n        });\n        let groundEntity = new Entity({\n            cartesian: groundCart,\n            geoObject: GROUND_POINTER_OPTIONS,\n        });\n        let headEntity = new Entity({\n            cartesian: headCart,\n            geoObject: HEAD_POINTER_OPTIONS,\n            properties: {}\n        });\n        let heightLabelEntity = new Entity({\n            cartesian: headCart,\n            label: LABEL_OPTIONS\n        });\n        heightLabelEntity.appendChild(new Entity({\n            cartesian: headCart,\n            label: { ...LABEL_OPTIONS, offset: [-47, 45, 0] }\n        }));\n        const index = this._groundPointersLayer.getEntities().length;\n        columnEntity.properties =\n            groundEntity.properties =\n                headEntity.properties = {\n                    index,\n                    altitude: altitude,\n                    lonLatEll: new LonLat(),\n                    headEntity,\n                    groundEntity,\n                    columnEntity,\n                    heightLabelEntity\n                };\n        return { headEntity, groundEntity, columnEntity, heightLabelEntity };\n    }\n    setPointerCartesian3v(p, height) {\n        this._pointerLabelEntity.setCartesian3v(p);\n        this._pointerLabelEntity.label.setText(`${Math.round(height).toString()} m`);\n        this._pointerRayEntity.ray.setEndPosition3v(p);\n        let n = this._planet.ellipsoid.getSurfaceNormal3v(p);\n        this._pointerRayEntity.ray.setStartPosition3v(p.add(n.scale(-height)));\n        this._pointerHeadEntity.setCartesian3v(p);\n    }\n    bindPlanet(planet) {\n        this._planet = planet;\n    }\n    init() {\n        this._activate();\n    }\n    onremove() {\n        this._deactivate();\n    }\n    _activate() {\n        this._planet.addLayer(this._trackLayer);\n        this._planet.addLayer(this._groundPointersLayer);\n        this._planet.addLayer(this._columnPointersLayer);\n        this._planet.addLayer(this._headPointersLayer);\n        this._planet.addLayer(this._heightsLayer);\n        this._planet.addLayer(this._pointerLayer);\n        this.renderer.events.on(\"ldblclick\", this._onLClick);\n        this.renderer.events.on(\"mousemove\", this._onMouseMove);\n        this.renderer.events.on(\"lup\", this._onLUp);\n        this._groundPointersLayer.events.on(\"mouseenter\", this._onGroundPointerEnter);\n        this._groundPointersLayer.events.on(\"mouseleave\", this._onGroundPointerLeave);\n        this._groundPointersLayer.events.on(\"ldown\", this._onGroundPointerLDown);\n        this._groundPointersLayer.events.on(\"lup\", this._onGroundPointerLUp);\n        this._headPointersLayer.events.on(\"mouseenter\", this._onHeadPointerEnter);\n        this._headPointersLayer.events.on(\"mouseleave\", this._onHeadPointerLeave);\n        this._headPointersLayer.events.on(\"ldown\", this._onHeadPointerLDown);\n        this._headPointersLayer.events.on(\"lup\", this._onHeadPointerLUp);\n        this.setPointerVisibility(false);\n    }\n    getPointLonLat(index) {\n        let entity = this._headPointersLayer.getEntities()[index];\n        if (entity) {\n            return entity.getLonLat();\n        }\n    }\n    getPointsLonLat() {\n        let entities = this._headPointersLayer.getEntities();\n        let points = new Array(entities.length);\n        for (let i = 0, len = points.length; i < len; i++) {\n            let ei = entities[i];\n            points[i] = ei.getLonLat();\n        }\n        return points;\n    }\n    getHeightMSL(lonLat) {\n        if (this._planet && this._planet.terrain.geoid) {\n            return this._planet.terrain.geoid.getHeightLonLat(lonLat);\n        }\n        return 0;\n    }\n    getHeightELLAsync(lonLat) {\n        return new Promise((resolve, reject) => {\n            this._planet.terrain.getHeightAsync(lonLat, (hGnd) => {\n                if (this._planet) {\n                    let hMsl = this.getHeightMSL(lonLat);\n                    resolve(hGnd + hMsl);\n                }\n                else {\n                    reject();\n                }\n            });\n        });\n    }\n    addPointLonLatArrayAsync(lonLatArr, stopPropagation = false) {\n        if (!this._planet) {\n            throw new Error(\"Planet is not defined\");\n        }\n        let ell = this._planet.ellipsoid;\n        for (let i = 0, len = lonLatArr.length - 1; i < len; i++) {\n            let p0 = ell.lonLatToCartesian(lonLatArr[i]), p1 = ell.lonLatToCartesian(lonLatArr[i + 1]);\n            if (p0.distance(p1) > 100000) {\n                throw new Error(\"Track is too long! 100 km is maximum.\");\n            }\n        }\n        let res = new Array(lonLatArr.length);\n        for (let i = 0, len = lonLatArr.length; i < len; i++) {\n            res[i] = this.addPointLonLatAsync(lonLatArr[i], true);\n        }\n        Promise.all(res).then(() => {\n            if (!stopPropagation) {\n                this.events.dispatch(this.events.change, this);\n            }\n        });\n        return res;\n    }\n    addPointLonLatAsync(lonLat, stopPropagation = false) {\n        let headPos = this._planet.ellipsoid.lonLatToCartesian(lonLat);\n        let n = this._planet.ellipsoid.getSurfaceNormal3v(headPos);\n        let ellLonLat = new LonLat(lonLat.lon, lonLat.lat);\n        let ellPos = this._planet.ellipsoid.lonLatToCartesian(ellLonLat);\n        let { headEntity, groundEntity, columnEntity, heightLabelEntity } = this._createGroundPointer(ellPos);\n        this._groundPointersLayer.add(groundEntity);\n        this._columnPointersLayer.add(columnEntity);\n        this._headPointersLayer.add(headEntity);\n        this._heightsLayer.add(heightLabelEntity);\n        this._trackEntity.polyline.appendPoint3v(headEntity.getCartesian());\n        groundEntity.properties.lonLatEll.lon = ellLonLat.lon;\n        groundEntity.properties.lonLatEll.lat = ellLonLat.lat;\n        groundEntity.properties.lonLatEll.height = ellLonLat.height;\n        return new Promise((resolve) => {\n            this.getHeightELLAsync(lonLat).then((hEll) => {\n                groundEntity.properties.lonLatEll.height = hEll;\n                let altitude = 10, groundPos;\n                if (lonLat.height === 0) {\n                    groundPos = headPos.add(n.scaleTo(hEll));\n                    headPos = groundPos.add(n.scaleTo(altitude));\n                }\n                else {\n                    altitude = lonLat.height - hEll;\n                    groundPos = headPos.sub(n.scaleTo(altitude));\n                }\n                groundEntity.setCartesian3v(groundPos);\n                heightLabelEntity.setCartesian3v(headPos);\n                heightLabelEntity.label.setText(`${hEll.toFixed(1)} m`);\n                heightLabelEntity.childrenNodes[0].label.setText(`${altitude.toFixed(1)} m`);\n                headEntity.properties.altitude = altitude;\n                headEntity.setCartesian3v(headPos);\n                headEntity.properties.columnEntity.ray.setStartPosition3v(groundPos);\n                headEntity.properties.columnEntity.ray.setEndPosition3v(headPos);\n                this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\n                if (!stopPropagation) {\n                    this.events.dispatch(this.events.addpoint, headEntity, this);\n                    this.events.dispatch(this.events.change, this);\n                }\n                resolve(headEntity);\n            });\n        });\n    }\n    addGroundPointLonLatAsync(lonLat, altitude = 10, stopPropagation = false) {\n        let groundPos = this._planet.ellipsoid.lonLatToCartesian(lonLat);\n        return this._addPoint(groundPos, lonLat, altitude, stopPropagation);\n    }\n    addGroundPoint3vAsync(groundPos, altitude = 10, stopPropagation = false) {\n        let lonLat = this._planet.ellipsoid.cartesianToLonLat(groundPos);\n        return this._addPoint(groundPos, lonLat, altitude, stopPropagation);\n    }\n    _addPoint(groundPos, lonLat, altitude, stopPropagation = false) {\n        return new Promise((resolve, reject) => {\n            let { headEntity, groundEntity, columnEntity, heightLabelEntity } = this._createGroundPointer(groundPos, altitude);\n            this._groundPointersLayer.add(groundEntity);\n            this._columnPointersLayer.add(columnEntity);\n            this._headPointersLayer.add(headEntity);\n            this._heightsLayer.add(heightLabelEntity);\n            this._trackEntity.polyline.appendPoint3v(headEntity.getCartesian());\n            groundEntity.properties.lonLatEll.lon = lonLat.lon;\n            groundEntity.properties.lonLatEll.lat = lonLat.lat;\n            groundEntity.properties.lonLatEll.height = lonLat.height;\n            this.getHeightELLAsync(lonLat).then((hEll) => {\n                groundEntity.properties.lonLatEll.height = lonLat.height = hEll;\n                let groundPos = this._planet.ellipsoid.lonLatToCartesian(lonLat);\n                let groundNormal = this._planet.ellipsoid.getSurfaceNormal3v(groundPos);\n                let headPos = groundPos.add(groundNormal.scale(altitude));\n                heightLabelEntity.setCartesian3v(headPos);\n                heightLabelEntity.label.setText(`${hEll.toFixed(1)} m`);\n                heightLabelEntity.childrenNodes[0].label.setText(`${altitude.toFixed(1)} m`);\n                headEntity.setCartesian3v(headPos);\n                headEntity.properties.columnEntity.ray.setEndPosition3v(headPos);\n                this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\n                if (!stopPropagation) {\n                    this.events.dispatch(this.events.addpoint, headEntity, this);\n                    this.events.dispatch(this.events.change, this);\n                }\n                resolve(headEntity);\n            });\n        });\n    }\n    setHeadPointCartesian3v(entityIndex, headPos) {\n        const headEntity = this._headPointersLayer.getEntities()[entityIndex];\n        if (headEntity) {\n            let groundPos = this._planet.ellipsoid.lonLatToCartesian(headEntity.properties.lonLatEll);\n            let altitude = headPos.length() - groundPos.length();\n            if (altitude <= 0) {\n                headPos = groundPos;\n                altitude = 0;\n            }\n            headEntity.properties.altitude = altitude;\n            headEntity.setCartesian3v(headPos);\n            headEntity.properties.columnEntity.ray.setEndPosition3v(headPos);\n            headEntity.properties.heightLabelEntity.setCartesian3v(headPos);\n            headEntity.properties.heightLabelEntity.childrenNodes[0].label.setText(`${altitude.toFixed(1)} m`);\n            this._trackEntity.polyline.setPoint3v(headPos, entityIndex);\n            this.events.dispatch(this.events.change, this._pickedHeadEntity);\n        }\n    }\n    setGroundPointCartesian3v(entityIndex, groundPos) {\n        let groundEntity = this._groundPointersLayer.getEntities()[entityIndex];\n        if (groundEntity) {\n            let lonLat = this._planet.ellipsoid.cartesianToLonLat(groundPos);\n            groundEntity.properties.lonLatEll.lon = lonLat.lon;\n            groundEntity.properties.lonLatEll.lat = lonLat.lat;\n            groundEntity.properties.lonLatEll.height = lonLat.height;\n            let groundNormal = this._planet.ellipsoid.getSurfaceNormal3v(groundPos);\n            let headEntity = groundEntity.properties.headEntity;\n            let heightLabelEntity = groundEntity.properties.heightLabelEntity;\n            let altitude = groundEntity.properties.altitude;\n            groundEntity.setCartesian3v(groundPos);\n            let headPos = groundPos.add(groundNormal.scale(altitude));\n            headEntity.setCartesian3v(headPos);\n            headEntity.properties.columnEntity.ray.setStartPosition3v(groundPos);\n            headEntity.properties.columnEntity.ray.setEndPosition3v(headPos);\n            this._trackEntity.polyline?.setPoint3v(headPos, headEntity.properties.index);\n            heightLabelEntity.setCartesian3v(headPos);\n            heightLabelEntity.label.setText(`${lonLat.height.toFixed(1)} m`);\n            heightLabelEntity.childrenNodes[0].label.setText(`${altitude.toFixed(1)} m`);\n            this.events.dispatch(this.events.change, groundEntity.properties.headEntity);\n        }\n    }\n    _deactivate() {\n        this.renderer.events.off(\"ldblclick\", this._onLClick);\n        this.renderer.events.off(\"mousemove\", this._onMouseMove);\n        this.renderer.events.off(\"lup\", this._onLUp);\n        this._groundPointersLayer.events.off(\"mouseenter\", this._onGroundPointerEnter);\n        this._groundPointersLayer.events.off(\"mouseleave\", this._onGroundPointerLeave);\n        this._groundPointersLayer.events.off(\"ldown\", this._onGroundPointerLDown);\n        this._groundPointersLayer.events.off(\"lup\", this._onGroundPointerLUp);\n        this._headPointersLayer.events.off(\"mouseenter\", this._onHeadPointerEnter);\n        this._headPointersLayer.events.off(\"mouseleave\", this._onHeadPointerLeave);\n        this._headPointersLayer.events.off(\"ldown\", this._onHeadPointerLDown);\n        this._headPointersLayer.events.off(\"lup\", this._onHeadPointerLUp);\n        this._trackLayer.remove();\n        this._groundPointersLayer.remove();\n        this._headPointersLayer.remove();\n        this._columnPointersLayer.remove();\n        this._trackLayer.remove();\n        this._heightsLayer.remove();\n        this._pointerLayer.remove();\n        this.clear();\n    }\n    setPointerVisibility(visibility) {\n        this._pointerLayer.setVisibility(visibility);\n    }\n    setVisibility(visibility) {\n        this._groundPointersLayer.setVisibility(visibility);\n        this._trackLayer.setVisibility(visibility);\n        this._columnPointersLayer.setVisibility(visibility);\n        this._headPointersLayer.setVisibility(visibility);\n        this._trackLayer.setVisibility(visibility);\n        this._heightsLayer.setVisibility(visibility);\n        this._pointerLayer.setVisibility(visibility);\n    }\n    clear() {\n        this._headPointersLayer.setEntities([]);\n        this._groundPointersLayer.setEntities([]);\n        this._columnPointersLayer.setEntities([]);\n        this._heightsLayer.setEntities([]);\n        this._trackEntity.polyline.setPath3v([]);\n    }\n    frame() {\n        if (this._clampToGround) {\n            let __tempVec__ = new Vec3();\n            const nodes = this._planet._renderedNodes;\n            const entities = this._groundPointersLayer.getEntities();\n            for (let i = 0; i < entities.length; i++) {\n                let ei = entities[i];\n                for (let j = 0; j < nodes.length; j++) {\n                    let nj = nodes[j];\n                    if (nj.segment.isEntityInside(ei)) {\n                        nj.segment.getEntityTerrainPoint(ei, __tempVec__);\n                        ei.setCartesian3v(__tempVec__);\n                        ei.properties.columnEntity.ray.setStartPosition3v(__tempVec__);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    get ellipsoid() {\n        return this._planet ? this._planet.ellipsoid : null;\n    }\n}\nconst ELEVATIONPROFILESCENE_EVENTS = [\n    \"change\", \"addpoint\"\n];\nexport { ElevationProfileScene };\n//# sourceMappingURL=ElevationProfileScene.js.map","import { View } from \"../../ui/View\";\nimport { Button } from \"../../ui/Button\";\nimport { ToggleButton } from \"../../ui/ToggleButton\";\nconst TEMPLATE = '<div class=\"og-elevationprofile-buttons\"></div>';\nconst RESET_SVG_ICON = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n<svg width=\"30\" height=\"30\" viewBox=\"0 0 30 30\" version=\"1.1\">\n  <g transform=\"translate(0,-289.0625)\">\n    <path d=\"M 15 6 C 10.041282 6 6 10.04128 6 15 C 6 19.95872 10.041282 24 15 24 C 16.586491 24 18.07668 23.58246 19.373047 22.857422 L 17.888672 21.375 C 17.00816 21.772814 16.032235 22 15 22 C 11.122162 22 8 18.87784 8 15 C 8 11.12216 11.122162 8 15 8 C 18.877838 8 22 11.12216 22 15 L 19 15 L 23 20 L 27 15 L 24 15 C 24 10.04128 19.958718 6 15 6 z \" transform=\"translate(0,289.0625)\" />\n  </g>\n</svg>`;\nconst LIST_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><svg width=\"800px\" height=\"800px\" viewBox=\"0 0 32 32\" id=\"icon\" xmlns=\"http://www.w3.org/2000/svg\"><defs><style>.cls-1{fill:none;}</style></defs><title>list</title><rect x=\"10\" y=\"6\" width=\"18\" height=\"2\"/><rect x=\"10\" y=\"24\" width=\"18\" height=\"2\"/><rect x=\"10\" y=\"15\" width=\"18\" height=\"2\"/><rect x=\"4\" y=\"15\" width=\"2\" height=\"2\"/><rect x=\"4\" y=\"6\" width=\"2\" height=\"2\"/><rect x=\"4\" y=\"24\" width=\"2\" height=\"2\"/></svg>`;\nconst LOCATION_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 256 256\" enable-background=\"new 0 0 256 256\" xml:space=\"preserve\">\n<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>\n<g><g><path fill=\"#000000\" d=\"M127,169.4c23.7,0,42.8-18.3,42.8-41s-19.2-41-42.8-41c-23.7,0-42.8,18.4-42.8,41S103.4,169.4,127,169.4z\"/><path fill=\"#000000\" d=\"M221.7,120.2c-3.8-44-40.9-78.9-87-82V15h-16.3v23.6c-44.8,4-80.3,38.5-84.1,81.7H10v15.6h24.3c3.8,43.1,39.3,77.4,84.1,81.7V241h16.3v-23.2c46-3.1,83.2-37.9,87-82H246v-15.6H221.7L221.7,120.2L221.7,120.2z M128,201.6c-42.5,0-76.7-33-76.7-73.4c0-40.4,34.5-73.4,76.7-73.4c42.5,0,76.7,33,76.7,73.4C204.7,168.5,170.5,201.6,128,201.6L128,201.6z\"/></g></g>\n</svg>`;\nconst ELEVATIONPROFILEBUTTONSVIEW_EVENTS = [\"reset\", \"list\", \"location\"];\nexport class ElevationProfileButtonsView extends View {\n    constructor(params = {}) {\n        super({\n            ...params,\n            template: TEMPLATE\n        });\n        //@ts-ignore\n        this.events = this.events.registerNames(ELEVATIONPROFILEBUTTONSVIEW_EVENTS);\n        this.pointListBtn = new ToggleButton({\n            classList: [\"og-elevationprofile-button\"],\n            icon: LIST_SVG_ICON,\n            title: \"Point List\"\n        });\n        this.pointListBtn.events.on(\"change\", (isActive) => {\n            this.events.dispatch(this.events.list, isActive);\n        });\n    }\n    render(params) {\n        super.render(params);\n        let resetBtn = new Button({\n            classList: [\"og-elevationprofile-button\"],\n            icon: RESET_SVG_ICON,\n            title: \"Reset\"\n        });\n        resetBtn.appendTo(this.el);\n        resetBtn.events.on(\"click\", () => {\n            this.model.clear();\n            this.events.dispatch(this.events.reset, this);\n        });\n        this.pointListBtn.appendTo(this.el);\n        let locationBtn = new Button({\n            classList: [\"og-elevationprofile-button\", \"og-elevationprofile-button__location\"],\n            icon: LOCATION_SVG_ICON,\n            title: \"View bounds\"\n        });\n        locationBtn.appendTo(this.el);\n        locationBtn.events.on(\"click\", () => {\n            this.events.dispatch(this.events.location, this);\n        });\n        return this;\n    }\n}\n//# sourceMappingURL=ElevationProfileButtonsView.js.map","import { Button } from \"../../ui/Button\";\nimport { View } from \"../../ui/View\";\nimport { Dialog } from \"../../ui/Dialog\";\nimport { LonLat } from \"../../LonLat\";\nconst LIST_TEMPLATE = `<div class=\"og-elevationprofile-list\">\n        <textarea placeholder=\"[[lon, lat, height], [lon, lat, height], ..., [lon, lat, height]]\"></textarea>\n        <div class=\"og-elevationprofile-list-buttons\"></div>\n    </div>`;\nclass PointListDialog extends Dialog {\n    constructor(params) {\n        super({\n            title: \"Points List\",\n            visible: false,\n            resizable: true,\n            useHide: true,\n            top: 150,\n            left: 200,\n            width: 400,\n            height: 300,\n            minHeight: 100,\n            minWidth: 100,\n            ...params\n        });\n        this._onApplyClick = () => {\n            try {\n                this.model.clear();\n                let coordsArr = JSON.parse(this.$textarea.value);\n                let lonLatArr = new Array(coordsArr.length);\n                for (let i = 0; i < coordsArr.length; i++) {\n                    let ci = coordsArr[i];\n                    lonLatArr[i] = new LonLat(ci[0], ci[1], ci[2]);\n                }\n                this.model.addPointLonLatArrayAsync(lonLatArr);\n            }\n            catch (err) {\n                console.error(err);\n            }\n        };\n        this.$textarea = null;\n    }\n    render(params) {\n        super.render(params);\n        let view = new View({\n            template: LIST_TEMPLATE\n        });\n        view.appendTo(this.container);\n        let applyBtn = new Button({\n            classList: [\"og-elevationprofile-list-apply\"],\n            icon: \"Apply\"\n        });\n        applyBtn.appendTo(view.select(\".og-elevationprofile-list-buttons\"));\n        applyBtn.events.on(\"click\", this._onApplyClick);\n        this.$textarea = view.select(\"textarea\");\n        return this;\n    }\n}\nexport { PointListDialog };\n//# sourceMappingURL=PointListDialog.js.map","import { View } from '../../ui/View';\nimport { distanceFormatExt } from \"../../utils/shared\";\nconst TEMPLATE = `<div class=\"og-elevationprofile-legend\">\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__track\">\n          <div class=\"og-elevationprofile-square\"></div>\n          <div class=\"og-elevationprofile-value\">0</div>\n          <div class=\"og-elevationprofile-units\">m</div>\n        </div>\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__ground\">\n          <div class=\"og-elevationprofile-square\"></div>\n          <div class=\"og-elevationprofile-value\">0</div>\n          <div class=\"og-elevationprofile-units\">m</div>\n        </div>\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__warning\">        \n          <div class=\"og-elevationprofile-square\"></div>\n          <div class=\"og-elevationprofile-value\">0</div>\n          <div class=\"og-elevationprofile-units\">m</div>\n        </div>\n        <div class=\"og-elevationprofile-legend__row og-elevationprofile-legend__collision\">\n          <div class=\"og-elevationprofile-square\"></div>\n          <div class=\"og-elevationprofile-value\">0</div>\n          <div class=\"og-elevationprofile-units\">m</div>\n        </div>\n      </div>`;\nexport class ElevationProfileLegend extends View {\n    constructor(params = {}) {\n        super({\n            ...params,\n            template: TEMPLATE\n        });\n        this.$groundValue = null;\n        this.$trackValue = null;\n        this.$warningValue = null;\n        this.$collisionValue = null;\n        this.$trackUnits = null;\n        this.$groundUnits = null;\n        this.$warningUnits = null;\n        this.$collisionUnits = null;\n    }\n    render(params) {\n        super.render(params);\n        this.$trackValue = this.select(\".og-elevationprofile-legend__track .og-elevationprofile-value\");\n        this.$groundValue = this.select(\".og-elevationprofile-legend__ground .og-elevationprofile-value\");\n        this.$warningValue = this.select(\".og-elevationprofile-legend__warning .og-elevationprofile-value\");\n        this.$collisionValue = this.select(\".og-elevationprofile-legend__collision .og-elevationprofile-value\");\n        this.$trackUnits = this.select(\".og-elevationprofile-legend__track .og-elevationprofile-units\");\n        this.$groundUnits = this.select(\".og-elevationprofile-legend__ground .og-elevationprofile-units\");\n        this.$warningUnits = this.select(\".og-elevationprofile-legend__warning .og-elevationprofile-units\");\n        this.$collisionUnits = this.select(\".og-elevationprofile-legend__collision .og-elevationprofile-units\");\n        return this;\n    }\n    clear() {\n        this.$trackValue && (this.$trackValue.innerText = \"0\");\n        this.$trackUnits && (this.$trackUnits.innerText = \"m\");\n        this.$groundValue && (this.$groundValue.innerText = \"0\");\n        this.$groundUnits && (this.$groundUnits.innerText = \"m\");\n        this.$warningValue && (this.$warningValue.innerText = \"0\");\n        this.$warningUnits && (this.$warningUnits.innerText = \"m\");\n        this.$collisionValue && (this.$collisionValue.innerText = \"0\");\n        this.$collisionUnits && (this.$collisionUnits.innerText = \"m\");\n    }\n    setTrackLength(trackLength) {\n        let dist = distanceFormatExt(trackLength);\n        this.$trackValue.innerText = dist[0];\n        this.$trackUnits.innerText = dist[1];\n    }\n    setGroundLength(groundLength) {\n        let dist = distanceFormatExt(groundLength);\n        this.$groundValue.innerText = dist[0];\n        this.$groundUnits.innerText = dist[1];\n    }\n    setWarningLength(warningLength) {\n        let warningDist = distanceFormatExt(warningLength);\n        this.$warningValue.innerText = warningDist[0];\n        this.$warningUnits.innerText = warningDist[1];\n    }\n    setCollisionLength(collisionLength) {\n        let collisionDist = distanceFormatExt(collisionLength);\n        this.$collisionValue.innerText = collisionDist[0];\n        this.$collisionUnits.innerText = collisionDist[1];\n    }\n}\n//# sourceMappingURL=ElevationProfileLegend.js.map","import { Control } from \"./Control\";\nimport { Dialog } from \"../ui/Dialog\";\nimport { ToggleButton } from \"../ui/ToggleButton\";\nimport { CanvasTiles } from \"../layer/CanvasTiles\";\nconst ICON_LOCK_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\n<svg fill=\"#000000\" width=\"800px\" height=\"800px\" viewBox=\"-7.5 0 32 32\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>lock</title>\n<path d=\"M14.625 15.156h2.094c0.281 0 0.5 0.25 0.5 0.531v11c0 0.281-0.219 0.5-0.5 0.5h-16.219c-0.281 0-0.5-0.219-0.5-0.5v-11c0-0.281 0.219-0.531 0.5-0.531h2.031v-5.125c0-2.875 1.844-5.25 4.688-5.25h2.688c2.875 0 4.719 2.375 4.719 5.25v5.125zM5.188 15.156h6.813v-4.875c0-1.594-1.313-2.938-2.938-2.938h-0.969c-1.594 0-2.906 1.344-2.906 2.938v4.875zM7.156 24h2.906l-0.719-3.156c0.5-0.25 0.844-0.781 0.844-1.375 0-0.906-0.719-1.594-1.594-1.594s-1.563 0.688-1.563 1.594c0 0.594 0.344 1.125 0.844 1.375z\"></path>\n</svg>`;\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg fill=\"#000000\" version=\"1.1\" id=\"Capa_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n\\t width=\"800px\" height=\"800px\" viewBox=\"0 0 932.179 932.179\"\n\\t xml:space=\"preserve\">\n<g>\n\\t<path d=\"M61.2,341.538c4.9,16.8,11.7,33,20.3,48.2l-24.5,30.9c-8,10.1-7.1,24.5,1.9,33.6l42.2,42.2c9.1,9.1,23.5,9.899,33.6,1.899\n\\t\\tl30.7-24.3c15.8,9.101,32.6,16.2,50.1,21.2l4.6,39.5c1.5,12.8,12.3,22.4,25.1,22.4h59.7c12.8,0,23.6-9.601,25.1-22.4l4.4-38.1\n\\t\\tc18.8-4.9,36.8-12.2,53.7-21.7l29.7,23.5c10.1,8,24.5,7.1,33.6-1.9l42.2-42.2c9.1-9.1,9.9-23.5,1.9-33.6l-23.1-29.3\n\\t\\tc9.6-16.601,17.1-34.3,22.1-52.8l35.6-4.1c12.801-1.5,22.4-12.3,22.4-25.1v-59.7c0-12.8-9.6-23.6-22.4-25.1l-35.1-4.1\n\\t\\tc-4.801-18.3-12-35.8-21.199-52.2l21.6-27.3c8-10.1,7.1-24.5-1.9-33.6l-42.1-42.1c-9.1-9.1-23.5-9.9-33.6-1.9l-26.5,21\n\\t\\tc-17.2-10.1-35.601-17.8-54.9-23l-4-34.3c-1.5-12.8-12.3-22.4-25.1-22.4h-59.7c-12.8,0-23.6,9.6-25.1,22.4l-4,34.3\n\\t\\tc-19.8,5.3-38.7,13.3-56.3,23.8l-27.5-21.8c-10.1-8-24.5-7.1-33.6,1.9l-42.2,42.2c-9.1,9.1-9.9,23.5-1.9,33.6l23,29.1\n\\t\\tc-9.2,16.6-16.2,34.3-20.8,52.7l-36.8,4.2c-12.8,1.5-22.4,12.3-22.4,25.1v59.7c0,12.8,9.6,23.6,22.4,25.1L61.2,341.538z\n\\t\\t M277.5,180.038c54.4,0,98.7,44.3,98.7,98.7s-44.3,98.7-98.7,98.7c-54.399,0-98.7-44.3-98.7-98.7S223.1,180.038,277.5,180.038z\"/>\n\\t<path d=\"M867.699,356.238l-31.5-26.6c-9.699-8.2-24-7.8-33.199,0.9l-17.4,16.3c-14.699-7.1-30.299-12.1-46.4-15l-4.898-24\n\\t\\tc-2.5-12.4-14-21-26.602-20l-41.1,3.5c-12.6,1.1-22.5,11.4-22.9,24.1l-0.799,24.4c-15.801,5.7-30.701,13.5-44.301,23.3\n\\t\\tl-20.799-13.8c-10.602-7-24.701-5-32.9,4.7l-26.6,31.7c-8.201,9.7-7.801,24,0.898,33.2l18.201,19.399\n\\t\\tc-6.301,14.2-10.801,29.101-13.4,44.4l-26,5.3c-12.4,2.5-21,14-20,26.601l3.5,41.1c1.1,12.6,11.4,22.5,24.1,22.9l28.1,0.899\n\\t\\tc5.102,13.4,11.801,26.101,19.9,38l-15.699,23.7c-7,10.6-5,24.7,4.699,32.9l31.5,26.6c9.701,8.2,24,7.8,33.201-0.9l20.6-19.3\n\\t\\tc13.5,6.3,27.699,11,42.299,13.8l5.701,28.2c2.5,12.4,14,21,26.6,20l41.1-3.5c12.6-1.1,22.5-11.399,22.9-24.1l0.9-27.601\n\\t\\tc15-5.3,29.199-12.5,42.299-21.399l22.701,15c10.6,7,24.699,5,32.9-4.7l26.6-31.5c8.199-9.7,7.799-24-0.9-33.2l-18.301-19.399\n\\t\\tc6.701-14.2,11.602-29.2,14.4-44.601l25-5.1c12.4-2.5,21-14,20-26.601l-3.5-41.1c-1.1-12.6-11.4-22.5-24.1-22.9l-25.1-0.8\n\\t\\tc-5.201-14.6-12.201-28.399-20.9-41.2l13.699-20.6C879.4,378.638,877.4,364.438,867.699,356.238z M712.801,593.837\n\\t\\tc-44.4,3.801-83.602-29.3-87.301-73.699c-3.801-44.4,29.301-83.601,73.699-87.301c44.4-3.8,83.602,29.301,87.301,73.7\n\\t\\tC790.301,550.938,757.199,590.138,712.801,593.837z\"/>\n\\t<path d=\"M205,704.438c-12.6,1.3-22.3,11.899-22.4,24.6l-0.3,25.3c-0.2,12.7,9.2,23.5,21.8,25.101l18.6,2.399\n\\t\\tc3.1,11.301,7.5,22.101,13.2,32.301l-12,14.8c-8,9.899-7.4,24.1,1.5,33.2l17.7,18.1c8.9,9.1,23.1,10.1,33.2,2.3l14.899-11.5\n\\t\\tc10.5,6.2,21.601,11.101,33.2,14.5l2,19.2c1.3,12.6,11.9,22.3,24.6,22.4l25.301,0.3c12.699,0.2,23.5-9.2,25.1-21.8l2.3-18.2\n\\t\\tc12.601-3.101,24.601-7.8,36-14l14,11.3c9.9,8,24.101,7.4,33.201-1.5l18.1-17.7c9.1-8.899,10.1-23.1,2.301-33.2L496.6,818.438\n\\t\\tc6.6-11,11.701-22.7,15.201-35l16.6-1.7c12.6-1.3,22.299-11.9,22.4-24.6l0.299-25.301c0.201-12.699-9.199-23.5-21.799-25.1\n\\t\\tl-16.201-2.1c-3.1-12.2-7.699-24-13.699-35l10.1-12.4c8-9.9,7.4-24.1-1.5-33.2l-17.699-18.1c-8.9-9.101-23.102-10.101-33.201-2.3\n\\t\\tl-12.101,9.3c-11.399-6.9-23.6-12.2-36.399-15.8l-1.601-15.7c-1.3-12.601-11.899-22.3-24.6-22.4l-25.3-0.3\n\\t\\tc-12.7-0.2-23.5,9.2-25.101,21.8l-2,15.601c-13.199,3.399-25.899,8.6-37.699,15.399l-12.5-10.2c-9.9-8-24.101-7.399-33.201,1.5\n\\t\\tl-18.2,17.801c-9.1,8.899-10.1,23.1-2.3,33.199l10.7,13.801c-6.2,11-11.1,22.699-14.3,35L205,704.438z M368.3,675.837\n\\t\\tc36.3,0.4,65.399,30.301,65,66.601c-0.4,36.3-30.301,65.399-66.601,65c-36.3-0.4-65.399-30.3-65-66.601\n\\t\\tC302.1,704.538,332,675.438,368.3,675.837z\"/>\n</g>\n</svg>`;\nconst ICON_CANVASTILES_SVG = `<?xml version=\"1.0\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\">\n    <path d=\"M 4 4 L 4 8 L 8 8 L 8 4 L 4 4 z M 10 4 L 10 8 L 14 8 L 14 4 L 10 4 z M 16 4 L 16 8 L 20 8 L 20 4 L 16 4 z M 4 10 L 4 14 L 8 14 L 8 10 L 4 10 z M 10 10 L 10 14 L 14 14 L 14 10 L 10 10 z M 16 10 L 16 14 L 20 14 L 20 10 L 16 10 z M 4 16 L 4 20 L 8 20 L 8 16 L 4 16 z M 10 16 L 10 20 L 14 20 L 14 16 L 10 16 z M 16 16 L 16 20 L 20 20 L 20 16 L 16 16 z\"/>\n</svg>`;\nexport class DebugInfo extends Control {\n    constructor(options = {}) {\n        if (!options.name || options.name === \"\") {\n            options.name = \"DebugInfo\";\n        }\n        super(options);\n        this.el = null;\n        this._watch = options.watch || [];\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-debuginfo_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        this._dialog = new Dialog({\n            title: \"Debug Info\",\n            visible: false,\n            useHide: true,\n            top: 120,\n            left: 60,\n            width: 480\n        });\n        this._dialog.events.on(\"visibility\", (v) => {\n            this._toggleBtn.setActive(v);\n        });\n        this._canvasTiles = new CanvasTiles(\"Tile grid\", {\n            visibility: true,\n            isBaseLayer: false,\n            hideInLayerSwitcher: true,\n            drawTile: function (material, applyCanvas) {\n                //\n                // This is important create canvas here!\n                //\n                let cnv = document.createElement(\"canvas\");\n                let ctx = cnv.getContext(\"2d\");\n                cnv.width = 256;\n                cnv.height = 256;\n                //Clear canvas\n                ctx.clearRect(0, 0, cnv.width, cnv.height);\n                //Draw border\n                ctx.beginPath();\n                ctx.rect(0, 0, cnv.width, cnv.height);\n                ctx.lineWidth = 2;\n                ctx.strokeStyle = 'black';\n                ctx.stroke();\n                let size;\n                if (material.segment.isPole) {\n                    let ext = material.segment.getExtentLonLat();\n                    ctx.fillStyle = 'black';\n                    ctx.font = 'normal ' + 29 + 'px Verdana';\n                    ctx.textAlign = 'center';\n                    ctx.fillText(`${ext.northEast.lon.toFixed(3)} ${ext.northEast.lat.toFixed(3)}`, cnv.width / 2, cnv.height / 2 + 20);\n                    ctx.fillText(`${ext.southWest.lon.toFixed(3)} ${ext.southWest.lat.toFixed(3)}`, cnv.width / 2, cnv.height / 2 - 20);\n                }\n                else {\n                    //Draw text\n                    if (material.segment.tileZoom > 14) {\n                        size = \"26\";\n                    }\n                    else {\n                        size = \"32\";\n                    }\n                    ctx.fillStyle = 'black';\n                    ctx.font = 'normal ' + size + 'px Verdana';\n                    ctx.textAlign = 'center';\n                    ctx.fillText(material.segment.tileX + \",\" + material.segment.tileY + \",\" + material.segment.tileZoom, cnv.width / 2, cnv.height / 2);\n                }\n                //Draw canvas tile\n                applyCanvas(cnv);\n            }\n        });\n    }\n    addWatches(watches) {\n        for (let i = 0; i < watches.length; i++) {\n            this.addWatch(watches[i]);\n        }\n    }\n    addWatch(watch) {\n        this._watch.push(watch);\n        let watchEl = document.createElement(\"div\");\n        watchEl.classList.add(\"og-watch-line\");\n        watchEl.innerHTML = `<div class=\"og-watch-label\">${watch.label}</div><div class=\"og-watch-value\"></div>`;\n        watch.valEl = watchEl.querySelector(\".og-watch-value\");\n        this.el.appendChild(watchEl);\n    }\n    oninit() {\n        this._toggleBtn.appendTo(this.renderer.div);\n        this._dialog.appendTo(this.renderer.div);\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            this._dialog.setVisibility(isActive);\n        });\n        this.el = document.createElement(\"div\");\n        this.el.className = \"og-debug-info\";\n        let $controls = document.createElement(\"div\");\n        $controls.classList.add(\"og-debuginfo_controls\");\n        this.el.appendChild($controls);\n        let temp = this._watch;\n        this._watch = [];\n        for (let i = 0; i < temp.length; i++) {\n            this.addWatch(temp[i]);\n        }\n        this._dialog.container?.appendChild(this.el);\n        this.renderer.events.on(\"draw\", this._frame, this);\n        let p = this.planet;\n        if (p) {\n            this.addWatches([\n                {\n                    label: \"Nodes count\",\n                    frame: () => p._renderedNodes.length\n                },\n                {\n                    label: \"Planet._fadingNodes\",\n                    frame: () => p._fadingNodes.size\n                },\n                {\n                    label: \"createdNodes\",\n                    frame: () => p._createdNodesCount\n                },\n                {\n                    label: \"indexesCache\",\n                    frame: () => p._indexesCacheToRemoveCounter\n                },\n                {\n                    label: \"distBeforeMemClear\",\n                    frame: () => Math.round(p._distBeforeMemClear)\n                },\n                {\n                    label: \"maxZoom/minZoom\",\n                    frame: () => p.maxCurrZoom + \" / \" + p?.minCurrZoom\n                },\n                {\n                    label: \"viewExtent\",\n                    frame: () => p.getViewExtent().toString()\n                },\n                {\n                    label: \"height/alt (km)\",\n                    frame: () => `<div style=\"width:190px\">${(p.camera._lonLat.height / 1000.0).toFixed(2) +\n                        \" / \" +\n                        (p.camera.getAltitude() / 1000.0).toFixed(2)}</div>`\n                },\n                {\n                    label: \"cam.slope\",\n                    frame: () => p.camera.slope.toFixed(3)\n                },\n                {\n                    label: \"lodSize\",\n                    frame: () => Math.round(p.lodSize)\n                },\n                {\n                    label: \"deltaTime/FPS\",\n                    frame: () => `<div style=\"width:70px\"><div style=\"width:20px; float: left;\">\n                        ${Math.round(p.renderer.handler.deltaTime)}\n                        </div> <div style=\"float: left\">\n                        ${Math.round(1000.0 / p.renderer.handler.deltaTime)}\n                        </div></div>`\n                },\n                {\n                    label: \"-------------------------\"\n                },\n                {\n                    label: \"_renderCompleted / renderCompletedActivated\",\n                    frame: () => `${p._renderCompleted} / ${p._renderCompletedActivated}`\n                },\n                {\n                    label: \"_terrainCompleted / terrainCompletedActivated\",\n                    frame: () => `${p._terrainCompleted} / ${p._terrainCompletedActivated}`\n                },\n                {\n                    label: \"PlainWorker\",\n                    frame: () => p._plainSegmentWorker.pendingQueue.length\n                },\n                {\n                    label: \"TileLoader\",\n                    frame: () => `${p._tileLoader.loading} ${p._tileLoader.queue.length}`\n                },\n                {\n                    label: \"TerrainLoader\",\n                    frame: () => {\n                        if (p.terrain && !p.terrain.isEmpty) {\n                            return `${p.terrain.loader.loading}  ${p.terrain.loader.queue.length}`;\n                        }\n                        return \"\";\n                    }\n                },\n                {\n                    label: \"TerrainWorker\",\n                    frame: () => p._terrainWorker.pendingQueue.length\n                },\n                {\n                    label: \"NormalMapCreator\",\n                    frame: () => p._normalMapCreator.queueSize\n                },\n                {\n                    label: \"VectorTileCreator\",\n                    frame: () => p._vectorTileCreator.queueSize\n                }\n            ]);\n        }\n        let lockTreeBtn = new ToggleButton({\n            classList: [\"og-debuginfo_controls-button\"],\n            icon: ICON_LOCK_BUTTON_SVG,\n            title: \"Lock/Unlock quad tree\"\n        });\n        lockTreeBtn.appendTo($controls);\n        lockTreeBtn.events.on(\"change\", (isActive) => {\n            if (isActive) {\n                p.lockQuadTree();\n            }\n            else {\n                p.unlockQuadTree();\n            }\n        });\n        let canvasTilesBtn = new ToggleButton({\n            classList: [\"og-debuginfo_controls-button\"],\n            icon: ICON_CANVASTILES_SVG,\n            title: \"Show/Hide grid\"\n        });\n        canvasTilesBtn.appendTo($controls);\n        canvasTilesBtn.events.on(\"change\", (isActive) => {\n            if (isActive) {\n                this.planet.addLayer(this._canvasTiles);\n            }\n            else {\n                this._canvasTiles.remove();\n            }\n        });\n    }\n    _frame() {\n        for (let i = 0; i < this._watch.length; i++) {\n            let w = this._watch[i];\n            w.valEl.innerHTML = w.frame ? String(w.frame()) : \"\";\n        }\n    }\n}\n//# sourceMappingURL=DebugInfo.js.map","import { ButtonGroup } from \"../ui/ButtonGroup\";\nimport { Control } from \"./Control\";\nimport { DrawingControl } from \"./drawing/DrawingControl\";\nimport { ToggleButton } from \"../ui/ToggleButton\";\nconst ICON_POLYGON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Generator: Adobe Illustrator 24.1.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<svg version=\"1.1\" id=\"Layer_2\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\"\n\\t viewBox=\"0 0 1024 1024\" style=\"enable-background:new 0 0 1024 1024;\" xml:space=\"preserve\">\n<g>\n\\t<path d=\"M926.03,321.16c-16.02,0-31.11,3.94-44.48,10.79l-263.43-191.4c2.69-8.94,4.18-18.4,4.18-28.2\n\\t\\tc0-54.02-43.95-97.97-97.97-97.97c-54.03,0-97.98,43.95-97.98,97.97c0,9.81,1.49,19.27,4.18,28.21L155.75,340.18\n\\t\\tc-16.22-11.91-36.16-19.03-57.78-19.03C43.95,321.16,0,365.11,0,419.13c0,52.58,41.67,95.5,93.71,97.75l102.63,315.86\n\\t\\tc-24.28,17.85-40.13,46.52-40.13,78.9c0,54.02,43.95,97.98,97.98,97.98c37.54,0,70.18-21.25,86.62-52.34h367.26\n\\t\\tc16.44,31.08,49.08,52.34,86.63,52.34c54.03,0,97.98-43.95,97.98-97.98c0-32.46-15.94-61.21-40.33-79.05l104.11-320.4\n\\t\\tc39.15-12.84,67.54-49.68,67.54-93.07C1024,365.11,980.05,321.16,926.03,321.16z M828.05,911.65c0,8.5-3.3,16.19-8.55,22.09\n\\t\\tc-6.11,6.85-14.9,11.26-24.79,11.26c-13.65,0-25.37-8.26-30.52-20.02c-1.79-4.09-2.82-8.58-2.82-13.33\n\\t\\tc0-18.39,14.95-33.35,33.34-33.35c2.93,0,5.72,0.5,8.43,1.21c13.27,3.49,23.21,14.91,24.59,28.9\n\\t\\tC827.83,909.5,828.05,910.54,828.05,911.65z M790.48,813.89c-45.63,1.96-83.27,35.16-91.87,78.77H350.28\n\\t\\tc-8.62-43.69-46.38-76.93-92.11-78.79L155.59,498.19c24.41-17.84,40.36-46.59,40.36-79.06c0-8.9-1.3-17.49-3.53-25.7L468.57,192.8\n\\t\\tc15.84,11.01,35.05,17.52,55.76,17.52c20.71,0,39.92-6.5,55.76-17.52l256.56,186.4c-5.48,12.21-8.59,25.7-8.59,39.93\n\\t\\tc0,41.02,25.36,76.17,61.21,90.75L790.48,813.89z M254.19,945c-10.11,0-19.07-4.62-25.19-11.75c-5.01-5.84-8.15-13.32-8.15-21.6\n\\t\\tc0-0.91,0.2-1.76,0.27-2.66c1.14-14.18,11.08-25.8,24.43-29.41c2.78-0.75,5.64-1.28,8.65-1.28c18.38,0,33.33,14.96,33.33,33.35\n\\t\\tc0,4.74-1.03,9.24-2.82,13.33C279.55,936.74,267.83,945,254.19,945z M64.88,421.49c-0.06-0.79-0.24-1.55-0.24-2.35\n\\t\\tc0-16.41,11.93-30.01,27.55-32.76c1.89-0.33,3.8-0.58,5.78-0.58c11.94,0,22.35,6.36,28.24,15.81c3.18,5.11,5.11,11.09,5.11,17.53\n\\t\\tc0,15.47-10.63,28.39-24.94,32.14c-2.7,0.71-5.48,1.2-8.4,1.2C80.4,452.47,66.11,438.76,64.88,421.49z M549.41,90.62\n\\t\\tc5.07,5.85,8.25,13.39,8.25,21.72c0,7.32-2.44,14.03-6.45,19.54c-6.07,8.33-15.82,13.81-26.88,13.81\n\\t\\tc-11.07,0-20.83-5.48-26.89-13.81c-4.01-5.51-6.45-12.22-6.45-19.54c0-8.33,3.17-15.86,8.24-21.71\n\\t\\tc6.12-7.07,15.04-11.64,25.1-11.64C534.38,79,543.29,83.57,549.41,90.62z M959.36,419.13c0,11.94-6.36,22.35-15.82,28.24\n\\t\\tc-5.1,3.18-11.07,5.1-17.52,5.1c-6.08,0-11.71-1.76-16.62-4.61c-9.71-5.64-16.33-15.94-16.64-27.89c-0.01-0.29-0.09-0.56-0.09-0.85\n\\t\\tc0-11.75,6.14-22.05,15.36-28c5.2-3.35,11.35-5.35,17.99-5.35C944.41,385.78,959.36,400.75,959.36,419.13z\"/>\n</g>\n</svg>`;\nconst ICON_LINESTRING_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- License: MIT. Made by Esri: https://github.com/Esri/calcite-ui-icons -->\n    <svg width=\"800px\" height=\"800px\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M21 6h.046l-5.25 9h-.944L10 9.455V7H7v2.926L1.862 18H0v3h3v-2.926L8.138 10h1.01L14 15.545V18h3v-3h-.046l5.25-9H24V3h-3zM8 8h1v1H8zM2 20H1v-1h1zm14-3h-1v-1h1zm7-13v1h-1V4z\"/></svg>`;\nconst ICON_DEFAULT_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\"><path d=\"M4 0l16 12.279-6.951 1.17 4.325 8.817-3.596 1.734-4.35-8.879-5.428 4.702z\"/></svg>`;\n/**\n * Activate drawing control\n */\nexport class DrawingSwitcher extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"DrawingSwitcher\",\n            ...options\n        });\n        this.drawingControl = new DrawingControl();\n    }\n    oninit() {\n        this.planet.addControl(this.drawingControl);\n        this._createMenu();\n    }\n    onactivate() {\n        this.drawingControl.activate();\n    }\n    ondeactivate() {\n        this.drawingControl.deactivate();\n    }\n    _createMenu() {\n        let defaultBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-drawing-default_button\"],\n            icon: ICON_DEFAULT_SVG,\n            name: \"default\",\n            isActive: true\n        });\n        let polyBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-drawing-polygon_button\"],\n            icon: ICON_POLYGON_SVG,\n            name: \"polygon\"\n        });\n        let lineBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-drawing-linestring_button\"],\n            icon: ICON_LINESTRING_SVG,\n            name: \"linestring\"\n        });\n        let buttons = new ButtonGroup({\n            buttons: [\n                defaultBtn, polyBtn, lineBtn\n            ]\n        });\n        buttons.events.on(\"change\", (btn) => {\n            this.drawingControl.deactivate();\n            switch (btn.name) {\n                case \"polygon\":\n                    this.drawingControl.activatePolygonDrawing();\n                    break;\n                case \"linestring\":\n                    this.drawingControl.activateLineStringDrawing();\n                    break;\n            }\n        });\n        defaultBtn.appendTo(this.renderer.div);\n        polyBtn.appendTo(this.renderer.div);\n        lineBtn.appendTo(this.renderer.div);\n    }\n}\n//# sourceMappingURL=DrawingSwitcher.js.map","import { Control } from \"../Control\";\nimport { Dialog } from \"../../ui/Dialog\";\nimport { View } from \"../../ui/View\";\nimport { ToggleButton } from \"../../ui/ToggleButton\";\nimport { ElevationProfileView } from \"./ElevationProfileView\";\nimport { ElevationProfileScene } from \"./ElevationProfileScene\";\nimport { throttle } from \"../../utils/shared\";\nimport { ElevationProfileButtonsView } from \"./ElevationProfileButtonsView\";\nimport { PointListDialog } from \"./PointListDialog\";\nimport { ElevationProfileLegend } from \"./ElevationProfileLegend\";\nconst TEMPLATE = `<div class=\"og-elevationprofile__container\">\n      <div class=\"og-elevationprofile__menu\"></div>\n      <div class=\"og-elevationprofile__graph\"></div>\n    </div>`;\nconst ICON_BUTTON_SVG = `<svg style=\"width: 2em; height: 2em;\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M128 896v-158.293333l331.946667-191.573334 160.853333 93.866667L896 480V896H128M896 381.44l-275.2 159.146667-160.853333-92.586667L128 640v-94.293333l331.946667-191.573334 160.853333 93.866667L896 288v93.44z\" fill=\"\" /></svg>`;\nexport class ElevationProfileControl extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"ElevationProfileControl\",\n            ...options\n        });\n        this._onSceneChange = () => {\n            this._collectProfileThrottled();\n        };\n        this._onElevationProfilePointer = (pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex, elevation) => {\n            let lonLat0 = this._elevationProfileScene.getPointLonLat(trackPoiIndex);\n            let lonLat1 = this._elevationProfileScene.getPointLonLat(trackPoiIndex + 1);\n            let cart0 = this.planet.ellipsoid.lonLatToCartesian(lonLat0), cart1 = this.planet.ellipsoid.lonLatToCartesian(lonLat1);\n            let d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\n            let dir = cart1.sub(cart0);\n            this._elevationProfileScene.setPointerCartesian3v(cart0.add(dir.scale(d)), elevation);\n        };\n        this._onElevationProfileDblClick = (pointerDistance, tp0, tp1, gp0, gp1, trackPoiIndex, groundPoiIndex, elevation) => {\n            let lonLat0 = this._elevationProfileScene.getPointLonLat(trackPoiIndex);\n            let lonLat1 = this._elevationProfileScene.getPointLonLat(trackPoiIndex + 1);\n            let cart0 = this.planet.ellipsoid.lonLatToCartesian(lonLat0), cart1 = this.planet.ellipsoid.lonLatToCartesian(lonLat1);\n            let d = (pointerDistance - tp0[0]) / (tp1[0] - tp0[0]);\n            let dir = cart1.sub(cart0);\n            let poi = cart0.add(dir.scale(d));\n            this.planet.camera.flyDistance(poi, this.planet.camera.eye.distance(poi));\n        };\n        this._onElevationProfileMouseEnter = () => {\n            if (this._elevationProfileView.model.pointsReady) {\n                this._elevationProfileScene.setPointerVisibility(true);\n            }\n        };\n        this._onElevationProfileMouseLeave = () => {\n        };\n        this._elevationProfileScene = new ElevationProfileScene();\n        this._elevationProfileView = new ElevationProfileView();\n        this._elevationProfileLegend = new ElevationProfileLegend();\n        this._elevationProfileButtonsView = new ElevationProfileButtonsView({\n            model: this._elevationProfileView.model\n        });\n        this._elevationProfileView.events.on(\"pointer\", this._onElevationProfilePointer);\n        this._elevationProfileView.events.on(\"dblclick\", this._onElevationProfileDblClick);\n        this._elevationProfileView.events.on(\"mouseenter\", this._onElevationProfileMouseEnter);\n        this._elevationProfileView.events.on(\"mouseleave\", this._onElevationProfileMouseLeave);\n        this._dialog = new Dialog({\n            title: \"Elevation Profile\",\n            visible: false,\n            resizable: true,\n            useHide: true,\n            top: 175,\n            left: 65,\n            width: 400,\n            height: 200,\n            minHeight: 100,\n            minWidth: 100\n        });\n        this._graphView = new View({\n            template: TEMPLATE\n        });\n        this._poiListDialog = new PointListDialog({\n            model: this._elevationProfileScene\n        });\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-elevationprofile_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        this._collectProfileThrottled = throttle(() => {\n            let points = this._elevationProfileScene.getPointsLonLat();\n            this._elevationProfileView.model.collectProfile(points);\n        }, 250);\n    }\n    oninit() {\n        this._dialog.appendTo(this.planet.renderer.div);\n        this._graphView.appendTo(this._dialog.container);\n        this._toggleBtn.appendTo(this.renderer.div);\n        this._dialog.events.on(\"visibility\", (v) => {\n            this._toggleBtn.setActive(v);\n            if (v) {\n                this.activate();\n                this._elevationProfileView.resize();\n            }\n            else {\n                this.deactivate();\n            }\n        });\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            this._dialog.setVisibility(isActive);\n        });\n        this._elevationProfileView.appendTo(this._graphView.select(\".og-elevationprofile__graph\"));\n        this._elevationProfileView.model.bindPlanet(this.planet);\n        this._elevationProfileView.model.events.on(\"clear\", () => {\n            this._elevationProfileScene.clear();\n            this._elevationProfileLegend.clear();\n        });\n        this._elevationProfileView.model.events.on(\"startcollecting\", () => {\n            this._elevationProfileScene.setPointerVisibility(false);\n        });\n        this._elevationProfileView.events.on(\"tracklength\", (length) => {\n            this._elevationProfileLegend.setTrackLength(length);\n        });\n        this._elevationProfileView.events.on(\"groundlength\", (length) => {\n            this._elevationProfileLegend.setGroundLength(length);\n        });\n        this._elevationProfileView.events.on(\"warninglength\", (length) => {\n            this._elevationProfileLegend.setWarningLength(length);\n        });\n        this._elevationProfileView.events.on(\"collisionlength\", (length) => {\n            this._elevationProfileLegend.setCollisionLength(length);\n        });\n        this._poiListDialog.appendTo(this.planet.renderer.div);\n        this._poiListDialog.events.on(\"visibility\", (isVisible) => {\n            this._elevationProfileButtonsView.pointListBtn.setActive(isVisible, true);\n        });\n        this._elevationProfileLegend.appendTo(this._graphView.select(\".og-elevationprofile__menu\"));\n        this._elevationProfileButtonsView.appendTo(this._graphView.select(\".og-elevationprofile__menu\"));\n        this._elevationProfileButtonsView.events.on(\"list\", (isActive) => {\n            this._poiListDialog.setVisibility(isActive);\n        });\n        this._elevationProfileButtonsView.events.on(\"location\", (isActive) => {\n            this._elevationProfileScene.flyExtent();\n        });\n        this._elevationProfileButtonsView.events.on(\"reset\", (isActive) => {\n            this._elevationProfileScene.setPointerVisibility(false);\n        });\n        this._elevationProfileScene.events.on(\"change\", this._onSceneChange);\n    }\n    onactivate() {\n        this.renderer.controls.mouseNavigation.deactivateDoubleClickZoom();\n        this.planet && this._elevationProfileScene.bindPlanet(this.planet);\n        this.renderer && this.renderer.addNode(this._elevationProfileScene);\n    }\n    ondeactivate() {\n        this._poiListDialog.setVisibility(false);\n        this._elevationProfileView.model.clear();\n        this.renderer.controls.mouseNavigation.activateDoubleClickZoom();\n        this.renderer && this.renderer.removeNode(this._elevationProfileScene);\n        this._dialog.hide();\n    }\n}\n//# sourceMappingURL=ElevationProfileControl.js.map","import { BaseGeoImage } from '../layer/BaseGeoImage';\nimport { Control } from './Control';\nimport { ToggleButton } from \"../ui/ToggleButton\";\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?> <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" width=\"24\" height=\"24\"><path d=\"M16 13l6.964 4.062-2.973.85 2.125 3.681-1.732 1-2.125-3.68-2.223 2.15L16 13zm-2-7h2v2h5a1 1 0 0 1 1 1v4h-2v-3H10v10h4v2H9a1 1 0 0 1-1-1v-5H6v-2h2V9a1 1 0 0 1 1-1h5V6zM4 14v2H2v-2h2zm0-4v2H2v-2h2zm0-4v2H2V6h2zm0-4v2H2V2h2zm4 0v2H6V2h2zm4 0v2h-2V2h2zm4 0v2h-2V2h2z\" fill=\"#000\"/></svg>`;\nexport class GeoImageDragControl extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._cornerIndex = -1;\n        this._catchCorner = false;\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-geoimagegrag_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n    }\n    oninit() {\n        this._toggleBtn.appendTo(this.renderer.div);\n        this.planet.events.on('layeradd', (e) => {\n            if (this.isActive()) {\n                this._bindLayer(e);\n            }\n        }, this);\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            if (isActive) {\n                this.activate();\n            }\n            else {\n                this.deactivate();\n            }\n        });\n    }\n    onactivate() {\n        super.onactivate();\n        const p = this.planet;\n        for (let i = 0; i < p.layers.length; i++) {\n            this._bindLayer(p.layers[i]);\n        }\n    }\n    ondeactivate() {\n        super.ondeactivate();\n        const p = this.planet;\n        for (let i = 0; i < p.layers.length; i++) {\n            this._unbindLayer(p.layers[i]);\n        }\n    }\n    _bindLayer(layer) {\n        if (layer instanceof BaseGeoImage) {\n            layer.events.on('mousemove', this._onMouseMove, this);\n            layer.events.on(\"mouseleave\", this._onMouseLeave, this);\n            layer.events.on('ldown', this._onLDown, this);\n            layer.events.on('lup', this._onLUp, this);\n        }\n    }\n    _unbindLayer(layer) {\n        if (layer instanceof BaseGeoImage) {\n            layer.events.off('mousemove', this._onMouseMove);\n            layer.events.off(\"mouseleave\", this._onMouseLeave);\n            layer.events.off('ldown', this._onLDown);\n            layer.events.off('lup', this._onLUp);\n        }\n    }\n    _onLUp(ms) {\n        this._catchCorner = false;\n        ms.renderer.controls.mouseNavigation.activate();\n    }\n    _onLDown(ms) {\n        if (this._cornerIndex !== -1) {\n            this._catchCorner = true;\n            ms.renderer.controls.mouseNavigation.deactivate();\n        }\n    }\n    _onMouseLeave() {\n        document.body.style.cursor = 'auto';\n    }\n    _onMouseMove(ms) {\n        let layer = ms.pickingObject;\n        const p = this.planet;\n        if (this._catchCorner) { // mouse is catching a corner\n            let corners = layer.getCornersLonLat();\n            // corners[this._cornerIndex] = p.getLonLatFromPixelTerrain(ms, true);\n            corners[this._cornerIndex] = p.getLonLatFromPixelTerrain(ms);\n            layer.setCornersLonLat(corners);\n        }\n        else { // mouse isn't catching\n            this._cornerIndex = -1;\n            for (let i = 0; i < layer._cornersWgs84.length; i++) {\n                // let ground = p.getLonLatFromPixelTerrain(ms, true);\n                let ground = p.getLonLatFromPixelTerrain(ms);\n                // mouse is near\n                //if (ground && p.ellipsoid.getGreatCircleDistance(layer._cornersWgs84[i], ground) / p.getDistanceFromPixel(ms, true) <= 0.05) {\n                if (ground && p.ellipsoid.getGreatCircleDistance(layer._cornersWgs84[i], ground) / p.getDistanceFromPixel(ms) <= 0.05) {\n                    this._cornerIndex = i;\n                    document.body.style.cursor = 'move';\n                    break;\n                    // mouse is far\n                }\n                else {\n                    document.body.style.cursor = 'auto';\n                }\n            }\n        }\n    }\n}\n//# sourceMappingURL=GeoImageDragControl.js.map","import * as math from \"../math\";\nimport { Control } from \"./Control\";\nimport { input } from \"../input/input\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Planet camera keyboard navigation. Use W,S,A,D and left shift key for fly around a planet.\n */\nexport class KeyboardNavigation extends Control {\n    constructor(options = {}) {\n        options = options || {};\n        super({ name: \"KeyboardNavigation\", ...options });\n        this.step = options.step || 250;\n    }\n    onactivate() {\n        let r = this.renderer;\n        r.events.on(\"keypress\", input.KEY_PGUP, this.onCameraMoveForward, this);\n        r.events.on(\"keypress\", input.KEY_PGDN, this.onCameraMoveBackward, this);\n        r.events.on(\"keypress\", input.KEY_PLUS, this.onCameraMoveForward, this);\n        r.events.on(\"keypress\", input.KEY_EQUALS, this.onCameraMoveForward, this);\n        r.events.on(\"keypress\", input.KEY_MINUS, this.onCameraMoveBackward, this);\n        r.events.on(\"keypress\", input.KEY_W, this.onCameraMoveForward, this);\n        r.events.on(\"keypress\", input.KEY_S, this.onCameraMoveBackward, this);\n        r.events.on(\"keypress\", input.KEY_A, this.onCameraStrifeLeft, this);\n        r.events.on(\"keypress\", input.KEY_D, this.onCameraStrifeRight, this);\n        r.events.on(\"keypress\", input.KEY_UP, this.onCameraLookUp, this);\n        r.events.on(\"keypress\", input.KEY_DOWN, this.onCameraLookDown, this);\n        r.events.on(\"keypress\", input.KEY_LEFT, this.onCameraLookLeft, this);\n        r.events.on(\"keypress\", input.KEY_RIGHT, this.onCameraLookRight, this);\n        r.events.on(\"keypress\", input.KEY_Q, this.onCameraRollLeft, this);\n        r.events.on(\"keypress\", input.KEY_E, this.onCameraRollRight, this);\n        r.events.on(\"keypress\", input.KEY_N, this.onCameraRollNorth, this);\n    }\n    ondeactivate() {\n        let r = this.renderer;\n        r.events.off(\"keypress\", input.KEY_PGUP, this.onCameraMoveForward);\n        r.events.off(\"keypress\", input.KEY_PGDN, this.onCameraMoveBackward);\n        r.events.off(\"keypress\", input.KEY_PLUS, this.onCameraMoveForward);\n        r.events.off(\"keypress\", input.KEY_EQUALS, this.onCameraMoveForward);\n        r.events.off(\"keypress\", input.KEY_MINUS, this.onCameraMoveBackward);\n        r.events.off(\"keypress\", input.KEY_W, this.onCameraMoveForward);\n        r.events.off(\"keypress\", input.KEY_S, this.onCameraMoveBackward);\n        r.events.off(\"keypress\", input.KEY_A, this.onCameraStrifeLeft);\n        r.events.off(\"keypress\", input.KEY_D, this.onCameraStrifeRight);\n        r.events.off(\"keypress\", input.KEY_UP, this.onCameraLookUp);\n        r.events.off(\"keypress\", input.KEY_DOWN, this.onCameraLookDown);\n        r.events.off(\"keypress\", input.KEY_LEFT, this.onCameraLookLeft);\n        r.events.off(\"keypress\", input.KEY_RIGHT, this.onCameraLookRight);\n        r.events.off(\"keypress\", input.KEY_Q, this.onCameraRollLeft);\n        r.events.off(\"keypress\", input.KEY_E, this.onCameraRollRight);\n        r.events.off(\"keypress\", input.KEY_N, this.onCameraRollNorth);\n    }\n    oninit() {\n        this.activate();\n    }\n    onCameraMoveForward() {\n        let cam = this.planet.camera;\n        cam.slide(0, 0, -cam._lonLat.height / this.step);\n    }\n    onCameraMoveBackward() {\n        let cam = this.planet.camera;\n        cam.slide(0, 0, cam._lonLat.height / this.step);\n    }\n    onCameraStrifeLeft() {\n        let cam = this.planet.camera;\n        cam.slide(-cam._lonLat.height / this.step, 0, 0);\n    }\n    onCameraStrifeRight() {\n        let cam = this.planet.camera;\n        cam.slide(cam._lonLat.height / this.step, 0, 0);\n    }\n    onCameraLookUp() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.pitch(15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateVertical((cam._lonLat.height / 3000000) * math.RADIANS, Vec3.ZERO);\n        }\n    }\n    onCameraLookDown() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.pitch(-15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateVertical((-cam._lonLat.height / 3000000) * math.RADIANS, Vec3.ZERO);\n        }\n    }\n    onCameraLookLeft() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.roll(15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateHorizontal((cam._lonLat.height / 3000000) * math.RADIANS);\n        }\n    }\n    onCameraLookRight() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.roll(-15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateHorizontal((-cam._lonLat.height / 3000000) * math.RADIANS);\n        }\n    }\n    onCameraTurnLeft() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.yaw(15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateHorizontal((cam._lonLat.height / 3000000) * math.RADIANS);\n        }\n    }\n    onCameraTurnRight() {\n        let cam = this.planet.camera;\n        if (this.renderer.events.isKeyPressed(input.KEY_SHIFT)) {\n            cam.yaw(-15 / this.renderer.handler.deltaTime);\n        }\n        else {\n            cam.rotateHorizontal((-cam._lonLat.height / 3000000) * math.RADIANS, false, Vec3.ZERO);\n        }\n    }\n    // from CompassButton._onClick()\n    onCameraRollNorth() {\n        let c = this.planet.getCartesianFromPixelTerrain(this.renderer.handler.getCenter());\n        if (c) {\n            this.planet.flyCartesian(c.normal().scaleTo(c.length() + c.distance(this.planet.camera.eye)), null, null, 0, null, null, () => {\n                this.planet.camera.look;\n            });\n        }\n        else {\n            this.planet.flyCartesian(this.planet.camera.eye);\n        }\n    }\n    onCameraRollLeft() {\n        this.planet.camera.roll(-15 / this.renderer.handler.deltaTime);\n    }\n    onCameraRollRight() {\n        this.planet.camera.roll(15 / this.renderer.handler.deltaTime);\n    }\n}\n//# sourceMappingURL=KeyboardNavigation.js.map","import { Control } from \"./Control\";\nimport { Dialog } from '../ui/Dialog';\nimport { Slider } from \"../ui/Slider\";\nimport { ToggleButton } from \"../ui/ToggleButton\";\nimport { View } from '../ui/View';\nconst SUN_STOP_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><svg version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" x=\"0px\" y=\"0px\" viewBox=\"0 0 122.88 70.41\" style=\"enable-background:new 0 0 122.88 70.41\" xml:space=\"preserve\"><g><path d=\"M60.91,19.12c6.95,0,13.24,2.95,17.8,7.72c4.55,4.77,7.37,11.37,7.37,18.64c0,1.94-0.2,3.83-0.58,5.65h31.61 c2.1,0,2.62,1.16,2.62,2.59c0,1.43-0.52,2.59-2.62,2.59H7.09c-2.1,0-2.62-1.16-2.62-2.59c0-1.43,0.52-2.59,2.62-2.59h29.23 c-0.38-1.82-0.58-3.71-0.58-5.65c0-7.28,2.82-13.87,7.37-18.64C47.67,22.08,53.96,19.12,60.91,19.12L60.91,19.12L60.91,19.12z M63.4,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h56.86c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59H63.4 L63.4,70.41z M2.62,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h29.51c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59 H2.62L2.62,70.41z M38.39,9.46c-0.78-1.35-0.32-3.07,1.03-3.85c1.35-0.78,3.07-0.32,3.85,1.03l3.62,6.27 c0.78,1.35,0.32,3.07-1.03,3.85c-1.35,0.78-3.07,0.32-3.85-1.03L38.39,9.46L38.39,9.46L38.39,9.46z M58.67,2.83 c0-1.56,1.27-2.83,2.83-2.83c1.56,0,2.83,1.27,2.83,2.83v7.24c0,1.56-1.27,2.83-2.83,2.83c-1.56,0-2.83-1.26-2.83-2.83V2.83 L58.67,2.83L58.67,2.83z M79.56,7.23c0.77-1.35,2.49-1.81,3.84-1.04c1.35,0.77,1.81,2.49,1.04,3.84l-3.62,6.27 c-0.77,1.35-2.49,1.81-3.84,1.04c-1.35-0.77-1.81-2.49-1.04-3.84L79.56,7.23L79.56,7.23L79.56,7.23z M95.45,21.48 c1.35-0.78,3.07-0.32,3.85,1.03c0.78,1.35,0.32,3.07-1.03,3.85L92,29.98c-1.35,0.78-3.07,0.32-3.85-1.03 c-0.78-1.35-0.32-3.07,1.03-3.85L95.45,21.48L95.45,21.48L95.45,21.48z M102.08,41.76c1.56,0,2.83,1.27,2.83,2.83 c0,1.56-1.27,2.83-2.83,2.83h-7.24c-1.56,0-2.83-1.26-2.83-2.83s1.26-2.83,2.83-2.83H102.08L102.08,41.76L102.08,41.76z M19.74,46.25c-1.56,0-2.83-1.27-2.83-2.83c0-1.56,1.27-2.83,2.83-2.83h7.24c1.56,0,2.83,1.26,2.83,2.83s-1.27,2.83-2.83,2.83 H19.74L19.74,46.25L19.74,46.25z M24.14,25.35c-1.35-0.77-1.81-2.49-1.04-3.84c0.77-1.35,2.49-1.81,3.84-1.04l6.27,3.62 c1.35,0.77,1.81,2.49,1.04,3.84c-0.77,1.35-2.49,1.81-3.84,1.04L24.14,25.35L24.14,25.35L24.14,25.35z\"/></g></svg>`;\nconst SUN_ACTIVE_SVG_ICON = `<?xml version=\"1.0\"?>\n<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\">\n    <path style=\"text-indent:0;text-align:start;line-height:normal;text-transform:none;block-progression:tb;-inkscape-font-specification:Sans\" d=\"M 16 4 C 9.3844277 4 4 9.3844277 4 16 C 4 22.615572 9.3844277 28 16 28 C 22.615572 28 28 22.615572 28 16 C 28 9.3844277 22.615572 4 16 4 z M 16 6 C 16.389823 6 16.778223 6.0506339 17.15625 6.09375 C 18.631659 7.6568432 21 10.9245 21 16 C 21 21.0755 18.631659 24.343157 17.15625 25.90625 C 16.778223 25.949366 16.389823 26 16 26 C 10.465308 26 6 21.534692 6 16 C 6 10.465308 10.465308 6 16 6 z\" overflow=\"visible\" font-family=\"Sans\"/>\n</svg>\n`;\nconst LIGHTING_ENABLED_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!-- Generated by IcoMoon.io -->\n<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\">\n<g>\n</g>\n\\t<path d=\"M257.894 156.948c-53.258 0-96.42 43.561-96.42 97.26 0 53.719 43.161 97.249 96.42 97.249 53.197 0 96.379-43.53 96.379-97.25 0-53.698-43.182-97.26-96.379-97.26zM257.894 309.873c-30.464 0-55.163-24.945-55.163-55.665s24.699-55.624 55.163-55.624c30.423 0 55.101 24.904 55.101 55.624s-24.688 55.665-55.101 55.665z\" fill=\"#000000\" />\n\\t<path d=\"M241.808 43.499h32.144v79.575h-32.144v-79.575z\" fill=\"#000000\" />\n\\t<path d=\"M417.209 115.897l-22.723-22.917-55.757 56.279 22.723 22.907z\" fill=\"#000000\" />\n\\t<path d=\"M389.468 238.407h78.899v32.389h-78.899v-32.389z\" fill=\"#000000\" />\n\\t<path d=\"M396.012 416.86l22.723-22.917-55.767-56.259-22.712 22.897z\" fill=\"#000000\" />\n\\t<path d=\"M242.473 388.915h32.144v79.575h-32.144v-79.575z\" fill=\"#000000\" />\n\\t<path d=\"M96.266 396.073l22.722 22.938 55.778-56.289-22.692-22.928z\" fill=\"#000000\" />\n\\t<path d=\"M43.633 240.537h78.879v32.43h-78.879v-32.43z\" fill=\"#000000\" />\n\\t<path d=\"M115.394 93.051l-22.681 22.907 55.757 56.258 22.702-22.917z\" fill=\"#000000\" />\n</svg>`;\nconst ATMOSPHERE_SVG_ICON = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\n<svg width=\"800px\" height=\"800px\" viewBox=\"0 0 512 512\" xmlns=\"http://www.w3.org/2000/svg\"><path fill=\"#000000\" d=\"M135.688 18.5c-6.798 74.842-23.842 85.39-107.907 59.656 84.85 52.022 73.57 64.954-6.843 96.938 87.743-10.27 103.29 4.89 70.75 87.594 17.805-27.56 32.5-44.498 46.282-54.47-11.813 28.26-18.345 59.274-18.345 91.813 0 84.184 43.71 157.96 109.656 200.376-41.624-43.834-67.686-102.7-67.686-167.875 0-134.923 109.45-244.405 244.375-244.405 30.92 0 60.76 5.762 88 16.25-38.584-26.87-85.517-42.625-136.064-42.625-55.257 0-106.14 18.802-146.562 50.375 4.627-18.783 17.39-38.073 41.03-60.906C190.18 90.942 153.53 95.634 135.69 18.5zm10.03 77.188c5.67.002 11.428 1.247 16.876 3.874 14.506 6.998 22.72 21.81 22 36.938-10.26 10.87-19.507 22.696-27.594 35.344-9.035 2.753-19.075 2.27-28.25-2.156-19.37-9.343-27.5-32.6-18.156-51.97 6.715-13.92 20.638-22.036 35.125-22.03z\"/></svg>`;\nconst TEMPLATE = `<div class=\"og-lighing\">\n\n         <div class=\"og-option\">\n           <div class=\"og-suncontrol\"></div>\n         </div>        \n         \n         <div class=\"og-option og-atmosphere-opacity\">\n         </div>\n         \n        <div class=\"og-lighting-emptyline\"></div>\n\n         <div class=\"og-option og-gamma\"></div>         \n         <div class=\"og-option og-exposure\"></div>\n       \n        <div class=\"og-lighting-emptyline\"></div>\n\n         <div class=\"og-option\">\n         <div class=\"og-layers\">\n           <div class=\"og-caption\">Select layer:</div>\n           <select id=\"layers\"></select>\n         </div>\n         </div>\n\n         <div class=\"og-option og-opacity\">\n         </div>\n         \n         <div class=\"og-option og-night\">\n         </div>\n         \n         <div class=\"og-lighting-emptyline\"></div>\n\n         <div class=\"og-option og-diffuse\">\n         </div>\n      \n         <div class=\"og-option og-ambient\">\n         </div>\n\n         <div class=\"og-option og-specular\">\n         </div>        \n\n    </div>`;\nconst ICON_BUTTON_SVG = `<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" version=\"1.1\" width=\"256\" height=\"256\" viewBox=\"0 0 256 256\" xml:space=\"preserve\">\n\n<defs>\n</defs>\n<g style=\"stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; opacity: 1;\" transform=\"translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)\" >\n\\t<path d=\"M 45 68 c -12.682 0 -23 -10.317 -23 -23 c 0 -12.682 10.318 -23 23 -23 c 12.683 0 23 10.318 23 23 C 68 57.683 57.683 68 45 68 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 45 17.556 c -1.657 0 -3 -1.343 -3 -3 V 3 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 v 11.556 C 48 16.212 46.657 17.556 45 17.556 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 45 90 c -1.657 0 -3 -1.343 -3 -3 V 75.444 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 V 87 C 48 88.657 46.657 90 45 90 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 14.556 48 H 3 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 h 11.556 c 1.657 0 3 1.343 3 3 C 17.556 46.657 16.212 48 14.556 48 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 87 48 H 75.444 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 H 87 c 1.657 0 3 1.343 3 3 C 90 46.657 88.657 48 87 48 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 66.527 26.473 c -0.768 0 -1.535 -0.293 -2.121 -0.878 c -1.172 -1.172 -1.172 -3.071 0 -4.243 l 8.171 -8.171 c 1.172 -1.172 3.07 -1.171 4.242 0 c 1.172 1.172 1.172 3.071 0 4.243 l -8.171 8.171 C 68.063 26.18 67.295 26.473 66.527 26.473 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 15.302 77.698 c -0.768 0 -1.536 -0.293 -2.121 -0.879 c -1.172 -1.171 -1.172 -3.071 0 -4.242 l 8.171 -8.171 c 1.171 -1.172 3.071 -1.172 4.242 0 c 1.172 1.171 1.172 3.071 0 4.242 l -8.171 8.171 C 16.837 77.405 16.069 77.698 15.302 77.698 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 23.473 26.473 c -0.768 0 -1.536 -0.293 -2.121 -0.878 l -8.171 -8.171 c -1.172 -1.172 -1.172 -3.071 0 -4.243 c 1.172 -1.172 3.072 -1.171 4.243 0 l 8.171 8.171 c 1.172 1.172 1.172 3.071 0 4.243 C 25.008 26.18 24.24 26.473 23.473 26.473 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n\\t<path d=\"M 74.698 77.698 c -0.768 0 -1.535 -0.293 -2.121 -0.879 l -8.171 -8.171 c -1.172 -1.171 -1.172 -3.071 0 -4.242 c 1.172 -1.172 3.07 -1.172 4.242 0 l 8.171 8.171 c 1.172 1.171 1.172 3.071 0 4.242 C 76.233 77.405 75.466 77.698 74.698 77.698 z\" style=\"stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;\" transform=\" matrix(1 0 0 1 0 0) \" stroke-linecap=\"round\" />\n</g>\n</svg>`;\nconst MAX_COLOR = 5;\n/**\n * Helps to set up lighting.\n */\nexport class Lighting extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._selectedLayer = null;\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-lighting_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        this._dialog = new Dialog({\n            title: \"Lighting Parameters\",\n            visible: false,\n            useHide: true,\n            top: 60,\n            left: 60,\n            width: 600\n        });\n        this._dialog.events.on(\"visibility\", (v) => {\n            this._toggleBtn.setActive(v);\n        });\n        this._panel = new View({\n            template: TEMPLATE\n        });\n        this.$gamma = null;\n        this.$exposure = null;\n        this.$night = null;\n        this.$opacity = null;\n        this.$diffuse = null;\n        this.$ambient = null;\n        this.$specular = null;\n        this.$atmosphereOpacity = null;\n        this._atmosphereMaxOpacity = new Slider({\n            label: \"Max.opacity\",\n            max: 5\n        });\n        this._atmosphereMinOpacity = new Slider({\n            label: \"Min.opacity\",\n            max: 5\n        });\n        this._gamma = new Slider({\n            label: \"Gamma\",\n            max: 5\n        });\n        this._exposure = new Slider({\n            label: \"Exposure\",\n            max: 5\n        });\n        this._night = new Slider({\n            label: \"Nightlight\",\n            max: 5\n        });\n        this._opacity = new Slider({\n            label: \"Opacity\",\n            max: 1\n        });\n        //\n        // Diffuse sliders\n        //\n        this._diffuse_r = new Slider({\n            label: \"Diffuse R\",\n            max: MAX_COLOR\n        });\n        this._diffuse_g = new Slider({\n            label: \"Diffuse G\",\n            max: MAX_COLOR\n        });\n        this._diffuse_b = new Slider({\n            label: \"Diffuse B\",\n            max: MAX_COLOR\n        });\n        //\n        // Ambient sliders\n        //\n        this._ambient_r = new Slider({\n            label: \"Ambient R\",\n            max: MAX_COLOR\n        });\n        this._ambient_g = new Slider({\n            label: \"Ambient G\",\n            max: MAX_COLOR\n        });\n        this._ambient_b = new Slider({\n            label: \"Ambient B\",\n            max: MAX_COLOR\n        });\n        //\n        // Specular sliders\n        //\n        this._specular_r = new Slider({\n            label: \"Specular R\",\n            max: 0.2\n        });\n        this._specular_g = new Slider({\n            label: \"Specular G\",\n            max: 0.2\n        });\n        this._specular_b = new Slider({\n            label: \"Specular B\",\n            max: 0.2\n        });\n        this._shininess = new Slider({\n            label: \"Shininess\",\n            max: 100\n        });\n    }\n    bindLayer(layer) {\n        this._selectedLayer = layer;\n        this._opacity.value = layer.opacity;\n        this._update();\n    }\n    oninit() {\n        this._toggleBtn.appendTo(this.renderer.div);\n        this._dialog.appendTo(this.renderer.div);\n        this._panel.appendTo(this._dialog.container);\n        if (this._panel.el) {\n            this.$atmosphereOpacity = this._panel.el.querySelector(\".og-atmosphere-opacity\");\n            this.$gamma = this._panel.el.querySelector(\".og-option.og-gamma\");\n            this.$exposure = this._panel.el.querySelector(\".og-option.og-exposure\");\n            this.$opacity = this._panel.el.querySelector(\".og-option.og-opacity\");\n            this.$diffuse = this._panel.el.querySelector(\".og-option.og-diffuse\");\n            this.$ambient = this._panel.el.querySelector(\".og-option.og-ambient\");\n            this.$specular = this._panel.el.querySelector(\".og-option.og-specular\");\n            this.$night = this._panel.el.querySelector(\".og-option.og-night\");\n        }\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            this._dialog.setVisibility(isActive);\n        });\n        let $suncontrol = this._dialog.select(\".og-suncontrol\");\n        let sunStopBtn = new ToggleButton({\n            classList: [\"og-suncontrol-button\"],\n            isActive: true,\n            icon: SUN_STOP_SVG_ICON,\n            title: \"Star/stop the Sun from following the camera\"\n        });\n        sunStopBtn.appendTo($suncontrol);\n        let sunActiveBtn = new ToggleButton({\n            classList: [\"og-suncontrol-button\"],\n            isActive: true,\n            icon: SUN_ACTIVE_SVG_ICON,\n            title: \"Activate/deactivate the Sun current time positioning\"\n        });\n        sunActiveBtn.appendTo($suncontrol);\n        sunStopBtn.events.on(\"change\", (isActive) => {\n            const sun = this.planet.renderer.controls.sun;\n            if (isActive) {\n                sun.start();\n            }\n            else {\n                sun.stop();\n            }\n        });\n        sunActiveBtn.events.on(\"change\", (isActive) => {\n            const sun = this.planet.renderer.controls.sun;\n            if (isActive) {\n                sun.activate();\n            }\n            else {\n                sun.deactivate();\n            }\n        });\n        let lightingEnabledBtn = new ToggleButton({\n            classList: [\"og-suncontrol-button\"],\n            isActive: this.planet.lightEnabled,\n            icon: LIGHTING_ENABLED_SVG_ICON,\n            title: \"Enable/disable planet lighting\"\n        });\n        lightingEnabledBtn.appendTo($suncontrol);\n        lightingEnabledBtn.events.on(\"change\", (isActive) => {\n            this.planet.lightEnabled = isActive;\n        });\n        let atmosphereEnabledBtn = new ToggleButton({\n            classList: [\"og-suncontrol-button\"],\n            isActive: this.planet.atmosphereEnabled,\n            icon: ATMOSPHERE_SVG_ICON,\n            title: \"Enable/disable atmosphere scattering\"\n        });\n        atmosphereEnabledBtn.appendTo($suncontrol);\n        if (this.planet.atmosphereEnabled) {\n            this.$atmosphereOpacity.style.display = \"block\";\n        }\n        else {\n            this.$atmosphereOpacity.style.display = \"none\";\n        }\n        atmosphereEnabledBtn.events.on(\"change\", (isActive) => {\n            this.planet.atmosphereEnabled = isActive;\n            if (this.planet.atmosphereEnabled) {\n                this.$atmosphereOpacity.style.display = \"block\";\n            }\n            else {\n                this.$atmosphereOpacity.style.display = \"none\";\n            }\n        });\n        this._atmosphereMaxOpacity.appendTo(this.$atmosphereOpacity);\n        this._atmosphereMinOpacity.appendTo(this.$atmosphereOpacity);\n        this._gamma.appendTo(this.$gamma);\n        this._exposure.appendTo(this.$exposure);\n        this._night.appendTo(this.$night);\n        this._opacity.appendTo(this.$opacity);\n        this._diffuse_r.appendTo(this.$diffuse);\n        this._diffuse_g.appendTo(this.$diffuse);\n        this._diffuse_b.appendTo(this.$diffuse);\n        this._ambient_r.appendTo(this.$ambient);\n        this._ambient_g.appendTo(this.$ambient);\n        this._ambient_b.appendTo(this.$ambient);\n        this._specular_r.appendTo(this.$specular);\n        this._specular_g.appendTo(this.$specular);\n        this._specular_b.appendTo(this.$specular);\n        this._shininess.appendTo(this.$specular);\n        this._atmosphereMinOpacity.value = this.planet.atmosphereMinOpacity;\n        this._atmosphereMinOpacity.events.on(\"change\", (val) => {\n            this.planet.atmosphereMinOpacity = val;\n        });\n        this._gamma.value = this.planet.renderer.gamma;\n        this._gamma.events.on(\"change\", (val) => {\n            this.planet.renderer.gamma = val;\n        });\n        this._panel.el.querySelector(\"#layers\").addEventListener(\"change\", (e) => {\n            const l = this.planet.getLayerByName(e.target.value);\n            if (l) {\n                this.bindLayer(l);\n            }\n        });\n        this._atmosphereMaxOpacity.value = this.planet.atmosphereMaxOpacity;\n        this._atmosphereMaxOpacity.events.on(\"change\", (val) => {\n            this.planet.atmosphereMaxOpacity = val;\n            let atmos = this.planet.renderer.controls.Atmosphere;\n            atmos.opacity = val;\n        });\n        this._exposure.value = this.planet.renderer.exposure;\n        this._exposure.events.on(\"change\", (val) => {\n            this.planet.renderer.exposure = val;\n        });\n        this._night.events.on(\"change\", (val) => {\n            if (this._selectedLayer) {\n                this._selectedLayer.nightTextureCoefficient = val;\n            }\n        });\n        this._opacity.events.on(\"change\", (val) => {\n            if (this._selectedLayer)\n                this._selectedLayer.opacity = val;\n        });\n        this._ambient_r.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._ambient)\n                this._selectedLayer._ambient[0] = val;\n        });\n        this._ambient_g.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._ambient)\n                this._selectedLayer._ambient[1] = val;\n        });\n        this._ambient_b.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._ambient)\n                this._selectedLayer._ambient[2] = val;\n        });\n        this._diffuse_r.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._diffuse)\n                this._selectedLayer._diffuse[0] = val;\n        });\n        this._diffuse_g.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._diffuse)\n                this._selectedLayer._diffuse[1] = val;\n        });\n        this._diffuse_b.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._diffuse)\n                this._selectedLayer._diffuse[2] = val;\n        });\n        this._specular_r.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._specular)\n                this._selectedLayer._specular[0] = val;\n        });\n        this._specular_g.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._specular)\n                this._selectedLayer._specular[1] = val;\n        });\n        this._specular_b.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._specular)\n                this._selectedLayer._specular[2] = val;\n        });\n        this._shininess.events.on(\"change\", (val) => {\n            if (this._selectedLayer && this._selectedLayer._specular)\n                this._selectedLayer._specular[3] = val;\n        });\n        if (this.planet) {\n            this.planet.events.on(\"layeradd\", this._onLayerAdd, this);\n            this.planet.events.on(\"layerremove\", this._onLayerRemove, this);\n        }\n        this._fetchLayers();\n    }\n    _update() {\n        let l = this._selectedLayer;\n        this._opacity.value = l && l.opacity ? l.opacity : 0.0;\n        this._night.value = l && l.nightTextureCoefficient ? l.nightTextureCoefficient : this.planet.nightTextureCoefficient;\n        let a = l && l._ambient ? l._ambient : this.planet._ambient;\n        this._ambient_r.value = a[0];\n        this._ambient_g.value = a[1];\n        this._ambient_b.value = a[2];\n        let d = l && l._diffuse ? l._diffuse : this.planet._diffuse;\n        this._diffuse_r.value = d[0];\n        this._diffuse_g.value = d[1];\n        this._diffuse_b.value = d[2];\n        let s = l && l._specular ? l._specular : this.planet._specular;\n        this._specular_r.value = s[0];\n        this._specular_g.value = s[1];\n        this._specular_b.value = s[2];\n        this._shininess.value = s[3];\n    }\n    _fetchLayers() {\n        if (this.planet) {\n            for (let i = 0; i < this.planet.layers.length; i++) {\n                this._onLayerAdd(this.planet.layers[i]);\n            }\n        }\n    }\n    _onLayerAdd(e) {\n        this.bindLayer(e);\n        let opt = document.createElement(\"option\");\n        opt.value = e.name;\n        opt.innerText = e.name;\n        this._panel.el.querySelector(\"#layers\").appendChild(opt);\n        this._panel.el.querySelector(\"#layers\").value = e.name;\n    }\n    _onLayerRemove(e) {\n    }\n}\n//# sourceMappingURL=Lighting.js.map","import { Sphere } from \"../bv/Sphere\";\nimport { Key } from \"../Lock\";\nimport { Quat } from \"../math/Quat\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { Control } from \"./Control\";\nimport { MouseNavigation } from \"./MouseNavigation\";\nexport class MouseWheelZoomControl extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._name = \"MouseWheelZoomControl\";\n        this.grabbedPoint = new Vec3();\n        this._eye0 = new Vec3();\n        this.pointOnEarth = new Vec3();\n        this.earthUp = new Vec3();\n        this.inertia = 0.007;\n        this.grabbedSpheroid = new Sphere();\n        this.planet = null;\n        this.qRot = new Quat();\n        this.scaleRot = 0.0;\n        this.distDiff = 0.3;\n        this.stepsCount = 8;\n        this.stepsForward = null;\n        this.stepIndex = 0;\n        this._lmbDoubleClickActive = true;\n        this.minSlope = options.minSlope || 0.1;\n        this._keyLock = new Key();\n        this._deactivate = false;\n        this._move = 0;\n    }\n    oninit() {\n        let zoomDiv = document.createElement(\"div\"), btnZoomIn = document.createElement(\"button\"), btnZoomOut = document.createElement(\"button\");\n        zoomDiv.className = \"ogZoomControl\";\n        btnZoomIn.className = \"ogZoomButton ogZoomIn\";\n        btnZoomOut.className = \"ogZoomButton ogZoomOut\";\n        zoomDiv.appendChild(btnZoomIn);\n        zoomDiv.appendChild(btnZoomOut);\n        this.renderer.div.appendChild(zoomDiv);\n        btnZoomIn.addEventListener(\"mousedown\", () => this.zoomIn());\n        btnZoomIn.addEventListener(\"mouseup\", () => this.stopZoom());\n        btnZoomOut.addEventListener(\"mousedown\", () => this.zoomOut());\n        btnZoomOut.addEventListener(\"mouseup\", () => this.stopZoom());\n        btnZoomIn.addEventListener(\"touchstart\", (e) => {\n            e.preventDefault();\n            this.zoomIn();\n        });\n        btnZoomIn.addEventListener(\"touchend\", (e) => {\n            e.preventDefault();\n            this.stopZoom();\n        });\n        btnZoomIn.addEventListener(\"touchcancel\", (e) => {\n            e.preventDefault();\n            this.stopZoom();\n        });\n        btnZoomOut.addEventListener(\"touchstart\", (e) => {\n            e.preventDefault();\n            this.zoomOut();\n        });\n        btnZoomOut.addEventListener(\"touchend\", (e) => {\n            e.preventDefault();\n            this.stopZoom();\n        });\n        btnZoomOut.addEventListener(\"touchcancel\", (e) => {\n            e.preventDefault();\n            this.stopZoom();\n        });\n        this.renderer.events.on(\"draw\", this._draw, this);\n    }\n    /**\n     * Planet zoom in.\n     * @public\n     */\n    zoomIn() {\n        if (this.stepIndex) {\n            return;\n        }\n        this.planet.stopFlying();\n        this.stopRotation();\n        this._deactivate = true;\n        this.planet.layerLock.lock(this._keyLock);\n        this.planet.terrainLock.lock(this._keyLock);\n        this.planet._normalMapCreator.lock(this._keyLock);\n        this.stepsForward = MouseNavigation.getMovePointsFromPixelTerrain(this.planet.camera, this.planet, this.stepsCount, this.distDiff, this.renderer.handler.getCenter(), true, null) || null;\n        if (this.stepsForward) {\n            this.stepIndex = this.stepsCount;\n        }\n    }\n    /**\n     * Planet zoom out.\n     * @public\n     */\n    zoomOut() {\n        if (this.stepIndex) {\n            return;\n        }\n        this.planet.stopFlying();\n        this.stopRotation();\n        this._deactivate = true;\n        this.planet.layerLock.lock(this._keyLock);\n        this.planet.terrainLock.lock(this._keyLock);\n        this.planet._normalMapCreator.lock(this._keyLock);\n        this.stepsForward = MouseNavigation.getMovePointsFromPixelTerrain(this.planet.camera, this.planet, this.stepsCount, this.distDiff, this.renderer.handler.getCenter(), false, null) || null;\n        if (this.stepsForward) {\n            this.stepIndex = this.stepsCount;\n        }\n    }\n    stopRotation() {\n        this.qRot.clear();\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet._normalMapCreator.free(this._keyLock);\n    }\n    stopZoom() {\n        this._move = 0;\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet._normalMapCreator.free(this._keyLock);\n    }\n    _draw() {\n        if (this._active) {\n            let r = this.renderer;\n            let cam = this.planet.camera;\n            let prevEye = cam.eye.clone();\n            if (this.stepIndex) {\n                r.controlsBag.scaleRot = 1.0;\n                let sf = this.stepsForward[this.stepsCount - this.stepIndex--];\n                let maxAlt = cam.maxAltitude + this.planet.ellipsoid.equatorialSize;\n                let minAlt = cam.minAltitude + this.planet.ellipsoid.equatorialSize;\n                const camAlt = sf.eye.length();\n                if (camAlt > maxAlt || camAlt < minAlt) {\n                    return;\n                }\n                cam.eye = sf.eye;\n                cam._u = sf.v;\n                cam._r = sf.u;\n                cam._b = sf.n;\n                cam.checkTerrainCollision();\n                cam.update();\n            }\n            else {\n                if (this._deactivate) {\n                    this._deactivate = false;\n                    this.planet.layerLock.free(this._keyLock);\n                    this.planet.terrainLock.free(this._keyLock);\n                    this.planet._normalMapCreator.free(this._keyLock);\n                }\n            }\n            if (r.events.mouseState.leftButtonDown || !this.scaleRot) {\n                return;\n            }\n            this.scaleRot -= this.inertia;\n            if (this.scaleRot <= 0.0) {\n                this.scaleRot = 0.0;\n            }\n            else {\n                r.controlsBag.scaleRot = this.scaleRot;\n                let rot = this.qRot\n                    .slerp(Quat.IDENTITY, 1.0 - this.scaleRot * this.scaleRot * this.scaleRot)\n                    .normalize();\n                if (!(rot.x || rot.y || rot.z)) {\n                    this.scaleRot = 0.0;\n                }\n                cam.eye = rot.mulVec3(cam.eye);\n                cam._u = rot.mulVec3(cam._u);\n                cam._r = rot.mulVec3(cam._r);\n                cam._b = rot.mulVec3(cam._b);\n                cam.checkTerrainCollision();\n                cam.update();\n            }\n            if (cam.eye.distance(prevEye) / cam.getAltitude() > 0.01) {\n                this.planet.layerLock.lock(this._keyLock);\n                this.planet.terrainLock.lock(this._keyLock);\n                this.planet._normalMapCreator.lock(this._keyLock);\n            }\n            else {\n                this.planet.layerLock.free(this._keyLock);\n                this.planet.terrainLock.free(this._keyLock);\n                this.planet._normalMapCreator.free(this._keyLock);\n            }\n        }\n    }\n}\n//# sourceMappingURL=MouseWheelZoomControl.js.map","import { Control } from \"./Control\";\nimport { ToggleButton } from \"../ui/ToggleButton\";\nimport { HeightRuler } from \"./heightRuler/HeightRuler\";\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"iso-8859-1\"?>\n<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\n<svg fill=\"#000000\" height=\"800px\" width=\"800px\" version=\"1.1\" id=\"Layer_1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" \n\\t viewBox=\"0 0 512 512\" xml:space=\"preserve\">\n<g>\n\\t<g>\n\\t\\t<path d=\"M369.151,0L0.001,369.15L142.85,512l369.149-369.15L369.151,0z M47.286,369.15l10.908-10.908l47.782,47.782l23.642-23.642\n\\t\\t\\tL81.837,334.6l10.909-10.909l23.711,23.711L140.1,323.76l-23.711-23.711l10.909-10.909l23.711,23.711l23.642-23.642\n\\t\\t\\tl-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782l10.908-10.908l23.71,23.71l23.642-23.642l-23.71-23.71\n\\t\\t\\tl10.908-10.908l23.711,23.711l23.642-23.642l-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782\n\\t\\t\\tl10.908-10.908l23.71,23.711l23.642-23.642l-23.711-23.71L334.6,81.837l23.711,23.71l23.642-23.642l-23.711-23.712l10.908-10.908\n\\t\\t\\tl95.564,95.564L142.85,464.714L47.286,369.15z\"/>\n\\t</g>\n</g>\n</svg>`;\n/**\n * Activate ruler\n */\nexport class RulerSwitcher extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"RulerSwitcher\",\n            ...options\n        });\n        this.ruler = new HeightRuler({\n            ignoreTerrain: options.ignoreTerrain\n        });\n    }\n    oninit() {\n        this.planet.addControl(this.ruler);\n        this._createMenuBtn();\n    }\n    onactivate() {\n        this.ruler.activate();\n    }\n    ondeactivate() {\n        this.ruler.deactivate();\n    }\n    _createMenuBtn() {\n        let btn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-ruler_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n        btn.appendTo(this.renderer.div);\n        btn.events.on(\"change\", (isActive) => {\n            if (isActive) {\n                this.onactivate();\n            }\n            else {\n                this.ondeactivate();\n            }\n        });\n    }\n}\n//# sourceMappingURL=RulerSwitcher.js.map","import { Control } from \"../Control\";\nimport { SelectionScene } from \"./SelectionScene\";\nimport { ToggleButton } from \"../../ui/ToggleButton\";\nconst ICON_BUTTON_SVG = `<?xml version=\"1.0\" encoding=\"utf-8\"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->\n<svg width=\"800px\" height=\"800px\" viewBox=\"0 0 100 100\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" aria-hidden=\"true\" role=\"img\" class=\"iconify iconify--gis\" preserveAspectRatio=\"xMidYMid meet\"><path d=\"M2.1 0v1.914H0v6h3V3h5.1V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h1.8v1.2h3V0h-4.8zm1.8 7.2v6h3v-6h-3zM0 10.913v6h3v-6H0zM66.9 16.2v6h3v-6h-3zM0 19.914v6h3v-6H0zM66.9 25.2v6h3v-6h-3zM0 28.914v6h3v-6H0zM66.9 34.2v6h3v-6h-3zM0 37.914v6h3v-6H0zM66.9 43.2v6h3v-6h-3zM0 46.914v6h3v-6H0zM66.9 52.2v6h3v-6h-3zM0 55.914v5.191h3.809v-3H3v-2.19H0zm6.809 2.191v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9.648 1.899a2.076 2.076 0 0 0-2.19 2.324l3.137 33.676c.2 1.635 2.135 2.399 3.397 1.34l6.623-5.371l2.969 5.142c1.707 2.958 4.417 3.684 7.375 1.977c2.957-1.708 3.684-4.417 1.976-7.375l-2.959-5.125l7.848-3.008c1.548-.564 1.855-2.62.539-3.611L71.576 60.416a2.073 2.073 0 0 0-1.119-.412z\" fill=\"#000000\"></path></svg>`;\n/**\n * Activate Selection\n * @param {boolean} [options.ignoreTerrain=false].\n * @param {function} options.onSelect - callback (extent) => {} where extent is selected extent array [minLon,minLat,maxLon,maxLat]\n * @param {boolean} [options.autoSelectionHide=false] - clear selection rectangle  after passing extent to callback\n * @example:\n * to use bootstrap icons, include\n *  <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css\">\n *\n * new Selection({\n *       ignoreTerrain: false,\n *       autoSelectionHide:true,\n *       onSelect: (extent) => {\n *\n *           var vectorSource = new ol.source.Vector({\n *               format: new GeoJSON(),\n *               url: function (extent) {\n *                   return 'https://snap.ogs.trieste.it/geoserver/snap/ows?service=WFS&' +\n *                           'version=1.1.0&request=GetFeature&typename=snap:all_dataset_segy_view&' +\n *                           'outputFormat=application/json&srsname=EPSG:4326&' +\n *                           'bbox=' + extent.join(',') + ',EPSG:4326';\n *               },\n *               strategy: function (extent, resolution) {\n *                   if (this.resolution && this.resolution != resolution) {\n *                       this.loadedExtentsRtree_.clear();\n *                   }\n *                   return [extent];\n *               }\n *           });\n *\n *           vectorSource.loadFeatures(extent);\n *\n *           console.log(extent);\n *\n *       }\n *   });\n */\nexport class Selection extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._selectorScene = new SelectionScene({\n            name: `selectionScene:${this.__id}`,\n            ignoreTerrain: options.ignoreTerrain,\n            onSelect: options.onSelect,\n            autoSelectionHide: options.autoSelectionHide\n        });\n        this._toggleBtn = new ToggleButton({\n            classList: [\"og-map-button\", \"og-selection_button\"],\n            icon: ICON_BUTTON_SVG\n        });\n    }\n    set ignoreTerrain(v) {\n        this._selectorScene.ignoreTerrain = v;\n    }\n    oninit() {\n        this._toggleBtn.appendTo(this.renderer.div);\n        this._toggleBtn.events.on(\"change\", (isActive) => {\n            if (isActive) {\n                this.activate();\n            }\n            else {\n                this.deactivate();\n            }\n        });\n        this._selectorScene.bindPlanet(this.planet);\n    }\n    onactivate() {\n        this.renderer.addNode(this._selectorScene);\n    }\n    ondeactivate() {\n        this.renderer.removeNode(this._selectorScene);\n    }\n}\n//# sourceMappingURL=Selection.js.map","import { print2d } from \"../utils/shared\";\nimport { Control } from \"./Control\";\n/**\n * Frame per second(FPS) display control.\n */\nexport class ShowFps extends Control {\n    constructor(options) {\n        super(options);\n    }\n    oninit() {\n        let d = document.createElement(\"div\");\n        d.className = \"defaultText \";\n        d.id = \"ogShowFpsControl\";\n        document.body.appendChild(d);\n        this.renderer.events.on(\"draw\", this._draw, this);\n    }\n    _draw() {\n        print2d(\"ogShowFpsControl\", (1000.0 / this.renderer.handler.deltaTime).toFixed(1), this.renderer.handler.canvas.clientWidth - 60, 0);\n    }\n}\n//# sourceMappingURL=ShowFps.js.map","import { Control } from \"./Control\";\nimport { input } from \"../input/input\";\n/**\n * Simple keyboard camera navigation with W,S,A,D and shift keys to fly around the scene.\n */\nexport class SimpleNavigation extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"SimpleNavigation\",\n            autoActivate: true, ...options\n        });\n        this.speed = options.speed || 1.0;\n    }\n    oninit() {\n    }\n    onactivate() {\n        super.onactivate();\n        let r = this.renderer;\n        r.events.on(\"keypress\", input.KEY_W, this.onCameraMoveForward, this);\n        r.events.on(\"keypress\", input.KEY_S, this.onCameraMoveBackward, this);\n        r.events.on(\"keypress\", input.KEY_A, this.onCameraStrifeLeft, this);\n        r.events.on(\"keypress\", input.KEY_D, this.onCameraStrifeRight, this);\n        r.events.on(\"keypress\", input.KEY_UP, this.onCameraLookUp, this);\n        r.events.on(\"keypress\", input.KEY_DOWN, this.onCameraLookDown, this);\n        r.events.on(\"keypress\", input.KEY_LEFT, this.onCameraTurnLeft, this);\n        r.events.on(\"keypress\", input.KEY_RIGHT, this.onCameraTurnRight, this);\n        r.events.on(\"keypress\", input.KEY_Q, this.onCameraRollLeft, this);\n        r.events.on(\"keypress\", input.KEY_E, this.onCameraRollRight, this);\n    }\n    ondeactivate() {\n        super.ondeactivate();\n        let r = this.renderer;\n        r.events.off(\"keypress\", input.KEY_W, this.onCameraMoveForward);\n        r.events.off(\"keypress\", input.KEY_S, this.onCameraMoveBackward);\n        r.events.off(\"keypress\", input.KEY_A, this.onCameraStrifeLeft);\n        r.events.off(\"keypress\", input.KEY_D, this.onCameraStrifeRight);\n        r.events.off(\"keypress\", input.KEY_UP, this.onCameraLookUp);\n        r.events.off(\"keypress\", input.KEY_DOWN, this.onCameraLookDown);\n        r.events.off(\"keypress\", input.KEY_LEFT, this.onCameraTurnLeft);\n        r.events.off(\"keypress\", input.KEY_RIGHT, this.onCameraTurnRight);\n        r.events.off(\"keypress\", input.KEY_Q, this.onCameraRollLeft);\n        r.events.off(\"keypress\", input.KEY_E, this.onCameraRollRight);\n    }\n    onCameraMoveForward() {\n        if (this._active) {\n            let cam = this.renderer.activeCamera;\n            cam.slide(0, 0, -this.speed);\n            cam.update();\n        }\n    }\n    onCameraMoveBackward() {\n        let cam = this.renderer.activeCamera;\n        cam.slide(0, 0, this.speed);\n        cam.update();\n    }\n    onCameraStrifeLeft() {\n        let cam = this.renderer.activeCamera;\n        cam.slide(-this.speed, 0, 0);\n        cam.update();\n    }\n    onCameraStrifeRight() {\n        let cam = this.renderer.activeCamera;\n        cam.slide(this.speed, 0, 0);\n        cam.update();\n    }\n    onCameraLookUp() {\n        let cam = this.renderer.activeCamera;\n        cam.pitch(0.5);\n        cam.update();\n    }\n    onCameraLookDown() {\n        let cam = this.renderer.activeCamera;\n        cam.pitch(-0.5);\n        cam.update();\n    }\n    onCameraTurnLeft() {\n        let cam = this.renderer.activeCamera;\n        cam.yaw(0.5);\n        cam.update();\n    }\n    onCameraTurnRight() {\n        let cam = this.renderer.activeCamera;\n        cam.yaw(-0.5);\n        cam.update();\n    }\n    onCameraRollLeft() {\n        let cam = this.renderer.activeCamera;\n        cam.roll(-0.5);\n        cam.update();\n    }\n    onCameraRollRight() {\n        let cam = this.renderer.activeCamera;\n        cam.roll(0.5);\n        cam.update();\n    }\n}\n//# sourceMappingURL=SimpleNavigation.js.map","import { input } from \"../input/input\";\nimport { Control } from \"./Control\";\n/**\n * Planet GL draw mode(TRIANGLE_STRIP/LINE_STRING) changer.\n */\nexport class ToggleWireframe extends Control {\n    constructor(options = {}) {\n        super(options);\n        this._isActive = false;\n        this.toogleWireframe = () => {\n            if (this.renderer && this.renderer.handler.gl) {\n                if (this.planet.drawMode === this.renderer.handler.gl.LINE_STRIP) {\n                    this.planet.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP);\n                }\n                else {\n                    this.planet.setDrawMode(this.renderer.handler.gl.LINE_STRIP);\n                }\n            }\n        };\n        this._isActive = options.isActive || false;\n    }\n    oninit() {\n        this.renderer.events.on(\"charkeypress\", input.KEY_X, this.toogleWireframe, this);\n        if (this._isActive) {\n            this.planet.setDrawMode(this.renderer.handler.gl.LINE_STRIP);\n        }\n    }\n}\n//# sourceMappingURL=ToggleWireframe.js.map","/**\n * @module og/segment/SegmentHelper\n */\nimport { N, W, S, E } from '../quadTree/quadTree';\nfunction NewIndexesTypedArray(arr) {\n    return new Uint32Array(arr);\n}\nfunction NewIndexesTypedArrayEmpty(size) {\n    return new Uint32Array(size);\n}\nfunction createCenterBodyIndexes(size) {\n    let indexes = [];\n    let i0 = 1, j0 = 1;\n    let i1 = 1, j1 = 1;\n    let ind1 = 0, ind2 = 0, nr = 0;\n    for (let i = i0; i < size - 1 - i1; i++) {\n        for (let j = j0; j < size - j1; j++) {\n            ind1 = i * size + j;\n            nr = (i + 1) * size;\n            ind2 = nr + j;\n            indexes.push(ind1, ind2);\n        }\n        indexes.push(ind2, nr + j0);\n    }\n    indexes.push(indexes[indexes.length - 1], size * size - size);\n    return NewIndexesTypedArray(indexes);\n}\nfunction createWestNeighborSkirt(size, deltaGr) {\n    let indexes = [];\n    const grCount = (size - 1) / deltaGr;\n    const b = size * size - size;\n    let k = 0;\n    for (let i = 0; i < size - 2; i++) {\n        if (i % grCount === 0) {\n            k = i;\n        }\n        let rind = b - size * i - size + 1, lind = b - size * k;\n        indexes.push(lind, rind);\n    }\n    if (deltaGr === (size - 1)) {\n        indexes.push(size);\n        indexes.push(0);\n    }\n    return NewIndexesTypedArray(indexes);\n}\nfunction createNorthNeighborSkirt(size, deltaGr) {\n    let indexes = [];\n    const grCount = (size - 1) / deltaGr;\n    let k = 0;\n    for (let i = 0; i < size - 2; i++) {\n        if (i % grCount === 0) {\n            k = i;\n        }\n        let rind = size + i + 1, lind = k;\n        indexes.push(lind, rind);\n    }\n    if (deltaGr === (size - 1)) {\n        indexes.push(size - 2);\n        indexes.push(size - 1);\n    }\n    return NewIndexesTypedArray(indexes);\n}\nfunction createEastNeighborSkirt(size, deltaGr) {\n    let indexes = [];\n    const grCount = (size - 1) / deltaGr;\n    let k = 0;\n    for (let i = 0; i < size - 2; i++) {\n        if (i % grCount === 0) {\n            k = i;\n        }\n        let rind = size * (i + 1) + size - 2, lind = size + size * k - 1;\n        indexes.push(lind, rind);\n    }\n    if (deltaGr === (size - 1)) {\n        indexes.push(size * (size - 1) - 1);\n        indexes.push(size * size - 1);\n    }\n    return NewIndexesTypedArray(indexes);\n}\nfunction createSouthNeighborSkirt(size, deltaGr) {\n    let indexes = [];\n    const grCount = (size - 1) / deltaGr;\n    let k = 0;\n    const rb = size * (size - 1) - 2;\n    const lb = size * size - 1;\n    for (let i = 0; i < size - 2; i++) {\n        if (i % grCount === 0) {\n            k = i;\n        }\n        let rind = rb - i, lind = lb - k;\n        indexes.push(lind, rind);\n    }\n    if (deltaGr === (size - 1)) {\n        indexes.push(size * size - size + 1);\n    }\n    indexes.push(size * size - size);\n    return NewIndexesTypedArray(indexes);\n}\nfunction initIndexesBodySkirts(pow) {\n    let table = [[], [], [], []];\n    for (let i = 0; i <= pow; i++) {\n        let d = Math.pow(2, i), d1 = d + 1;\n        table[N][i] = [];\n        table[W][i] = [];\n        table[S][i] = [];\n        table[E][i] = [];\n        for (let j = 0; j <= pow; j++) {\n            let dd = Math.pow(2, j);\n            table[W][i][j] = createWestNeighborSkirt(d1, dd);\n            table[N][i][j] = createNorthNeighborSkirt(d1, dd);\n            table[E][i][j] = createEastNeighborSkirt(d1, dd);\n            table[S][i][j] = createSouthNeighborSkirt(d1, dd);\n        }\n    }\n    return table;\n}\nfunction initIndexBodiesTable(pow) {\n    let table = [];\n    for (let i = 0; i <= pow; i++) {\n        const d = Math.pow(2, i);\n        table[i] = createCenterBodyIndexes(d + 1);\n    }\n    return table;\n}\nfunction createTextureCoords(size) {\n    let texCoords = new Uint16Array((size + 1) * (size + 1) * 2);\n    let k = 0;\n    for (let i = 0; i <= size; i++) {\n        for (let j = 0; j <= size; j++) {\n            texCoords[k++] = j / size * 0xFFFF;\n            texCoords[k++] = i / size * 0xFFFF;\n        }\n    }\n    return texCoords;\n}\nclass SegmentHelper {\n    constructor(maxGridSize = 0) {\n        this._maxGridSize = maxGridSize;\n        this.centerIndexesTable = initIndexBodiesTable(this._maxGridSize);\n        this.skirtsIndexesTable = initIndexesBodySkirts(this._maxGridSize);\n    }\n    get maxGridSize() {\n        return this._maxGridSize;\n    }\n    init() {\n        this.centerIndexesTable = initIndexBodiesTable(this._maxGridSize);\n        this.skirtsIndexesTable = initIndexesBodySkirts(this._maxGridSize);\n    }\n    setMaxGridSize(gridSize) {\n        this._maxGridSize = gridSize;\n        this.init();\n    }\n    createSegmentIndexes(size, sidesSizes) {\n        if (size) {\n            let c = this.centerIndexesTable[size], w = this.skirtsIndexesTable[W][size][sidesSizes[W]], n = this.skirtsIndexesTable[N][size][sidesSizes[N]], e = this.skirtsIndexesTable[E][size][sidesSizes[E]], s = this.skirtsIndexesTable[S][size][sidesSizes[S]];\n            let indexes = NewIndexesTypedArrayEmpty(c.length + w.length + n.length + e.length + s.length);\n            indexes.set(c, 0);\n            indexes.set(w, c.length);\n            indexes.set(n, c.length + w.length);\n            indexes.set(e, c.length + w.length + n.length);\n            indexes.set(s, c.length + w.length + n.length + e.length);\n            return indexes;\n        }\n        else {\n            return NewIndexesTypedArray([0, 2, 1, 3]);\n        }\n    }\n    initTextureCoordsTable(pow) {\n        let table = [];\n        for (let i = 0; i <= pow; i++) {\n            const d = Math.pow(2, i);\n            table[i] = createTextureCoords(d);\n        }\n        return table;\n    }\n}\nlet instance = new SegmentHelper();\nexport function getInstance() {\n    return instance;\n}\n//# sourceMappingURL=segmentHelper.js.map","export const UTILS = `\n    float getLerpValue(in float min, in float max, in float between)\n    {\n        return (clamp(between, min, max) - min) / (max - min);\n    }\n    \n    vec3 aces(vec3 color) \n    {\n        float a = 2.51;\n        float b = 0.03;\n        float c = 2.43;\n        float d = 0.59;\n        float e = 0.14;\n        return clamp((color * (a * color + b)) / (color * (c * color + d ) + e), 0.0, 1.0);\n    }\n     \n    bool intersectSphere(vec3 rayOrigin, vec3 rayDirection, float radius, inout float t1, inout float t2) \n    {\n        float b = dot(rayDirection, rayOrigin);\n        float c = dot(rayOrigin, rayOrigin) - radius * radius;\n        float d = b * b - c;\n        if (d < 0.0) {\n            return false;\n        }\n        t1 = -b - sqrt(d);\n        t2 = -b + sqrt(d);\n        return true;\n    }\n    \n    bool intersectSphere(vec3 rayOrigin, vec3 rayDirection, float radius, inout float t) \n    {\n        float b = dot(rayDirection, rayOrigin);\n        float c = dot(rayOrigin, rayOrigin) - radius * radius;\n        float d = b * b - c;\n        if (d < 0.0) {\n            return false;\n        }\n        t = -b - sqrt(d);\n        return true;\n    }\n    \n    bool intersectEllipsoid( in vec3 ro, in vec3 rd, in vec3 ra, inout float t )\n    {\n        vec3 ocn = ro/ra;\n        vec3 rdn = rd/ra;\n        float a = dot( rdn, rdn );\n        float b = dot( ocn, rdn );\n        float c = dot( ocn, ocn );\n        float h = b*b - a*(c-1.0);\n                       \n        if (h < 0.0) \n        { \n            return false; \n        }\n        \n        t = (-b-sqrt(h))/a;\n        \n        return true;\n    }\n    \n    bool intersectEllipsoid( in vec3 ro, in vec3 rd, in vec3 ra, inout float t1, inout float t2)\n    {\n        vec3 ocn = ro/ra;\n        vec3 rdn = rd/ra;\n        float a = dot( rdn, rdn );\n        float b = dot( ocn, rdn );\n        float c = dot( ocn, ocn );\n        float h = b*b - a*(c-1.0);\n                \n        if (h < 0.0) \n        { \n            return false; \n        }\n        \n        h = sqrt(h);\n        t1 = (-b-h)/a;\n        t2 = (-b+h)/a;\n        \n        return true;\n    }\n    \n    vec3 normalEllipsoid( in vec3 pos, in vec3 ra )\n    {\n        return normalize( pos/(ra*ra) );\n    }\n`;\n//# sourceMappingURL=utils.js.map","import { Program } from '../webgl/Program';\nimport { UTILS } from './utils';\nexport const COMMON = `\n    \n    ${UTILS}\n    \n    #define PI 3.1415926538\n    #define ATMOS_HEIGHT 100000.0\n    #define RAYLEIGH_SCALE 0.08\n    #define MIE_SCALE 0.012\n    \n    #define SAMPLE_COUNT 16\n    #define SQRT_SAMPLE_COUNT 4\n            \n    const float GROUND_ALBEDO = 0.05 / PI;\n\n    // Sphere\n    const float BOTTOM_RADIUS = 6356752.3142451793;\n    const float TOP_RADIUS = 6356752.3142451793 + ATMOS_HEIGHT;\n        \n    // Ellipsoid\n    const vec3 bottomRadii = vec3(6378137.0, 6378137.0, 6356752.3142451793);           \n    const vec3 topRadii = bottomRadii + ATMOS_HEIGHT;\n    \n    const vec3 SPHERE_TO_ELLIPSOID_SCALE = vec3(BOTTOM_RADIUS) / bottomRadii;           \n    \n    const vec2 rayleighMieHeights = vec2(RAYLEIGH_SCALE, MIE_SCALE) * ATMOS_HEIGHT;\n     \n    const vec3 rayleighScatteringCoefficient = vec3(5.802, 13.558, 33.100) * 1e-6;\n    \n    const float mieScatteringCoefficient = 3.996e-06;\n    const float mieExtinctionCoefficient = 4.440e-06;\n    const vec3 ozoneAbsorptionCoefficient = vec3(0.650, 1.881, 0.085) * 1e-6;\n    \n    const float SUN_ANGULAR_RADIUS = 0.004685;\n    const float SUN_INTENSITY = 1.0;        \n    \n    vec3 sunWithBloom(vec3 rayDir, vec3 sunDir) \n    {\n        float minSunCosTheta = cos(SUN_ANGULAR_RADIUS);            \n        float cosTheta = dot(rayDir, sunDir);\n        if (cosTheta >= minSunCosTheta) return vec3(1.0);                \n        float offset = minSunCosTheta - cosTheta;\n        float gaussianBloom = exp(-offset*15000.0)*0.7;\n        float invBloom = 1.0/(0.09 + offset*200.0)*0.01;\n        return vec3(gaussianBloom + invBloom);\n    }\n    \n    float rayleighPhase(float angle) \n    {\n        return 3.0 / (16.0 * PI) * (1.0 + (angle * angle));\n    }\n    \n    float miePhase(float angle) \n    {\n        float g = 0.8;\n        return 3.0 / (8.0 * PI) * ((1.0 - g * g) * (1.0 + angle * angle)) / ((2.0 + g * g) * pow(1.0 + g * g - 2.0 * g * angle, 1.5));\n    }\n        \n    vec3 opticalDepth(float height, float angle) \n    {\n        vec3 rayOrigin = vec3(0.0, BOTTOM_RADIUS + height, 0.0);\n        vec3 rayDirection = vec3(sqrt(1.0 - angle * angle), angle, 0.0);\n        float t1, t2;\n        intersectSphere(rayOrigin, rayDirection, TOP_RADIUS, t1, t2);\n        float segmentLength = t2 / float(SAMPLE_COUNT);\n        \n        float t = segmentLength * 0.5;\n        vec3 opticalDepth = vec3(0.0);\n        \n        for (int i = 0; i < SAMPLE_COUNT; i++) \n        {\n            vec3 position = rayOrigin + t * rayDirection;\n            float height = length(position) - BOTTOM_RADIUS;\n            opticalDepth.xy += exp(-height / rayleighMieHeights) * segmentLength;\n            \n            // density of the ozone layer is modeled as a triangular \n            // function that is 30 km wide and centered at 25 km altitude\n            opticalDepth.z += (1.0 - min(abs(height - 25e3) / 15e3, 1.0)) * segmentLength;  \n            t += segmentLength;\n        }\n        \n        return opticalDepth;\n    }\n    \n    vec3 transmittance(float height, float angle) \n    {\n        vec3 opticalDepth = opticalDepth(height, angle);\n        return exp(-(rayleighScatteringCoefficient * opticalDepth.x + mieExtinctionCoefficient * opticalDepth.y + ozoneAbsorptionCoefficient * opticalDepth.z));\n    }`;\nexport function transmittance() {\n    return new Program(\"transmittance\", {\n        uniforms: {\n            iResolution: \"vec2\"\n        },\n        attributes: {\n            a_position: \"vec2\"\n        },\n        vertexShader: `\n            attribute vec2 a_position;\n            \n            void main(void) \n            {\n                gl_Position = vec4(a_position, 0.0, 1.0);\n            }`,\n        fragmentShader: `\n            precision highp float;\n            \n            ${COMMON}\n                       \n            uniform vec2 iResolution;\n                        \n            void main(void) \n            {\n                vec2 uv = gl_FragCoord.xy / iResolution.xy;\n                float height = uv.y * ATMOS_HEIGHT;\n                float angle = uv.x * 2.0 - 1.0;\n                gl_FragColor = vec4(transmittance(height, angle), 1.0);\n            }`\n    });\n}\nexport function scattering() {\n    return new Program(\"scattering\", {\n        uniforms: {\n            iResolution: \"vec2\",\n            transmittanceTexture: \"sampler2d\"\n        },\n        attributes: {\n            a_position: \"vec2\"\n        },\n        vertexShader: `            \n            attribute vec2 a_position;  \n                      \n            void main(void) \n            {\n                gl_Position = vec4(a_position, 0.0, 1.0);\n            }`,\n        fragmentShader: `            \n            precision highp float;\n            \n            uniform sampler2D transmittanceTexture;\n            uniform vec2 iResolution;\n            \n            ${COMMON}\n            \n            vec3 transmittanceFromTexture(float height, float angle) \n            {\n                float u = (angle + 1.0) * 0.5;\n                float v = height / ATMOS_HEIGHT;\n                return texture2D(transmittanceTexture, vec2(u, v)).xyz;\n            }\n                                   \n            void main(void) \n            {\n                vec2 uv = gl_FragCoord.xy / iResolution.xy;\n                \n                float height = uv.y * ATMOS_HEIGHT;\n                float angle = uv.x * 2.0 - 1.0;\n                \n                vec3 rayOrigin = vec3(0.0, BOTTOM_RADIUS + height, 0.0);\n                vec3 up = rayOrigin / length(rayOrigin);\n                vec3 lightDirection = vec3(sqrt(1.0 - angle * angle), angle, 0.0);\n                                \n                const float isotropicPhase = 1.0 / (4.0 * PI);\n                \n                vec3 light = vec3(0.0);\n                vec3 lightTransferFactor = vec3(0.0);\n                \n                for (int i = 0; i < SQRT_SAMPLE_COUNT; i++)\n                {\n                    for (int j = 0; j < SQRT_SAMPLE_COUNT; j++)\n                    {\n                        float u = ((0.5 + float(i)) / float(SQRT_SAMPLE_COUNT)) * 2.0 - 1.0;\n                        float v = (0.5 + float(j)) / float(SQRT_SAMPLE_COUNT);\n                        float r = sqrt(1.0 - u * u);\n                        float theta = 2.0 * PI * v;\n                        vec3 rayDirection = vec3(cos(theta) * r, sin(theta) * r, u);\n                                                \n                        float rayAngle = dot(up, rayDirection);\n                        bool cameraBelow = rayAngle < 0.0;\n                        \n                        vec3 transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                        \n                        float offset = 0.0;\n                        float distanceToSpace = 0.0;\n                        \n                        intersectSphere(rayOrigin, rayDirection, TOP_RADIUS, offset, distanceToSpace);\n                        \n                        float distanceToGround = 0.0;\n                        bool hitGround = intersectSphere(rayOrigin, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;                        \n                        float segmentLength = (hitGround ? distanceToGround : distanceToSpace) / float(SAMPLE_COUNT);\n                        float t = segmentLength * 0.5;\n                        \n                        vec3 transmittanceCamera;\n                        vec3 transmittanceLight;\n                         \n                        for (int k = 0; k < SAMPLE_COUNT; k++) \n                        {\n                            vec3 position = rayOrigin + t * rayDirection;\n                            float height = length(position) - BOTTOM_RADIUS;\n                            vec3 up = position / length(position);\n                            float rayAngle = dot(up, rayDirection);\n                            float lightAngle = dot(up, lightDirection);\n                            \n                            float distanceToGround;\n                            float shadow = intersectSphere(position, lightDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround >= 0.0 ? 0.0 : 1.0;\n                            vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                            \n                            transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\n                            transmittanceLight = transmittanceFromTexture(height, lightAngle);\n                            \n                            vec2 opticalDensity = exp(-height / rayleighMieHeights);        \n                            vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y) * isotropicPhase;\n                            \n                            light += shadow * transmittanceCamera * scatteredLight * segmentLength;\n                            lightTransferFactor += transmittanceCamera * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y) * segmentLength;\n                            \n                            t += segmentLength;\n                        }\n                    \n                        if (hitGround) \n                        {\n                            vec3 hitPoint = rayOrigin + rayDirection * distanceToGround;\n                            vec3 normal = normalize(hitPoint);\n                            float diffuseAngle = max(dot(normal, lightDirection), 0.0); \n                            float earthAlbedo = 0.05;\n                            light += transmittanceCamera * transmittanceLight * (earthAlbedo / PI) * diffuseAngle;\n                        }\n                    }\n                }\n                \n                light /= float(SAMPLE_COUNT);\n                lightTransferFactor /= float(SAMPLE_COUNT);\n                vec3 color = light / (1.0 - lightTransferFactor);                 \n                gl_FragColor = vec4(color, 1.0);\n            }`\n    });\n}\n// const vec3 solar_irradiance = vec3(1.474000,1.850400,1.911980);\n// float GetTextureCoordFromUnitRange(float x, int texture_size) {\n//     return 0.5 / float(texture_size) + x * (1.0 - 1.0 / float(texture_size));\n// }\n//\n// float ClampDistance(float d) {\n//     return max(d, 0.0 * m);\n// }\n//\n// float SafeSqrt(float a) {\n//     return sqrt(max(a, 0.0 * m2));\n// }\n// float DistanceToTopAtmosphereBoundary(float r, float mu) {\n//\n//     //assert(r <= atmosphere.top_radius);\n//     //assert(mu >= -1.0 && mu <= 1.0);\n//\n//     float discriminant = r * r * (mu * mu - 1.0) + TOP_RADIUS * TOP_RADIUS;\n//     return ClampDistance(-r * mu + SafeSqrt(discriminant));\n// }\n// vec2 GetTransmittanceTextureUvFromRMu(\n//     float r,\n//     float mu)\n// {\n//     //assert(r >= atmosphere.BOTTOM_RADIUS && r <= TOP_RADIUS);\n//     //assert(mu >= -1.0 && mu <= 1.0);\n//\n//     float H = sqrt(TOP_RADIUS * TOP_RADIUS - BOTTOM_RADIUS * BOTTOM_RADIUS);\n//     float rho = SafeSqrt(r * r - BOTTOM_RADIUS * BOTTOM_RADIUS);\n//     float d = DistanceToTopAtmosphereBoundary(r, mu);\n//     float d_min = TOP_RADIUS - r;\n//     float d_max = rho + H;\n//     float x_mu = (d - d_min) / (d_max - d_min);\n//     float x_r = rho / H;\n//\n//     return vec2(\n//         GetTextureCoordFromUnitRange(x_mu, TRANSMITTANCE_TEXTURE_WIDTH),\n//         GetTextureCoordFromUnitRange(x_r, TRANSMITTANCE_TEXTURE_HEIGHT)\n//     );\n// }\n// vec3 GetTransmittanceToTopAtmosphereBoundary(in sampler2D transmittance_texture, float r, float mu)\n// {\n//     //assert(r >= BOTTOM_RADIUS && r <= TOP_RADIUS);\n//\n//     vec2 uv = GetTransmittanceTextureUvFromRMu(r, mu);\n//     return texture(transmittance_texture, uv).xyz;\n// }\n// vec3 GetTransmittanceToSun(\n//     in sampler2D transmittance_texture,\n//     float r,\n//     float mu_s)\n// {\n//     float sin_theta_h = BOTTOM_RADIUS / r;\n//     float cos_theta_h = -sqrt(max(1.0 - sin_theta_h * sin_theta_h, 0.0));\n//\n//     return GetTransmittanceToTopAtmosphereBoundary(transmittance_texture, r, mu_s) * smoothstep(\n//         -sin_theta_h * SUN_ANGULAR_RADIUS / rad, sin_theta_h * SUN_ANGULAR_RADIUS / rad,\n//         mu_s - cos_theta_h\n//     );\n// }\n// vec3 GetSunAndSkyIrradiance(\n//     in sampler2D transmittance_texture,\n//     in vec3 point,\n//     in vec3 normal,\n//     in vec3 sun_direction,\n//     out vec3 sky_irradiance)\n// {\n//     float r = length(point);\n//     float mu_s = dot(point, sun_direction) / r;\n//\n//     sky_irradiance = vec3(0.0);  // GetIrradiance(atmosphere, irradiance_texture, r, mu_s) * (1.0 + dot(normal, point) / r) * 0.5;\n//\n//     return solar_irradiance * GetTransmittanceToSun(transmittance_texture, r, mu_s) * max(dot(normal, sun_direction), 0.0);\n// }\n//# sourceMappingURL=atmos.js.map","import * as atmos from \"./atmos\";\nimport { Program } from \"../webgl/Program\";\nimport { UTILS } from './utils';\n// REMEMBER!\n// src*(1)+dest*(1-src.alpha)\n// glBlendFunc(GL_ONE, GL_ONE_MINUS_SRC_ALPHA);\n// src*(src.alpha)+dest*(1-src.alpha)\n// glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);\nconst NIGHT = `const vec3 nightStep = 10.0 * vec3(0.58, 0.48, 0.25);`;\nconst DEF_BLEND = `#define blend(DEST, SAMPLER, OFFSET, OPACITY) \\\n                    src = texture( SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw );\\\n                    DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;`;\nconst DEF_BLEND_WEBGL1 = `#define blend(DEST, SAMPLER, OFFSET, OPACITY) \\\n                            src = texture2D( SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw ); \\\n                            DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;`;\nconst DEF_BLEND_PICKING = `#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) \\\n    tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; \\\n    t = texture2D(SAMPLER, tc); \\\n    p = texture2D(MASK, tc); \\\n    DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0 : 1.0) * COLOR.a);`;\nconst SLICE_SIZE = 4;\nexport function drawnode_screen_nl() {\n    return new Program(\"drawnode_screen_nl\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            samplerCount: \"int\",\n            tileOffsetArr: \"vec4\",\n            layerOpacityArr: \"float\",\n            samplerArr: \"sampler2darray\",\n            defaultTexture: \"sampler2d\",\n            height: \"float\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\",\n            aVertexPositionLow: \"vec3\",\n            aTextureCoord: \"vec2\"\n        },\n        vertexShader: `precision highp float;\n            \n            attribute vec3 aVertexPositionHigh;\n            attribute vec3 aVertexPositionLow;\n            attribute vec2 aTextureCoord;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            varying vec2 vTextureCoord;\n\n            void main(void) {\n\n                vTextureCoord = aTextureCoord;\n                vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n                mat4 m = projectionMatrix * viewMatrixRTE;\n        \n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n                \n                // This is works for Mac Chrome, prevent some weird optimization I suppose\n                gl_Position =  m * vec4(highDiff + lowDiff, 1.0);\n            }`,\n        fragmentShader: `precision highp float;\n            #define SLICE_SIZE ${SLICE_SIZE + 1}\n            uniform vec4 tileOffsetArr[SLICE_SIZE];\n            uniform float layerOpacityArr[SLICE_SIZE];\n            uniform sampler2D defaultTexture;\n            uniform sampler2D samplerArr[SLICE_SIZE];\n            uniform int samplerCount;\n            varying vec2 vTextureCoord;\n\n            ${DEF_BLEND_WEBGL1}\n\n            void main(void) {\n                gl_FragColor = texture2D( defaultTexture, vTextureCoord );\n                if( samplerCount == 0 ) return;\n\n                vec4 src;\n\n                blend(gl_FragColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\n                if( samplerCount == 1 ) return;\n\n                blend(gl_FragColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\n                if( samplerCount == 2 ) return;\n\n                blend(gl_FragColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\n                if( samplerCount == 3 ) return;\n\n                blend(gl_FragColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\n                if( samplerCount == 4 ) return;\n\n                blend(gl_FragColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\n            }`\n    });\n}\nexport function drawnode_screen_wl_webgl1NoAtmos() {\n    return new Program(\"drawnode_screen_wl\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            height: \"float\",\n            uGlobalTextureCoord: \"vec4\",\n            uNormalMapBias: \"vec3\",\n            samplerCount: \"int\",\n            tileOffsetArr: \"vec4\",\n            layerOpacityArr: \"float\",\n            samplerArr: \"sampler2darray\",\n            defaultTexture: \"sampler2d\",\n            uNormalMap: \"sampler2d\",\n            nightTexture: \"sampler2d\",\n            specularTexture: \"sampler2d\",\n            lightsPositions: \"vec3\",\n            diffuse: \"vec3\",\n            ambient: \"vec3\",\n            specular: \"vec4\",\n            camHeight: \"float\",\n            nightTextureCoefficient: \"float\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\",\n            aVertexPositionLow: \"vec3\",\n            aTextureCoord: \"vec2\"\n        },\n        vertexShader: `\n            attribute vec3 aVertexPositionHigh;\n            attribute vec3 aVertexPositionLow;\n            attribute vec2 aTextureCoord;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec4 uGlobalTextureCoord;\n            uniform vec3 uNormalMapBias;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            varying vec4 vTextureCoord;\n            varying vec3 v_vertex;\n            varying vec3 cameraPosition;\n            varying vec2 vGlobalTextureCoord;\n            varying float v_height;\n\n            void main(void) {\n\n                // I replace it here (from the bottom) because it \n                // somehow affects on float precision on MacPC Chrome\n                vTextureCoord.xy = aTextureCoord;\n                vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\n                vTextureCoord.zw = uNormalMapBias.z * ( aTextureCoord + uNormalMapBias.xy );\n\n                vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;                \n                vec3 nh = height * normalize(aVertexPosition);\n                cameraPosition = eyePositionHigh + eyePositionLow;\n                \n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                v_height = height;\n                v_vertex = aVertexPosition + nh;\n                            \n                gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n            }`,\n        fragmentShader: `\n            precision highp float;\n            \n            #define MAX_POINT_LIGHTS 1\n            #define SLICE_SIZE ${SLICE_SIZE + 1}\n\n            uniform vec4 specular;\n            uniform vec3 diffuse;\n            uniform vec3 ambient;\n\n            uniform sampler2D uNormalMap;\n            uniform sampler2D nightTexture;\n            uniform sampler2D specularTexture;\n            uniform sampler2D defaultTexture;\n            uniform sampler2D samplerArr[SLICE_SIZE];\n\n            uniform vec4 tileOffsetArr[SLICE_SIZE];\n            uniform vec3 lightsPositions[MAX_POINT_LIGHTS];\n            uniform float layerOpacityArr[SLICE_SIZE];\n\n            uniform int samplerCount;\n            uniform float nightTextureCoefficient;              \n            uniform float camHeight;\n\n            varying vec4 vTextureCoord;\n            varying vec3 v_vertex;\n            varying vec3 cameraPosition;\n            varying vec2 vGlobalTextureCoord;\n            varying float v_height;\n\n            vec3 sunPos;\n\n            ${NIGHT}\n\n            ${DEF_BLEND_WEBGL1}\n            \n            ${UTILS}\n                                               \n            void main(void) {\n            \n                sunPos = lightsPositions[0];\n                                \n                vec3 texNormal = texture2D(uNormalMap, vTextureCoord.zw).rgb;\n                vec3 normal = normalize((texNormal - 0.5) * 2.0);\n                \n                float minH = 1200000.0;\n                float maxH = minH * 3.0;\n                float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\n                                \n                if(camHeight > 6000000.0)\n                {\n                    normal = normalize(v_vertex);\n                }\n                                            \n                vec3 lightDir = normalize(sunPos);\n                vec3 viewDir = normalize(cameraPosition - v_vertex);\n                                                \n                float overGround = 1.0 - step(0.1, v_height);\n\n                float shininess = texture2D( specularTexture, vGlobalTextureCoord.st ).r * 255.0 * overGround;\n                vec3 reflectionDirection = reflect(-lightDir, normal);\n                float reflection = max( dot(reflectionDirection, viewDir), 0.0);\n                vec3 spec = specular.rgb * pow( reflection, specular.w) * shininess;                \n                float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);                \n                vec4 nightImageColor = texture2D( nightTexture, vGlobalTextureCoord.st );\n                vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\n                night *= overGround * step(0.0, night);                \n                vec4 lightWeighting = vec4(ambient + diffuse * diffuseLightWeighting + night, 1.0);\n                \n                gl_FragColor = texture2D( defaultTexture, vTextureCoord.xy );\n                if( samplerCount == 0 ) {\n                    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n                    return;\n                }\n\n                vec4 src;\n\n                blend(gl_FragColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\n                if( samplerCount == 1 ) {                \n                    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n                    return;\n                }\n\n                blend(gl_FragColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\n                if( samplerCount == 2 ) {\n                    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n                    return;\n                }\n\n                blend(gl_FragColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\n                if( samplerCount == 3 ) {\n                    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n                    return;\n                }\n\n                blend(gl_FragColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\n                if( samplerCount == 4 ) {\n                    gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n                    return;\n                }\n\n                blend(gl_FragColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\n                gl_FragColor = gl_FragColor * lightWeighting + vec4(spec, 0.0);\n            }`\n    });\n}\nexport function drawnode_screen_wl_webgl2NoAtmos() {\n    return new Program(\"drawnode_screen_wl\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            height: \"float\",\n            uGlobalTextureCoord: \"vec4\",\n            uNormalMapBias: \"vec3\",\n            samplerCount: \"int\",\n            tileOffsetArr: \"vec4\",\n            layerOpacityArr: \"float\",\n            samplerArr: \"sampler2darray\",\n            defaultTexture: \"sampler2d\",\n            uNormalMap: \"sampler2d\",\n            nightTexture: \"sampler2d\",\n            specularTexture: \"sampler2d\",\n            lightsPositions: \"vec3\",\n            diffuse: \"vec3\",\n            ambient: \"vec3\",\n            specular: \"vec4\",\n            camHeight: \"float\",\n            nightTextureCoefficient: \"float\",\n            transitionOpacity: \"float\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\",\n            aVertexPositionLow: \"vec3\",\n            aTextureCoord: \"vec2\"\n        },\n        vertexShader: `#version 300 es\n\n            precision highp float;\n\n            in vec3 aVertexPositionHigh;\n            in vec3 aVertexPositionLow;\n            in vec2 aTextureCoord;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec4 uGlobalTextureCoord;\n            uniform vec3 uNormalMapBias;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            out vec4 vTextureCoord;\n            out vec3 v_vertex;\n            out vec3 cameraPosition;\n            out vec2 vGlobalTextureCoord;\n            out float v_height;\n\n            void main(void) {\n\n                // I replace it here (from the bottom) because it \n                // somehow affects on float precision on MacPC Chrome\n                vTextureCoord.xy = aTextureCoord;\n                vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\n                vTextureCoord.zw = uNormalMapBias.z * ( aTextureCoord + uNormalMapBias.xy );\n\n                vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;                \n                vec3 nh = height * normalize(aVertexPosition);\n                cameraPosition = eyePositionHigh + eyePositionLow;\n                \n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                v_height = height;\n                v_vertex = aVertexPosition + nh;\n                            \n                gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n            }`,\n        fragmentShader: `#version 300 es\n\n            precision highp float;\n            \n            #define MAX_POINT_LIGHTS 1\n            #define SLICE_SIZE ${SLICE_SIZE + 1}\n\n            uniform vec4 specular;\n            uniform vec3 diffuse;\n            uniform vec3 ambient;  \n\n            uniform sampler2D uNormalMap;\n            uniform sampler2D nightTexture;\n            uniform sampler2D specularTexture;\n            uniform sampler2D defaultTexture;\n            uniform sampler2D samplerArr[SLICE_SIZE];\n\n            uniform vec4 tileOffsetArr[SLICE_SIZE];\n            uniform vec3 lightsPositions[MAX_POINT_LIGHTS];\n            uniform float layerOpacityArr[SLICE_SIZE];\n\n            uniform int samplerCount;\n            uniform float nightTextureCoefficient;\n            \n            uniform float transitionOpacity;\n                \n            uniform float camHeight;\n\n            in vec4 vTextureCoord;\n            in vec3 v_vertex;\n            in vec3 cameraPosition;\n            in vec2 vGlobalTextureCoord;\n            in float v_height;\n\n            vec3 sunPos;\n\n            layout(location = 0) out vec4 diffuseColor;\n\n            ${NIGHT}\n\n            ${DEF_BLEND}\n            \n            ${UTILS}\n                                               \n            void main(void) {\n            \n                sunPos = lightsPositions[0];\n                                \n                vec3 texNormal = texture(uNormalMap, vTextureCoord.zw).rgb;\n                vec3 normal = normalize((texNormal - 0.5) * 2.0);\n                \n                float minH = 1200000.0;\n                float maxH = minH * 3.0;\n                float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\n                                \n                if(camHeight > 6000000.0)\n                {\n                    normal = normalize(v_vertex);\n                }\n                                            \n                vec3 lightDir = normalize(sunPos);\n                vec3 viewDir = normalize(cameraPosition - v_vertex);\n                                                \n                float overGround = 1.0 - step(0.1, v_height);\n\n                float shininess = texture( specularTexture, vGlobalTextureCoord.st ).r * 255.0 * overGround;\n                vec3 reflectionDirection = reflect(-lightDir, normal);\n                float reflection = max( dot(reflectionDirection, viewDir), 0.0);\n                vec3 spec = specular.rgb * pow( reflection, specular.w) * shininess;                \n                float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);                \n                vec4 nightImageColor = texture( nightTexture, vGlobalTextureCoord.st );\n                vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\n                night *= overGround * step(0.0, night);                \n                vec4 lightWeighting = vec4(ambient + diffuse * diffuseLightWeighting + night, 1.0);\n                \n                diffuseColor = texture( defaultTexture, vTextureCoord.xy );\n                \n                if( samplerCount == 0 ) {\n                    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                vec4 src;\n\n                blend(diffuseColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\n                if( samplerCount == 1 ) {                \n                    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\n                if( samplerCount == 2 ) {\n                    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\n                if( samplerCount == 3 ) {\n                    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\n                if( samplerCount == 4 ) {\n                    diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\n                diffuseColor = diffuseColor * lightWeighting + vec4(spec, 0.0);\n                diffuseColor *= transitionOpacity;\n            }`\n    });\n}\nexport function drawnode_screen_wl_webgl2Atmos() {\n    return new Program(\"drawnode_screen_wl\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            height: \"float\",\n            uGlobalTextureCoord: \"vec4\",\n            uNormalMapBias: \"vec3\",\n            samplerCount: \"int\",\n            tileOffsetArr: \"vec4\",\n            layerOpacityArr: \"float\",\n            samplerArr: \"sampler2darray\",\n            defaultTexture: \"sampler2d\",\n            uNormalMap: \"sampler2d\",\n            nightTexture: \"sampler2d\",\n            specularTexture: \"sampler2d\",\n            lightsPositions: \"vec3\",\n            diffuse: \"vec3\",\n            ambient: \"vec3\",\n            specular: \"vec4\",\n            transmittanceTexture: \"sampler2D\",\n            scatteringTexture: \"sampler2D\",\n            camHeight: \"float\",\n            nightTextureCoefficient: \"float\",\n            maxMinOpacity: \"vec2\",\n            transitionOpacity: \"float\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\",\n            aVertexPositionLow: \"vec3\",\n            aTextureCoord: \"vec2\"\n        },\n        vertexShader: `#version 300 es\n\n            precision highp float;\n\n            in vec3 aVertexPositionHigh;\n            in vec3 aVertexPositionLow;\n            in vec2 aTextureCoord;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec4 uGlobalTextureCoord;\n            uniform vec3 uNormalMapBias;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            out vec4 vTextureCoord;\n            out vec3 v_vertex;\n            out vec3 cameraPosition;\n            out vec2 vGlobalTextureCoord;\n            out float v_height;\n\n            void main(void) {\n\n                // I replace it here (from the bottom) because it \n                // somehow affects on float precision on MacPC Chrome\n                vTextureCoord.xy = aTextureCoord;\n                vGlobalTextureCoord = uGlobalTextureCoord.xy + (uGlobalTextureCoord.zw - uGlobalTextureCoord.xy) * aTextureCoord;\n                vTextureCoord.zw = uNormalMapBias.z * ( aTextureCoord + uNormalMapBias.xy );\n\n                vec3 aVertexPosition = aVertexPositionHigh + aVertexPositionLow;                \n                vec3 nh = height * normalize(aVertexPosition);\n                cameraPosition = eyePositionHigh + eyePositionLow;\n                \n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                v_height = height;\n                v_vertex = aVertexPosition + nh;\n                            \n                gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff + lowDiff, 1.0);\n            }`,\n        fragmentShader: `#version 300 es\n\n            precision highp float;\n            \n            #define MAX_POINT_LIGHTS 1\n            #define SLICE_SIZE ${SLICE_SIZE + 1}\n\n            uniform vec4 specular;\n            uniform vec3 diffuse;\n            uniform vec3 ambient;\n\n            uniform vec3 lightsPositions[MAX_POINT_LIGHTS];\n\n            uniform sampler2D uNormalMap;\n            uniform sampler2D nightTexture;\n            uniform sampler2D specularTexture;\n            uniform sampler2D transmittanceTexture;\n            uniform sampler2D scatteringTexture;\n            uniform sampler2D defaultTexture;\n            uniform sampler2D samplerArr[SLICE_SIZE];\n\n            uniform vec4 tileOffsetArr[SLICE_SIZE];\n            uniform float layerOpacityArr[SLICE_SIZE];\n\n            uniform int samplerCount;\n            uniform float nightTextureCoefficient;\n            \n            uniform vec2 maxMinOpacity;                \n            uniform float camHeight;\n            \n            uniform float transitionOpacity;\n\n            in vec4 vTextureCoord;\n            in vec3 v_vertex;\n            in vec3 cameraPosition;\n            in vec2 vGlobalTextureCoord;\n            in float v_height;\n\n            vec3 sunPos;\n\n            layout(location = 0) out vec4 diffuseColor;\n\n            ${NIGHT}\n\n            ${DEF_BLEND}\n            \n            ${atmos.COMMON}            \n            \n            vec3 transmittanceFromTexture(float height, float angle) \n            {\n                float u = (angle + 1.0) * 0.5;\n                float v = height / ATMOS_HEIGHT;\n                return texture(transmittanceTexture, vec2(u, v)).xyz;\n            }\n\n            vec3 multipleScatteringContributionFromTexture(float height, float angle) \n            {\n                float u = (angle + 1.0) * 0.5;\n                float v = height / ATMOS_HEIGHT;\n                return texture(scatteringTexture, vec2(u, v)).xyz;\n            }\n            \n            void getSunIlluminance(in vec3 point, in vec3 lightDir, out vec3 sunIlluminance)\n            {\n                //     float r = length(point);\n                //     float mu_s = dot(point, sun_direction) / r;\n                //     float height = r - BOTTOM_RADIUS;\n                \n                float mu_s = dot(normalize(point), lightDir);\n                float height = length(point) - BOTTOM_RADIUS;\n                sunIlluminance = SUN_INTENSITY * transmittanceFromTexture(height, mu_s);\n            }\n           \n            void atmosGroundColor(out vec4 fragColor, in vec3 normal)\n            {                                                                                                                                \n                vec3 rayDirection = normalize(v_vertex - cameraPosition);\n                vec3 lightDir = normalize(sunPos);\n                \n                rayDirection = normalize(rayDirection * SPHERE_TO_ELLIPSOID_SCALE);\n                vec3 camPos = cameraPosition * SPHERE_TO_ELLIPSOID_SCALE;\n                lightDir = normalize(lightDir * SPHERE_TO_ELLIPSOID_SCALE);\n            \n                vec3 light = vec3(0.0);\n                vec3 transmittanceFromCameraToSpace = vec3(1.0);\n                float offset = 0.0;\n                float distanceToSpace = 0.0;\n                \n                intersectSphere(camPos, rayDirection, TOP_RADIUS, offset, distanceToSpace);\n            \n                vec3 rayOrigin = camPos;\n                \n                // above atmosphere\n                if (offset > 0.0) \n                {\n                    // intersection of camera ray with atmosphere\n                    rayOrigin += rayDirection * offset;\n                }\n                \n                float height = length(rayOrigin) - BOTTOM_RADIUS;\n                float rayAngle = dot(rayOrigin, rayDirection) / length(rayOrigin);\n                bool cameraBelow = rayAngle < 0.0;\n                \n                transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                \n                float phaseAngle = dot(lightDir, rayDirection);\n                float rayleighPhase = rayleighPhase(phaseAngle);\n                float miePhase = miePhase(phaseAngle);\n                \n                float distanceToGround = 0.0;\n                \n                bool hitGround = intersectSphere(camPos, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;                \n                \n                // Fix black dots on the edge of atmosphere                        \n                if(camHeight < 700000.0 || !hitGround)\n                {                          \n                    distanceToGround = distance(camPos, v_vertex * SPHERE_TO_ELLIPSOID_SCALE);\n                }\n                                                                \n                float segmentLength = (distanceToGround - max(offset, 0.0)) / float(SAMPLE_COUNT);\n                \n                float t = segmentLength * 0.5;\n                \n                vec3 transmittanceCamera; \n                vec3 transmittanceLight; \n                \n                for (int i = 0; i < SAMPLE_COUNT; i++) \n                {\n                    vec3 position = rayOrigin + t * rayDirection;\n                    float height = length(position) - BOTTOM_RADIUS;\n                    vec3 up = position / length(position);\n                    float rayAngle = dot(up, rayDirection);\n                    float lightAngle = dot(up, lightDir);                                                 \n                    vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                    transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\n                    transmittanceLight = transmittanceFromTexture(height, lightAngle);\n                    vec2 opticalDensity = exp(-height / rayleighMieHeights);\n                    vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x * rayleighPhase + mieScatteringCoefficient * opticalDensity.y * miePhase);\n                    scatteredLight += multipleScatteringContributionFromTexture(height, lightAngle) * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y);  \n                    light += transmittanceCamera * scatteredLight * segmentLength;\n                    t += segmentLength;\n                }\n                \n                light *= SUN_INTENSITY;\n        \n                vec3 hitPoint = camPos + rayDirection * distanceToGround;\n                vec3 up = normalize(hitPoint);\n                float diffuseAngle = max(dot(up, lightDir), 0.0);                \n                                \n                float lightAngle = dot(normal, lightDir);\n                vec3 tA = transmittanceCamera * GROUND_ALBEDO * SUN_INTENSITY;                                               \n                vec3 scatteringLight = multipleScatteringContributionFromTexture(height, lightAngle);\n                vec3 diffuseTransmittanceLight = transmittanceLight * diffuseAngle;                \n                light += tA * (scatteringLight + diffuseTransmittanceLight);\n                                                                \n                fragColor = vec4(pow(light * 8.0, vec3(1.0 / 2.2)), 1.0);\n            }\n\n            void getAtmosFadingOpacity(out float opacity)\n            {            \n                float c = length(cameraPosition);\n                float maxDist = sqrt(c * c - BOTTOM_RADIUS * BOTTOM_RADIUS);\n                float minDist = c - BOTTOM_RADIUS;\n                float vertDist = distance(cameraPosition, v_vertex);                    \n                opacity = clamp(maxMinOpacity.y + ( maxMinOpacity.x -  maxMinOpacity.y) * getLerpValue(minDist, maxDist, vertDist), 0.0, 1.0);\n            }\n\n            void main(void) {\n            \n                sunPos = lightsPositions[0];\n                                \n                vec3 texNormal = texture(uNormalMap, vTextureCoord.zw).rgb;\n                vec3 normal = normalize((texNormal - 0.5) * 2.0);\n                \n                float minH = 1200000.0;\n                float maxH = minH * 3.0;\n                float nightCoef = getLerpValue(minH, maxH, camHeight) * nightTextureCoefficient;\n                                \n                if(camHeight > 6000000.0)\n                {\n                    normal = normalize(v_vertex);\n                }\n                                            \n                vec3 lightDir = normalize(sunPos);\n                vec3 viewDir = normalize(cameraPosition - v_vertex);\n                \n                vec4 atmosColor;\n                atmosGroundColor(atmosColor, normal);\n                \n                vec3 sunIlluminance;                \n                getSunIlluminance(v_vertex * SPHERE_TO_ELLIPSOID_SCALE, lightDir * SPHERE_TO_ELLIPSOID_SCALE, sunIlluminance);\n                \n                float overGround = 1.0 - step(0.1, v_height);\n\n                float shininess = texture( specularTexture, vGlobalTextureCoord.st ).r * 255.0 * overGround;\n                vec3 reflectionDirection = reflect(-lightDir, normal);\n                float reflection = max( dot(reflectionDirection, viewDir), 0.0);\n                vec3 spec = sunIlluminance * specular.rgb * pow( reflection, specular.w) * shininess;                \n                float diffuseLightWeighting = max(dot(normal, lightDir), 0.0);\n                              \n                vec4 nightImageColor = texture( nightTexture, vGlobalTextureCoord.st );\n                vec3 night = nightStep * (.18 - diffuseLightWeighting * 3.0) * nightImageColor.rgb * nightCoef;\n                night *= overGround * step(0.0, night);                \n                vec4 lightWeighting = vec4(ambient + sunIlluminance * diffuse * diffuseLightWeighting + night, 1.0);\n                \n                float fadingOpacity;\n                getAtmosFadingOpacity(fadingOpacity);\n                \n                getSunIlluminance(cameraPosition, viewDir * SPHERE_TO_ELLIPSOID_SCALE, sunIlluminance);\n                \n                spec *= sunIlluminance;\n\n                diffuseColor = texture( defaultTexture, vTextureCoord.xy );\n                if( samplerCount == 0 ) {\n                    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor, fadingOpacity) + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                vec4 src;\n\n                blend(diffuseColor, samplerArr[0], tileOffsetArr[0], layerOpacityArr[0]);\n                if( samplerCount == 1 ) {                \n                    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[1], tileOffsetArr[1], layerOpacityArr[1]);\n                if( samplerCount == 2 ) {\n                    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[2], tileOffsetArr[2], layerOpacityArr[2]);\n                if( samplerCount == 3 ) {\n                    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[3], tileOffsetArr[3], layerOpacityArr[3]);\n                if( samplerCount == 4 ) {\n                    diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\n                    diffuseColor *= transitionOpacity;\n                    return;\n                }\n\n                blend(diffuseColor, samplerArr[4], tileOffsetArr[4], layerOpacityArr[4]);\n                diffuseColor = mix(diffuseColor * lightWeighting, atmosColor * diffuseColor.a, fadingOpacity) + vec4(spec, 0.0);\n                diffuseColor *= transitionOpacity;\n            }`\n    });\n}\nexport function drawnode_colorPicking() {\n    return new Program(\"drawnode_colorPicking\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            samplerCount: \"int\",\n            tileOffsetArr: \"vec4\",\n            samplerArr: \"sampler2darray\",\n            pickingMaskArr: \"sampler2darray\",\n            pickingColorArr: \"vec4\",\n            height: \"float\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\", aVertexPositionLow: \"vec3\", aTextureCoord: \"vec2\"\n        },\n        vertexShader: `precision highp float;\n            \n            attribute vec3 aVertexPositionHigh;\n            attribute vec3 aVertexPositionLow;\n            attribute vec2 aTextureCoord;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            varying vec2 vTextureCoord;\n\n            void main(void) {\n\n                vTextureCoord = aTextureCoord;\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                mat4 m = projectionMatrix * viewMatrixRTE;\n\n                vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\n\n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n\n                gl_Position = m * vec4(highDiff + lowDiff, 1.0);\n            }`,\n        fragmentShader: `precision highp float;\n            #define SLICE_SIZE ${SLICE_SIZE + 1}\n            uniform vec4 tileOffsetArr[SLICE_SIZE];\n            uniform vec4 pickingColorArr[SLICE_SIZE];\n            uniform sampler2D samplerArr[SLICE_SIZE];\n            uniform sampler2D pickingMaskArr[SLICE_SIZE];\n            uniform int samplerCount;\n            varying vec2 vTextureCoord;\n\n            ${DEF_BLEND_PICKING}\n\n            void main(void) {\n                gl_FragColor = vec4(0.0);\n                if( samplerCount == 0 ) return;\n\n                vec2 tc;\n                vec4 t;\n                vec4 p;\n\n                blendPicking(gl_FragColor, tileOffsetArr[0], samplerArr[0], pickingMaskArr[0], pickingColorArr[0], 1.0);\n                if( samplerCount == 1 ) return;\n\n                blendPicking(gl_FragColor, tileOffsetArr[1], samplerArr[1], pickingMaskArr[1], pickingColorArr[1], 1.0);\n                if( samplerCount == 2 ) return;\n\n                blendPicking(gl_FragColor, tileOffsetArr[2], samplerArr[2], pickingMaskArr[2], pickingColorArr[2], 1.0);\n                if( samplerCount == 3 ) return;\n\n                blendPicking(gl_FragColor, tileOffsetArr[3], samplerArr[3], pickingMaskArr[3], pickingColorArr[3], 1.0);\n                if( samplerCount == 4 ) return;\n\n                blendPicking(gl_FragColor, tileOffsetArr[4], samplerArr[4], pickingMaskArr[4], pickingColorArr[4], 1.0);\n            }`\n    });\n}\nexport function drawnode_heightPicking() {\n    return new Program(\"drawnode_heightPicking\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            height: \"float\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\", aVertexPositionLow: \"vec3\"\n        },\n        vertexShader: `precision highp float;\n\n            attribute vec3 aVertexPositionHigh;\n            attribute vec3 aVertexPositionLow;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            varying vec3 eyePosition;\n            varying vec3 vertexPosition;\n\n            void main(void) {\n\n                // This code is works for Mac Chrome and Safari\n                // any other code probably will produce jittering\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                mat4 m = projectionMatrix * viewMatrixRTE;\n\n                vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\n\n                eyePosition = eyePositionHigh + eyePositionLow;\n                vertexPosition = aVertexPositionHigh + aVertexPositionLow;\n\n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n                \n                gl_Position =  m * vec4(highDiff + lowDiff, 1.0);         \n            }`,\n        fragmentShader: `precision highp float;\n\n            varying vec3 eyePosition;\n            varying vec3 vertexPosition;\n\n            vec3 encode24(highp float f) {\n                float F = abs(f);\n                float s = step( 0.0, -f );\n                float e = floor( log2(F) );\n                float m = exp2(- e) * F;\n                e = floor( log2(F) + 127.0 ) + floor( log2(m) );\n                return vec3(\n                    ( 128.0 * s + floor( e * exp2(-1.0) ) ) / 255.0,\n                    ( 128.0 * mod( e, 2.0 ) + mod( floor( m * 128.0 ), 128.0 ) ) / 255.0,\n                    floor( mod( floor( m * exp2( 23.0 - 8.0) ), exp2(8.0) ) ) / 255.0);\n            }\n\n            void main(void) {\n                float range = distance(eyePosition, vertexPosition);\n                gl_FragColor = vec4(encode24(range), 1.0);\n            }`\n    });\n}\nexport function drawnode_depth() {\n    return new Program(\"drawnode_depth\", {\n        uniforms: {\n            projectionMatrix: \"mat4\",\n            viewMatrix: \"mat4\",\n            height: \"float\",\n            eyePositionHigh: \"vec3\",\n            eyePositionLow: \"vec3\",\n            frustumPickingColor: \"vec3\"\n        }, attributes: {\n            aVertexPositionHigh: \"vec3\", aVertexPositionLow: \"vec3\"\n        },\n        vertexShader: `precision highp float;\n\n            attribute vec3 aVertexPositionHigh;\n            attribute vec3 aVertexPositionLow;\n\n            uniform mat4 projectionMatrix;\n            uniform mat4 viewMatrix;\n            uniform vec3 eyePositionHigh;\n            uniform vec3 eyePositionLow;\n            uniform float height;\n\n            void main(void) {\n\n                // @hack\n                // This code is works for Mac Chrome and Safari\n                // any other code probably will produce jittering\n\n                mat4 viewMatrixRTE = viewMatrix;\n                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);\n\n                mat4 m = projectionMatrix * viewMatrixRTE;\n\n                vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);\n\n                vec3 eyePosition = eyePositionHigh + eyePositionLow;\n                vec3 vertexPosition = aVertexPositionHigh + aVertexPositionLow;\n\n                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;\n                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;\n                \n                gl_Position =  m * vec4(highDiff + lowDiff, 1.0);    \n            }`,\n        fragmentShader: `precision highp float;\n            uniform vec3 frustumPickingColor;\n\n            void main(void) {\n                gl_FragColor = vec4(frustumPickingColor, 1.0);\n            } `\n    });\n}\n//# sourceMappingURL=drawnode.js.map","export class BaseFramebuffer {\n    constructor(handler, options = {}) {\n        this.handler = handler;\n        this._fbo = null;\n        this._width = options.width || handler.canvas.width;\n        this._height = options.height || handler.canvas.height;\n        this._depthComponent = options.depthComponent != undefined ? options.depthComponent : \"DEPTH_COMPONENT16\";\n        this._useDepth = options.useDepth != undefined ? options.useDepth : true;\n        this._active = false;\n        this._size = options.size || 1;\n        this._depthRenderbuffer = null;\n        this._filter = options.filter || \"NEAREST\";\n    }\n    get width() {\n        return this._width;\n    }\n    get height() {\n        return this._height;\n    }\n    /**\n     * Sets framebuffer viewport size.\n     * @public\n     * @param {number} width - Framebuffer width.\n     * @param {number} height - Framebuffer height.\n     * @param {boolean} [forceDestroy] -\n     */\n    setSize(width, height, forceDestroy = false) {\n        this._width = width;\n        this._height = height;\n        if (this._active) {\n            this.handler.gl.viewport(0, 0, this._width, this._height);\n        }\n        if (this._useDepth || forceDestroy) {\n            this.destroy();\n            this.init();\n        }\n    }\n    init() {\n    }\n    destroy() {\n    }\n    /**\n     * Returns framebuffer completed.\n     * @public\n     * @returns {boolean} -\n     */\n    isComplete() {\n        let gl = this.handler.gl;\n        return gl.checkFramebufferStatus(gl.FRAMEBUFFER) === gl.FRAMEBUFFER_COMPLETE;\n    }\n    checkStatus() {\n        let gl = this.handler.gl;\n        return gl.checkFramebufferStatus(gl.FRAMEBUFFER);\n    }\n    /**\n     * Activate framebuffer frame to draw.\n     * @public\n     * @returns {Framebuffer} Returns Current framebuffer.\n     */\n    activate() {\n        let gl = this.handler.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\n        gl.viewport(0, 0, this._width, this._height);\n        this._active = true;\n        let c = this.handler.framebufferStack.current().data;\n        c && (c._active = false);\n        this.handler.framebufferStack.push(this);\n        return this;\n    }\n    /**\n     * Deactivate framebuffer frame.\n     * @public\n     */\n    deactivate() {\n        let h = this.handler, gl = h.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        this._active = false;\n        let f = this.handler.framebufferStack.popPrev();\n        if (f) {\n            gl.bindFramebuffer(gl.FRAMEBUFFER, f._fbo);\n            gl.viewport(0, 0, f._width, f._height);\n        }\n        else {\n            gl.viewport(0, 0, h.canvas.width, h.canvas.height);\n        }\n    }\n}\n//# sourceMappingURL=BaseFramebuffer.js.map","/**\n * Usefull class for working with JS canvas object.\n * @class\n * @param {number} [width] - Canvas width. Default 256.\n * @param {number} [height] - Canvas height. Default 256.\n */\nclass ImageCanvas {\n    constructor(width = 256, height = 256) {\n        this._canvas = document.createElement(\"canvas\");\n        this._canvas.width = width;\n        this._canvas.height = height;\n        this._context = this._canvas.getContext(\"2d\", {\n            willReadFrequently: true\n        });\n    }\n    /**\n     * Returns canvas object.\n     * @public\n     * @returns {HTMLCanvasElement}\n     */\n    getCanvas() {\n        return this._canvas;\n    }\n    /**\n     * Returns canvas context pointer.\n     * @public\n     * @returns {CanvasRenderingContext2D}\n     */\n    getContext() {\n        return this._context;\n    }\n    /**\n     * Fills canvas RGBA with zeroes.\n     * @public\n     */\n    fillEmpty() {\n        let imgd = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\n        let pixels = imgd.data;\n        for (let i = 0, n = pixels.length; i < n; i += 4) {\n            pixels[i] = pixels[i + 1] = pixels[i + 2] = pixels[i + 3] = 0;\n        }\n        this._context.putImageData(imgd, 0, 0);\n    }\n    /**\n     * Fills canvas RGBA with color.\n     * @public\n     * @param {string} color - CSS string color.\n     */\n    fill(color) {\n        this._context.fillStyle = color;\n        this._context.fill();\n    }\n    /**\n     * Gets canvas pixels RGBA data.\n     * @public\n     * @returns {Uint8ClampedArray}\n     */\n    getData() {\n        let imgd = this._context.getImageData(0, 0, this._canvas.width, this._canvas.height);\n        return imgd.data;\n    }\n    /**\n     * Fill the canvas by color.\n     * @public\n     * @param {string} color - CSS string color.\n     */\n    fillColor(color) {\n        this._context.fillStyle = color;\n        this._context.fillRect(0, 0, this._canvas.width, this._canvas.height);\n    }\n    /**\n     * Sets RGBA pixel data.\n     * @public\n     * @param {Array.<number>} data - Array RGBA data.\n     */\n    setData(data) {\n        let imageData = this._context.createImageData(this._canvas.width, this._canvas.height);\n        imageData.data.set(data);\n        this._context.putImageData(imageData, 0, 0);\n    }\n    /**\n     * Resize canvas.\n     * @public\n     * @param {number} width - Width.\n     * @param {number} height - Height.\n     */\n    resize(width, height) {\n        this._canvas.width = width;\n        this._canvas.height = height;\n        this._context = this._canvas.getContext(\"2d\");\n    }\n    /**\n     * Draw an image on the canvas.\n     * @public\n     * @param {Image} img - Draw image.\n     * @param {number} [x] - Left top image corner X coordinate on the canvas.\n     * @param {number} [y] - Left top image corner Y coordinate on the canvas.\n     * @param {number} [width] - Image width slice. Image width is default.\n     * @param {number} [height] - Image height slice. Image height is default.\n     */\n    drawImage(img, x, y, width, height) {\n        this._context.drawImage(img, x || 0, y || 0, width || img.width, height || img.height);\n    }\n    /**\n     * Converts canvas to JS image object.\n     * @public\n     * @returns {Image}\n     */\n    getImage() {\n        let img = new Image();\n        img.width = this.getWidth();\n        img.height = this.getHeight();\n        img.src = this._canvas.toDataURL(\"image/png\");\n        return img;\n    }\n    /**\n     * Get measured text width.\n     * @public\n     * @param {string} text - Measured text.\n     * @returns {number}\n     */\n    getTextWidth(text) {\n        let metrics = this._context.measureText(text);\n        return Math.round(metrics.width);\n    }\n    /**\n     * Draw a text on the canvas.\n     * @public\n     * @param {string} text - Text.\n     * @param {number} [x] - Canvas X - coordinate. 0 - default.\n     * @param {number} [y] - Canvas Y - coordinate. 0 - default.\n     * @param {string} [font] - Font style. 'normal 14px Verdana' - is default.\n     * @param {string} [color] - Css font color.\n     */\n    drawText(text, x = 0, y = 14, font = \"normal 14px Verdana\", color = \"black\") {\n        this._context.fillStyle = color;\n        this._context.font = font;\n        this._context.fillText(text, x, y);\n    }\n    /**\n     * Gets canvas width.\n     * @public\n     * @returns {number}\n     */\n    getWidth() {\n        return this._canvas.width;\n    }\n    /**\n     * Gets canvas height.\n     * @public\n     * @returns {number}\n     */\n    getHeight() {\n        return this._canvas.height;\n    }\n    /**\n     * Load image to canvas.\n     * @public\n     * @param {string} url - Image url.\n     * @param {Function} [callback] - Image onload callback.\n     */\n    load(url, callback) {\n        let img = new Image();\n        let that = this;\n        img.onload = function () {\n            that.resize(img.width, img.height);\n            that._context.drawImage(img, 0, 0, img.width, img.height);\n            callback && callback(img);\n        };\n        img.src = url;\n    }\n    /**\n     * Open canvas image in the new window.\n     * @public\n     */\n    openImage() {\n        let img = this.getImage();\n        let dataUrl = img.src;\n        let windowContent = \"<!DOCTYPE html>\";\n        windowContent += \"<html>\";\n        windowContent += \"<head><title>Print</title></head>\";\n        windowContent += \"<body>\";\n        windowContent += '<img src=\"' + dataUrl + '\">';\n        windowContent += \"</body>\";\n        windowContent += \"</html>\";\n        let printWin = window.open(\"\", \"\", \"width=\" + img.width + \"px ,height=\" + img.height + \"px\");\n        if (printWin) {\n            printWin.document.open();\n            printWin.document.write(windowContent);\n            printWin.document.close();\n            printWin.focus();\n        }\n    }\n    destroy() {\n        this._canvas.width = 1;\n        this._canvas.height = 1;\n        //@ts-ignore\n        this._canvas = null;\n        //@ts-ignore\n        this._context = null;\n    }\n}\nexport { ImageCanvas };\n//# sourceMappingURL=ImageCanvas.js.map","import { BaseFramebuffer } from \"./BaseFramebuffer\";\nimport { ImageCanvas } from \"../ImageCanvas\";\n/**\n * Class represents framebuffer.\n * @class\n * @param {Handler} handler - WebGL handler.\n * @param {IFrameBufferParams} [options] - Framebuffer options:\n */\nexport class Framebuffer extends BaseFramebuffer {\n    constructor(handler, options = {}) {\n        super(handler, options);\n        this._isBare = options.isBare || false;\n        this._internalFormatArr = options.internalFormat instanceof Array ? options.internalFormat : [options.internalFormat || \"RGBA\"];\n        this._formatArr = options.format instanceof Array ? options.format : [options.format || \"RGBA\"];\n        this._typeArr = options.type instanceof Array ? options.type : [options.type || \"UNSIGNED_BYTE\"];\n        if (options.attachment instanceof Array) {\n            this._attachmentArr = options.attachment.map((a, i) => {\n                let res = a.toUpperCase();\n                if (res === \"COLOR_ATTACHMENT\") {\n                    return `${res}${i.toString()}`;\n                }\n                return res;\n            });\n        }\n        else {\n            this._attachmentArr = [options.attachment || \"COLOR_ATTACHMENT0\"];\n        }\n        this._renderbufferTarget = options.renderbufferTarget != undefined ? options.renderbufferTarget : \"DEPTH_ATTACHMENT\";\n        this.textures = options.textures || new Array(this._size);\n    }\n    // static blit(sourceFramebuffer: Framebuffer, destFramebuffer: Framebuffer, glAttachment: number, glMask: number, glFilter: number) {\n    //     let gl = sourceFramebuffer.handler.gl!;\n    //\n    //     gl.bindFramebuffer(gl.READ_FRAMEBUFFER, sourceFramebuffer._fbo);\n    //     gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, destFramebuffer._fbo);\n    //     gl.readBuffer(glAttachment);\n    //\n    //     gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 0.0, 1.0]);\n    //\n    //     gl.blitFramebuffer(0, 0, sourceFramebuffer._width, sourceFramebuffer._height, 0, 0, destFramebuffer._width, destFramebuffer._height, glMask, glFilter);\n    //\n    //     gl.bindFramebuffer(gl.FRAMEBUFFER, null!);\n    //     gl.bindFramebuffer(gl.READ_FRAMEBUFFER, null!);\n    //     gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null!);\n    // }\n    destroy() {\n        let gl = this.handler.gl;\n        if (!gl)\n            return;\n        for (let i = 0; i < this.textures.length; i++) {\n            gl.deleteTexture(this.textures[i]);\n        }\n        this.textures = new Array(this._size);\n        gl.deleteFramebuffer(this._fbo);\n        gl.deleteRenderbuffer(this._depthRenderbuffer);\n        this._depthRenderbuffer = null;\n        this._fbo = null;\n        this._active = false;\n    }\n    /**\n     * Framebuffer initialization.\n     * @public\n     * @override\n     */\n    init() {\n        let gl = this.handler.gl;\n        if (!gl)\n            return;\n        this._fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\n        if (!this._isBare) {\n            let attachmentArr = [];\n            for (let i = 0; i < this.textures.length; i++) {\n                let ti = this.textures[i] || this.handler.createEmptyTexture2DExt(this._width, this._height, this._filter, this._internalFormatArr[i], this._formatArr[i], this._typeArr[i]);\n                let att_i = gl[this._attachmentArr[i]];\n                if (ti) {\n                    this.bindOutputTexture(ti, att_i);\n                    this.textures[i] = ti;\n                }\n                if (this._attachmentArr[i] != \"DEPTH_ATTACHMENT\") {\n                    attachmentArr.push(att_i);\n                }\n            }\n            gl.drawBuffers && gl.drawBuffers(attachmentArr);\n        }\n        if (this._useDepth) {\n            this._depthRenderbuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._depthRenderbuffer);\n            gl.renderbufferStorage(gl.RENDERBUFFER, gl[this._depthComponent], this._width, this._height);\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl[this._renderbufferTarget], gl.RENDERBUFFER, this._depthRenderbuffer);\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    /**\n     * Bind buffer texture.\n     * @public\n     * @param {WebGLTexture} texture - Output texture.\n     * @param {number} [glAttachment=0] - color attachment index.\n     */\n    bindOutputTexture(texture, glAttachment) {\n        let gl = this.handler.gl;\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.framebufferTexture2D(gl.FRAMEBUFFER, glAttachment || gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, texture, 0);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n    }\n    /**\n     * Gets pixel RGBA color from framebuffer by coordinates.\n     * @public\n     * @param {Uint8Array} res - Normalized x - coordinate.\n     * @param {number} nx - Normalized x - coordinate.\n     * @param {number} ny - Normalized y - coordinate.\n     * @param {number} [w=1] - Normalized width.\n     * @param {number} [h=1] - Normalized height.\n     * @param {number} [index=0] - color attachment index.\n     */\n    readPixels(res, nx, ny, index = 0, w = 1, h = 1) {\n        let gl = this.handler.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\n        gl.readBuffer && gl.readBuffer(gl.COLOR_ATTACHMENT0 + index || 0);\n        gl.readPixels(nx * this._width, ny * this._height, w, h, gl.RGBA, gl[this._typeArr[index]], res);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    /**\n     * Reads all pixels(RGBA colors) from framebuffer.\n     * @public\n     * @param {Uint8Array} res - Result array.\n     * @param {number} [attachmentIndex=0] - color attachment index.\n     */\n    readAllPixels(res, attachmentIndex = 0) {\n        let gl = this.handler.gl;\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\n        gl.readBuffer && gl.readBuffer(gl.COLOR_ATTACHMENT0 + attachmentIndex);\n        gl.readPixels(0, 0, this._width, this._height, gl.RGBA, gl[this._typeArr[attachmentIndex]], res);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    /**\n     * Gets JavaScript image that in the framebuffer.\n     * @public\n     * @returns {HTMLImageElement} -\n     */\n    getImage() {\n        let data = new Uint8Array(4 * this._width * this._height);\n        this.readAllPixels(data);\n        let imageCanvas = new ImageCanvas(this._width, this._height);\n        imageCanvas.setData(data);\n        return imageCanvas.getImage();\n    }\n}\n//# sourceMappingURL=Framebuffer.js.map","import * as atmos from \"../shaders/atmos\";\nimport { Framebuffer } from \"../webgl/Framebuffer\";\nimport { Program } from '../webgl/Program';\nimport { Control } from \"./Control\";\nexport class Atmosphere extends Control {\n    constructor(options = {}) {\n        super({\n            name: \"Atmosphere\",\n            ...options\n        });\n        this._transmittanceBuffer = null;\n        this._scatteringBuffer = null;\n        this.opacity = 1.0;\n    }\n    oninit() {\n        if (this.renderer) {\n            this.renderer.handler.addProgram(atmos.transmittance(), true);\n            this.renderer.handler.addProgram(atmos.scattering(), true);\n            this.renderer.handler.addProgram(atmosphereBackgroundShader(), true);\n            this._drawAtmosphereTextures();\n            this.activate();\n        }\n    }\n    onactivate() {\n        super.onactivate();\n        this.planet && this.planet.events.on(\"draw\", this._drawBackground, this);\n    }\n    ondeactivate() {\n        super.ondeactivate();\n        this.planet && this.planet.events.off(\"draw\", this._drawBackground);\n    }\n    _drawAtmosphereTextures() {\n        let width = 1024, height = 1024;\n        this._transmittanceBuffer = new Framebuffer(this.renderer.handler, {\n            width: width,\n            height: height,\n            useDepth: false,\n            filter: \"LINEAR\",\n            type: \"FLOAT\",\n            internalFormat: \"RGBA16F\"\n        });\n        this._transmittanceBuffer.init();\n        this._scatteringBuffer = new Framebuffer(this.renderer.handler, {\n            width: width,\n            height: height,\n            useDepth: false,\n            filter: \"LINEAR\",\n            type: \"FLOAT\",\n            internalFormat: \"RGBA16F\"\n        });\n        this._scatteringBuffer.init();\n        let positionBuffer = this.renderer.screenFramePositionBuffer;\n        let h = this.renderer.handler;\n        let gl = h.gl;\n        //\n        // Draw transmittance texture\n        //\n        this._transmittanceBuffer.activate();\n        let p = h.programs.transmittance;\n        let sha = p._program.attributes;\n        let shu = p._program.uniforms;\n        p.activate();\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        gl.uniform2fv(shu.iResolution, [this._transmittanceBuffer.width, this._transmittanceBuffer.height]);\n        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n        gl.vertexAttribPointer(sha.a_position, positionBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, positionBuffer.numItems);\n        this._transmittanceBuffer.deactivate();\n        //\n        // Draw scattering texture\n        //\n        this._scatteringBuffer.activate();\n        p = h.programs.scattering;\n        sha = p._program.attributes;\n        shu = p._program.uniforms;\n        p.activate();\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        gl.uniform2fv(shu.iResolution, [this._scatteringBuffer.width, this._scatteringBuffer.height]);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._transmittanceBuffer.textures[0]);\n        gl.uniform1i(shu.transmittanceTexture, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);\n        gl.vertexAttribPointer(sha.a_position, positionBuffer.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, positionBuffer.numItems);\n        this._scatteringBuffer.deactivate();\n        //\n        // remove shaders\n        if (this._scatteringBuffer.isComplete()) {\n            h.removeProgram(\"scattering\");\n        }\n        if (this._transmittanceBuffer.isComplete()) {\n            h.removeProgram(\"transmittance\");\n        }\n    }\n    _drawBackground() {\n        let h = this.renderer.handler;\n        let sh = h.programs.atmosphereBackground, p = sh._program, shu = p.uniforms, gl = h.gl;\n        let r = this.renderer;\n        let cam = this.planet.camera;\n        gl.disable(gl.DEPTH_TEST);\n        sh.activate();\n        gl.bindBuffer(gl.ARRAY_BUFFER, r.screenFramePositionBuffer);\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this._transmittanceBuffer.textures[0]);\n        gl.uniform1i(shu.transmittanceTexture, 0);\n        gl.activeTexture(gl.TEXTURE1);\n        gl.bindTexture(gl.TEXTURE_2D, this._scatteringBuffer.textures[0]);\n        gl.uniform1i(shu.scatteringTexture, 1);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n        let sunPos = this.planet.sunPos;\n        gl.uniform3fv(shu.sunPos, [sunPos.x, sunPos.y, sunPos.z]);\n        gl.uniform3fv(shu.camPos, [cam.eye.x, cam.eye.y, cam.eye.z]);\n        gl.uniform2fv(shu.iResolution, [r.sceneFramebuffer.width, r.sceneFramebuffer.height]);\n        gl.uniform1f(shu.fov, cam.getViewAngle());\n        gl.uniform1f(shu.opacity, this.opacity);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        gl.enable(gl.DEPTH_TEST);\n    }\n}\nfunction atmosphereBackgroundShader() {\n    return new Program(\"atmosphereBackground\", {\n        uniforms: {\n            iResolution: \"vec2\",\n            fov: \"float\",\n            camPos: \"vec3\",\n            viewMatrix: \"mat4\",\n            transmittanceTexture: \"sampler2D\",\n            scatteringTexture: \"sampler2D\",\n            sunPos: \"vec3\",\n            opacity: \"float\"\n        },\n        attributes: {\n            corners: \"vec3\"\n        },\n        vertexShader: `            \n            attribute vec2 corners;\n            \n            void main(void) {\n                gl_Position = vec4(corners, 0.0, 1.0);\n            }`,\n        fragmentShader: `                                   \n            precision lowp float;\n            \n            ${atmos.COMMON}\n            \n            uniform mat4 viewMatrix;\n            uniform vec3 sunPos;\n            uniform vec3 camPos;     \n            uniform vec2 iResolution;\n            uniform float fov;\n            uniform float opacity;\n                       \n            uniform sampler2D transmittanceTexture;\n            uniform sampler2D scatteringTexture;\n                                                           \n            vec3 transmittanceFromTexture(float height, float angle) \n            {\n                float u = (angle + 1.0) * 0.5;\n                float v = height / ATMOS_HEIGHT;\n                return texture2D(transmittanceTexture, vec2(u, v)).xyz;\n            }\n            \n            vec3 multipleScatteringContributionFromTexture(float height, float angle) \n            {\n                float u = (angle + 1.0) * 0.5;\n                float v = height / ATMOS_HEIGHT;\n                return texture2D(scatteringTexture, vec2(u, v)).xyz; \n            }\n\n            bool intersectEllipsoidToSphere(in vec3 ro, in vec3 rd, in vec3 ellRadii, in float sphereRadius, out float t1, out float t2) \n            {\n                float offset = 0.0,\n                      distanceToSpace = 0.0;\n                                                        \n                if(intersectEllipsoid(ro, rd, ellRadii, offset, distanceToSpace)){\n                    vec3 hitEll = ro + rd * offset;\n                    vec3 nEll = normalEllipsoid(hitEll, ellRadii);\n                    float t = 0.0;\n                    bool intersectsSphere = intersectSphere(hitEll, nEll, sphereRadius, t);\n                    vec3 hitSphere = hitEll + nEll * t;\n                    t1 = length(hitSphere - ro);\n                    \n                    hitEll = ro + rd * distanceToSpace;\n                    nEll = normalEllipsoid(hitEll, ellRadii);\n                    t = 0.0;\n                    intersectsSphere = intersectSphere(hitEll, nEll, sphereRadius, t);\n                    hitSphere = hitEll + nEll * t;\n                    t2 = length(hitSphere - ro);\n                    \n                    return true; \n                }\n                return false; \n            }\n            \n            mat4 transpose(in mat4 m) \n            {\n                vec4 i0 = m[0];\n                vec4 i1 = m[1];\n                vec4 i2 = m[2];\n                vec4 i3 = m[3];\n            \n                mat4 outMatrix = mat4(\n                     vec4(i0.x, i1.x, i2.x, i3.x),\n                     vec4(i0.y, i1.y, i2.y, i3.y),\n                     vec4(i0.z, i1.z, i2.z, i3.z),\n                     vec4(i0.w, i1.w, i2.w, i3.w)\n                     );\n                                 \n                return outMatrix;\n            }\n                                                                     \n            void mainImage(out vec4 fragColor) \n            {            \n                vec3 cameraPosition = camPos;\n                \n                vec3 lightDirection = normalize(sunPos);               \n                             \n                vec2 uv = (2.0 * gl_FragCoord.xy - iResolution.xy) / iResolution.y;\n                float fieldOfView = fov;\n                float z = 1.0 / tan(fieldOfView * 0.5 * PI / 180.0);\n                vec3 rayDirection = normalize(vec3(uv, -z));\n                vec4 rd = transpose(viewMatrix) * vec4(rayDirection, 1.0);\n                rayDirection = rd.xyz;               \n                                          \n                vec3 light = vec3(0.0);\n                vec3 transmittanceFromCameraToSpace = vec3(1.0);\n                float offset = 0.0;\n                float distanceToSpace = 0.0;\n                                                \n                rayDirection = normalize(rayDirection * SPHERE_TO_ELLIPSOID_SCALE);\n                cameraPosition *= SPHERE_TO_ELLIPSOID_SCALE;\n                lightDirection = normalize(lightDirection * SPHERE_TO_ELLIPSOID_SCALE);\n                                                \n                if (intersectSphere(cameraPosition, rayDirection, TOP_RADIUS, offset, distanceToSpace)) \n                {    \n                    vec3 rayOrigin = cameraPosition;\n                    \n                    // above atmosphere                    \n                    if (offset > 0.0) {\n                        // intersection of camera ray with atmosphere\n                        rayOrigin = cameraPosition + rayDirection * offset;\n                    }                   \n                    \n                    float height = length(rayOrigin) - BOTTOM_RADIUS;\n                    float rayAngle = dot(rayOrigin, rayDirection) / length(rayOrigin);\n                    bool cameraBelow = rayAngle < 0.0;\n                    \n                    transmittanceFromCameraToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                    \n                    float phaseAngle = dot(lightDirection, rayDirection);\n                    float rayleighPhase = rayleighPhase(phaseAngle);\n                    float miePhase = miePhase(phaseAngle);\n                    \n                    float distanceToGround = 0.0;\n                    \n                    bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\n                    \n                    if(intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS - 15000.0, distanceToGround) && hitGround)\n                    {\n                        discard;\n                    }\n                    \n                    float segmentLength = ((hitGround ? distanceToGround : distanceToSpace) - max(offset, 0.0)) / float(SAMPLE_COUNT);\n                                                                    \n                    float t = segmentLength * 0.5;\n                    \n                    vec3 transmittanceCamera; \n                    vec3 transmittanceLight; \n            \n                    for (int i = 0; i < SAMPLE_COUNT; i++) \n                    {\n                        vec3 position = rayOrigin + t * rayDirection;\n                        float height = length(position) - BOTTOM_RADIUS; \n                        vec3 up = position / length(position);\n                        float rayAngle = dot(up, rayDirection);\n                        float lightAngle = dot(up, lightDirection);\n                        vec3 transmittanceToSpace = transmittanceFromTexture(height, cameraBelow ? -rayAngle : rayAngle);\n                        transmittanceCamera = cameraBelow ? (transmittanceToSpace / transmittanceFromCameraToSpace) : (transmittanceFromCameraToSpace / transmittanceToSpace);\n                        transmittanceLight = transmittanceFromTexture(height, lightAngle);\n                        vec2 opticalDensity = exp(-height / rayleighMieHeights);\n                        vec3 scatteredLight = transmittanceLight * (rayleighScatteringCoefficient * opticalDensity.x * rayleighPhase + mieScatteringCoefficient * opticalDensity.y * miePhase);\n                        scatteredLight += multipleScatteringContributionFromTexture(height, lightAngle) * (rayleighScatteringCoefficient * opticalDensity.x + mieScatteringCoefficient * opticalDensity.y);  \n                        light += transmittanceCamera * scatteredLight * segmentLength;\n                        t += segmentLength;\n                    }\n                    \n                    light *= SUN_INTENSITY;\n            \n                    if (hitGround) \n                    {\n                        vec3 hitPoint = cameraPosition + rayDirection * distanceToGround;\n                        vec3 up = hitPoint / length(hitPoint);\n                        float diffuseAngle = max(dot(up, lightDirection), 0.0);\n                        float lightAngle = dot(up, lightDirection);\n                        light += transmittanceCamera * GROUND_ALBEDO * multipleScatteringContributionFromTexture(height, lightAngle) * SUN_INTENSITY;\n                        light += transmittanceCamera * transmittanceLight * GROUND_ALBEDO * diffuseAngle * SUN_INTENSITY;\n                    }\n                }\n                                     \n                // sun disk\n                // float distanceToGround;\n                // bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\n                // if (!hitGround) {\n                //    float angle = dot(rayDirection, lightDirection);\n                //    if (angle > cos(SUN_ANGULAR_RADIUS)) {\n                //       light = SUN_INTENSITY * transmittanceFromCameraToSpace;\n                //    }\n                // }\n                \n                float distanceToGround = 0.0;\n                bool hitGround = intersectSphere(cameraPosition, rayDirection, BOTTOM_RADIUS, distanceToGround) && distanceToGround > 0.0;\n                if(!hitGround)\n                {\n                    vec3 sunLum = sunWithBloom(rayDirection, lightDirection) * vec3(1.0,1.0,0.8);\n                    // limit the bloom effect\n                    sunLum = smoothstep(0.002, 1.0, sunLum);\n                    light += sunLum * SUN_INTENSITY * transmittanceFromCameraToSpace;\n                }\n                            \n                fragColor = vec4(pow(light * 8.0, vec3(1.0 / 2.2)), clamp(opacity, 0.0, 1.0));           \n            }\n                                    \n            void main(void) \n            {                            \n                mainImage(gl_FragColor);            \n            }`\n    });\n}\n//# sourceMappingURL=Atmosphere.js.map","/**\n * Projection units: 'degrees', 'ft', 'm' or 'km'.\n * @enum {string}\n * @api\n */\nexport const Units = {\n    DEGREES: \"degrees\",\n    FEET: \"ft\",\n    METERS: \"m\",\n    KILOMETERS: \"km\"\n};\n/**\n * Meters per unit lookup table.\n * @const\n * @type {Record<string, number>}\n */\nexport const METERS_PER_UNIT = {};\nMETERS_PER_UNIT[Units.FEET] = 0.3048;\nMETERS_PER_UNIT[Units.METERS] = 1;\nMETERS_PER_UNIT[Units.KILOMETERS] = 1000;\nlet _counter = 0;\nclass Proj {\n    constructor(options) {\n        this.id = _counter++;\n        this.code = options.code;\n        this.units = options.units;\n    }\n    /**\n     * Compare projections.\n     * @public\n     * @param {Proj} proj - Projection object.\n     * @returns {boolean}\n     */\n    equal(proj) {\n        return proj.id === this.id;\n    }\n}\nexport { Proj };\n//# sourceMappingURL=Proj.js.map","/**\n * @module og/proj/EPSG3857\n */\nimport { Proj, Units } from \"./Proj\";\n/**\n * EPSG:3857 projection object.\n * @type {Proj}\n */\nexport const EPSG3857 = new Proj({ code: \"epsg:3857\", units: Units.METERS });\n//# sourceMappingURL=EPSG3857.js.map","/**\n * @module og/proj/EPSG4326\n */\nimport { Proj, Units } from \"./Proj\";\n/**\n * EPSG:4326 projection object.\n * @type {Proj}\n */\nexport const EPSG4326 = new Proj({ code: \"epsg:4326\", units: Units.DEGREES });\n//# sourceMappingURL=EPSG4326.js.map","class Slice {\n    constructor(segment) {\n        this.segment = segment;\n        this.layers = [];\n        this.tileOffsetArr = new Float32Array(segment.planet.SLICE_SIZE_4);\n        this.layerOpacityArr = new Float32Array(segment.planet.SLICE_SIZE);\n    }\n    clear() {\n        // @ts-ignore\n        this.layers = null;\n        // @ts-ignore\n        this.tileOffsetArr = null;\n        // @ts-ignore\n        this.layerOpacityArr = null;\n    }\n    append(layer, material) {\n        let n = this.layers.length;\n        this.layers.push(layer);\n        this.layerOpacityArr[n] = layer.screenOpacity;\n        let n4 = n * 4;\n        let arr = layer.applyMaterial(material);\n        this.tileOffsetArr[n4] = arr[0];\n        this.tileOffsetArr[n4 + 1] = arr[1];\n        this.tileOffsetArr[n4 + 2] = arr[2];\n        this.tileOffsetArr[n4 + 3] = arr[3];\n        //arr = this.segment._getLayerExtentOffset(layer);\n        //slice.visibleExtentOffsetArr[n4] = arr[0];\n        //slice.visibleExtentOffsetArr[n4 + 1] = arr[1];\n        //slice.visibleExtentOffsetArr[n4 + 2] = arr[2];\n        //slice.visibleExtentOffsetArr[n4 + 3] = arr[3];\n    }\n}\nexport { Slice };\n//# sourceMappingURL=Slice.js.map","import * as mercator from \"../mercator\";\nimport * as segmentHelper from \"../segment/segmentHelper\";\nimport { Box } from \"../bv/Box\";\nimport { Extent } from \"../Extent\";\nimport { EPSG3857 } from \"../proj/EPSG3857\";\nimport { E, N, NOTRENDERING, OPSIDE, S, W } from \"../quadTree/quadTree\";\nimport { getMatrixSubArray64 } from \"../utils/shared\";\nimport { Layer } from \"../layer/Layer\";\nimport { LonLat } from \"../LonLat\";\nimport { Sphere } from \"../bv/Sphere\";\nimport { Slice } from \"./Slice\";\nimport { Ray } from \"../math/Ray\";\nimport { Vec3 } from \"../math/Vec3\";\nexport const TILEGROUP_COMMON = 0;\nexport const TILEGROUP_NORTH = 1;\nexport const TILEGROUP_SOUTH = 2;\nlet _tempHigh = new Vec3();\nlet _tempLow = new Vec3();\nlet _v0 = new Vec3(), _v1 = new Vec3(), _v2 = new Vec3(), _v3 = new Vec3();\nlet _ray = new Ray(), _rayEx = new Ray();\nconst _S = new Array(4);\n_S[N] = 0;\n_S[E] = 1;\n_S[S] = 1;\n_S[W] = 0;\nconst _V = new Array(4);\n_V[N] = false;\n_V[E] = true;\n_V[S] = false;\n_V[W] = true;\n/**\n * Planet segment Web Mercator tile class that stored and rendered with a quad-tree.\n * @class\n * @param {Node} node - Segment node.\n * @param {Planet} planet - Planet scene.\n * @param {number} tileZoom - Zoom index.\n * @param {Extent} extent - Segment extent.\n */\nclass Segment {\n    constructor(node, planet, tileZoom, extent) {\n        this.isPole = false;\n        this._tileGroup = TILEGROUP_COMMON;\n        this._projection = EPSG3857;\n        this.node = node;\n        this.planet = planet;\n        this.handler = planet.renderer.handler;\n        this.bsphere = new Sphere();\n        this._plainRadius = 0;\n        this.bbox = new Box();\n        this._sw = new Vec3();\n        this._nw = new Vec3();\n        this._se = new Vec3();\n        this._ne = new Vec3();\n        this.centerNormal = new Vec3();\n        this._extent = this._extentMerc = extent;\n        this._extentLonLat = new Extent();\n        this.gridSize = planet.terrain.gridSizeByZoom[tileZoom];\n        this.fileGridSize = 0;\n        this.tileZoom = tileZoom;\n        this.tileX = 0;\n        this.tileXE = 0;\n        this.tileXW = 0;\n        this.tileYN = 0;\n        this.tileYS = 0;\n        this.tileY = 0;\n        this.tileIndex = \"\";\n        this._assignTileIndexes();\n        /**\n         * @toso: Check it should be Map<number, Material> instead of array\n         */\n        this.materials = [];\n        this.plainReady = false;\n        this.initialized = false;\n        this.normalMapReady = false;\n        this.terrainReady = false;\n        this.terrainIsLoading = false;\n        this.terrainExists = false;\n        this.passReady = false;\n        this.plainVertices = null;\n        this.plainVerticesHigh = null;\n        this.plainVerticesLow = null;\n        this.plainNormals = null;\n        this.terrainVertices = null;\n        this.terrainVerticesHigh = null;\n        this.terrainVerticesLow = null;\n        this.noDataVertices = null;\n        this.tempVertices = null;\n        this.tempVerticesHigh = null;\n        this.tempVerticesLow = null;\n        this.normalMapTexture = null;\n        this.normalMapTextureBias = new Float32Array(3);\n        this.normalMapVertices = null;\n        this.normalMapVerticesHigh = null;\n        this.normalMapVerticesLow = null;\n        this.normalMapNormals = null;\n        this.vertexNormalBuffer = null;\n        this.vertexPositionBuffer = null;\n        this.vertexPositionBufferHigh = null;\n        this.vertexPositionBufferLow = null;\n        this.vertexTextureCoordBuffer = null;\n        this._globalTextureCoordinates = new Float32Array(4);\n        this._inTheQueue = false;\n        this._appliedNeighborsZoom = [0, 0, 0, 0];\n        this._slices = [];\n        this._indexBuffer = null;\n        this.readyToEngage = false;\n        this.plainProcessing = false;\n        this.normalMapTexturePtr = null;\n        this._transitionOpacity = 1.0;\n        this._transitionTimestamp = 0;\n    }\n    checkZoom() {\n        return this.tileZoom < this.planet.terrain._maxNodeZoom;\n    }\n    /**\n     * Returns entity terrain point.\n     * @public\n     * @param {Entity} entity - Entity.\n     * @param {Vec3} res - Point coordinates.\n     * @returns {Vec3} -\n     */\n    getEntityTerrainPoint(entity, res) {\n        return this.getTerrainPoint(entity._cartesian, this.getInsideLonLat(entity), res);\n    }\n    getInsideLonLat(obj) {\n        return obj._lonLatMerc;\n    }\n    isEntityInside(entity) {\n        return this._extentLonLat.isInside(entity._lonLat);\n    }\n    /**\n     * Returns distance from object to terrain coordinates and terrain point that calculates out in the res parameter.\n     * @public\n     * @param {Vec3} xyz - Cartesian object position.\n     * @param {LonLat} insideSegmentPosition - Geodetic object position.\n     * @param {Vec3} [res] - Result cartesian coordinates on the terrain.\n     * @returns {number} -\n     */\n    getTerrainPoint(xyz, insideSegmentPosition, res) {\n        let verts = this.tempVertices;\n        if (verts && verts.length) {\n            let norm = this.planet.ellipsoid.getSurfaceNormal3v(xyz);\n            _ray.set(xyz, norm.negateTo());\n            let ne = this._extent.northEast, sw = this._extent.southWest, size = Math.sqrt(verts.length / 3) - 1;\n            let xmax = ne.lon, ymax = ne.lat, xmin = sw.lon, ymin = sw.lat, x = insideSegmentPosition.lon, y = insideSegmentPosition.lat;\n            let sxn = xmax - xmin, syn = ymax - ymin;\n            let qx = sxn / size, qy = syn / size;\n            let xn = x - xmin, yn = y - ymin;\n            let indX = Math.floor(xn / qx), indY = Math.floor(size - yn / qy);\n            let ind_v0 = ((size + 1) * indY + indX) * 3;\n            let ind_v2 = ((size + 1) * (indY + 1) + indX) * 3;\n            _v0.set(verts[ind_v0], verts[ind_v0 + 1], verts[ind_v0 + 2]);\n            _v1.set(verts[ind_v0 + 3], verts[ind_v0 + 4], verts[ind_v0 + 5]);\n            _v2.set(verts[ind_v2], verts[ind_v2 + 1], verts[ind_v2 + 2]);\n            let d = _ray.hitTriangle(_v0, _v1, _v2, res);\n            if (d === Ray.INSIDE) {\n                return xyz.distance(res);\n            }\n            else if (d === Ray.AWAY) {\n                _rayEx.set(xyz, norm);\n                let d = _rayEx.hitTriangle(_v0, _v1, _v2, res);\n                if (d === Ray.INSIDE) {\n                    return -xyz.distance(res);\n                }\n            }\n            _v3.set(verts[ind_v2 + 3], verts[ind_v2 + 4], verts[ind_v2 + 5]);\n            d = _ray.hitTriangle(_v1, _v3, _v2, res);\n            if (d === Ray.INSIDE) {\n                return xyz.distance(res);\n            }\n            else if (d === Ray.AWAY) {\n                _rayEx.set(xyz, norm);\n                let d = _rayEx.hitTriangle(_v1, _v3, _v2, res);\n                if (d === Ray.INSIDE) {\n                    return -xyz.distance(res);\n                }\n            }\n            if (d === Ray.AWAY) {\n                return -xyz.distance(res);\n            }\n            return xyz.distance(res);\n        }\n        else {\n            return xyz.distance(this.planet.ellipsoid.hitRay(_ray.origin, _ray.direction));\n        }\n    }\n    /**\n     * Project wgs86 to segment native projection.\n     * @public\n     * @param {LonLat} lonlat - Coordinates to project.\n     * @returns {LonLat} -\n     */\n    projectNative(lonlat) {\n        return lonlat.forwardMercator();\n    }\n    loadTerrain(forceLoading = false) {\n        if (this.tileZoom < this.planet.terrain.minZoom || this.planet.terrain.isEmpty) {\n            this.terrainIsLoading = true;\n            this.elevationsNotExists();\n            if (!this._inTheQueue) {\n                this.planet._normalMapCreator.queue(this);\n            }\n        }\n        else {\n            if (this.tileZoom > this.planet.terrain.maxZoom) {\n                this.elevationsNotExists();\n            }\n            else if (!this.terrainIsLoading && !this.terrainReady) {\n                this.planet.terrain.loadTerrain(this, forceLoading);\n            }\n            // if (!this.terrainIsLoading && !this.terrainReady) {\n            //     this.planet.terrain.loadTerrain(this, forceLoading);\n            // }\n        }\n    }\n    /**\n     * Terrain obtained from server.\n     * @param {Float32Array} elevations - Elevation data.\n     */\n    elevationsExists(elevations) {\n        if (this.plainReady && this.terrainIsLoading) {\n            let _elevations = new Float32Array(elevations.length);\n            _elevations.set(elevations);\n            this.planet._terrainWorker.make({ segment: this, elevations: _elevations });\n            this.plainVerticesHigh = null;\n            this.plainVerticesLow = null;\n            this.normalMapVerticesHigh = null;\n            this.normalMapVerticesLow = null;\n            if (!this.planet.terrain.equalizeVertices) {\n                this.tempVerticesHigh = null;\n                this.tempVerticesLow = null;\n            }\n        }\n    }\n    /**\n     * Keep plain elevation segment for rendering\n     *\n     * 'this.tileZoom <= this.planet.terrain.maxZoom' it means, that the segment is plain\n     *\n     */\n    elevationsNotExists() {\n        if (this.planet && this.tileZoom <= this.planet.terrain.maxNativeZoom) {\n            if (this.plainReady && this.terrainIsLoading) {\n                this.terrainIsLoading = false;\n                let n = this.node;\n                n.appliedTerrainNodeId = this.node.nodeId;\n                n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\n                    n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\n                if (this.planet.lightEnabled && !this._inTheQueue) {\n                    this.planet._normalMapCreator.queue(this);\n                }\n                this.readyToEngage = true;\n            }\n            // plain terrain only\n            this.terrainVertices = this.plainVertices;\n            this.terrainVerticesHigh = this.plainVerticesHigh;\n            this.terrainVerticesLow = this.plainVerticesLow;\n            this.tempVertices = this.terrainVertices;\n            this.tempVerticesHigh = this.terrainVerticesHigh;\n            this.tempVerticesLow = this.terrainVerticesLow;\n            this.noDataVertices = null;\n            this.fileGridSize = Math.sqrt(this.terrainVertices.length / 3) - 1;\n            this.gridSize = this.fileGridSize;\n            this.terrainReady = true;\n            this.terrainExists = false;\n        }\n        else {\n            if (this.plainReady && this.terrainIsLoading) {\n                this.terrainIsLoading = false;\n                let n = this.node;\n                n.appliedTerrainNodeId = this.node.nodeId;\n                n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\n                    n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\n                this.readyToEngage = true;\n                this.terrainReady = true;\n                this.passReady = true;\n                this.terrainExists = false;\n            }\n        }\n    }\n    _checkEqualization(neighborSide, neigborNode) {\n        return neigborNode && neigborNode.segment && this.tileZoom >= neigborNode.segment.tileZoom &&\n            this.node.equalizedSideWithNodeId[neighborSide] !== neigborNode.equalizedSideWithNodeId[OPSIDE[neighborSide]];\n    }\n    equalize() {\n        if (this.tileZoom < 8 || this.gridSize < 2) {\n            return;\n        }\n        this.readyToEngage = true;\n        let nn = this.node.neighbors;\n        let v = this.tempVertices, vHigh = this.tempVerticesHigh, vLow = this.tempVerticesLow;\n        let gs = this.gridSize, gsOne = gs + 1;\n        let n = nn[N][0];\n        if (this._checkEqualization(N, n)) {\n            this.node.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[S];\n            this.readyToEngage = true;\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, N);\n            let nv = n.segment.tempVertices, nvHigh = n.segment.tempVerticesHigh, nvLow = n.segment.tempVerticesLow;\n            let n_gs = n.segment.gridSize, n_gsOne = n_gs + 1;\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\n            let inc = Math.max(gs / (n_gs * dz), 1), n_inc = Math.max((n_gs * dz) / gs, 1), n_offset = offset * n_gs;\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\n                const index = k * 3;\n                const n_index = (n_gsOne * n_gs + nk) * 3;\n                v[index] = nv[n_index];\n                v[index + 1] = nv[n_index + 1];\n                v[index + 2] = nv[n_index + 2];\n                vHigh[index] = nvHigh[n_index];\n                vHigh[index + 1] = nvHigh[n_index + 1];\n                vHigh[index + 2] = nvHigh[n_index + 2];\n                vLow[index] = nvLow[n_index];\n                vLow[index + 1] = nvLow[n_index + 1];\n                vLow[index + 2] = nvLow[n_index + 2];\n            }\n        }\n        n = nn[E][0];\n        if (this._checkEqualization(E, n)) {\n            this.node.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[W];\n            this.readyToEngage = true;\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, E);\n            let nv = n.segment.tempVertices, nvHigh = n.segment.tempVerticesHigh, nvLow = n.segment.tempVerticesLow;\n            let n_gs = n.segment.gridSize, n_gsOne = n_gs + 1;\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\n            let inc = Math.max(gs / (n_gs * dz), 1), n_inc = Math.max((n_gs * dz) / gs, 1), n_offset = offset * n_gs;\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\n                const index = (gsOne * k + gs) * 3;\n                const n_index = n_gsOne * nk * 3;\n                v[index] = nv[n_index];\n                v[index + 1] = nv[n_index + 1];\n                v[index + 2] = nv[n_index + 2];\n                vHigh[index] = nvHigh[n_index];\n                vHigh[index + 1] = nvHigh[n_index + 1];\n                vHigh[index + 2] = nvHigh[n_index + 2];\n                vLow[index] = nvLow[n_index];\n                vLow[index + 1] = nvLow[n_index + 1];\n                vLow[index + 2] = nvLow[n_index + 2];\n            }\n        }\n        n = nn[S][0];\n        if (this._checkEqualization(S, n)) {\n            this.node.equalizedSideWithNodeId[S] = n.equalizedSideWithNodeId[N];\n            this.readyToEngage = true;\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, S);\n            let nv = n.segment.tempVertices, nvHigh = n.segment.tempVerticesHigh, nvLow = n.segment.tempVerticesLow;\n            let n_gs = n.segment.gridSize; // n_gsOne = n_gs + 1;\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\n            let inc = Math.max(gs / (n_gs * dz), 1), n_inc = Math.max((n_gs * dz) / gs, 1), n_offset = offset * n_gs;\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\n                const index = (gsOne * gs + k) * 3;\n                const n_index = nk * 3;\n                v[index] = nv[n_index];\n                v[index + 1] = nv[n_index + 1];\n                v[index + 2] = nv[n_index + 2];\n                vHigh[index] = nvHigh[n_index];\n                vHigh[index + 1] = nvHigh[n_index + 1];\n                vHigh[index + 2] = nvHigh[n_index + 2];\n                vLow[index] = nvLow[n_index];\n                vLow[index + 1] = nvLow[n_index + 1];\n                vLow[index + 2] = nvLow[n_index + 2];\n            }\n        }\n        n = nn[W][0];\n        if (this._checkEqualization(W, n)) {\n            this.node.equalizedSideWithNodeId[W] = n.equalizedSideWithNodeId[E];\n            this.readyToEngage = true;\n            let offset = this.node.getOffsetOppositeNeighbourSide(n, W);\n            let nv = n.segment.tempVertices, nvHigh = n.segment.tempVerticesHigh, nvLow = n.segment.tempVerticesLow;\n            let n_gs = n.segment.gridSize, n_gsOne = n_gs + 1;\n            let dz = 1 / (1 << (this.tileZoom - n.segment.tileZoom));\n            let inc = Math.max(gs / (n_gs * dz), 1), n_inc = Math.max((n_gs * dz) / gs, 1), n_offset = offset * n_gs;\n            for (let k = 0, nk = n_offset; k < gsOne; k += inc, nk += n_inc) {\n                const index = gsOne * k * 3;\n                const n_index = (n_gsOne * nk + n_gs) * 3;\n                v[index] = nv[n_index];\n                v[index + 1] = nv[n_index + 1];\n                v[index + 2] = nv[n_index + 2];\n                vHigh[index] = nvHigh[n_index];\n                vHigh[index + 1] = nvHigh[n_index + 1];\n                vHigh[index + 2] = nvHigh[n_index + 2];\n                vLow[index] = nvLow[n_index];\n                vLow[index + 1] = nvLow[n_index + 1];\n                vLow[index + 2] = nvLow[n_index + 2];\n            }\n        }\n    }\n    engage() {\n        this.readyToEngage = false;\n        this.createCoordsBuffers(this.tempVerticesHigh, this.tempVerticesLow, this.gridSize);\n    }\n    _terrainWorkerCallback(data) {\n        if (this.plainReady) {\n            this.readyToEngage = true;\n            this.normalMapNormals = null;\n            this.normalMapVertices = null;\n            this.normalMapVerticesHigh = null;\n            this.normalMapVerticesLow = null;\n            this.terrainVertices = null;\n            this.terrainVerticesHigh = null;\n            this.terrainVerticesLow = null;\n            this.noDataVertices = null;\n            this.tempVertices = null;\n            this.tempVerticesHigh = null;\n            this.tempVerticesLow = null;\n            this.normalMapNormals = data.normalMapNormals;\n            this.normalMapVertices = data.normalMapVertices;\n            this.normalMapVerticesHigh = data.normalMapVerticesHigh;\n            this.normalMapVerticesLow = data.normalMapVerticesLow;\n            this.terrainVertices = data.terrainVertices;\n            this.terrainVerticesHigh = data.terrainVerticesHigh;\n            this.terrainVerticesLow = data.terrainVerticesLow;\n            this.noDataVertices = data.noDataVertices;\n            this.tempVertices = this.terrainVertices;\n            this.tempVerticesHigh = this.terrainVerticesHigh;\n            this.tempVerticesLow = this.terrainVerticesLow;\n            this.setBoundingVolumeArr(data.bounds);\n            this.gridSize = Math.sqrt(this.terrainVertices.length / 3) - 1;\n            let n = this.node;\n            n.appliedTerrainNodeId = n.nodeId;\n            n.equalizedSideWithNodeId[N] = n.equalizedSideWithNodeId[E] = n.equalizedSideWithNodeId[S] =\n                n.equalizedSideWithNodeId[W] = n.appliedTerrainNodeId;\n            this.terrainReady = true;\n            this.terrainIsLoading = false;\n            this.terrainExists = true;\n            if (!this.normalMapTexturePtr) {\n                const nmc = this.planet._normalMapCreator;\n                this.normalMapTexturePtr = this.planet.renderer.handler.createEmptyTexture_l(nmc.width, nmc.height);\n            }\n            if (this.planet.lightEnabled) {\n                this.planet._normalMapCreator.queue(this);\n            }\n        }\n    }\n    _normalMapEdgeEqualize(side) {\n        let nn = this.node.neighbors;\n        let nns = nn[side];\n        let n = nns && nns[0];\n        let maxZ = this.planet.terrain.maxZoom;\n        if (this.tileZoom === maxZ) {\n            if (nns && !(nn[0].length || nn[1].length || nn[2].length || nn[3].length)) {\n                n = this.node.getEqualNeighbor(side);\n            }\n        }\n        let b = n && n.segment, s = this;\n        if (n &&\n            b &&\n            b.terrainReady &&\n            b.terrainExists &&\n            b.tileZoom <= maxZ &&\n            s._appliedNeighborsZoom[side] !== b.tileZoom) {\n            s._appliedNeighborsZoom[side] = b.tileZoom;\n            let seg_a = s.normalMapNormals, seg_b = b.normalMapNormals;\n            if (!(seg_a && seg_b))\n                return;\n            let seg_a_raw = s.normalMapNormals, seg_b_raw = b.normalMapNormals;\n            // let seg_a_verts = s.terrainVertices,\n            //     seg_b_verts = s.terrainVertices;\n            let s_gs = Math.sqrt(seg_a.length / 3), \n            // b_gs = Math.sqrt(seg_b.length / 3),\n            s_gs1 = s_gs - 1;\n            // b_gs1 = b_gs - 1;\n            const i_a = s_gs1 * _S[side];\n            let nx, ny, nz, q;\n            if (s.tileZoom === b.tileZoom) {\n                const i_b = s_gs1 - i_a;\n                if (_V[side]) {\n                    for (let k = 0; k < s_gs; k++) {\n                        let vInd_a = (k * s_gs + i_a) * 3, vInd_b = (k * s_gs + i_b) * 3;\n                        nx = seg_a_raw[vInd_a] + seg_b_raw[vInd_b];\n                        ny = seg_a_raw[vInd_a + 1] + seg_b_raw[vInd_b + 1];\n                        nz = seg_a_raw[vInd_a + 2] + seg_b_raw[vInd_b + 2];\n                        q = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n                        seg_b[vInd_b] = seg_a[vInd_a] = nx * q;\n                        seg_b[vInd_b + 1] = seg_a[vInd_a + 1] = ny * q;\n                        seg_b[vInd_b + 2] = seg_a[vInd_a + 2] = nz * q;\n                    }\n                }\n                else {\n                    for (let k = 0; k < s_gs; k++) {\n                        let vInd_a = (i_a * s_gs + k) * 3, vInd_b = (i_b * s_gs + k) * 3;\n                        nx = seg_a_raw[vInd_a] + seg_b_raw[vInd_b];\n                        ny = seg_a_raw[vInd_a + 1] + seg_b_raw[vInd_b + 1];\n                        nz = seg_a_raw[vInd_a + 2] + seg_b_raw[vInd_b + 2];\n                        q = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n                        seg_b[vInd_b] = seg_a[vInd_a] = nx * q;\n                        seg_b[vInd_b + 1] = seg_a[vInd_a + 1] = ny * q;\n                        seg_b[vInd_b + 2] = seg_a[vInd_a + 2] = nz * q;\n                    }\n                }\n                if (!b._inTheQueue && b._appliedNeighborsZoom[OPSIDE[side]] !== s.tileZoom) {\n                    b._appliedNeighborsZoom[OPSIDE[side]] = s.tileZoom;\n                    s.planet._normalMapCreator.queue(b);\n                }\n            }\n        }\n    }\n    applyTerrain(elevations) {\n        if (elevations) {\n            this.elevationsExists(elevations);\n        }\n        else {\n            this.elevationsNotExists();\n        }\n    }\n    deleteBuffers() {\n        const gl = this.handler.gl;\n        gl.deleteBuffer(this.vertexNormalBuffer);\n        gl.deleteBuffer(this.vertexPositionBuffer);\n        gl.deleteBuffer(this.vertexPositionBufferHigh);\n        gl.deleteBuffer(this.vertexPositionBufferLow);\n        this.vertexNormalBuffer = null;\n        this.vertexPositionBuffer = null;\n        this.vertexPositionBufferHigh = null;\n        this.vertexPositionBufferLow = null;\n        this.vertexTextureCoordBuffer = null;\n    }\n    deleteMaterials() {\n        let m = this.materials;\n        for (let i = 0; i < m.length; i++) {\n            let mi = m[i];\n            if (mi) {\n                mi.clear();\n            }\n        }\n        this.materials.length = 0;\n    }\n    deleteElevations() {\n        this.terrainExists = false;\n        this.terrainReady = false;\n        this.terrainIsLoading = false;\n        this.normalMapVertices = null;\n        this.normalMapVerticesHigh = null;\n        this.normalMapVerticesLow = null;\n        this.normalMapNormals = null;\n        this.tempVertices = null;\n        this.tempVerticesHigh = null;\n        this.tempVerticesLow = null;\n        this.terrainVertices = null;\n        this.terrainVerticesHigh = null;\n        this.terrainVerticesLow = null;\n        this.noDataVertices = null;\n        this.plainVertices = null;\n        this.plainVerticesHigh = null;\n        this.plainVerticesLow = null;\n        this.plainNormals = null;\n        if (this.normalMapReady) {\n            this.handler.gl.deleteTexture(this.normalMapTexture);\n            this.normalMapReady = false;\n        }\n        this._appliedNeighborsZoom = [0, 0, 0, 0];\n        this.normalMapTextureBias[0] = 0;\n        this.normalMapTextureBias[1] = 0;\n        this.normalMapTextureBias[2] = 1;\n        this._inTheQueue = false;\n    }\n    clearSegment() {\n        this.plainReady = false;\n        this.initialized = false;\n        this.deleteBuffers();\n        this.deleteMaterials();\n        this.deleteElevations();\n    }\n    childrenInitialized() {\n        let n = this.node.nodes;\n        return n.length === 4 && n[0].segment.initialized && n[1].segment.initialized && n[2].segment.initialized && n[3].segment.initialized;\n    }\n    destroySegment() {\n        this.clearSegment();\n        let i = this._slices.length;\n        while (i--) {\n            this._slices[i].clear();\n        }\n        //@ts-ignore\n        this._slices = null;\n        //@ts-ignore\n        this.node = null;\n        //@ts-ignore\n        this.planet = null;\n        //@ts-ignore\n        this.handler = null;\n        //@ts-ignore\n        this.bbox = null;\n        //@ts-ignore\n        this.bsphere = null;\n        //@ts-ignore\n        this._extent = null;\n        //@ts-ignore\n        this.materials = null;\n        this.plainVertices = null;\n        this.plainVerticesHigh = null;\n        this.plainVerticesLow = null;\n        this.plainNormals = null;\n        this.terrainVertices = null;\n        this.terrainVerticesHigh = null;\n        this.terrainVerticesLow = null;\n        this.noDataVertices = null;\n        this.tempVertices = null;\n        this.tempVerticesHigh = null;\n        this.tempVerticesLow = null;\n        //@ts-ignore\n        this.normalMapTextureBias = null;\n        this.normalMapTexture = null;\n        this.normalMapVertices = null;\n        this.normalMapVerticesHigh = null;\n        this.normalMapVerticesLow = null;\n        this.normalMapNormals = null;\n        this.vertexNormalBuffer = null;\n        this.vertexPositionBuffer = null;\n        this.vertexPositionBufferHigh = null;\n        this.vertexPositionBufferLow = null;\n        this.vertexTextureCoordBuffer = null;\n        // @ts-ignore\n        this._projection = null;\n        // @ts-ignore\n        this._appliedNeighborsZoom = null;\n        // @ts-ignore\n        this._globalTextureCoordinates = null;\n    }\n    /**\n     * @todo: looks like it could be simplified in Segment contructor\n     */\n    _setExtentLonLat() {\n        this._extentLonLat = this._extent.inverseMercator();\n    }\n    createBoundsByExtent() {\n        const ellipsoid = this.planet.ellipsoid;\n        const extent = this._extentLonLat;\n        const coord_sw = ellipsoid.geodeticToCartesian(extent.southWest.lon, extent.southWest.lat);\n        const coord_ne = ellipsoid.geodeticToCartesian(extent.northEast.lon, extent.northEast.lat);\n        const coord_nw = ellipsoid.geodeticToCartesian(extent.southWest.lon, extent.northEast.lat);\n        const coord_se = ellipsoid.geodeticToCartesian(extent.northEast.lon, extent.southWest.lat);\n        this._sw.copy(coord_sw);\n        this._nw.copy(coord_nw);\n        this._ne.copy(coord_ne);\n        this._se.copy(coord_se);\n        this.setBoundingVolume3v(coord_sw, coord_ne);\n    }\n    createBoundsByParent() {\n        let pn = this.node;\n        while (pn.parentNode && !pn.segment.terrainReady) {\n            pn = pn.parentNode;\n        }\n        let dZ2 = 1 << (this.tileZoom - pn.segment.tileZoom);\n        let offsetX = this.tileX - pn.segment.tileX * dZ2, offsetY = this.tileY - pn.segment.tileY * dZ2;\n        if (pn.segment.terrainReady && pn.segment.tileZoom >= this.planet.terrain.minZoom) {\n            let gridSize = pn.segment.gridSize / dZ2;\n            if (gridSize >= 1.0) {\n                //\n                // (*) Actually, we get parent whole bounding volume\n                //\n                this.bsphere.center.x = pn.segment.bsphere.center.x;\n                this.bsphere.center.y = pn.segment.bsphere.center.y;\n                this.bsphere.center.z = pn.segment.bsphere.center.z;\n                this.bsphere.radius = pn.segment.bsphere.radius;\n                let i0 = gridSize * offsetY;\n                let j0 = gridSize * offsetX;\n                let pnGsOne = pn.segment.gridSize + 1;\n                let ind_sw = 3 * ((i0 + gridSize) * pnGsOne + j0), ind_nw = 3 * (i0 * pnGsOne + j0), ind_ne = 3 * (i0 * pnGsOne + j0 + gridSize), ind_se = 3 * ((i0 + gridSize) * pnGsOne + j0 + gridSize);\n                let pVerts = pn.segment.tempVertices;\n                let v_sw = new Vec3(pVerts[ind_sw], pVerts[ind_sw + 1], pVerts[ind_sw + 2]), v_ne = new Vec3(pVerts[ind_ne], pVerts[ind_ne + 1], pVerts[ind_ne + 2]);\n                // check for segment zoom\n                let v_nw = new Vec3(pVerts[ind_nw], pVerts[ind_nw + 1], pVerts[ind_nw + 2]), v_se = new Vec3(pVerts[ind_se], pVerts[ind_se + 1], pVerts[ind_se + 2]);\n                this._sw.copy(v_sw);\n                this._nw.copy(v_nw);\n                this._ne.copy(v_ne);\n                this._se.copy(v_se);\n            }\n            else {\n                let pseg = pn.segment;\n                let i0 = Math.floor(gridSize * offsetY), j0 = Math.floor(gridSize * offsetX);\n                let insideSize = 1.0 / gridSize;\n                let t_i0 = offsetY - insideSize * i0, t_j0 = offsetX - insideSize * j0;\n                let bigOne;\n                if (pseg.gridSize === 1) {\n                    bigOne = pseg.tempVertices;\n                }\n                else {\n                    bigOne = getMatrixSubArray64(pseg.tempVertices, pseg.gridSize, i0, j0, 1);\n                }\n                let v_lt = new Vec3(bigOne[0], bigOne[1], bigOne[2]), v_rb = new Vec3(bigOne[9], bigOne[10], bigOne[11]);\n                let vn = new Vec3(bigOne[3] - bigOne[0], bigOne[4] - bigOne[1], bigOne[5] - bigOne[2]), vw = new Vec3(bigOne[6] - bigOne[0], bigOne[7] - bigOne[1], bigOne[8] - bigOne[2]), ve = new Vec3(bigOne[3] - bigOne[9], bigOne[4] - bigOne[10], bigOne[5] - bigOne[11]), vs = new Vec3(bigOne[6] - bigOne[9], bigOne[7] - bigOne[10], bigOne[8] - bigOne[11]);\n                let vi_y = t_i0, vi_x = t_j0;\n                let coords_lt, coords_rb;\n                if (vi_y + vi_x < insideSize) {\n                    coords_lt = Vec3.add(vn.scaleTo(vi_x / insideSize), vw.scaleTo(vi_y / insideSize)).addA(v_lt);\n                }\n                else {\n                    coords_lt = Vec3.add(vs.scaleTo(1 - vi_x / insideSize), ve.scaleTo(1 - vi_y / insideSize)).addA(v_rb);\n                }\n                vi_y = t_i0 + 1;\n                vi_x = t_j0 + 1;\n                if (vi_y + vi_x < insideSize) {\n                    coords_rb = Vec3.add(vn.scaleTo(vi_x / insideSize), vw.scaleTo(vi_y / insideSize)).addA(v_lt);\n                }\n                else {\n                    coords_rb = Vec3.add(vs.scaleTo(1 - vi_x / insideSize), ve.scaleTo(1 - vi_y / insideSize)).addA(v_rb);\n                }\n                this.setBoundingVolume3v(coords_lt, coords_rb);\n            }\n        }\n        else {\n            this.createBoundsByExtent();\n        }\n    }\n    setBoundingSphere(x, y, z, v) {\n        this.bsphere.center.x = x;\n        this.bsphere.center.y = y;\n        this.bsphere.center.z = z;\n        this.bsphere.radius = this.bsphere.center.distance(v);\n    }\n    setBoundingVolume(xmin, ymin, zmin, xmax, ymax, zmax) {\n        this.bbox.setFromBoundsArr([xmin, ymin, zmin, xmax, ymax, zmax]);\n        let x = xmin + (xmax - xmin) * 0.5, y = ymin + (ymax - ymin) * 0.5, z = zmin + (zmax - zmin) * 0.5;\n        this.bsphere.center.set(x, y, z);\n        this.bsphere.radius = this.bsphere.center.distance(new Vec3(xmin, ymin, zmin));\n    }\n    setBoundingVolume3v(vmin, vmax) {\n        this.bbox.setFromBoundsArr([vmin.x, vmin.y, vmin.z, vmax.x, vmax.y, vmax.z]);\n        let x = vmin.x + (vmax.x - vmin.x) * 0.5, y = vmin.y + (vmax.y - vmin.y) * 0.5, z = vmin.z + (vmax.z - vmin.z) * 0.5;\n        this.bsphere.center.set(x, y, z);\n        this.bsphere.radius = this.bsphere.center.distance(new Vec3(vmin.x, vmin.y, vmin.z));\n    }\n    setBoundingVolumeArr(bounds) {\n        this.bbox.setFromBoundsArr(bounds);\n        let x = bounds[0] + (bounds[3] - bounds[0]) * 0.5, y = bounds[1] + (bounds[4] - bounds[1]) * 0.5, z = bounds[2] + (bounds[5] - bounds[2]) * 0.5;\n        this.bsphere.center.set(x, y, z);\n        this.bsphere.radius = this.bsphere.center.distance(new Vec3(bounds[0], bounds[1], bounds[2]));\n    }\n    createCoordsBuffers(verticesHigh, verticesLow, gridSize) {\n        const gsgs = (gridSize + 1) * (gridSize + 1);\n        const h = this.handler;\n        if (this.vertexPositionBufferHigh && this.vertexPositionBufferHigh.numItems === gsgs) {\n            h.setStreamArrayBuffer(this.vertexPositionBufferHigh, verticesHigh);\n            h.setStreamArrayBuffer(this.vertexPositionBufferLow, verticesLow);\n        }\n        else {\n            h.gl.deleteBuffer(this.vertexPositionBufferHigh);\n            h.gl.deleteBuffer(this.vertexPositionBufferLow);\n            this.vertexTextureCoordBuffer = this.planet._textureCoordsBufferCache[Math.log2(gridSize)];\n            // @todo use it!\n            //this.vertexPositionBufferHigh = h.createStreamArrayBuffer(3, gsgs);\n            //h.setStreamArrayBuffer(this.vertexPositionBufferHigh, verticesHigh);\n            //this.vertexPositionBufferLow = h.createStreamArrayBuffer(3, gsgs);\n            //h.setStreamArrayBuffer(this.vertexPositionBufferLow, verticesLow);\n            // It works, but I'm not sure that it is correct and better use the comment above\n            this.vertexPositionBufferHigh = h.createArrayBuffer(verticesHigh, 3, gsgs);\n            this.vertexPositionBufferLow = h.createArrayBuffer(verticesLow, 3, gsgs);\n        }\n    }\n    _addViewExtent() {\n        const ext = this._extentLonLat;\n        let viewExt = this.planet._viewExtent;\n        if (ext.southWest.lon < viewExt.southWest.lon) {\n            viewExt.southWest.lon = ext.southWest.lon;\n        }\n        if (ext.northEast.lon > viewExt.northEast.lon) {\n            viewExt.northEast.lon = ext.northEast.lon;\n        }\n        if (ext.southWest.lat < viewExt.southWest.lat) {\n            viewExt.southWest.lat = ext.southWest.lat;\n        }\n        if (ext.northEast.lat > viewExt.northEast.lat) {\n            viewExt.northEast.lat = ext.northEast.lat;\n        }\n    }\n    _assignTileIndexes() {\n        this._tileGroup = TILEGROUP_COMMON;\n        const tileZoom = this.tileZoom;\n        const extent = this._extent;\n        const pole = mercator.POLE;\n        this.tileX = Math.round(Math.abs(-pole - extent.southWest.lon) / (extent.northEast.lon - extent.southWest.lon));\n        this.tileY = Math.round(Math.abs(pole - extent.northEast.lat) / (extent.northEast.lat - extent.southWest.lat));\n        const p2 = Math.pow(2, tileZoom);\n        this.tileXE = (this.tileX + 1) % p2;\n        this.tileXW = (p2 + this.tileX - 1) % p2;\n        this.tileYN = this.tileY - 1;\n        this.tileYS = this.tileY + 1;\n        this.tileIndex = Layer.getTileIndex(this.tileX, this.tileY, tileZoom);\n    }\n    initialize() {\n        const p = this.planet;\n        const n = this.node;\n        this.gridSize = p.terrain.gridSizeByZoom[this.tileZoom] || p.terrain.plainGridSize;\n        n.sideSizeLog2[0] = n.sideSizeLog2[1] = n.sideSizeLog2[2] = n.sideSizeLog2[3] = Math.log2(this.gridSize);\n        if (this.tileZoom <= p.terrain.maxZoom) {\n            const nmc = this.planet._normalMapCreator;\n            this.normalMapTexturePtr = p.renderer.handler.createEmptyTexture_l(nmc.width, nmc.height);\n        }\n        this.normalMapTexture = this.planet.transparentTexture;\n        this._assignGlobalTextureCoordinates();\n        this.initialized = true;\n    }\n    _assignGlobalTextureCoordinates() {\n        const e = this._extent;\n        this._globalTextureCoordinates[0] =\n            (e.southWest.lon + mercator.POLE) * mercator.ONE_BY_POLE_DOUBLE;\n        this._globalTextureCoordinates[1] =\n            (mercator.POLE - e.northEast.lat) * mercator.ONE_BY_POLE_DOUBLE;\n        this._globalTextureCoordinates[2] =\n            (e.northEast.lon + mercator.POLE) * mercator.ONE_BY_POLE_DOUBLE;\n        this._globalTextureCoordinates[3] =\n            (mercator.POLE - e.southWest.lat) * mercator.ONE_BY_POLE_DOUBLE;\n    }\n    createPlainSegmentAsync() {\n        let p = this.planet, t = p.terrain;\n        if (t.isReady() && !this.plainReady && this.tileZoom <= t.maxZoom) {\n            this.plainProcessing = true;\n            p._plainSegmentWorker.make(this);\n        }\n    }\n    _plainSegmentWorkerCallback(data) {\n        this.plainProcessing = false;\n        if (this.initialized && !this.terrainReady) {\n            this.plainReady = true;\n            this.plainVertices = data.plainVertices;\n            this.plainVerticesHigh = data.plainVerticesHigh;\n            this.plainVerticesLow = data.plainVerticesLow;\n            this.plainNormals = data.plainNormals;\n            this._plainRadius = data.plainRadius;\n            this.normalMapNormals = data.normalMapNormals;\n            this.normalMapVertices = data.normalMapVertices;\n            this.normalMapVerticesHigh = data.normalMapVerticesHigh;\n            this.normalMapVerticesLow = data.normalMapVerticesLow;\n            //this.terrainVertices = this.plainVertices;\n            //this.terrainVerticesHigh = this.plainVerticesHigh;\n            //this.terrainVerticesLow = this.plainVerticesLow;\n            this.fileGridSize = Math.sqrt(data.normalMapVertices.length / 3) - 1;\n        }\n    }\n    createPlainSegment() {\n        this.initialize();\n        this._createPlainVertices();\n        this.readyToEngage = true;\n    }\n    _createPlainVertices() {\n        const gridSize = this.planet.terrain.gridSizeByZoom[this.tileZoom];\n        const e = this._extent;\n        const fgs = this.planet.terrain.plainGridSize;\n        const lonSize = e.getWidth();\n        const llStep = lonSize / Math.max(fgs, gridSize);\n        const esw_lon = e.southWest.lon;\n        const ene_lat = e.northEast.lat;\n        const dg = Math.max(fgs / gridSize, 1);\n        const gs = Math.max(fgs, gridSize) + 1;\n        const r2 = this.planet.ellipsoid._invRadii2;\n        const gsgs = gs * gs;\n        const gridSize3 = (gridSize + 1) * (gridSize + 1) * 3;\n        let ind = 0, nmInd = 0;\n        this.plainNormals = new Float32Array(gridSize3);\n        this.plainVertices = new Float64Array(gridSize3);\n        this.plainVerticesHigh = new Float32Array(gridSize3);\n        this.plainVerticesLow = new Float32Array(gridSize3);\n        this.normalMapNormals = new Float32Array(gsgs * 3);\n        this.normalMapVertices = new Float64Array(gsgs * 3);\n        this.normalMapVerticesHigh = new Float32Array(gsgs * 3);\n        this.normalMapVerticesLow = new Float32Array(gsgs * 3);\n        let verts = this.plainVertices, vertsHigh = this.plainVerticesHigh, vertsLow = this.plainVerticesLow, norms = this.plainNormals, nmVerts = this.normalMapVertices, nmVertsHigh = this.normalMapVerticesHigh, nmVertsLow = this.normalMapVerticesLow, nmNorms = this.normalMapNormals;\n        for (let k = 0; k < gsgs; k++) {\n            let j = k % gs, i = ~~(k / gs);\n            let v = this.planet.ellipsoid.lonLatToCartesian(LonLat.inverseMercator(esw_lon + j * llStep, ene_lat - i * llStep));\n            let nx = v.x * r2.x, ny = v.y * r2.y, nz = v.z * r2.z;\n            let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n            let nxl = nx * l, nyl = ny * l, nzl = nz * l;\n            Vec3.doubleToTwoFloats(v, _tempHigh, _tempLow);\n            nmVerts[nmInd] = v.x;\n            nmVertsHigh[nmInd] = _tempHigh.x;\n            nmVertsLow[nmInd] = _tempLow.x;\n            nmNorms[nmInd++] = nxl;\n            nmVerts[nmInd] = v.y;\n            nmVertsHigh[nmInd] = _tempHigh.y;\n            nmVertsLow[nmInd] = _tempLow.y;\n            nmNorms[nmInd++] = nyl;\n            nmVerts[nmInd] = v.z;\n            nmVertsHigh[nmInd] = _tempHigh.z;\n            nmVertsLow[nmInd] = _tempLow.z;\n            nmNorms[nmInd++] = nzl;\n            if (i % dg === 0 && j % dg === 0) {\n                verts[ind] = v.x;\n                vertsHigh[ind] = _tempHigh.x;\n                vertsLow[ind] = _tempLow.x;\n                norms[ind++] = nxl;\n                verts[ind] = v.y;\n                vertsHigh[ind] = _tempHigh.y;\n                vertsLow[ind] = _tempLow.y;\n                norms[ind++] = nyl;\n                verts[ind] = v.z;\n                vertsHigh[ind] = _tempHigh.z;\n                vertsLow[ind] = _tempLow.z;\n                norms[ind++] = nzl;\n            }\n        }\n        this.terrainVertices = verts;\n        this.terrainVerticesHigh = vertsHigh;\n        this.terrainVerticesLow = vertsLow;\n        this.plainReady = true;\n    }\n    /**\n     * Gets specific layer material.\n     * @public\n     * @param {Layer} layer - Layer object.\n     * @returns {Material | undefined} - Segment material.\n     */\n    getMaterialByLayer(layer) {\n        return this.materials[layer.__id];\n    }\n    /**\n     * @param layer\n     * @protected\n     *\n     * @todo siplify layer._extentMerc in this.getLayerExtent(layer)\n     *\n     */\n    _getLayerExtentOffset(layer) {\n        const v0s = layer._extentMerc;\n        const v0t = this._extent;\n        const sSize_x = v0s.northEast.lon - v0s.southWest.lon;\n        const sSize_y = v0s.northEast.lat - v0s.southWest.lat;\n        const dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\n        const dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\n        const dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\n        const dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\n    }\n    initSlice(sliceIndex) {\n        let slice = this._slices[sliceIndex];\n        if (!slice) {\n            slice = this._slices[sliceIndex] = new Slice(this);\n        }\n        else {\n            //TODO: optimization!!!\n            slice.layers = [];\n        }\n        return slice;\n    }\n    screenRendering(sh, layerSlice, sliceIndex, defaultTexture, isOverlay = false, forcedOpacity) {\n        const gl = this.handler.gl;\n        const sha = sh.attributes;\n        const shu = sh.uniforms;\n        const pm = this.materials;\n        const p = this.planet;\n        let currHeight, li;\n        if (layerSlice && layerSlice.length) {\n            li = layerSlice[0];\n            currHeight = li._height;\n        }\n        else {\n            currHeight = 0;\n        }\n        // First always draw whole planet base layer segment with solid texture.\n        gl.activeTexture(gl.TEXTURE0 + p.SLICE_SIZE + 2);\n        gl.bindTexture(gl.TEXTURE_2D, (defaultTexture || this.getDefaultTexture()));\n        gl.uniform1i(shu.defaultTexture, p.SLICE_SIZE + 2);\n        let n = 0, i = 0;\n        let notEmpty = false;\n        let slice = this.initSlice(sliceIndex);\n        this._indexBuffer = this._getIndexBuffer();\n        while (li) {\n            if (this.layerOverlap(li) &&\n                ((li._fading && li._fadingOpacity > 0.0) ||\n                    ((li.minZoom >= p.minCurrZoom || li.maxZoom >= p.minCurrZoom) &&\n                        (li.minZoom <= p.maxCurrZoom || li.maxZoom <= p.maxCurrZoom)))) {\n                notEmpty = true;\n                let m = pm[li.__id];\n                if (!m) {\n                    m = pm[li.__id] = li.createMaterial(this);\n                }\n                if (!m.isReady) {\n                    this.planet._renderCompleted = false;\n                }\n                slice.append(li, m);\n                p._samplerArr[n] = n;\n                gl.activeTexture(gl.TEXTURE0 + n);\n                gl.bindTexture(gl.TEXTURE_2D, (m.texture || p.transparentTexture));\n                n++;\n            }\n            i++;\n            li = layerSlice[i];\n        }\n        if (notEmpty || !isOverlay) {\n            gl.uniform1f(shu.transitionOpacity, forcedOpacity || this._transitionOpacity > 1.0 ? 1.0 : this._transitionOpacity);\n            gl.uniform1i(shu.samplerCount, n);\n            gl.uniform1f(shu.height, currHeight);\n            gl.uniform1iv(shu.samplerArr, p._samplerArr);\n            //slice.uniform(gl, shu);\n            gl.uniform4fv(shu.tileOffsetArr, slice.tileOffsetArr);\n            gl.uniform1fv(shu.layerOpacityArr, slice.layerOpacityArr);\n            //gl.uniform4fv(shu.visibleExtentOffsetArr, slice.visibleExtentOffsetArr);\n            // bind normalmap texture\n            if (p.lightEnabled) {\n                gl.activeTexture(gl.TEXTURE0 + p.SLICE_SIZE + 3);\n                gl.bindTexture(gl.TEXTURE_2D, (this.normalMapTexture || p.transparentTexture));\n                gl.uniform1i(shu.uNormalMap, p.SLICE_SIZE + 3);\n                gl.uniform3fv(shu.uNormalMapBias, this.normalMapTextureBias);\n                // bind segment specular and night material texture coordinates\n                gl.uniform4fv(shu.uGlobalTextureCoord, this._globalTextureCoordinates);\n            }\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh);\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow);\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexTextureCoordBuffer);\n            gl.vertexAttribPointer(sha.aTextureCoord, 2, gl.UNSIGNED_SHORT, true, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n            gl.drawElements(p.drawMode, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n        }\n    }\n    heightPickingRendering(sh, layerSlice) {\n        const gl = this.handler.gl;\n        const sha = sh.attributes;\n        const shu = sh.uniforms;\n        // var pm = this.materials,\n        //     p = this.planet;\n        let currHeight;\n        if (layerSlice && layerSlice.length) {\n            currHeight = layerSlice[0]._height;\n        }\n        else {\n            currHeight = 0;\n        }\n        gl.uniform1f(shu.height, currHeight);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh);\n        gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow);\n        gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n        gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n    }\n    increaseTransitionOpacity() {\n        //this._transitionOpacity += 0.01;\n        this._transitionOpacity += (window.performance.now() - this._transitionTimestamp) / this.planet.transitionTime;\n        this._transitionTimestamp = window.performance.now();\n        if (this._transitionOpacity > 1.0) {\n            this._transitionOpacity = 1.0;\n        }\n    }\n    fadingTransitionOpacity() {\n        //this._transitionOpacity -= 0.01;\n        this._transitionOpacity -= (window.performance.now() - this._transitionTimestamp) / this.planet.transitionTime;\n        this._transitionTimestamp = window.performance.now();\n        if (this._transitionOpacity < 0.0) {\n            this._transitionOpacity = 0;\n        }\n    }\n    colorPickingRendering(sh, layerSlice, sliceIndex, defaultTexture, isOverlay = false) {\n        const gl = this.handler.gl;\n        const sha = sh.attributes;\n        const shu = sh.uniforms;\n        let pm = this.materials, p = this.planet;\n        let currHeight;\n        if (layerSlice && layerSlice.length) {\n            currHeight = layerSlice[0]._height;\n        }\n        else {\n            currHeight = 0;\n        }\n        let notEmpty = false;\n        let slice = this._slices[sliceIndex];\n        let len = slice.layers.length;\n        for (let n = 0; n < len; n++) {\n            notEmpty = true;\n            let li = slice.layers[n];\n            let n4 = n * 4;\n            p._pickingColorArr[n4] = li._pickingColor.x / 255.0;\n            p._pickingColorArr[n4 + 1] = li._pickingColor.y / 255.0;\n            p._pickingColorArr[n4 + 2] = li._pickingColor.z / 255.0;\n            p._pickingColorArr[n4 + 3] = Number(li._pickingEnabled);\n            p._samplerArr[n] = n;\n            gl.activeTexture(gl.TEXTURE0 + n);\n            gl.bindTexture(gl.TEXTURE_2D, (pm[li.__id].texture || this.planet.transparentTexture));\n            p._pickingMaskArr[n] = n + p.SLICE_SIZE;\n            gl.activeTexture(gl.TEXTURE0 + n + p.SLICE_SIZE);\n            gl.bindTexture(gl.TEXTURE_2D, (pm[li.__id].pickingMask || this.planet.transparentTexture));\n        }\n        if (notEmpty || !isOverlay) {\n            gl.uniform1i(shu.samplerCount, len);\n            gl.uniform1f(shu.height, currHeight);\n            gl.uniform1iv(shu.samplerArr, p._samplerArr);\n            gl.uniform1iv(shu.pickingMaskArr, p._pickingMaskArr);\n            gl.uniform4fv(shu.pickingColorArr, p._pickingColorArr);\n            //slice.uniform(gl, shu);\n            gl.uniform4fv(shu.tileOffsetArr, slice.tileOffsetArr);\n            gl.uniform1fv(shu.layerOpacityArr, slice.layerOpacityArr);\n            //gl.uniform4fv(shu.visibleExtentOffsetArr, slice.visibleExtentOffsetArr);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh);\n            gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow);\n            gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n            gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexTextureCoordBuffer);\n            gl.vertexAttribPointer(sha.aTextureCoord, 2, gl.UNSIGNED_SHORT, true, 0, 0);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n            gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n        }\n    }\n    depthRendering(sh, layerSlice) {\n        const gl = this.handler.gl;\n        const sha = sh.attributes;\n        const shu = sh.uniforms;\n        var currHeight;\n        if (layerSlice && layerSlice.length) {\n            currHeight = layerSlice[0]._height;\n        }\n        else {\n            currHeight = 0;\n        }\n        gl.uniform1f(shu.height, currHeight);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferHigh);\n        gl.vertexAttribPointer(sha.aVertexPositionHigh, this.vertexPositionBufferHigh.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.vertexPositionBufferLow);\n        gl.vertexAttribPointer(sha.aVertexPositionLow, this.vertexPositionBufferLow.itemSize, gl.FLOAT, false, 0, 0);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBuffer);\n        gl.drawElements(gl.TRIANGLE_STRIP, this._indexBuffer.numItems, gl.UNSIGNED_INT, 0);\n    }\n    _getIndexBuffer() {\n        const s = this.node.sideSizeLog2;\n        let cache = this.planet._indexesCache[Math.log2(this.gridSize)][s[0]][s[1]][s[2]][s[3]];\n        if (!cache.buffer) {\n            let indexes = segmentHelper.getInstance().createSegmentIndexes(Math.log2(this.gridSize), [s[0], s[1], s[2], s[3]]);\n            cache.buffer = this.planet.renderer.handler.createElementArrayBuffer(indexes, 1);\n            this.planet._indexesCacheToRemoveCounter++;\n        }\n        return cache.buffer;\n    }\n    /**\n     * @todo: replace to the strategy\n     */\n    _collectVisibleNodes() {\n        this.planet._visibleNodes[this.node.nodeId] = this.node;\n    }\n    layerOverlap(layer) {\n        return this._extent.overlaps(layer._extentMerc);\n    }\n    getDefaultTexture() {\n        return this.planet.solidTextureOne;\n    }\n    getExtentLonLat() {\n        return this._extentLonLat;\n    }\n    getExtentMerc() {\n        return this._extentMerc;\n    }\n    getExtent() {\n        return this._extent;\n    }\n    /**\n     * @todo replace to the strategy\n     */\n    getNodeState() {\n        let vn = this.planet._visibleNodes[this.node.nodeId];\n        return (vn && vn.state) || NOTRENDERING;\n    }\n    getNeighborSide(b) {\n        if (this.tileY === b.tileY) {\n            if (this.tileX === b.tileXE) {\n                return W;\n            }\n            else if (this.tileX === b.tileXW) {\n                return E;\n            }\n        }\n        else if (this.tileX === b.tileX) {\n            if (this.tileY === b.tileYS) {\n                return N;\n            }\n            else if (this.tileY === b.tileYN) {\n                return S;\n            }\n        }\n        return -1;\n    }\n}\nexport { Segment };\n//# sourceMappingURL=Segment.js.map","import { Extent } from \"../Extent\";\nimport { EPSG3857 } from \"../proj/EPSG3857\";\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { binaryInsert, getMatrixSubArray32, getMatrixSubArray64, getMatrixSubArrayBoundsExt } from \"../utils/shared\";\nimport { LonLat } from \"../LonLat\";\nimport { MAX, MIN } from \"../math\";\nimport { MAX_LAT } from \"../mercator\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { E, MAX_RENDERED_NODES, N, NE, NEIGHBOUR, NOTRENDERING, NW, OPPART, OPSIDE, PARTOFFSET, RENDERING, S, SE, SW, VISIBLE_DISTANCE, W, WALKTHROUGH } from \"./quadTree\";\nimport { TILEGROUP_COMMON, TILEGROUP_NORTH, TILEGROUP_SOUTH } from \"../segment/Segment\";\nlet _tempHigh = new Vec3(), _tempLow = new Vec3();\nconst _vertOrder = [\n    new Vec2(0, 0), new Vec2(1, 0),\n    new Vec2(0, 1), new Vec2(1, 1)\n];\nconst _neGridSize = Math.sqrt(_vertOrder.length) - 1;\nlet BOUNDS = {\n    xmin: 0.0, ymin: 0.0, zmin: 0.0,\n    xmax: 0.0, ymax: 0.0, zmax: 0.0\n};\n/**\n * Quad tree planet segment node.\n * @constructor\n * @param {Segment} segmentPrototype - Planet segment node constructor.\n * @param {Planet} planet - Planet scene instance.\n * @param {number} partId - NorthEast, SouthWest etc.\n * @param {Node} parent - Parent of this node.\n * @param {number} id - Tree node identifier (id * 4 + 1);\n * @param {number} tileZoom - Deep index of the quad tree.\n * @param {Extent} extent - Planet segment extent.\n */\nclass Node {\n    constructor(SegmentPrototype, planet, partId, parent, id, tileZoom, extent) {\n        planet._createdNodesCount++;\n        this.SegmentPrototype = SegmentPrototype;\n        this.planet = planet;\n        this.parentNode = parent;\n        this.partId = partId;\n        this.nodeId = partId + id;\n        this.state = null;\n        this.prevState = null;\n        this.appliedTerrainNodeId = -1;\n        this.sideSizeLog2 = [0, 0, 0, 0];\n        this.ready = false;\n        this.neighbors = [[], [], [], []];\n        this.equalizedSideWithNodeId = [this.nodeId, this.nodeId, this.nodeId, this.nodeId];\n        // @todo: this.nodes = null;\n        this.nodes = [];\n        this.segment = new SegmentPrototype(this, planet, tileZoom, extent);\n        this._cameraInside = false;\n        this.inFrustum = 0;\n        this._fadingNodes = [];\n        this.createBounds();\n    }\n    createChildrenNodes() {\n        this.ready = true;\n        const p = this.planet;\n        const ps = this.segment;\n        const ext = ps._extent;\n        const z = ps.tileZoom + 1;\n        const size_x = ext.getWidth() * 0.5;\n        const size_y = ext.getHeight() * 0.5;\n        const ne = ext.northEast;\n        const sw = ext.southWest;\n        const id = this.nodeId * 4 + 1;\n        const c = new LonLat(sw.lon + size_x, sw.lat + size_y);\n        const nd = this.nodes;\n        nd[NW] = new Node(this.SegmentPrototype, p, NW, this, id, z, new Extent(new LonLat(sw.lon, sw.lat + size_y), new LonLat(sw.lon + size_x, ne.lat)));\n        nd[NE] = new Node(this.SegmentPrototype, p, NE, this, id, z, new Extent(c, new LonLat(ne.lon, ne.lat)));\n        nd[SW] = new Node(this.SegmentPrototype, p, SW, this, id, z, new Extent(new LonLat(sw.lon, sw.lat), c));\n        nd[SE] = new Node(this.SegmentPrototype, p, SE, this, id, z, new Extent(new LonLat(sw.lon + size_x, sw.lat), new LonLat(ne.lon, sw.lat + size_y)));\n    }\n    createBounds() {\n        let seg = this.segment;\n        seg._setExtentLonLat();\n        if (seg.tileZoom === 0) {\n            seg.setBoundingSphere(0.0, 0.0, 0.0, new Vec3(0.0, 0.0, seg.planet.ellipsoid.equatorialSize));\n        }\n        else if (seg.tileZoom < seg.planet.terrain.minZoom) {\n            seg.createBoundsByExtent();\n        }\n        else {\n            seg.createBoundsByParent();\n        }\n        let x = seg.bsphere.center.x, y = seg.bsphere.center.y, z = seg.bsphere.center.z;\n        let length = 1.0 / Math.sqrt(x * x + y * y + z * z);\n        seg.centerNormal.x = x * length;\n        seg.centerNormal.y = y * length;\n        seg.centerNormal.z = z * length;\n    }\n    getState() {\n        if (this.state === -1) {\n            return this.state;\n        }\n        let pn = this.parentNode;\n        while (pn) {\n            if (pn.state !== WALKTHROUGH) {\n                return NOTRENDERING;\n            }\n            pn = pn.parentNode;\n        }\n        return this.state;\n    }\n    /**\n     * Returns the same deep existent neighbour node.\n     * @public\n     * @param {number} side - Neighbour side index e.g. og.quadTree.N, og.quadTree.W etc.\n     * @returns {Node} -\n     */\n    getEqualNeighbor(side) {\n        let pn = this;\n        let part = NEIGHBOUR[side][pn.partId];\n        if (part !== -1) {\n            // (!) it means that we would never ask to get head node neighbors\n            return pn.parentNode.nodes[part];\n        }\n        else {\n            let pathId = [];\n            while (pn.parentNode) {\n                pathId.push(pn.partId);\n                part = NEIGHBOUR[side][pn.partId];\n                pn = pn.parentNode;\n                if (part !== -1) {\n                    let i = pathId.length;\n                    side = OPSIDE[side];\n                    while (pn && i--) {\n                        part = OPPART[side][pathId[i]];\n                        pn = pn.nodes[part];\n                    }\n                    return pn;\n                }\n            }\n        }\n    }\n    // public isBrother(node: Node): boolean {\n    //     return !(this.parentNode || node.parentNode) || (this.parentNode!.nodeId === node.parentNode!.nodeId);\n    // }\n    traverseNodes(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode) {\n        if (!this.ready) {\n            this.createChildrenNodes();\n        }\n        let n = this.nodes;\n        n[0].renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\n        n[1].renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\n        n[2].renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\n        n[3].renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\n    }\n    renderTree(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode) {\n        if (this.planet._renderedNodes.length >= MAX_RENDERED_NODES) {\n            return;\n        }\n        if (!maxZoom || zoomPassNode && this.segment.tileZoom > zoomPassNode.segment.tileZoom) {\n            this.prevState = this.state;\n        }\n        this.state = WALKTHROUGH;\n        this.clearNeighbors();\n        for (let i = 0; i < this._fadingNodes.length; i++) {\n            this._fadingNodes[i].neighbors && this._fadingNodes[i].clearNeighbors();\n        }\n        let seg = this.segment, planet = this.planet;\n        this._cameraInside = false;\n        // Search a node which the camera is flying over.\n        if (!this.parentNode || this.parentNode._cameraInside) {\n            let inside;\n            if (Math.abs(cam._lonLat.lat) <= MAX_LAT && seg._projection.id === EPSG3857.id) {\n                inside = seg._extent.isInside(cam._lonLatMerc);\n            }\n            else if (seg._projection.id === EPSG4326.id) {\n                inside = seg._extent.isInside(cam._lonLat);\n            }\n            if (inside) {\n                cam._insideSegment = seg;\n                this._cameraInside = true;\n            }\n        }\n        this.inFrustum = 0;\n        let frustums = cam.frustums, numFrustums = frustums.length;\n        if (seg.tileZoom < 6) {\n            for (let i = 0; i < numFrustums; i++) {\n                if (frustums[i].containsSphere(seg.bsphere)) {\n                    this.inFrustum |= 1 << i;\n                }\n            }\n        }\n        else {\n            let commonFrustumFlag = 1 << (numFrustums - 1 - 1);\n            for (let i = 0; commonFrustumFlag && i < numFrustums; i++) {\n                if (seg.terrainReady) {\n                    if (frustums[i].containsBox(seg.bbox)) {\n                        commonFrustumFlag >>= 1;\n                        this.inFrustum |= 1 << i;\n                    }\n                }\n                else {\n                    if (frustums[i].containsSphere(seg.bsphere)) {\n                        commonFrustumFlag >>= 1;\n                        this.inFrustum |= 1 << i;\n                    }\n                }\n            }\n        }\n        if (this.inFrustum || this._cameraInside || seg.tileZoom < 3) {\n            let h = Math.abs(cam._lonLat.height);\n            let eye = cam.eye;\n            let horizonDist = eye.length2() - this.planet.ellipsoid.polarSizeSqr;\n            let altVis = seg.tileZoom > 19 || (seg.tileZoom < 5 && !seg.terrainReady) || seg.tileZoom < 2;\n            if (h > 21000) {\n                altVis = altVis || eye.distance2(seg._sw) < horizonDist || eye.distance2(seg._nw) < horizonDist || eye.distance2(seg._ne) < horizonDist || eye.distance2(seg._se) < horizonDist;\n            }\n            else {\n                altVis = altVis || cam.eye.distance(seg.bsphere.center) - seg.bsphere.radius < VISIBLE_DISTANCE * Math.sqrt(h);\n            }\n            if ((this.inFrustum && (altVis || h > 10000.0)) || this._cameraInside) {\n                //@todo: replace to the strategy\n                seg._collectVisibleNodes();\n            }\n            if (seg.tileZoom < 2) {\n                this.traverseNodes(cam, maxZoom, terrainReadySegment, stopLoading, zoomPassNode);\n            }\n            else if (seg.terrainReady && (!maxZoom && cam.projectedSize(seg.bsphere.center, seg._plainRadius) < planet.lodSize || maxZoom && ((seg.tileZoom === maxZoom) || !altVis))) {\n                if (altVis) {\n                    seg.passReady = true;\n                    this.renderNode(this.inFrustum, !this.inFrustum, terrainReadySegment, stopLoading);\n                }\n                else {\n                    this.state = NOTRENDERING;\n                }\n            }\n            else if (seg.terrainReady && seg.checkZoom() && (!maxZoom || cam.projectedSize(seg.bsphere.center, seg.bsphere.radius) > this.planet._maxLodSize)) {\n                this.traverseNodes(cam, maxZoom, seg, stopLoading, zoomPassNode);\n            }\n            else if (altVis) {\n                seg.passReady = maxZoom ? seg.terrainReady : false;\n                this.renderNode(this.inFrustum, !this.inFrustum, terrainReadySegment, stopLoading);\n            }\n            else {\n                this.state = NOTRENDERING;\n            }\n        }\n        else {\n            this.state = NOTRENDERING;\n        }\n    }\n    renderNode(inFrustum, onlyTerrain, terrainReadySegment, stopLoading) {\n        let seg = this.segment;\n        // Create and load terrain data\n        if (!seg.terrainReady) {\n            if (!seg.initialized) {\n                seg.initialize();\n            }\n            this.whileTerrainLoading(terrainReadySegment);\n            if (!seg.plainProcessing) {\n                seg.createPlainSegmentAsync();\n            }\n            if (seg.plainReady && !stopLoading) {\n                seg.loadTerrain();\n            }\n        }\n        // Create normal map texture\n        if (seg.planet.lightEnabled && !seg.normalMapReady) {\n            this.whileNormalMapCreating();\n        }\n        if (onlyTerrain) {\n            this.state = -1;\n            return;\n        }\n        // Calculate minimal and maximal zoom index on the screen\n        if (!this._cameraInside && seg.tileZoom > this.planet.maxCurrZoom) {\n            this.planet.maxCurrZoom = seg.tileZoom;\n        }\n        if (seg.tileZoom < this.planet.minCurrZoom) {\n            this.planet.minCurrZoom = seg.tileZoom;\n        }\n        seg._addViewExtent();\n        // Finally this node proceeds to rendering.\n        this.addToRender(inFrustum);\n    }\n    childrenPrevStateEquals(state) {\n        let n = this.nodes;\n        return n.length === 4 && n[0].prevState === state && n[1].prevState === state && n[2].prevState === state && n[3].prevState === state;\n    }\n    isFading() {\n        let n = this.nodes;\n        return this.state === WALKTHROUGH && this.segment._transitionOpacity > 0.0 && n.length === 4 && (n[0].state === RENDERING && n[1].state === RENDERING && n[2].state === RENDERING && n[3].state === RENDERING);\n    }\n    _collectFadingNodes() {\n        if (this.segment.tileZoom < 3) {\n            this.segment._transitionOpacity = 1.0;\n            return;\n        }\n        // Light up the node\n        if (this.prevState !== RENDERING) {\n            // means that the node is lighting up\n            this.segment._transitionOpacity = 0.0;\n            // store fading nodes, could be a parent or children nodes\n            this._fadingNodes = [];\n            let timestamp = window.performance.now();\n            this.segment._transitionTimestamp = timestamp;\n            if (this.parentNode) {\n                // Parent was visible the last frame, make the parent fading\n                if (this.parentNode.prevState === RENDERING) {\n                    let pn = this.parentNode.parentNode;\n                    while (pn) {\n                        if (pn.isFading()) {\n                            for (let i = 0; i < pn.nodes.length; i++) {\n                                pn.nodes[i].segment._transitionOpacity = 1.0;\n                                pn.nodes[i]._fadingNodes = [];\n                            }\n                            pn.segment._transitionOpacity = 0.0;\n                            break;\n                        }\n                        pn = pn.parentNode;\n                    }\n                    // not sure it's necessary here\n                    //this.parentNode.whileTerrainLoading();\n                    this._fadingNodes.push(this.parentNode);\n                    this.parentNode.segment._transitionOpacity = 2.0;\n                    this.parentNode.segment._transitionTimestamp = timestamp;\n                }\n                else {\n                    // Check if the children were visible last frame, and make them fading\n                    if (this.segment.childrenInitialized() && this.childrenPrevStateEquals(RENDERING)) {\n                        for (let i = 0; i < this.nodes.length; i++) {\n                            let ni = this.nodes[i];\n                            // not sure it's necessary here\n                            //ni.whileTerrainLoading();\n                            this._fadingNodes.push(ni);\n                            ni.segment._transitionOpacity = 2.0;\n                            ni.segment._transitionTimestamp = timestamp;\n                            ni.prevState = ni.state;\n                            ni.state = NOTRENDERING;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    clearNeighbors() {\n        //this.sideSizeLog2[0] = this.sideSizeLog2[1] = this.sideSizeLog2[2] = this.sideSizeLog2[3] = Math.log2(this.segment.gridSize);\n        // @ts-ignore\n        this.neighbors[0] = this.neighbors[1] = this.neighbors[2] = this.neighbors[3] = null;\n        this.neighbors[0] = [];\n        this.neighbors[1] = [];\n        this.neighbors[2] = [];\n        this.neighbors[3] = [];\n    }\n    _refreshTransitionOpacity() {\n        if (this._fadingNodes.length === 0) {\n            this.segment._transitionOpacity = 1.0;\n        }\n        else {\n            if (this._fadingNodes.length === 4 && !this.childrenPrevStateEquals(RENDERING)) {\n                this.segment._transitionOpacity = 1.0;\n            }\n            else {\n                this.segment.increaseTransitionOpacity();\n                for (let i = 0; i < this._fadingNodes.length; i++) {\n                    let n = this._fadingNodes[i];\n                    if (n.segment) {\n                        if (n.segment._transitionOpacity > 0 && !this.planet._fadingNodes.has(n.nodeId)) {\n                            this.planet._fadingNodes.set(n.nodeId, n);\n                            n.segment.fadingTransitionOpacity();\n                        }\n                    }\n                    else {\n                        this.segment._transitionOpacity = 1.0;\n                        break;\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Picking up current node to render processing.\n     * @public\n     */\n    addToRender(inFrustum) {\n        this.state = RENDERING;\n        let nodes = this.planet._renderedNodes;\n        //@ts-ignore\n        if (!this.planet._transitionOpacityEnabled) {\n            this.getRenderedNodesNeighbors(nodes);\n            nodes.push(this);\n        }\n        else {\n            //@todo: check if it's possible to get rid of the sorting when using breadth traverse tree\n            binaryInsert(nodes, this, (a, b) => {\n                return a.segment.tileZoom - b.segment.tileZoom;\n            });\n        }\n        if (!this.segment.terrainReady) {\n            this.planet._renderCompleted = false;\n            this.planet._terrainCompleted = false;\n        }\n        let k = 0, rf = this.planet._renderedNodesInFrustum;\n        while (inFrustum) {\n            if (inFrustum & 1) {\n                rf[k].push(this);\n            }\n            k++;\n            inFrustum >>= 1;\n        }\n    }\n    applyNeighbor(node, side) {\n        const opcs = OPSIDE[side];\n        if (this.neighbors[side].length === 0 || node.neighbors[opcs].length === 0) {\n            const ap = this.segment;\n            const bp = node.segment;\n            const ld = ap.gridSize / (bp.gridSize * Math.pow(2, bp.tileZoom - ap.tileZoom));\n            let cs_size = ap.gridSize, opcs_size = bp.gridSize;\n            if (ld > 1) {\n                cs_size = Math.ceil(ap.gridSize / ld);\n                opcs_size = bp.gridSize;\n            }\n            else if (ld < 1) {\n                cs_size = ap.gridSize;\n                opcs_size = Math.ceil(bp.gridSize * ld);\n            }\n            this.sideSizeLog2[side] = Math.log2(cs_size);\n            node.sideSizeLog2[opcs] = Math.log2(opcs_size);\n        }\n        //@todo: fix dupe neighbors\n        this.neighbors[side].push(node);\n        node.neighbors[opcs].push(this);\n    }\n    /**\n     * Searching current node for its neighbours.\n     * @public\n     */\n    getRenderedNodesNeighbors(nodes) {\n        for (let i = nodes.length - 1; i >= 0; --i) {\n            let ni = nodes[i];\n            let cs = this.getCommonSide(ni);\n            if (cs !== -1) {\n                this.applyNeighbor(ni, cs);\n            }\n        }\n    }\n    /**\n     * Checking if current node has a common side with input node and return side index N, E, S or W. Otherwise returns -1.\n     * @param {Node} node - Input node\n     * @returns {number} - Node side index\n     */\n    getCommonSide(node) {\n        const as = this.segment;\n        const bs = node.segment;\n        if (as.tileZoom === bs.tileZoom && as._tileGroup === bs._tileGroup) {\n            return as.getNeighborSide(bs);\n        }\n        else {\n            const a = as._extentLonLat;\n            const b = bs._extentLonLat;\n            let a_ne = a.northEast, a_sw = a.southWest, b_ne = b.northEast, b_sw = b.southWest;\n            let a_ne_lon = a_ne.lon, a_ne_lat = a_ne.lat, a_sw_lon = a_sw.lon, a_sw_lat = a_sw.lat, b_ne_lon = b_ne.lon, b_ne_lat = b_ne.lat, b_sw_lon = b_sw.lon, b_sw_lat = b_sw.lat;\n            if (as._tileGroup === bs._tileGroup) {\n                if (a_ne_lon === b_sw_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\n                    return E;\n                }\n                else if (a_sw_lon === b_ne_lon && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\n                    return W;\n                }\n                else if (a_ne_lat === b_sw_lat && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                    return N;\n                }\n                else if (a_sw_lat === b_ne_lat && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                    return S;\n                }\n                else if (bs.tileX === 0 && as.tileX === Math.pow(2, as.tileZoom) - 1 && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\n                    return E;\n                }\n                else if (as.tileX === 0 && bs.tileX === Math.pow(2, bs.tileZoom) - 1 && ((a_ne_lat <= b_ne_lat && a_sw_lat >= b_sw_lat) || (a_ne_lat >= b_ne_lat && a_sw_lat <= b_sw_lat))) {\n                    return W;\n                }\n            }\n            if (as._tileGroup === TILEGROUP_COMMON && bs._tileGroup === TILEGROUP_NORTH && as.tileY === 0 && bs.tileY === Math.pow(2, bs.tileZoom) - 1 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                return N;\n            }\n            else if (as._tileGroup === TILEGROUP_SOUTH && bs._tileGroup === TILEGROUP_COMMON && as.tileY === 0 && bs.tileY === Math.pow(2, bs.tileZoom) - 1 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                return N;\n            }\n            else if (bs._tileGroup === TILEGROUP_NORTH && as._tileGroup === TILEGROUP_COMMON && as.tileY === Math.pow(2, as.tileZoom) - 1 && bs.tileY === 0 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                return S;\n            }\n            else if (as._tileGroup === TILEGROUP_NORTH && bs._tileGroup === TILEGROUP_COMMON && as.tileY === Math.pow(2, as.tileZoom) - 1 && bs.tileY === 0 && ((a_sw_lon >= b_sw_lon && a_ne_lon <= b_ne_lon) || (a_sw_lon <= b_sw_lon && a_ne_lon >= b_ne_lon))) {\n                return S;\n            }\n        }\n        return -1;\n    }\n    // // TODO: test test test\n    // public ___getCommonSide___(b: Node) {\n    //     let a = this, as = a.segment, bs = b.segment;\n    //\n    //     if (as.tileZoom === bs.tileZoom) {\n    //         return as.getNeighborSide(bs);\n    //     } else if (as.tileZoom > bs.tileZoom) {\n    //         let dz = as.tileZoom - bs.tileZoom, i = dz, p: Node = this;\n    //\n    //         while (i--) {\n    //             p = p.parentNode!;\n    //         }\n    //\n    //         let side = p.segment.getNeighborSide(bs);\n    //\n    //         if (side !== -1) {\n    //             i = dz;\n    //             p = this;\n    //             let _n = true;\n    //\n    //             while (i--) {\n    //                 _n = _n && COMSIDE[p.partId][side];\n    //             }\n    //\n    //             if (_n) {\n    //                 return side;\n    //             }\n    //         }\n    //     } else {\n    //         let dz = bs.tileZoom - as.tileZoom, i = dz, p = b;\n    //\n    //         while (i--) {\n    //             p = p.parentNode!;\n    //         }\n    //\n    //         let side = p.segment.getNeighborSide(as);\n    //\n    //         if (side !== -1) {\n    //             i = dz;\n    //             p = b;\n    //             let _n = true;\n    //\n    //             while (i--) {\n    //                 _n = _n && COMSIDE[p.partId][side];\n    //             }\n    //\n    //             if (_n) {\n    //                 return OPSIDE[side];\n    //             }\n    //         }\n    //     }\n    //\n    //     return -1;\n    // }\n    whileNormalMapCreating() {\n        const seg = this.segment;\n        if (!seg.terrainIsLoading && seg.terrainExists && !seg._inTheQueue) {\n            seg.planet._normalMapCreator.queue(seg);\n        }\n        let pn = this;\n        while (pn.parentNode && !pn.segment.normalMapReady) {\n            pn = pn.parentNode;\n        }\n        const dZ2 = 2 << (seg.tileZoom - pn.segment.tileZoom - 1);\n        seg.normalMapTexture = pn.segment.normalMapTexture;\n        seg.normalMapTextureBias[0] = seg.tileX - pn.segment.tileX * dZ2;\n        seg.normalMapTextureBias[1] = seg.tileY - pn.segment.tileY * dZ2;\n        seg.normalMapTextureBias[2] = 1.0 / dZ2;\n    }\n    whileTerrainLoading(terrainReadySegment) {\n        const seg = this.segment;\n        let pn = this;\n        if (terrainReadySegment && terrainReadySegment.terrainReady) {\n            pn = terrainReadySegment.node;\n        }\n        else {\n            while (pn.parentNode && !pn.segment.terrainReady) {\n                pn = pn.parentNode;\n            }\n        }\n        if (pn.segment.terrainReady && this.appliedTerrainNodeId !== pn.nodeId) {\n            let dZ2 = 2 << (seg.tileZoom - pn.segment.tileZoom - 1), offsetX = seg.tileX - pn.segment.tileX * dZ2, offsetY = seg.tileY - pn.segment.tileY * dZ2;\n            const pseg = pn.segment;\n            let tempVertices, tempVerticesHigh, tempVerticesLow, noDataVertices;\n            this.appliedTerrainNodeId = pn.nodeId;\n            this.equalizedSideWithNodeId[N] = this.equalizedSideWithNodeId[E] = this.equalizedSideWithNodeId[S] = this.equalizedSideWithNodeId[W] = this.appliedTerrainNodeId;\n            let gridSize = pn.segment.gridSize / dZ2, gridSizeExt = pn.segment.fileGridSize / dZ2;\n            BOUNDS.xmin = MAX;\n            BOUNDS.xmax = MIN;\n            BOUNDS.ymin = MAX;\n            BOUNDS.ymax = MIN;\n            BOUNDS.zmin = MAX;\n            BOUNDS.zmax = MIN;\n            if (gridSize >= 1) {\n                seg.gridSize = gridSize;\n                let len = (gridSize + 1) * (gridSize + 1) * 3;\n                tempVertices = new Float64Array(len);\n                tempVerticesHigh = new Float32Array(len);\n                tempVerticesLow = new Float32Array(len);\n                if (pseg.noDataVertices) {\n                    noDataVertices = new Uint8Array(len / 3);\n                }\n                getMatrixSubArrayBoundsExt(pseg.terrainVertices, pseg.terrainVerticesHigh, pseg.terrainVerticesLow, pseg.noDataVertices, pseg.gridSize, gridSize * offsetY, gridSize * offsetX, gridSize, tempVertices, tempVerticesHigh, tempVerticesLow, BOUNDS, noDataVertices);\n            }\n            else if (gridSizeExt >= 1 && pn.segment.terrainExists) {\n                seg.gridSize = gridSizeExt;\n                let len = (gridSizeExt + 1) * (gridSizeExt + 1) * 3;\n                tempVertices = new Float64Array(len);\n                tempVerticesHigh = new Float32Array(len);\n                tempVerticesLow = new Float32Array(len);\n                if (pseg.noDataVertices) {\n                    noDataVertices = new Uint8Array(len / 3);\n                }\n                getMatrixSubArrayBoundsExt(pseg.normalMapVertices, pseg.normalMapVerticesHigh, pseg.normalMapVerticesLow, pseg.noDataVertices, pn.segment.fileGridSize, gridSizeExt * offsetY, gridSizeExt * offsetX, gridSizeExt, tempVertices, tempVerticesHigh, tempVerticesLow, BOUNDS, noDataVertices);\n            }\n            else {\n                seg.gridSize = _neGridSize;\n                let i0 = Math.floor(gridSize * offsetY), j0 = Math.floor(gridSize * offsetX);\n                let bigOne;\n                if (pseg.gridSize === 1) {\n                    bigOne = pseg.terrainVertices;\n                }\n                else {\n                    bigOne = getMatrixSubArray64(pseg.terrainVertices, pseg.gridSize, i0, j0, 1);\n                }\n                let insideSize = 1.0 / gridSize;\n                let t_i0 = offsetY - insideSize * i0, t_j0 = offsetX - insideSize * j0;\n                let v_lt = new Vec3(bigOne[0], bigOne[1], bigOne[2]), v_rb = new Vec3(bigOne[9], bigOne[10], bigOne[11]);\n                let vn = new Vec3(bigOne[3] - bigOne[0], bigOne[4] - bigOne[1], bigOne[5] - bigOne[2]), vw = new Vec3(bigOne[6] - bigOne[0], bigOne[7] - bigOne[1], bigOne[8] - bigOne[2]), ve = new Vec3(bigOne[3] - bigOne[9], bigOne[4] - bigOne[10], bigOne[5] - bigOne[11]), vs = new Vec3(bigOne[6] - bigOne[9], bigOne[7] - bigOne[10], bigOne[8] - bigOne[11]);\n                let coords = new Vec3();\n                tempVertices = new Float64Array(3 * _vertOrder.length);\n                tempVerticesHigh = new Float32Array(3 * _vertOrder.length);\n                tempVerticesLow = new Float32Array(3 * _vertOrder.length);\n                for (let i = 0; i < _vertOrder.length; i++) {\n                    let vi_y = _vertOrder[i].y + t_i0, vi_x = _vertOrder[i].x + t_j0;\n                    let vi_x_is = vi_x * gridSize, vi_y_is = vi_y * gridSize;\n                    if (vi_y + vi_x < insideSize) {\n                        coords = vn.scaleTo(vi_x_is).addA(vw.scaleTo(vi_y_is)).addA(v_lt);\n                    }\n                    else {\n                        coords = vs.scaleTo(1 - vi_x_is).addA(ve.scaleTo(1 - vi_y_is)).addA(v_rb);\n                    }\n                    Vec3.doubleToTwoFloats(coords, _tempHigh, _tempLow);\n                    let i3 = i * 3;\n                    tempVertices[i3] = coords.x;\n                    tempVertices[i3 + 1] = coords.y;\n                    tempVertices[i3 + 2] = coords.z;\n                    tempVerticesHigh[i3] = _tempHigh.x;\n                    tempVerticesHigh[i3 + 1] = _tempHigh.y;\n                    tempVerticesHigh[i3 + 2] = _tempHigh.z;\n                    tempVerticesLow[i3] = _tempLow.x;\n                    tempVerticesLow[i3 + 1] = _tempLow.y;\n                    tempVerticesLow[i3 + 2] = _tempLow.z;\n                    if (coords.x < BOUNDS.xmin)\n                        BOUNDS.xmin = coords.x;\n                    if (coords.x > BOUNDS.xmax)\n                        BOUNDS.xmax = coords.x;\n                    if (coords.y < BOUNDS.ymin)\n                        BOUNDS.ymin = coords.y;\n                    if (coords.y > BOUNDS.ymax)\n                        BOUNDS.ymax = coords.y;\n                    if (coords.z < BOUNDS.zmin)\n                        BOUNDS.zmin = coords.z;\n                    if (coords.z > BOUNDS.zmax)\n                        BOUNDS.zmax = coords.z;\n                }\n            }\n            seg.readyToEngage = true;\n            seg.terrainVertices = tempVertices;\n            seg.terrainVerticesHigh = tempVerticesHigh;\n            seg.terrainVerticesLow = tempVerticesLow;\n            seg.tempVertices = tempVertices;\n            seg.tempVerticesHigh = tempVerticesHigh;\n            seg.tempVerticesLow = tempVerticesLow;\n            seg.noDataVertices = noDataVertices;\n            seg.setBoundingVolume(BOUNDS.xmin, BOUNDS.ymin, BOUNDS.zmin, BOUNDS.xmax, BOUNDS.ymax, BOUNDS.zmax);\n            if (seg.tileZoom > seg.planet.terrain.maxZoom) {\n                if (pn.segment.tileZoom >= seg.planet.terrain.maxZoom) {\n                    seg._plainRadius = pn.segment._plainRadius / dZ2;\n                    seg.terrainReady = true;\n                    seg.terrainIsLoading = false;\n                    seg.terrainVertices = tempVertices;\n                    seg.terrainVerticesHigh = tempVerticesHigh;\n                    seg.terrainVerticesLow = tempVerticesLow;\n                    seg.passReady = true;\n                    this.appliedTerrainNodeId = this.nodeId;\n                    this.equalizedSideWithNodeId[N] = this.equalizedSideWithNodeId[E] = this.equalizedSideWithNodeId[S] = this.equalizedSideWithNodeId[W] = this.appliedTerrainNodeId;\n                    if (pn.segment.terrainExists) {\n                        seg.normalMapVertices = tempVertices;\n                        seg.fileGridSize = Math.sqrt(tempVertices.length / 3) - 1;\n                        let fgs = Math.sqrt(pseg.normalMapNormals.length / 3) - 1, fgsZ = fgs / dZ2;\n                        if (fgs > 1) {\n                            seg.normalMapNormals = getMatrixSubArray32(pseg.normalMapNormals, fgs, fgsZ * offsetY, fgsZ * offsetX, fgsZ);\n                        }\n                        else {\n                            // TODO: interpolation\n                            seg.normalMapNormals = pseg.normalMapNormals;\n                        }\n                    }\n                }\n            }\n        }\n    }\n    destroy() {\n        this.prevState = this.state = NOTRENDERING;\n        this.segment.destroySegment();\n        let n = this.neighbors;\n        for (let i = 0, len = n.length; i < len; i++) {\n            let ni = n[i];\n            if (ni) {\n                for (let j = 0; j < ni.length; j++) {\n                    let nij = ni[j];\n                    if (nij && nij.neighbors) {\n                        nij.clearNeighbors();\n                    }\n                }\n            }\n        }\n        // @ts-ignore\n        this.neighbors = null;\n        // @ts-ignore\n        this.parentNode = null;\n        // @ts-ignore\n        this.sideSizeLog2 = null;\n        // @ts-ignore\n        this.segment = null;\n    }\n    clearTree() {\n        const state = this.getState();\n        if (state === NOTRENDERING || state === RENDERING) {\n            this.destroyBranches();\n        }\n        else {\n            for (let i = 0; i < this.nodes.length; i++) {\n                this.nodes[i] && this.nodes[i].clearTree();\n            }\n        }\n    }\n    clearBranches() {\n        for (let i = 0; i < this.nodes.length; i++) {\n            this.nodes[i].clearBranches();\n            this.nodes[i].segment.deleteMaterials();\n        }\n    }\n    destroyBranches() {\n        if (this.ready) {\n            let nodesToRemove = [], i;\n            for (i = 0; i < this.nodes.length; i++) {\n                nodesToRemove[i] = this.nodes[i];\n            }\n            this.ready = false;\n            this.nodes = [];\n            for (i = 0; i < nodesToRemove.length; i++) {\n                nodesToRemove[i].destroyBranches();\n                nodesToRemove[i].destroy();\n                //@ts-ignore\n                nodesToRemove[i] = null;\n            }\n            nodesToRemove.length = 0;\n            // @ts-ignore\n            nodesToRemove = null;\n        }\n    }\n    traverseTree(callback) {\n        callback(this);\n        if (this.ready) {\n            for (let i = 0; i < this.nodes.length; i++) {\n                this.nodes[i].traverseTree(callback);\n            }\n        }\n    }\n    getOffsetOppositeNeighbourSide(neighbourNode, side) {\n        let pNode = this, neighbourZoom = neighbourNode.segment.tileZoom, offset = 0;\n        while (pNode.segment.tileZoom > neighbourZoom) {\n            offset += PARTOFFSET[pNode.partId][side] / (1 << (pNode.segment.tileZoom - neighbourZoom));\n            pNode = pNode.parentNode;\n        }\n        return offset;\n    }\n}\nexport { Node };\n//# sourceMappingURL=Node.js.map","import { EPSG3857 } from \"../proj/EPSG3857\";\nexport class QuadTreeStrategy {\n    constructor(planet, name = \"\", proj = EPSG3857) {\n        this.name = name;\n        this.projection = proj;\n        this._planet = planet;\n        this._quadTreeList = [];\n    }\n    destroyBranches() {\n        for (let i = 0, len = this._quadTreeList.length; i < len; i++) {\n            this._quadTreeList[i].destroyBranches();\n        }\n    }\n    clearLayerMaterial(layer) {\n        let lid = layer.__id;\n        for (let i = 0, len = this._quadTreeList.length; i < len; i++) {\n            this._quadTreeList[i].traverseTree(function (node) {\n                let mats = node.segment.materials;\n                if (mats[lid]) {\n                    mats[lid].clear();\n                    //@ts-ignore\n                    mats[lid] = null;\n                    //delete mats[lid];\n                }\n            });\n        }\n    }\n    get planet() {\n        return this._planet;\n    }\n    init() {\n    }\n    preRender() {\n        for (let i = 0; i < this._quadTreeList.length; i++) {\n            let quadTree = this._quadTreeList[i];\n            quadTree.createChildrenNodes();\n            quadTree.segment.createPlainSegment();\n            for (let j = 0; j < quadTree.nodes.length; j++) {\n                quadTree.nodes[j].segment.createPlainSegment();\n            }\n        }\n    }\n    preLoad() {\n        for (let i = 0; i < this._quadTreeList.length; i++) {\n            let quadTree = this._quadTreeList[i];\n            quadTree.segment.passReady = true;\n            quadTree.renderNode(1);\n            this._planet.normalMapCreator.drawSingle(quadTree.segment);\n            for (let j = 0; j < quadTree.nodes.length; j++) {\n                quadTree.nodes[j].segment.passReady = true;\n                quadTree.nodes[j].renderNode(1);\n                this._planet._normalMapCreator.drawSingle(quadTree.nodes[j].segment);\n            }\n        }\n    }\n    collectRenderNodes() {\n        for (let i = 0; i < this._quadTreeList.length; i++) {\n            this._quadTreeList[i].renderTree(this._planet.camera, 0, null);\n        }\n    }\n    clear() {\n        for (let i = 0; i < this._quadTreeList.length; i++) {\n            this._quadTreeList[i].clearTree();\n        }\n    }\n    get quadTreeList() {\n        return this._quadTreeList;\n    }\n}\n//# sourceMappingURL=QuadTreeStrategy.js.map","import * as mercator from \"../mercator\";\nimport * as quadTree from \"../quadTree/quadTree\";\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { Extent } from \"../Extent\";\nimport { Layer } from \"../layer/Layer\";\nimport { Segment, TILEGROUP_NORTH, TILEGROUP_SOUTH } from \"./Segment\";\nimport { LonLat } from \"../LonLat\";\nimport { Vec3 } from \"../math/Vec3\";\nconst MAX_POLE_ZOOM = 7;\nexport const POLE_PIECE_SIZE = (90.0 - mercator.MAX_LAT) / Math.pow(2, MAX_POLE_ZOOM);\nlet _tempHigh = new Vec3(), _tempLow = new Vec3();\n/**\n * Planet segment Web Mercator tile class that stored and rendered with quad tree.\n * @class\n * @extends {Segment}\n */\nclass SegmentLonLat extends Segment {\n    constructor(node, planet, tileZoom, extent) {\n        super(node, planet, tileZoom, extent);\n        this._projection = EPSG4326;\n        this._extentLonLat = this._extent;\n        this._extentMerc = new Extent(extent.southWest.forwardMercatorEPS01(), extent.northEast.forwardMercatorEPS01());\n        this._isNorth = this._extent.northEast.lat > 0;\n        this.isPole = true;\n    }\n    _setExtentLonLat() {\n        this._extentLonLat = this._extent;\n    }\n    projectNative(coords) {\n        return coords;\n    }\n    getInsideLonLat(obj) {\n        return obj._lonLat;\n    }\n    _getMaxZoom() {\n        let maxPoleZoom = 0;\n        if (this._isNorth) {\n            //north pole limits\n            let Yz = Math.floor((90.0 - this._extent.northEast.lat) / POLE_PIECE_SIZE);\n            maxPoleZoom = Math.floor(Yz / 16) + 7;\n        }\n        else {\n            //south pole limits\n            let Yz = Math.floor((mercator.MIN_LAT - this._extent.northEast.lat) / POLE_PIECE_SIZE);\n            maxPoleZoom = 12 - Math.floor(Yz / 16);\n        }\n        return maxPoleZoom;\n    }\n    checkZoom() {\n        return super.checkZoom() && this.tileZoom <= this._getMaxZoom();\n    }\n    _assignTileIndexes() {\n        this._assignTileXIndexes(this._extent);\n        this._assignTileYIndexes(this._extent);\n        this.tileIndex = Layer.getTileIndex(this.tileX, this.tileY, this.tileZoom);\n    }\n    _assignTileXIndexes(extent) {\n        this.tileX = Math.round(Math.abs(-180.0 - extent.southWest.lon) / (extent.northEast.lon - extent.southWest.lon));\n        let p2 = 1 << this.tileZoom;\n        this.tileXE = (this.tileX + 1) % p2;\n        this.tileXW = (p2 + this.tileX - 1) % p2;\n    }\n    _assignTileYIndexes(extent) {\n        const lat = extent.northEast.lat;\n        if (lat > 0) {\n            this._tileGroup = TILEGROUP_NORTH;\n            this.tileY = Math.round((90.0 - lat) / (extent.northEast.lat - extent.southWest.lat));\n        }\n        else {\n            this._tileGroup = TILEGROUP_SOUTH;\n            this.tileY = Math.round((mercator.MIN_LAT - lat) / (extent.northEast.lat - extent.southWest.lat));\n        }\n        this.tileYN = this.tileY - 1;\n        this.tileYS = this.tileY + 1;\n    }\n    _createPlainVertices() {\n        const gridSize = this.planet.terrain.gridSizeByZoom[this.tileZoom];\n        const e = this._extent;\n        const fgs = this.planet.terrain.plainGridSize;\n        const lonSize = e.getWidth();\n        const latSize = e.getHeight();\n        const llStep = lonSize / Math.max(fgs, gridSize);\n        const ltStep = latSize / gridSize;\n        const esw_lon = e.southWest.lon;\n        const ene_lat = e.northEast.lat;\n        const dg = Math.max(fgs / gridSize, 1);\n        const gs = Math.max(fgs, gridSize) + 1;\n        const r2 = this.planet.ellipsoid._invRadii2;\n        let ind = 0, nmInd = 0;\n        const gsgs = gs * gs;\n        const gridSize3 = (gridSize + 1) * (gridSize + 1) * 3;\n        this.plainNormals = new Float32Array(gridSize3);\n        this.plainVertices = new Float64Array(gridSize3);\n        this.plainVerticesHigh = new Float32Array(gridSize3);\n        this.plainVerticesLow = new Float32Array(gridSize3);\n        this.normalMapNormals = new Float32Array(gsgs * 3);\n        this.normalMapVertices = new Float64Array(gsgs * 3);\n        this.normalMapVerticesHigh = new Float32Array(gsgs * 3);\n        this.normalMapVerticesLow = new Float32Array(gsgs * 3);\n        let xmin = 549755748352.0, xmax = -549755748352.0, ymin = 549755748352.0, ymax = -549755748352.0, zmin = 549755748352.0, zmax = -549755748352.0;\n        let verts = this.plainVertices, vertsHigh = this.plainVerticesHigh, vertsLow = this.plainVerticesLow, norms = this.plainNormals, nmVerts = this.normalMapVertices, nmVertsHigh = this.normalMapVerticesHigh, nmVertsLow = this.normalMapVerticesLow, nmNorms = this.normalMapNormals;\n        for (let k = 0; k < gsgs; k++) {\n            let j = k % gs, i = ~~(k / gs);\n            const v = this.planet.ellipsoid.lonLatToCartesian(new LonLat(esw_lon + j * llStep, ene_lat - i * ltStep));\n            let nx = v.x * r2.x, ny = v.y * r2.y, nz = v.z * r2.z;\n            let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n            let nxl = nx * l, nyl = ny * l, nzl = nz * l;\n            Vec3.doubleToTwoFloats(v, _tempHigh, _tempLow);\n            nmVerts[nmInd] = v.x;\n            nmVertsHigh[nmInd] = _tempHigh.x;\n            nmVertsLow[nmInd] = _tempLow.x;\n            nmNorms[nmInd++] = nxl;\n            nmVerts[nmInd] = v.y;\n            nmVertsHigh[nmInd] = _tempHigh.y;\n            nmVertsLow[nmInd] = _tempLow.y;\n            nmNorms[nmInd++] = nyl;\n            nmVerts[nmInd] = v.z;\n            nmVertsHigh[nmInd] = _tempHigh.z;\n            nmVertsLow[nmInd] = _tempLow.z;\n            nmNorms[nmInd++] = nzl;\n            if (i % dg === 0 && j % dg === 0) {\n                verts[ind] = v.x;\n                vertsHigh[ind] = _tempHigh.x;\n                vertsLow[ind] = _tempLow.x;\n                norms[ind++] = nxl;\n                verts[ind] = v.y;\n                vertsHigh[ind] = _tempHigh.y;\n                vertsLow[ind] = _tempLow.y;\n                norms[ind++] = nyl;\n                verts[ind] = v.z;\n                vertsHigh[ind] = _tempHigh.z;\n                vertsLow[ind] = _tempLow.z;\n                norms[ind++] = nzl;\n                if (v.x < xmin)\n                    xmin = v.x;\n                if (v.x > xmax)\n                    xmax = v.x;\n                if (v.y < ymin)\n                    ymin = v.y;\n                if (v.y > ymax)\n                    ymax = v.y;\n                if (v.z < zmin)\n                    zmin = v.z;\n                if (v.z > zmax)\n                    zmax = v.z;\n            }\n        }\n        this.terrainVertices = verts;\n        this.terrainVerticesHigh = vertsHigh;\n        this.terrainVerticesLow = vertsLow;\n        let x = (xmax - xmin) * 0.5, y = (ymax - ymin) * 0.5, z = (zmax - zmin) * 0.5;\n        this._plainRadius = Math.sqrt(x * x + y * y + z * z);\n        this.plainReady = true;\n    }\n    _assignGlobalTextureCoordinates() {\n        const e = this._extent;\n        this._globalTextureCoordinates[0] = (e.southWest.lon + 180.0) / 360.0;\n        this._globalTextureCoordinates[1] = (90 - e.northEast.lat) / 180.0;\n        this._globalTextureCoordinates[2] = (e.northEast.lon + 180.0) / 360.0;\n        this._globalTextureCoordinates[3] = (90 - e.southWest.lat) / 180.0;\n    }\n    /**\n     * @todo: replace to the strategy\n     */\n    _collectVisibleNodes() {\n        if (this._isNorth) {\n            this.planet._visibleNodesNorth[this.node.nodeId] = this.node;\n        }\n        else {\n            this.planet._visibleNodesSouth[this.node.nodeId] = this.node;\n        }\n    }\n    /**\n     * @param layer\n     * @protected\n     *\n     * @todo simplify layer._extentMerc in layer.getNativeExtent(this)\n     *\n     */\n    _getLayerExtentOffset(layer) {\n        const v0s = layer._extent;\n        const v0t = this._extent;\n        const sSize_x = v0s.northEast.lon - v0s.southWest.lon;\n        const sSize_y = v0s.northEast.lat - v0s.southWest.lat;\n        const dV0s_x = (v0t.southWest.lon - v0s.southWest.lon) / sSize_x;\n        const dV0s_y = (v0s.northEast.lat - v0t.northEast.lat) / sSize_y;\n        const dSize_x = (v0t.northEast.lon - v0t.southWest.lon) / sSize_x;\n        const dSize_y = (v0t.northEast.lat - v0t.southWest.lat) / sSize_y;\n        return [dV0s_x, dV0s_y, dSize_x, dSize_y];\n    }\n    layerOverlap(layer) {\n        return this._extent.overlaps(layer._extent);\n    }\n    getDefaultTexture() {\n        return this._isNorth ? this.planet.solidTextureOne : this.planet.solidTextureTwo;\n    }\n    getExtentLonLat() {\n        return this._extent;\n    }\n    /**\n     * @todo: replace to the strategy\n     */\n    getNodeState() {\n        let vn;\n        if (this._isNorth) {\n            vn = this.planet._visibleNodesNorth[this.node.nodeId];\n        }\n        else {\n            vn = this.planet._visibleNodesSouth[this.node.nodeId];\n        }\n        return (vn && vn.state) || quadTree.NOTRENDERING;\n    }\n}\nexport { SegmentLonLat };\n//# sourceMappingURL=SegmentLonLat.js.map","import * as mercator from \"../mercator\";\nimport * as quadTree from \"../quadTree/quadTree\";\nimport { Extent } from \"../Extent\";\nimport { Node } from \"../quadTree/Node\";\nimport { QuadTreeStrategy } from \"./QuadTreeStrategy\";\nimport { Segment } from \"../segment/Segment\";\nimport { SegmentLonLat } from \"../segment/SegmentLonLat\";\nexport class EarthQuadTreeStrategy extends QuadTreeStrategy {\n    constructor(planet) {\n        super(planet, \"Earth\");\n    }\n    init() {\n        this._quadTreeList = [\n            new Node(Segment, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-20037508.34, -20037508.34, 20037508.34, 20037508.34])),\n            new Node(SegmentLonLat, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-180, mercator.MAX_LAT, 180, 90])),\n            new Node(SegmentLonLat, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-180, -90, 180, mercator.MIN_LAT]))\n        ];\n    }\n}\n//# sourceMappingURL=EarthQuadTreeStrategy.js.map","/* This file is mostly a straight translation of\n * GeographicLib/src/Geoid.cpp from C++ to JavaScript\n * by Kim Vandry <vandry@TZoNE.ORG>\n *\n * @license\n *  **\n * * \\file Geoid.cpp\n * * \\brief Implementation for GeographicLib::Geoid class\n * *\n * * Copyright (c) Charles Karney (2009) <charles@karney.com>\n * * and licensed under the LGPL.  For more information, see\n * * http://geographiclib.sourceforge.net/\n * **********************************************************************\n *\n * Geoid height grade not supported\n * The files can be downloaded from here:\n * http://geographiclib.sourceforge.net/1.18/geoid.html\n */\nclass Geoid {\n    constructor(options = {}) {\n        this.model = options.model || null;\n        this.src = options.src || null;\n        this._cached_ix = 0;\n        this._cached_iy = 0;\n        this._v00 = 0;\n        this._v01 = 0;\n        this._v10 = 0;\n        this._v11 = 0;\n        this._t = 0;\n    }\n    static loadModel(url) {\n        if (!url) {\n            return new Promise((resolve) => {\n                resolve(null);\n            });\n        }\n        else\n            return fetch(url, {})\n                .then((r) => {\n                if (!r.ok) {\n                    throw Error(\"Geoid model file: HTTP error \" + r.status);\n                }\n                return r.arrayBuffer();\n            })\n                .then((r) => {\n                if (r) {\n                    return new Uint8Array(r);\n                }\n                else {\n                    throw Error(\"Geoid model file: no data from \" + url);\n                }\n            })\n                .then(function (rawfile) {\n                if (!((rawfile[0] === 80) && (rawfile[1] === 53) && (((rawfile[2] === 13) && (rawfile[3] === 10)) ||\n                    (rawfile[2] === 10)))) {\n                    throw new Error(\"Geoid model file: no PGM header\");\n                }\n                var i = (rawfile[2] === 13) ? 4 : 3;\n                var offset = null;\n                var scale = null;\n                function getline() {\n                    let start = i;\n                    for (var j = i;; j++) {\n                        if (j >= rawfile.length) {\n                            throw new Error(\"Geoid model file: missing newline in header\");\n                        }\n                        if (rawfile[j] === 10) {\n                            i = j + 1;\n                            break;\n                        }\n                    }\n                    if ((j > start) && (rawfile[j - 1] === 13))\n                        j--;\n                    return String.fromCharCode.apply(null, rawfile.slice(start, j));\n                }\n                var m, s;\n                for (;;) {\n                    s = getline();\n                    if (s[0] !== '#')\n                        break;\n                    m = s.match(/^# Offset (.*)$/);\n                    if (m) {\n                        offset = parseInt(m[1], 10);\n                        if (!isFinite(offset)) {\n                            throw new Error(\"Geoid model file: bad offset \" + m[1]);\n                        }\n                    }\n                    else {\n                        m = s.match(/^# Scale (.*)$/);\n                        if (m) {\n                            scale = parseFloat(m[1]);\n                            if (!isFinite(scale)) {\n                                throw new Error(\"Geoid model file: bad scale \" + m[1]);\n                            }\n                        }\n                    }\n                }\n                m = s.match(/^\\s*(\\d+)\\s+(\\d+)\\s*$/);\n                let width = 0;\n                let height = 0;\n                if (m) {\n                    width = parseInt(m[1], 10);\n                    height = parseInt(m[2], 10);\n                }\n                if (!(m && (width >= 0) && (height >= 0))) {\n                    throw new Error(\"Geoid model file: bad PGM width&height line\");\n                }\n                let levels = parseInt(getline());\n                if (levels != 65535) {\n                    throw new Error(\"Geoid model file: PGM file must have 65535 gray levels\");\n                }\n                if (offset === null) {\n                    throw new Error(\"Geoid model file: PGM file does not contain offset\");\n                }\n                if (scale === null) {\n                    throw new Error(\"Geoid model file: PGM file does not contain scale\");\n                }\n                if ((width < 2) || (height < 2)) {\n                    throw new Error(\"Geoid model file: Raster size too small\");\n                }\n                let payload_len = rawfile.length - i;\n                if (payload_len !== (width * height * 2)) {\n                    throw new Error(\"Geoid model file: File has the wrong length\");\n                }\n                return {\n                    scale: scale,\n                    offset: offset,\n                    width: width,\n                    height: height,\n                    rlonres: width / 360,\n                    rlatres: (height - 1) / 180,\n                    i: i,\n                    rawfile: rawfile\n                };\n            });\n    }\n    setModel(model) {\n        this.model = model;\n    }\n    _rawval(ix, iy) {\n        let model = this.model;\n        if (iy < 0) {\n            iy = -iy;\n            ix += model.width / 2;\n        }\n        else if (iy >= model.height) {\n            iy = 2 * (model.height - 1) - iy;\n            ix += model.width / 2;\n        }\n        if (ix < 0) {\n            ix += model.width;\n        }\n        else if (ix >= model.width) {\n            ix -= model.width;\n        }\n        let k = (iy * model.width + ix) * 2 + model.i;\n        return (model.rawfile[k] << 8) | model.rawfile[k + 1];\n    }\n    getHeightLonLat(lonlat) {\n        return this.getHeight(lonlat.lon, lonlat.lat);\n    }\n    getHeight(lon, lat) {\n        if (!this.model)\n            return 0;\n        let model = this.model;\n        if (lon < 0)\n            lon += 360.0;\n        let fy = (90 - lat) * model.rlatres;\n        let fx = lon * model.rlonres;\n        let iy = Math.floor(fy);\n        let ix = Math.floor(fx);\n        fx -= ix;\n        fy -= iy;\n        if (iy === (model.height - 1)) {\n            iy--;\n        }\n        if ((this._cached_ix !== ix) || (this._cached_iy !== iy)) {\n            this._cached_ix = ix;\n            this._cached_iy = iy;\n            this._v00 = this._rawval(ix, iy);\n            this._v01 = this._rawval(ix + 1, iy);\n            this._v10 = this._rawval(ix, iy + 1);\n            this._v11 = this._rawval(ix + 1, iy + 1);\n        }\n        let a = (1 - fx) * this._v00 + fx * this._v01;\n        let b = (1 - fx) * this._v10 + fx * this._v11;\n        let h = (1 - fy) * a + fy * b;\n        return model.offset + model.scale * h;\n    }\n}\nexport { Geoid };\n//# sourceMappingURL=Geoid.js.map","import * as utils from '../utils/shared';\nimport { Framebuffer } from '../webgl/Framebuffer';\nimport { LonLat } from '../LonLat';\nimport { Program } from '../webgl/Program';\nimport { doubleToTwoFloats2 } from \"../math/coder\";\nexport class GeoImageCreator {\n    constructor(planet, maxFrames = 5) {\n        this.MAX_FRAMES = maxFrames;\n        this._gridSize = 64;\n        this._planet = planet;\n        this._framebuffer = null;\n        this._framebufferMercProj = null;\n        this._texCoordsBuffer = null;\n        this._indexBuffer = null;\n        this._currentFrame = 0;\n        this._queue = [];\n        this._animate = [];\n        this._quadTexCoordsBuffer = null;\n        this._quadVertexBuffer = null;\n    }\n    init() {\n        this._initShaders();\n        this._initBuffers();\n    }\n    /**\n     * Creates geoImage corners coordinates grid buffer.\n     * @public\n     * @param{Array.<LonLat>} c - GeoImage corners coordinates.\n     * @param{boolean} [toMerc=false] - Transform to web mercator.\n     * @return{WebGLBuffer} Grid coordinates buffer.\n     */\n    createGridBuffer(c, toMerc = false) {\n        let gs = this._gridSize;\n        let v03 = new LonLat((c[3].lon - c[0].lon) / gs, (c[3].lat - c[0].lat) / gs), v12 = new LonLat((c[2].lon - c[1].lon) / gs, (c[2].lat - c[1].lat) / gs), v01 = new LonLat((c[1].lon - c[0].lon) / gs, (c[1].lat - c[0].lat) / gs), v32 = new LonLat((c[2].lon - c[3].lon) / gs, (c[2].lat - c[3].lat) / gs);\n        const size = (gs + 1) * (gs + 1) * 2, halfSize = size / 2;\n        let gridHigh = new Float32Array(size), gridLow = new Float32Array(size);\n        let lonLatArr = new Array(halfSize);\n        let kh = 0, kl = 0, k = 0;\n        let tempArr = new Float32Array(2);\n        for (let i = 0; i <= gs; i++) {\n            let P03i = new LonLat(c[0].lon + i * v03.lon, c[0].lat + i * v03.lat), P12i = new LonLat(c[1].lon + i * v12.lon, c[1].lat + i * v12.lat);\n            for (let j = 0; j <= gs; j++) {\n                let P01j = new LonLat(c[0].lon + j * v01.lon, c[0].lat + j * v01.lat), P32j = new LonLat(c[3].lon + j * v32.lon, c[3].lat + j * v32.lat);\n                let xx = utils.getLinesIntersectionLonLat(P03i, P12i, P01j, P32j);\n                doubleToTwoFloats2(xx.lon, tempArr);\n                gridHigh[kh++] = tempArr[0];\n                gridLow[kl++] = tempArr[1];\n                doubleToTwoFloats2(xx.lat, tempArr);\n                gridHigh[kh++] = tempArr[0];\n                gridLow[kl++] = tempArr[1];\n                lonLatArr[k++] = xx;\n            }\n        }\n        if (toMerc) {\n            for (let i = 0; i < halfSize; i++) {\n                let c = lonLatArr[i].forwardMercator();\n                doubleToTwoFloats2(c.lon, tempArr);\n                gridHigh[i * 2] = tempArr[0];\n                gridLow[i * 2] = tempArr[1];\n                doubleToTwoFloats2(c.lat, tempArr);\n                gridHigh[i * 2 + 1] = tempArr[0];\n                gridLow[i * 2 + 1] = tempArr[1];\n            }\n        }\n        return [\n            this._planet.renderer.handler.createArrayBuffer(gridHigh, 2, halfSize),\n            this._planet.renderer.handler.createArrayBuffer(gridLow, 2, halfSize)\n        ];\n    }\n    frame() {\n        let i = this.MAX_FRAMES;\n        while (i-- && this._queue.length) {\n            const q = this._queue.shift();\n            q._isRendering = false;\n            q.rendering();\n            q.events.dispatch(q.events.loadend);\n        }\n        i = this._animate.length;\n        while (i--) {\n            this._animate[i].rendering();\n        }\n    }\n    add(geoImage) {\n        if (!geoImage._isRendering) {\n            geoImage._isRendering = true;\n            if (geoImage._animate) {\n                this._animate.push(geoImage);\n            }\n            else {\n                this._queue.push(geoImage);\n            }\n        }\n    }\n    remove(geoImage) {\n        if (geoImage._isRendering) {\n            geoImage._creationProceeding = false;\n            geoImage._isRendering = false;\n            let arr;\n            if (geoImage._animate) {\n                arr = this._animate;\n            }\n            else {\n                arr = this._queue;\n            }\n            for (let i = 0; i < arr.length; i++) {\n                if (arr[i].isEqual(geoImage)) {\n                    arr.splice(i, 1);\n                    return;\n                }\n            }\n        }\n    }\n    _initBuffers() {\n        let h = this._planet.renderer.handler;\n        this._framebuffer = new Framebuffer(h, { width: 2, height: 2, useDepth: false });\n        this._framebuffer.init();\n        this._framebufferMercProj = new Framebuffer(h, { width: 2, height: 2, useDepth: false });\n        this._framebufferMercProj.init();\n        let gs = Math.log2(this._gridSize);\n        this._texCoordsBuffer = this._planet._textureCoordsBufferCache[gs];\n        this._indexBuffer = this._planet._indexesCache[gs][gs][gs][gs][gs].buffer;\n        this._quadTexCoordsBuffer = h.createArrayBuffer(new Float32Array([0, 1, 1, 1, 0, 0, 1, 0]), 2, 4);\n        this._quadVertexBuffer = h.createArrayBuffer(new Float32Array([-1, 1, 1, 1, -1, -1, 1, -1]), 2, 4);\n    }\n    _initShaders() {\n        this._planet.renderer.handler.addProgram(new Program(\"geoImageTransform\", {\n            uniforms: {\n                sourceTexture: \"sampler2d\",\n                extentParamsHigh: \"vec4\",\n                extentParamsLow: \"vec4\",\n                isFullExtent: \"bool\"\n            },\n            attributes: {\n                cornersHigh: \"vec2\",\n                cornersLow: \"vec2\",\n                texCoords: \"vec2\"\n            },\n            vertexShader: `attribute vec2 cornersHigh; \n                     attribute vec2 cornersLow;\n                      attribute vec2 texCoords; \n                      uniform vec4 extentParamsHigh; \n                      uniform vec4 extentParamsLow; \n                      varying vec2 v_texCoords;\n                      void main() {                                                             \n                          v_texCoords = texCoords; \n                          vec2 highDiff = cornersHigh - extentParamsHigh.xy;\n                          vec2 lowDiff = cornersLow - extentParamsLow.xy;                                        \n                          gl_Position = vec4((-1.0 + (highDiff + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0), 0.0, 1.0); \n                      }`,\n            fragmentShader: `precision highp float;\n                        uniform sampler2D sourceTexture;\n                        uniform bool isFullExtent;\n                        varying vec2 v_texCoords;\n                        void main () {\n                            if(!isFullExtent && (v_texCoords.x <= 0.001 || v_texCoords.x >= 0.999 ||\n                                v_texCoords.y <= 0.001 || v_texCoords.y >= 0.999)) {\n                                discard;\n                            }\n                            gl_FragColor = texture2D(sourceTexture, v_texCoords);\n                        }`\n        }));\n    }\n}\n//# sourceMappingURL=GeoImageCreator.js.map","import { createEvents } from '../Events';\nconst LOADER_EVENTS = [\"loadend\", \"layerloadend\"];\nexport class Loader {\n    constructor(maxRequests = 24) {\n        this.MAX_REQUESTS = maxRequests;\n        this.events = createEvents(LOADER_EVENTS);\n        this._loading = 0;\n        this._queue = []; //new QueueArray();\n        this._senderRequestCounter = [];\n        this._promises = {\n            'json': r => r.json(),\n            'blob': r => r.blob(),\n            'arrayBuffer': r => r.arrayBuffer(),\n            'imageBitmap': r => r.blob().then((r) => createImageBitmap(r, {\n                premultiplyAlpha: \"premultiply\"\n            })),\n            'text': r => r.text()\n        };\n    }\n    load(params, callback) {\n        if (params.sender) {\n            if (!this._senderRequestCounter[params.sender.__id]) {\n                this._senderRequestCounter[params.sender.__id] = {\n                    sender: params.sender, counter: 0, __requestCounterFrame__: 0\n                };\n            }\n            this._senderRequestCounter[params.sender.__id].counter++;\n        }\n        this._queue.push({ params, callback });\n        this._exec();\n    }\n    fetch(params) {\n        return fetch(params.src, params.options || {})\n            .then((response) => {\n            if (!response.ok) {\n                throw Error(`Unable to load '${params.src}'`);\n            }\n            return this._promises[params.type || \"blob\"](response);\n        })\n            .then((data) => {\n            return { status: \"ready\", data: data };\n        })\n            .catch((err) => {\n            return { status: \"error\", msg: err.toString() };\n        });\n    }\n    getRequestCounter(sender) {\n        if (sender) {\n            let r = this._senderRequestCounter[sender.__id];\n            if (r) {\n                return r.counter;\n            }\n        }\n        return 0;\n    }\n    isIdle(sender) {\n        return sender.isIdle;\n    }\n    _checkLoadend(request, sender) {\n        if (request.counter === 0 && (!sender._planet || sender._planet._terrainCompletedActivated)) {\n            sender.events.dispatch(sender.events.loadend, sender);\n            this.events.dispatch(this.events.layerloadend, sender);\n            request.__requestCounterFrame__ = 0;\n        }\n        else {\n            request.__requestCounterFrame__ = requestAnimationFrame(() => {\n                this._checkLoadend(request, sender);\n            });\n        }\n    }\n    _handleResponse(q, response) {\n        q.callback(response);\n        let sender = q.params.sender;\n        if (sender && (sender.events.loadend.handlers.length || this.events.layerloadend.handlers.length)) {\n            let request = this._senderRequestCounter[sender.__id];\n            if (request && request.counter > 0) {\n                request.counter--;\n                cancelAnimationFrame(request.__requestCounterFrame__);\n                request.__requestCounterFrame__ = requestAnimationFrame(() => {\n                    this._checkLoadend(request, sender);\n                });\n            }\n        }\n        this._exec();\n    }\n    _exec() {\n        if (this._queue.length > 0 && this._loading < this.MAX_REQUESTS) {\n            let q = this._queue.pop();\n            if (!q)\n                return;\n            let p = q.params;\n            if (!p.filter || p.filter(p)) {\n                this._loading++;\n                return fetch(p.src, p.options || {})\n                    .then((response) => {\n                    if (!response.ok) {\n                        throw Error(`Unable to load '${p.src}'`);\n                    }\n                    return this._promises[p.type || \"blob\"](response);\n                })\n                    .then((data) => {\n                    this._loading--;\n                    this._handleResponse(q, { status: \"ready\", data: data });\n                })\n                    .catch((err) => {\n                    this._loading--;\n                    this._handleResponse(q, { status: \"error\", msg: err.toString() });\n                });\n            }\n            else {\n                this._handleResponse(q, { status: \"abort\" });\n            }\n        }\n        else if (this._loading === 0) {\n            this.events.dispatch(this.events.loadend);\n        }\n    }\n    abort(sender) {\n        if (this._senderRequestCounter[sender.__id]) {\n            this._senderRequestCounter[sender.__id].counter = 0;\n            cancelAnimationFrame(this._senderRequestCounter[sender.__id].__requestCounterFrame__);\n            this._senderRequestCounter[sender.__id].__requestCounterFrame__ = 0;\n        }\n        for (let i = 0, len = this._queue.length; i < len; i++) {\n            let qi = this._queue[i];\n            if (qi && qi.params.sender && sender.isEqual(qi.params.sender)) {\n                qi.callback({ 'status': \"abort\" });\n                //@ts-ignore\n                this._queue[i] = null;\n            }\n        }\n    }\n    abortAll() {\n        for (let i = 0, len = this._queue.length; i < len; i++) {\n            let qi = this._queue[i];\n            if (qi) {\n                let sender = qi.params.sender;\n                if (sender && this._senderRequestCounter[sender.__id]) {\n                    this._senderRequestCounter[sender.__id].counter = 0;\n                    cancelAnimationFrame(this._senderRequestCounter[sender.__id].__requestCounterFrame__);\n                    this._senderRequestCounter[sender.__id].__requestCounterFrame__ = 0;\n                }\n                qi.callback({ 'status': \"abort\" });\n                //@ts-ignore\n                this._queue[i] = null;\n            }\n        }\n        this._queue = [];\n    }\n    get loading() {\n        return this._loading;\n    }\n    get queue() {\n        return this._queue;\n    }\n}\n//# sourceMappingURL=Loader.js.map","import * as quadTree from \"../quadTree/quadTree\";\nimport { Framebuffer } from \"../webgl/Framebuffer\";\nimport { Lock } from \"../Lock\";\nimport { Program } from \"../webgl/Program\";\nimport { QueueArray } from \"../QueueArray\";\nexport class NormalMapCreator {\n    constructor(planet, options = {}) {\n        this._minTabelSize = options.minTableSize || 1;\n        this._maxTableSize = options.maxTableSize || 8;\n        this._planet = planet;\n        this._handler = null;\n        this._verticesBufferArray = [];\n        this._indexBufferArray = [];\n        this._positionBuffer = null;\n        this._framebuffer = null;\n        this._normalMapVerticesTexture = null;\n        this._width = options.width || 128;\n        this._height = options.height || 128;\n        this._queue = new QueueArray(1024);\n        this._lock = new Lock();\n    }\n    get width() {\n        return this._width;\n    }\n    get height() {\n        return this._height;\n    }\n    init() {\n        this._maxTableSize = this._planet.maxGridSize || 8;\n        this._handler = this._planet.renderer.handler;\n        let isWebkit = false; //('WebkitAppearance' in document.documentElement.style) && !/^((?!chrome).)*safari/i.test(navigator.userAgent);\n        /*==================================================================================\n         * http://www.sunsetlakesoftware.com/2013/10/21/optimizing-gaussian-blurs-mobile-gpu\n         *=================================================================================*/\n        const normalMapBlur = new Program(\"normalMapBlur\", {\n            attributes: {\n                a_position: \"vec2\"\n            },\n            uniforms: {\n                s_texture: \"sampler2d\"\n            },\n            vertexShader: `attribute vec2 a_position;\n                       attribute vec2 a_texCoord;\n\n                      varying vec2 blurCoordinates[5];\n\n                      void main() {\n                          vec2 vt = a_position * 0.5 + 0.5; \n                          ${isWebkit ? \"vt.y = 1.0 - vt.y; \" : \" \"}\n                          gl_Position = vec4(a_position, 0.0, 1.0);\n                          blurCoordinates[0] = vt;\n                          blurCoordinates[1] = vt + ${(1.0 / this._width) * 1.407333};\n                          blurCoordinates[2] = vt - ${(1.0 / this._height) * 1.407333};\n                          blurCoordinates[3] = vt + ${(1.0 / this._width) * 3.294215};\n                          blurCoordinates[4] = vt - ${(1.0 / this._height) * 3.294215};\n                }`,\n            fragmentShader: `precision lowp float;\n                        uniform sampler2D s_texture;                        \n                        varying vec2 blurCoordinates[5];                        \n\n                        void main() {\n                            lowp vec4 sum = vec4(0.0);\n                            //if(blurCoordinates[0].x <= 0.01 || blurCoordinates[0].x >= 0.99 ||\n                            //    blurCoordinates[0].y <= 0.01 || blurCoordinates[0].y >= 0.99){\n                            //    sum = texture2D(s_texture, blurCoordinates[0]);\n                            //} else {\n                                sum += texture2D(s_texture, blurCoordinates[0]) * 0.204164;\n                                sum += texture2D(s_texture, blurCoordinates[1]) * 0.304005;\n                                sum += texture2D(s_texture, blurCoordinates[2]) * 0.304005;\n                                sum += texture2D(s_texture, blurCoordinates[3]) * 0.093913;\n                                sum += texture2D(s_texture, blurCoordinates[4]) * 0.093913;\n                            //}\n                            gl_FragColor = sum;\n                        }`\n        });\n        const normalMap = new Program(\"normalMap\", {\n            attributes: {\n                a_position: \"vec2\",\n                a_normal: \"vec3\"\n            },\n            uniforms: {},\n            vertexShader: `attribute vec2 a_position;\n                      attribute vec3 a_normal;\n                      \n                      varying vec3 v_color;\n                      \n                      void main() {\n                          gl_Position = vec4(a_position, 0, 1);\n                          v_color = normalize(a_normal) * 0.5 + 0.5;\n                      }`,\n            fragmentShader: `precision highp float;\n                        \n                        varying vec3 v_color;\n                        \n                        void main () {\n                            gl_FragColor = vec4(v_color, 1.0);\n                        }`\n        });\n        this._handler.addProgram(normalMapBlur);\n        this._handler.addProgram(normalMap);\n        //create hidden handler buffer\n        this._framebuffer = new Framebuffer(this._handler, {\n            width: this._width,\n            height: this._height,\n            useDepth: false\n        });\n        this._framebuffer.init();\n        this._normalMapVerticesTexture = this._handler.createEmptyTexture_l(this._width, this._height);\n        //create vertices hasharray for different grid size segments from 2^4(16) to 2^7(128)\n        for (let p = this._minTabelSize; p <= this._maxTableSize; p++) {\n            const gs = Math.pow(2, p);\n            const gs2 = gs / 2;\n            let vertices = new Float32Array((gs + 1) * (gs + 1) * 2);\n            for (let i = 0; i <= gs; i++) {\n                for (let j = 0; j <= gs; j++) {\n                    let ind = (i * (gs + 1) + j) * 2;\n                    vertices[ind] = -1 + j / gs2;\n                    vertices[ind + 1] = -1 + i / gs2;\n                }\n            }\n            this._verticesBufferArray[gs] = this._handler.createArrayBuffer(vertices, 2, vertices.length / 2);\n            this._indexBufferArray[gs] =\n                this._planet._indexesCache[Math.log2(gs)][Math.log2(gs)][Math.log2(gs)][Math.log2(gs)][Math.log2(gs)].buffer;\n        }\n        //create 2d screen square buffer\n        const positions = new Float32Array([-1.0, -1.0, 1.0, -1.0, -1.0, 1.0, 1.0, 1.0]);\n        this._positionBuffer = this._handler.createArrayBuffer(positions, 2, positions.length / 2);\n    }\n    _drawNormalMapBlur(segment) {\n        let normals = segment.normalMapNormals;\n        if (segment.node &&\n            segment.node.getState() !== quadTree.NOTRENDERING &&\n            normals &&\n            normals.length) {\n            const size = normals.length / 3;\n            const gridSize = Math.sqrt(size) - 1;\n            let indBuf = this._verticesBufferArray[gridSize];\n            if (indBuf) {\n                if (segment.planet.terrain.equalizeNormals) {\n                    segment._normalMapEdgeEqualize(quadTree.N);\n                    segment._normalMapEdgeEqualize(quadTree.S);\n                    segment._normalMapEdgeEqualize(quadTree.W);\n                    segment._normalMapEdgeEqualize(quadTree.E);\n                }\n                let outTexture = segment.normalMapTexturePtr;\n                const h = this._handler;\n                const gl = h.gl;\n                let _normalsBuffer = h.createArrayBuffer(normals, 3, size, gl.DYNAMIC_DRAW);\n                const f = this._framebuffer;\n                let p = h.programs.normalMap;\n                let sha = p._program.attributes;\n                f.bindOutputTexture(this._normalMapVerticesTexture);\n                p.activate();\n                gl.bindBuffer(gl.ARRAY_BUFFER, indBuf);\n                gl.vertexAttribPointer(sha.a_position, indBuf.itemSize, gl.FLOAT, false, 0, 0);\n                gl.bindBuffer(gl.ARRAY_BUFFER, _normalsBuffer);\n                gl.vertexAttribPointer(sha.a_normal, _normalsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBufferArray[gridSize]);\n                gl.drawElements(gl.TRIANGLE_STRIP, this._indexBufferArray[gridSize].numItems, gl.UNSIGNED_INT, 0);\n                gl.deleteBuffer(_normalsBuffer);\n                //\n                // blur pass\n                //\n                f.bindOutputTexture(outTexture);\n                p = h.programs.normalMapBlur;\n                p.activate();\n                gl.bindBuffer(gl.ARRAY_BUFFER, this._positionBuffer);\n                gl.vertexAttribPointer(p._program.attributes.a_position, this._positionBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                gl.activeTexture(gl.TEXTURE0);\n                gl.bindTexture(gl.TEXTURE_2D, this._normalMapVerticesTexture);\n                gl.uniform1i(p._program.uniforms.s_texture, 0);\n                gl.drawArrays(gl.TRIANGLE_STRIP, 0, this._positionBuffer.numItems);\n                return true;\n            }\n            else {\n                return true;\n            }\n        }\n        return false;\n    }\n    _drawNormalMapNoBlur(segment) {\n        let normals = segment.normalMapNormals;\n        if (segment.node &&\n            segment.node.getState() !== quadTree.NOTRENDERING &&\n            normals &&\n            normals.length) {\n            const size = normals.length / 3;\n            const gridSize = Math.sqrt(size) - 1;\n            let indBuf = this._verticesBufferArray[gridSize];\n            if (indBuf) {\n                if (segment.planet.terrain.equalizeNormals) {\n                    segment._normalMapEdgeEqualize(quadTree.N);\n                    segment._normalMapEdgeEqualize(quadTree.S);\n                    segment._normalMapEdgeEqualize(quadTree.W);\n                    segment._normalMapEdgeEqualize(quadTree.E);\n                }\n                let outTexture = segment.normalMapTexturePtr;\n                const h = this._handler;\n                const gl = h.gl;\n                let _normalsBuffer = h.createArrayBuffer(normals, 3, size, gl.DYNAMIC_DRAW);\n                const f = this._framebuffer;\n                const p = h.programs.normalMap;\n                const sha = p._program.attributes;\n                f.bindOutputTexture(outTexture);\n                p.activate();\n                gl.bindBuffer(gl.ARRAY_BUFFER, indBuf);\n                gl.vertexAttribPointer(sha.a_position, indBuf.itemSize, gl.FLOAT, false, 0, 0);\n                gl.bindBuffer(gl.ARRAY_BUFFER, _normalsBuffer);\n                gl.vertexAttribPointer(sha.a_normal, _normalsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, this._indexBufferArray[gridSize]);\n                gl.drawElements(gl.TRIANGLE_STRIP, this._indexBufferArray[gridSize].numItems, gl.UNSIGNED_INT, 0);\n                gl.deleteBuffer(_normalsBuffer);\n                return true;\n            }\n            else {\n                return true;\n            }\n        }\n        return false;\n    }\n    _drawNormalMap(segment) {\n        if (segment.planet.terrain.isBlur(segment)) {\n            return this._drawNormalMapBlur(segment);\n        }\n        else {\n            return this._drawNormalMapNoBlur(segment);\n        }\n    }\n    drawSingle(segment) {\n        const h = this._handler;\n        const gl = h.gl;\n        this._framebuffer.activate();\n        gl.disable(gl.CULL_FACE);\n        gl.disable(gl.DEPTH_TEST);\n        gl.disable(gl.BLEND);\n        if (segment.terrainReady && this._drawNormalMap(segment)) {\n            segment.normalMapReady = true;\n            segment.normalMapTexture = segment.normalMapTexturePtr;\n            segment.normalMapTextureBias[0] = 0;\n            segment.normalMapTextureBias[1] = 0;\n            segment.normalMapTextureBias[2] = 1;\n        }\n        segment._inTheQueue = false;\n        gl.enable(gl.DEPTH_TEST);\n        gl.enable(gl.CULL_FACE);\n        gl.enable(gl.BLEND);\n        this._framebuffer.deactivate();\n    }\n    frame() {\n        if (this._queue.length) {\n            const h = this._handler;\n            const gl = h.gl;\n            this._framebuffer.activate();\n            gl.disable(gl.CULL_FACE);\n            gl.disable(gl.DEPTH_TEST);\n            gl.disable(gl.BLEND);\n            let deltaTime = 0, startTime = window.performance.now();\n            while (this._lock.isFree() && this._queue.length && deltaTime < 0.25) {\n                const segment = this._queue.shift();\n                if (segment.terrainReady && this._drawNormalMap(segment)) {\n                    segment.normalMapReady = true;\n                    segment.normalMapTexture = segment.normalMapTexturePtr;\n                    segment.normalMapTextureBias[0] = 0;\n                    segment.normalMapTextureBias[1] = 0;\n                    segment.normalMapTextureBias[2] = 1;\n                }\n                segment._inTheQueue = false;\n                deltaTime = window.performance.now() - startTime;\n            }\n            gl.enable(gl.BLEND);\n            gl.enable(gl.DEPTH_TEST);\n            gl.enable(gl.CULL_FACE);\n            this._framebuffer.deactivate();\n        }\n    }\n    get queueSize() {\n        return this._queue.length;\n    }\n    queue(segment) {\n        segment._inTheQueue = true;\n        this._queue.push(segment);\n    }\n    unshift(segment) {\n        segment._inTheQueue = true;\n        this._queue.unshift(segment);\n    }\n    remove(segment) {\n        //...\n    }\n    clear() {\n        while (this._queue.length) {\n            let s = this._queue.pop();\n            s._inTheQueue = false;\n        }\n    }\n    /**\n     * Set activity off\n     * @public\n     */\n    lock(key) {\n        this._lock.lock(key);\n    }\n    /**\n     * Set activity on\n     * @public\n     */\n    free(key) {\n        this._lock.free(key);\n    }\n}\n//# sourceMappingURL=NormalMapCreator.js.map","// import { QueueArray } from '../QueueArray.js';\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { BaseWorker } from \"./BaseWorker\";\nclass PlainSegmentWorker extends BaseWorker {\n    constructor(numWorkers = 2) {\n        super(numWorkers, PLAIN_SEGMENT_PROGRAM);\n    }\n    _onMessage(e) {\n        this._source.get(e.data.id)._plainSegmentWorkerCallback(e.data);\n        e.data.plainVertices = null;\n        e.data.plainVerticesHigh = null;\n        e.data.plainVerticesLow = null;\n        e.data.plainNormals = null;\n        e.data.normalMapNormals = null;\n        e.data.normalMapVertices = null;\n        e.data.normalMapVerticesHigh = null;\n        e.data.normalMapVerticesLow = null;\n        this._source.delete(e.data.id);\n    }\n    setGeoid(geoid) {\n        if (geoid.model) {\n            let m = geoid.model;\n            let model = {\n                scale: m.scale,\n                offset: m.offset,\n                width: m.width,\n                height: m.height,\n                rlonres: m.rlonres,\n                rlatres: m.rlatres,\n                i: m.i\n            };\n            this._workerQueue.forEach((w) => {\n                let rawfile = new Uint8Array(m.rawfile.length);\n                rawfile.set(m.rawfile);\n                w.postMessage({\n                    model: model,\n                    rawfile: rawfile\n                }, [\n                    rawfile.buffer\n                ]);\n            });\n        }\n        else {\n            this._workerQueue.forEach((w) => {\n                w.postMessage({\n                    model: null\n                });\n            });\n        }\n    }\n    make(segment) {\n        if (segment.initialized) {\n            if (this._workerQueue.length) {\n                let w = this._workerQueue.pop();\n                this._source.set(this._sourceId, segment);\n                let params = new Float64Array([\n                    this._sourceId,\n                    segment._projection.id === EPSG4326.id ? 1.0 : 0.0,\n                    segment.planet.terrain.gridSizeByZoom[segment.tileZoom],\n                    segment.planet.terrain.plainGridSize,\n                    segment._extent.southWest.lon,\n                    segment._extent.southWest.lat,\n                    segment._extent.northEast.lon,\n                    segment._extent.northEast.lat,\n                    // @ts-ignore\n                    segment.planet.ellipsoid._e2,\n                    segment.planet.ellipsoid.equatorialSize,\n                    segment.planet.ellipsoid._invRadii2.x,\n                    segment.planet.ellipsoid._invRadii2.y,\n                    segment.planet.ellipsoid._invRadii2.z,\n                    segment.planet._heightFactor\n                ]);\n                this._sourceId++;\n                w.postMessage({\n                    params: params\n                }, [\n                    params.buffer\n                ]);\n            }\n            else {\n                this._pendingQueue.push(segment);\n            }\n        }\n        else {\n            this.check();\n        }\n    }\n}\nconst PLAIN_SEGMENT_PROGRAM = `\n    'use strict';\n    \n    let model = null;\n\n    let cached_ix = null;\n    let cached_iy = null;\n    let v00 = null;\n    let v01 = null;\n    let v10 = null;\n    let v11 = null;\n    let t = null;\n\n    function rawval(ix, iy) {\n\n        if (iy < 0) {\n            iy = -iy;\n            ix += model.width / 2;\n        } else if (iy >= model.height) {\n            iy = 2 * (model.height - 1) - iy;\n            ix += model.width / 2;\n        }\n\n        if (ix < 0) {\n            ix += model.width;\n        } else if (ix >= model.width) {\n            ix -= model.width;\n        }\n\n        var k = (iy * model.width + ix) * 2 + model.i;\n\n        return (model.rawfile[k] << 8) | model.rawfile[k + 1];\n    };\n\n    function getHeightMSL(lon, lat) {\n\n        if (!model) return 0;\n\n        if (lon < 0) lon += 360.0;\n\n        var fy = (90 - lat) * model.rlatres;\n        var fx = lon * model.rlonres;\n        var iy = Math.floor(fy);\n        var ix = Math.floor(fx);\n\n        fx -= ix;\n        fy -= iy;\n\n        if (iy === (model.height - 1)) {\n            iy--;\n        }\n\n        if ((cached_ix !== ix) || (cached_iy !== iy)) {\n\n            cached_ix = ix;\n            cached_iy = iy;\n\n            v00 = rawval(ix, iy);\n            v01 = rawval(ix + 1, iy);\n            v10 = rawval(ix, iy + 1);\n            v11 = rawval(ix + 1, iy + 1);\n        }\n\n        let h = null;\n\n        var a = (1 - fx) * v00 + fx * v01;\n        var b = (1 - fx) * v10 + fx * v11;\n\n        h = (1 - fy) * a + fy * b;\n\n        return model.offset + model.scale * h;\n    };\n\n    const HALF_PI = Math.PI * 0.5;\n    const POLE = 20037508.34;\n    const PI_BY_POLE = Math.PI / POLE;\n    const INV_POLE_BY_180 = 180.0 / POLE;\n    const INV_PI_BY_180 = 180.0 / Math.PI;\n    const INV_PI_BY_180_HALF_PI = INV_PI_BY_180 * HALF_PI;\n    const RADIANS = Math.PI / 180.0;\n    const INV_PI_BY_360 = INV_PI_BY_180 * 2.0;\n\n    let E2 = 0.0,\n        A = 0.0;\n\n    let _projFunc = null;\n\n    const Vec3 = function (x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    };\n\n    var geodeticToCartesian = function (lon, lat, heightFactor, res) {\n\n        let h = getHeightMSL(lon, lat) * heightFactor;\n\n        let latrad = RADIANS * lat,\n            lonrad = RADIANS * lon;\n\n        let slt = Math.sin(latrad);\n\n        let N = A / Math.sqrt(1.0 - E2 * slt * slt);\n        let nc = (N + h) * Math.cos(latrad);       \n           \n        res.x = nc * Math.cos(lonrad);\n        res.y = nc * Math.sin(lonrad);\n        res.z = (N * (1 - E2) + h) * slt;\n    };\n\n    var geodeticToCartesianInverse = function (lon, lat, heightFactor, res){\n        geodeticToCartesian(\n            lon * INV_POLE_BY_180,\n            INV_PI_BY_360 * Math.atan(Math.exp(lat * PI_BY_POLE)) - INV_PI_BY_180_HALF_PI,\n            heightFactor,\n            res);\n    };\n\n    var v = new Vec3(0.0, 0.0, 0.0);\n    var _tempHigh = new Vec3(0.0, 0.0, 0.0);\n    var _tempLow = new Vec3(0.0, 0.0, 0.0);\n\n    var doubleToTwoFloats = function(v, high, low) {\n\n        let x = v.x, y = v.y, z = v.z;\n    \n        if (x >= 0.0) {\n            var doubleHigh = Math.floor(x / 65536.0) * 65536.0;\n            high.x = Math.fround(doubleHigh);\n            low.x = Math.fround(x - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\n            high.x = Math.fround(-doubleHigh);\n            low.x = Math.fround(x + doubleHigh);\n        }\n\n        if (y >= 0.0) {\n            var doubleHigh = Math.floor(y / 65536.0) * 65536.0;\n            high.y = Math.fround(doubleHigh);\n            low.y = Math.fround(y - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\n            high.y = Math.fround(-doubleHigh);\n            low.y = Math.fround(y + doubleHigh);\n        }\n\n        if (z >= 0.0) {\n            var doubleHigh = Math.floor(z / 65536.0) * 65536.0;\n            high.z = Math.fround(doubleHigh);\n            low.z = Math.fround(z - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\n            high.z = Math.fround(-doubleHigh);\n            low.z = Math.fround(z + doubleHigh);\n        }\n    };\n\n    self.onmessage = function (msg) {\n        if(msg.data.model) {\n            model = msg.data.model;\n            model.rawfile = msg.data.rawfile;\n        } else if(msg.data.params) {\n\n            let xmin = 549755748352.0, xmax = -549755748352.0, \n                ymin = 549755748352.0, ymax = -549755748352.0, \n                zmin = 549755748352.0, zmax = -549755748352.0;\n\n            E2 = msg.data.params[8];\n            A = msg.data.params[9];\n\n            let gridSize = msg.data.params[2],\n                fgs = msg.data.params[3],\n                r2_x = msg.data.params[10],\n                r2_y = msg.data.params[11],\n                r2_z = msg.data.params[12];\n\n            let heightFactor =  msg.data.params[13];\n        \n            if(msg.data.params[1] === 0.0){\n                _projFunc = geodeticToCartesianInverse;\n            }else{\n                _projFunc = geodeticToCartesian;\n            }\n\n            let maxFgs = Math.max(fgs, gridSize);\n            let llStep = (msg.data.params[6] - msg.data.params[4]) / maxFgs;\n            let ltStep = (msg.data.params[7] - msg.data.params[5]) / maxFgs;\n\n            let esw_lon = msg.data.params[4],\n                ene_lat = msg.data.params[7];\n\n            let dg = Math.max(fgs / gridSize, 1.0),\n                gs = maxFgs + 1;\n            \n            const gsgs = gs * gs;\n\n            const gridSize3 = (gridSize + 1) * (gridSize + 1) * 3;\n\n            let plainNormals = new Float32Array(gridSize3);\n\n            let plainVertices = new Float64Array(gridSize3);\n            let plainVerticesHigh = new Float32Array(gridSize3);\n            let plainVerticesLow = new Float32Array(gridSize3);\n\n            let normalMapNormals = new Float32Array(gsgs * 3);\n\n            let normalMapVertices = new Float64Array(gsgs * 3);\n            let normalMapVerticesHigh = new Float32Array(gsgs * 3);\n            let normalMapVerticesLow = new Float32Array(gsgs * 3);\n\n            let ind = 0,\n                nmInd = 0;\n\n            for (let k = 0; k < gsgs; k++) {\n\n                let j = k % gs,\n                    i = ~~(k / gs);\n\n                _projFunc(esw_lon + j * llStep, ene_lat - i * ltStep, heightFactor, v);\n\n                let nx = v.x * r2_x, ny = v.y * r2_y, nz = v.z * r2_z;\n                let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);            \n                let nxl = nx * l,\n                    nyl = ny * l,\n                    nzl = nz * l;\n\n                doubleToTwoFloats(v, _tempHigh, _tempLow);\n\n                normalMapVertices[nmInd] = v.x;\n                normalMapVerticesHigh[nmInd] = _tempHigh.x;\n                normalMapVerticesLow[nmInd] = _tempLow.x;\n                normalMapNormals[nmInd++] = nxl;\n\n                normalMapVertices[nmInd] = v.y;\n                normalMapVerticesHigh[nmInd] = _tempHigh.y;\n                normalMapVerticesLow[nmInd] = _tempLow.y;\n                normalMapNormals[nmInd++] = nyl;\n\n                normalMapVertices[nmInd] = v.z;\n                normalMapVerticesHigh[nmInd] = _tempHigh.z;\n                normalMapVerticesLow[nmInd] = _tempLow.z;\n                normalMapNormals[nmInd++] = nzl;\n\n                if (i % dg === 0 && j % dg === 0) {\n                    plainVertices[ind] = v.x;\n                    plainVerticesHigh[ind] = _tempHigh.x;\n                    plainVerticesLow[ind] = _tempLow.x;\n                    plainNormals[ind++] = nxl;\n\n                    plainVertices[ind] = v.y;\n                    plainVerticesHigh[ind] = _tempHigh.y;\n                    plainVerticesLow[ind] = _tempLow.y;\n                    plainNormals[ind++] = nyl;\n\n                    plainVertices[ind] = v.z;\n                    plainVerticesHigh[ind] = _tempHigh.z;\n                    plainVerticesLow[ind] = _tempLow.z;\n                    plainNormals[ind++] = nzl;\n\n                    if (v.x < xmin) xmin = v.x; if (v.x > xmax) xmax = v.x;\n                    if (v.y < ymin) ymin = v.y; if (v.y > ymax) ymax = v.y;\n                    if (v.z < zmin) zmin = v.z; if (v.z > zmax) zmax = v.z;\n                }\n            }\n\n            let x = (xmax - xmin) * 0.5,\n                y = (ymax - ymin) * 0.5,\n                z = (zmax - zmin) * 0.5;\n\n            let plainRadius = Math.sqrt(x * x + y * y + z * z);\n\n            self.postMessage({\n                id: msg.data.params[0],\n                plainVertices: plainVertices,\n                plainVerticesHigh: plainVerticesHigh,\n                plainVerticesLow: plainVerticesLow,\n                plainNormals: plainNormals,\n                normalMapNormals: normalMapNormals,\n                normalMapVertices: normalMapVertices,\n                normalMapVerticesHigh: normalMapVerticesHigh,\n                normalMapVerticesLow: normalMapVerticesLow,\n                plainRadius: plainRadius\n             }, [\n                plainVertices.buffer,\n                plainVerticesHigh.buffer,\n                plainVerticesLow.buffer,\n                plainNormals.buffer,\n                normalMapNormals.buffer,\n                normalMapVertices.buffer,\n                normalMapVerticesHigh.buffer,\n                normalMapVerticesLow.buffer\n            ]);\n        }\n    }`;\nexport { PlainSegmentWorker };\n//# sourceMappingURL=PlainSegmentWorker.js.map","import { Mat4 } from \"../math/Mat4\";\nfunction planeNormalize(plane) {\n    let t = 1.0 / Math.sqrt(plane[0] * plane[0] + plane[1] * plane[1] + plane[2] * plane[2]);\n    plane[0] *= t;\n    plane[1] *= t;\n    plane[2] *= t;\n    plane[3] *= t;\n}\n/**\n * Frustum object, part of the camera object.\n * @class\n * @param {*} options\n */\nclass Frustum {\n    constructor(options = {}) {\n        this._pickingColorU = new Float32Array([0, 0, 0]);\n        this._f = [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]];\n        this.projectionMatrix = new Mat4();\n        this.inverseProjectionMatrix = new Mat4();\n        this.projectionViewMatrix = new Mat4();\n        this.inverseProjectionViewMatrix = new Mat4();\n        this.left = 0.0;\n        this.right = 0.0;\n        this.bottom = 0.0;\n        this.top = 0.0;\n        this.near = 0.0;\n        this.far = 0.0;\n        this.cameraFrustumIndex = options.cameraFrustumIndex != undefined ? options.cameraFrustumIndex : -1;\n        this.setProjectionMatrix(options.fov || 30.0, options.aspect || 1.0, options.near || 1.0, options.far || 1000.0);\n    }\n    getRightPlane() {\n        return this._f[0];\n    }\n    getLeftPlane() {\n        return this._f[1];\n    }\n    getBottomPlane() {\n        return this._f[2];\n    }\n    getTopPlane() {\n        return this._f[3];\n    }\n    getBackwardPlane() {\n        return this._f[4];\n    }\n    getForwardPlane() {\n        return this._f[5];\n    }\n    getProjectionViewMatrix() {\n        return this.projectionViewMatrix._m;\n    }\n    getProjectionMatrix() {\n        return this.projectionMatrix._m;\n    }\n    getInverseProjectionMatrix() {\n        return this.inverseProjectionMatrix._m;\n    }\n    /**\n     * Sets up camera projection matrix.\n     * @public\n     * @param {number} angle - Camera's view angle.\n     * @param {number} aspect - Screen aspect ration.\n     * @param {number} near - Near camera distance.\n     * @param {number} far - Far camera distance.\n     */\n    setProjectionMatrix(angle, aspect, near, far) {\n        this.top = near * Math.tan((angle * Math.PI) / 360);\n        this.bottom = -this.top;\n        this.right = this.top * aspect;\n        this.left = -this.right;\n        this.near = near;\n        this.far = far;\n        this.projectionMatrix.setPerspective(this.left, this.right, this.bottom, this.top, near, far);\n        this.projectionMatrix.inverseTo(this.inverseProjectionMatrix);\n    }\n    /**\n     * Camera's projection matrix values.\n     * @public\n     * @param {Mat4} viewMatrix - View matrix.\n     */\n    setViewMatrix(viewMatrix) {\n        this.projectionViewMatrix = this.projectionMatrix.mul(viewMatrix);\n        this.projectionViewMatrix.inverseTo(this.inverseProjectionViewMatrix);\n        let m = this.projectionViewMatrix._m;\n        /* Right */\n        this._f[0][0] = m[3] - m[0];\n        this._f[0][1] = m[7] - m[4];\n        this._f[0][2] = m[11] - m[8];\n        this._f[0][3] = m[15] - m[12];\n        planeNormalize(this._f[0]);\n        /* Left */\n        this._f[1][0] = m[3] + m[0];\n        this._f[1][1] = m[7] + m[4];\n        this._f[1][2] = m[11] + m[8];\n        this._f[1][3] = m[15] + m[12];\n        planeNormalize(this._f[1]);\n        /* Bottom */\n        this._f[2][0] = m[3] + m[1];\n        this._f[2][1] = m[7] + m[5];\n        this._f[2][2] = m[11] + m[9];\n        this._f[2][3] = m[15] + m[13];\n        planeNormalize(this._f[2]);\n        /* Top */\n        this._f[3][0] = m[3] - m[1];\n        this._f[3][1] = m[7] - m[5];\n        this._f[3][2] = m[11] - m[9];\n        this._f[3][3] = m[15] - m[13];\n        planeNormalize(this._f[3]);\n        /* Backward */\n        this._f[4][0] = m[3] - m[2];\n        this._f[4][1] = m[7] - m[6];\n        this._f[4][2] = m[11] - m[10];\n        this._f[4][3] = m[15] - m[14];\n        planeNormalize(this._f[4]);\n        /* Forward */\n        this._f[5][0] = m[3] + m[2];\n        this._f[5][1] = m[7] + m[6];\n        this._f[5][2] = m[11] + m[10];\n        this._f[5][3] = m[15] + m[14];\n        planeNormalize(this._f[5]);\n    }\n    /**\n     * Returns true if a point in the frustum.\n     * @public\n     * @param {Vec3} point - Cartesian point.\n     * @returns {boolean} -\n     */\n    containsPoint(point) {\n        for (let p = 0; p < 6; p++) {\n            let d = point.dotArr(this._f[p]) + this._f[p][3];\n            if (d <= 0) {\n                return false;\n            }\n        }\n        return true;\n    }\n    /**\n     * Returns true if the frustum contains a bonding sphere, but bottom plane exclude.\n     * @public\n     * @param {Sphere} sphere - Bounding sphere.\n     * @returns {boolean} -\n     */\n    containsSphereBottomExc(sphere) {\n        let r = -sphere.radius, f = this._f;\n        if (sphere.center.dotArr(f[0]) + f[0][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[1]) + f[1][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[3]) + f[3][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[4]) + f[4][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[5]) + f[5][3] <= r)\n            return false;\n        return true;\n    }\n    containsSphereButtom(sphere) {\n        let r = -sphere.radius, f = this._f;\n        if (sphere.center.dotArr(f[2]) + f[2][3] <= r)\n            return false;\n        return true;\n    }\n    /**\n     * Returns true if the frustum contains a bonding sphere.\n     * @public\n     * @param {Sphere} sphere - Bounding sphere.\n     * @returns {boolean} -\n     */\n    containsSphere(sphere) {\n        let r = -sphere.radius, f = this._f;\n        if (sphere.center.dotArr(f[0]) + f[0][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[1]) + f[1][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[2]) + f[2][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[3]) + f[3][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[4]) + f[4][3] <= r)\n            return false;\n        if (sphere.center.dotArr(f[5]) + f[5][3] <= r)\n            return false;\n        return true;\n    }\n    /**\n     * Returns true if the frustum contains a bonding sphere.\n     * @public\n     * @param {Vec3} center - Sphere center.\n     * @param {number} radius - Sphere radius.\n     * @returns {boolean} -\n     */\n    containsSphere2(center, radius) {\n        let r = -radius;\n        if (center.dotArr(this._f[0]) + this._f[0][3] <= r)\n            return false;\n        if (center.dotArr(this._f[1]) + this._f[1][3] <= r)\n            return false;\n        if (center.dotArr(this._f[2]) + this._f[2][3] <= r)\n            return false;\n        if (center.dotArr(this._f[3]) + this._f[3][3] <= r)\n            return false;\n        if (center.dotArr(this._f[4]) + this._f[4][3] <= r)\n            return false;\n        if (center.dotArr(this._f[5]) + this._f[5][3] <= r)\n            return false;\n        return true;\n    }\n    /**\n     * Returns true if the frustum contains a bounding box.\n     * @public\n     * @param {Box} box - Bounding box.\n     * @returns {boolean} -\n     */\n    containsBox(box) {\n        let result = true, cout, cin;\n        for (let i = 0; i < 6; i++) {\n            cout = 0;\n            cin = 0;\n            for (let k = 0; k < 8 && (cin === 0 || cout === 0); k++) {\n                let d = box.vertices[k].dotArr(this._f[i]) + this._f[i][3];\n                if (d < 0) {\n                    cout++;\n                }\n                else {\n                    cin++;\n                }\n            }\n            if (cin === 0) {\n                return false;\n            }\n            else if (cout > 0) {\n                result = true;\n            }\n        }\n        return result;\n    }\n}\nexport { Frustum };\n//# sourceMappingURL=Frustum.js.map","import * as math from \"../math\";\nimport { createEvents } from \"../Events\";\nimport { Frustum } from \"./Frustum\";\nimport { Mat3 } from \"../math/Mat3\";\nimport { Mat4 } from \"../math/Mat4\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { Vec4 } from \"../math/Vec4\";\nconst EVENT_NAMES = [\n    /**\n     * When camera has been updated.\n     * @event og.Camera#viewchange\n     */\n    \"viewchange\",\n    /**\n     * Camera is stopped.\n     * @event og.Camera#moveend\n     */\n    \"moveend\"\n];\n/**\n * Camera class.\n * @class\n * @param {Renderer} [renderer] - Renderer uses the camera instance.\n * @param {Object} [options] - Camera options:\n * @param {Object} [options.name] - Camera name.\n * @param {number} [options.viewAngle=47] - Camera angle of view. Default is 47.0\n * @param {number} [options.near=1] - Camera near plane distance. Default is 1.0\n * @param {number} [options.far=og.math.MAX] - Camera far plane distance. Default is og.math.MAX\n * @param {Vec3} [options.eye=[0,0,0]] - Camera eye position. Default (0,0,0)\n * @param {Vec3} [options.look=[0,0,0]] - Camera look position. Default (0,0,0)\n * @param {Vec3} [options.up=[0,1,0]] - Camera eye position. Default (0,1,0)\n *\n * @fires EventsHandler<CameraEvents>#viewchange\n * @fires EventsHandler<CameraEvents>#moveend\n */\nclass Camera {\n    constructor(renderer, options = {}) {\n        this.renderer = renderer;\n        this.events = createEvents(EVENT_NAMES, this);\n        this.eye = options.eye || new Vec3();\n        this.eyeHigh = new Float32Array(3);\n        this.eyeLow = new Float32Array(3);\n        this._aspect = options.aspect || 1.0;\n        this._viewAngle = options.viewAngle || 47.0;\n        this._viewMatrix = new Mat4();\n        this._normalMatrix = new Mat3();\n        this._r = new Vec3(1.0, 0.0, 0.0);\n        this._u = new Vec3(0.0, 1.0, 0.0);\n        this._b = new Vec3(0.0, 0.0, 1.0);\n        // Previous frame values\n        this._pr = this._r.clone();\n        this._pu = this._u.clone();\n        this._pb = this._b.clone();\n        this._peye = this.eye.clone();\n        this.isMoving = false;\n        this._tanViewAngle_hrad = 0.0;\n        this._tanViewAngle_hradOneByHeight = 0.0;\n        this.frustums = [];\n        this.frustumColors = [];\n        if (options.frustums) {\n            for (let i = 0, len = options.frustums.length; i < len; i++) {\n                let fi = options.frustums[i];\n                let fr = new Frustum({\n                    fov: this._viewAngle,\n                    aspect: this._aspect,\n                    near: fi[0],\n                    far: fi[1]\n                });\n                fr.cameraFrustumIndex = this.frustums.length;\n                this.frustums.push(fr);\n                //this.frustumColors.push.apply(this.frustumColors, fr._pickingColorU);\n                this.frustumColors.push(fr._pickingColorU[0], fr._pickingColorU[1], fr._pickingColorU[2]);\n            }\n        }\n        else {\n            let near = 1.0, far = 10000.0;\n            let fr = new Frustum({\n                fov: this._viewAngle,\n                aspect: this._aspect,\n                near: near,\n                far: far\n            });\n            fr.cameraFrustumIndex = this.frustums.length;\n            this.frustums.push(fr);\n            //this.frustumColors.push.apply(this.frustumColors, fr._pickingColorU);\n            this.frustumColors.push(fr._pickingColorU[0], fr._pickingColorU[1], fr._pickingColorU[2]);\n        }\n        this.FARTHEST_FRUSTUM_INDEX = this.frustums.length - 1;\n        this.currentFrustumIndex = 0;\n        this.isFirstPass = false;\n        this._projSizeConst = 0;\n        this.set(options.eye || new Vec3(0.0, 0.0, 1.0), options.look || new Vec3(), options.up || new Vec3(0.0, 1.0, 0.0));\n    }\n    checkMoveEnd() {\n        let r = this._r, u = this._u, b = this._b, eye = this.eye;\n        if (this._peye.equal(eye) && this._pr.equal(r) && this._pu.equal(u) && this._pb.equal(b)) {\n            if (this.isMoving) {\n                this.events.dispatch(this.events.moveend, this);\n            }\n            this.isMoving = false;\n        }\n        else {\n            this.isMoving = true;\n        }\n        this._pr.copy(r);\n        this._pu.copy(u);\n        this._pb.copy(b);\n        this._peye.copy(eye);\n    }\n    bindRenderer(renderer) {\n        this.renderer = renderer;\n        for (let i = 0; i < this.frustums.length; i++) {\n            this.renderer.assignPickingColor(this.frustums[i]);\n        }\n        this._aspect = this.renderer.handler.getClientAspect();\n        this._setProj(this._viewAngle, this._aspect);\n    }\n    /**\n     * Camera initialization.\n     * @public\n     * @param {Object} [options] - Camera options:\n     * @param {number} [options.viewAngle] - Camera angle of view.\n     * @param {number} [options.near] - Camera near plane distance. Default is 1.0\n     * @param {number} [options.far] - Camera far plane distance. Default is math.MAX\n     * @param {Vec3} [options.eye] - Camera eye position. Default (0,0,0)\n     * @param {Vec3} [options.look] - Camera look position. Default (0,0,0)\n     * @param {Vec3} [options.up] - Camera eye position. Default (0,1,0)\n     */\n    _init(options) {\n        this._setProj(this._viewAngle, this._aspect);\n        this.set(options.eye || new Vec3(0.0, 0.0, 1.0), options.look || new Vec3(), options.up || new Vec3(0.0, 1.0, 0.0));\n    }\n    getUp() {\n        return this._u.clone();\n    }\n    getDown() {\n        return this._u.negateTo();\n    }\n    getRight() {\n        return this._r.clone();\n    }\n    getLeft() {\n        return this._r.negateTo();\n    }\n    getForward() {\n        return this._b.negateTo();\n    }\n    getBackward() {\n        return this._b.clone();\n    }\n    /**\n     * Updates camera view space\n     * @public\n     * @virtual\n     */\n    update() {\n        let u = this._r, v = this._u, n = this._b, eye = this.eye;\n        Vec3.doubleToTwoFloat32Array(eye, this.eyeHigh, this.eyeLow);\n        this._viewMatrix.set([\n            u.x, v.x, n.x, 0.0,\n            u.y, v.y, n.y, 0.0,\n            u.z, v.z, n.z, 0.0,\n            -eye.dot(u), -eye.dot(v), -eye.dot(n), 1.0\n        ]);\n        // do not clean up, someday it will be using\n        //this._normalMatrix = this._viewMatrix.toMatrix3(); // this._viewMatrix.toInverseMatrix3().transposeTo();\n        for (let i = 0, len = this.frustums.length; i < len; i++) {\n            this.frustums[i].setViewMatrix(this._viewMatrix);\n        }\n        this.events.dispatch(this.events.viewchange, this);\n    }\n    /**\n     * Refresh camera matrices\n     * @public\n     */\n    refresh() {\n        this._setProj(this._viewAngle, this._aspect);\n        this.update();\n    }\n    /**\n     * Sets aspect ratio\n     * @public\n     * @param {Number} aspect - Camera aspect ratio\n     */\n    setAspectRatio(aspect) {\n        this._aspect = aspect;\n        this.refresh();\n    }\n    /**\n     * Returns aspect ratio\n     * @public\n     * @returns {number} - Aspect ratio\n     */\n    getAspectRatio() {\n        return this._aspect;\n    }\n    /**\n     * Sets up camera projection\n     * @public\n     * @param {number} angle - Camera view angle\n     * @param {number} aspect - Screen aspect ratio\n     */\n    _setProj(angle, aspect) {\n        this._viewAngle = angle;\n        this._aspect = aspect;\n        this._tanViewAngle_hrad = Math.tan(angle * math.RADIANS_HALF);\n        this._tanViewAngle_hradOneByHeight =\n            this._tanViewAngle_hrad * this.renderer.handler._oneByHeight;\n        let c = this.renderer.handler.canvas;\n        this._projSizeConst = Math.min(c.clientWidth < 512 ? 512 : c.clientWidth, c.clientHeight < 512 ? 512 : c.clientHeight) / (angle * math.RADIANS);\n        for (let i = 0, len = this.frustums.length; i < len; i++) {\n            this.frustums[i].setProjectionMatrix(angle, aspect, this.frustums[i].near, this.frustums[i].far);\n        }\n    }\n    /**\n     * Sets camera view angle in degrees\n     * @public\n     * @param {number} angle - View angle\n     */\n    setViewAngle(angle) {\n        this._viewAngle = angle;\n        this.refresh();\n    }\n    /**\n     * Gets camera view angle in degrees\n     * @public\n     * @returns {number} angle -\n     */\n    getViewAngle() {\n        return this._viewAngle;\n    }\n    get viewAngle() {\n        return this._viewAngle;\n    }\n    /**\n     * Sets camera to eye position\n     * @public\n     * @param {Vec3} eye - Camera position\n     * @param {Vec3} look - Look point\n     * @param {Vec3} up - Camera up vector\n     * @returns {Camera} - This camera\n     */\n    set(eye, look, up) {\n        this.eye.x = eye.x;\n        this.eye.y = eye.y;\n        this.eye.z = eye.z;\n        look = look || this._b;\n        up = up || this._u;\n        this._b.x = eye.x - look.x;\n        this._b.y = eye.y - look.y;\n        this._b.z = eye.z - look.z;\n        this._r.copy(up.cross(this._b));\n        this._b.normalize();\n        this._r.normalize();\n        this._u.copy(this._b.cross(this._r));\n        return this;\n    }\n    /**\n     * Sets camera look point\n     * @public\n     * @param {Vec3} look - Look point\n     * @param {Vec3} [up] - Camera up vector otherwise camera current up vector(this._u)\n     */\n    look(look, up) {\n        this._b.set(this.eye.x - look.x, this.eye.y - look.y, this.eye.z - look.z);\n        this._r.copy((up || this._u).cross(this._b));\n        this._b.normalize();\n        this._r.normalize();\n        this._u.copy(this._b.cross(this._r));\n    }\n    /**\n     * Slides camera to vector d - (du, dv, dn)\n     * @public\n     * @param {number} du - delta X\n     * @param {number} dv - delta Y\n     * @param {number} dn - delta Z\n     */\n    slide(du, dv, dn) {\n        this.eye.x += du * this._r.x + dv * this._u.x + dn * this._b.x;\n        this.eye.y += du * this._r.y + dv * this._u.y + dn * this._b.y;\n        this.eye.z += du * this._r.z + dv * this._u.z + dn * this._b.z;\n    }\n    /**\n     * Roll the camera to the angle in degrees\n     * @public\n     * @param {number} angle - Delta roll angle in degrees\n     */\n    roll(angle) {\n        let cs = Math.cos(math.RADIANS * angle);\n        let sn = Math.sin(math.RADIANS * angle);\n        let t = this._r.clone();\n        this._r.set(cs * t.x - sn * this._u.x, cs * t.y - sn * this._u.y, cs * t.z - sn * this._u.z);\n        this._u.set(sn * t.x + cs * this._u.x, sn * t.y + cs * this._u.y, sn * t.z + cs * this._u.z);\n    }\n    /**\n     * Pitch the camera to the angle in degrees\n     * @public\n     * @param {number} angle - Delta pitch angle in degrees\n     */\n    pitch(angle) {\n        let cs = Math.cos(math.RADIANS * angle);\n        let sn = Math.sin(math.RADIANS * angle);\n        let t = this._b.clone();\n        this._b.set(cs * t.x - sn * this._u.x, cs * t.y - sn * this._u.y, cs * t.z - sn * this._u.z);\n        this._u.set(sn * t.x + cs * this._u.x, sn * t.y + cs * this._u.y, sn * t.z + cs * this._u.z);\n    }\n    /**\n     * Yaw the camera to the angle in degrees\n     * @public\n     * @param {number} angle - Delta yaw angle in degrees\n     */\n    yaw(angle) {\n        let cs = Math.cos(math.RADIANS * angle);\n        let sn = Math.sin(math.RADIANS * angle);\n        let t = this._r.clone();\n        this._r.set(cs * t.x - sn * this._b.x, cs * t.y - sn * this._b.y, cs * t.z - sn * this._b.z);\n        this._b.set(sn * t.x + cs * this._b.x, sn * t.y + cs * this._b.y, sn * t.z + cs * this._b.z);\n    }\n    /**\n     * Returns normal vector direction to the unprojected screen point from camera eye\n     * @public\n     * @param {number} x - Screen X coordinate\n     * @param {number} y - Screen Y coordinate\n     * @returns {Vec3} - Direction vector\n     */\n    unproject(x, y) {\n        let c = this.renderer.handler.canvas, w = c.width * 0.5, h = c.height * 0.5;\n        let px = (x - w) / w, py = -(y - h) / h;\n        let world1 = this.frustums[0].inverseProjectionViewMatrix.mulVec4(new Vec4(px, py, -1.0, 1.0)).affinity(), world2 = this.frustums[0].inverseProjectionViewMatrix.mulVec4(new Vec4(px, py, 0.0, 1.0)).affinity();\n        return world2.subA(world1).toVec3().normalize();\n    }\n    /**\n     * Gets projected 3d point to the 2d screen coordinates\n     * @public\n     * @param {Vec3} v - Cartesian 3d coordinates\n     * @returns {Vec2} - Screen point coordinates\n     */\n    project(v) {\n        let r = this.frustums[0].projectionViewMatrix.mulVec4(v.toVec4()), c = this.renderer.handler.canvas;\n        return new Vec2((1 + r.x / r.w) * c.width * 0.5, (1 - r.y / r.w) * c.height * 0.5);\n    }\n    /**\n     * Rotates camera around center point\n     * @public\n     * @param {number} angle - Rotation angle in radians\n     * @param {boolean} [isArc] - If true camera up vector gets from current up vector every frame,\n     * otherwise up is always input parameter.\n     * @param {Vec3} [center] - Point that the camera rotates around\n     * @param {Vec3} [up] - Camera up vector\n     */\n    rotateAround(angle, isArc, center, up) {\n        center = center || Vec3.ZERO;\n        up = up || Vec3.UP;\n        let rot = new Mat4().setRotation(isArc ? this._u : up, angle);\n        let tr = new Mat4().setIdentity().translate(center);\n        let ntr = new Mat4().setIdentity().translate(center.negateTo());\n        let trm = tr.mul(rot).mul(ntr);\n        this.eye = trm.mulVec3(this.eye);\n        this._u = rot.mulVec3(this._u).normalize();\n        this._r = rot.mulVec3(this._r).normalize();\n        this._b = rot.mulVec3(this._b).normalize();\n    }\n    /**\n     * Rotates camera around center point by horizontal.\n     * @public\n     * @param {number} angle - Rotation angle in radians.\n     * @param {boolean} [isArc] - If true camera up vector gets from current up vector every frame,\n     * otherwise up is always input parameter.\n     * @param {Vec3} [center] - Point that the camera rotates around.\n     * @param {Vec3} [up] - Camera up vector.\n     */\n    rotateHorizontal(angle, isArc, center, up) {\n        this.rotateAround(angle, isArc, center, up);\n    }\n    /**\n     * Rotates camera around center point by vertical.\n     * @param {number} angle - Rotation angle in radians.\n     * @param {Vec3} [center] - Point that the camera rotates around.\n     */\n    rotateVertical(angle, center) {\n        this.rotateAround(angle, false, center, this._r);\n    }\n    /**\n     * Gets 3d size factor. Uses in LOD distance calculation.\n     * @public\n     * @param {Vec3} p - Far point.\n     * @param {Vec3} r - Far point.\n     * @returns {number} - Size factor.\n     */\n    projectedSize(p, r) {\n        return Math.atan(r / this.eye.distance(p)) * this._projSizeConst;\n    }\n    /**\n     * Returns model matrix.\n     * @public\n     * @returns {NumberArray16} - View matrix.\n     */\n    getViewMatrix() {\n        return this._viewMatrix._m;\n    }\n    /**\n     * Returns normal matrix.\n     * @public\n     * @returns {NumberArray9} - Normal matrix.\n     */\n    getNormalMatrix() {\n        return this._normalMatrix._m;\n    }\n    setCurrentFrustum(k) {\n        this.currentFrustumIndex = k;\n        this.isFirstPass = k === this.FARTHEST_FRUSTUM_INDEX;\n    }\n    getCurrentFrustum() {\n        return this.currentFrustumIndex;\n    }\n    get frustum() {\n        return this.frustums[this.currentFrustumIndex];\n    }\n    /**\n     * Returns projection matrix.\n     * @public\n     * @returns {Mat4} - Projection matrix.\n     */\n    getProjectionMatrix() {\n        return this.frustum.projectionMatrix._m;\n    }\n    /**\n     * Returns projection and model matrix product.\n     * @public\n     * @return {Mat4} - Projection-view matrix.\n     */\n    getProjectionViewMatrix() {\n        return this.frustum.projectionViewMatrix._m;\n    }\n    /**\n     * Returns inverse projection and model matrix product.\n     * @public\n     * @returns {Mat4} - Inverse projection-view matrix.\n     */\n    getInverseProjectionViewMatrix() {\n        return this.frustum.inverseProjectionViewMatrix._m;\n    }\n    /**\n     * Returns inverse projection matrix.\n     * @public\n     * @returns {Mat4} - Inverse projection-view matrix.\n     */\n    getInverseProjectionMatrix() {\n        return this.frustum.inverseProjectionMatrix._m;\n    }\n}\nexport { Camera };\n//# sourceMappingURL=Camera.js.map","import * as mercator from \"../mercator\";\nimport * as math from \"../math\";\nimport { Camera } from \"./Camera\";\nimport { Key } from \"../Lock\";\nimport { LonLat } from \"../LonLat\";\nimport { Mat4 } from \"../math/Mat4\";\nimport { Quat } from \"../math/Quat\";\nimport { Ray } from \"../math/Ray\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Planet camera.\n * @class\n * @extends {Camera}\n * @param {Planet} planet - Planet render node.\n * @param {IPlanetCameraParams} [options] - Planet camera options:\n * @param {string} [options.name] - Camera name.\n * @param {number} [options.viewAngle] - Camera angle of view.\n * @param {number} [options.near] - Camera near plane distance. Default is 1.0\n * @param {number} [options.far] - Camera far plane distance. Default is og.math.MAX\n * @param {number} [options.minAltitude] - Minimal altitude for the camera. Default is 5\n * @param {number} [options.maxAltitude] - Maximal altitude for the camera. Default is 20000000\n * @param {Vec3} [options.eye] - Camera eye position. Default (0,0,0)\n * @param {Vec3} [options.look] - Camera look position. Default (0,0,0)\n * @param {Vec3} [options.up] - Camera eye position. Default (0,1,0)\n */\nclass PlanetCamera extends Camera {\n    constructor(planet, options = {}) {\n        super(planet.renderer, {\n            ...options,\n            frustums: options.frustums || [[1, 100 + 0.075], [100, 1000 + 0.075], [1000, 1e6 + 10000], [1e6, 1e9]],\n        });\n        this.planet = planet;\n        this.minAltitude = options.minAltitude || 1;\n        this.maxAltitude = options.maxAltitude || 20000000;\n        this._lonLat = this.planet.ellipsoid.cartesianToLonLat(this.eye);\n        this._lonLatMerc = this._lonLat.forwardMercator();\n        this._terrainAltitude = this._lonLat.height;\n        this._terrainPoint = new Vec3();\n        this._insideSegment = null;\n        this.slope = 0;\n        this._keyLock = new Key();\n        this._framesArr = [];\n        this._framesCounter = 0;\n        this._numFrames = 50;\n        this._completeCallback = null;\n        this._frameCallback = null;\n        this._flying = false;\n        this._checkTerrainCollision = true;\n        this.eyeNorm = this.eye.getNormal();\n    }\n    setTerrainCollisionActivity(isActive) {\n        this._checkTerrainCollision = isActive;\n    }\n    /**\n     * Updates camera view space.\n     * @public\n     * @virtual\n     */\n    update() {\n        this.events.stopPropagation();\n        let maxAlt = this.maxAltitude + this.planet.ellipsoid.getEquatorialSize();\n        if (this.eye.length() > maxAlt) {\n            this.eye.copy(this.eye.getNormal().scale(maxAlt));\n        }\n        super.update();\n        this.updateGeodeticPosition();\n        this.eyeNorm = this.eye.getNormal();\n        this.slope = this._b.dot(this.eyeNorm);\n        this.events.dispatch(this.events.viewchange, this);\n    }\n    updateGeodeticPosition() {\n        this.planet.ellipsoid.cartesianToLonLatRes(this.eye, this._lonLat);\n        if (Math.abs(this._lonLat.lat) <= mercator.MAX_LAT) {\n            LonLat.forwardMercatorRes(this._lonLat, this._lonLatMerc);\n        }\n    }\n    /**\n     * Sets altitude over the terrain.\n     * @public\n     * @param {number} alt - Altitude over the terrain.\n     */\n    setAltitude(alt) {\n        let t = this._terrainPoint;\n        let n = this.planet.ellipsoid.getSurfaceNormal3v(this.eye);\n        this.eye.x = n.x * alt + t.x;\n        this.eye.y = n.y * alt + t.y;\n        this.eye.z = n.z * alt + t.z;\n        this._terrainAltitude = alt;\n    }\n    /**\n     * Gets altitude over the terrain.\n     * @public\n     */\n    getAltitude() {\n        return this._terrainAltitude;\n    }\n    /**\n     * Places camera to view to the geographical point.\n     * @public\n     * @param {LonLat} lonlat - New camera and camera view position.\n     * @param {LonLat} [lookLonLat] - Look up coordinates.\n     * @param {Vec3} [up] - Camera UP vector. Default (0,1,0)\n     */\n    setLonLat(lonlat, lookLonLat, up) {\n        this.stopFlying();\n        this._lonLat.set(lonlat.lon, lonlat.lat, lonlat.height || this._lonLat.height);\n        let el = this.planet.ellipsoid;\n        let newEye = el.lonLatToCartesian(this._lonLat);\n        let newLook = lookLonLat ? el.lonLatToCartesian(lookLonLat) : Vec3.ZERO;\n        this.set(newEye, newLook, up || Vec3.NORTH);\n        this.update();\n    }\n    /**\n     * Returns camera geographical position.\n     * @public\n     * @returns {LonLat}\n     */\n    getLonLat() {\n        return this._lonLat;\n    }\n    /**\n     * Returns camera height.\n     * @public\n     * @returns {number}\n     */\n    getHeight() {\n        return this._lonLat.height;\n    }\n    /**\n     * Gets position by viewable extent.\n     * @public\n     * @param {Extent} extent - Viewable extent.\n     * @param {Number} height - Camera height\n     * @returns {Vec3}\n     */\n    getExtentPosition(extent, height) {\n        height = height || 0;\n        let north = extent.getNorth();\n        let south = extent.getSouth();\n        let east = extent.getEast();\n        let west = extent.getWest();\n        if (west > east) {\n            east += 360;\n        }\n        let e = this.planet.ellipsoid;\n        let cart = new LonLat(east, north);\n        let northEast = e.lonLatToCartesian(cart);\n        cart.lat = south;\n        let southEast = e.lonLatToCartesian(cart);\n        cart.lon = west;\n        let southWest = e.lonLatToCartesian(cart);\n        cart.lat = north;\n        let northWest = e.lonLatToCartesian(cart);\n        let center = Vec3.sub(northEast, southWest).scale(0.5).addA(southWest);\n        let mag = center.length();\n        if (mag < 0.000001) {\n            cart.lon = (east + west) * 0.5;\n            cart.lat = (north + south) * 0.5;\n            center = e.lonLatToCartesian(cart);\n        }\n        northWest.subA(center);\n        southEast.subA(center);\n        northEast.subA(center);\n        southWest.subA(center);\n        let direction = center.getNormal(); // ellipsoid.getSurfaceNormal(center).negate().normalize();\n        let right = direction.cross(Vec3.NORTH).normalize();\n        let up = right.cross(direction).normalize();\n        let _h = Math.max(Math.abs(up.dot(northWest)), Math.abs(up.dot(southEast)), Math.abs(up.dot(northEast)), Math.abs(up.dot(southWest)));\n        let _w = Math.max(Math.abs(right.dot(northWest)), Math.abs(right.dot(southEast)), Math.abs(right.dot(northEast)), Math.abs(right.dot(southWest)));\n        let tanPhi = Math.tan(this._viewAngle * math.RADIANS * 0.5);\n        let tanTheta = this._aspect * tanPhi;\n        let d = Math.max(_w / tanTheta, _h / tanPhi);\n        center.normalize();\n        center.scale(mag + d + height);\n        return center;\n    }\n    /**\n     * View current extent.\n     * @public\n     * @param {Extent} extent - Current extent.\n     * @param {number} [height]\n     */\n    viewExtent(extent, height) {\n        this.stopFlying();\n        this.set(this.getExtentPosition(extent, height), Vec3.ZERO, Vec3.NORTH);\n        this.update();\n    }\n    /**\n     * Flies to the current extent.\n     * @public\n     * @param {Extent} extent - Current extent.\n     * @param {number} [height] - Destination height.\n     * @param {Vec3} [up] - Camera UP in the end of flying. Default - (0,1,0)\n     * @param {Number} [ampl] - Altitude amplitude factor.\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\n     * @param {Function} [frameCallback] - Each frame callback\n     */\n    flyExtent(extent, height, up, ampl, completeCallback, startCallback, frameCallback) {\n        this.flyCartesian(this.getExtentPosition(extent, height), Vec3.ZERO, up, ampl == null ? 1 : ampl, completeCallback, startCallback, frameCallback);\n    }\n    viewDistance(cartesian, distance = 10000.0) {\n        let p0 = this.eye.add(this.getForward().scaleTo(distance));\n        let _rot = Quat.getRotationBetweenVectors(p0.getNormal(), cartesian.getNormal());\n        if (_rot.isZero()) {\n            let newPos = cartesian.add(this.getBackward().scaleTo(distance));\n            this.set(newPos, cartesian);\n        }\n        else {\n            let newPos = cartesian.add(_rot.mulVec3(this.getBackward()).scale(distance)), newUp = _rot.mulVec3(this.getUp());\n            this.set(newPos, cartesian, newUp);\n        }\n        this.update();\n    }\n    flyDistance(cartesian, distance = 10000.0, ampl = 0.0, completeCallback, startCallback, frameCallback) {\n        let p0 = this.eye.add(this.getForward().scaleTo(distance));\n        let _rot = Quat.getRotationBetweenVectors(p0.getNormal(), cartesian.getNormal());\n        if (_rot.isZero()) {\n            let newPos = cartesian.add(this.getBackward().scaleTo(distance));\n            this.set(newPos, cartesian);\n        }\n        else {\n            let newPos = cartesian.add(_rot.mulVec3(this.getBackward()).scale(distance)), newUp = _rot.mulVec3(this.getUp());\n            this.flyCartesian(newPos, cartesian, newUp, ampl, completeCallback, startCallback, frameCallback);\n        }\n    }\n    /**\n     * Flies to the cartesian coordinates.\n     * @public\n     * @param {Vec3} cartesian - Finish cartesian coordinates.\n     * @param {Vec3} [look] - Camera LOOK in the end of flying. Default - (0,0,0)\n     * @param {Vec3} [up] - Camera UP vector in the end of flying. Default - (0,1,0)\n     * @param {Number} [ampl=1.0] - Altitude amplitude factor.\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\n     * @param {Function} [frameCallback] - Each frame callback\n     */\n    flyCartesian(cartesian, look = Vec3.ZERO, up = Vec3.NORTH, ampl = 1.0, completeCallback = () => {\n    }, startCallback = () => {\n    }, frameCallback = () => {\n    }) {\n        this.stopFlying();\n        look = look || Vec3.ZERO;\n        up = up || Vec3.NORTH;\n        this._completeCallback = completeCallback;\n        this._frameCallback = frameCallback;\n        if (startCallback) {\n            startCallback.call(this);\n        }\n        if (look instanceof LonLat) {\n            look = this.planet.ellipsoid.lonLatToCartesian(look);\n        }\n        let ground_a = this.planet.ellipsoid.lonLatToCartesian(new LonLat(this._lonLat.lon, this._lonLat.lat));\n        let v_a = this._u, n_a = this._b;\n        let lonlat_b = this.planet.ellipsoid.cartesianToLonLat(cartesian);\n        let up_b = up;\n        let ground_b = this.planet.ellipsoid.lonLatToCartesian(new LonLat(lonlat_b.lon, lonlat_b.lat, 0));\n        let n_b = Vec3.sub(cartesian, look);\n        let u_b = up_b.cross(n_b);\n        n_b.normalize();\n        u_b.normalize();\n        let v_b = n_b.cross(u_b);\n        let an = ground_a.getNormal();\n        let bn = ground_b.getNormal();\n        let anbn = 1.0 - an.dot(bn);\n        let hM_a = ampl * math.SQRT_HALF * Math.sqrt(anbn > 0.0 ? anbn : 0.0);\n        let maxHeight = 6639613;\n        let currMaxHeight = Math.max(this._lonLat.height, lonlat_b.height);\n        if (currMaxHeight > maxHeight) {\n            maxHeight = currMaxHeight;\n        }\n        let max_h = currMaxHeight + 2.5 * hM_a * (maxHeight - currMaxHeight);\n        let zero = Vec3.ZERO;\n        // camera path and orientations calculation\n        for (let i = 0; i <= this._numFrames; i++) {\n            let d = 1 - i / this._numFrames;\n            d = d * d * (3 - 2 * d);\n            d *= d;\n            let g_i = ground_a.smerp(ground_b, d).normalize();\n            let ground_i = this.planet.getRayIntersectionEllipsoid(new Ray(zero, g_i));\n            let t = 1 - d;\n            let height_i = this._lonLat.height * d * d * d +\n                max_h * 3 * d * d * t +\n                max_h * 3 * d * t * t +\n                lonlat_b.height * t * t * t;\n            let eye_i = ground_i.addA(g_i.scale(height_i));\n            let up_i = v_a.smerp(v_b, d);\n            let look_i = Vec3.add(eye_i, n_a.smerp(n_b, d).negateTo());\n            let n = new Vec3(eye_i.x - look_i.x, eye_i.y - look_i.y, eye_i.z - look_i.z);\n            let u = up_i.cross(n);\n            n.normalize();\n            u.normalize();\n            let v = n.cross(u);\n            this._framesArr[i] = {\n                eye: eye_i,\n                n: n,\n                u: u,\n                v: v\n            };\n        }\n        this._framesCounter = this._numFrames;\n        this._flying = true;\n    }\n    /**\n     * Flies to the geo coordinates.\n     * @public\n     * @param {LonLat} lonlat - Finish coordinates.\n     * @param {Vec3 | LonLat} [look] - Camera LOOK in the end of flying. Default - (0,0,0)\n     * @param {Vec3} [up] - Camera UP vector in the end of flying. Default - (0,1,0)\n     * @param {number} [ampl] - Altitude amplitude factor.\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\n     * @param {Function} [startCallback] - Callback that calls befor the flying begins.\n     * @param {Function} [frameCallback] - each frame callback\n     */\n    flyLonLat(lonlat, look, up, ampl, completeCallback, startCallback, frameCallbak) {\n        let _lonLat = new LonLat(lonlat.lon, lonlat.lat, lonlat.height || this._lonLat.height);\n        this.flyCartesian(this.planet.ellipsoid.lonLatToCartesian(_lonLat), look, up, ampl, completeCallback, startCallback, frameCallbak);\n    }\n    /**\n     * Breaks the flight.\n     * @public\n     */\n    stopFlying() {\n        this.planet.layerLock.free(this._keyLock);\n        this.planet.terrainLock.free(this._keyLock);\n        this.planet.normalMapCreator.free(this._keyLock);\n        this._flying = false;\n        this._framesArr.length = 0;\n        this._framesArr = [];\n        this._framesCounter = -1;\n        this._frameCallback = null;\n    }\n    /**\n     * Returns camera is flying.\n     * @public\n     * @returns {boolean}\n     */\n    isFlying() {\n        return this._flying;\n    }\n    /**\n     * Rotates around planet to the left.\n     * @public\n     * @param {number} angle - Rotation angle.\n     * @param {boolean} [spin] - If its true rotates around globe spin.\n     */\n    rotateLeft(angle, spin) {\n        this.rotateHorizontal(angle * math.RADIANS, spin !== true, Vec3.ZERO);\n        this.update();\n    }\n    /**\n     * Rotates around planet to the right.\n     * @public\n     * @param {number} angle - Rotation angle.\n     * @param {boolean} [spin] - If its true rotates around globe spin.\n     */\n    rotateRight(angle, spin) {\n        this.rotateHorizontal(-angle * math.RADIANS, spin !== true, Vec3.ZERO);\n        this.update();\n    }\n    /**\n     * Rotates around planet to the North Pole.\n     * @public\n     * @param {number} angle - Rotation angle.\n     */\n    rotateUp(angle) {\n        this.rotateVertical(angle * math.RADIANS, Vec3.ZERO);\n        this.update();\n    }\n    /**\n     * Rotates around planet to the South Pole.\n     * @public\n     * @param {number} angle - Rotation angle.\n     */\n    rotateDown(angle) {\n        this.rotateVertical(-angle * math.RADIANS, Vec3.ZERO);\n        this.update();\n    }\n    rotateVertical(angle, center, minSlope = 0) {\n        let rot = new Mat4().setRotation(this._r, angle);\n        let tr = new Mat4().setIdentity().translate(center);\n        let ntr = new Mat4().setIdentity().translate(center.negateTo());\n        let trm = tr.mul(rot).mul(ntr);\n        let eye = trm.mulVec3(this.eye);\n        let u = rot.mulVec3(this._u).normalize();\n        let r = rot.mulVec3(this._r).normalize();\n        let b = rot.mulVec3(this._b).normalize();\n        let eyeNorm = eye.getNormal();\n        let slope = b.dot(eyeNorm);\n        if (minSlope) {\n            let dSlope = slope - this.slope;\n            if (slope < minSlope && dSlope < 0)\n                return;\n            if ((slope > 0.1 && u.dot(eyeNorm) > 0) ||\n                this.slope <= 0.1 ||\n                this._u.dot(this.eye.getNormal()) <= 0.0) {\n                this.eye = eye;\n                this._u = u;\n                this._r = r;\n                this._b = b;\n            }\n        }\n        else {\n            this.eye = eye;\n            this._u = u;\n            this._r = r;\n            this._b = b;\n        }\n    }\n    /**\n     * Prepare camera to the frame. Used in render node frame function.\n     * @public\n     */\n    checkFly() {\n        if (this._flying) {\n            let c = this._numFrames - this._framesCounter;\n            this.planet.layerLock.lock(this._keyLock);\n            this.planet.terrainLock.lock(this._keyLock);\n            this.planet.normalMapCreator.lock(this._keyLock);\n            this.eye = this._framesArr[c].eye;\n            this._r = this._framesArr[c].u;\n            this._u = this._framesArr[c].v;\n            this._b = this._framesArr[c].n;\n            if (this._frameCallback) {\n                this._frameCallback();\n            }\n            this.update();\n            this._framesCounter--;\n            if (this._framesCounter < 0) {\n                this.stopFlying();\n                if (this._completeCallback) {\n                    this._completeCallback();\n                    this._completeCallback = null;\n                }\n            }\n        }\n    }\n    checkTerrainCollision() {\n        this._terrainAltitude = this._lonLat.height;\n        if (this._insideSegment && this._insideSegment.planet) {\n            this._terrainAltitude = this._insideSegment.getTerrainPoint(this.eye, this._insideSegment.getInsideLonLat(this), this._terrainPoint);\n            if (this._terrainAltitude < this.minAltitude && this._checkTerrainCollision) {\n                this.setAltitude(this.minAltitude);\n            }\n            return this._terrainPoint;\n        }\n    }\n    getSurfaceVisibleDistance(d) {\n        let R = this.planet.ellipsoid.equatorialSize;\n        return R * Math.acos(R / (R + this._lonLat.height + d));\n    }\n    getHeading() {\n        let u = this.eye.getNormal();\n        let f = Vec3.proj_b_to_plane(this.slope >= 0.97 ? this.getUp() : this.getForward(), u).normalize(), n = Vec3.proj_b_to_plane(Vec3.NORTH, u).normalize();\n        let res = Math.sign(u.dot(f.cross(n))) * Math.acos(f.dot(n)) * math.DEGREES;\n        if (res < 0.0) {\n            return 360.0 + res;\n        }\n        return res;\n    }\n    isVisible(poi) {\n        let e = this.eye.length();\n        return this.eye.distance(poi) < Math.sqrt(e * e - this.planet.ellipsoid.equatorialSizeSqr);\n    }\n}\nexport { PlanetCamera };\n//# sourceMappingURL=PlanetCamera.js.map","// import { QueueArray } from '../QueueArray.js';\nimport { BaseWorker } from \"./BaseWorker\";\nclass TerrainWorker extends BaseWorker {\n    constructor(numWorkers = 2) {\n        super(numWorkers, TERRAIN_PROGRAM);\n    }\n    _onMessage(e) {\n        this._source.get(e.data.id).segment._terrainWorkerCallback(e.data);\n        this._source.delete(e.data.id);\n        e.data.normalMapNormals = null;\n        e.data.normalMapVertices = null;\n        e.data.normalMapVerticesHigh = null;\n        e.data.normalMapVerticesLow = null;\n        e.data.terrainVertices = null;\n        e.data.terrainVerticesHigh = null;\n        e.data.terrainVerticesLow = null;\n    }\n    make(info) {\n        if (info.segment.plainReady && info.segment.terrainIsLoading) {\n            if (this._workerQueue.length) {\n                const w = this._workerQueue.pop();\n                this._source.set(this._sourceId, info);\n                let segment = info.segment;\n                w.postMessage({\n                    'elevations': info.elevations,\n                    'this_plainVertices': segment.plainVertices,\n                    'this_plainNormals': segment.plainNormals,\n                    'this_normalMapVertices': segment.normalMapVertices,\n                    'this_normalMapNormals': segment.normalMapNormals,\n                    'heightFactor': segment.planet._heightFactor,\n                    'gridSize': segment.planet.terrain.gridSizeByZoom[segment.tileZoom],\n                    'noDataValues': segment.planet.terrain.noDataValues,\n                    'id': this._sourceId\n                }, [\n                    info.elevations.buffer,\n                    segment.plainVertices.buffer,\n                    segment.plainNormals.buffer,\n                    segment.normalMapVertices.buffer,\n                    segment.normalMapNormals.buffer\n                ]);\n                this._sourceId++;\n            }\n            else {\n                this._pendingQueue.push(info);\n            }\n        }\n        else {\n            this.check();\n        }\n    }\n}\nconst TERRAIN_PROGRAM = `'use strict';\n    //\n    //Terrain worker\n    //\n\n    function binarySearchFast(arr, x) {\n        let start = 0,\n            end = arr.length - 1;\n        while (start <= end) {\n            let k = Math.floor((start + end) * 0.5); \n            if (Math.abs(arr[k] - x) < 1e-3)\n                return k;\n            else if (arr[k] < x)\n                start = k + 1;\n            else\n                end = k - 1;\n        }\n        return -1;\n    };\n\n    function checkNoDataValue(noDataValues, value) {\n        return binarySearchFast(noDataValues, value) !== -1;\n    };\n\n\n    var Vec3 = function(x, y, z) {\n        this.x = x;\n        this.y = y;\n        this.z = z;\n    };\n\n    var doubleToTwoFloats = function(v, high, low) {\n\n        let x = v.x, y = v.y, z = v.z;\n    \n        if (x >= 0.0) {\n            var doubleHigh = Math.floor(x / 65536.0) * 65536.0;\n            high.x = Math.fround(doubleHigh);\n            low.x = Math.fround(x - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-x / 65536.0) * 65536.0;\n            high.x = Math.fround(-doubleHigh);\n            low.x = Math.fround(x + doubleHigh);\n        }\n\n        if (y >= 0.0) {\n            var doubleHigh = Math.floor(y / 65536.0) * 65536.0;\n            high.y = Math.fround(doubleHigh);\n            low.y = Math.fround(y - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-y / 65536.0) * 65536.0;\n            high.y = Math.fround(-doubleHigh);\n            low.y = Math.fround(y + doubleHigh);\n        }\n\n        if (z >= 0.0) {\n            var doubleHigh = Math.floor(z / 65536.0) * 65536.0;\n            high.z = Math.fround(doubleHigh);\n            low.z = Math.fround(z - doubleHigh);\n        } else {\n            var doubleHigh = Math.floor(-z / 65536.0) * 65536.0;\n            high.z = Math.fround(-doubleHigh);\n            low.z = Math.fround(z + doubleHigh);\n        }\n    };\n\n    Vec3.prototype.sub = function(v) {\n        return new Vec3(this.x - v.x, this.y - v.y, this.z - v.z);\n    };\n\n    Vec3.prototype.add = function(v) {\n        return new Vec3(this.x + v.x, this.y + v.y, this.z + v.z);\n    };\n\n    Vec3.prototype.cross = function(v) {\n        return new Vec3(\n            this.y * v.z - this.z * v.y,\n            this.z * v.x - this.x * v.z,\n            this.x * v.y - this.y * v.x\n        );\n    };\n\n    Vec3.prototype.normalize = function(v) {\n        var x = this.x, y = this.y, z = this.z;\n        var length = 1.0 / Math.sqrt(x * x + y * y + z * z);\n        this.x = x * length;\n        this.y = y * length;\n        this.z = z * length;\n        return this;\n    };\n\n    Vec3.prototype.distance = function(v) {\n        return this.sub(v).length();\n    };\n\n    Vec3.prototype.length = function () {\n        return Math.sqrt(this.x * this.x + this.y * this.y + this.z * this.z);\n    };\n\n    var blerp = function(x, y, fQ11, fQ21, fQ12, fQ22) {\n        return (fQ11 * (1.0 - x) * (1.0 - y) + fQ21 * x * (1.0 - y) + fQ12 * (1.0 - x) * y + fQ22 * x * y);\n    };\n    \n    var slice = function (t, h1, h0) {\n      return t * (h1 - h0);\n    };\n\n    var _tempVec = new Vec3(0.0, 0.0, 0.0);\n\n    var _tempHigh = new Vec3(0.0, 0.0, 0.0),\n        _tempLow = new Vec3(0.0, 0.0, 0.0);\n\n    self.onmessage = function (e) {\n        var elevations = e.data.elevations,\n            this_plainVertices = e.data.this_plainVertices,\n            this_plainNormals = e.data.this_plainNormals,\n            this_normalMapVertices = e.data.this_normalMapVertices,\n            this_normalMapNormals = e.data.this_normalMapNormals,\n            heightFactor =  e.data.heightFactor,\n            gridSize = e.data.gridSize,\n            noDataValues = e.data.noDataValues,\n            id = e.data.id;\n        \n        var xmin = 549755748352.0, xmax = -549755748352.0, \n            ymin = 549755748352.0, ymax = -549755748352.0, \n            zmin = 549755748352.0, zmax = -549755748352.0;\n\n        const fileGridSize = Math.sqrt(elevations.length) - 1;\n\n        const fileGridSize_one = fileGridSize + 1;\n        const fileGridSize_one_x2 = fileGridSize_one * fileGridSize_one;\n        const tgs = gridSize;\n        const dg = fileGridSize / tgs;\n        const gs = tgs + 1;\n        const hf = heightFactor;\n\n        var nmvInd = 0,\n            vInd = 0,\n            noDataInd = 0;\n\n        var gsgs3 = gs * gs * 3;\n\n        var terrainVertices = new Float64Array(gsgs3),\n            terrainVerticesHigh = new Float32Array(gsgs3),\n            terrainVerticesLow = new Float32Array(gsgs3),\n            noDataVertices = new Uint8Array(gs * gs);\n\n        var normalMapNormals,\n            normalMapVertices,\n            normalMapVerticesHigh,\n            normalMapVerticesLow;\n\n        var nv = this_normalMapVertices,\n            nn = this_normalMapNormals;\n\n        if (fileGridSize >= tgs) {\n\n            normalMapNormals = new Float32Array(fileGridSize_one_x2 * 3);\n            normalMapVertices = new Float64Array(fileGridSize_one_x2 * 3);\n            normalMapVerticesHigh = new Float32Array(fileGridSize_one_x2 * 3);\n            normalMapVerticesLow = new Float32Array(fileGridSize_one_x2 * 3);\n\n            for (let k = 0; k < fileGridSize_one_x2; k++) {\n\n                var j = k % fileGridSize_one,\n                    i = ~~(k / fileGridSize_one);\n\n                //\n                // V0\n                //\n                var hInd0 = k;\n                var vInd0 = hInd0 * 3;\n                var currElv = elevations[hInd0];\n                if(checkNoDataValue(noDataValues, currElv)) {\n                    currElv = 0.0;\n                }\n                var h0 = hf * currElv;\n                var v0 = new Vec3(nv[vInd0] + h0 * nn[vInd0], nv[vInd0 + 1] + h0 * nn[vInd0 + 1], nv[vInd0 + 2] + h0 * nn[vInd0 + 2]);\n                                \n                doubleToTwoFloats(v0, _tempHigh, _tempLow);\n\n                normalMapVertices[vInd0] = v0.x;\n                normalMapVertices[vInd0 + 1] = v0.y;\n                normalMapVertices[vInd0 + 2] = v0.z;\n\n                normalMapVerticesHigh[vInd0] = _tempHigh.x;\n                normalMapVerticesHigh[vInd0 + 1] = _tempHigh.y;\n                normalMapVerticesHigh[vInd0 + 2] = _tempHigh.z;\n\n                normalMapVerticesLow[vInd0] = _tempLow.x;\n                normalMapVerticesLow[vInd0 + 1] = _tempLow.y;\n                normalMapVerticesLow[vInd0 + 2] = _tempLow.z;\n\n                //\n                // The vertex goes into screen buffer\n                if (i % dg === 0 && j % dg === 0) {\n\n                    let currVert = new Vec3(nv[vInd0], nv[vInd0 + 1], nv[vInd0 + 2]);\n                    let nextVert = new Vec3(nv[vInd0 + 3], nv[vInd0 + 4], nv[vInd0 + 5]);\n\n                    let nextElv =  elevations[hInd0 + 1];\n                    if(checkNoDataValue(noDataValues, nextElv)) {\n                        nextElv = 0.0;\n                    }\n                    \n                    let eps = false;\n                    if(noDataValues.length === 0){\n                        let step = currVert.distance(nextVert);\n                        let deltaElv = Math.abs(currElv - nextElv);\n                        eps = ((deltaElv / step) > 10.0) || (currElv < -5000);\n                    }\n\n                    if(eps){\n                        noDataVertices[noDataInd] = 1;\n                    } else {\n                        noDataVertices[noDataInd] = 0;\n                        if (v0.x < xmin) xmin = v0.x; if (v0.x > xmax) xmax = v0.x;\n                        if (v0.y < ymin) ymin = v0.y; if (v0.y > ymax) ymax = v0.y;\n                        if (v0.z < zmin) zmin = v0.z; if (v0.z > zmax) zmax = v0.z;\n                    }\n\n                    terrainVerticesHigh[vInd] = _tempHigh.x;\n                    terrainVerticesLow[vInd] = _tempLow.x;\n                    terrainVertices[vInd++] = v0.x;\n\n                    terrainVerticesHigh[vInd] = _tempHigh.y;\n                    terrainVerticesLow[vInd] = _tempLow.y;\n                    terrainVertices[vInd++] = v0.y;\n\n                    terrainVerticesHigh[vInd] = _tempHigh.z;\n                    terrainVerticesLow[vInd] = _tempLow.z;\n                    terrainVertices[vInd++] = v0.z;\n\n                    noDataInd++;\n                }\n\n                if (i !== fileGridSize && j !== fileGridSize) {\n\n                    //\n                    //  V1\n                    //\n                    var hInd1 = k + 1;\n                    var vInd1 = hInd1 * 3;\n                    var elv = elevations[hInd1];\n                    if(checkNoDataValue(noDataValues, elv)) {\n                        elv = 0.0;\n                    }\n                    var h1 = hf * elv;\n                    var v1 = new Vec3(nv[vInd1] + h1 * nn[vInd1], nv[vInd1 + 1] + h1 * nn[vInd1 + 1], nv[vInd1 + 2] + h1 * nn[vInd1 + 2]);\n\n                    doubleToTwoFloats(v1, _tempHigh, _tempLow);\n\n                    normalMapVertices[vInd1] = v1.x;\n                    normalMapVertices[vInd1 + 1] = v1.y;\n                    normalMapVertices[vInd1 + 2] = v1.z;\n\n                    normalMapVerticesHigh[vInd1] = _tempHigh.x;\n                    normalMapVerticesHigh[vInd1 + 1] = _tempHigh.y;\n                    normalMapVerticesHigh[vInd1 + 2] = _tempHigh.z;\n\n                    normalMapVerticesLow[vInd1] = _tempLow.x;\n                    normalMapVerticesLow[vInd1 + 1] = _tempLow.y;\n                    normalMapVerticesLow[vInd1 + 2] = _tempLow.z;\n\n                    //\n                    //  V2\n                    //\n                    var hInd2 = k + fileGridSize_one;\n                    var vInd2 = hInd2 * 3;\n                    var elv = elevations[hInd2];\n                    if(checkNoDataValue(noDataValues, elv)) {\n                        elv = 0.0;\n                    }\n                    var h2 = hf * elv;\n                    var v2 = new Vec3(nv[vInd2] + h2 * nn[vInd2], nv[vInd2 + 1] + h2 * nn[vInd2 + 1], nv[vInd2 + 2] + h2 * nn[vInd2 + 2]);\n\n                    doubleToTwoFloats(v2, _tempHigh, _tempLow);\n\n                    normalMapVertices[vInd2] = v2.x;\n                    normalMapVertices[vInd2 + 1] = v2.y;\n                    normalMapVertices[vInd2 + 2] = v2.z;\n\n                    normalMapVerticesHigh[vInd2] = _tempHigh.x;\n                    normalMapVerticesHigh[vInd2 + 1] = _tempHigh.y;\n                    normalMapVerticesHigh[vInd2 + 2] = _tempHigh.z;\n\n                    normalMapVerticesLow[vInd2] = _tempLow.x;\n                    normalMapVerticesLow[vInd2 + 1] = _tempLow.y;\n                    normalMapVerticesLow[vInd2 + 2] = _tempLow.z;\n\n                    //\n                    //  V3\n                    //\n                    var hInd3 = k + fileGridSize_one + 1;\n                    var vInd3 = hInd3 * 3;\n                    var elv = elevations[hInd3];\n                    if(checkNoDataValue(noDataValues, elv)) {\n                        elv = 0.0;\n                    }\n                    var h3 = hf * elv;\n                    var v3 = new Vec3(nv[vInd3] + h3 * nn[vInd3], nv[vInd3 + 1] + h3 * nn[vInd3 + 1], nv[vInd3 + 2] + h3 * nn[vInd3 + 2]);\n\n                    doubleToTwoFloats(v3, _tempHigh, _tempLow);\n\n                    normalMapVertices[vInd3] = v3.x;\n                    normalMapVertices[vInd3 + 1] = v3.y;\n                    normalMapVertices[vInd3 + 2] = v3.z;\n\n                    normalMapVerticesHigh[vInd3] = _tempHigh.x;\n                    normalMapVerticesHigh[vInd3 + 1] = _tempHigh.y;\n                    normalMapVerticesHigh[vInd3 + 2] = _tempHigh.z;\n\n                    normalMapVerticesLow[vInd3] = _tempLow.x;\n                    normalMapVerticesLow[vInd3 + 1] = _tempLow.y;\n                    normalMapVerticesLow[vInd3 + 2] = _tempLow.z;\n\n                    //\n                    // Normal\n                    //\n                    var e10 = v1.sub(v0),\n                        e20 = v2.sub(v0),\n                        e30 = v3.sub(v0);\n                    var sw = e20.cross(e30).normalize();\n                    var ne = e30.cross(e10).normalize();\n                    var n0 = ne.add(sw).normalize();\n\n                    normalMapNormals[vInd0] += n0.x;\n                    normalMapNormals[vInd0 + 1] += n0.y;\n                    normalMapNormals[vInd0 + 2] += n0.z;\n\n                    normalMapNormals[vInd1] += ne.x;\n                    normalMapNormals[vInd1 + 1] += ne.y;\n                    normalMapNormals[vInd1 + 2] += ne.z;\n\n                    normalMapNormals[vInd2] += sw.x;\n                    normalMapNormals[vInd2 + 1] += sw.y;\n                    normalMapNormals[vInd2 + 2] += sw.z;\n\n                    normalMapNormals[vInd3] += n0.x;\n                    normalMapNormals[vInd3 + 1] += n0.y;\n                    normalMapNormals[vInd3 + 2] += n0.z;\n                }\n            }\n\n        } else {\n\n            normalMapNormals = new Float32Array(gsgs3);\n            normalMapVertices = new Float64Array(gsgs3);\n            normalMapVerticesHigh = new Float32Array(gsgs3);\n            normalMapVerticesLow = new Float32Array(gsgs3);\n            normalMapNormals = new Float32Array(gsgs3);\n\n            var oneSize = tgs / fileGridSize;\n            var h, inside_i, inside_j, v_i, v_j;\n            var gsgs = gsgs3 / 3;\n            var fgsOne = fileGridSize + 1;\n\n            for(let i = 0; i < gsgs; i++) {\n                let ii = Math.floor(i / gs),\n                    ij = i % gs;\n              \n                let qii = ii % oneSize,\n                    qij = ij % oneSize;\n\n                let hlt_ind = Math.floor(ii / oneSize) * fgsOne + Math.floor(ij / oneSize);\n\n                if (ij === tgs) {\n                    hlt_ind -= 1;\n                    qij = oneSize;\n                }\n\n                if (ii === tgs) {\n                    hlt_ind -= fgsOne;\n                    qii = oneSize;\n                }\n\n                let hrt_ind = hlt_ind + 1,\n                    hlb_ind = hlt_ind + fgsOne,\n                    hrb_ind = hlb_ind + 1;\n\n                let h_lt = elevations[hlt_ind],\n                    h_rt = elevations[hrt_ind],\n                    h_lb = elevations[hlb_ind],\n                    h_rb = elevations[hrb_ind];\n\n                if(checkNoDataValue(noDataValues, h_lt)) {\n                    h_lt = 0.0;\n                }\n\n                if(checkNoDataValue(noDataValues, h_rt)) {\n                    h_rt = 0.0;\n                }\n\n                if(checkNoDataValue(noDataValues, h_lb)) {\n                    h_lb = 0.0;\n                }\n\n                if(checkNoDataValue(noDataValues, h_rb)) {\n                    h_rb = 0.0;\n                }\n\n                let hi = blerp(qij / oneSize, qii / oneSize, h_lt, h_rt, h_lb, h_rb);\n\n                let i3 = i * 3;\n\n                _tempVec.x = this_plainVertices[i3] + hi * this_plainNormals[i3],\n                _tempVec.y = this_plainVertices[i3 + 1] + hi * this_plainNormals[i3 + 1],\n                _tempVec.z = this_plainVertices[i3 + 2] + hi * this_plainNormals[i3 + 2];\n\n                doubleToTwoFloats(_tempVec, _tempHigh, _tempLow);\n\n                terrainVertices[i3] = _tempVec.x;\n                terrainVertices[i3 + 1] = _tempVec.y;\n                terrainVertices[i3 + 2] = _tempVec.z;\n\n                terrainVerticesHigh[i3] = _tempHigh.x;\n                terrainVerticesHigh[i3 + 1] = _tempHigh.y;\n                terrainVerticesHigh[i3 + 2] = _tempHigh.z;\n\n                terrainVerticesLow[i3] = _tempLow.x;\n                terrainVerticesLow[i3 + 1] = _tempLow.y;\n                terrainVerticesLow[i3 + 2] = _tempLow.z;\n\n                if (_tempVec.x < xmin) xmin = _tempVec.x; if (_tempVec.x > xmax) xmax = _tempVec.x;\n                if (_tempVec.y < ymin) ymin = _tempVec.y; if (_tempVec.y > ymax) ymax = _tempVec.y;\n                if (_tempVec.z < zmin) zmin = _tempVec.z; if (_tempVec.z > zmax) zmax = _tempVec.z;\n            }\n\n            normalMapVertices.set(terrainVertices);\n            normalMapVerticesHigh.set(terrainVerticesHigh);\n            normalMapVerticesLow.set(terrainVerticesLow);\n\n            for (let k = 0; k < gsgs; k++) {\n\n                var j = k % gs,\n                    i = ~~(k / gs);\n\n                if (i !== tgs && j !== tgs) {\n                    var v0ind = k * 3,\n                        v1ind = v0ind + 3,\n                        v2ind = v0ind + gs * 3,\n                        v3ind = v2ind + 3;\n\n\n                    var v0 = new Vec3(terrainVertices[v0ind], terrainVertices[v0ind + 1], terrainVertices[v0ind + 2]),\n                        v1 = new Vec3(terrainVertices[v1ind], terrainVertices[v1ind + 1], terrainVertices[v1ind + 2]),\n                        v2 = new Vec3(terrainVertices[v2ind], terrainVertices[v2ind + 1], terrainVertices[v2ind + 2]),\n                        v3 = new Vec3(terrainVertices[v3ind], terrainVertices[v3ind + 1], terrainVertices[v3ind + 2]);\n\n                    var e10 = v1.sub(v0).normalize(),\n                        e20 = v2.sub(v0).normalize(),\n                        e30 = v3.sub(v0).normalize();\n\n                    var sw = e20.cross(e30).normalize();\n                    var ne = e30.cross(e10).normalize();\n                    var n0 = ne.add(sw).normalize();\n\n                    normalMapNormals[v0ind] += n0.x;\n                    normalMapNormals[v0ind + 1] += n0.y;\n                    normalMapNormals[v0ind + 2] += n0.z;\n\n                    normalMapNormals[v1ind] += ne.x;\n                    normalMapNormals[v1ind + 1] += ne.y;\n                    normalMapNormals[v1ind + 2] += ne.z;\n\n                    normalMapNormals[v2ind] += sw.x;\n                    normalMapNormals[v2ind + 1] += sw.y;\n                    normalMapNormals[v2ind + 2] += sw.z;\n\n                    normalMapNormals[v3ind] += n0.x;\n                    normalMapNormals[v3ind + 1] += n0.y;\n                    normalMapNormals[v3ind + 2] += n0.z;\n                }\n            }\n        }\n\n        self.postMessage({\n                id: id,\n                normalMapNormals: normalMapNormals,\n                normalMapVertices: normalMapVertices,\n                normalMapVerticesHigh: normalMapVerticesHigh,\n                normalMapVerticesLow: normalMapVerticesLow,\n                terrainVertices: terrainVertices,\n                terrainVerticesHigh: terrainVerticesHigh,\n                terrainVerticesLow: terrainVerticesLow,\n                noDataVertices: noDataVertices,\n                //bounds: [xmin, xmax, ymin, ymax, zmin, zmax]\n                bounds: [xmin, ymin, zmin, xmax, ymax, zmax]\n             }, [\n                    normalMapNormals.buffer, \n                    normalMapVertices.buffer, \n                    normalMapVerticesHigh.buffer, \n                    normalMapVerticesLow.buffer, \n                    terrainVertices.buffer,\n                    terrainVerticesHigh.buffer,\n                    terrainVerticesLow.buffer,\n                    noDataVertices.buffer\n            ]);\n    }`;\nexport { TerrainWorker };\n//# sourceMappingURL=TerrainWorker.js.map","import { doubleToTwoFloats2 } from '../math/coder';\nimport { Framebuffer } from '../webgl/Framebuffer';\nimport { Program } from '../webgl/Program';\nimport { RENDERING } from '../quadTree/quadTree';\nlet tempArr = new Float32Array(2);\nconst MAX_FRAME_TIME = 25.0;\nexport class VectorTileCreator {\n    constructor(planet, width = 512, height = 512) {\n        this._width = width;\n        this._height = height;\n        this._planet = planet;\n        this._framebuffer = null;\n        this._queue = [];\n        this._handler = null;\n    }\n    init() {\n        this._handler = this._planet.renderer.handler;\n        //Line\n        if (!this._handler.programs.vectorTileLineRasterization) {\n            this._handler.addProgram(new Program(\"vectorTileLineRasterization\", {\n                uniforms: {\n                    'viewport': \"vec2\",\n                    'thicknessOutline': \"float\",\n                    'alpha': \"float\",\n                    'extentParamsHigh': \"vec4\",\n                    'extentParamsLow': \"vec4\"\n                },\n                attributes: {\n                    'prevHigh': \"vec2\",\n                    'currentHigh': \"vec2\",\n                    'nextHigh': \"vec2\",\n                    'prevLow': \"vec2\",\n                    'currentLow': \"vec2\",\n                    'nextLow': \"vec2\",\n                    'order': \"float\",\n                    'color': \"vec4\",\n                    'thickness': \"float\"\n                },\n                vertexShader: `attribute vec2 prevHigh;\n                attribute vec2 currentHigh;\n                attribute vec2 nextHigh;\n\n                attribute vec2 prevLow;\n                attribute vec2 currentLow;\n                attribute vec2 nextLow;\n\n                attribute float order;\n                attribute float thickness;\n                attribute vec4 color;\n                uniform float thicknessOutline;\n                uniform vec2 viewport;\n                uniform vec4 extentParamsHigh;\n                uniform vec4 extentParamsLow;\n                varying vec4 vColor;\n                \n                vec2 proj(vec2 coordHigh, vec2 coordLow) {\n                    vec2 highDiff = coordHigh - extentParamsHigh.xy;\n                    vec2 lowDiff = coordLow - extentParamsLow.xy;\n                    return vec2(-1.0 + (highDiff + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);\n                }\n                \n                void main(){\n                    vColor = color;\n\n                    vec2 vNext = proj(nextHigh, nextLow),\n                         vCurrent = proj(currentHigh, currentLow),\n                         vPrev = proj(prevHigh, prevLow);\n\n                    vec2 _next = vNext;\n                    vec2 _prev = vPrev;\n                    vec2 _current = vCurrent;\n\n                    if(_prev == _current){\n                        if(_next == _current){\n                            _next = _current + vec2(1.0, 0.0);\n                            _prev = _current - _next;\n                        }else{\n                            _prev = _current + normalize(_current - _next);\n                        }\n                    }\n\n                    if(_next == _current){\n                        _next = _current + normalize(_current - _prev);\n                    }\n\n                    vec2 sNext = _next;\n                    vec2 sCurrent = _current;\n                    vec2 sPrev = _prev;\n                    \n                    vec2 dirNext = normalize(sNext - sCurrent);\n                    vec2 dirPrev = normalize(sPrev - sCurrent);\n                    float dotNP = dot(dirNext, dirPrev);\n                    \n                    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));\n                    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));\n                    vec2 d = (thickness + thicknessOutline) * 0.5 * sign(order) / viewport;\n                    \n                    vec2 m;\n                    if(dotNP >= 0.99991){\n                        m = sCurrent - normalPrev * d;\n                    }else{\n                        vec2 dir = normalPrev + normalNext;\n                        m = sCurrent + dir * d / (dirNext.x * dir.y - dirNext.y * dir.x);\n                        \n                        if( dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0 ){\n                            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);\n                            if(occw == -1.0){\n                                m = sCurrent + normalPrev * d;\n                            }else if(occw == 1.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == -2.0){\n                                m = sCurrent + normalNext * d;\n                            }else if(occw == 2.0){\n                                m = sCurrent + normalPrev * d;\n                            }\n                        }else if(distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))){\n                            m = sCurrent + normalNext * d;\n                        }\n                    }\n                    gl_Position = vec4(m.x, m.y, 0.0, 1.0);\n                }`,\n                fragmentShader: `precision highp float;\n                uniform float alpha;\n                varying vec4 vColor;\n                void main() {\n                    gl_FragColor = vec4(vColor.rgb, alpha * vColor.a);\n                }`\n            }));\n        }\n        //Polygon\n        if (!this._handler.programs.vectorTilePolygonRasterization) {\n            this._handler.addProgram(new Program(\"vectorTilePolygonRasterization\", {\n                uniforms: {\n                    'extentParamsHigh': \"vec4\",\n                    'extentParamsLow': \"vec4\"\n                },\n                attributes: {\n                    'coordinatesHigh': \"vec2\",\n                    'coordinatesLow': \"vec2\",\n                    'colors': \"vec4\"\n                },\n                vertexShader: `attribute vec2 coordinatesHigh;\n                attribute vec2 coordinatesLow; \n                attribute vec4 colors; \n                uniform vec4 extentParamsHigh; \n                uniform vec4 extentParamsLow; \n                varying vec4 color;\n\n                vec2 proj(vec2 coordHigh, vec2 coordLow) {\n                    vec2 highDiff = coordHigh - extentParamsHigh.xy;\n                    vec2 lowDiff = coordLow - extentParamsLow.xy;\n                    return vec2(-1.0 + (highDiff + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);\n                }\n\n                void main() { \n                    color = colors;\n                    gl_Position = vec4(proj(coordinatesHigh, coordinatesLow), 0.0, 1.0); \n                }`,\n                fragmentShader: `precision highp float;\n                varying vec4 color;\n                void main () {  \n                    gl_FragColor = color; \n                }`\n            }));\n        }\n        this._framebuffer = new Framebuffer(this._handler, {\n            width: this._width,\n            height: this._height,\n            useDepth: false\n        });\n        this._framebuffer.init();\n    }\n    frame() {\n        if (this._planet.layerLock.isFree() && this._queue.length) {\n            let h = this._handler, gl = h.gl;\n            gl.disable(gl.CULL_FACE);\n            gl.disable(gl.DEPTH_TEST);\n            let hLine = h.programs.vectorTileLineRasterization, hPoly = h.programs.vectorTilePolygonRasterization;\n            let _w = this._width, _h = this._height, width = _w, height = _h, _w2 = width << 1, _h2 = height << 1;\n            // var prevLayerId = -1;\n            let extentParamsHigh = new Float32Array(4);\n            let extentParamsLow = new Float32Array(4);\n            let f = this._framebuffer.activate();\n            let deltaTime = 0, startTime = window.performance.now();\n            while (this._queue.length && deltaTime < MAX_FRAME_TIME) {\n                let material = this._queue.shift();\n                if (material.isLoading && material.segment.node.getState() === RENDERING) {\n                    let pickingEnabled = material.layer._pickingEnabled;\n                    if (material.segment.tileZoom < 4) {\n                        width = _w2;\n                        height = _h2;\n                    }\n                    else {\n                        width = _w;\n                        height = _h;\n                    }\n                    let texture = material._updateTexture || h.createEmptyTexture_l(width, height);\n                    let pickingMask = pickingEnabled ? material._updatePickingMask || h.createEmptyTexture_n(width, height) : null;\n                    material.applyTexture(texture, pickingMask);\n                    f.setSize(width, height);\n                    f.bindOutputTexture(texture);\n                    gl.clearColor(0.0, 0.0, 0.0, 0.0);\n                    gl.clear(gl.COLOR_BUFFER_BIT);\n                    let extent = material.segment.getExtentMerc();\n                    doubleToTwoFloats2(extent.southWest.lon, tempArr);\n                    extentParamsHigh[0] = tempArr[0];\n                    extentParamsLow[0] = tempArr[1];\n                    doubleToTwoFloats2(extent.southWest.lat, tempArr);\n                    extentParamsHigh[1] = tempArr[0];\n                    extentParamsLow[1] = tempArr[1];\n                    extentParamsHigh[2] = 2.0 / extent.getWidth();\n                    extentParamsHigh[3] = 2.0 / extent.getHeight();\n                    hPoly.activate();\n                    let sh = hPoly._program;\n                    let sha = sh.attributes, shu = sh.uniforms;\n                    let geomHandler = material.layer._geometryHandler;\n                    //=========================================\n                    //Polygon rendering\n                    //=========================================\n                    gl.uniform4fv(shu.extentParamsHigh, extentParamsHigh);\n                    gl.uniform4fv(shu.extentParamsLow, extentParamsLow);\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyVerticesHighBufferMerc);\n                    gl.vertexAttribPointer(sha.coordinatesHigh, geomHandler._polyVerticesHighBufferMerc.itemSize, gl.FLOAT, false, 0, 0);\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyVerticesLowBufferMerc);\n                    gl.vertexAttribPointer(sha.coordinatesLow, geomHandler._polyVerticesLowBufferMerc.itemSize, gl.FLOAT, false, 0, 0);\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyColorsBuffer);\n                    gl.vertexAttribPointer(sha.colors, geomHandler._polyColorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, geomHandler._polyIndexesBuffer);\n                    gl.drawElements(gl.TRIANGLES, geomHandler._polyIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    //Polygon picking PASS\n                    if (pickingEnabled) {\n                        f.bindOutputTexture(pickingMask);\n                        gl.clearColor(0.0, 0.0, 0.0, 0.0);\n                        gl.clear(gl.COLOR_BUFFER_BIT);\n                        gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._polyPickingColorsBuffer);\n                        gl.vertexAttribPointer(sha.colors, geomHandler._polyPickingColorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                        gl.drawElements(gl.TRIANGLES, geomHandler._polyIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    }\n                    //=========================================\n                    //Strokes and linestrings rendering\n                    //=========================================\n                    f.bindOutputTexture(texture);\n                    hLine.activate();\n                    sh = hLine._program;\n                    sha = sh.attributes;\n                    shu = sh.uniforms;\n                    gl.uniform2fv(shu.viewport, [width, height]);\n                    gl.uniform4fv(shu.extentParamsHigh, extentParamsHigh);\n                    gl.uniform4fv(shu.extentParamsLow, extentParamsLow);\n                    //vertex\n                    let mb = geomHandler._lineVerticesHighBufferMerc;\n                    gl.bindBuffer(gl.ARRAY_BUFFER, mb);\n                    gl.vertexAttribPointer(sha.prevHigh, mb.itemSize, gl.FLOAT, false, 8, 0);\n                    gl.vertexAttribPointer(sha.currentHigh, mb.itemSize, gl.FLOAT, false, 8, 32);\n                    gl.vertexAttribPointer(sha.nextHigh, mb.itemSize, gl.FLOAT, false, 8, 64);\n                    mb = geomHandler._lineVerticesLowBufferMerc;\n                    gl.bindBuffer(gl.ARRAY_BUFFER, mb);\n                    gl.vertexAttribPointer(sha.prevLow, mb.itemSize, gl.FLOAT, false, 8, 0);\n                    gl.vertexAttribPointer(sha.currentLow, mb.itemSize, gl.FLOAT, false, 8, 32);\n                    gl.vertexAttribPointer(sha.nextLow, mb.itemSize, gl.FLOAT, false, 8, 64);\n                    //order\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineOrdersBuffer);\n                    gl.vertexAttribPointer(sha.order, geomHandler._lineOrdersBuffer.itemSize, gl.FLOAT, false, 4, 0);\n                    gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, geomHandler._lineIndexesBuffer);\n                    //PASS - stroke\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineStrokesBuffer);\n                    gl.vertexAttribPointer(sha.thickness, geomHandler._lineStrokesBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineStrokeColorsBuffer);\n                    gl.vertexAttribPointer(sha.color, geomHandler._lineStrokeColorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                    //Antialias pass\n                    gl.uniform1f(shu.thicknessOutline, 2);\n                    gl.uniform1f(shu.alpha, 0.54);\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    //\n                    //Aliased pass\n                    gl.uniform1f(shu.thicknessOutline, 1);\n                    gl.uniform1f(shu.alpha, 1.0);\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    //PASS - inside line\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineThicknessBuffer);\n                    gl.vertexAttribPointer(sha.thickness, geomHandler._lineThicknessBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                    gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._lineColorsBuffer);\n                    gl.vertexAttribPointer(sha.color, geomHandler._lineColorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                    //Antialias pass\n                    gl.uniform1f(shu.thicknessOutline, 2);\n                    gl.uniform1f(shu.alpha, 0.54);\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    //\n                    //Aliased pass\n                    gl.uniform1f(shu.thicknessOutline, 1);\n                    gl.uniform1f(shu.alpha, 1.0);\n                    gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    if (pickingEnabled) {\n                        f.bindOutputTexture(pickingMask);\n                        gl.uniform1f(shu.thicknessOutline, 8);\n                        gl.bindBuffer(gl.ARRAY_BUFFER, geomHandler._linePickingColorsBuffer);\n                        gl.vertexAttribPointer(sha.color, geomHandler._linePickingColorsBuffer.itemSize, gl.FLOAT, false, 0, 0);\n                        gl.drawElements(gl.TRIANGLE_STRIP, geomHandler._lineIndexesBuffer.numItems, gl.UNSIGNED_INT, 0);\n                    }\n                }\n                else {\n                    material.isLoading = false;\n                }\n                deltaTime = window.performance.now() - startTime;\n            }\n            gl.enable(gl.DEPTH_TEST);\n            gl.enable(gl.CULL_FACE);\n            f.deactivate();\n        }\n    }\n    add(material) {\n        this._queue.push(material);\n    }\n    remove(material) {\n        //...\n    }\n    get queueSize() {\n        return this._queue.length;\n    }\n}\n//# sourceMappingURL=VectorTileCreator.js.map","import { LonLat } from \"../LonLat\";\nimport { Quat } from \"../math/Quat\";\nimport { Vec3 } from \"../math/Vec3\";\nimport { DEGREES, EPS1, EPS12, EPS15, RADIANS, zeroTwoPI } from \"../math\";\n/**\n * Class represents a plant ellipsoid.\n * @class\n * @param {number} equatorialSize - Equatorial ellipsoid size.\n * @param {number} polarSize - Polar ellipsoid size.\n */\nclass Ellipsoid {\n    constructor(equatorialSize = 1, polarSize = 1) {\n        this._a = equatorialSize;\n        this._b = polarSize;\n        this._flattening = (equatorialSize - polarSize) / equatorialSize;\n        this._f = 1 / this._flattening;\n        this._a2 = equatorialSize * equatorialSize;\n        this._b2 = polarSize * polarSize;\n        const qa2b2 = Math.sqrt(this._a2 - this._b2);\n        this._e = qa2b2 / equatorialSize;\n        this._e2 = this._e * this._e;\n        this._e22 = this._e2 * this._e2;\n        this._k = qa2b2 / polarSize;\n        this._k2 = this._k * this._k;\n        this._radii = new Vec3(equatorialSize, equatorialSize, polarSize);\n        this._radii2 = new Vec3(this._a2, this._a2, this._b2);\n        this._invRadii = new Vec3(1.0 / equatorialSize, 1.0 / equatorialSize, 1.0 / polarSize);\n        this._invRadii2 = new Vec3(1.0 / this._a2, 1.0 / this._a2, 1.0 / this._b2);\n    }\n    /**\n     * Returns the distance travelling from ‚Äòthis‚Äô point to destination point along a rhumb line.\n     * @param   {LonLat} startLonLat coordinates.\n     * @param   {LonLat} endLonLat coordinates\n     * @returns {number} Distance in m between this point and destination point (same units as radius).\n     */\n    rhumbDistanceTo(startLonLat, endLonLat) {\n        const f1 = startLonLat.lat * RADIANS;\n        const f2 = endLonLat.lat * RADIANS;\n        const df = f2 - f1;\n        let d = Math.abs(endLonLat.lon - startLonLat.lon) * RADIANS;\n        if (Math.abs(d) > Math.PI)\n            d = d > 0 ? -(2 * Math.PI - d) : (2 * Math.PI + d);\n        const dd = Math.log(Math.tan(f2 / 2 + Math.PI / 4) / Math.tan(f1 / 2 + Math.PI / 4));\n        const q = Math.abs(dd) > 10e-12 ? df / dd : Math.cos(f1);\n        const t = Math.sqrt(df * df + q * q * d * d); // angular distance in radians\n        return t * this._a;\n    }\n    /**\n     * Returns the point at given fraction between two points on the great circle.\n     * @param   {LonLat} lonLat1 - Longitude/Latitude of source point.\n     * @param   {LonLat} lonLat2 - Longitude/Latitude of destination point.\n     * @param   {number} fraction - Fraction between the two points (0 = source point, 1 = destination point).\n     * @returns {LonLat} Intermediate point between points.\n     */\n    getIntermediatePointOnGreatCircle(lonLat1, lonLat2, fraction) {\n        if (fraction == 0)\n            return lonLat1.clone();\n        if (fraction == 1)\n            return lonLat2.clone();\n        const inverse = this.inverse(lonLat1, lonLat2);\n        const dist = inverse.distance;\n        const azimuth = inverse.initialAzimuth;\n        return isNaN(azimuth) ? lonLat1 : this.getGreatCircleDestination(lonLat1, azimuth, dist * fraction);\n    }\n    /**\n     * REMOVE ASAP after\n     * @param lonLat1\n     * @param lonLat2\n     * @returns {number}\n     */\n    static getBearing(lonLat1, lonLat2) {\n        let f1 = lonLat1.lat * RADIANS, l1 = lonLat1.lon * RADIANS;\n        let f2 = lonLat2.lat * RADIANS, l2 = lonLat2.lon * RADIANS;\n        let y = Math.sin(l2 - l1) * Math.cos(f2);\n        let x = Math.cos(f1) * Math.sin(f2) - Math.sin(f1) * Math.cos(f2) * Math.cos(l2 - l1);\n        return Math.atan2(y, x) * DEGREES;\n    }\n    getFlattening() {\n        return this._flattening;\n    }\n    /**\n     * Gets ellipsoid equatorial size.\n     * @public\n     * @returns {number} -\n     */\n    getEquatorialSize() {\n        return this._a;\n    }\n    get equatorialSize() {\n        return this._a;\n    }\n    get equatorialSizeSqr() {\n        return this._a2;\n    }\n    /**\n     * Gets ellipsoid polar size.\n     * @public\n     * @returns {number} -\n     */\n    getPolarSize() {\n        return this._b;\n    }\n    get polarSize() {\n        return this._b;\n    }\n    get polarSizeSqr() {\n        return this._b2;\n    }\n    /**\n     * Calculate cartesian coordinates by its ECEF geodetic coordinates.\n     * @public\n     * @param {LonLat} lonlat - Geodetic coordinates.\n     * @returns {Vec3} -\n     */\n    lonLatToCartesian(lonlat) {\n        return this.geodeticToCartesian(lonlat.lon, lonlat.lat, lonlat.height);\n    }\n    /**\n     * Calculate cartesian coordinates by its ECEF geodetic coordinates.\n     * @public\n     * @param {LonLat} lonlat - Geodetic coordinates.\n     * @param {Vec3} res - Output variable reference.\n     * @returns {Vec3} -\n     */\n    lonLatToCartesianRes(lonlat, res) {\n        return this.geodeticToCartesian(lonlat.lon, lonlat.lat, lonlat.height, res);\n    }\n    /**\n     * Gets cartesian ECEF from Wgs84 geodetic coordinates.\n     * @public\n     * @param {Number} lon - Longitude.\n     * @param {Number} lat - Latitude.\n     * @param {Number} height - Height.\n     * @param {Vec3} res - Output result variable.\n     * @returns {Vec3} -\n     */\n    geodeticToCartesian(lon, lat, height = 0, res = new Vec3()) {\n        let latrad = RADIANS * lat, lonrad = RADIANS * lon;\n        let slt = Math.sin(latrad);\n        let N = this._a / Math.sqrt(1 - this._e2 * slt * slt);\n        let nc = (N + height) * Math.cos(latrad);\n        res.x = nc * Math.cos(lonrad);\n        res.y = nc * Math.sin(lonrad);\n        res.z = (N * (1 - this._e2) + height) * slt;\n        return res;\n    }\n    /**\n     * Gets Wgs84 geodetic coordinates from cartesian ECEF.\n     * @public\n     * @param {Vec3} p - Cartesian coordinates.\n     * @returns {LonLat} -\n     */\n    projToSurface(p) {\n        let pX = p.x || 0.0, pY = p.y || 0.0, pZ = p.z || 0.0;\n        let length = Math.sqrt(pX * pX + pY * pY + pZ * pZ);\n        if (length === 0) {\n            return this.lonLatToCartesian(new LonLat());\n        }\n        let invRadii2X = this._invRadii2.x, invRadii2Y = this._invRadii2.y, invRadii2Z = this._invRadii2.z;\n        let x2 = pX * pX * invRadii2X, y2 = pY * pY * invRadii2Y, z2 = pZ * pZ * invRadii2Z;\n        let norm = x2 + y2 + z2;\n        let ratio = Math.sqrt(1.0 / norm);\n        let first = p.scaleTo(ratio);\n        if (norm < EPS1) {\n            return !Number.isFinite(ratio) ? new Vec3() : first;\n        }\n        let lambda = ((1.0 - ratio) * length) / first.mulA(this._invRadii2).length();\n        let m_X = 0.0, m_Y = 0.0, m_Z = 0.0;\n        do {\n            m_X = 1.0 / (1.0 + lambda * invRadii2X);\n            m_Y = 1.0 / (1.0 + lambda * invRadii2Y);\n            m_Z = 1.0 / (1.0 + lambda * invRadii2Z);\n            let m_X2 = m_X * m_X, m_Y2 = m_Y * m_Y, m_Z2 = m_Z * m_Z;\n            let func = x2 * m_X2 + y2 * m_Y2 + z2 * m_Z2 - 1.0;\n            if (Math.abs(func) < EPS12) {\n                break;\n            }\n            let m_X3 = m_X2 * m_X, m_Y3 = m_Y2 * m_Y, m_Z3 = m_Z2 * m_Z;\n            lambda += 0.5 * func / (x2 * m_X3 * invRadii2X + y2 * m_Y3 * invRadii2Y + z2 * m_Z3 * invRadii2Z);\n        } while (true); // eslint-disable-line\n        return new Vec3(pX * m_X, pY * m_Y, pZ * m_Z);\n    }\n    /**\n     * Converts 3d cartesian coordinates to geodetic\n     * @param {Vec3} cart - Cartesian coordinates\n     * @returns {LonLat} - Geodetic coordinates\n     */\n    cartesianToLonLat(cart) {\n        return this.cartesianToLonLatRes(cart);\n    }\n    /**\n     * Converts 3d cartesian coordinates to geodetic\n     * @param {Vec3} cart - Cartesian coordinates\n     * @param {LonLat} res - Link geodetic coordinates variable\n     * @returns {LonLat} - Geodetic coordinates\n     */\n    cartesianToLonLatRes(cart, res = new LonLat()) {\n        let p = this.projToSurface(cart);\n        let n = this.getSurfaceNormal3v(p), h = cart.sub(p);\n        res.lon = Math.atan2(n.y, n.x) * DEGREES;\n        res.lat = Math.asin(n.z) * DEGREES;\n        res.height = Math.sign(h.dot(cart)) * h.length();\n        return res;\n    }\n    /**\n     * Gets ellipsoid surface normal.\n     * @public\n     * @param {Vec3} coord - Spatial coordinates.\n     * @return {Vec3} -\n     */\n    getSurfaceNormal3v(coord) {\n        let r2 = this._invRadii2;\n        let nx = coord.x * r2.x, ny = coord.y * r2.y, nz = coord.z * r2.z;\n        let l = 1.0 / Math.sqrt(nx * nx + ny * ny + nz * nz);\n        return new Vec3(nx * l, ny * l, nz * l);\n    }\n    getGreatCircleDistance(lonLat1, lonLat2) {\n        return this.inverse(lonLat1, lonLat2).distance;\n    }\n    /**\n     * Calculates the destination point given start point lat / lon, azimuth(deg) and distance (m).\n     * Source: http://movable-type.co.uk/scripts/latlong-vincenty-direct.html and optimized / cleaned up by Mathias Bynens <http://mathiasbynens.be/>\n     * Based on the Vincenty direct formula by T. Vincenty, ‚ÄúDirect and Inverse Solutions of Geodesics on the Ellipsoid with application of nested equations‚Äù, Survey Review, vol XXII no 176, 1975 <http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf>\n     * @param {LonLat} lonLat - Origin coordinates\n     * @param {number} azimuth - View azimuth in degrees\n     * @param {number} dist - Distance to the destination point coordinates in meters\n     * @returns {LonLat} - Destination point coordinates\n     */\n    getGreatCircleDestination(lonLat, azimuth, dist) {\n        return this.direct(lonLat, azimuth, dist).destination;\n    }\n    inverse(lonLat1, lonLat2) {\n        let a = this._a, b = this._b, f = this._flattening;\n        const fi1 = lonLat1.lat * RADIANS, lambda1 = lonLat1.lon * RADIANS;\n        const fi2 = lonLat2.lat * RADIANS, lambda2 = lonLat2.lon * RADIANS;\n        const L = lambda2 - lambda1; // L = difference in longitude, U = reduced latitude, defined by tan U = (1-f)¬∑tanœÜ.\n        const tanU1 = (1 - f) * Math.tan(fi1), cosU1 = 1 / Math.sqrt((1 + tanU1 * tanU1)), sinU1 = tanU1 * cosU1;\n        const tanU2 = (1 - f) * Math.tan(fi2), cosU2 = 1 / Math.sqrt((1 + tanU2 * tanU2)), sinU2 = tanU2 * cosU2;\n        const antipodal = Math.abs(L) > Math.PI / 2 || Math.abs(fi2 - fi1) > Math.PI / 2;\n        let lmb = L, sinLmb = null, cosLmb = null; // lmb - difference in longitude on an auxiliary sphere\n        let s = antipodal ? Math.PI : 0, sin_s = 0, cos_s = antipodal ? -1 : 1, sinSqs = null; // s - angular distance lonLat1 lonLat2 on the sphere\n        let cos2sm = 1; // sm - angular distance on the sphere from the equator to the midpoint of the line\n        let cosSqa = 1; // a - azimuth of the geodesic at the equator\n        let lmb_ = null, iterations = 0;\n        do {\n            sinLmb = Math.sin(lmb);\n            cosLmb = Math.cos(lmb);\n            sinSqs = (cosU2 * sinLmb) ** 2 + (cosU1 * sinU2 - sinU1 * cosU2 * cosLmb) ** 2;\n            if (Math.abs(sinSqs) < 1e-24)\n                break; // co-incident/antipodal points (œÉ < ‚âà0.006mm)\n            sin_s = Math.sqrt(sinSqs);\n            cos_s = sinU1 * sinU2 + cosU1 * cosU2 * cosLmb;\n            s = Math.atan2(sin_s, cos_s);\n            const sin_a = cosU1 * cosU2 * sinLmb / sin_s;\n            cosSqa = 1 - sin_a * sin_a;\n            cos2sm = (cosSqa != 0) ? (cos_s - 2 * sinU1 * sinU2 / cosSqa) : 0; // on equatorial line cos¬≤Œ± = 0 (¬ß6)\n            const C = f / 16 * cosSqa * (4 + f * (4 - 3 * cosSqa));\n            lmb_ = lmb;\n            lmb = L + (1 - C) * f * sin_a * (s + C * sin_s * (cos2sm + C * cos_s * (-1 + 2 * cos2sm * cos2sm)));\n        } while (Math.abs(lmb - lmb_) > EPS12 && ++iterations < 1000);\n        const uSq = cosSqa * (a * a - b * b) / (b * b);\n        const A = 1 + uSq / 16384 * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq)));\n        const B = uSq / 1024 * (256 + uSq * (-128 + uSq * (74 - 47 * uSq)));\n        const ds = B * sin_s * (cos2sm + B / 4 * (cos_s * (-1 + 2 * cos2sm * cos2sm) - B / 6 * cos2sm * (-3 + 4 * sin_s * sin_s) * (-3 + 4 * cos2sm * cos2sm)));\n        const dist = b * A * (s - ds); // s = length of the geodesic\n        // note special handling of exactly antipodal points where sin¬≤œÉ = 0 (due to discontinuity\n        // atan2(0, 0) = 0 but atan2(Œµ, 0) = œÄ/2 / 90¬∞) - in which case bearing is always meridional,\n        // due north (or due south!)\n        // Œ± = azimuths of the geodesic; Œ±2 the direction P‚ÇÅ P‚ÇÇ produced\n        const a1 = Math.abs(sinSqs) < Number.EPSILON ? 0 : Math.atan2(cosU2 * sinLmb, cosU1 * sinU2 - sinU1 * cosU2 * cosLmb);\n        const a2 = Math.abs(sinSqs) < Number.EPSILON ? Math.PI : Math.atan2(cosU1 * sinLmb, -sinU1 * cosU2 + cosU1 * sinU2 * cosLmb);\n        return {\n            distance: dist,\n            initialAzimuth: Math.abs(dist) < Number.EPSILON ? NaN : zeroTwoPI(a1) * DEGREES,\n            finalAzimuth: Math.abs(dist) < Number.EPSILON ? NaN : zeroTwoPI(a2) * DEGREES\n        };\n    }\n    /**\n     * Calculates the destination point given start point lat / lon, azimuth(deg) and distance (m).\n     * Source: http://movable-type.co.uk/scripts/latlong-vincenty-direct.html and optimized / cleaned up by Mathias Bynens <http://mathiasbynens.be/>\n     * Based on the Vincenty direct formula by T. Vincenty, ‚ÄúDirect and Inverse Solutions of Geodesics on the Ellipsoid with application of nested equations‚Äù, Survey Review, vol XXII no 176, 1975 <http://www.ngs.noaa.gov/PUBS_LIB/inverse.pdf>\n     * @param {LonLat} lonLat - Origin coordinates\n     * @param {number} azimuth - View azimuth in degrees\n     * @param {number} dist - Distance to the destination point coordinates in meters\n     * @returns {LonLat} - Destination point coordinates\n     */\n    direct(lonLat, azimuth, dist) {\n        let lon1 = lonLat.lon, lat1 = lonLat.lat;\n        let a = this._a, b = this._b, f = this._flattening, s = dist, alpha1 = azimuth * RADIANS, sinAlpha1 = Math.sin(alpha1), cosAlpha1 = Math.cos(alpha1), tanU1 = (1 - f) * Math.tan(lat1 * RADIANS), cosU1 = 1 / Math.sqrt(1 + tanU1 * tanU1), sinU1 = tanU1 * cosU1, sigma1 = Math.atan2(tanU1, cosAlpha1), sinAlpha = cosU1 * sinAlpha1, cosSqAlpha = 1 - sinAlpha * sinAlpha, uSq = (cosSqAlpha * (a * a - b * b)) / (b * b), A = 1 + (uSq / 16384) * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq))), B = (uSq / 1024) * (256 + uSq * (-128 + uSq * (74 - 47 * uSq))), sigma = s / (b * A), sigmaP = 2 * Math.PI;\n        let cos2SigmaM = 0, sinSigma = 0, cosSigma = 0, deltaSigma = 0;\n        while (Math.abs(sigma - sigmaP) > 1e-12) {\n            cos2SigmaM = Math.cos(2 * sigma1 + sigma);\n            sinSigma = Math.sin(sigma);\n            cosSigma = Math.cos(sigma);\n            deltaSigma = B * sinSigma *\n                (cos2SigmaM + (B / 4) *\n                    (cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) -\n                        (B / 6) * cos2SigmaM * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM * cos2SigmaM)));\n            sigmaP = sigma;\n            sigma = s / (b * A) + deltaSigma;\n        }\n        let tmp = sinU1 * sinSigma - cosU1 * cosSigma * cosAlpha1, lat2 = Math.atan2(sinU1 * cosSigma + cosU1 * sinSigma * cosAlpha1, (1 - f) * Math.sqrt(sinAlpha * sinAlpha + tmp * tmp)), lambda = Math.atan2(sinSigma * sinAlpha1, cosU1 * cosSigma - sinU1 * sinSigma * cosAlpha1), C = (f / 16.0) * cosSqAlpha * (4.0 + f * (4.0 - 3.0 * cosSqAlpha)), L = lambda - (1.0 - C) * f * sinAlpha * (sigma + C * sinSigma * (cos2SigmaM + C * cosSigma * (-1.0 + 2.0 * cos2SigmaM * cos2SigmaM))), revAz = Math.atan2(sinAlpha, -tmp);\n        return {\n            destination: new LonLat(lon1 + L * DEGREES, lat2 * DEGREES),\n            finalAzimuth: revAz * DEGREES\n        };\n    }\n    /**\n     * Returns cartesian coordinates of the intersection of a ray and an ellipsoid.\n     * If the ray doesn't hit ellipsoid returns null.\n     * @public\n     * @param {Vec3} origin - Ray origin point.\n     * @param {Vec3} direction - Ray direction.\n     * @returns {Vec3} -\n     */\n    hitRay(origin, direction) {\n        let q = this._invRadii.mul(origin);\n        let w = this._invRadii.mul(direction);\n        let q2 = q.dot(q);\n        let qw = q.dot(w);\n        let difference, w2, product, discriminant, temp;\n        if (q2 > 1.0) {\n            // Outside ellipsoid.\n            if (qw >= 0.0) {\n                // Looking outward or tangent (0 intersections).\n                return undefined;\n            }\n            // qw < 0.0.\n            var qw2 = qw * qw;\n            difference = q2 - 1.0; // Positively valued.\n            w2 = w.dot(w);\n            product = w2 * difference;\n            let eps = Math.abs(qw2 - product);\n            if (eps > EPS15 && qw2 < product) {\n                // Imaginary roots (0 intersections).\n                return undefined;\n            }\n            else if (qw2 > product) {\n                // Distinct roots (2 intersections).\n                discriminant = qw * qw - product;\n                temp = -qw + Math.sqrt(discriminant); // Avoid cancellation.\n                var root0 = temp / w2;\n                var root1 = difference / temp;\n                if (root0 < root1) {\n                    return origin.add(direction.scaleTo(root0));\n                }\n                return origin.add(direction.scaleTo(root1));\n            }\n            else {\n                // qw2 == product.  Repeated roots (2 intersections).\n                var root = Math.sqrt(difference / w2);\n                return origin.add(direction.scaleTo(root));\n            }\n        }\n        else if (q2 < 1.0) {\n            // Inside ellipsoid (2 intersections).\n            difference = q2 - 1.0; // Negatively valued.\n            w2 = w.dot(w);\n            product = w2 * difference; // Negatively valued.\n            discriminant = qw * qw - product;\n            temp = -qw + Math.sqrt(discriminant); // Positively valued.\n            return origin.add(direction.scaleTo(temp / w2));\n        }\n        else {\n            // q2 == 1.0. On ellipsoid.\n            if (qw < 0.0) {\n                // Looking inward.\n                w2 = w.dot(w);\n                return origin.add(direction.scaleTo(-qw / w2));\n            }\n            // qw >= 0.0.  Looking outward or tangent.\n            // return undefined\n        }\n    }\n    getNorthFrameRotation(cartesian) {\n        let n = this.getSurfaceNormal3v(cartesian);\n        let t = Vec3.proj_b_to_plane(Vec3.NORTH, n);\n        return Quat.getLookRotation(t, n);\n    }\n    /**\n     * @todo this is not precise function, needs to be replaced or removed\n     * @param lonLat1\n     * @param bearing\n     * @param distance\n     * @returns {LonLat}\n     */\n    getBearingDestination(lonLat1, bearing = 0.0, distance = 0) {\n        bearing = bearing * RADIANS;\n        var nlon = ((lonLat1.lon + 540) % 360) - 180;\n        var f1 = lonLat1.lat * RADIANS, l1 = nlon * RADIANS;\n        var dR = distance / this._a;\n        var f2 = Math.asin(Math.sin(f1) * Math.cos(dR) + Math.cos(f1) * Math.sin(dR) * Math.cos(bearing));\n        return new LonLat((l1 +\n            Math.atan2(Math.sin(bearing) * Math.sin(dR) * Math.cos(f1), Math.cos(dR) - Math.sin(f1) * Math.sin(f2))) *\n            DEGREES, f2 * DEGREES);\n    }\n    /**\n     * Returns the point at given fraction between two points on the great circle.\n     * @param   {LonLat} lonLat1 - Longitude/Latitude of source point.\n     * @param   {LonLat} lonLat2 - Longitude/Latitude of destination point.\n     * @param   {number} fraction - Fraction between the two points (0 = source point, 1 = destination point).\n     * @returns {LonLat} Intermediate point between points.\n     */\n    static getIntermediatePointOnGreatCircle(lonLat1, lonLat2, fraction) {\n        var f1 = lonLat1.lat * RADIANS, l1 = lonLat1.lon * RADIANS;\n        var f2 = lonLat2.lat * RADIANS, l2 = lonLat2.lon * RADIANS;\n        var sinf1 = Math.sin(f1), cosf1 = Math.cos(f1), sinl1 = Math.sin(l1), cosl1 = Math.cos(l1);\n        var sinf2 = Math.sin(f2), cosf2 = Math.cos(f2), sinl2 = Math.sin(l2), cosl2 = Math.cos(l2);\n        var df = f2 - f1, dl = l2 - l1;\n        var a = Math.sin(df / 2) * Math.sin(df / 2) +\n            Math.cos(f1) * Math.cos(f2) * Math.sin(dl / 2) * Math.sin(dl / 2);\n        var d = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n        var A = Math.sin((1 - fraction) * d) / Math.sin(d);\n        var B = Math.sin(fraction * d) / Math.sin(d);\n        var x = A * cosf1 * cosl1 + B * cosf2 * cosl2;\n        var y = A * cosf1 * sinl1 + B * cosf2 * sinl2;\n        var z = A * sinf1 + B * sinf2;\n        var f3 = Math.atan2(z, Math.sqrt(x * x + y * y));\n        var l3 = Math.atan2(y, x);\n        return new LonLat(((l3 * DEGREES + 540) % 360) - 180, f3 * DEGREES);\n    }\n    static getRhumbBearing(lonLat1, lonLat2) {\n        var dLon = (lonLat2.lon - lonLat1.lon) * RADIANS;\n        var dPhi = Math.log(Math.tan((lonLat2.lat * RADIANS) / 2 + Math.PI / 4) /\n            Math.tan((lonLat1.lat * RADIANS) / 2 + Math.PI / 4));\n        if (Math.abs(dLon) > Math.PI) {\n            if (dLon > 0) {\n                dLon = (2 * Math.PI - dLon) * -1;\n            }\n            else {\n                dLon = 2 * Math.PI + dLon;\n            }\n        }\n        return (Math.atan2(dLon, dPhi) * DEGREES + 360) % 360;\n    }\n}\nexport { Ellipsoid };\n//# sourceMappingURL=Ellipsoid.js.map","import { Ellipsoid } from \"./Ellipsoid\";\n/**\n * WGS84 ellipsoid object.\n * @type {Ellipsoid}\n */\nexport const wgs84 = new Ellipsoid(6378137.0, 6356752.3142451793); // Equitorial Radius (m), Polar Radius (m)\n//# sourceMappingURL=wgs84.js.map","import * as math from \"../math\";\nimport * as segmentHelper from \"../segment/segmentHelper\";\nimport * as shaders from \"../shaders/drawnode\";\nimport * as utils from \"../utils/shared\";\nimport { Atmosphere } from \"../control/Atmosphere\";\nimport { createColorRGB } from \"../utils/shared\";\nimport { createEvents } from \"../Events\";\nimport { decodeFloatFromRGBAArr } from \"../math/coder\";\nimport { EarthQuadTreeStrategy } from \"../quadTree/EarthQuadTreeStrategy\";\nimport { Extent } from \"../Extent\";\nimport { Geoid } from \"../terrain/Geoid\";\nimport { GeoImageCreator } from \"../utils/GeoImageCreator\";\nimport { Key, Lock } from \"../Lock\";\nimport { Loader } from \"../utils/Loader\";\nimport { LonLat } from \"../LonLat\";\nimport { NormalMapCreator } from \"../utils/NormalMapCreator\";\nimport { PlainSegmentWorker } from \"../utils/PlainSegmentWorker\";\nimport { PlanetCamera } from \"../camera/PlanetCamera\";\nimport { RenderNode } from \"./RenderNode\";\nimport { SimpleSkyBackground } from \"../control/SimpleSkyBackground\";\nimport { TerrainWorker } from \"../utils/TerrainWorker\";\nimport { Vec3, Vec4 } from \"../math/index\";\nimport { Vector } from \"../layer/Vector\";\nimport { VectorTileCreator } from \"../utils/VectorTileCreator\";\nimport { wgs84 } from \"../ellipsoid/wgs84\";\nconst CUR_LOD_SIZE = 250; //px\nconst MIN_LOD_SIZE = 312; //px\nconst MAX_LOD_SIZE = 190; //px\nlet _tempPickingPix_ = new Uint8Array(4);\nlet _tempDepthColor_ = new Uint8Array(4);\nconst DEPTH_DISTANCE = 11; //m\n/**\n * Maximum created nodes count. The more nodes count the more memory usage.\n * @const\n * @type {number}\n * @default\n */\nconst MAX_NODES = 200;\nconst HORIZON_TANGENT = 0.81;\n/**\n * Main class for rendering planet\n * @class\n * @extends {RenderNode}\n * @param {string} [options.name=\"Earth\"] - Planet name(Earth by default)\n * @param {Ellipsoid} [options.ellipsoid] - Planet ellipsoid(WGS84 by default)\n * @param {Number} [options.maxGridSize=128] - Segment maximal grid size\n * @param {Number} [options.maxEqualZoomAltitude=15000000.0] - Maximal altitude since segments on the screen become the same zoom level\n * @param {Number} [options.minEqualZoomAltitude=10000.0] - Minimal altitude since segments on the screen become the same zoom level\n * @param {Number} [options.minEqualZoomCameraSlope=0.8] - Minimal camera slope above te globe where segments on the screen become the same zoom level\n *\n * @fires EventsHandler<PlanetEventList>#draw\n * @fires EventsHandler<PlanetEventList>#layeradd\n * @fires EventsHandler<PlanetEventList>#baselayerchange\n * @fires EventsHandler<PlanetEventList>#layerremove\n * @fires EventsHandler<PlanetEventList>#layervisibilitychange\n * @fires EventsHandler<PlanetEventList>#geoimageadd\n */\nexport class Planet extends RenderNode {\n    constructor(options = {}) {\n        super(options.name);\n        this._renderingFadingNodes = (nodes, sh, currentNode, sl, sliceIndex, outTransparentSegments) => {\n            let isFirstPass = sliceIndex === 0;\n            let isEq = this.terrain.equalizeVertices;\n            for (let j = 0, len = currentNode._fadingNodes.length; j < len; j++) {\n                let f = currentNode._fadingNodes[j].segment;\n                if (this._fadingNodes.has(currentNode._fadingNodes[0].nodeId) && !nodes.has(f.node.nodeId)) {\n                    nodes.set(f.node.nodeId, true);\n                    if (f._transitionOpacity < 1.0) {\n                        outTransparentSegments.push(f);\n                    }\n                    else {\n                        if (isFirstPass) {\n                            isEq && f.equalize();\n                            f.readyToEngage && f.engage();\n                            f.screenRendering(sh, sl, sliceIndex);\n                        }\n                        else {\n                            f.screenRendering(sh, sl, sliceIndex, this.transparentTexture, true);\n                        }\n                    }\n                }\n            }\n        };\n        this._renderingFadingNodesNoDepth = (nodes, sh, currentNode, sl, sliceIndex) => {\n            let isFirstPass = sliceIndex === 0;\n            let isEq = this.terrain.equalizeVertices;\n            let gl = sh.gl;\n            gl.disable(gl.DEPTH_TEST);\n            for (let j = 0, len = currentNode._fadingNodes.length; j < len; j++) {\n                let f = currentNode._fadingNodes[j].segment;\n                if (this._fadingNodes.has(currentNode._fadingNodes[0].nodeId) && !nodes.has(f.node.nodeId)) {\n                    nodes.set(f.node.nodeId, true);\n                    if (isFirstPass) {\n                        isEq && f.equalize();\n                        f.readyToEngage && f.engage();\n                        f.screenRendering(sh, sl, sliceIndex);\n                    }\n                    else {\n                        f.screenRendering(sh, sl, sliceIndex, this.transparentTexture, true);\n                    }\n                }\n            }\n            gl.enable(gl.DEPTH_TEST);\n        };\n        this._prevNodes = new Map();\n        this._currNodes = new Map();\n        this.transitionTime = 580;\n        this.ellipsoid = options.ellipsoid || wgs84;\n        this.lightEnabled = true;\n        this._planetRadius2 = this.ellipsoid.getPolarSize() * this.ellipsoid.getPolarSize();\n        this._layers = [];\n        this._updateLayer = false;\n        this.visibleTileLayers = [];\n        this.visibleVectorLayers = [];\n        this._visibleTileLayerSlices = [];\n        this._frustumEntityCollections = [];\n        this.baseLayer = null;\n        this.terrain = null;\n        this.camera = new PlanetCamera(this, {\n            frustums: options.frustums,\n            eye: new Vec3(25000000, 0, 0),\n            look: Vec3.ZERO,\n            up: Vec3.NORTH,\n            minAltitude: options.minAltitude,\n            maxAltitude: options.maxAltitude\n        });\n        this.maxEqualZoomAltitude = options.maxEqualZoomAltitude || 15000000.0;\n        this.minEqualZoomAltitude = options.minEqualZoomAltitude || 10000.0;\n        this.minEqualZoomCameraSlope = options.minEqualZoomCameraSlope || 0.8;\n        this.mousePositionOnEarth = new Vec3();\n        this.emptyTexture = null;\n        this.transparentTexture = null;\n        this.defaultTexture = null;\n        this.minCurrZoom = math.MAX;\n        this.maxCurrZoom = math.MIN;\n        this._viewExtent = new Extent(new LonLat(180, 180), new LonLat(-180, -180));\n        this._skipPreRender = false;\n        this._initialViewExtent = null;\n        this._createdNodesCount = 0;\n        this._renderedNodes = [];\n        this._renderedNodesInFrustum = [];\n        this._fadingNodes = new Map;\n        this._fadingNodesInFrustum = [];\n        this._visibleNodes = {};\n        this._visibleNodesNorth = {};\n        this._visibleNodesSouth = {};\n        this.layerLock = new Lock();\n        this.terrainLock = new Lock();\n        this._heightFactor = 1.0;\n        this._indexesCache = [];\n        this._indexesCacheToRemove = [];\n        this._indexesCacheToRemoveCounter = 0;\n        this._textureCoordsBufferCache = [];\n        this.quadTreeStrategy = options.quadTreeStrategyPrototype ? new options.quadTreeStrategyPrototype(this) : new EarthQuadTreeStrategy(this);\n        this._nightTexture = null;\n        this._specularTexture = null;\n        let a = utils.createColorRGB(options.ambient, new Vec3(0.2, 0.2, 0.3));\n        let d = utils.createColorRGB(options.diffuse, new Vec3(1.0, 1.0, 1.0));\n        let s = utils.createColorRGB(options.specular, new Vec3(0.00063, 0.00055, 0.00032));\n        let shininess = options.shininess || 18.0;\n        this._ambient = new Float32Array([a.x, a.y, a.z]);\n        this._diffuse = new Float32Array([d.x, d.y, d.z]);\n        this._specular = new Float32Array([s.x, s.y, s.z, shininess]);\n        this._maxGridSize = Math.log2(options.maxGridSize || 256);\n        this.SLICE_SIZE = 4;\n        this.SLICE_SIZE_4 = this.SLICE_SIZE * 4;\n        this.SLICE_SIZE_3 = this.SLICE_SIZE * 3;\n        this._lodSize = CUR_LOD_SIZE;\n        this._curLodSize = CUR_LOD_SIZE;\n        this._minLodSize = MIN_LOD_SIZE;\n        this._maxLodSize = MAX_LOD_SIZE;\n        this._pickingColorArr = new Float32Array(this.SLICE_SIZE_4);\n        this._samplerArr = new Int32Array(this.SLICE_SIZE);\n        this._pickingMaskArr = new Int32Array(this.SLICE_SIZE);\n        this._geoImageCreator = new GeoImageCreator(this);\n        this._vectorTileCreator = new VectorTileCreator(this);\n        this._normalMapCreator = new NormalMapCreator(this);\n        this._terrainWorker = new TerrainWorker(3);\n        this._plainSegmentWorker = new PlainSegmentWorker(3);\n        this._tileLoader = new Loader(options.maxLoadingRequests || 12);\n        this._memKey = new Key();\n        this.events = createEvents(PLANET_EVENTS);\n        this._distBeforeMemClear = 0.0;\n        this._prevCamEye = new Vec3();\n        this._initialized = false;\n        this.always = [];\n        this._renderCompleted = false;\n        this._renderCompletedActivated = false;\n        this._terrainCompleted = false;\n        this._terrainCompletedActivated = false;\n        this._collectRenderNodesIsActive = true;\n        this.nightTextureCoefficient = 2.0;\n        this._renderScreenNodesPASS = this._renderScreenNodesPASSNoAtmos;\n        this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSNoAtmos;\n        this._atmosphereEnabled = options.atmosphereEnabled || false;\n        this._atmosphereMaxMinOpacity = new Float32Array([1.0, 0.41]);\n        this.solidTextureOne = null;\n        this.solidTextureTwo = null;\n        this._nightTextureSrc = options.nightTextureSrc || null;\n        this._specularTextureSrc = options.specularTextureSrc || null;\n        this._transitionOpacityEnabled = options.transitionOpacityEnabled != undefined ? options.transitionOpacityEnabled : true;\n    }\n    /**\n     * Returns true if current terrain data set is loaded\n     */\n    get terrainReady() {\n        return this._terrainCompleted && this._terrainCompletedActivated;\n    }\n    get maxGridSize() {\n        return this._maxGridSize;\n    }\n    getNorthFrameRotation(cartesian) {\n        return this.ellipsoid.getNorthFrameRotation(cartesian);\n    }\n    set atmosphereMaxOpacity(opacity) {\n        this._atmosphereMaxMinOpacity[0] = opacity;\n    }\n    get atmosphereMaxOpacity() {\n        return this._atmosphereMaxMinOpacity[0];\n    }\n    set atmosphereMinOpacity(opacity) {\n        this._atmosphereMaxMinOpacity[1] = opacity;\n    }\n    get atmosphereMinOpacity() {\n        return this._atmosphereMaxMinOpacity[1];\n    }\n    set atmosphereEnabled(enabled) {\n        if (enabled != this._atmosphereEnabled) {\n            this._atmosphereEnabled = enabled;\n            this._initializeAtmosphere();\n        }\n    }\n    get atmosphereEnabled() {\n        return this._atmosphereEnabled;\n    }\n    set diffuse(rgb) {\n        let vec = createColorRGB(rgb);\n        this._diffuse = new Float32Array(vec.toArray());\n    }\n    set ambient(rgb) {\n        let vec = createColorRGB(rgb);\n        this._ambient = new Float32Array(vec.toArray());\n    }\n    set specular(rgb) {\n        let vec = createColorRGB(rgb);\n        this._specular = new Float32Array([vec.x, vec.y, vec.y, this._specular[3]]);\n    }\n    set shininess(v) {\n        this._specular[3] = v;\n    }\n    get normalMapCreator() {\n        return this._normalMapCreator;\n    }\n    get layers() {\n        return [...this._layers];\n    }\n    /**\n     * @todo: remove after tests\n     * Get the collection of layers associated with this planet.\n     * @return {Array.<Layer>} Layers array.\n     * @public\n     */\n    getLayers() {\n        return this.layers;\n    }\n    get sunPos() {\n        return this.renderer.controls.sun.sunlight.getPosition();\n    }\n    /**\n     * Add the given control to the renderer of the planet scene.\n     * @param {Control} control - Control.\n     */\n    addControl(control) {\n        control.planet = this;\n        control.addTo(this.renderer);\n    }\n    get lodSize() {\n        return this._lodSize;\n    }\n    setLodSize(currentLodSize, minLodSize, maxLodSize) {\n        this._maxLodSize = maxLodSize || this._maxLodSize;\n        this._minLodSize = minLodSize || this._minLodSize;\n        this._curLodSize = currentLodSize;\n        this._renderCompletedActivated = false;\n        this._terrainCompletedActivated = false;\n    }\n    /**\n     * Add the given controls array to the renderer of the planet.\n     * @param {Array.<Control>} cArr - Control array.\n     */\n    addControls(cArr) {\n        for (let i = 0; i < cArr.length; i++) {\n            this.addControl(cArr[i]);\n        }\n    }\n    /**\n     * Return layer by it name\n     * @param {string} name - Name of the layer. og.Layer.prototype.name\n     * @public\n     * @returns {Layer} -\n     */\n    getLayerByName(name) {\n        for (let i = 0, len = this._layers.length; i < len; i++) {\n            if (name === this._layers[i].name) {\n                return this._layers[i];\n            }\n        }\n    }\n    /**\n     * Adds layer to the planet.\n     * @param {Layer} layer - Layer object.\n     * @public\n     */\n    addLayer(layer) {\n        layer.addTo(this);\n    }\n    /**\n     * Dispatch layer visibility changing event.\n     * @param {Layer} layer - Changed layer.\n     * @public\n     */\n    _onLayerVisibilityChanged(layer) {\n        this.events.dispatch(this.events.layervisibilitychange, layer);\n    }\n    /**\n     * Adds the given layers array to the planet.\n     * @param {Array.<Layer>} layers - Layers array.\n     * @public\n     */\n    addLayers(layers) {\n        for (let i = 0, len = layers.length; i < len; i++) {\n            this.addLayer(layers[i]);\n        }\n    }\n    /**\n     * Removes the given layer from the planet.\n     * @param {Layer} layer - Layer to remove.\n     * @public\n     */\n    removeLayer(layer) {\n        layer.remove();\n    }\n    /**\n     *\n     * @public\n     * @param {Layer} layer - Material layer.\n     */\n    _clearLayerMaterial(layer) {\n        this.quadTreeStrategy.clearLayerMaterial(layer);\n    }\n    /**\n     * Sets base layer coverage to the planet.\n     * @param {Layer} layer - Layer object.\n     * @public\n     */\n    setBaseLayer(layer) {\n        if (this.baseLayer) {\n            if (!this.baseLayer.isEqual(layer)) {\n                this.baseLayer.setVisibility(false);\n                this.baseLayer = layer;\n                layer.setVisibility(true);\n                this.events.dispatch(this.events.baselayerchange, layer);\n            }\n        }\n        else {\n            this.baseLayer = layer;\n            this.baseLayer.setVisibility(true);\n            this.events.dispatch(this.events.baselayerchange, layer);\n        }\n    }\n    /**\n     * Sets elevation scale. 1.0 is default.\n     * @param {number} factor - Elevation scale.\n     */\n    setHeightFactor(factor) {\n        this._renderCompletedActivated = false;\n        this._terrainCompletedActivated = false;\n        if (this._heightFactor !== factor) {\n            this._heightFactor = factor;\n            this.quadTreeStrategy.destroyBranches();\n            this._clearRenderedNodeList();\n            this._clearRenderNodesInFrustum();\n        }\n    }\n    /**\n     * Gets elevation scale.\n     * @returns {number} Terrain elevation scale\n     */\n    getHeightFactor() {\n        return this._heightFactor;\n    }\n    /**\n     * Sets terrain provider\n     * @public\n     * @param {EmptyTerrain} terrain - Terrain provider.\n     */\n    setTerrain(terrain) {\n        this._renderCompletedActivated = false;\n        this._terrainCompletedActivated = false;\n        if (this._initialized) {\n            this.memClear();\n        }\n        if (this.terrain) {\n            this.terrain.abortLoading();\n            this.terrain.clearCache();\n            this.terrain._planet = null;\n        }\n        this.terrain = terrain;\n        this.terrain._planet = this;\n        this.quadTreeStrategy.destroyBranches();\n        if (terrain._geoid.model) {\n            this._plainSegmentWorker.setGeoid(terrain.getGeoid());\n            terrain._isReady = true;\n        }\n        else {\n            Geoid.loadModel(terrain.geoid.src)\n                .then((m) => {\n                terrain.geoid.setModel(m);\n                this._plainSegmentWorker.setGeoid(terrain.getGeoid());\n                terrain._isReady = true;\n            })\n                .catch((err) => {\n                console.warn(err);\n            });\n        }\n    }\n    _initializeAtmosphere() {\n        let h = this.renderer.handler;\n        h.removeProgram(\"drawnode_screen_wl\");\n        if (this._atmosphereEnabled) {\n            this._renderScreenNodesPASS = this._renderScreenNodesPASSAtmos;\n            this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSAtmos;\n            if (h.isWebGl2()) {\n                h.addProgram(shaders.drawnode_screen_wl_webgl2Atmos(), true);\n            }\n            else {\n                h.addProgram(shaders.drawnode_screen_wl_webgl1NoAtmos(), true);\n            }\n            if (!this.renderer.controls.Atmosphere) {\n                this.addControl(new Atmosphere());\n            }\n            else {\n                this.renderer.controls.Atmosphere.activate();\n            }\n            if (this.renderer.controls.SimpleSkyBackground) {\n                this.renderer.controls.SimpleSkyBackground.deactivate();\n            }\n        }\n        else {\n            this._renderScreenNodesPASS = this._renderScreenNodesPASSNoAtmos;\n            this._renderScreenNodesWithHeightPASS = this._renderScreenNodesWithHeightPASSNoAtmos;\n            if (this.renderer.controls.Atmosphere) {\n                this.renderer.controls.Atmosphere.deactivate();\n            }\n            if (!this.renderer.controls.SimpleSkyBackground) {\n                this.addControl(new SimpleSkyBackground());\n            }\n            else {\n                this.renderer.controls.SimpleSkyBackground.activate();\n            }\n            if (h.isWebGl2()) {\n                h.addProgram(shaders.drawnode_screen_wl_webgl2NoAtmos(), true);\n            }\n            else {\n                h.addProgram(shaders.drawnode_screen_wl_webgl1NoAtmos(), true);\n            }\n        }\n    }\n    _initializeShaders() {\n        let h = this.renderer.handler;\n        h.addProgram(shaders.drawnode_screen_nl(), true);\n        h.addProgram(shaders.drawnode_colorPicking(), true);\n        h.addProgram(shaders.drawnode_depth(), true);\n        h.addProgram(shaders.drawnode_heightPicking(), true);\n        this.renderer.addPickingCallback(this, this._renderColorPickingFramebufferPASS);\n        this.renderer.addDepthCallback(this, this._renderDepthFramebufferPASS);\n        this.renderer.addDistanceCallback(this, this._renderDistanceFramebufferPASS);\n    }\n    _onLayerLoadend(layer) {\n        this.events.dispatch(this.events.layerloadend, layer);\n    }\n    init() {\n        this._tileLoader.events.on(\"layerloadend\", this._onLayerLoadend, this);\n        // Initialization indexes table\n        segmentHelper.getInstance().setMaxGridSize(this._maxGridSize);\n        const TABLESIZE = this._maxGridSize;\n        let kk = 0;\n        // Initialization indexes buffers cache. It takes about 120mb RAM!\n        for (let i = 0; i <= TABLESIZE; i++) {\n            !this._indexesCache[i] && (this._indexesCache[i] = new Array(TABLESIZE));\n            for (let j = 0; j <= TABLESIZE; j++) {\n                !this._indexesCache[i][j] && (this._indexesCache[i][j] = new Array(TABLESIZE));\n                for (let k = 0; k <= TABLESIZE; k++) {\n                    !this._indexesCache[i][j][k] && (this._indexesCache[i][j][k] = new Array(TABLESIZE));\n                    for (let m = 0; m <= TABLESIZE; m++) {\n                        !this._indexesCache[i][j][k][m] && (this._indexesCache[i][j][k][m] = new Array(TABLESIZE));\n                        for (let q = 0; q <= TABLESIZE; q++) {\n                            let ptr = {\n                                buffer: null\n                            };\n                            if (i >= 1 && i === j && i === k && i === m && i === q) {\n                                let indexes = segmentHelper.getInstance().createSegmentIndexes(i, [j, k, m, q]);\n                                ptr.buffer = this.renderer.handler.createElementArrayBuffer(indexes, 1);\n                            }\n                            else {\n                                this._indexesCacheToRemove[kk++] = ptr;\n                            }\n                            this._indexesCache[i][j][k][m][q] = ptr;\n                        }\n                    }\n                }\n            }\n        }\n        this.renderer.events.on(\"resize\", () => {\n            this._renderCompletedActivated = false;\n            this._terrainCompletedActivated = false;\n        });\n        this.renderer.events.on(\"drawtransparent\", () => {\n            this._renderScreenNodesWithHeightPASS();\n        });\n        // Initialize texture coordinates buffer pool\n        this._textureCoordsBufferCache = [];\n        let texCoordCache = segmentHelper.getInstance().initTextureCoordsTable(TABLESIZE + 1);\n        for (let i = 0; i <= TABLESIZE; i++) {\n            this._textureCoordsBufferCache[i] = this.renderer.handler.createArrayBuffer(texCoordCache[i], 2, ((1 << i) + 1) * ((1 << i) + 1));\n        }\n        // creating empty textures\n        this.renderer.handler.createDefaultTexture(null, (t) => {\n            this.solidTextureOne = t;\n            this.solidTextureTwo = t;\n        });\n        this.transparentTexture = this.renderer.handler.transparentTexture;\n        this._renderedNodesInFrustum = new Array(this.camera.frustums.length);\n        for (let i = 0, len = this._renderedNodesInFrustum.length; i < len; i++) {\n            this._renderedNodesInFrustum[i] = [];\n        }\n        // Creating quad trees nodes\n        this.quadTreeStrategy.init();\n        this.drawMode = this.renderer.handler.gl.TRIANGLE_STRIP;\n        // Applying shaders\n        this._initializeShaders();\n        this._initializeAtmosphere();\n        this._updateVisibleLayers();\n        this.renderer.addPickingCallback(this, this._frustumEntityCollectionPickingCallback);\n        // loading Earth night glowing texture\n        if (this._nightTextureSrc) {\n            let img = new Image();\n            img.crossOrigin = \"Anonymous\";\n            img.onload = () => {\n                this._nightTexture = this.renderer.handler.createTextureDefault(img);\n                this._nightTexture.default = true;\n            };\n            img.src = this._nightTextureSrc;\n            // createImageBitmap(NIGHT).then((e: ImageBitmap) => {\n            //     this._nightTexture = this.renderer!.handler!.createTextureDefault(e);\n            // });\n        }\n        // load water specular mask\n        if (this._specularTextureSrc) {\n            let img = new Image();\n            img.crossOrigin = \"Anonymous\";\n            img.onload = () => {\n                this._specularTexture = this.renderer.handler.createTextureDefault(img);\n                this._specularTexture.default = true;\n            };\n            img.src = this._specularTextureSrc;\n            // createImageBitmap(SPECULAR).then((e: ImageBitmap) => {\n            //     this._specularTexture = this.renderer!.handler!.createTexture_l(e);\n            // });\n        }\n        this._geoImageCreator.init();\n        this._vectorTileCreator.init();\n        this._normalMapCreator.init();\n        this.renderer.events.on(\"draw\", this._globalPreDraw, this, -100);\n        // Loading first nodes for better viewing if you have started on a lower altitude.\n        this._preRender();\n        this.renderer.events.on(\"postdraw\", () => {\n            this._checkRendercompleted();\n        });\n        this.initLayers();\n        this._initialized = true;\n        //\n        // after init\n        //\n        if (this._initialViewExtent) {\n            this.viewExtent(this._initialViewExtent);\n        }\n        this.renderer.activeCamera = this.camera;\n        this.camera.bindRenderer(this.renderer);\n        this.camera.update();\n    }\n    initLayers() {\n        let temp = [...this._layers];\n        for (let i = 0; i < temp.length; i++) {\n            this.removeLayer(temp[i]);\n            this.addLayer(temp[i]);\n        }\n    }\n    _clearIndexesCache() {\n        this._indexesCacheToRemoveCounter = 0;\n        let c = this._indexesCacheToRemove, gl = this.renderer.handler.gl;\n        for (let i = 0, len = c.length; i < len; i++) {\n            let ci = c[i];\n            gl.deleteBuffer(ci.buffer);\n            ci.buffer = null;\n        }\n    }\n    _preRender() {\n        this.quadTreeStrategy.preRender();\n        this._preLoad();\n    }\n    _preLoad() {\n        this._clearRenderedNodeList();\n        this._skipPreRender = false;\n        this.quadTreeStrategy.preLoad();\n    }\n    /**\n     * Creates default textures first for the North Pole and whole globe and second for the South Pole.\n     * @public\n     * @param{IDefaultTextureParams} param0 -\n     * @param{IDefaultTextureParams} param1 -\n     */\n    createDefaultTextures(param0, param1) {\n        this.renderer.handler.gl.deleteTexture(this.solidTextureOne);\n        this.renderer.handler.gl.deleteTexture(this.solidTextureTwo);\n        this.renderer.handler.createDefaultTexture(param0, (texture) => {\n            this.solidTextureOne = texture;\n        });\n        this.renderer.handler.createDefaultTexture(param1, (texture) => {\n            this.solidTextureTwo = texture;\n        });\n    }\n    _getLayerAttributionHTML(layer) {\n        return `<div class=\"og-attribution__layer\">${layer.getAttribution()}</div>`;\n    }\n    /**\n     * Updates attribution lists\n     * @public\n     */\n    updateAttributionsList() {\n        let html = \"\";\n        for (let i = 0, len = this._layers.length; i < len; i++) {\n            let li = this._layers[i];\n            if (li.getVisibility()) {\n                if (li.getAttribution().length) {\n                    html += this._getLayerAttributionHTML(li);\n                }\n            }\n        }\n        this._applyAttribution(html);\n    }\n    updateVisibleLayers() {\n        this._updateLayer = true;\n    }\n    _updateVisibleLayers() {\n        this.visibleTileLayers = [];\n        this.visibleTileLayers.length = 0;\n        this.visibleVectorLayers = [];\n        this.visibleVectorLayers.length = 0;\n        let html = \"\";\n        for (let i = 0, len = this._layers.length; i < len; i++) {\n            let li = this._layers[i];\n            if (li.getVisibility()) {\n                if (li.isBaseLayer()) {\n                    this.createDefaultTextures(li._defaultTextures[0], li._defaultTextures[1]);\n                    this.baseLayer = li;\n                }\n                if (li.hasImageryTiles()) {\n                    this.visibleTileLayers.push(li);\n                }\n                if (li.isVector) {\n                    this.visibleVectorLayers.push(li);\n                }\n                if (li.getAttribution().length) {\n                    html += this._getLayerAttributionHTML(li);\n                }\n            }\n            else if (li._fading && li._fadingOpacity > 0) {\n                if (li.hasImageryTiles()) {\n                    this.visibleTileLayers.push(li);\n                }\n                if (li.isVector) {\n                    this.visibleVectorLayers.push(li);\n                }\n            }\n        }\n        this._applyAttribution(html);\n        this._sortLayers();\n    }\n    /**\n     * Apply to render list of layer attributions\n     * @protected\n     */\n    _applyAttribution(html) {\n        if (this.renderer && this.renderer.div) {\n            if (html.length) {\n                if (this.renderer.div.attributions.innerHTML !== html) {\n                    this.renderer.div.attributions.innerHTML = html;\n                }\n            }\n            else {\n                this.renderer.div.attributions.innerHTML = \"\";\n            }\n        }\n    }\n    /**\n     * Sort visible layer - preparing for rendering.\n     * @protected\n     */\n    _sortLayers() {\n        this.visibleVectorLayers.sort((a, b) => (a.getZIndex() - b.getZIndex()) || (a.getHeight() - b.getHeight()));\n        this._visibleTileLayerSlices = [];\n        this._visibleTileLayerSlices.length = 0;\n        if (this.visibleTileLayers.length) {\n            this.visibleTileLayers.sort((a, b) => (a.getHeight() - b.getHeight()) || (a.getZIndex() - b.getZIndex()));\n            let k = -1;\n            let currHeight = this.visibleTileLayers[0].getHeight();\n            for (let i = 0, len = this.visibleTileLayers.length; i < len; i++) {\n                if (i % this.SLICE_SIZE === 0 || this.visibleTileLayers[i].getHeight() !== currHeight) {\n                    k++;\n                    this._visibleTileLayerSlices[k] = [];\n                    currHeight = this.visibleTileLayers[i].getHeight();\n                }\n                this._visibleTileLayerSlices[k].push(this.visibleTileLayers[i]);\n            }\n        }\n    }\n    _clearRenderedNodeList() {\n        this._renderedNodes.length = 0;\n        this._renderedNodes = [];\n    }\n    _clearRenderNodesInFrustum() {\n        for (let i = 0, len = this._renderedNodesInFrustum.length; i < len; i++) {\n            this._renderedNodesInFrustum[i].length = 0;\n            this._renderedNodesInFrustum[i] = [];\n        }\n    }\n    _collectRenderedNodesMaxZoom(cam) {\n        if (cam.slope > this.minEqualZoomCameraSlope && cam._lonLat.height < this.maxEqualZoomAltitude && cam._lonLat.height > this.minEqualZoomAltitude) {\n            this.minCurrZoom = this.maxCurrZoom;\n            let temp = this._renderedNodes, rf = this._renderedNodesInFrustum, temp2 = [];\n            this._clearRenderNodesInFrustum();\n            this._renderedNodes = [];\n            for (let i = 0, len = temp.length; i < len; i++) {\n                let ri = temp[i];\n                let ht = ri.segment.centerNormal.dot(cam._b);\n                if (ri.segment.tileZoom === this.maxCurrZoom || ht < HORIZON_TANGENT) {\n                    this._renderedNodes.push(ri);\n                    let k = 0, inFrustum = ri.inFrustum;\n                    while (inFrustum) {\n                        if (inFrustum & 1) {\n                            rf[k].push(ri);\n                        }\n                        k++;\n                        inFrustum >>= 1;\n                    }\n                }\n                else {\n                    temp2.push(ri);\n                }\n            }\n            for (let i = 0, len = temp2.length; i < len; i++) {\n                temp2[i].renderTree(cam, this.maxCurrZoom, null, false, temp2[i]);\n            }\n        }\n    }\n    set transitionOpacityEnabled(isEnabled) {\n        this._transitionOpacityEnabled = isEnabled;\n        //@todo: set render nodes transition opacity to one\n    }\n    get transitionOpacityEnabled() {\n        return this._transitionOpacityEnabled;\n    }\n    /**\n     * Collects visible quad nodes.\n     * @protected\n     */\n    _collectRenderNodes(cam) {\n        this._lodSize = math.lerp(cam.slope < 0.0 ? 0.0 : cam.slope, this._curLodSize, this._minLodSize);\n        cam._insideSegment = null;\n        // clear first\n        this._clearRenderedNodeList();\n        this._clearRenderNodesInFrustum();\n        this._viewExtent.southWest.set(180, 180);\n        this._viewExtent.northEast.set(-180, -180);\n        // todo: replace to camera\n        this._visibleNodes = {};\n        this._visibleNodesNorth = {};\n        this._visibleNodesSouth = {};\n        // todo: replace to camera\n        this.minCurrZoom = math.MAX;\n        this.maxCurrZoom = math.MIN;\n        this.quadTreeStrategy.collectRenderNodes();\n        this._collectRenderedNodesMaxZoom(cam);\n        // main camera effect\n        this._fadingNodes.clear();\n        if (this._transitionOpacityEnabled) {\n            let opaqueNodes = [];\n            for (let i = 0; i < this._renderedNodes.length; i++) {\n                let ri = this._renderedNodes[i];\n                // it's not impossible to move the code into Node.addToRender, because\n                // we can't know actual state before _collectRenderedNodesMaxZoom pass\n                ri._collectFadingNodes();\n                ri._refreshTransitionOpacity();\n                if (ri.segment._transitionOpacity >= 1.0) {\n                    ri.getRenderedNodesNeighbors(opaqueNodes);\n                    opaqueNodes.push(ri);\n                }\n                else {\n                    for (let j = 0; j < ri._fadingNodes.length; j++) {\n                        let rij = ri._fadingNodes[j];\n                        if (rij.segment && rij.segment._transitionOpacity >= 1.0) {\n                            rij.getRenderedNodesNeighbors(opaqueNodes);\n                            opaqueNodes.push(rij);\n                        }\n                    }\n                }\n            }\n        }\n    }\n    _renderScreenNodesPASSNoAtmos() {\n        let cam = this.renderer.activeCamera;\n        let sh = this._setUniformsNoAtmos(cam);\n        //\n        // PASS 0: rendering base slice of layers, which is often zero height\n        this._renderingScreenNodes(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\n    }\n    _renderScreenNodesPASSAtmos() {\n        let cam = this.renderer.activeCamera;\n        let sh = this._setUniformsAtmos(cam);\n        //\n        // PASS 0: rendering base slice of layers, which is often zero height\n        this._renderingScreenNodes(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\n    }\n    _renderScreenNodesWithHeightPASSNoAtmos() {\n        let cam = this.renderer.activeCamera;\n        let sh = this._setUniformsNoAtmos(cam);\n        //\n        // PASS 1: rendering slices, and layers with heights, without transition opacity effect\n        this._renderingScreenNodesWithHeight(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\n    }\n    _renderScreenNodesWithHeightPASSAtmos() {\n        let cam = this.renderer.activeCamera;\n        let sh = this._setUniformsAtmos(cam);\n        //\n        // PASS 1: rendering slices, and layers with heights, without transition opacity effect\n        this._renderingScreenNodesWithHeight(sh, cam, this._renderedNodesInFrustum[cam.currentFrustumIndex]);\n    }\n    _globalPreDraw() {\n        let cam = this.camera;\n        // Might be it's better to replace it in setTerrain,\n        // but we have to be sure that setTerrain exists with renderer insttance\n        this.renderer.__useDistanceFramebuffer__ = !this.terrain.isEmpty;\n        this._distBeforeMemClear += this._prevCamEye.distance(cam.eye);\n        this._prevCamEye.copy(cam.eye);\n        cam.checkFly();\n        // free memory\n        if (this._createdNodesCount > MAX_NODES && this._distBeforeMemClear > 1000.0) {\n            this.terrain.clearCache();\n            this.memClear();\n        }\n        if (this._indexesCacheToRemoveCounter > 600) {\n            this._clearIndexesCache();\n        }\n    }\n    /**\n     * Render node callback.\n     * @public\n     */\n    preFrame() {\n        if (this._updateLayer) {\n            this._updateLayer = false;\n            this._updateVisibleLayers();\n        }\n        if (this.camera.isFirstPass) {\n            this.camera.update();\n            if (this._skipPreRender && this._collectRenderNodesIsActive) {\n                this._collectRenderNodes(this.camera);\n            }\n            this._skipPreRender = true;\n            this.transformLights();\n            // creates terrain normal maps\n            this._normalMapCreator.frame();\n            // Creating geoImages textures.\n            this._geoImageCreator.frame();\n            // Vector tiles rasterization\n            this._vectorTileCreator.frame();\n            this.camera.checkTerrainCollision();\n            this.camera.update();\n            // Here is the planet node dispatches a draw event before\n            // rendering begins, and we have got render nodes.\n            this.events.dispatch(this.events.draw, this);\n            // Collect entity collections from vector layers\n            this._collectVectorLayerCollections();\n        }\n        this.drawEntityCollections(this._frustumEntityCollections);\n    }\n    /**\n     * Render node callback.\n     * Frame function is called for each renderer activrCamera frustum.\n     * @public\n     * @override\n     */\n    frame() {\n        this._renderScreenNodesPASS();\n    }\n    _checkRendercompleted() {\n        if (this._renderCompleted) {\n            if (!this._renderCompletedActivated) {\n                this._renderCompletedActivated = true;\n                this.events.dispatch(this.events.rendercompleted, true);\n            }\n        }\n        else {\n            this._renderCompletedActivated = false;\n        }\n        this._renderCompleted = true;\n        if (this._terrainCompleted) {\n            if (!this._terrainCompletedActivated) {\n                this._terrainCompletedActivated = true;\n                this.events.dispatch(this.events.terraincompleted, true);\n            }\n        }\n        else {\n            this._terrainCompletedActivated = false;\n        }\n        this._terrainCompleted = true;\n    }\n    lockQuadTree() {\n        this._collectRenderNodesIsActive = false;\n        this.camera.setTerrainCollisionActivity(false);\n    }\n    unlockQuadTree() {\n        this._collectRenderNodesIsActive = true;\n        this.camera.setTerrainCollisionActivity(true);\n    }\n    _setUniformsNoAtmos(cam) {\n        let sh, shu;\n        let renderer = this.renderer;\n        let h = renderer.handler;\n        let gl = h.gl;\n        gl.enable(gl.CULL_FACE);\n        renderer.enableBlendOneSrcAlpha();\n        if (this.lightEnabled) {\n            h.programs.drawnode_screen_wl.activate();\n            sh = h.programs.drawnode_screen_wl._program;\n            shu = sh.uniforms;\n            gl.uniform3fv(shu.lightsPositions, this._lightsPositions);\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n            if (this.baseLayer) {\n                gl.uniform3fv(shu.diffuse, this.baseLayer._diffuse || this._diffuse);\n                gl.uniform3fv(shu.ambient, this.baseLayer._ambient || this._ambient);\n                gl.uniform4fv(shu.specular, this.baseLayer._specular || this._specular);\n                gl.uniform1f(shu.nightTextureCoefficient, this.baseLayer.nightTextureCoefficient || this.nightTextureCoefficient);\n            }\n            else {\n                gl.uniform3fv(shu.diffuse, this._diffuse);\n                gl.uniform3fv(shu.ambient, this._ambient);\n                gl.uniform4fv(shu.specular, this._specular);\n                gl.uniform1f(shu.nightTextureCoefficient, this.nightTextureCoefficient);\n            }\n            //\n            // Night and specular\n            //\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE);\n            gl.bindTexture(gl.TEXTURE_2D, this._nightTexture || this.transparentTexture);\n            gl.uniform1i(shu.nightTexture, this.SLICE_SIZE);\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 1);\n            gl.bindTexture(gl.TEXTURE_2D, this._specularTexture || this.transparentTexture);\n            gl.uniform1i(shu.specularTexture, this.SLICE_SIZE + 1);\n            gl.uniform1f(shu.camHeight, cam.getHeight());\n        }\n        else {\n            h.programs.drawnode_screen_nl.activate();\n            sh = h.programs.drawnode_screen_nl._program;\n            shu = sh.uniforms;\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n        }\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\n        return sh;\n    }\n    _setUniformsAtmos(cam) {\n        let sh, shu;\n        let renderer = this.renderer;\n        let h = renderer.handler;\n        let gl = h.gl;\n        gl.enable(gl.CULL_FACE);\n        renderer.enableBlendOneSrcAlpha();\n        if (this.lightEnabled) {\n            h.programs.drawnode_screen_wl.activate();\n            sh = h.programs.drawnode_screen_wl._program;\n            shu = sh.uniforms;\n            gl.uniform3fv(shu.lightsPositions, this._lightsPositions);\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n            if (this.baseLayer) {\n                gl.uniform3fv(shu.diffuse, this.baseLayer._diffuse || this._diffuse);\n                gl.uniform3fv(shu.ambient, this.baseLayer._ambient || this._ambient);\n                gl.uniform4fv(shu.specular, this.baseLayer._specular || this._specular);\n                gl.uniform1f(shu.nightTextureCoefficient, this.baseLayer.nightTextureCoefficient || this.nightTextureCoefficient);\n            }\n            else {\n                gl.uniform3fv(shu.diffuse, this._diffuse);\n                gl.uniform3fv(shu.ambient, this._ambient);\n                gl.uniform4fv(shu.specular, this._specular);\n                gl.uniform1f(shu.nightTextureCoefficient, this.nightTextureCoefficient);\n            }\n            gl.uniform2fv(shu.maxMinOpacity, this._atmosphereMaxMinOpacity);\n            //\n            // Night and specular\n            //\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE);\n            gl.bindTexture(gl.TEXTURE_2D, this._nightTexture || this.transparentTexture);\n            gl.uniform1i(shu.nightTexture, this.SLICE_SIZE);\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 1);\n            gl.bindTexture(gl.TEXTURE_2D, this._specularTexture || this.transparentTexture);\n            gl.uniform1i(shu.specularTexture, this.SLICE_SIZE + 1);\n            //\n            // atmos precomputed textures\n            //\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 4);\n            gl.bindTexture(gl.TEXTURE_2D, renderer.controls.Atmosphere._transmittanceBuffer.textures[0]);\n            gl.uniform1i(shu.transmittanceTexture, this.SLICE_SIZE + 4);\n            gl.activeTexture(gl.TEXTURE0 + this.SLICE_SIZE + 5);\n            gl.bindTexture(gl.TEXTURE_2D, renderer.controls.Atmosphere._scatteringBuffer.textures[0]);\n            gl.uniform1i(shu.scatteringTexture, this.SLICE_SIZE + 5);\n            gl.uniform1f(shu.camHeight, cam.getHeight());\n        }\n        else {\n            h.programs.drawnode_screen_nl.activate();\n            sh = h.programs.drawnode_screen_nl._program;\n            shu = sh.uniforms;\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n        }\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\n        return sh;\n    }\n    /**\n     * Drawing nodes\n     */\n    _renderingScreenNodes(sh, cam, renderedNodes) {\n        let firstPass = cam.isFirstPass;\n        let sl = this._visibleTileLayerSlices;\n        if (sl.length) {\n            let sli = sl[0];\n            for (let i = sli.length - 1; i >= 0; --i) {\n                let li = sli[i];\n                if (li._fading && firstPass && li._refreshFadingOpacity()) {\n                    sli.splice(i, 1);\n                }\n            }\n        }\n        let nodes = new Map;\n        let transparentSegments = [];\n        let isEq = this.terrain.equalizeVertices;\n        let i = renderedNodes.length;\n        let _renderingFadingNodes = this._renderingFadingNodes;\n        if (cam.slope > 0.78 || cam.getAltitude() > 10000) {\n            _renderingFadingNodes = this._renderingFadingNodesNoDepth;\n        }\n        while (i--) {\n            let ri = renderedNodes[i];\n            let s = ri.segment;\n            _renderingFadingNodes(nodes, sh, ri, sl[0], 0, transparentSegments);\n            if (s._transitionOpacity < 1) {\n                transparentSegments.push(s);\n            }\n            else {\n                isEq && s.equalize();\n                s.readyToEngage && s.engage();\n                s.screenRendering(sh, sl[0], 0);\n            }\n        }\n        for (let j = 0; j < transparentSegments.length; j++) {\n            let tj = transparentSegments[j];\n            isEq && tj.equalize();\n            tj.readyToEngage && tj.engage();\n            tj.screenRendering(sh, sl[0], 0);\n        }\n    }\n    _renderingScreenNodesWithHeight(sh, cam, renderedNodes) {\n        let gl = this.renderer.handler.gl;\n        let firstPass = cam.isFirstPass;\n        let sl = this._visibleTileLayerSlices;\n        gl.enable(gl.POLYGON_OFFSET_FILL);\n        gl.disable(gl.CULL_FACE);\n        let nodes = new Map;\n        let transparentSegments = [];\n        for (let j = 1, len = sl.length; j < len; j++) {\n            let slj = sl[j];\n            for (let i = slj.length - 1; i >= 0; --i) {\n                let li = slj[i];\n                if (li._fading && firstPass && li._refreshFadingOpacity()) {\n                    slj.splice(i, 1);\n                }\n            }\n            gl.polygonOffset(0, -j);\n            let i = renderedNodes.length;\n            while (i--) {\n                let ri = renderedNodes[i];\n                this._renderingFadingNodes(nodes, sh, ri, sl[j], j, transparentSegments);\n                if (ri.segment._transitionOpacity < 1) {\n                    ri.segment.initSlice(j);\n                }\n                else {\n                    ri.segment.screenRendering(sh, sl[j], j, this.transparentTexture, true);\n                }\n            }\n        }\n        gl.disable(gl.POLYGON_OFFSET_FILL);\n        gl.enable(gl.CULL_FACE);\n    }\n    _renderDistanceFramebufferPASS() {\n        if (!this.terrain.isEmpty) {\n            let sh;\n            let renderer = this.renderer;\n            let h = renderer.handler;\n            let gl = h.gl;\n            let cam = renderer.activeCamera;\n            h.programs.drawnode_heightPicking.activate();\n            sh = h.programs.drawnode_heightPicking._program;\n            let shu = sh.uniforms;\n            gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n            gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n            gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\n            gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\n            // drawing planet nodes\n            let rn = this._renderedNodesInFrustum[cam.currentFrustumIndex];\n            let sl = this._visibleTileLayerSlices;\n            let i = rn.length;\n            while (i--) {\n                rn[i].segment.heightPickingRendering(sh, sl[0]);\n            }\n        }\n    }\n    _renderColorPickingFramebufferPASS() {\n        let sh;\n        let renderer = this.renderer;\n        let h = renderer.handler;\n        let gl = h.gl;\n        h.programs.drawnode_colorPicking.activate();\n        sh = h.programs.drawnode_colorPicking._program;\n        let shu = sh.uniforms;\n        let cam = renderer.activeCamera;\n        gl.enable(gl.CULL_FACE);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\n        // drawing planet nodes\n        let rn = this._renderedNodesInFrustum[cam.getCurrentFrustum()];\n        let sl = this._visibleTileLayerSlices;\n        let i = rn.length;\n        while (i--) {\n            rn[i].segment.colorPickingRendering(sh, sl[0], 0);\n        }\n        // Here is set blending for transparent overlays\n        renderer.enableBlendDefault();\n        gl.enable(gl.POLYGON_OFFSET_FILL);\n        for (let j = 1, len = sl.length; j < len; j++) {\n            i = rn.length;\n            gl.polygonOffset(0, -j);\n            while (i--) {\n                rn[i].segment.colorPickingRendering(sh, sl[j], j, this.transparentTexture, true);\n            }\n        }\n        gl.disable(gl.POLYGON_OFFSET_FILL);\n    }\n    _renderDepthFramebufferPASS() {\n        let sh;\n        let renderer = this.renderer;\n        let h = renderer.handler;\n        let gl = h.gl;\n        h.programs.drawnode_depth.activate();\n        sh = h.programs.drawnode_depth._program;\n        let shu = sh.uniforms;\n        let cam = renderer.activeCamera;\n        gl.disable(gl.BLEND);\n        gl.disable(gl.POLYGON_OFFSET_FILL);\n        gl.uniformMatrix4fv(shu.viewMatrix, false, cam.getViewMatrix());\n        gl.uniformMatrix4fv(shu.projectionMatrix, false, cam.getProjectionMatrix());\n        gl.uniform3fv(shu.eyePositionHigh, cam.eyeHigh);\n        gl.uniform3fv(shu.eyePositionLow, cam.eyeLow);\n        gl.uniform3fv(shu.frustumPickingColor, cam.frustum._pickingColorU);\n        // drawing planet nodes\n        let rn = this._renderedNodesInFrustum[cam.getCurrentFrustum()], sl = this._visibleTileLayerSlices;\n        let i = rn.length;\n        while (i--) {\n            rn[i].segment.depthRendering(sh, sl[0]);\n        }\n        gl.enable(gl.BLEND);\n    }\n    _collectVectorLayerCollections() {\n        this._frustumEntityCollections.length = 0;\n        this._frustumEntityCollections = [];\n        let i = this.visibleVectorLayers.length;\n        while (i--) {\n            let vi = this.visibleVectorLayers[i];\n            if (vi._fading && vi._refreshFadingOpacity()) {\n                this.visibleVectorLayers.splice(i, 1);\n            }\n            vi.collectVisibleCollections(this._frustumEntityCollections);\n            vi.update();\n        }\n    }\n    _frustumEntityCollectionPickingCallback() {\n        this.drawPickingEntityCollections(this._frustumEntityCollections);\n    }\n    /**\n     * Starts clear memory thread.\n     * @public\n     */\n    memClear() {\n        this._distBeforeMemClear = 0;\n        this.camera._insideSegment = null;\n        this.layerLock.lock(this._memKey);\n        this.terrainLock.lock(this._memKey);\n        this._normalMapCreator.lock(this._memKey);\n        this._normalMapCreator.clear();\n        this.terrain.abortLoading();\n        this._tileLoader.abortAll();\n        this.quadTreeStrategy.clear();\n        this.layerLock.free(this._memKey);\n        this.terrainLock.free(this._memKey);\n        this._normalMapCreator.free(this._memKey);\n        this._createdNodesCount = 0;\n    }\n    /**\n     * Returns ray vector hit ellipsoid coordinates.\n     * If the ray doesn't hit ellipsoid it returns 'undefined'.\n     * @public\n     * @param {Ray} ray - Ray.\n     * @returns {Vec3 | undefined} -\n     */\n    getRayIntersectionEllipsoid(ray) {\n        return this.ellipsoid.hitRay(ray.origin, ray.direction);\n    }\n    /**\n     * Project screen coordinates to the planet ellipsoid.\n     * @public\n     * @param {Vec2 | IBaseInputState } px - Screen coordinates.\n     * @returns {Vec3 | undefined} - Cartesian coordinates.\n     */\n    getCartesianFromPixelEllipsoid(px) {\n        let cam = this.renderer.activeCamera;\n        return this.ellipsoid.hitRay(cam.eye, cam.unproject(px.x, px.y));\n    }\n    /**\n     * Project screen coordinates to the planet ellipsoid.\n     * @public\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\n     * @returns {LonLat | undefined} - Geodetic coordinates.\n     */\n    getLonLatFromPixelEllipsoid(px) {\n        let coords = this.getCartesianFromPixelEllipsoid(px);\n        if (coords) {\n            return this.ellipsoid.cartesianToLonLat(coords);\n        }\n    }\n    /**\n     * Returns mouse position cartesian coordinates on the current terrain.\n     * @public\n     * @returns {Vec3 | undefined} -\n     */\n    getCartesianFromMouseTerrain() {\n        let ms = this.renderer.events.mouseState;\n        let distance = this.getDistanceFromPixel(ms);\n        if (distance) {\n            return ms.direction.scaleTo(distance).addA(this.renderer.activeCamera.eye);\n        }\n    }\n    /**\n     * Returns screen coordinates cartesian coordinates on the current terrain.\n     * position or null if input coordinates is outside the planet.\n     * @public\n     * @param {Vec2} px - Pixel screen 2d coordinates.\n     * @returns {Vec3 | undefined} -\n     */\n    getCartesianFromPixelTerrain(px) {\n        let distance = this.getDistanceFromPixel(px);\n        if (distance) {\n            let direction = px.direction || this.renderer.activeCamera.unproject(px.x, px.y);\n            return direction.scaleTo(distance).addA(this.renderer.activeCamera.eye);\n        }\n    }\n    /**\n     * Returns geodetic coordinates on the current terrain planet by its screen coordinates.\n     * position or null if input coordinates is outside the planet.\n     * @public\n     * @param {Vec2 | IBaseInputState} px - Pixel screen 2d coordinates.\n     * @returns {LonLat | undefined} -\n     */\n    getLonLatFromPixelTerrain(px) {\n        let coords = this.getCartesianFromPixelTerrain(px);\n        if (coords) {\n            return this.ellipsoid.cartesianToLonLat(coords);\n        }\n    }\n    /**\n     * Project cartesian coordinates to screen space.\n     * @public\n     * @param {Vec3} coords - Cartesian coordinates.\n     * @returns {Vec2} - Screen coordinates.\n     */\n    getPixelFromCartesian(coords) {\n        return this.renderer.activeCamera.project(coords);\n    }\n    /**\n     * Project geodetic coordinates to screen space.\n     * @public\n     * @param {LonLat} lonlat - Geodetic coordinates.\n     * @returns {Vec2 | undefined} - Screen coordinates.\n     */\n    getPixelFromLonLat(lonlat) {\n        let coords = this.ellipsoid.lonLatToCartesian(lonlat);\n        if (coords) {\n            return this.renderer.activeCamera.project(coords);\n        }\n    }\n    /**\n     * Returns distance from an active (screen) camera to the planet ellipsoid.\n     * @public\n     * @param {Vec2} px - Screen coordinates.\n     * @returns {number} -\n     */\n    getDistanceFromPixelEllipsoid(px) {\n        let coords = this.getCartesianFromPixelEllipsoid(px);\n        if (coords) {\n            return coords.distance(this.renderer.activeCamera.eye);\n        }\n    }\n    /**\n     * Returns distance from active (screen) camera to the planet terrain by screen coordinates.\n     * @public\n     * @param {Vec2 | IBaseInputState} px - Screen coordinates.\n     * @returns {number | undefined} -\n     */\n    getDistanceFromPixel(px) {\n        if (this.terrain.isEmpty) {\n            return this.getDistanceFromPixelEllipsoid(px) || 0;\n        }\n        else {\n            let r = this.renderer;\n            let cnv = r.handler.canvas;\n            let spx = px.x / cnv.width;\n            let spy = (cnv.height - px.y) / cnv.height;\n            _tempPickingPix_[0] = _tempPickingPix_[1] = _tempPickingPix_[2] = 0.0;\n            let dist = 0;\n            r.readDistanceColor(spx, spy, _tempPickingPix_);\n            dist = decodeFloatFromRGBAArr(_tempPickingPix_);\n            if (!(_tempPickingPix_[0] || _tempPickingPix_[1] || _tempPickingPix_[2])) {\n                dist = this.getDistanceFromPixelEllipsoid(px) || 0;\n            }\n            else if (dist < DEPTH_DISTANCE) {\n                r.screenDepthFramebuffer.activate();\n                //if (r.screenDepthFramebuffer.isComplete()) {\n                r.screenDepthFramebuffer.readPixels(_tempDepthColor_, spx, spy);\n                let screenPos = new Vec4(spx * 2.0 - 1.0, spy * 2.0 - 1.0, (_tempDepthColor_[0] / 255.0) * 2.0 - 1.0, 1.0 * 2.0 - 1.0);\n                let viewPosition = this.camera.frustums[0].inverseProjectionMatrix.mulVec4(screenPos);\n                let dir = px.direction || r.activeCamera.unproject(px.x, px.y);\n                dist = -(viewPosition.z / viewPosition.w) / dir.dot(r.activeCamera.getForward());\n                //}\n                r.screenDepthFramebuffer.deactivate();\n            }\n            return dist;\n        }\n    }\n    /**\n     * Sets camera to the planet geographical extent.\n     * @public\n     * @param {Extent} extent - Geographical extent.\n     */\n    viewExtent(extent) {\n        if (this.camera) {\n            this.camera.viewExtent(extent);\n        }\n        else {\n            this._initialViewExtent = extent;\n        }\n    }\n    /**\n     * Fits camera position for the view extent.\n     * @public\n     * @param {Array.<number>} extentArr - Geographical extent array, (exactly 4 entries)\n     * where index 0 - southwest longitude, 1 - latitude southwest, 2 - longitude northeast, 3 - latitude northeast.\n     */\n    viewExtentArr(extentArr) {\n        this.viewExtent(new Extent(new LonLat(extentArr[0], extentArr[1]), new LonLat(extentArr[2], extentArr[3])));\n    }\n    /**\n     * Gets current camera view extent.\n     * @public\n     * @returns {Extent} -\n     */\n    getViewExtent() {\n        return this._viewExtent;\n    }\n    /**\n     * Sets camera to the planet geographical position.\n     * @public\n     * @param {LonLat} lonlat - Camera position.\n     * @param {LonLat} [lookLonLat] - Viewpoint.\n     * @param {Vec3} [up] - Camera up vector.\n     */\n    viewLonLat(lonlat, lookLonLat, up) {\n        this.camera.setLonLat(lonlat, lookLonLat, up);\n    }\n    /**\n     * Fly active camera to the view extent.\n     * @public\n     * @param {Extent} extent - Geographical extent.\n     * @param {Number} [height] - Height on the end of the flight route.\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\n     * @param {Number} [ampl] - Altitude amplitude factor.\n     * @param {Function} [startCallback] - Callback that calls before the flying begins.\n     * @param {Function} [completeCallback] - Callback that calls after flying when flying is finished.\n     */\n    flyExtent(extent, height, up, ampl, completeCallback, startCallback) {\n        this.camera.flyExtent(extent, height, up, ampl, completeCallback, startCallback);\n    }\n    /**\n     * Fly camera to the point.\n     * @public\n     * @param {Vec3} cartesian - Point coordinates.\n     * @param {Vec3} [look] - Camera \"look at\" point.\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\n     * @param {Number} [ampl] - Altitude amplitude factor.\n     * @param {Function} [completeCallback] - Call the function in the end of flight\n     * @param {Function} [startCallback] - Call the function in the beginning\n     * @param {Function} [frameCallback] - Each frame callback\n     */\n    flyCartesian(cartesian, look, up, ampl, completeCallback, startCallback, frameCallback) {\n        this.camera.flyCartesian(cartesian, look, up, ampl, completeCallback, startCallback, frameCallback);\n    }\n    /**\n     * Fly camera to the geodetic position.\n     * @public\n     * @param {LonLat} lonlat - Fly geographical coordinates.\n     * @param {Vec3 | LonLat} [look] - Camera viewpoint in the end of the flight.\n     * @param {Vec3} [up] - Camera UP vector on the end of a flying.\n     * @param {Number} [ampl] - Altitude amplitude factor.\n     * @param [completeCallback]\n     * @param [startCallback]\n     * @param [frameCallback]\n     */\n    flyLonLat(lonlat, look, up, ampl, completeCallback, startCallback, frameCallback) {\n        this.camera.flyLonLat(lonlat, look, up, ampl, completeCallback, startCallback, frameCallback);\n    }\n    /**\n     * Stop current flight.\n     * @public\n     */\n    stopFlying() {\n        this.camera.stopFlying();\n    }\n    updateBillboardsTexCoords() {\n        for (let i = 0; i < this.entityCollections.length; i++) {\n            this.entityCollections[i].billboardHandler.refreshTexCoordsArr();\n        }\n        let readyCollections = {};\n        for (let i = 0; i < this._layers.length; i++) {\n            let li = this._layers[i];\n            if (li instanceof Vector) {\n                li.each(function (e) {\n                    if (e._entityCollection && !readyCollections[e._entityCollection.id]) {\n                        e._entityCollection.billboardHandler.refreshTexCoordsArr();\n                        readyCollections[e._entityCollection.id] = true;\n                    }\n                });\n            }\n        }\n    }\n    getEntityTerrainPoint(entity, res) {\n        let n = this._renderedNodes, i = n.length;\n        while (i--) {\n            if (n[i].segment.isEntityInside(entity)) {\n                return n[i].segment.getEntityTerrainPoint(entity, res);\n            }\n        }\n    }\n    async getHeightDefault(lonLat) {\n        return new Promise((resolve) => {\n            if (this.terrain) {\n                this.terrain.getHeightAsync(lonLat.clone(), (alt) => {\n                    resolve(alt);\n                });\n            }\n            else {\n                resolve(0);\n            }\n        });\n    }\n    async getHeightAboveELL(lonLat) {\n        return new Promise((resolve) => {\n            if (this.terrain) {\n                this.terrain.getHeightAsync(lonLat.clone(), (alt) => {\n                    resolve(alt + this.terrain.geoid.getHeightLonLat(lonLat));\n                });\n            }\n            else {\n                resolve(0);\n            }\n        });\n    }\n    onremove() {\n        this.memClear();\n        this.quadTreeStrategy.destroyBranches();\n        this._renderedNodes = [];\n    }\n}\nconst PLANET_EVENTS = [\n    /**\n     * Triggered before globe frame begins to render.\n     * @event og.scene.Planet#draw\n     */\n    \"draw\",\n    /**\n     * Triggered when layer has added to the planet.\n     * @event og.scene.Planet#layeradd\n     */\n    \"layeradd\",\n    /**\n     * Triggered when base layer changed.\n     * @event og.scene.Planet#baselayerchange\n     */\n    \"baselayerchange\",\n    /**\n     * Triggered when layer has removed from the planet.\n     * @event og.scene.Planet#layerremove\n     */\n    \"layerremove\",\n    /**\n     * Triggered when some layer visibility changed.\n     * @event og.scene.Planet#layervisibilitychange\n     */\n    \"layervisibilitychange\",\n    /**\n     * Triggered when all data is loaded\n     * @event og.scene.Planet#rendercompleted\n     */\n    \"rendercompleted\",\n    /**\n     * Triggered when all data is loaded\n     * @event og.scene.Planet#terraincompleted\n     */\n    \"terraincompleted\",\n    /**\n     * Triggered when layer data is laded\n     * @event og.scene.Planet#terraincompleted\n     */\n    \"layerloadend\"\n];\n//# sourceMappingURL=Planet.js.map","import * as shaders from '../shaders/skybox';\nimport { RenderNode } from './RenderNode';\nclass SkyBox extends RenderNode {\n    constructor(params) {\n        super(\"skybox\");\n        this.params = params;\n        this.vertexPositionBuffer = null;\n        this.texture = null;\n    }\n    static createDefault(RESOURCES_URL) {\n        return new SkyBox({\n            nx: RESOURCES_URL + \"skybox/gal/_nx.jpg\",\n            px: RESOURCES_URL + \"skybox/gal/_px.jpg\",\n            py: RESOURCES_URL + \"skybox/gal/_py.jpg\",\n            ny: RESOURCES_URL + \"skybox/gal/_ny.jpg\",\n            pz: RESOURCES_URL + \"skybox/gal/_pz.jpg\",\n            nz: RESOURCES_URL + \"skybox/gal/_nz.jpg\"\n        });\n    }\n    init() {\n        this.renderer.handler.addProgram(shaders.skybox(), true);\n        this.texture = this.renderer.handler.loadCubeMapTexture(this.params);\n        this._createBuffers();\n        this.drawMode = this.renderer.handler.gl.TRIANGLES;\n    }\n    frame() {\n        let h = this.renderer.handler;\n        let gl = h.gl;\n        let cam = this.renderer.activeCamera;\n        gl.disable(gl.DEPTH_TEST);\n        h.programs.skybox.activate();\n        let sh = h.programs.skybox._program;\n        let shu = sh.uniforms;\n        gl.uniformMatrix4fv(shu.projectionViewMatrix, false, cam.getProjectionViewMatrix());\n        gl.uniform3fv(shu.pos, cam.eye.toArray());\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, this.texture);\n        gl.uniform1i(shu.uSampler, 0);\n        let buf = this.vertexPositionBuffer;\n        gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n        gl.vertexAttribPointer(sh.attributes.aVertexPosition, buf.itemSize, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(this.drawMode, 0, buf.numItems);\n        gl.enable(gl.DEPTH_TEST);\n    }\n    _createBuffers() {\n        const vertices = new Float32Array([\n            -100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, -100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            -100000000.0, -100000000.0, -100000000.0,\n            -100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, 100000000.0, 100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            100000000.0, -100000000.0, 100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            100000000.0, 100000000.0, -100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            -100000000.0, 100000000.0, 100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            100000000.0, -100000000.0, 100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            -100000000.0, 100000000.0, -100000000.0,\n            100000000.0, 100000000.0, -100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            100000000.0, 100000000.0, 100000000.0,\n            -100000000.0, 100000000.0, 100000000.0,\n            -100000000.0, 100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            100000000.0, -100000000.0, -100000000.0,\n            -100000000.0, -100000000.0, 100000000.0,\n            100000000.0, -100000000.0, 100000000.0\n        ]);\n        this.vertexPositionBuffer = this.renderer.handler.createArrayBuffer(vertices, 3, vertices.length / 3);\n    }\n}\nexport { SkyBox };\n//# sourceMappingURL=SkyBox.js.map","import { Program } from '../webgl/Program';\nimport { types } from '../webgl/types';\nexport function skybox() {\n    return new Program(\"skybox\", {\n        uniforms: {\n            projectionViewMatrix: { type: types.MAT4 },\n            uSampler: { type: types.SAMPLERCUBE },\n            pos: { type: types.VEC3 }\n        },\n        attributes: {\n            aVertexPosition: { type: types.VEC3, enableArray: true }\n        },\n        vertexShader: `attribute vec3 aVertexPosition;\n            uniform mat4 projectionViewMatrix;\n            uniform vec3 pos;\n            varying vec3 vTextureCoord;\n            void main(void) {\n                vTextureCoord = aVertexPosition;\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition + pos, 1.0);\n            }`,\n        fragmentShader: `precision lowp float;\n            varying vec3 vTextureCoord;\n            uniform samplerCube uSampler;\n            void main(void) {\n                gl_FragColor = textureCube(uSampler, vTextureCoord);\n            }`\n    });\n}\n//# sourceMappingURL=skybox.js.map","import { Program } from '../webgl/Program';\nimport { RenderNode } from './RenderNode';\nclass Axes extends RenderNode {\n    constructor(size = 100) {\n        super(\"Axes\");\n        this.size = size;\n        this.axesBuffer = null;\n        this.axesColorBuffer = null;\n    }\n    init() {\n        this.createAxesBuffer(this.size);\n        this.drawMode = this.renderer.handler.gl.LINES;\n        this.renderer.handler.addProgram(new Program(\"axesShader\", {\n            uniforms: {\n                projectionViewMatrix: 'mat4'\n            },\n            attributes: {\n                aVertexPosition: 'vec3',\n                aVertexColor: 'vec4'\n            },\n            vertexShader: `attribute vec3 aVertexPosition;\n            attribute vec4 aVertexColor;\n            uniform mat4 projectionViewMatrix;\n            varying vec4 vColor;\n            void main(void) {\n                gl_Position = projectionViewMatrix * vec4(aVertexPosition, 1.0);\n                vColor = aVertexColor;\n            }`,\n            fragmentShader: `precision highp float;\n            varying vec4 vColor;\n            void main(void) {\n                gl_FragColor = vColor;\n            }`\n        }));\n    }\n    frame() {\n        this.renderer.handler.programs.axesShader.activate().set({\n            projectionViewMatrix: this.renderer.activeCamera.getProjectionViewMatrix(),\n            aVertexPosition: this.axesBuffer,\n            aVertexColor: this.axesColorBuffer\n        });\n        this.renderer.handler.programs.axesShader.drawArrays(this.drawMode, this.axesBuffer.numItems);\n    }\n    createAxesBuffer(gridSize) {\n        const vertices = [\n            0.0, 0.0, 0.0, gridSize - 1, 0.0, 0.0,\n            0.0, 0.0, 0.0, 0.0, gridSize - 1, 0.0,\n            0.0, 0.0, 0.0, 0.0, 0.0, gridSize - 1 // z - G\n        ];\n        const colors = [\n            1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0,\n            0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 1.0, 1.0,\n            0.0, 1.0, 0.0, 1.0, 0.0, 1.0, 0.0, 1.0 // z - G\n        ];\n        this.axesBuffer = this.renderer.handler.createArrayBuffer(new Float32Array(vertices), 3, 6);\n        this.axesColorBuffer = this.renderer.handler.createArrayBuffer(new Float32Array(colors), 4, 6);\n    }\n}\nexport { Axes };\n//# sourceMappingURL=Axes.js.map","import { binarySearchFast } from \"../utils/shared\";\nimport { Geoid } from \"./Geoid\";\n/**\n * Class represents terrain provider without elevation data.\n * @param {IEmptyTerrainParams} [options] - Provider options:\n * @param {string} [options.name=\"empty\"] - Provider name.\n * @param {boolean} [options.equalizeVertices] -\n * @param {number} [options.minZoom=2] - Minimal visible zoom index when terrain handler works.\n * @param {number} [options.minZoom=50] - Maximal visible zoom index when terrain handler works.\n * @param {number} [options.maxNativeZoom=19] - Maximal available terrain zoom level.\n * @param {Array.<number>} [options.gridSizeByZoom] - Array of segment triangulation grid sizes where array index agreed to the segment zoom index.\n * @param {Array.<number>} [gridSizeByZoom] - Array of values, where each value corresponds to the size of a tile(or segment) on the globe. Each value must be power of two.\n * @param {Geoid} [options.geoid] -\n * @param {string} [options.geoidSrc] -\n */\nclass EmptyTerrain {\n    constructor(options = {}) {\n        this.__id = EmptyTerrain.__counter__++;\n        this.equalizeVertices = options.equalizeVertices || false;\n        this.equalizeNormals = false;\n        this.isEmpty = true;\n        this.name = options.name || \"empty\";\n        this.minZoom = options.minZoom || 2;\n        this.maxZoom = options.maxZoom || 19;\n        this.maxNativeZoom = options.maxNativeZoom || this.maxZoom;\n        this.gridSizeByZoom = options.gridSizeByZoom || [\n            64, 32, 16, 8, 4, 4, 4, 4, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2\n        ];\n        this._maxNodeZoom = this.gridSizeByZoom.length - 1;\n        this.plainGridSize = 2;\n        this.noDataValues = [];\n        this._planet = null;\n        this._geoid = options.geoid || new Geoid({\n            src: options.geoidSrc || null\n        });\n        this._isReady = false;\n        // const _ellToAltFn = [\n        //     (lon, lat, alt, callback) => callback(alt),\n        //     (lon, lat, alt, callback) => callback(alt - this._geoid.getHeight(lon, lat)),\n        //     (lon, lat, alt, callback) => {\n        //         let x = mercator.getTileX(lon, zoom),\n        //             y = mercator.getTileY(lat, zoom);\n        //         let mslAlt = alt - this._geoid.getHeight(lon, lat);\n        //         if (true) {\n        //         } else {\n        //         }\n        //         return callback(mslAlt);\n        //     },\n        // ];\n    }\n    get isIdle() {\n        return true;\n    }\n    isEqual(obj) {\n        return obj.__id === this.__id;\n    }\n    static checkNoDataValue(noDataValues, value) {\n        return binarySearchFast(noDataValues, value) !== -1;\n    }\n    isBlur(segment) {\n        return false;\n    }\n    set maxNodeZoom(val) {\n        if (val > this.gridSizeByZoom.length - 1) {\n            val = this.gridSizeByZoom.length - 1;\n        }\n        this._maxNodeZoom = val;\n    }\n    get maxNodeZoom() {\n        return this._maxNodeZoom;\n    }\n    set geoid(geoid) {\n        this._geoid = geoid;\n    }\n    get geoid() {\n        return this._geoid;\n    }\n    getGeoid() {\n        return this._geoid;\n    }\n    /**\n     * Loads or creates segment elevation data.\n     * @public\n     * @param {Segment} segment - Segment to create elevation data.\n     */\n    handleSegmentTerrain(segment) {\n        segment.terrainIsLoading = false;\n        segment.terrainReady = true;\n        segment.terrainExists = true;\n    }\n    isReady() {\n        return this._isReady;\n    }\n    abortLoading() {\n    }\n    clearCache() {\n    }\n    getHeightAsync(lonLat, callback) {\n        callback(0);\n        return true;\n    }\n    loadTerrain(segment, forceLoading = false) {\n    }\n}\nEmptyTerrain.__counter__ = 0;\nexport { EmptyTerrain };\n//# sourceMappingURL=EmptyTerrain.js.map","import * as mercator from \"../mercator\";\nimport { createEvents } from \"../Events\";\nimport { createExtent, stringTemplate } from \"../utils/shared\";\nimport { EPSG3857 } from \"../proj/EPSG3857\";\nimport { EmptyTerrain } from \"./EmptyTerrain\";\nimport { Extent } from \"../Extent\";\nimport { Layer } from \"../layer/Layer\";\nimport { Loader } from \"../utils/Loader\";\nimport { LonLat } from \"../LonLat\";\nimport { NOTRENDERING } from \"../quadTree/quadTree\";\n// import { QueueArray } from '../QueueArray';\nimport { Ray } from \"../math/Ray\";\nimport { Vec3 } from \"../math/Vec3\";\n/**\n * Class that loads segment elevation data, converts it to the array and passes it to the planet segment.\n * @class\n * @extends {GlobusTerrain}\n * @param {string} [name=\"\"] - Terrain provider name.\n * @param {IGlobusTerrainParams} [options] - Provider options:\n * @param {number} [options.minZoom=3] - Minimal visible zoom index when terrain handler works.\n * @param {number} [options.minZoom=14] - Maximal visible zoom index when terrain handler works.\n * @param {number} [options.minNativeZoom=14] - Maximal available terrain zoom level.\n * @param {string} [options.url=\"//openglobus.org/heights/srtm3/{z}/{y}/{x}.ddm\"] - Terrain source path url template. Default is openglobus ddm elevation file.\n * @param {Array.<number>} [options.gridSizeByZoom] - Array of segment triangulation grid sizes where array index agreed to the segment zoom index.\n * @param {number} [options.plainGridSize=32] - Elevation grid size. Default is 32x32. Must be power of two.\n * @param {string} [options.responseType=\"arraybuffer\"] - Response type.\n * @param {number} [options.MAX_LOADING_TILES] - Maximum at one time loading tiles.\n * @param {Array.<number>} [gridSizeByZoom] - Array of values, where each value corresponds to the size of a tile(or segment) on the globe. Each value must be power of two.\n * @param {number} [heightFactor=1] - Elevation height multiplier.\n *\n * @fires GlobusTerrainEvents#load\n * @fires GlobusTerrainEvents#loadend\n */\nclass GlobusTerrain extends EmptyTerrain {\n    constructor(name = \"\", options = {}) {\n        super({\n            geoidSrc: \"https://openglobus.org/geoid/egm84-30.pgm\",\n            maxNativeZoom: options.maxNativeZoom || 14,\n            ...options\n        });\n        this._s = options.subdomains || [\"a\", \"b\", \"c\"];\n        this.events = createEvents(GLOBUSTERRAIN_EVENTS, this);\n        this._requestCount = 0;\n        this._requestsPeerSubdomain = 4;\n        this.isEmpty = false;\n        this.equalizeNormals = true;\n        this.name = name || \"openglobus\";\n        this.url = options.url || \"https://{s}.srtm3.openglobus.org/{z}/{y}/{x}.ddm\";\n        this.gridSizeByZoom = options.gridSizeByZoom || [\n            64, 32, 32, 16, 16, 8, 8, 8, 16, 16, 16, 32, 32, 32, 32, 16, 8, 4, 2, 2, 2, 2, 2, 2\n        ];\n        this._heightFactor = options.heightFactor != undefined ? options.heightFactor : 1.0;\n        this.noDataValues = options.noDataValues || [];\n        for (let i = 0; i < this.noDataValues.length; i++) {\n            this.noDataValues[i] *= this._heightFactor;\n        }\n        this.plainGridSize = options.plainGridSize || 32;\n        this._extent = createExtent(options.extent, new Extent(new LonLat(-180.0, -90.0), new LonLat(180.0, 90.0)));\n        this._dataType = \"arrayBuffer\";\n        this._maxNodeZoom = this.gridSizeByZoom.length - 1;\n        this._elevationCache = {};\n        this._fetchCache = {};\n        this._loader = new Loader();\n        this._urlRewriteCallback = options.urlRewrite || null;\n    }\n    get loader() {\n        return this._loader;\n    }\n    clearCache() {\n        for (let c in this._elevationCache) {\n            this._elevationCache[c].heights = null;\n            this._elevationCache[c].extent = null;\n            delete this._elevationCache[c];\n        }\n        //@ts-ignore\n        this._elevationCache = null;\n        this._elevationCache = {};\n        for (let c in this._fetchCache) {\n            //@ts-ignore\n            this._fetchCache[c] = null;\n            delete this._fetchCache[c];\n        }\n        //@ts-ignore\n        this._fetchCache = null;\n        this._fetchCache = {};\n    }\n    isBlur(segment) {\n        return segment.tileZoom >= 6;\n    }\n    getHeightAsync(lonLat, callback, zoom, firstAttempt) {\n        if (!lonLat || lonLat.lat > mercator.MAX_LAT || lonLat.lat < mercator.MIN_LAT) {\n            callback(0);\n            return true;\n        }\n        firstAttempt = firstAttempt != undefined ? firstAttempt : true;\n        let z = zoom || this.maxZoom, z2 = Math.pow(2, z), size = mercator.POLE2 / z2, merc = mercator.forward(lonLat), x = Math.floor((mercator.POLE + merc.lon) / size), y = Math.floor((mercator.POLE - merc.lat) / size);\n        let tileIndex = Layer.getTileIndex(x, y, z);\n        let cache = this._elevationCache[tileIndex];\n        if (cache) {\n            if (cache.heights) {\n                callback(this._getGroundHeightMerc(merc, cache));\n            }\n            else {\n                callback(0);\n            }\n            return true;\n        }\n        else {\n            if (!this._fetchCache[tileIndex]) {\n                let url = this._buildURL(x, y, z);\n                this._fetchCache[tileIndex] = this._loader.fetch({\n                    src: url,\n                    type: this._dataType\n                });\n            }\n            this._fetchCache[tileIndex].then((response) => {\n                let extent = mercator.getTileExtent(x, y, z);\n                if (response.status === \"ready\") {\n                    let cache = {\n                        heights: this._createHeights(response.data, tileIndex, x, y, z, extent),\n                        extent: extent\n                    };\n                    this._elevationCache[tileIndex] = cache;\n                    callback(this._getGroundHeightMerc(merc, cache));\n                }\n                else if (response.status === \"error\") {\n                    if (firstAttempt && z > this.maxNativeZoom) {\n                        firstAttempt = false;\n                        this.getHeightAsync(lonLat, callback, this.maxNativeZoom, false);\n                        return;\n                    }\n                    this._elevationCache[tileIndex] = {\n                        heights: null,\n                        extent: extent\n                    };\n                    callback(0);\n                }\n                else {\n                    // @ts-ignore\n                    this._fetchCache[tileIndex] = null;\n                    delete this._fetchCache[tileIndex];\n                }\n            });\n        }\n        return false;\n    }\n    getTileCache(lonLat, z) {\n        if (!lonLat || lonLat.lat > mercator.MAX_LAT || lonLat.lat < mercator.MIN_LAT) {\n            return;\n        }\n        let z2 = Math.pow(2, z), size = mercator.POLE2 / z2, merc = mercator.forward(lonLat), x = Math.floor((mercator.POLE + merc.lon) / size), y = Math.floor((mercator.POLE - merc.lat) / size);\n        let tileIndex = Layer.getTileIndex(x, y, z);\n        return this._elevationCache[tileIndex];\n    }\n    _getGroundHeightMerc(merc, tileData) {\n        if (!(tileData.extent && tileData.heights)) {\n            return 0;\n        }\n        let w = tileData.extent.getWidth(), gs = Math.sqrt(tileData.heights.length);\n        let size = w / (gs - 1);\n        /*\n        v2-----------v3\n        |            |\n        |            |\n        |            |\n        v0-----------v1\n        */\n        let i = gs - Math.ceil((merc.lat - tileData.extent.southWest.lat) / size) - 1, j = Math.floor((merc.lon - tileData.extent.southWest.lon) / size);\n        let v0Ind = (i + 1) * gs + j, v1Ind = v0Ind + 1, v2Ind = i * gs + j, v3Ind = v2Ind + 1;\n        let h0 = tileData.heights[v0Ind], h1 = tileData.heights[v1Ind], h2 = tileData.heights[v2Ind], h3 = tileData.heights[v3Ind];\n        let v0 = new Vec3(tileData.extent.southWest.lon + size * j, h0, tileData.extent.northEast.lat - size * i - size), v1 = new Vec3(v0.x + size, h1, v0.z), v2 = new Vec3(v0.x, h2, v0.z + size), v3 = new Vec3(v0.x + size, h3, v0.z + size);\n        let xyz = new Vec3(merc.lon, 100000.0, merc.lat), ray = new Ray(xyz, new Vec3(0, -1, 0));\n        let res = new Vec3();\n        let d = ray.hitTriangle(v0, v1, v2, res);\n        if (d === Ray.INSIDE) {\n            return res.y;\n        }\n        d = ray.hitTriangle(v1, v3, v2, res);\n        if (d === Ray.INSIDE) {\n            return res.y;\n        }\n        return 0;\n    }\n    /**\n     * Stop loading.\n     * @public\n     */\n    abortLoading() {\n        this._loader.abortAll();\n    }\n    /**\n     * Sets terrain data url template.\n     * @public\n     * @param {string} url - Url template.\n     * @example <caption>Default openglobus url template:</caption>:\n     * \"http://earth3.openglobus.org/{z}/{y}/{x}.ddm\"\n     */\n    setUrl(url) {\n        this.url = url;\n    }\n    /**\n     * Sets provider name.\n     * @public\n     * @param {string} name - Name.\n     */\n    setName(name) {\n        this.name = name;\n    }\n    isReadyToLoad(segment) {\n        return segment._projection.equal(EPSG3857) && this._extent.overlaps(segment.getExtentLonLat());\n    }\n    /**\n     * Starts to load segment elevation data.\n     * @public\n     * @param {Segment} segment - Segment that wants a terrain data.\n     * @param {boolean} [forceLoading] -\n     */\n    loadTerrain(segment, forceLoading = false) {\n        if (this._planet.terrainLock.isFree()) {\n            segment.terrainReady = false;\n            segment.terrainIsLoading = true;\n            if (this.isReadyToLoad(segment)) {\n                let cache = this._elevationCache[segment.tileIndex];\n                if (cache) {\n                    this._applyElevationsData(segment, cache.heights);\n                }\n                else {\n                    this._loader.load({\n                        sender: this,\n                        src: this._getHTTPRequestString(segment),\n                        segment: segment,\n                        type: this._dataType,\n                        filter: () => (segment.plainReady && segment.node.getState() !== NOTRENDERING) || forceLoading\n                    }, (response) => {\n                        if (response.status === \"ready\") {\n                            let heights = this._createHeights(response.data, segment.tileIndex, segment.tileX, segment.tileY, segment.tileZoom, segment.getExtent(), segment.tileZoom === this.maxZoom);\n                            this._elevationCache[segment.tileIndex] = {\n                                heights: heights,\n                                extent: segment.getExtent()\n                            };\n                            this._applyElevationsData(segment, heights);\n                        }\n                        else if (response.status === \"abort\") {\n                            segment.terrainIsLoading = false;\n                        }\n                        else if (response.status === \"error\") {\n                            this._applyElevationsData(segment, null);\n                        }\n                        else {\n                            segment.terrainIsLoading = false;\n                        }\n                    });\n                }\n            }\n            else {\n                segment.elevationsNotExists();\n            }\n        }\n        else {\n            segment.terrainIsLoading = false;\n        }\n    }\n    _getSubdomain() {\n        this._requestCount++;\n        return this._s[Math.floor(this._requestCount % (this._requestsPeerSubdomain * this._s.length) / this._requestsPeerSubdomain)];\n    }\n    _buildURL(x, y, z) {\n        return stringTemplate(this.url, {\n            s: this._getSubdomain(),\n            x: x.toString(),\n            y: y.toString(),\n            z: z.toString()\n        });\n    }\n    /**\n     * Creates default query url string.\n     * @protected\n     * @param {Segment} segment -\n     * @returns {string} -\n     */\n    _createUrl(segment) {\n        return this._buildURL(segment.tileX, segment.tileY, segment.tileZoom);\n    }\n    /**\n     * Returns actual url query string.\n     * @protected\n     * @param {Segment} segment - Segment that loads image data.\n     * @returns {string} - Url string.\n     */\n    _getHTTPRequestString(segment) {\n        return this._urlRewriteCallback ? this._urlRewriteCallback(segment, this.url) : this._createUrl(segment);\n    }\n    /**\n     * Sets url rewrite callback, used for custom url rewriting for every tile loading.\n     * @public\n     * @param {UrlRewriteFunc} ur - The callback that returns tile custom created url.\n     */\n    setUrlRewriteCallback(ur) {\n        this._urlRewriteCallback = ur;\n    }\n    /**\n     * Converts loaded data to segment elevation data type(column major elevation data array in meters)\n     * @public\n     * @returns {Array.<number>} -\n     */\n    _createHeights(data, tileIndex, x, y, z, extent, isMaxZoom) {\n        if (this._heightFactor !== 1) {\n            let res = new Float32Array(data);\n            for (let i = 0, len = res.length; i < len; i++) {\n                res[i] = res[i] * this._heightFactor;\n            }\n            return res;\n        }\n        return new Float32Array(data);\n    }\n    /**\n     * @protected\n     */\n    _applyElevationsData(segment, elevations) {\n        if (segment) {\n            let e = this.events.load;\n            if (e.handlers.length) {\n                this.events.dispatch(e, {\n                    elevations: elevations,\n                    segment: segment\n                });\n            }\n            segment.applyTerrain(elevations);\n        }\n    }\n}\nconst GLOBUSTERRAIN_EVENTS = [\n    /**\n     * Triggered when current elevation tile has loaded but before rendering.\n     * @event og.terrain.GlobusTerrain#load\n     */\n    \"load\",\n    /**\n     * Triggered when all elevation tiles have loaded or loading has stopped.\n     * @event og.terrain.GlobusTerrain#loadend\n     */\n    \"loadend\"\n];\nexport { GlobusTerrain };\n//# sourceMappingURL=GlobusTerrain.js.map","import * as mercator from \"../mercator\";\nimport { Layer } from \"./Layer\";\nimport { RENDERING } from \"../quadTree/quadTree\";\nimport { stringTemplate } from \"../utils/shared\";\n/**\n * Represents an imagery tiles source provider.\n * @class\n * @extends {Layer}\n * @param {string} name - Layer name.\n * @param {IXYZParams} options:\n * @param {number} [options.opacity=1.0] - Layer opacity.\n * @param {Array.<string>} [options.subdomains=['a','b','c']] - Subdomains of the tile service.\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\n * @param {number} [options.minNativeZoom=0] - Minimal available zoom level.\n * @param {number} [options.maxNativeZoom=19] - Maximal available zoom level.\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\n * @param {boolean} [options.visibility=true] - Layer visibility.\n * @param {string} [options.crossOrigin=true] - If true, all tiles will have their crossOrigin attribute set to ''.\n * @param {string} options.url - Tile url source template(see example below).\n * @param {string} options.textureFilter - texture gl filter. NEAREST, LINEAR, MIPMAP, ANISOTROPIC.\n * @param {Function} options.urlRewrite - Url rewrite function.\n *\n * @fires EventsHandler<XYZEventsList>#load\n * @fires EventsHandler<XYZEventsList>#loadend\n *\n * @example <caption>Creates OpenStreetMap base tile layer</caption>\n * new og.layer.XYZ(\"OpenStreetMap\", {\n *     isBaseLayer: true,\n *     url: \"http://b.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n *     visibility: true,\n *     attribution: 'Data @ <a href=\"http://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>'\n * });\n */\nexport class XYZ extends Layer {\n    constructor(name, options = {}) {\n        super(name, options);\n        //@ts-ignore\n        this.events = this.events.registerNames(XYZ_EVENTS);\n        this.url = options.url || \"\";\n        this._s = options.subdomains || [\"a\", \"b\", \"c\"];\n        this.minNativeZoom = options.minNativeZoom || 0;\n        this.maxNativeZoom = options.maxNativeZoom || 19;\n        this._urlRewriteCallback = options.urlRewrite || null;\n        this._requestsPeerSubdomains = 4;\n        this._requestCount = 0;\n    }\n    /**\n     * @warning Use XYZ.isIdle in requestAnimationFrame(after setVisibility)\n     */\n    get isIdle() {\n        return super.isIdle && this._planet._tileLoader.getRequestCounter(this) === 0;\n    }\n    get instanceName() {\n        return \"XYZ\";\n    }\n    /**\n     * Abort loading tiles.\n     * @public\n     */\n    abortLoading() {\n        if (this._planet) {\n            this._planet._tileLoader.abort(this);\n        }\n    }\n    /**\n     * Sets layer visibility.\n     * @public\n     * @param {boolean} visibility - Layer visibility.\n     */\n    setVisibility(visibility) {\n        if (visibility !== this._visibility) {\n            super.setVisibility(visibility);\n            if (!visibility) {\n                this.abortLoading();\n            }\n        }\n    }\n    remove() {\n        this.abortLoading();\n        super.remove();\n        return this;\n    }\n    /**\n     * Sets imagery tiles url source template.\n     * @public\n     * @param {string} url - Url template.\n     * @example\n     * http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\n     * where {z}, {x} and {y} - replaces by current tile values, {s} - random domain.\n     */\n    setUrl(url) {\n        this.url = url;\n    }\n    _checkSegment(segment) {\n        return segment._projection.id === this._planet.quadTreeStrategy.projection.id; // EPSG4326.id;// EPSG3857.id;\n    }\n    /**\n     * Start to load tile material.\n     * @public\n     * @virtual\n     * @param {Material} material - Loads current material.\n     * @param {boolean} [forceLoading=false] -\n     */\n    loadMaterial(material, forceLoading = false) {\n        let seg = material.segment;\n        if (this._isBaseLayer) {\n            material.texture = seg.getDefaultTexture();\n        }\n        else {\n            material.texture = seg.planet.transparentTexture;\n        }\n        // Q: Maybe we should change \"<2\" to material.segment.tileZoom < (material.layer.minZoom + 1)\n        if (this._planet.layerLock.isFree() || material.segment.tileZoom < 2) {\n            material.isReady = false;\n            material.isLoading = true;\n            if (this._checkSegment(seg)) {\n                material.loadingAttempts++;\n                this._planet._tileLoader.load({\n                    sender: this,\n                    src: this._getHTTPRequestString(material.segment),\n                    type: \"imageBitmap\",\n                    filter: () => (seg.initialized && seg.node.getState() === RENDERING) || forceLoading,\n                    options: {}\n                }, (response) => {\n                    if (response.status === \"ready\") {\n                        if (material.isLoading) {\n                            let e = this.events.load;\n                            if (e.handlers.length) {\n                                this.events.dispatch(e, material);\n                            }\n                            material.applyImage(response.data);\n                            response.data = null;\n                        }\n                    }\n                    else if (response.status === \"abort\") {\n                        material.isLoading = false;\n                    }\n                    else if (response.status === \"error\") {\n                        if (material.isLoading) {\n                            material.textureNotExists();\n                        }\n                    }\n                }\n                //,this.__id\n                );\n            }\n            else {\n                material.textureNotExists();\n            }\n        }\n    }\n    /**\n     * Creates query url.\n     * @protected\n     * @virtual\n     * @param {Segment} segment - Creates specific url for current segment.\n     * @returns {string} - Returns url string.\n     */\n    _createUrl(segment) {\n        return stringTemplate(this.url, {\n            s: this._getSubdomain(),\n            x: segment.tileX.toString(),\n            y: segment.tileY.toString(),\n            z: segment.tileZoom.toString()\n        });\n    }\n    _getSubdomain() {\n        this._requestCount++;\n        return this._s[Math.floor(this._requestCount % (this._requestsPeerSubdomains * this._s.length) / this._requestsPeerSubdomains)];\n    }\n    /**\n     * Returns actual url query string.\n     * @protected\n     * @param {Segment} segment - Segment that loads image data.\n     * @returns {string} - Url string.\n     */\n    _getHTTPRequestString(segment) {\n        return this._urlRewriteCallback ? this._urlRewriteCallback(segment, this.url) : this._createUrl(segment);\n    }\n    /**\n     * Sets url rewrite callback, used for custom url rewriting for every tile loading.\n     * @public\n     * @param {Function} ur - The callback that returns tile custom created url.\n     */\n    setUrlRewriteCallback(ur) {\n        this._urlRewriteCallback = ur;\n    }\n    applyMaterial(material, forceLoading = false) {\n        if (material.isReady) {\n            return material.texOffset;\n        }\n        else if (material.segment.tileZoom < this.minNativeZoom) {\n            material.textureNotExists();\n        }\n        else {\n            let segment = material.segment, pn = segment.node, notEmpty = false;\n            let mId = this.__id;\n            let psegm = material;\n            while (pn.parentNode) {\n                pn = pn.parentNode;\n                psegm = pn.segment.materials[mId];\n                if (psegm && psegm.textureExists) {\n                    notEmpty = true;\n                    break;\n                }\n            }\n            if (segment.passReady) {\n                let maxNativeZoom = material.layer.maxNativeZoom;\n                if (pn.segment.tileZoom === maxNativeZoom) {\n                    material.textureNotExists();\n                }\n                else if (material.segment.tileZoom <= maxNativeZoom) {\n                    !material.isLoading && !material.isReady && this.loadMaterial(material, forceLoading);\n                }\n                else {\n                    let pn = segment.node;\n                    while (pn.segment.tileZoom > material.layer.maxNativeZoom) {\n                        pn = pn.parentNode;\n                    }\n                    let pnm = pn.segment.materials[material.layer.__id];\n                    if (pnm) {\n                        !pnm.isLoading && !pnm.isReady && this.loadMaterial(pnm, true);\n                    }\n                    else {\n                        pnm = pn.segment.materials[material.layer.__id] = material.layer.createMaterial(pn.segment);\n                        this.loadMaterial(pnm, true);\n                    }\n                }\n            }\n            if (notEmpty) {\n                material.appliedNode = pn;\n                material.appliedNodeId = pn.nodeId;\n                material.texture = psegm.texture;\n                let dZ2 = 1.0 / (2 << (segment.tileZoom - pn.segment.tileZoom - 1));\n                material.texOffset[0] = segment.tileX * dZ2 - pn.segment.tileX;\n                material.texOffset[1] = segment.tileY * dZ2 - pn.segment.tileY;\n                material.texOffset[2] = dZ2;\n                material.texOffset[3] = dZ2;\n            }\n            else {\n                material.texture = segment.planet.transparentTexture;\n                material.texOffset[0] = 0.0;\n                material.texOffset[1] = 0.0;\n                material.texOffset[2] = 1.0;\n                material.texOffset[3] = 1.0;\n            }\n        }\n        return material.texOffset;\n    }\n    clearMaterial(material) {\n        if (material.isReady && material.textureExists) {\n            !material.texture.default && material.segment.handler.gl.deleteTexture(material.texture);\n            material.texture = null;\n        }\n        material.isReady = false;\n        material.textureExists = false;\n        material.isLoading = false;\n    }\n    /**\n     * @protected\n     */\n    _correctFullExtent() {\n        let e = this._extent, em = this._extentMerc;\n        let ENLARGE_MERCATOR_LON = mercator.POLE + 50000;\n        let ENLARGE_MERCATOR_LAT = mercator.POLE + 50000;\n        if (e.northEast.lat === 90.0) {\n            em.northEast.lat = ENLARGE_MERCATOR_LAT;\n        }\n        if (e.northEast.lon === 180.0) {\n            em.northEast.lon = ENLARGE_MERCATOR_LON;\n        }\n        if (e.southWest.lat === -90.0) {\n            em.southWest.lat = -ENLARGE_MERCATOR_LAT;\n        }\n        if (e.southWest.lon === -180.0) {\n            em.southWest.lon = -ENLARGE_MERCATOR_LON;\n        }\n        if (e.northEast.lat >= mercator.MAX_LAT) {\n            e.northEast.lat = mercator.MAX_LAT;\n        }\n        if (e.northEast.lat <= mercator.MIN_LAT) {\n            e.northEast.lat = mercator.MIN_LAT;\n        }\n    }\n}\nconst XYZ_EVENTS = [\n    /**\n     * Triggered when current tile image has loaded before rendering.\n     * @event #load\n     */\n    \"load\",\n    /**\n     * Triggered when all tiles have loaded or loading has stopped.\n     * @event #loadend\n     */\n    \"loadend\"\n];\n//# sourceMappingURL=XYZ.js.map","import * as mercator from \"../mercator\";\nimport { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { XYZ } from \"./XYZ\";\n/**\n * Used to display WMS services as tile layers on the globe.\n * @class\n * @extends {XYZ}\n * @param {string} name - Layer name.\n * @param {Object} options - Options:\n * @param {number} [options.opacity=1.0] - Layer opacity.\n * @param {number} [options.minZoom=0] - Minimal visibility zoom level.\n * @param {number} [options.maxZoom=0] - Maximal visibility zoom level.\n * @param {string} [options.attribution] - Layer attribution that displayed in the attribution area on the screen.\n * @param {boolean} [options.isBaseLayer=false] - Base layer flag.\n * @param {boolean} [options.visibility=true] - Layer visibility.\n * @param {string} options.url - WMS url source.\n * @param {number} [options.width=256] - Tile width.\n * @param {number} [options.height=256] - Tile height.\n * @param {string} options.layers - WMS layers string.\n * @param {string} [options.version=\"1.1.1\"] - WMS version.\n * @param {Object} extra  - Extra parameters (by WMS reference or by WMS service vendors) to pass to WMS service.\n * @example:\n * new og.layer.WMS(\"USA States\", {\n *     isBaseLayer: false,\n *     url: \"http://openglobus.org/geoserver/\",\n *     layers: \"topp:states\",\n *     opacity: 0.5,\n *     zIndex: 50,\n *     attribution: 'USA states - geoserver WMS example',\n *     version: \"1.1.1\",\n *     visibility: false }, {\n *     transparent: true,\n *     sld: \"style.sld\"}\n * );\n */\nclass WMS extends XYZ {\n    constructor(name, options) {\n        super(name, options);\n        this._extra = new URLSearchParams(options.extra).toString();\n        if (!options.extent) {\n            this.setExtent(new Extent(new LonLat(-180.0, -90), new LonLat(180.0, 90)));\n        }\n        this.layers = options.layers;\n        /**\n         * WMS tile width.\n         * @public\n         * @type {number}\n         */\n        this.imageWidth = options.imageWidth || 256;\n        /**\n         * WMS tile height.\n         * @public\n         * @type {number}\n         */\n        this.imageHeight = options.imageHeight || 256;\n        this._getBbox = WMS.get_bbox_v1_1_1;\n        this._version = \"\";\n        this.setVersion(options.version);\n    }\n    static createRequestUrl(url, layers, format = \"image/png\", version = \"1.1.1\", request = \"GetMap\", srs, bbox, width = 256, height = 256, extra) {\n        return `${url}/?LAYERS=${layers}&FORMAT=${format}&SERVICE=WMS&VERSION=${version}&REQUEST=${request}&SRS=${srs}&BBOX=${bbox}&WIDTH=${width}&HEIGHT=${height}` + (extra ? `&${extra}` : \"\");\n    }\n    static get_bbox_v1_1_1(extent) {\n        return `${extent.getWest()},${extent.getSouth()},${extent.getEast()},${extent.getNorth()}`;\n    }\n    static get_bbox_v1_3_0(extent) {\n        return `${extent.getSouth()},${extent.getWest()},${extent.getNorth()},${extent.getEast()}`;\n    }\n    _checkSegment(segment) {\n        return true;\n    }\n    get instanceName() {\n        return \"WMS\";\n    }\n    _createUrl(segment) {\n        return WMS.createRequestUrl(this.url, this.layers, \"image/png\", this._version, \"GetMap\", segment._projection.code, this._getBbox(segment.getExtent()), this.imageWidth, this.imageHeight, this._extra);\n    }\n    setVersion(version) {\n        if (version) {\n            this._version = version;\n        }\n        else {\n            this._version = \"1.1.1\";\n        }\n        if (this._version === \"1.1.1\") {\n            this._getBbox = WMS.get_bbox_v1_1_1;\n        }\n        else if (version === \"1.3.0\") {\n            this._getBbox = WMS.get_bbox_v1_3_0;\n        }\n    }\n    _correctFullExtent() {\n        const e = this._extent;\n        const em = this._extentMerc;\n        const ENLARGE_MERCATOR_LON = mercator.POLE + 50000;\n        const ENLARGE_MERCATOR_LAT = mercator.POLE + 50000;\n        if (e.northEast.lat === 90.0) {\n            em.northEast.lat = ENLARGE_MERCATOR_LAT;\n        }\n        if (e.northEast.lon === 180.0) {\n            em.northEast.lon = ENLARGE_MERCATOR_LON;\n        }\n        if (e.southWest.lat === -90.0) {\n            em.southWest.lat = -ENLARGE_MERCATOR_LAT;\n        }\n        if (e.southWest.lon === -180.0) {\n            em.southWest.lon = -ENLARGE_MERCATOR_LON;\n        }\n    }\n}\nexport { WMS };\n//# sourceMappingURL=WMS.js.map","import { getTileExtent } from \"../mercator\";\nimport { GlobusTerrain } from \"./GlobusTerrain\";\nimport { Layer } from \"../layer/Layer\";\nimport { WMS } from \"../layer/WMS\";\nimport { isPowerOfTwo, nextHighestPowerOfTwo } from \"../math\";\nclass BilTerrain extends GlobusTerrain {\n    constructor(options = {}) {\n        super(\"BilTerrain\", options);\n        this.equalizeVertices = true;\n        this.equalizeNormals = true;\n        this.minZoom = options.minZoom || 2;\n        this.maxZoom = options.maxZoom || 14;\n        this.noDataValues = options.noDataValues || [-9999, 32767];\n        this.url = options.url || \"\";\n        this._format = \"application/bil16\";\n        this._layers = options.layers || \"\";\n        this._imageSize = options.imageSize || 256;\n        this.plainGridSize = options.plainGridSize != undefined\n            ? options.plainGridSize\n            : isPowerOfTwo(this._imageSize) ? this._imageSize / 2 : nextHighestPowerOfTwo(this._imageSize) / 2;\n        this._dataType = \"arrayBuffer\";\n    }\n    isBlur(segment) {\n        return segment.tileZoom >= 18;\n    }\n    _createUrl(segment) {\n        return WMS.createRequestUrl(this.url, this._layers, this._format, \"1.1.1\", \"GetMap\", segment._projection.code, WMS.get_bbox_v1_1_1(segment.getExtent()), this._imageSize, this._imageSize);\n    }\n    _createHeights(data, tileIndex, tileX, tileY, tileZoom, extent, preventChildren) {\n        let bil16 = new Int16Array(data);\n        //\n        //Non-power of two images\n        //\n        if (!isPowerOfTwo(this._imageSize)) {\n            let outCurrenElevations = new Float32Array(bil16.length);\n            //TODO: optimize\n            extractElevationTilesNonPowerOfTwo(bil16, outCurrenElevations);\n            return outCurrenElevations;\n        }\n        let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\n        let d = 4;\n        let outChildrenElevations = new Array(d);\n        for (let i = 0; i < d; i++) {\n            outChildrenElevations[i] = [];\n            for (let j = 0; j < d; j++) {\n                outChildrenElevations[i][j] = new Float32Array(elevationsSize);\n            }\n        }\n        let outCurrenElevations = new Float32Array(elevationsSize);\n        extractElevationTiles(bil16, this.noDataValues, outCurrenElevations, outChildrenElevations);\n        this._elevationCache[tileIndex] = {\n            heights: outCurrenElevations,\n            extent: extent\n        };\n        let dd = this._imageSize / this.plainGridSize;\n        for (let i = 0; i < dd; i++) {\n            for (let j = 0; j < dd; j++) {\n                let x = tileX * 2 + j, y = tileY * 2 + i, z = tileZoom + 1;\n                let tileIndex = Layer.getTileIndex(x, y, z);\n                this._elevationCache[tileIndex] = {\n                    heights: outChildrenElevations[i][j],\n                    extent: getTileExtent(x, y, z)\n                };\n            }\n        }\n        return outCurrenElevations;\n    }\n}\nfunction extractElevationTilesNonPowerOfTwo(data, outCurrenElevations) {\n    for (let i = 0, len = outCurrenElevations.length; i < len; i++) {\n        outCurrenElevations[i] = data[i];\n    }\n}\nfunction extractElevationTiles(data, noDataValues, outCurrenElevations, outChildrenElevations) {\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\n    let destSizeOne = destSize + 1;\n    let sourceSize = Math.sqrt(data.length);\n    let dt = sourceSize / destSize;\n    let rightHeight = 0, bottomHeight = 0;\n    for (let k = 0, currIndex = 0, sourceDataLength = data.length; k < sourceDataLength; k++) {\n        let height = data[k];\n        let isNoDataCurrent = BilTerrain.checkNoDataValue(noDataValues, height), isNoDataRight = false, isNoDataBottom = false;\n        let i = Math.floor(k / sourceSize), j = k % sourceSize;\n        let tileX = Math.floor(j / destSize), tileY = Math.floor(i / destSize);\n        let destArr = outChildrenElevations[tileY][tileX];\n        let ii = i % destSize, jj = j % destSize;\n        let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\n        destArr[destIndex] = height;\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\n            outCurrenElevations[currIndex++] = height;\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\n            //current tile\n            rightHeight = data[k];\n            isNoDataRight = BilTerrain.checkNoDataValue(noDataValues, rightHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight)) {\n                middleHeight = (height + rightHeight) * 0.5;\n            }\n            destIndex = (ii + tileY) * destSizeOne + jj + 1;\n            destArr[destIndex] = middleHeight;\n            if ((i + tileY) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next right tile\n            let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n        }\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            bottomHeight = data[k + sourceSize];\n            isNoDataBottom = BilTerrain.checkNoDataValue(noDataValues, bottomHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataBottom)) {\n                middleHeight = (height + bottomHeight) * 0.5;\n            }\n            destIndex = (ii + 1) * destSizeOne + jj + tileX;\n            destArr[destIndex] = middleHeight;\n            if ((j + tileX) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next bottom tile\n            let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n        }\n        if ((j + 1) % destSize === 0 &&\n            j !== sourceSize - 1 &&\n            (i + 1) % destSize === 0 &&\n            i !== sourceSize - 1) {\n            //current tile\n            let rightBottomHeight = data[k + sourceSize + 1];\n            let isNoDataRightBottom = BilTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\n                middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\n            }\n            destIndex = (ii + 1) * destSizeOne + (jj + 1);\n            destArr[destIndex] = middleHeight;\n            outCurrenElevations[currIndex++] = middleHeight;\n            //next right tile\n            let rightindex = (ii + 1) * destSizeOne;\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n            //next bottom tile\n            let bottomindex = destSize;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n            //next right bottom tile\n            let rightBottomindex = 0;\n            outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\n        }\n    }\n}\nexport { BilTerrain };\n//# sourceMappingURL=BilTerrain.js.map","import * as mercator from \"../mercator\";\nimport { getTileExtent } from \"../mercator\";\nimport { GlobusTerrain } from \"./GlobusTerrain\";\nimport { isPowerOfTwo } from \"../math\";\nimport { Layer } from \"../layer/Layer\";\n/**\n * The key doesn't work; just an example!\n */\nconst KEY = \"pk.eyJ1IjoiZm94bXVsZGVyODMiLCJhIjoiY2pqYmR3dG5oM2Z1bzNrczJqYm5pODhuNSJ9.Y4DRmEPhb-XSlCR9CAXACQ\";\nconst rgb2Height = (r, g, b) => {\n    return -10000 + 0.1 * (r * 256 * 256 + g * 256 + b);\n};\nclass MapboxTerrain extends GlobusTerrain {\n    constructor(name, options = {}) {\n        super(name || \"MapboxTerrain\", {\n            equalizeVertices: options.equalizeVertices != undefined ? options.equalizeVertices : true,\n            maxZoom: options.maxZoom || 17,\n            noDataValues: options.noDataValues || [-65537, -10000],\n            plainGridSize: options.plainGridSize || 128,\n            url: options.url != undefined\n                ? options.url\n                : `//api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.pngraw?access_token=${options.key || KEY}`,\n            gridSizeByZoom: options.gridSizeByZoom || [\n                64, 32, 16, 8, 8, 8, 8, 16, 16, 16, 16, 16, 32, 16, 32, 16, 32, 16, 32, 16, 8, 4\n            ],\n            ...options\n        });\n        this.equalizeNormals = options.equalizeNormals || false;\n        this._dataType = \"imageBitmap\";\n        this._imageSize = options.imageSize || 256;\n        this._ctx = this._createTemporalCanvas(this._imageSize);\n        this._imageDataCache = {};\n    }\n    isBlur(segment) {\n        return segment.tileZoom >= 16;\n    }\n    _createTemporalCanvas(size) {\n        let canvas = document.createElement(\"canvas\");\n        canvas.width = size;\n        canvas.height = size;\n        return canvas.getContext(\"2d\", {\n            willReadFrequently: true\n        });\n    }\n    _createHeights(data, tileIndex, tileX, tileY, tileZoom, extent, preventChildren) {\n        this._ctx.clearRect(0, 0, this._imageSize, this._imageSize);\n        this._ctx.drawImage(data, 0, 0);\n        let rgbaData = this._ctx.getImageData(0, 0, this._imageSize, this._imageSize).data;\n        const SIZE = data.width;\n        //\n        //Non-power of two images\n        //\n        if (!isPowerOfTwo(this._imageSize) && SIZE === this._imageSize) {\n            let outCurrenElevations = new Float32Array(SIZE * SIZE);\n            extractElevationTilesMapboxNonPowerOfTwo(rgbaData, outCurrenElevations, this._heightFactor);\n            return outCurrenElevations;\n        }\n        if (this._imageSize === this.plainGridSize) {\n            let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\n            let outCurrenElevations = new Float32Array(elevationsSize);\n            for (let k = 0, len = this._imageSize * this._imageSize; k < len; k++) {\n                let j = k % this._imageSize, i = Math.floor(k / this._imageSize);\n                let fromInd4 = k * 4;\n                let h = this._heightFactor * rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\n                outCurrenElevations[i * (this._imageSize + 1) + j] = h;\n            }\n            for (let i = 0, len = this._imageSize; i < len; i++) {\n                let j = this._imageSize - 1;\n                let fromInd4 = (i * this._imageSize + j) * 4;\n                let h = this._heightFactor * rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\n                outCurrenElevations[i * (this._imageSize + 1) + this._imageSize] = h;\n            }\n            for (let j = 0, len = this._imageSize; j < len; j++) {\n                let i = this._imageSize - 1;\n                let fromInd4 = (i * this._imageSize + j) * 4;\n                let h = this._heightFactor * rgb2Height(rgbaData[fromInd4], rgbaData[fromInd4 + 1], rgbaData[fromInd4 + 2]);\n                outCurrenElevations[this._imageSize * (this._imageSize + 1) + j] = h;\n            }\n            let h = this._heightFactor * rgb2Height(rgbaData[rgbaData.length - 4], rgbaData[rgbaData.length - 3], rgbaData[rgbaData.length - 2]);\n            outCurrenElevations[outCurrenElevations.length - 1] = h;\n            return outCurrenElevations;\n        }\n        //\n        // Power of two images\n        //\n        let elevationsSize = (this.plainGridSize + 1) * (this.plainGridSize + 1);\n        let d = SIZE / this.plainGridSize;\n        let outCurrenElevations = new Float32Array(elevationsSize);\n        let outChildrenElevations = new Array(d);\n        for (let i = 0; i < d; i++) {\n            outChildrenElevations[i] = [];\n            for (let j = 0; j < d; j++) {\n                outChildrenElevations[i][j] = new Float32Array(elevationsSize);\n            }\n        }\n        if (preventChildren) {\n            extractElevationTilesMapboxNoChildren(rgbaData, this._heightFactor, this.noDataValues, outCurrenElevations);\n        }\n        else {\n            extractElevationTilesMapbox(rgbaData, this._heightFactor, this.noDataValues, outCurrenElevations, outChildrenElevations);\n        }\n        this._elevationCache[tileIndex] = {\n            heights: outCurrenElevations,\n            extent: extent //segment.getExtent()\n        };\n        if (!preventChildren) {\n            for (let i = 0; i < d; i++) {\n                for (let j = 0; j < d; j++) {\n                    let x = tileX * 2 + j, y = tileY * 2 + i, z = tileZoom + 1;\n                    let tileIndex = Layer.getTileIndex(x, y, z);\n                    this._elevationCache[tileIndex] = {\n                        heights: outChildrenElevations[i][j],\n                        extent: getTileExtent(x, y, z)\n                    };\n                }\n            }\n        }\n        return outCurrenElevations;\n    }\n    getHeightAsync(lonLat, callback, zoom) {\n        if (!lonLat || lonLat.lat > mercator.MAX_LAT || lonLat.lat < mercator.MIN_LAT) {\n            callback(0);\n            return true;\n        }\n        let z = zoom || this.maxZoom, size = mercator.POLE2 / Math.pow(2, z), merc = mercator.forward(lonLat), x = Math.floor((mercator.POLE + merc.lon) / size), y = Math.floor((mercator.POLE - merc.lat) / size);\n        let tileIndex = Layer.getTileIndex(x, y, z), extent = mercator.getTileExtent(x, y, z);\n        let sizeImgW = extent.getWidth() / (this._imageSize - 1), sizeImgH = extent.getHeight() / (this._imageSize - 1);\n        let i = this._imageSize - Math.ceil((merc.lat - extent.southWest.lat) / sizeImgH) - 1, j = Math.floor((merc.lon - extent.southWest.lon) / sizeImgW);\n        let index = (i * this._imageSize + j) * 4;\n        if (this._imageDataCache[tileIndex]) {\n            let data = this._imageDataCache[tileIndex];\n            callback(this._heightFactor * rgb2Height(data[index], data[index + 1], data[index + 2]));\n            return true;\n        }\n        if (!this._fetchCache[tileIndex]) {\n            let url = this._buildURL(x, y, z);\n            this._fetchCache[tileIndex] = this._loader.fetch({\n                src: url,\n                type: this._dataType\n            });\n        }\n        this._fetchCache[tileIndex].then((response) => {\n            if (response.status === \"ready\") {\n                this._ctx.clearRect(0, 0, this._imageSize, this._imageSize);\n                this._ctx.drawImage(response.data, 0, 0);\n                let data = this._ctx.getImageData(0, 0, 256, 256).data;\n                this._imageDataCache[tileIndex] = data;\n                callback(this._heightFactor * rgb2Height(data[index], data[index + 1], data[index + 2]));\n            }\n            else if (response.status === \"error\") {\n                callback(0);\n            }\n            else {\n                //@ts-ignore\n                this._fetchCache[tileIndex] = null;\n                delete this._fetchCache[tileIndex];\n            }\n        });\n        return false;\n    }\n}\nfunction extractElevationTilesMapboxNonPowerOfTwo(rgbaData, outCurrenElevations, heightFactor = 1) {\n    for (let i = 0, len = outCurrenElevations.length; i < len; i++) {\n        let i4 = i * 4;\n        outCurrenElevations[i] = heightFactor * rgb2Height(rgbaData[i4], rgbaData[i4 + 1], rgbaData[i4 + 2]);\n    }\n}\nfunction extractElevationTilesMapbox(rgbaData, heightFactor, noDataValues, outCurrenElevations, outChildrenElevations) {\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\n    let destSizeOne = destSize + 1;\n    let sourceSize = Math.sqrt(rgbaData.length / 4);\n    let dt = sourceSize / destSize;\n    let rightHeight = 0, bottomHeight = 0, sourceSize4 = 0;\n    for (let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4; k < sourceDataLength; k++) {\n        let k4 = k * 4;\n        let height = heightFactor * rgb2Height(rgbaData[k4], rgbaData[k4 + 1], rgbaData[k4 + 2]);\n        let isNoDataCurrent = MapboxTerrain.checkNoDataValue(noDataValues, height), isNoDataRight = false, isNoDataBottom = false;\n        let i = Math.floor(k / sourceSize), j = k % sourceSize;\n        let tileX = Math.floor(j / destSize), tileY = Math.floor(i / destSize);\n        let destArr = outChildrenElevations[tileY][tileX];\n        let ii = i % destSize, jj = j % destSize;\n        let destIndex = (ii + tileY) * destSizeOne + jj + tileX;\n        destArr[destIndex] = height;\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\n            outCurrenElevations[currIndex++] = height;\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\n            //current tile\n            rightHeight = heightFactor * rgb2Height(rgbaData[k4 + 4], rgbaData[k4 + 5], rgbaData[k4 + 6]);\n            isNoDataRight = MapboxTerrain.checkNoDataValue(noDataValues, rightHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight)) {\n                middleHeight = (height + rightHeight) * 0.5;\n            }\n            destIndex = (ii + tileY) * destSizeOne + jj + 1;\n            destArr[destIndex] = middleHeight;\n            if ((i + tileY) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next right tile\n            let rightindex = (ii + tileY) * destSizeOne + ((jj + 1) % destSize);\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n        }\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            sourceSize4 = sourceSize * 4;\n            bottomHeight = heightFactor * rgb2Height(rgbaData[k4 + sourceSize4], rgbaData[k4 + sourceSize4 + 1], rgbaData[k4 + sourceSize4 + 2]);\n            isNoDataBottom = MapboxTerrain.checkNoDataValue(noDataValues, bottomHeight);\n            let middleHeight = (height + bottomHeight) * 0.5;\n            if (!(isNoDataCurrent || isNoDataBottom)) {\n                middleHeight = (height + bottomHeight) * 0.5;\n            }\n            destIndex = (ii + 1) * destSizeOne + jj + tileX;\n            destArr[destIndex] = middleHeight;\n            if ((j + tileX) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n            //next bottom tile\n            let bottomindex = ((ii + 1) % destSize) * destSizeOne + jj + tileX;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1 &&\n            (i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            let rightBottomHeight = heightFactor * rgb2Height(rgbaData[k4 + sourceSize4 + 4], rgbaData[k4 + sourceSize4 + 5], rgbaData[k4 + sourceSize4 + 6]);\n            let isNoDataRightBottom = MapboxTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\n                middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\n            }\n            destIndex = (ii + 1) * destSizeOne + (jj + 1);\n            destArr[destIndex] = middleHeight;\n            outCurrenElevations[currIndex++] = middleHeight;\n            //next right tile\n            let rightindex = (ii + 1) * destSizeOne;\n            outChildrenElevations[tileY][tileX + 1][rightindex] = middleHeight;\n            //next bottom tile\n            let bottomindex = destSize;\n            outChildrenElevations[tileY + 1][tileX][bottomindex] = middleHeight;\n            //next right bottom tile\n            let rightBottomindex = 0;\n            outChildrenElevations[tileY + 1][tileX + 1][rightBottomindex] = middleHeight;\n        }\n    }\n}\nfunction extractElevationTilesMapboxNoChildren(rgbaData, heightFactor, noDataValues, outCurrenElevations) {\n    let destSize = Math.sqrt(outCurrenElevations.length) - 1;\n    let sourceSize = Math.sqrt(rgbaData.length / 4);\n    let dt = sourceSize / destSize;\n    let rightHeight = 0, bottomHeight = 0, sourceSize4 = 0;\n    for (let k = 0, currIndex = 0, sourceDataLength = rgbaData.length / 4; k < sourceDataLength; k++) {\n        let k4 = k * 4;\n        let height = heightFactor * rgb2Height(rgbaData[k4], rgbaData[k4 + 1], rgbaData[k4 + 2]);\n        let isNoDataCurrent = MapboxTerrain.checkNoDataValue(noDataValues, height), isNoDataRight = false, isNoDataBottom = false;\n        let i = Math.floor(k / sourceSize), j = k % sourceSize;\n        let tileX = Math.floor(j / destSize), tileY = Math.floor(i / destSize);\n        if ((i + tileY) % dt === 0 && (j + tileX) % dt === 0) {\n            outCurrenElevations[currIndex++] = height;\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1) {\n            //current tile\n            rightHeight = heightFactor * rgb2Height(rgbaData[k4 + 4], rgbaData[k4 + 5], rgbaData[k4 + 6]);\n            isNoDataRight = MapboxTerrain.checkNoDataValue(noDataValues, rightHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight)) {\n                middleHeight = (height + rightHeight) * 0.5;\n            }\n            if ((i + tileY) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n        }\n        if ((i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            sourceSize4 = sourceSize * 4;\n            bottomHeight = heightFactor * rgb2Height(rgbaData[k4 + sourceSize4], rgbaData[k4 + sourceSize4 + 1], rgbaData[k4 + sourceSize4 + 2]);\n            isNoDataBottom = MapboxTerrain.checkNoDataValue(noDataValues, bottomHeight);\n            let middleHeight = (height + bottomHeight) * 0.5;\n            if (!(isNoDataCurrent || isNoDataBottom)) {\n                middleHeight = (height + bottomHeight) * 0.5;\n            }\n            if ((j + tileX) % dt === 0) {\n                outCurrenElevations[currIndex++] = middleHeight;\n            }\n        }\n        if ((j + 1) % destSize === 0 && j !== sourceSize - 1 &&\n            (i + 1) % destSize === 0 && i !== sourceSize - 1) {\n            //current tile\n            let rightBottomHeight = heightFactor * rgb2Height(rgbaData[k4 + sourceSize4 + 4], rgbaData[k4 + sourceSize4 + 5], rgbaData[k4 + sourceSize4 + 6]);\n            let isNoDataRightBottom = MapboxTerrain.checkNoDataValue(noDataValues, rightBottomHeight);\n            let middleHeight = height;\n            if (!(isNoDataCurrent || isNoDataRight || isNoDataBottom || isNoDataRightBottom)) {\n                middleHeight = (height + rightHeight + bottomHeight + rightBottomHeight) * 0.25;\n            }\n            outCurrenElevations[currIndex++] = middleHeight;\n        }\n    }\n}\nexport { MapboxTerrain };\n//# sourceMappingURL=MapboxTerrain.js.map","import { nextHighestPowerOfTwo } from \"../math\";\nimport { BaseGeoImage } from \"./BaseGeoImage\";\nimport { isImageLoaded } from \"../utils/shared\";\n/**\n * Used to load and display a single image over specific corner coordinates on the globe.\n * @class\n * @extends {BaseGeoImage}\n */\nclass GeoImage extends BaseGeoImage {\n    constructor(name, options = {}) {\n        super(name, options);\n        this._image = options.image || null;\n        this._src = options.src || null;\n        this._onLoad_ = null;\n    }\n    get instanceName() {\n        return \"GeoImage\";\n    }\n    abortLoading() {\n        if (this._image instanceof HTMLImageElement) {\n            this._image.src = \"\";\n        }\n    }\n    /**\n     * Sets image source url path.\n     * @public\n     * @param {string} srs - Image url path.\n     */\n    setSrc(src) {\n        this._planet && this._planet._geoImageCreator.remove(this);\n        this._src = src;\n        this._sourceReady = false;\n        this._sourceCreated = false;\n        this._image = new Image();\n        this._image.crossOrigin = \"Anonymous\";\n        this._onLoad_ = this._onLoad.bind(this);\n        this._image.addEventListener(\"load\", this._onLoad_);\n        this._image.src = src;\n    }\n    /**\n     * Sets image object.\n     * @public\n     * @param {Image} image - Image object.\n     */\n    setImage(image) {\n        this._planet && this._planet._geoImageCreator.remove(this);\n        this._sourceCreated = false;\n        this._sourceReady = false;\n        this._image = image;\n        this._image.crossOrigin = \"Anonymous\";\n        this._src = image.src;\n        if (isImageLoaded(this._image)) {\n            this._applyImage(this._image);\n        }\n        else {\n            this._onLoad_ = this._onLoad.bind(this);\n            this._image.addEventListener(\"load\", this._onLoad_);\n        }\n    }\n    /**\n     * Creates source gl texture.\n     * @virtual\n     * @protected\n     */\n    _createSourceTexture() {\n        if (!this._sourceCreated && this._image) {\n            this._sourceTexture = this._planet.renderer.handler.createTexture_l(this._image);\n            this._sourceCreated = true;\n        }\n    }\n    _onLoad(ev) {\n        this._applyImage(this._image);\n        if (this._image instanceof HTMLImageElement) {\n            this._image.removeEventListener(\"load\", this._onLoad_);\n        }\n        this._onLoad_ = null;\n    }\n    _applyImage(img) {\n        if (img) {\n            this._frameWidth = nextHighestPowerOfTwo(img.width * 2, 4096);\n            this._frameHeight = nextHighestPowerOfTwo(img.height * 3, 4096);\n            this._sourceReady = true;\n            if (this._planet) {\n                this._planet._geoImageCreator.add(this);\n            }\n        }\n    }\n    /**\n     * Loads planet segment material. In this case - GeoImage source image.\n     * @public\n     * @param {Material} material - GeoImage planet material.\n     */\n    loadMaterial(material) {\n        material.isLoading = true;\n        this._creationProceeding = true;\n        if (!this._sourceReady && this._src) {\n            if (this._image) {\n                if (this._image instanceof HTMLImageElement) {\n                    if (isImageLoaded(this._image)) {\n                        this._applyImage(this._image);\n                    }\n                    else {\n                        this._onLoad_ = this._onLoad.bind(this);\n                        this._image.addEventListener(\"load\", this._onLoad_);\n                    }\n                }\n            }\n            else {\n                this._image = new Image();\n                this._image.crossOrigin = \"Anonymous\";\n                this._onLoad_ = this._onLoad.bind(this);\n                this._image.addEventListener(\"load\", this._onLoad_);\n                this._image.src = this._src;\n            }\n        }\n        else if (this._planet) {\n            this._planet._geoImageCreator.add(this);\n        }\n    }\n    /**\n     * @public\n     * @param {Material} material - GeoImage material.\n     */\n    abortMaterialLoading(material) {\n        if (this._image && this._image instanceof HTMLImageElement) {\n            this._image.src = \"\";\n        }\n        this._creationProceeding = false;\n        material.isLoading = false;\n        material.isReady = false;\n    }\n}\nexport { GeoImage };\n//# sourceMappingURL=GeoImage.js.map","import { BaseGeoImage } from './BaseGeoImage';\nimport { nextHighestPowerOfTwo } from '../math';\nclass GeoTexture2d extends BaseGeoImage {\n    constructor(name, options = {}) {\n        super(name, options);\n        this._sourceTexture = options.texture || null;\n        if (options.texture) {\n            this._sourceReady = true;\n            this._sourceCreated = true;\n        }\n        this._frameWidth = options.frameWidth != undefined ? nextHighestPowerOfTwo(options.frameWidth) : 256;\n        this._frameHeight = options.frameHeight != undefined ? nextHighestPowerOfTwo(options.frameHeight) : 256;\n        this._animate = true;\n    }\n    get instanceName() {\n        return \"GeoTexture2d\";\n    }\n    loadMaterial(material) {\n        this._planet._geoImageCreator.add(this);\n    }\n    bindTexture(texture) {\n        this._sourceReady = true;\n        this._sourceCreated = true;\n        this._sourceTexture = texture;\n    }\n    setSize(width, height) {\n        this._frameWidth = width;\n        this._frameHeight = height;\n        this._frameCreated = false;\n    }\n    abortMaterialLoading(material) {\n        this._creationProceeding = false;\n        material.isLoading = false;\n        material.isReady = false;\n    }\n}\nexport { GeoTexture2d };\n//# sourceMappingURL=GeoTexture2d.js.map","import { BaseGeoImage } from \"./BaseGeoImage\";\n/**\n * Used to load and display a video stream by specific corners coordinates on the globe.\n * @class\n * @extends {BaseGeoImage}\n */\nclass GeoVideo extends BaseGeoImage {\n    constructor(name, options = {}) {\n        super(name, options);\n        this._animate = true;\n        this._video = options.videoElement || null;\n        this._src = options.src || null;\n    }\n    get instanceName() {\n        return \"GeoVideo\";\n    }\n    /**\n     * Sets video source url path.\n     * @public\n     * @param {string} src - Video url path.\n     */\n    setSrc(src) {\n        this._planet && this._planet._geoImageCreator.remove(this);\n        this._src = src;\n        this._sourceReady = false;\n    }\n    /**\n     * Sets HTML5 video object.\n     * @public\n     * @param {HTMLVideoElement} video - HTML5 video element object.\n     */\n    setVideoElement(video) {\n        this._planet && this._planet._geoImageCreator.remove(this);\n        this._video = video;\n        this._src = video.src;\n        this._sourceReady = false;\n    }\n    /**\n     * Sets layer visibility.\n     * @public\n     * @param {boolean} visibility - Layer visibility.\n     */\n    setVisibility(visibility) {\n        if (visibility != this._visibility) {\n            super.setVisibility(visibility);\n            if (this._planet) {\n                if (visibility) {\n                    this._sourceReady && this._planet._geoImageCreator.add(this);\n                    this._video && this._video.play();\n                }\n                else {\n                    this._sourceReady && this._planet._geoImageCreator.remove(this);\n                    this._video && this._video.pause();\n                }\n            }\n        }\n    }\n    /**\n     * Creates or refresh source video GL texture.\n     * @virtual\n     * @protected\n     */\n    _createSourceTexture() {\n        let gl = this._planet.renderer.handler.gl;\n        if (this._sourceCreated) {\n            gl.bindTexture(gl.TEXTURE_2D, this._sourceTexture);\n            gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, this._video);\n        }\n        else {\n            this._sourceTexture = this._planet.renderer.handler.createTexture_n_webgl1(this._video);\n            this._sourceCreated = true;\n        }\n    }\n    /**\n     * @private\n     */\n    _onCanPlay(video) {\n        this._frameWidth = video.videoWidth;\n        this._frameHeight = video.videoHeight;\n        video.width = video.videoWidth;\n        video.height = video.videoHeight;\n        video.play();\n        this._sourceReady = true;\n        this._planet._geoImageCreator.add(this);\n    }\n    _onError(video) {\n        let err = \"unknown error\";\n        switch (video.error.code) {\n            case 1:\n                err = \"video loading aborted\";\n                break;\n            case 2:\n                err = \"network loading error\";\n                break;\n            case 3:\n                err = \"video decoding failed / corrupted data or unsupported codec\";\n                break;\n            case 4:\n                err = \"video not supported\";\n                break;\n        }\n        console.warn(`Error: ${err} error-code=${video.error.code})`);\n    }\n    /**\n     * Loads planet segment material. In this case - GeoImage source video.\n     * @public\n     * @param {Material} material - GeoImage planet material.\n     */\n    loadMaterial(material) {\n        material.isLoading = true;\n        this._creationProceeding = true;\n        if (!this._sourceReady && this._src) {\n            if (this._video) {\n                if (this._video.readyState === this._video.HAVE_ENOUGH_DATA) {\n                    this._onCanPlay(this._video);\n                }\n                else if (this._video.src) {\n                    let that = this;\n                    this._video.addEventListener(\"canplay\", function (e) {\n                        that._onCanPlay(this);\n                    });\n                }\n            }\n            else {\n                this._video = document.createElement(\"video\");\n                this._video.crossOrigin = \"Anonymous\";\n                let that = this;\n                this._video.addEventListener(\"canplay\", function () {\n                    that._onCanPlay(this);\n                });\n                this._video.addEventListener(\"error\", function () {\n                    that._onError(this);\n                });\n            }\n            this._video.autoplay = true;\n            this._video.loop = true;\n            this._video.src = this._src;\n            this._video.muted = true;\n            this._video.setAttribute(\"playsinline\", \"true\");\n            this._video.setAttribute(\"webkit-playsinline\", \"true\");\n        }\n        else {\n            this._planet._geoImageCreator.add(this);\n        }\n    }\n    /**\n     * @virtual\n     * @param {Material} material - GeoImage material.\n     */\n    abortMaterialLoading(material) {\n        this._video && (this._video.src = \"\");\n        this._creationProceeding = false;\n        material.isLoading = false;\n        material.isReady = false;\n    }\n}\nexport { GeoVideo };\n//# sourceMappingURL=GeoVideo.js.map","import { Entity } from \"../entity/Entity\";\nimport { Extent } from \"../Extent\";\nimport { LonLat } from \"../LonLat\";\nimport { Vector } from \"./Vector\";\n/**\n * Layer to render KMLs files\n * @class\n * @extends {Vector}\n * @param {string} name\n * @param {*} [options]\n */\nexport class KML extends Vector {\n    constructor(name, options = {}) {\n        super(name, options);\n        this._billboard = options.billboard || {\n            src: \"https://openglobus.org/examples/billboards/carrot.png\"\n        };\n        this._color = options.color || \"#6689db\";\n    }\n    get instanceName() {\n        return \"KML\";\n    }\n    _extractCoordonatesFromKml(xmlDoc) {\n        const raw = Array.from(xmlDoc.getElementsByTagName(\"coordinates\"));\n        const rawText = raw.map(item => item.textContent.trim());\n        const coordinates = rawText.map(item => item\n            .replace(/\\n/g, \" \")\n            .replace(/\\t/g, \" \")\n            .replace(/ +/g, \" \")\n            .split(\" \")\n            .map((co) => co.split(\",\").map(parseFloat)));\n        return coordinates;\n    }\n    _AGBRtoRGBA(agbr) {\n        if (!agbr || agbr.length != 8)\n            return;\n        const a = parseInt(agbr.slice(0, 2), 16) / 255;\n        const b = parseInt(agbr.slice(2, 4), 16);\n        const g = parseInt(agbr.slice(4, 6), 16);\n        const r = parseInt(agbr.slice(6, 8), 16);\n        return `rgba(${r},${g},${b},${a})`;\n    }\n    /**\n     * @protected\n     returns array of longitude, latitude, altitude (altitude optional)\n     */\n    _parseKMLcoordinates(coords) {\n        const coordinates = coords.innerHTML.trim()\n            .replace(/\\n/g, ' ')\n            .replace(/\\t/g, ' ')\n            .replace(/ +/g, ' ')\n            .split(\" \")\n            .map((co) => co.split(\",\").map(parseFloat));\n        return coordinates;\n    }\n    _kmlPlacemarkToEntity(placemark, extent) {\n        if (!placemark)\n            return;\n        const nameTags = Array.from(placemark.getElementsByTagName(\"name\"));\n        const name = nameTags && nameTags.length > 0 ? nameTags[0].innerHTML.trim() : '';\n        const { iconHeading, iconURL, iconColor, lineWidth, lineColor } = this._extractStyle(placemark);\n        // TODO handle MultiGeometry\n        const lonLats = [];\n        for (const coord of placemark.getElementsByTagName(\"coordinates\")) {\n            const coordinates = this._parseKMLcoordinates(coord) || [[0, 0, 0]];\n            for (const lonlatalt of coordinates) {\n                const [lon, lat, alt] = lonlatalt;\n                lonLats.push(new LonLat(lon, lat, alt));\n                if (lon < extent.southWest.lon)\n                    extent.southWest.lon = lon;\n                if (lat < extent.southWest.lat)\n                    extent.southWest.lat = lat;\n                if (lon > extent.northEast.lon)\n                    extent.northEast.lon = lon;\n                if (lat > extent.northEast.lat)\n                    extent.northEast.lat = lat;\n            }\n        }\n        if (lonLats.length === 1) {\n            const hdgrad = iconHeading * 0.01745329; // radians\n            return new Entity({\n                name,\n                lonlat: lonLats[0],\n                billboard: {\n                    src: iconURL,\n                    size: [24, 24],\n                    color: iconColor,\n                    rotation: hdgrad\n                },\n                properties: {\n                    color: iconColor,\n                    heading: iconHeading\n                }\n            });\n        }\n        else {\n            return new Entity({\n                polyline: {\n                    pathLonLat: [lonLats],\n                    thickness: lineWidth,\n                    color: lineColor,\n                    isClosed: false\n                }\n            });\n        }\n    }\n    _extractStyle(placemark) {\n        let iconColor;\n        let iconHeading;\n        let iconURL;\n        let lineColor;\n        let lineWidth;\n        const style = placemark.getElementsByTagName(\"Style\")[0];\n        if (style) {\n            let iconstyle = style.getElementsByTagName(\"IconStyle\")[0];\n            if (iconstyle) {\n                let color = iconstyle.getElementsByTagName(\"color\")[0];\n                if (color)\n                    iconColor = this._AGBRtoRGBA(color.innerHTML.trim());\n                let heading = iconstyle.getElementsByTagName(\"heading\")[0];\n                if (heading) {\n                    const hdg = parseFloat(heading.innerHTML.trim());\n                    if (hdg >= 0 && hdg <= 360)\n                        iconHeading = hdg % 360;\n                }\n                let icon = iconstyle.getElementsByTagName(\"Icon\")[0];\n                if (icon) {\n                    let href = icon.getElementsByTagName(\"href\")[0];\n                    if (href) {\n                        iconURL = href.innerHTML.trim();\n                    }\n                }\n            }\n            let linestyle = style.getElementsByTagName(\"LineStyle\")[0];\n            if (linestyle) {\n                let color = linestyle.getElementsByTagName(\"color\")[0];\n                if (color)\n                    lineColor = this._AGBRtoRGBA(color.innerHTML.trim());\n                let width = linestyle.getElementsByTagName(\"width\")[0];\n                if (width !== undefined)\n                    lineWidth = parseFloat(width.innerHTML.trim());\n            }\n        }\n        if (!iconColor)\n            iconColor = \"#FFFFFF\";\n        if (!iconHeading)\n            iconHeading = 0;\n        if (!iconURL)\n            iconURL = \"https://openglobus.org/examples/billboards/carrot.png\";\n        if (!lineColor)\n            lineColor = \"#FFFFFF\";\n        if (!lineWidth)\n            lineWidth = 1;\n        return { iconHeading, iconURL, iconColor, lineWidth, lineColor };\n    }\n    _parseKML(xml, extent, entities) {\n        if (!entities)\n            entities = [];\n        if (xml.documentElement.nodeName !== \"kml\")\n            return entities;\n        for (const placemark of xml.getElementsByTagName(\"Placemark\")) {\n            const entity = this._kmlPlacemarkToEntity(placemark, extent);\n            if (entity)\n                entities.push(entity);\n        }\n        return entities;\n    }\n    _convertKMLintoEntities(xml) {\n        const extent = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\n        const entities = this._parseKML(xml, extent);\n        return { entities, extent };\n    }\n    /**\n     * Creates billboards or polylines from array of lonlat.\n     * @protected\n     * @param {Array} coordonates\n     * @param {string} color\n     * @returns {any}\n     */\n    _convertCoordonatesIntoEntities(coordinates, color, billboard) {\n        const extent = new Extent(new LonLat(180.0, 90.0), new LonLat(-180.0, -90.0));\n        const addToExtent = (c) => {\n            const lon = c[0], lat = c[1];\n            if (lon < extent.southWest.lon)\n                extent.southWest.lon = lon;\n            if (lat < extent.southWest.lat)\n                extent.southWest.lat = lat;\n            if (lon > extent.northEast.lon)\n                extent.northEast.lon = lon;\n            if (lat > extent.northEast.lat)\n                extent.northEast.lat = lat;\n        };\n        const _pathes = [];\n        coordinates.forEach((kmlFile) => kmlFile.forEach((p) => _pathes.push(p)));\n        const entities = _pathes.map((path) => {\n            if (path.length === 1) {\n                const lonlat = path[0];\n                const _entity = new Entity({ lonlat, billboard });\n                addToExtent(lonlat);\n                return _entity;\n            }\n            else if (path.length > 1) {\n                const pathLonLat = path.map((item) => {\n                    addToExtent(item);\n                    return new LonLat(item[0], item[1], item[2]);\n                });\n                const _entity = new Entity({\n                    polyline: { pathLonLat: [pathLonLat], thickness: 3, color, isClosed: false }\n                });\n                return _entity;\n            }\n        });\n        return { entities, extent };\n    }\n    /**\n     * @protected\n     * @returns {Document}\n     */\n    _getXmlContent(file) {\n        return new Promise((resolve) => {\n            const fileReader = new FileReader();\n            fileReader.onload = async (i) => resolve(new DOMParser().parseFromString(i.target.result, \"text/xml\"));\n            fileReader.readAsText(file);\n        });\n    }\n    _expandExtents(extent1, extent2) {\n        if (!extent1)\n            return extent2;\n        if (extent2.southWest.lon < extent1.southWest.lon)\n            extent1.southWest.lon = extent2.southWest.lon;\n        if (extent2.southWest.lat < extent1.southWest.lat)\n            extent1.southWest.lat = extent2.southWest.lat;\n        if (extent2.northEast.lon > extent1.northEast.lon)\n            extent1.northEast.lon = extent2.northEast.lon;\n        if (extent2.northEast.lat > extent1.northEast.lat)\n            extent1.northEast.lat = extent2.northEast.lat;\n        return extent1;\n    }\n    /**\n     * @public\n     * @param {File[]} kmls\n     * @param {string} [color]\n     * @param {Billboard} [billboard]\n     * @returns {Promise<{entities: Entity[], extent: Extent}>}\n     */\n    async addKmlFromFiles(kmls, color, billboard) {\n        if (!Array.isArray(kmls))\n            return null;\n        const kmlObjs = await Promise.all(kmls.map(this._getXmlContent));\n        const coordonates = kmlObjs.map(this._extractCoordonatesFromKml);\n        const { entities, extent } = this._convertCoordonatesIntoEntities(coordonates, color || this._color, billboard || this._billboard);\n        this._extent = this._expandExtents(this._extent, extent);\n        entities.forEach(this.add.bind(this));\n        return { entities, extent };\n    }\n    /**\n     * @param {string} color\n     * @public\n     */\n    setColor(color) {\n        this._color = color;\n        this._billboard.color = color;\n    }\n    _getKmlFromUrl(url) {\n        return new Promise((resolve, reject) => {\n            const request = new XMLHttpRequest();\n            request.open(\"GET\", url, true);\n            request.responseType = \"document\";\n            request.overrideMimeType(\"text/xml\");\n            request.onload = () => {\n                if (request.readyState === request.DONE && request.status === 200) {\n                    resolve(request.responseXML);\n                }\n                else {\n                    reject(new Error(\"no valid kml file\"));\n                }\n            };\n            request.send();\n        });\n    }\n    /**\n     * @public\n     * @param {string} url - Url of the KML to display. './myFile.kml' or 'http://mySite/myFile.kml' for example.\n     * @param {string} [color]\n     * @param {Billboard} [billboard]\n     * @returns {Promise<{entities: Entity[], extent: Extent}>}\n     */\n    async addKmlFromUrl(url, color, billboard) {\n        const kml = await this._getKmlFromUrl(url);\n        /*\n                const coordonates = this._extractCoordonatesFromKml(kml);\n                const { entities, extent } = this._convertCoordonatesIntoEntities(\n                    [coordonates],\n                    color || this._color,\n                    billboard || this._billboard\n                );\n        */\n        const { entities, extent } = this._convertKMLintoEntities(kml);\n        this._extent = this._expandExtents(this._extent, extent);\n        entities.forEach(this.add.bind(this));\n        return { entities, extent };\n    }\n}\n//# sourceMappingURL=KML.js.map","import * as jd from \"./astro/jd\";\nimport { createEvents } from \"./Events\";\nconst CLOCK_EVENTS = [\"tick\", \"end\", \"start\", \"stop\"];\n/**\n * Class represents application timer that stores custom current julian datetime, and time speed multiplier.\n * @class\n * @param {Object} [params] - Clock parameters:\n * @param {JulianDate} [params.startDate=0.0] - Julian start date.\n * @param {JulianDate} [params.endDate=0.0] - Julian end date.\n * @param {JulianDate} [params.currentDate] - Julian current date. Default: current date.\n * @param {number} [params.multiplier=1.0] - Time speed multiplier.\n */\nclass Clock {\n    constructor(params = {}) {\n        this.__handler = null;\n        /**\n         * Timer activity.\n         * @public\n         * @type {boolean}\n         */\n        this.active = true;\n        this.__id = Clock.__counter__++;\n        this.events = createEvents(CLOCK_EVENTS, this);\n        this.name = params.name || \"\";\n        this.startDate = params.startDate || 0;\n        this.endDate = params.endDate || 0;\n        let currentDate = params.currentDate || jd.DateToUTC(new Date());\n        if (params.startDate && currentDate < params.startDate) {\n            currentDate = params.startDate;\n        }\n        if (params.endDate && currentDate > params.endDate) {\n            currentDate = params.endDate;\n        }\n        this.currentDate = currentDate;\n        this._multiplier = params.multiplier !== undefined ? params.multiplier : 1.0;\n        this._running = 1;\n        this.deltaTicks = 0;\n        this.active = true;\n        this._intervalDelay = 0;\n        this._intervalStart = 0;\n        this._intervalCallback = null;\n    }\n    clearInterval() {\n        this._intervalDelay = 0;\n        this._intervalStart = 0;\n        this._intervalCallback = null;\n    }\n    setInterval(delay, callback) {\n        this._intervalStart = this.currentDate;\n        this._intervalDelay = delay * jd.ONE_BY_MILLISECONDS_PER_DAY;\n        this._intervalCallback = callback;\n    }\n    /**\n     * Sets current clock datetime.\n     * @public\n     * @param {Object} date - JavaScript Date object.\n     */\n    setDate(date) {\n        let d = jd.DateToUTC(date);\n        if (this.startDate && d < this.startDate) {\n            d = this.startDate;\n        }\n        if (this.endDate && d > this.endDate) {\n            d = this.endDate;\n        }\n        this.currentDate = d;\n    }\n    /**\n     * Returns current application date.\n     * @public\n     * @returns {Date} - Current date.\n     */\n    getDate() {\n        return jd.UTCtoDate(this.currentDate);\n    }\n    reset() {\n        if (this.startDate) {\n            this.currentDate = this.startDate;\n        }\n    }\n    tick(dt) {\n        let m = this._multiplier * this._running;\n        this.deltaTicks = dt * m;\n        if (this.active) {\n            let cd = jd.addMilliseconds(this.currentDate, this.deltaTicks);\n            if (m > 0) {\n                if (this.endDate && cd > this.endDate) {\n                    this.currentDate = this.startDate;\n                    this.events.dispatch(this.events.end, this);\n                }\n                else {\n                    this.currentDate = cd;\n                }\n            }\n            else {\n                if (this.startDate && cd < this.startDate) {\n                    this.currentDate = this.endDate;\n                    this.events.dispatch(this.events.end, this);\n                }\n                else {\n                    this.currentDate = cd;\n                }\n            }\n            if (this._intervalCallback) {\n                if (this.currentDate - this._intervalStart >= this._intervalDelay) {\n                    this._intervalStart = this.currentDate;\n                    this._intervalCallback(this);\n                }\n            }\n            this.events.dispatch(this.events.tick, this);\n        }\n    }\n    /**\n     * @public\n     * @param {Clock} clock - Clock instance to compare.\n     * @returns {boolean} - Returns true if a clock is the same instance.\n     */\n    isEqual(clock) {\n        return this.__id === clock.__id;\n    }\n    start() {\n        if (this._running === 0) {\n            this._running = 1;\n            this.events.dispatch(this.events.start, this);\n        }\n    }\n    get multiplier() {\n        return this._multiplier;\n    }\n    set multiplier(value) {\n        this._multiplier = value;\n    }\n    stop() {\n        if (this._running === 1) {\n            this._running = 0;\n            this.events.dispatch(this.events.stop, this);\n        }\n    }\n}\nClock.__counter__ = 0;\nexport { Clock };\n//# sourceMappingURL=Clock.js.map","/**\n * This is shader program controller that used by handler object to access the shader\n * program capabilities, like switching program during the rendering.\n * Get access to the program from ...handler.programs.<program name> etc.\n * @class\n * @param {Handler} handler - Handler.\n * @param {Program} program - Shader program.\n */\nexport class ProgramController {\n    constructor(handler, program) {\n        this._program = program;\n        this._handler = handler;\n        this._activated = false;\n    }\n    /**\n     * Lazy create program call.\n     * @public\n     */\n    initialize() {\n        if (this._handler.gl) {\n            this._program.createProgram(this._handler.gl);\n        }\n    }\n    /**\n     * Returns controller's shader program.\n     * @public\n     * @return {Program} -\n     */\n    getProgram() {\n        return this._program;\n    }\n    /**\n     * Activates current shader program.\n     * @public\n     * @returns {ProgramController} -\n     */\n    activate() {\n        if (!this._activated) {\n            this._handler.activeProgram.deactivate();\n            this._handler.activeProgram = this;\n            let p = this._program;\n            this._activated = true;\n            p.enableAttribArrays();\n            p.use();\n        }\n        return this;\n    }\n    /**\n     * Remove program from handler\n     * @public\n     */\n    remove() {\n        let p = this._handler.programs;\n        if (p[this._program.name]) {\n            if (this._activated) {\n                this.deactivate();\n            }\n            this._program.delete();\n            delete p[this._program.name];\n        }\n    }\n    /**\n     * Deactivate shader program. This is not necessary while activate function used.\n     * @public\n     */\n    deactivate() {\n        this._program.disableAttribArrays();\n        this._activated = false;\n    }\n    /**\n     * Returns program activity.\n     * @public\n     * @return {boolean} -\n     */\n    isActive() {\n        return this._activated;\n    }\n    /**\n     * Sets program uniforms and attributes values and return controller instance.\n     * @public\n     * @param {Record<string, any>} params - Object with variable name and value like { value: 12, someArray:[1,2,3], uSampler: texture,... }\n     * @return {ProgramController} -\n     */\n    set(params) {\n        this.activate();\n        this._program.set(params);\n        return this;\n    }\n    /**\n     * Draw index buffer with this program.\n     * @public\n     * @param {number} mode - Gl draw mode\n     * @param {WebGLBuffer} buffer - Buffer to draw.\n     * @return {ProgramController} Returns current shader controller instance.\n     */\n    drawIndexBuffer(mode, buffer) {\n        this._program.drawIndexBuffer(mode, buffer);\n        return this;\n    }\n    /**\n     * Calls Gl drawArray function.\n     * @param {number} mode - Gl draw mode.\n     * @param {number} numItems - draw items count.\n     * @return {ProgramController} Returns current shader controller instance.\n     */\n    drawArrays(mode, numItems) {\n        this._program.drawArrays(mode, numItems);\n        return this;\n    }\n}\n//# sourceMappingURL=ProgramController.js.map","class Node {\n    constructor() {\n        this.next = null;\n        this.prev = null;\n        this.data = null;\n    }\n}\n/**\n * @class Stack<T>\n * @param {number} [size=256] - Stack size\n */\nclass Stack {\n    constructor(size = 256) {\n        this._current = new Node();\n        this._head = this._current;\n        for (let i = 0; i < size; i++) {\n            let n = new Node();\n            n.prev = this._current;\n            this._current.next = n;\n            this._current = n;\n        }\n        this._current = this._head;\n    }\n    current() {\n        return this._current;\n    }\n    push(data) {\n        this._current = this._current.next;\n        this._current.data = data;\n    }\n    pop() {\n        let res = this._current.data;\n        //this._current.data = null;\n        this._current = this._current.prev;\n        return res;\n    }\n    popPrev() {\n        this._current = this._current.prev;\n        return this._current.data;\n    }\n}\nexport { Stack };\n//# sourceMappingURL=Stack.js.map","import { Clock } from \"../Clock\";\nimport { cons } from \"../cons\";\nimport { createEvents } from \"../Events\";\nimport { getUrlParam, isEmpty } from \"../utils/shared\";\nimport { ImageCanvas } from \"../ImageCanvas\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { ProgramController } from \"./ProgramController\";\nimport { Stack } from \"../Stack\";\nconst vendorPrefixes = [\"\", \"WEBKIT_\", \"MOZ_\"];\nconst CONTEXT_TYPE = [\"webgl2\", \"webgl\"];\n// Maximal mipmap levels\nconst MAX_LEVELS = 2;\n/**\n * A WebGL handler for accessing low-level WebGL capabilities.\n * @class\n * @param {string | HTMLCanvasElement} canvasTarget - Canvas element target.\n * or undefined creates hidden canvas and handler becomes hidden.\n * @param {Object} [params] - Handler options:\n * @param {number} [params.anisotropy] - Anisotropy filter degree. 8 is default.\n * @param {number} [params.width] - Hidden handler width. 256 is default.\n * @param {number} [params.height] - Hidden handler height. 256 is default.\n * @param {Array.<string>} [params.extensions] - Additional WebGL extension list. Available by default: EXT_texture_filter_anisotropic.\n */\nclass Handler {\n    constructor(canvasTarget, params = {}) {\n        this.framebufferStack = new Stack();\n        this._requestAnimationFrameId = 0;\n        this.events = createEvents([\"visibilitychange\", \"resize\"]);\n        this.defaultClock = new Clock();\n        this._clocks = [];\n        this.deltaTime = 0;\n        this.canvas = null;\n        this.gl = null;\n        this.programs = {};\n        this.activeProgram = null;\n        this._canvasSize = [0, 0];\n        this._params = {\n            anisotropy: params.anisotropy || 4,\n            width: params.width || 256,\n            height: params.height || 256,\n            pixelRatio: getUrlParam('og_dpi') || params.pixelRatio || 1.0,\n            extensions: params.extensions || [],\n            context: params.context || {}\n        };\n        this._oneByHeight = 1.0 / (this._params.height * this._params.pixelRatio);\n        this.extensions = {};\n        this._canvasTarget = canvasTarget;\n        this._lastAnimationFrameTime = 0;\n        this._initialized = false;\n        this._frameCallback = function () {\n        };\n        this.transparentTexture = null;\n        this.defaultTexture = null;\n        this.framebufferStack = new Stack();\n        this.createTexture_n = this.createTexture_n_webgl2.bind(this);\n        this.createTexture_l = this.createTexture_l_webgl2.bind(this);\n        this.createTexture_mm = this.createTexture_mm_webgl2.bind(this);\n        this.createTexture_a = this.createTexture_a_webgl2.bind(this);\n        this.createTexture = {\n            \"NEAREST\": this.createTexture_n,\n            \"LINEAR\": this.createTexture_l,\n            \"MIPMAP\": this.createTexture_mm,\n            \"ANISOTROPIC\": this.createTexture_a\n        };\n        this.createTextureDefault = this.createTexture_n;\n        this.ONCANVASRESIZE = null;\n        this._createCanvas();\n        if (params.autoActivate || isEmpty(params.autoActivate)) {\n            this.initialize();\n        }\n    }\n    isInitialized() {\n        return this._initialized;\n    }\n    _createCanvas() {\n        if (this._canvasTarget) {\n            if (this._canvasTarget instanceof HTMLElement) {\n                this.canvas = this._canvasTarget;\n            }\n            else {\n                this.canvas = (document.getElementById(this._canvasTarget) || document.querySelector(this._canvasTarget));\n            }\n        }\n        else {\n            this.canvas = document.createElement(\"canvas\");\n            this.canvas.width = this._params.width;\n            this.canvas.height = this._params.height;\n        }\n    }\n    /**\n     * The return value is null if the extension is not supported, or an extension object otherwise.\n     * @param {WebGLRenderingContext | WebGL2RenderingContext | null} gl - WebGl context pointer.\n     * @param {string} name - Extension name.\n     * @returns {any} -\n     */\n    static getExtension(gl, name) {\n        if (!gl)\n            return;\n        let i, ext;\n        for (i in vendorPrefixes) {\n            ext = gl.getExtension(vendorPrefixes[i] + name);\n            if (ext) {\n                return ext;\n            }\n        }\n    }\n    /**\n     * Returns a drawing context on the canvas, or null if the context identifier is not supported.\n     * @param {HTMLCanvasElement} canvas - HTML canvas object.\n     * @param {any} [contextAttributes] - See canvas.getContext contextAttributes.\n     * @returns {WebGLContextExt | null} -\n     */\n    static getContext(canvas, contextAttributes) {\n        let ctx = null;\n        try {\n            let urlParams = new URLSearchParams(location.search);\n            let ver = urlParams.get('og_ver');\n            if (ver) {\n                ctx = canvas.getContext(ver, contextAttributes);\n                if (ctx) {\n                    ctx.type = ver;\n                }\n            }\n            else {\n                for (let i = 0; i < CONTEXT_TYPE.length; i++) {\n                    ctx = canvas.getContext(CONTEXT_TYPE[i], contextAttributes);\n                    if (ctx) {\n                        ctx.type = CONTEXT_TYPE[i];\n                        break;\n                    }\n                }\n            }\n        }\n        catch (ex) {\n            cons.logErr(\"exception during the GL context initialization\");\n        }\n        if (!ctx) {\n            cons.logErr(\"could not initialise WebGL\");\n        }\n        return ctx;\n    }\n    /**\n     * Sets animation frame function.\n     * @public\n     * @param {Function} callback - Frame callback.\n     */\n    setFrameCallback(callback) {\n        callback && (this._frameCallback = callback);\n    }\n    /**\n     * Creates empty texture.\n     * @public\n     * @param {number} [width=1] - Specifies the width of the texture image.\n     * @param {number} [height=1] - Specifies the width of the texture image.\n     * @param {string} [filter=\"NEAREST\"] - Specifies GL_TEXTURE_MIN(MAX)_FILTER texture value.\n     * @param {string} [internalFormat=\"RGBA\"] - Specifies the color components in the texture.\n     * @param {string} [format=\"RGBA\"] - Specifies the format of the texel data.\n     * @param {string} [type=\"UNSIGNED_BYTE\"] - Specifies the data type of the texel data.\n     * @param {number} [level=0] - Specifies the level-of-detail number. Level 0 is the base image level. Level n is the nth mipmap reduction image.\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createEmptyTexture2DExt(width = 1, height = 1, filter = \"NEAREST\", internalFormat = \"RGBA\", format = \"RGBA\", type = \"UNSIGNED_BYTE\", level = 0) {\n        let gl = this.gl;\n        let texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, level, gl[internalFormat.toUpperCase()], width, height, 0, gl[format.toUpperCase()], gl[type.toUpperCase()], null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl[filter.toUpperCase()]);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl[filter.toUpperCase()]);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates Empty NEAREST filtered texture.\n     * @public\n     * @param {number} width - Empty texture width.\n     * @param {number} height - Empty texture height.\n     * @param {number} [internalFormat]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createEmptyTexture_n(width, height, internalFormat) {\n        let gl = this.gl;\n        let texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates empty LINEAR filtered texture.\n     * @public\n     * @param {number} width - Empty texture width.\n     * @param {number} height - Empty texture height.\n     * @param {number} [internalFormat]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createEmptyTexture_l(width, height, internalFormat) {\n        let gl = this.gl;\n        let texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, width, height, 0, gl.RGBA, gl.UNSIGNED_BYTE, null);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates NEAREST filter texture.\n     * @public\n     * @param {HTMLCanvasElement | Image} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture=null]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_n_webgl1(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates LINEAR filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_l_webgl1(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates MIPMAP filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_mm_webgl1(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates ANISOTROPY filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_a_webgl1(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        gl.texImage2D(gl.TEXTURE_2D, 0, internalFormat || gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n        gl.texParameterf(gl.TEXTURE_2D, this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, this._params.anisotropy);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates NEAREST filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_n_webgl2(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n        gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat || gl.RGBA8, image.width, image.height);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates LINEAR filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_l_webgl2(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n        gl.texStorage2D(gl.TEXTURE_2D, 1, internalFormat || gl.RGBA8, image.width, image.height);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates MIPMAP filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_mm_webgl2(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n        gl.texStorage2D(gl.TEXTURE_2D, MAX_LEVELS, internalFormat || gl.RGBA8, image.width, image.height);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates ANISOTROPY filter texture.\n     * @public\n     * @param {ImageSource} image - Image or Canvas object.\n     * @param {number} [internalFormat]\n     * @param {WebGLTexture | null} [texture]\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    createTexture_a_webgl2(image, internalFormat, texture = null) {\n        let gl = this.gl;\n        texture = texture || gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_2D, texture);\n        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n        //gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL, true);\n        gl.texStorage2D(gl.TEXTURE_2D, MAX_LEVELS, internalFormat || gl.RGBA8, image.width, image.height);\n        gl.texSubImage2D(gl.TEXTURE_2D, 0, 0, 0, image.width, image.height, gl.RGBA, gl.UNSIGNED_BYTE, image);\n        gl.generateMipmap(gl.TEXTURE_2D);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR_MIPMAP_LINEAR);\n        gl.texParameterf(gl.TEXTURE_2D, this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT, this._params.anisotropy);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.bindTexture(gl.TEXTURE_2D, null);\n        return texture;\n    }\n    /**\n     * Creates cube texture.\n     * @public\n     * @param {Texture3DParams} params - Face image urls:\n     * @param {string} params.px - Positive X or right image url.\n     * @param {string} params.nx - Negative X or left image url.\n     * @param {string} params.py - Positive Y or up image url.\n     * @param {string} params.ny - Negative Y or bottom image url.\n     * @param {string} params.pz - Positive Z or face image url.\n     * @param {string} params.nz - Negative Z or back image url.\n     * @returns {WebGLTexture | null} - WebGL texture object.\n     */\n    loadCubeMapTexture(params) {\n        let gl = this.gl;\n        let texture = gl.createTexture();\n        gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n        gl.texParameteri(gl.TEXTURE_CUBE_MAP, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n        let faces = [\n            [params.px, gl.TEXTURE_CUBE_MAP_POSITIVE_X],\n            [params.nx, gl.TEXTURE_CUBE_MAP_NEGATIVE_X],\n            [params.py, gl.TEXTURE_CUBE_MAP_POSITIVE_Y],\n            [params.ny, gl.TEXTURE_CUBE_MAP_NEGATIVE_Y],\n            [params.pz, gl.TEXTURE_CUBE_MAP_POSITIVE_Z],\n            [params.nz, gl.TEXTURE_CUBE_MAP_NEGATIVE_Z]\n        ];\n        let imageCanvas = new ImageCanvas();\n        imageCanvas.fillEmpty();\n        let emptyImage = imageCanvas.getImage();\n        for (let i = 0; i < faces.length; i++) {\n            let face = faces[i][1];\n            gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\n            //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n            gl.texImage2D(face, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, emptyImage);\n        }\n        for (let i = 0; i < faces.length; i++) {\n            let face = faces[i][1];\n            let image = new Image();\n            image.crossOrigin = \"\";\n            image.onload = (function (texture, face, image) {\n                return function () {\n                    if (gl && texture) {\n                        gl.bindTexture(gl.TEXTURE_CUBE_MAP, texture);\n                        //gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, false);\n                        gl.texImage2D(face, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);\n                    }\n                };\n            })(texture, face, image);\n            image.src = faces[i][0];\n        }\n        return texture;\n    }\n    /**\n     * Adds shader program to the handler.\n     * @public\n     * @param {Program} program - Shader program.\n     * @param {boolean} [notActivate] - If it's true program will not compile.\n     * @return {Program} -\n     */\n    addProgram(program, notActivate = false) {\n        if (!this.programs[program.name]) {\n            let sc = new ProgramController(this, program);\n            this.programs[program.name] = sc;\n            this._initProgramController(sc);\n            if (notActivate) {\n                sc._activated = false;\n            }\n        }\n        else {\n            console.warn(`Shader program: \"${program.name}\" already exists.`);\n        }\n        return program;\n    }\n    /**\n     * Removes shader program from handler.\n     * @public\n     * @param {string} name - Shader program name.\n     */\n    removeProgram(name) {\n        this.programs[name] && this.programs[name].remove();\n    }\n    /**\n     * Adds shader programs to the handler.\n     * @public\n     * @param {Array.<Program>} programsArr - Shader program array.\n     */\n    addPrograms(programsArr) {\n        for (let i = 0; i < programsArr.length; i++) {\n            this.addProgram(programsArr[i]);\n        }\n    }\n    /**\n     * Used in addProgram\n     * @protected\n     * @param {ProgramController} sc - Program controller\n     */\n    _initProgramController(sc) {\n        if (this._initialized) {\n            sc.initialize();\n            if (!this.activeProgram) {\n                this.activeProgram = sc;\n                sc.activate();\n            }\n            else {\n                sc.deactivate();\n                this.activeProgram._program.enableAttribArrays();\n                this.activeProgram._program.use();\n            }\n        }\n    }\n    /**\n     * Used in init function.\n     * @private\n     */\n    _initPrograms() {\n        for (let p in this.programs) {\n            this._initProgramController(this.programs[p]);\n        }\n    }\n    /**\n     * Initialize additional WebGL extensions.\n     * @public\n     * @param {string} extensionStr - Extension name.\n     * @param {boolean} showLog - Show logging.\n     * @return {any} -\n     */\n    initializeExtension(extensionStr, showLog = false) {\n        if (!(this.extensions && this.extensions[extensionStr])) {\n            let ext = Handler.getExtension(this.gl, extensionStr);\n            if (ext) {\n                this.extensions[extensionStr] = ext;\n            }\n            else if (showLog) {\n                console.warn(\"og.webgl.Handler: extension '\" + extensionStr + \"' doesn't initialize.\");\n            }\n        }\n        return this.extensions && this.extensions[extensionStr];\n    }\n    /**\n     * Main function that initialize handler.\n     * @public\n     */\n    initialize() {\n        if (this._initialized)\n            return;\n        if (!this.canvas)\n            return;\n        this.gl = Handler.getContext(this.canvas, this._params.context);\n        if (!this.gl)\n            return;\n        this._initialized = true;\n        /** Sets default extensions */\n        this._params.extensions.push(\"EXT_texture_filter_anisotropic\");\n        if (this.gl.type === \"webgl\") {\n            this._params.extensions.push(\"OES_standard_derivatives\");\n            this._params.extensions.push(\"OES_element_index_uint\");\n            this._params.extensions.push(\"WEBGL_depth_texture\");\n            this._params.extensions.push(\"ANGLE_instanced_arrays\");\n            //this._params.extensions.push(\"WEBGL_draw_buffers\");\n            //this._params.extensions.push(\"EXT_frag_depth\");\n        }\n        else {\n            this._params.extensions.push(\"EXT_color_buffer_float\");\n            this._params.extensions.push(\"OES_texture_float_linear\");\n            //this._params.extensions.push(\"WEBGL_draw_buffers\");\n        }\n        let i = this._params.extensions.length;\n        while (i--) {\n            this.initializeExtension(this._params.extensions[i], true);\n        }\n        if (this.gl.type === \"webgl\") {\n            this.createTexture_n = this.createTexture_n_webgl1.bind(this);\n            this.createTexture_l = this.createTexture_l_webgl1.bind(this);\n            this.createTexture_mm = this.createTexture_mm_webgl1.bind(this);\n            this.createTexture_a = this.createTexture_a_webgl1.bind(this);\n        }\n        else {\n            this.createTexture_n = this.createTexture_n_webgl2.bind(this);\n            this.createTexture_l = this.createTexture_l_webgl2.bind(this);\n            this.createTexture_mm = this.createTexture_mm_webgl2.bind(this);\n            this.createTexture_a = this.createTexture_a_webgl2.bind(this);\n        }\n        this.createTexture[\"NEAREST\"] = this.createTexture_n;\n        this.createTexture[\"LINEAR\"] = this.createTexture_l;\n        this.createTexture[\"MIPMAP\"] = this.createTexture_mm;\n        this.createTexture[\"ANISOTROPIC\"] = this.createTexture_a;\n        if (!this.extensions.EXT_texture_filter_anisotropic) {\n            this.createTextureDefault = this.createTexture_mm;\n        }\n        else {\n            this.createTextureDefault = this.createTexture_a;\n        }\n        /** Initializing shaders and rendering parameters*/\n        this._initPrograms();\n        this._setDefaults();\n        this.intersectionObserver = new IntersectionObserver((entries) => {\n            this._toggleVisibilityChange(entries[0].isIntersecting);\n        }, { threshold: 0 });\n        this.intersectionObserver.observe(this.canvas);\n        this.resizeObserver = new ResizeObserver(entries => {\n            this._toggleVisibilityChange(entries[0].contentRect.width !== 0 && entries[0].contentRect.height !== 0);\n        });\n        this.resizeObserver.observe(this.canvas);\n        document.addEventListener(\"visibilitychange\", () => {\n            this._toggleVisibilityChange(document.visibilityState === 'visible');\n        });\n    }\n    _toggleVisibilityChange(visibility) {\n        if (visibility) {\n            this.start();\n            this.ONCANVASRESIZE && this.ONCANVASRESIZE();\n            this.events.dispatch(this.events.visibilitychange, true);\n        }\n        else {\n            this.events.dispatch(this.events.visibilitychange, false);\n            this.stop();\n        }\n    }\n    /**\n     * Sets default gl render parameters. Used in init function.\n     * @protected\n     */\n    _setDefaults() {\n        let gl = this.gl;\n        if (!gl)\n            return;\n        if (!this.canvas)\n            return;\n        gl.depthFunc(gl.LESS);\n        gl.enable(gl.DEPTH_TEST);\n        this.setSize(this.canvas.clientWidth || this._params.width, this.canvas.clientHeight || this._params.height);\n        gl.frontFace(gl.CCW);\n        gl.cullFace(gl.BACK);\n        gl.enable(gl.CULL_FACE);\n        gl.disable(gl.BLEND);\n        this.createDefaultTexture({ color: \"rgba(0,0,0,0.0)\" }, (t) => {\n            this.transparentTexture = t;\n        });\n        this.createDefaultTexture({ color: \"rgba(255, 255, 255, 1.0)\" }, (t) => {\n            this.defaultTexture = t;\n        });\n    }\n    getCanvasSize() {\n        return this._canvasSize;\n    }\n    /**\n     * Creates STREAM_DRAW ARRAY buffer.\n     * @public\n     * @param {number} itemSize - Array item size.\n     * @param {number} numItems - Items quantity.\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\n     * @param {number} [bytes=4] -\n     * @return {WebGLBufferExt} -\n     */\n    createStreamArrayBuffer(itemSize, numItems, usage, bytes = 4) {\n        let gl = this.gl;\n        let buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, numItems * itemSize * bytes, usage || gl.STREAM_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        buffer.itemSize = itemSize;\n        buffer.numItems = numItems;\n        return buffer;\n    }\n    /**\n     * Sets stream buffer.\n     * @public\n     * @param {WebGLBufferExt} buffer -\n     * @param {TypedArray} array -\n     * @param {number} [offset=0] -\n     * @return {WebGLBufferExt} -\n     */\n    setStreamArrayBuffer(buffer, array, offset = 0) {\n        let gl = this.gl;\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferSubData(gl.ARRAY_BUFFER, offset, array);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        return buffer;\n    }\n    /**\n     * Creates ARRAY buffer.\n     * @public\n     * @param {TypedArray} array - Input array.\n     * @param {number} itemSize - Array item size.\n     * @param {number} numItems - Items quantity.\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\n     * @return {WebGLBufferExt} -\n     */\n    createArrayBuffer(array, itemSize, numItems, usage) {\n        let gl = this.gl;\n        let buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, array, usage || gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        buffer.itemSize = itemSize;\n        buffer.numItems = numItems;\n        return buffer;\n    }\n    /**\n     * Creates ARRAY buffer specific length.\n     * @public\n     * @param {number} size -\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\n     * @return {WebGLBufferExt} -\n     */\n    createArrayBufferLength(size, usage) {\n        let gl = this.gl;\n        let buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ARRAY_BUFFER, size, usage || gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ARRAY_BUFFER, null);\n        buffer.itemSize = 1;\n        buffer.numItems = size;\n        return buffer;\n    }\n    /**\n     * Creates ELEMENT ARRAY buffer.\n     * @public\n     * @param {TypedArray} array - Input array.\n     * @param {number} itemSize - Array item size.\n     * @param {number} numItems - Items quantity.\n     * @param {number} [usage=STATIC_DRAW] - Parameter of the bufferData call can be one of STATIC_DRAW, DYNAMIC_DRAW, or STREAM_DRAW.\n     * @return {Object} -\n     */\n    createElementArrayBuffer(array, itemSize, numItems, usage) {\n        let gl = this.gl;\n        let buffer = gl.createBuffer();\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, buffer);\n        gl.bufferData(gl.ELEMENT_ARRAY_BUFFER, array, usage || gl.STATIC_DRAW);\n        gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n        buffer.itemSize = itemSize;\n        buffer.numItems = numItems || array.length;\n        return buffer;\n    }\n    /**\n     * Sets handler canvas size.\n     * @public\n     * @param {number} w - Canvas width.\n     * @param {number} h - Canvas height.\n     */\n    setSize(w, h) {\n        this._params.width = w;\n        this._params.height = h;\n        if (this.canvas) {\n            this.canvas.width = w * this._params.pixelRatio;\n            this.canvas.height = h * this._params.pixelRatio;\n            this._canvasSize[0] = this.canvas.width;\n            this._canvasSize[1] = this.canvas.height;\n            this._oneByHeight = 1.0 / this.canvas.height;\n            this.gl && this.gl.viewport(0, 0, w, h);\n            this.ONCANVASRESIZE && this.ONCANVASRESIZE(this.canvas);\n            this.events.dispatch(this.events.resize, this);\n        }\n    }\n    get pixelRatio() {\n        return this._params.pixelRatio;\n    }\n    set pixelRatio(pr) {\n        this._params.pixelRatio = pr;\n        this.setSize(this._params.width, this._params.height);\n    }\n    /**\n     * Returns context screen width.\n     * @public\n     * @returns {number} -\n     */\n    getWidth() {\n        return this.canvas ? this.canvas.width : 0;\n    }\n    /**\n     * Returns context screen height.\n     * @public\n     * @returns {number} -\n     */\n    getHeight() {\n        return this.canvas ? this.canvas.height : 0;\n    }\n    /**\n     * Returns canvas aspect ratio.\n     * @public\n     * @returns {number} -\n     */\n    getClientAspect() {\n        return this.canvas ? this.canvas.clientWidth / this.canvas.clientHeight : 0;\n    }\n    /**\n     * Returns canvas center coordinates.\n     * @public\n     * @returns {number} -\n     */\n    getCenter() {\n        let c = this.canvas;\n        return c ? new Vec2(Math.round(c.width * 0.5), Math.round(c.height * 0.5)) : new Vec2();\n    }\n    /**\n     * Draw single frame.\n     * @public\n     */\n    drawFrame() {\n        /** Calculating frame time */\n        let now = window.performance.now();\n        this.deltaTime = now - this._lastAnimationFrameTime;\n        this._lastAnimationFrameTime = now;\n        this.defaultClock.tick(this.deltaTime);\n        for (let i = 0; i < this._clocks.length; i++) {\n            this._clocks[i].tick(this.deltaTime);\n        }\n        /** Canvas resize checking */\n        let canvas = this.canvas;\n        if (Math.floor(canvas.clientWidth * this._params.pixelRatio) !== canvas.width || Math.floor(canvas.clientHeight * this._params.pixelRatio) !== canvas.height) {\n            if (canvas.clientWidth === 0 || canvas.clientHeight === 0) {\n                this.stop();\n            }\n            else if (!document.hidden) {\n                this.start();\n                this.setSize(canvas.clientWidth, canvas.clientHeight);\n            }\n        }\n        /** Draw frame */\n        this._frameCallback();\n    }\n    /**\n     * Clearing gl frame.\n     * @public\n     */\n    clearFrame() {\n        let gl = this.gl;\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n    }\n    /**\n     * Starts animation loop.\n     * @public\n     */\n    start() {\n        if (!this._requestAnimationFrameId && this._initialized) {\n            this._animationFrameCallback();\n        }\n    }\n    stop() {\n        if (this._requestAnimationFrameId) {\n            window.cancelAnimationFrame(this._requestAnimationFrameId);\n            this._requestAnimationFrameId = 0;\n        }\n    }\n    isStopped() {\n        return !this._requestAnimationFrameId;\n    }\n    /**\n     * Check is gl context type equals webgl2\n     * @public\n     */\n    isWebGl2() {\n        return this.gl ? this.gl.type === \"webgl2\" : false;\n    }\n    /**\n     * Make animation.\n     * @protected\n     */\n    _animationFrameCallback() {\n        this._requestAnimationFrameId = window.requestAnimationFrame(() => {\n            this.drawFrame();\n            this._requestAnimationFrameId && this._animationFrameCallback();\n        });\n    }\n    /**\n     * Creates default texture object\n     * @public\n     * @param {IDefaultTextureParams | null} params - Texture parameters:\n     * @param {(texture: WebGLTextureExt) => void} [success] - Creation callback\n     */\n    createDefaultTexture(params, success) {\n        let imgCnv;\n        let texture;\n        if (params && params.color) {\n            imgCnv = new ImageCanvas(2, 2);\n            imgCnv.fillColor(params.color);\n            texture = this.createTexture_n(imgCnv.getCanvas());\n            texture.default = true;\n            success(texture);\n        }\n        else if (params && params.url) {\n            let img = new Image();\n            let that = this;\n            img.onload = function () {\n                texture = that.createTextureDefault(img);\n                texture.default = true;\n                success(texture);\n            };\n            img.src = params.url;\n        }\n        else {\n            imgCnv = new ImageCanvas(2, 2);\n            imgCnv.fillColor(\"#C5C5C5\");\n            texture = this.createTexture_n(imgCnv.getCanvas());\n            texture.default = true;\n            success(texture);\n        }\n    }\n    deleteTexture(texture) {\n        if (texture && !texture.default) {\n            this.gl.deleteTexture(texture);\n        }\n    }\n    /**\n     * @public\n     */\n    destroy() {\n        this.resizeObserver?.disconnect();\n        this.intersectionObserver?.disconnect();\n        this.stop();\n        //\n        // Dispose shaders\n        //\n        for (let p in this.programs) {\n            this.removeProgram(p);\n        }\n        //\n        // Clear WebGL context\n        //\n        let gl = this.gl;\n        if (gl) {\n            gl.deleteTexture(this.transparentTexture);\n            this.transparentTexture = null;\n            gl.deleteTexture(this.defaultTexture);\n            this.defaultTexture = null;\n            this.framebufferStack = new Stack();\n            //\n            // Clear attrib pointers\n            //\n            let numAttribs = gl.getParameter(gl.MAX_VERTEX_ATTRIBS);\n            let tmp = gl.createBuffer();\n            gl.bindBuffer(gl.ARRAY_BUFFER, tmp);\n            for (let ii = 0; ii < numAttribs; ++ii) {\n                gl.disableVertexAttribArray(ii);\n                gl.vertexAttribPointer(ii, 4, gl.FLOAT, false, 0, 0);\n                gl.vertexAttrib1f(ii, 0);\n            }\n            gl.deleteBuffer(tmp);\n            //\n            // Clear all possible textures\n            //\n            let numTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS);\n            for (let ii = 0; ii < numTextureUnits; ++ii) {\n                gl.activeTexture(gl.TEXTURE0 + ii);\n                gl.bindTexture(gl.TEXTURE_CUBE_MAP, null);\n                gl.bindTexture(gl.TEXTURE_2D, null);\n            }\n            //\n            // Hard reset\n            //\n            gl.activeTexture(gl.TEXTURE0);\n            gl.useProgram(null);\n            gl.bindBuffer(gl.ARRAY_BUFFER, null);\n            gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n            gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n            gl.disable(gl.BLEND);\n            gl.disable(gl.CULL_FACE);\n            gl.disable(gl.DEPTH_TEST);\n            gl.disable(gl.DITHER);\n            gl.disable(gl.SCISSOR_TEST);\n            gl.blendColor(0, 0, 0, 0);\n            gl.blendEquation(gl.FUNC_ADD);\n            gl.blendFunc(gl.ONE, gl.ZERO);\n            gl.clearColor(0, 0, 0, 0);\n            gl.clearDepth(1);\n            gl.clearStencil(-1);\n        }\n        //\n        // Destroy canvas\n        //\n        if (this.canvas) {\n            if (this.canvas.parentNode) {\n                this.canvas.parentNode.removeChild(this.canvas);\n            }\n            this.canvas.width = 1;\n            this.canvas.height = 1;\n            this.canvas = null;\n        }\n        this.gl = null;\n        this._initialized = false;\n    }\n    addClock(clock) {\n        if (!clock.__handler) {\n            clock.__handler = this;\n            this._clocks.push(clock);\n        }\n    }\n    addClocks(clockArr) {\n        for (let i = 0; i < clockArr.length; i++) {\n            this.addClock(clockArr[i]);\n        }\n    }\n    removeClock(clock) {\n        if (clock.__handler) {\n            let c = this._clocks;\n            let i = c.length;\n            while (i--) {\n                if (c[i].isEqual(clock)) {\n                    clock.__handler = null;\n                    c.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    }\n}\nexport { Handler };\n//# sourceMappingURL=Handler.js.map","import { BaseFramebuffer } from \"./BaseFramebuffer\";\n/**\n * Class represents multisample framebuffer.\n * @class\n * @param {Handler} handler - WebGL handler.\n * @param {Object} [options] - Framebuffer options:\n */\nexport class Multisample extends BaseFramebuffer {\n    constructor(handler, options = {}) {\n        super(handler, options);\n        this._internalFormat = options.internalFormat ? options.internalFormat.toUpperCase() : \"RGBA8\";\n        this._msaa = options.msaa != undefined ? options.msaa : 4;\n        this._glFilter = 0;\n        this.renderbuffers = new Array(this._size);\n    }\n    destroy() {\n        let gl = this.handler.gl;\n        if (!gl)\n            return;\n        for (let i = 0; i < this.renderbuffers.length; i++) {\n            gl.deleteRenderbuffer(this.renderbuffers[i]);\n        }\n        this.renderbuffers = new Array(this._size);\n        gl.deleteFramebuffer(this._fbo);\n        gl.deleteRenderbuffer(this._depthRenderbuffer);\n        this._depthRenderbuffer = null;\n        this._fbo = null;\n        this._active = false;\n    }\n    /**\n     * Framebuffer initialization.\n     * @public\n     */\n    init() {\n        let gl = this.handler.gl;\n        if (!gl)\n            return;\n        this._glFilter = gl[this._filter];\n        this._fbo = gl.createFramebuffer();\n        gl.bindFramebuffer(gl.FRAMEBUFFER, this._fbo);\n        let colorAttachments = [];\n        for (let i = 0; i < this.renderbuffers.length; i++) {\n            let rb = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, rb);\n            if (this._msaa > 0) {\n                gl.renderbufferStorageMultisample(gl.RENDERBUFFER, this._msaa, gl[this._internalFormat], this._width, this._height);\n            }\n            else {\n                gl.renderbufferStorage(gl.RENDERBUFFER, gl[this._internalFormat], this._width, this._height);\n            }\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0 + i, gl.RENDERBUFFER, rb);\n            colorAttachments.push(gl.COLOR_ATTACHMENT0 + i);\n            this.renderbuffers[i] = rb;\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n        }\n        gl.drawBuffers(colorAttachments);\n        if (this._useDepth) {\n            this._depthRenderbuffer = gl.createRenderbuffer();\n            gl.bindRenderbuffer(gl.RENDERBUFFER, this._depthRenderbuffer);\n            gl.renderbufferStorageMultisample(gl.RENDERBUFFER, this._msaa, gl[this._depthComponent], this._width, this._height);\n            gl.framebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_ATTACHMENT, gl.RENDERBUFFER, this._depthRenderbuffer);\n            gl.bindRenderbuffer(gl.RENDERBUFFER, null);\n        }\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n    }\n    blitTo(framebuffer, attachmentIndex = 0) {\n        let gl = this.handler.gl;\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, this._fbo);\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, framebuffer._fbo);\n        gl.readBuffer(gl.COLOR_ATTACHMENT0 + attachmentIndex);\n        gl.clearBufferfv(gl.COLOR, 0, [0.0, 0.0, 0.0, 1.0]);\n        gl.blitFramebuffer(0, 0, this._width, this._height, 0, 0, framebuffer._width, framebuffer._height, gl.COLOR_BUFFER_BIT, this._glFilter);\n        gl.bindFramebuffer(gl.FRAMEBUFFER, null);\n        gl.bindFramebuffer(gl.READ_FRAMEBUFFER, null);\n        gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER, null);\n    }\n}\n//# sourceMappingURL=Multisample.js.map","import { input } from './input';\nimport { stamp } from \"../utils/shared\";\nconst STAMP_SPACER = \"_\";\nconst _sortByPriority = function (a, b) {\n    return Number(a.priority < b.priority);\n};\nclass KeyboardHandler {\n    constructor() {\n        this._currentlyPressedKeys = {};\n        this._pressedKeysCallbacks = {};\n        this._unpressedKeysCallbacks = {};\n        this._charkeysCallbacks = {};\n        this._anykeyCallback = null;\n        this._event = null;\n        this._active = true;\n        this._stampCache = {};\n        document.onkeydown = (event) => {\n            this._event = event;\n            this._active && this.handleKeyDown();\n        };\n        document.onkeyup = (event) => {\n            this._event = event;\n            this._active && this.handleKeyUp();\n        };\n    }\n    getcurrentlyPressedKeys() {\n        return this._currentlyPressedKeys;\n    }\n    getPressedKeysCallbacks() {\n        return this._pressedKeysCallbacks;\n    }\n    getUnpressedKeysCallbacks() {\n        return this._unpressedKeysCallbacks;\n    }\n    getCharkeysCallbacks() {\n        return this._charkeysCallbacks;\n    }\n    removeEvent(event, keyCode, callback) {\n        let st = this._getStamp(event, keyCode, callback._openglobus_id);\n        if (callback._openglobus_id && this._stampCache[st]) {\n            //this._stampCache[st] = null;\n            delete this._stampCache[st];\n            if (event === \"keypress\") {\n                this._removeCallback(this._pressedKeysCallbacks[keyCode], callback);\n            }\n            else if (event === \"keyfree\") {\n                this._removeCallback(this._unpressedKeysCallbacks[keyCode], callback);\n            }\n            else if (event === \"charkeypress\") {\n                this._removeCallback(this._charkeysCallbacks[keyCode], callback);\n            }\n        }\n    }\n    _removeCallback(handlers, callback) {\n        for (let i = 0; i < handlers.length; i++) {\n            if (handlers[i].callback._openglobus_id === callback._openglobus_id) {\n                handlers.splice(i, 1);\n            }\n        }\n    }\n    _getStamp(name, keyCode, ogid) {\n        return `${name}${STAMP_SPACER}${keyCode}${STAMP_SPACER}${ogid}`;\n    }\n    _stamp(name, keyCode, obj) {\n        const ogid = stamp(obj);\n        const st = this._getStamp(name, keyCode, ogid);\n        if (!this._stampCache[st]) {\n            this._stampCache[st] = ogid;\n            return true;\n        }\n        return false;\n    }\n    setActivity(activity) {\n        this._active = activity;\n    }\n    releaseKeys() {\n        this._currentlyPressedKeys = {};\n    }\n    addEvent(event, keyCode, callback, sender, priority) {\n        // Event is already bound with the callback\n        if (!this._stamp(event, keyCode, callback))\n            return;\n        if (priority === undefined) {\n            priority = 1600;\n        }\n        switch (event) {\n            case \"keyfree\":\n                if (!this._unpressedKeysCallbacks[keyCode]) {\n                    this._unpressedKeysCallbacks[keyCode] = [];\n                }\n                this._unpressedKeysCallbacks[keyCode].push({ callback: callback, sender: sender, priority: priority });\n                this._unpressedKeysCallbacks[keyCode].sort(_sortByPriority);\n                break;\n            case \"keypress\":\n                if (keyCode == null) {\n                    this._anykeyCallback = { callback: callback, sender: sender || this };\n                }\n                else {\n                    if (!this._pressedKeysCallbacks[keyCode]) {\n                        this._pressedKeysCallbacks[keyCode] = [];\n                    }\n                    this._pressedKeysCallbacks[keyCode].push({ callback: callback, sender: sender, priority: priority });\n                    this._pressedKeysCallbacks[keyCode].sort(_sortByPriority);\n                }\n                break;\n            case \"charkeypress\":\n                if (!this._charkeysCallbacks[keyCode]) {\n                    this._charkeysCallbacks[keyCode] = [];\n                }\n                this._charkeysCallbacks[keyCode].push({ callback: callback, sender: sender, priority: priority });\n                this._charkeysCallbacks[keyCode].sort(_sortByPriority);\n                break;\n        }\n    }\n    isKeyPressed(keyCode) {\n        return this._currentlyPressedKeys[keyCode];\n    }\n    handleKeyDown() {\n        // If you want to get a key code just uncomment and check console\n        //console.log(this._event!.keyCode);\n        this._anykeyCallback && this._anykeyCallback.callback.call(this._anykeyCallback.sender, this._event);\n        this._currentlyPressedKeys[this._event.keyCode] = true;\n        for (let ch in this._charkeysCallbacks) {\n            if (String.fromCharCode(this._event.keyCode) === String.fromCharCode(Number(ch))) {\n                let ccl = this._charkeysCallbacks[ch];\n                for (let i = 0; i < ccl.length; i++) {\n                    ccl[i].callback.call(ccl[i].sender, this._event);\n                }\n            }\n        }\n        if (this._event.keyCode == input.KEY_ALT || this._event.keyCode == input.KEY_SHIFT) {\n            this._event.preventDefault();\n        }\n    }\n    handleKeyUp() {\n        if (this._currentlyPressedKeys[this._event.keyCode] || this._event.keyCode === input.KEY_PRINTSCREEN) {\n            for (let pk in this._unpressedKeysCallbacks) {\n                if (this._currentlyPressedKeys[pk] || this._event.keyCode === input.KEY_PRINTSCREEN && Number(pk) === input.KEY_PRINTSCREEN) {\n                    let cpk = this._unpressedKeysCallbacks[pk];\n                    for (let i = 0; i < cpk.length; i++) {\n                        cpk[i].callback.call(cpk[i].sender, this._event);\n                    }\n                }\n            }\n        }\n        this._currentlyPressedKeys[this._event.keyCode] = false;\n    }\n    handleEvents() {\n        for (let pk in this._pressedKeysCallbacks) {\n            if (this._currentlyPressedKeys[pk]) {\n                let cpk = this._pressedKeysCallbacks[pk];\n                for (let i = 0; i < cpk.length; i++) {\n                    cpk[i].callback.call(cpk[i].sender, this._event);\n                }\n            }\n        }\n    }\n}\nexport { KeyboardHandler };\n//# sourceMappingURL=KeyboardHandler.js.map","class MouseHandler {\n    constructor(htmlObject) {\n        this._htmlObject = htmlObject;\n    }\n    setEvent(event, sender, callback) {\n        switch (event) {\n            case \"mousewheel\":\n                // this._htmlObject.addEventListener('mousewheel', function (event: WheelEventExt) {\n                //     let delta = event.deltaY || event.detail || event.wheelDelta || 0;\n                //     if (event.wheelDelta == undefined) {\n                //         event.wheelDelta = delta * (-120);\n                //     }\n                //     callback.call(sender, event);\n                //     event.preventDefault();\n                // }, false);\n                this._htmlObject.addEventListener('wheel', function (event) {\n                    let delta = event.deltaY || event.detail || event.wheelDelta || 0;\n                    if (event.wheelDelta == undefined) {\n                        event.wheelDelta = delta * (-120);\n                    }\n                    callback.call(sender, event);\n                    event.preventDefault();\n                }, false);\n                break;\n            case \"mousedown\":\n                this._htmlObject.addEventListener('mousedown', function (event) {\n                    let rect = this.getBoundingClientRect();\n                    callback.call(sender, event, {\n                        button: event.button,\n                        clientX: event.clientX - rect.left,\n                        clientY: event.clientY - rect.top\n                    });\n                });\n                this._htmlObject.addEventListener('contextmenu', function (event) {\n                    event.preventDefault();\n                    return false;\n                });\n                break;\n            case \"mouseup\":\n                this._htmlObject.addEventListener('mouseup', function (event) {\n                    let rect = this.getBoundingClientRect();\n                    callback.call(sender, event, {\n                        button: event.button,\n                        clientX: event.clientX - rect.left,\n                        clientY: event.clientY - rect.top\n                    });\n                });\n                break;\n            case \"mousemove\":\n                this._htmlObject.addEventListener('mousemove', function (event) {\n                    let rect = this.getBoundingClientRect();\n                    callback.call(sender, event, {\n                        clientX: event.clientX - rect.left,\n                        clientY: event.clientY - rect.top\n                    });\n                });\n                break;\n            case \"mouseleave\":\n                this._htmlObject.addEventListener('mouseleave', function (event) {\n                    callback.call(sender, event);\n                });\n                break;\n            case \"mouseout\":\n                this._htmlObject.addEventListener('mouseout', function (event) {\n                    callback.call(sender, event);\n                });\n                break;\n            case \"mouseover\":\n                this._htmlObject.addEventListener('mouseover', function (event) {\n                    callback.call(sender, event);\n                });\n                break;\n            case \"mouseenter\":\n                this._htmlObject.addEventListener('mouseenter', function (event) {\n                    callback.call(sender, event);\n                });\n                break;\n        }\n    }\n}\nexport { MouseHandler };\n//# sourceMappingURL=MouseHandler.js.map","class TouchHandler {\n    constructor(htmlObject) {\n        this._htmlObject = htmlObject;\n    }\n    setEvent(event, sender, callback) {\n        switch (event) {\n            case \"touchcancel\":\n                this._htmlObject.addEventListener('touchcancel', function (event) {\n                    event.preventDefault();\n                    const rect = this.getBoundingClientRect();\n                    const eventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\n                    callback.call(sender, eventExt);\n                });\n                break;\n            case \"touchstart\":\n                this._htmlObject.addEventListener('touchstart', function (event) {\n                    event.preventDefault();\n                    const rect = this.getBoundingClientRect();\n                    const eventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\n                    callback.call(sender, eventExt);\n                });\n                break;\n            case \"touchend\":\n                this._htmlObject.addEventListener('touchend', function (event) {\n                    event.preventDefault();\n                    const rect = this.getBoundingClientRect();\n                    const eventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\n                    callback.call(sender, eventExt);\n                });\n                break;\n            case \"touchmove\":\n                this._htmlObject.addEventListener('touchmove', function (event) {\n                    event.preventDefault();\n                    const rect = this.getBoundingClientRect();\n                    const eventExt = Object.assign(event, { offsetLeft: rect.left, offsetTop: rect.top });\n                    callback.call(sender, eventExt);\n                });\n                break;\n        }\n    }\n}\nexport { TouchHandler };\n//# sourceMappingURL=TouchHandler.js.map","import { Events } from \"../Events\";\nimport { input } from \"../input/input\";\nimport { KeyboardHandler } from \"../input/KeyboardHandler\";\nimport { MouseHandler } from \"../input/MouseHandler\";\nimport { TouchHandler } from \"../input/TouchHandler\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nexport function createRendererEvents(renderer) {\n    return new RendererEvents(renderer);\n}\nconst LB_M = 0b0001;\nconst RB_M = 0b0010;\nconst MB_M = 0b0100;\nconst ISBLACK = (c) => !(c[0] || c[1] || c[2]);\nconst NOTBLACK = (c) => !!(c[0] || c[1] || c[2]);\n/**\n * Stores current picking rgb color.\n * @type {Array.<number>} - (exactly 3 entries)\n */\nlet _currPickingColor = new Uint8Array(4);\nlet _tempCurrPickingColor = new Uint8Array(4);\n/**\n * Stores previous picked rgb color.\n * @type {Array.<number>} - (exactly 3 entries)\n */\nlet _prevPickingColor = new Uint8Array(4);\n/**\n * Renderer events handler.\n * @class\n * @param {Renderer} renderer - Renderer object, events that works for.\n */\nclass RendererEvents extends Events {\n    constructor(renderer) {\n        super(RENDERER_EVENTS);\n        this.renderer = renderer;\n        this._touchHandler = new TouchHandler(renderer.handler.canvas);\n        this._mouseHandler = new MouseHandler(renderer.handler.canvas);\n        this._keyboardHandler = new KeyboardHandler();\n        this._active = true;\n        this.clickRadius = 15;\n        this.mouseState = {\n            clientX: 0,\n            clientY: 0,\n            pos: new Vec2(),\n            x: 0,\n            y: 0,\n            nx: 0,\n            ny: 0,\n            prev_x: 0,\n            prev_y: 0,\n            direction: new Vec3(),\n            leftButtonUp: false,\n            rightButtonUp: false,\n            middleButtonUp: false,\n            leftButtonDown: false,\n            rightButtonDown: false,\n            middleButtonDown: false,\n            leftButtonHold: false,\n            rightButtonHold: false,\n            middleButtonHold: false,\n            leftButtonDoubleClick: false,\n            rightButtonDoubleClick: false,\n            middleButtonDoubleClick: false,\n            leftButtonClick: false,\n            rightButtonClick: false,\n            middleButtonClick: false,\n            moving: false,\n            justStopped: false,\n            doubleClickDelay: 500,\n            clickDelay: 200,\n            wheelDelta: 0,\n            sys: null,\n            pickingObject: null,\n            renderer: renderer\n        };\n        this.touchState = {\n            moving: false,\n            touchEnd: false,\n            touchStart: false,\n            touchCancel: false,\n            doubleTouch: false,\n            doubleTouchDelay: 550,\n            doubleTouchRadius: 10,\n            clientX: 0,\n            clientY: 0,\n            pos: new Vec2(),\n            x: 0,\n            y: 0,\n            nx: 0,\n            ny: 0,\n            prev_x: 0,\n            prev_y: 0,\n            direction: new Vec3(),\n            sys: null,\n            pickingObject: null,\n            renderer: renderer\n        };\n        this._isMouseInside = false;\n        this._entityPickingEventsActive = true;\n        this._dblTchCoords = new Vec2();\n        this._oneTouchStart = false;\n        this._dblTchBegins = 0;\n        this._mousestopThread = null;\n        this._ldblClkBegins = 0;\n        this._rdblClkBegins = 0;\n        this._mdblClkBegins = 0;\n        this._lClkBegins = 0;\n        this._rClkBegins = 0;\n        this._mClkBegins = 0;\n        this._lclickX = 0;\n        this._lclickY = 0;\n        this._rclickX = 0;\n        this._rclickY = 0;\n        this._mclickX = 0;\n        this._mclickY = 0;\n    }\n    pointerEvent() {\n        let ms = this.mouseState, ts = this.touchState;\n        return (ms.moving ||\n            ms.justStopped ||\n            ts.moving ||\n            ts.touchStart ||\n            ts.touchEnd ||\n            ms.wheelDelta !== 0);\n    }\n    get active() {\n        return this._active;\n    }\n    set active(isActive) {\n        this._active = isActive;\n        this._keyboardHandler.setActivity(isActive);\n    }\n    /**\n     * Used in render node frame.\n     * @public\n     */\n    handleEvents() {\n        if (this._active) {\n            this.mouseState.direction = this.renderer.activeCamera.unproject(this.mouseState.x, this.mouseState.y);\n            //\n            // TODO: Replace in some other place with a thought that we do\n            // not need to make unproject when we do not make touching\n            this.touchState.direction = this.renderer.activeCamera.unproject(this.touchState.x, this.touchState.y);\n            this._keyboardHandler.handleEvents();\n            this.handleMouseEvents();\n            this.handleTouchEvents();\n            this.entityPickingEvents();\n        }\n    }\n    on(name, p0, p1, p2, keyPriority) {\n        if (name === \"keypress\" || name === \"charkeypress\" || name === \"keyfree\") {\n            this._keyboardHandler.addEvent(name, p0, p1, p2, keyPriority);\n        }\n        else {\n            super.on(name, p0, p1, p2);\n        }\n    }\n    off(name, p1, p2) {\n        if (name === \"keypress\" || name === \"charkeypress\" || name === \"keyfree\") {\n            this._keyboardHandler.removeEvent(name, p1, p2);\n        }\n        else {\n            super.off(name, p1);\n        }\n    }\n    /**\n     * Check key is pressed.\n     * @public\n     * @param {number} keyCode - Key code\n     * @return {boolean}\n     */\n    isKeyPressed(keyCode) {\n        return this._keyboardHandler.isKeyPressed(keyCode);\n    }\n    releaseKeys() {\n        this._keyboardHandler.releaseKeys();\n    }\n    /**\n     * Renderer events initialization.\n     * @public\n     */\n    initialize() {\n        this._mouseHandler.setEvent(\"mouseup\", this, this.onMouseUp);\n        this._mouseHandler.setEvent(\"mousemove\", this, this.onMouseMove);\n        this._mouseHandler.setEvent(\"mousedown\", this, this.onMouseDown);\n        this._mouseHandler.setEvent(\"mousewheel\", this, this.onMouseWheel);\n        this._mouseHandler.setEvent(\"mouseleave\", this, this.onMouseLeave);\n        this._mouseHandler.setEvent(\"mouseenter\", this, this.onMouseEnter);\n        this._touchHandler.setEvent(\"touchstart\", this, this.onTouchStart);\n        this._touchHandler.setEvent(\"touchend\", this, this.onTouchEnd);\n        this._touchHandler.setEvent(\"touchcancel\", this, this.onTouchCancel);\n        this._touchHandler.setEvent(\"touchmove\", this, this.onTouchMove);\n    }\n    /**\n     * @protected\n     */\n    onMouseWheel(event) {\n        this.mouseState.sys = event;\n        this.mouseState.wheelDelta = event.wheelDelta || 0;\n    }\n    updateButtonsStates(buttons) {\n        let ms = this.mouseState;\n        if ((buttons & LB_M) && ms.leftButtonDown) {\n            ms.leftButtonDown = true;\n        }\n        else {\n            ms.leftButtonHold = false;\n            ms.leftButtonDown = false;\n        }\n        if ((buttons & RB_M) && ms.rightButtonDown) {\n            ms.rightButtonDown = true;\n        }\n        else {\n            ms.rightButtonHold = false;\n            ms.rightButtonDown = false;\n        }\n        if ((buttons & MB_M) && ms.middleButtonDown) {\n            ms.middleButtonDown = true;\n        }\n        else {\n            ms.middleButtonHold = false;\n            ms.middleButtonDown = false;\n        }\n    }\n    onMouseMove(sys, event) {\n        let ms = this.mouseState;\n        this.updateButtonsStates(sys.buttons);\n        ms.sys = sys;\n        let ex = event.clientX, ey = event.clientY, r = this.clickRadius;\n        if (Math.abs(this._lclickX - ex) >= r && Math.abs(this._lclickY - ey) >= r) {\n            this._ldblClkBegins = 0;\n            this._lClkBegins = 0;\n        }\n        if (Math.abs(this._rclickX - ex) >= r && Math.abs(this._rclickY - ey) >= r) {\n            this._rdblClkBegins = 0;\n            this._rClkBegins = 0;\n        }\n        if (Math.abs(this._mclickX - ex) >= r && Math.abs(this._mclickY - ey) >= r) {\n            this._mdblClkBegins = 0;\n            this._mClkBegins = 0;\n        }\n        if (ms.clientX === event.clientX && ms.clientY === event.clientY) {\n            return;\n        }\n        ms.clientX = event.clientX;\n        ms.clientY = event.clientY;\n        let h = this.renderer.handler;\n        ms.pos.x = ms.x = event.clientX * h.pixelRatio;\n        ms.pos.y = ms.y = event.clientY * h.pixelRatio;\n        ms.nx = ms.x / h.canvas.width;\n        ms.ny = ms.y / h.canvas.height;\n        ms.moving = true;\n        //dispatch stop mouse event\n        clearTimeout(this._mousestopThread);\n        this._mousestopThread = setTimeout(function () {\n            ms.justStopped = true;\n        }, 100);\n    }\n    onMouseLeave(sys) {\n        this._isMouseInside = false;\n        this.mouseState.sys = sys;\n        this.dispatch(this.mouseleave, this.mouseState);\n    }\n    onMouseEnter(sys) {\n        this._isMouseInside = true;\n        this.mouseState.sys = sys;\n        this.dispatch(this.mouseenter, this.mouseState);\n    }\n    onMouseDown(sys, event) {\n        if (event.button === input.MB_LEFT) {\n            this._lClkBegins = window.performance.now();\n            this._lclickX = event.clientX;\n            this._lclickY = event.clientY;\n            this.mouseState.sys = sys;\n            this.mouseState.leftButtonDown = true;\n        }\n        else if (event.button === input.MB_RIGHT) {\n            this._rClkBegins = window.performance.now();\n            this._rclickX = event.clientX;\n            this._rclickY = event.clientY;\n            this.mouseState.sys = sys;\n            this.mouseState.rightButtonDown = true;\n        }\n        else if (event.button === input.MB_MIDDLE) {\n            this._mClkBegins = window.performance.now();\n            this._mclickX = event.clientX;\n            this._mclickY = event.clientY;\n            this.mouseState.sys = sys;\n            this.mouseState.middleButtonDown = true;\n        }\n    }\n    onMouseUp(sys, event) {\n        let ms = this.mouseState;\n        ms.sys = sys;\n        let t = window.performance.now();\n        if (event.button === input.MB_LEFT) {\n            ms.leftButtonDown = false;\n            ms.leftButtonUp = true;\n            if (Math.abs(this._lclickX - event.clientX) < this.clickRadius &&\n                Math.abs(this._lclickY - event.clientY) < this.clickRadius &&\n                t - this._lClkBegins <= ms.clickDelay) {\n                if (this._ldblClkBegins) {\n                    let deltatime = window.performance.now() - this._ldblClkBegins;\n                    if (deltatime <= ms.doubleClickDelay) {\n                        ms.leftButtonDoubleClick = true;\n                    }\n                    this._ldblClkBegins = 0;\n                }\n                else {\n                    this._ldblClkBegins = window.performance.now();\n                }\n                ms.leftButtonClick = true;\n                this._lClkBegins = 0;\n            }\n        }\n        else if (event.button === input.MB_RIGHT) {\n            ms.rightButtonDown = false;\n            ms.rightButtonUp = true;\n            if (Math.abs(this._rclickX - event.clientX) < this.clickRadius &&\n                Math.abs(this._rclickY - event.clientY) < this.clickRadius &&\n                t - this._rClkBegins <= ms.clickDelay) {\n                if (this._rdblClkBegins) {\n                    let deltatime = window.performance.now() - this._rdblClkBegins;\n                    if (deltatime <= ms.doubleClickDelay) {\n                        ms.rightButtonDoubleClick = true;\n                    }\n                    this._rdblClkBegins = 0;\n                }\n                else {\n                    this._rdblClkBegins = window.performance.now();\n                }\n                ms.rightButtonClick = true;\n                this._rClkBegins = 0;\n            }\n        }\n        else if (event.button === input.MB_MIDDLE) {\n            ms.middleButtonDown = false;\n            ms.middleButtonUp = true;\n            if (Math.abs(this._mclickX - event.clientX) < this.clickRadius &&\n                Math.abs(this._mclickY - event.clientY) < this.clickRadius &&\n                t - this._mClkBegins <= ms.clickDelay) {\n                if (this._mdblClkBegins) {\n                    let deltatime = window.performance.now() - this._mdblClkBegins;\n                    if (deltatime <= ms.doubleClickDelay) {\n                        ms.middleButtonDoubleClick = true;\n                    }\n                    this._mdblClkBegins = 0;\n                }\n                else {\n                    this._mdblClkBegins = window.performance.now();\n                }\n                ms.middleButtonClick = true;\n                this._mClkBegins = 0;\n            }\n        }\n    }\n    onTouchStart(event) {\n        let ts = this.touchState;\n        ts.sys = event;\n        ts.clientX = event.touches.item(0).clientX - event.offsetLeft;\n        ts.clientY = event.touches.item(0).clientY - event.offsetTop;\n        let h = this.renderer.handler;\n        ts.pos.x = ts.x = ts.clientX * h.pixelRatio;\n        ts.pos.y = ts.y = ts.clientY * h.pixelRatio;\n        ts.nx = ts.x / h.canvas.width;\n        ts.ny = ts.y / h.canvas.height;\n        ts.prev_x = ts.x;\n        ts.prev_y = ts.y;\n        ts.touchStart = true;\n        if (event.touches.length === 1) {\n            this._dblTchCoords.x = ts.x;\n            this._dblTchCoords.y = ts.y;\n            this._oneTouchStart = true;\n        }\n        else {\n            this._oneTouchStart = false;\n        }\n    }\n    /**\n     * @protected\n     */\n    onTouchEnd(event) {\n        let ts = this.touchState;\n        ts.sys = event;\n        ts.touchEnd = true;\n        if (event.touches.length === 0) {\n            ts.prev_x = ts.x;\n            ts.prev_y = ts.y;\n            if (this._oneTouchStart) {\n                if (this._dblTchBegins) {\n                    let deltatime = window.performance.now() - this._dblTchBegins;\n                    if (deltatime <= ts.doubleTouchDelay) {\n                        ts.doubleTouch = true;\n                    }\n                    this._dblTchBegins = 0;\n                }\n                this._dblTchBegins = window.performance.now();\n                this._oneTouchStart = false;\n            }\n        }\n    }\n    onTouchCancel(event) {\n        let ts = this.touchState;\n        ts.sys = event;\n        ts.touchCancel = true;\n    }\n    onTouchMove(event) {\n        let ts = this.touchState;\n        ts.clientX = event.touches.item(0).clientX - event.offsetLeft;\n        ts.clientY = event.touches.item(0).clientY - event.offsetTop;\n        let h = this.renderer.handler;\n        ts.x = ts.clientX * h.pixelRatio;\n        ts.y = ts.clientY * h.pixelRatio;\n        ts.nx = ts.x / h.canvas.width;\n        ts.ny = ts.y / h.canvas.height;\n        ts.sys = event;\n        ts.moving = true;\n        let dX = ts.x - ts.prev_x;\n        let dY = ts.y - ts.prev_y;\n        if (Math.abs(dX) > 9 || Math.abs(dY) > 9) {\n            this._dblTchBegins = 0;\n            this._oneTouchStart = false;\n        }\n    }\n    entityPickingEvents() {\n        let ts = this.touchState, ms = this.mouseState;\n        // Triggers mouseleave when mouse goes outside the viewport\n        if (this._isMouseInside !== this._entityPickingEventsActive) {\n            this._entityPickingEventsActive = this._isMouseInside;\n            if (!this._entityPickingEventsActive) {\n                let r = this.renderer;\n                let c = _currPickingColor;\n                let co = r.getPickingObjectArr(c);\n                if (co) {\n                    let pe = co.rendererEvents;\n                    ms.pickingObject = co;\n                    pe && pe.dispatch(pe.mouseleave, ms);\n                    ts.pickingObject = co;\n                    pe && pe.dispatch(pe.touchleave, ts);\n                }\n                _currPickingColor[0] = _currPickingColor[1] = _currPickingColor[2] = _currPickingColor[3] =\n                    _prevPickingColor[0] = _prevPickingColor[1] = _prevPickingColor[2] = _prevPickingColor[3] =\n                        _tempCurrPickingColor[0] = _tempCurrPickingColor[1] = _tempCurrPickingColor[2] = _tempCurrPickingColor[3] = 0.0;\n            }\n        }\n        if (this._isMouseInside && !(ms.leftButtonHold || ms.rightButtonHold || ms.middleButtonHold)) {\n            let r = this.renderer;\n            let c = _currPickingColor, p = _prevPickingColor, t = _tempCurrPickingColor;\n            if (ts.x || ts.y) {\n                r.readPickingColor(ts.nx, 1 - ts.ny, t);\n            }\n            else {\n                r.readPickingColor(ms.nx, 1 - ms.ny, t);\n            }\n            p[0] = c[0];\n            p[1] = c[1];\n            p[2] = c[2];\n            c[0] = t[0];\n            c[1] = t[1];\n            c[2] = t[2];\n            ms.pickingObject = null;\n            ts.pickingObject = null;\n            let co = r.getPickingObjectArr(c);\n            ms.pickingObject = co;\n            ts.pickingObject = co;\n            //object is changed\n            if (c[0] !== p[0] || c[1] !== p[1] || c[2] !== p[2]) {\n                //current is black\n                if (ISBLACK(c)) {\n                    let po = r.getPickingObjectArr(p);\n                    if (po) {\n                        let pe = po.rendererEvents;\n                        ms.pickingObject = po;\n                        pe && pe.dispatch(pe.mouseleave, ms);\n                        ts.pickingObject = po;\n                        pe && pe.dispatch(pe.touchleave, ts);\n                    }\n                }\n                else {\n                    //current ia not black\n                    //previous is not black\n                    if (NOTBLACK(p)) {\n                        let po = r.getPickingObjectArr(p);\n                        if (po) {\n                            let pe = po.rendererEvents;\n                            ms.pickingObject = po;\n                            pe && pe.dispatch(pe.mouseleave, ms);\n                            ts.pickingObject = po;\n                            pe && pe.dispatch(pe.touchleave, ts);\n                        }\n                    }\n                    if (co) {\n                        let ce = co.rendererEvents;\n                        ms.pickingObject = co;\n                        ce && ce.dispatch(ce.mouseenter, ms);\n                        ts.pickingObject = co;\n                        ce && ce.dispatch(ce.touchenter, ts);\n                    }\n                }\n            }\n        }\n    }\n    handleMouseEvents() {\n        let _this = this;\n        let ms = this.mouseState;\n        let po = ms.pickingObject, pe = null;\n        if (ms.leftButtonClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.lclick, ms);\n            }\n            this.dispatch(_this.lclick, ms);\n            ms.leftButtonClick = false;\n        }\n        if (ms.rightButtonClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.rclick, ms);\n            }\n            this.dispatch(_this.rclick, ms);\n            ms.rightButtonClick = false;\n        }\n        if (ms.middleButtonClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.mclick, ms);\n            }\n            this.dispatch(_this.mclick, ms);\n            ms.middleButtonClick = false;\n        }\n        if (ms.leftButtonDown) {\n            if (ms.leftButtonHold) {\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.lhold, ms);\n                }\n                this.dispatch(_this.lhold, ms);\n            }\n            else {\n                ms.leftButtonHold = true;\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.ldown, ms);\n                }\n                this.dispatch(_this.ldown, ms);\n            }\n        }\n        if (ms.rightButtonDown) {\n            if (ms.rightButtonHold) {\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.rhold, ms);\n                }\n                this.dispatch(_this.rhold, ms);\n            }\n            else {\n                ms.rightButtonHold = true;\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.rdown, ms);\n                }\n                this.dispatch(_this.rdown, ms);\n            }\n        }\n        if (ms.middleButtonDown) {\n            if (ms.middleButtonHold) {\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.mhold, ms);\n                }\n                this.dispatch(_this.mhold, ms);\n            }\n            else {\n                ms.middleButtonHold = true;\n                if (po) {\n                    pe = po.rendererEvents;\n                    pe && pe.dispatch(pe.mdown, ms);\n                }\n                this.dispatch(_this.mdown, ms);\n            }\n        }\n        if (ms.leftButtonUp) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.lup, ms);\n            }\n            this.dispatch(_this.lup, ms);\n            ms.leftButtonUp = false;\n            ms.leftButtonHold = false;\n        }\n        if (ms.rightButtonUp) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.rup, ms);\n            }\n            this.dispatch(_this.rup, ms);\n            ms.rightButtonUp = false;\n            ms.rightButtonHold = false;\n        }\n        if (ms.middleButtonUp) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.mup, ms);\n            }\n            this.dispatch(_this.mup, ms);\n            ms.middleButtonUp = false;\n            ms.middleButtonHold = false;\n        }\n        if (ms.leftButtonDoubleClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.ldblclick, ms);\n            }\n            this.dispatch(_this.ldblclick, ms);\n            ms.leftButtonDoubleClick = false;\n        }\n        if (ms.rightButtonDoubleClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.rdblclick, ms);\n            }\n            this.dispatch(_this.rdblclick, ms);\n            ms.rightButtonDoubleClick = false;\n        }\n        if (ms.middleButtonDoubleClick) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.mdblclick, ms);\n            }\n            this.dispatch(_this.mdblclick, ms);\n            ms.middleButtonDoubleClick = false;\n        }\n        if (ms.wheelDelta) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.mousewheel, ms);\n            }\n            this.dispatch(_this.mousewheel, ms);\n        }\n        if (ms.moving) {\n            if (po) {\n                pe = po.rendererEvents;\n                pe && pe.dispatch(pe.mousemove, ms);\n            }\n            this.dispatch(_this.mousemove, ms);\n            ms.prev_x = ms.x;\n            ms.prev_y = ms.y;\n        }\n        if (ms.justStopped) {\n            this.dispatch(_this.mousestop, ms);\n        }\n    }\n    /**\n     * @protected\n     */\n    handleTouchEvents() {\n        let _this = this;\n        let ts = this.touchState;\n        let tpo = ts.pickingObject, tpe = null;\n        if (ts.touchCancel) {\n            this.dispatch(_this.touchcancel, ts);\n            ts.touchCancel = false;\n        }\n        if (ts.touchStart) {\n            let r = this.renderer;\n            r.pickingFramebuffer.activate();\n            r.pickingFramebuffer.readPixels(_currPickingColor, ts.nx, 1.0 - ts.ny, 1);\n            r.pickingFramebuffer.deactivate();\n            let co = r.getPickingObjectArr(_currPickingColor);\n            tpo = ts.pickingObject = co;\n            if (tpo) {\n                tpe = tpo.rendererEvents;\n                tpe && tpe.dispatch(tpe.touchstart, ts);\n            }\n            this.dispatch(_this.touchstart, ts);\n            ts.touchStart = false;\n        }\n        if (ts.doubleTouch) {\n            if (tpo) {\n                tpe = tpo.rendererEvents;\n                tpe && tpe.dispatch(tpe.doubletouch, ts);\n            }\n            this.dispatch(_this.doubletouch, ts);\n            ts.doubleTouch = false;\n        }\n        if (ts.touchEnd) {\n            if (tpo) {\n                tpe = tpo.rendererEvents;\n                tpe && tpe.dispatch(tpe.touchend, ts);\n            }\n            this.dispatch(_this.touchend, ts);\n            ts.x = 0;\n            ts.y = 0;\n            ts.touchEnd = false;\n        }\n        if (ts.moving) {\n            if (tpo) {\n                tpe = tpo.rendererEvents;\n                tpe && tpe.dispatch(tpe.touchmove, ts);\n            }\n            this.dispatch(_this.touchmove, ts);\n            ts.prev_x = ts.x;\n            ts.prev_y = ts.y;\n        }\n    }\n}\nconst RENDERER_EVENTS = [\n    /**\n     * Triggered before scene frame is rendered(before render nodes).\n     * @event og.RendererEvents#draw\n     */\n    \"draw\",\n    /**\n     * Triggered after all transparent object are drawn\n     * @event og.RendererEvents#drawtransparent\n     */\n    \"drawtransparent\",\n    /**\n     * Triggered after scene frame is rendered(after render nodes).\n     * @event og.RendererEvents#postdraw\n     */\n    \"postdraw\",\n    /**\n     * Triggered when screen is resized.\n     * @event og.RendererEvents#resize\n     */\n    \"resize\",\n    /**\n     * Triggered when screen is resized.\n     * @event og.RendererEvents#resizeend\n     */\n    \"resizeend\",\n    /**\n     * Mouse enters the work screen\n     * @event og.RendererEvents#mouseenter\n     */\n    \"mouseenter\",\n    /**\n     * Mouse leaves the work screen\n     * @event og.RendererEvents#mouseleave\n     */\n    \"mouseleave\",\n    /**\n     * Mouse is moving.\n     * @event og.RendererEvents#mousemove\n     */\n    \"mousemove\",\n    /**\n     * Mouse is just stopped.\n     * @event og.RendererEvents#mousestop\n     */\n    \"mousestop\",\n    /**\n     * Mouse left button clicked.\n     * @event og.RendererEvents#lclick\n     */\n    \"lclick\",\n    /**\n     * Mouse right button clicked.\n     * @event og.RendererEvents#rclick\n     */\n    \"rclick\",\n    /**\n     * Mouse middle button clicked.\n     * @event og.RendererEvents#mclick\n     */\n    \"mclick\",\n    /**\n     * Mouse left button double click.\n     * @event og.RendererEvents#ldblclick\n     */\n    \"ldblclick\",\n    /**\n     * Mouse right button double click.\n     * @event og.RendererEvents#rdblclick\n     */\n    \"rdblclick\",\n    /**\n     * Mouse middle button double click.\n     * @event og.RendererEvents#mdblclick\n     */\n    \"mdblclick\",\n    /**\n     * Mouse left button up(stop pressing).\n     * @event og.RendererEvents#lup\n     */\n    \"lup\",\n    /**\n     * Mouse right button up(stop pressing).\n     * @event og.RendererEvents#rup\n     */\n    \"rup\",\n    /**\n     * Mouse middle button up(stop pressing).\n     * @event og.RendererEvents#mup\n     */\n    \"mup\",\n    /**\n     * Mouse left button is just pressed down(start pressing).\n     * @event og.RendererEvents#ldown\n     */\n    \"ldown\",\n    /**\n     * Mouse right button is just pressed down(start pressing).\n     * @event og.RendererEvents#rdown\n     */\n    \"rdown\",\n    /**\n     * Mouse middle button is just pressed down(start pressing).\n     * @event og.RendererEvents#mdown\n     */\n    \"mdown\",\n    /**\n     * Mouse left button is pressing.\n     * @event og.RendererEvents#lhold\n     */\n    \"lhold\",\n    /**\n     * Mouse right button is pressing.\n     * @event og.RendererEvents#rhold\n     */\n    \"rhold\",\n    /**\n     * Mouse middle button is pressing.\n     * @event og.RendererEvents#mhold\n     */\n    \"mhold\",\n    /**\n     * Mouse wheel is rotated.\n     * @event og.RendererEvents#mousewheel\n     */\n    \"mousewheel\",\n    /**\n     * Triggered when touching starts.\n     * @event og.RendererEvents#touchstart\n     */\n    \"touchstart\",\n    /**\n     * Triggered when touching ends.\n     * @event og.RendererEvents#touchend\n     */\n    \"touchend\",\n    /**\n     * Triggered when touching cancel.\n     * @event og.RendererEvents#touchcancel\n     */\n    \"touchcancel\",\n    /**\n     * Triggered when touch is move.\n     * @event og.RendererEvents#touchmove\n     */\n    \"touchmove\",\n    /**\n     * Triggered when double touch.\n     * @event og.RendererEvents#doubletouch\n     */\n    \"doubletouch\",\n    /**\n     * Triggered when touch leaves picked object.\n     * @event og.RendererEvents#touchleave\n     */\n    \"touchleave\",\n    /**\n     * Triggered when touch enter picking object.\n     * @event og.RendererEvents#touchenter\n     */\n    \"touchenter\"\n];\nexport { RendererEvents };\n//# sourceMappingURL=RendererEvents.js.map","/**\n * 2D Rectangle class.\n * @class\n * @param {number} [left] - Left coordinate. 0 - default.\n * @param {number} [top] - Top coordinate. 0 - default.\n * @param {number} [right] - Right coordinate. 0 - default.\n * @param {number} [bottom] - Bottom coordinate. 0 - default.\n */\nclass Rectangle {\n    constructor(left = 0, top = 0, right = 0, bottom = 0) {\n        this.left = left;\n        this.right = right;\n        this.top = top;\n        this.bottom = bottom;\n    }\n    set(left = 0, top = 0, right = 0, bottom = 0) {\n        this.left = left;\n        this.right = right;\n        this.top = top;\n        this.bottom = bottom;\n    }\n    /**\n     * Clone rectangle object.\n     * @public\n     * @returns {Rectangle}\n     */\n    clone() {\n        return new Rectangle(this.left, this.top, this.right, this.bottom);\n    }\n    /**\n     * Returns rectangle width.\n     * @public\n     * @type {number}\n     */\n    getWidth() {\n        return Math.abs(this.right - this.left);\n    }\n    /**\n     * Returns rectangle height.\n     * @public\n     * @type {number}\n     */\n    getHeight() {\n        return Math.abs(this.bottom - this.top);\n    }\n    /**\n     * Returns rectangle area.\n     * @public\n     * @type {number}\n     */\n    getSquare() {\n        return this.getHeight() * this.getWidth();\n    }\n    /**\n     * Returns rectangle diagonal size.\n     * @public\n     * @type {number}\n     */\n    getDiagonal() {\n        let w = this.getWidth(), h = this.getHeight();\n        return Math.sqrt(h * h + w * w);\n    }\n    /**\n     * Returns true if rectangle fits their size in width and height.\n     * @public\n     * @param {number} width - Width.\n     * @param {number} height - Height.\n     * @type {boolean}\n     */\n    fit(width, height) {\n        return this.getWidth() === width && this.getHeight() === height;\n    }\n    isInside(x, y) {\n        return x >= this.left && x <= this.right && y >= this.top && y <= this.bottom;\n    }\n}\nexport { Rectangle };\n//# sourceMappingURL=Rectangle.js.map","import { QueueArray } from '../QueueArray';\nclass ImagesCacheManager {\n    constructor() {\n        this.imagesCache = {};\n        this._counter = 0;\n        this._pendingsQueue = new QueueArray();\n        this._imageIndexCounter = 0;\n    }\n    load(src, success) {\n        if (this.imagesCache[src]) {\n            success(this.imagesCache[src]);\n        }\n        else {\n            let req = { \"src\": src, \"success\": success };\n            if (this._counter >= 1) {\n                this._pendingsQueue.unshift(req);\n            }\n            else {\n                this._exec(req);\n            }\n        }\n    }\n    _exec(req) {\n        this._counter++;\n        const that = this;\n        let img = new Image();\n        img.crossOrigin = '';\n        img.onload = function () {\n            that.imagesCache[req.src] = img;\n            img.__nodeIndex = that._imageIndexCounter++;\n            req.success(img);\n            that._dequeueRequest();\n        };\n        img.onerror = function () {\n            that._dequeueRequest();\n        };\n        img.src = req.src;\n    }\n    _dequeueRequest() {\n        this._counter--;\n        if (this._pendingsQueue.length && this._counter < 1) {\n            while (this._pendingsQueue.length) {\n                let req = this._pendingsQueue.pop();\n                if (req) {\n                    if (this.imagesCache[req.src]) {\n                        if (this._counter <= 0) {\n                            this._counter = 0;\n                        }\n                        else {\n                            this._counter--;\n                        }\n                        req.success(this.imagesCache[req.src]);\n                    }\n                    else {\n                        this._exec(req);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n}\nexport { ImagesCacheManager };\n//# sourceMappingURL=ImagesCacheManager.js.map","import { ImageCanvas } from \"../ImageCanvas\";\nimport { Rectangle } from \"../Rectangle\";\nimport { ImagesCacheManager } from \"./ImagesCacheManager\";\n/**\n * Texture atlas stores images in one texture. Each image has its own\n * atlas texture coordinates.\n * @class\n * @param {number} [width=1024] - Texture atlas width, if it hasn't 1024 default.\n * @param {number} [height=1024] - Texture atlas height, if it hasn't 1024 default.\n */\nclass TextureAtlas {\n    constructor(width = 1024, height = 1024) {\n        this.nodes = new Map();\n        this.texture = null;\n        this.canvas = new ImageCanvas(width, height);\n        this.clearCanvas();\n        this._handler = null;\n        this._images = [];\n        this._btree = null;\n        this._imagesCacheManager = new ImagesCacheManager();\n        this.borderSize = 4;\n    }\n    /**\n     * Returns atlas javascript image object.\n     * @public\n     * @returns {HTMLImageElement} -\n     */\n    getImage() {\n        return this.canvas.getImage();\n    }\n    /**\n     * Returns canvas object.\n     * @public\n     * @returns {HTMLCanvasElement} -\n     */\n    getCanvas() {\n        return this.canvas.getCanvas();\n    }\n    /**\n     * Clear atlas with black.\n     * @public\n     */\n    clearCanvas() {\n        this.canvas.fillEmpty();\n    }\n    /**\n     * Sets openglobus gl handler that creates gl texture.\n     * @public\n     * @param {Handler} handler - WebGL handler.\n     */\n    assignHandler(handler) {\n        this._handler = handler;\n        this.createTexture();\n    }\n    /**\n     * Returns image diagonal size.\n     * @param {HTMLImageElementExt} image - Image object.\n     * @returns {number} -\n     */\n    getDiagonal(image) {\n        let w = image.atlasWidth || image.width, h = image.atlasHeight || image.height;\n        return Math.sqrt(w * w + h * h);\n    }\n    /**\n     * Adds image to the atlas and returns created node with texture coordinates of the stored image.\n     * @public\n     * @param {HTMLImageElementExt} image - Input javascript image object.\n     * @param {boolean} [fastInsert] - If it's true atlas doesn't restore all images again\n     * and store image in the current atlas scheme.\n     * @returns {TextureAtlasNode | undefined} -\n     */\n    addImage(image, fastInsert = false) {\n        if (!(image.width && image.height)) {\n            return;\n        }\n        this._images.push(image);\n        this._makeAtlas(fastInsert);\n        if (image.__nodeIndex != undefined) {\n            return this.get(image.__nodeIndex);\n        }\n    }\n    _completeNode(nodes, node) {\n        if (node) {\n            let w = this.canvas.getWidth(), h = this.canvas.getHeight();\n            let im = node.image;\n            let r = node.rect;\n            let bs = Math.round(this.borderSize * 0.5);\n            this.canvas.drawImage(im, r.left + bs, r.top + bs, im.atlasWidth || 0, im.atlasHeight || 0);\n            let tc = node.texCoords;\n            tc[0] = (r.left + bs) / w;\n            tc[1] = (r.top + bs) / h;\n            tc[2] = (r.left + bs) / w;\n            tc[3] = (r.bottom - bs) / h;\n            tc[4] = (r.right - bs) / w;\n            tc[5] = (r.bottom - bs) / h;\n            tc[6] = (r.right - bs) / w;\n            tc[7] = (r.bottom - bs) / h;\n            tc[8] = (r.right - bs) / w;\n            tc[9] = (r.top + bs) / h;\n            tc[10] = (r.left + bs) / w;\n            tc[11] = (r.top + bs) / h;\n            nodes.set(im.__nodeIndex, node);\n        }\n    }\n    /**\n     * Main atlas making function.\n     * @protected\n     * @param {boolean} [fastInsert] - If it's true atlas doesn't restore all images again\n     * and store image in the current atlas scheme.\n     */\n    _makeAtlas(fastInsert = false) {\n        if (fastInsert && this._btree) {\n            let im = this._images[this._images.length - 1];\n            this._completeNode(this.nodes, this._btree.insert(im));\n        }\n        else {\n            let im = this._images.slice(0);\n            im.sort(function (b, a) {\n                return ((a.atlasWidth || a.width) - (b.atlasWidth || b.width) ||\n                    (a.atlasHeight || a.height) - (b.atlasHeight || b.height));\n            });\n            this._btree = new TextureAtlasNode(new Rectangle(0, 0, this.canvas.getWidth(), this.canvas.getHeight()));\n            this._btree.atlas = this;\n            this.clearCanvas();\n            let newNodes = new Map();\n            for (let i = 0; i < im.length; i++) {\n                this._completeNode(newNodes, this._btree.insert(im[i]));\n            }\n            //@ts-ignore\n            this.nodes = null;\n            this.nodes = newNodes;\n        }\n    }\n    get(key) {\n        return this.nodes.get(key);\n    }\n    set(key, value) {\n        this.nodes.set(key, value);\n    }\n    /**\n     * Creates atlas gl texture.\n     * @public\n     */\n    createTexture(img, internalFormat) {\n        if (this._handler) {\n            this._handler.gl.deleteTexture(this.texture);\n            if (img) {\n                this.canvas.resize(img.width, img.height);\n                this.canvas.drawImage(img, 0, 0, img.width, img.height);\n            }\n            this.texture = this._handler.createTexture_l(this.canvas.getCanvas(), internalFormat);\n        }\n    }\n    /**\n     * Asynchronous function that loads and creates image to the image cache, and call success callback when it's done.\n     * @public\n     * @param {string} src - Image object src string.\n     * @param {ImagesCacheManagerCallback} success - The callback that handles the image loads done.\n     */\n    loadImage(src, success) {\n        this._imagesCacheManager.load(src, success);\n    }\n    getImageTexCoordinates(img) {\n        if (img.__nodeIndex != null) {\n            let n = this.get(img.__nodeIndex);\n            if (n) {\n                return n.texCoords;\n            }\n        }\n    }\n}\n/**\n * Atlas binary tree node.\n * @class\n * @param {Rectangle} rect - Node image rectangle.\n * @param {number[]} texCoords - Node image rectangle.\n */\nclass TextureAtlasNode {\n    constructor(rect, texCoords) {\n        this.childNodes = null;\n        this.image = null;\n        this.rect = rect || new Rectangle();\n        this.texCoords = texCoords || [];\n        this.atlas = null;\n    }\n    insert(img) {\n        if (this.childNodes) {\n            let newNode = this.childNodes[0].insert(img);\n            if (newNode) {\n                return newNode;\n            }\n            return this.childNodes[1].insert(img);\n        }\n        else {\n            if (this.image != null) {\n                return;\n            }\n            let rc = this.rect;\n            const w = (img.atlasWidth || img.width) + this.atlas.borderSize;\n            const h = (img.atlasHeight || img.height) + this.atlas.borderSize;\n            if (w > rc.getWidth() || h > rc.getHeight()) {\n                return;\n            }\n            if (rc.fit(w, h)) {\n                this.image = img;\n                return this;\n            }\n            this.childNodes = new Array(2);\n            this.childNodes[0] = new TextureAtlasNode();\n            this.childNodes[0].atlas = this.atlas;\n            this.childNodes[1] = new TextureAtlasNode();\n            this.childNodes[1].atlas = this.atlas;\n            const dw = rc.getWidth() - w;\n            const dh = rc.getHeight() - h;\n            if (dw > dh) {\n                // this.childNodes[0].rect = new Rectangle(rc.left, rc.top, rc.left + w, rc.bottom);\n                // this.childNodes[1].rect = new Rectangle(rc.left + w, rc.top, rc.right, rc.bottom);\n                this.childNodes[0].rect.set(rc.left, rc.top, rc.left + w, rc.bottom);\n                this.childNodes[1].rect.set(rc.left + w, rc.top, rc.right, rc.bottom);\n            }\n            else {\n                // this.childNodes[0].rect = new Rectangle(rc.left, rc.top, rc.right, rc.top + h);\n                // this.childNodes[1].rect = new Rectangle(rc.left, rc.top + h, rc.right, rc.bottom);\n                this.childNodes[0].rect.set(rc.left, rc.top, rc.right, rc.top + h);\n                this.childNodes[1].rect.set(rc.left, rc.top + h, rc.right, rc.bottom);\n            }\n            return this.childNodes[0].insert(img);\n        }\n    }\n}\nexport { TextureAtlas, TextureAtlasNode };\n//# sourceMappingURL=TextureAtlas.js.map","import { Deferred } from '../Deferred';\nimport { Rectangle } from '../Rectangle';\nimport { TextureAtlas, TextureAtlasNode } from './TextureAtlas';\n//@todo: get the value from shader module\nconst MAX_SIZE = 11;\nclass FontTextureAtlas extends TextureAtlas {\n    constructor(width, height) {\n        super(width, height);\n        this.width = 0;\n        this.height = 0;\n        this.gliphSize = 0;\n        this.distanceRange = 0;\n        this.nodes = new Map();\n        this.kernings = {};\n    }\n    get(key) {\n        return this.nodes.get(key);\n    }\n}\nclass FontTextureAtlasNode extends TextureAtlasNode {\n    constructor(rect, texCoords) {\n        super(rect, texCoords);\n        this.emptySize = 1;\n        this.metrics = {\n            id: 0,\n            char: \"\",\n            width: 0,\n            height: 0,\n            x: 0,\n            y: 0,\n            chnl: 0,\n            index: 0,\n            page: 0,\n            xadvance: 0,\n            xoffset: 0,\n            yoffset: 0,\n            nChar: \"\",\n            nCode: 0,\n            nWidth: 0,\n            nHeight: 0,\n            nAdvance: 0,\n            nXOffset: 0,\n            nYOffset: 0\n        };\n    }\n}\nclass FontAtlas {\n    constructor(catalogSrc) {\n        this.atlasesArr = [];\n        this.atlasIndexes = {};\n        this.atlasIndexesDeferred = {};\n        this.tokenImageSize = 64;\n        this.samplerArr = new Uint32Array(MAX_SIZE);\n        this.sdfParamsArr = new Float32Array(MAX_SIZE * 4);\n        this._handler = null;\n        this.catalogSrc = catalogSrc || \"./\";\n    }\n    assignHandler(handler) {\n        this._handler = handler;\n    }\n    getFontIndex(face) {\n        let fullName = this.getFullIndex(face);\n        // Try to load font from the directory\n        if (!this.atlasIndexes[fullName]) {\n            this.loadFont(face, this.catalogSrc, `${face}.json`);\n        }\n        if (!this.atlasIndexesDeferred[fullName]) {\n            this.atlasIndexesDeferred[fullName] = new Deferred();\n        }\n        return this.atlasIndexesDeferred[fullName].promise;\n    }\n    getFullIndex(face) {\n        return face.trim().toLowerCase();\n    }\n    _applyFontDataToAtlas(atlas, data, index = 0) {\n        let chars = data.chars;\n        atlas.height = data.common.scaleH;\n        atlas.width = data.common.scaleW;\n        atlas.gliphSize = data.info.size;\n        atlas.distanceRange = data.distanceField.distanceRange;\n        let w = atlas.width, h = atlas.height, s = atlas.gliphSize;\n        this.sdfParamsArr[index * 4] = w;\n        this.sdfParamsArr[index * 4 + 1] = h;\n        this.sdfParamsArr[index * 4 + 2] = s;\n        this.sdfParamsArr[index * 4 + 3] = atlas.distanceRange;\n        let idToChar = {};\n        for (let i = 0; i < chars.length; i++) {\n            let ci = chars[i];\n            let ti = ci.char;\n            idToChar[ci.id] = ti;\n            let r = new Rectangle(ci.x, ci.y, ci.x + ci.width, ci.y + ci.height);\n            let tc = new Array(12);\n            tc[0] = r.left / w;\n            tc[1] = r.top / h;\n            tc[2] = r.left / w;\n            tc[3] = r.bottom / h;\n            tc[4] = r.right / w;\n            tc[5] = r.bottom / h;\n            tc[6] = r.right / w;\n            tc[7] = r.bottom / h;\n            tc[8] = r.right / w;\n            tc[9] = r.top / h;\n            tc[10] = r.left / w;\n            tc[11] = r.top / h;\n            let taNode = new FontTextureAtlasNode(r, tc);\n            let ciNorm = ci.char.normalize('NFKC');\n            let ciCode = ciNorm.charCodeAt(0);\n            //taNode.metrics = ci;\n            let m = taNode.metrics;\n            m.id = ci.id;\n            m.char = ci.char;\n            m.width = ci.width;\n            m.height = ci.height;\n            m.x = ci.x;\n            m.y = ci.y;\n            m.chnl = ci.chnl;\n            m.index = ci.index;\n            m.page = ci.page;\n            m.xadvance = ci.xadvance;\n            m.xoffset = ci.xoffset;\n            m.yoffset = ci.yoffset;\n            m.nChar = ciNorm;\n            m.nCode = ciCode;\n            m.nWidth = taNode.metrics.width / s;\n            m.nHeight = taNode.metrics.height / s;\n            m.nAdvance = taNode.metrics.xadvance / s;\n            m.nXOffset = taNode.metrics.xoffset / s;\n            m.nYOffset = 1.0 - taNode.metrics.yoffset / s;\n            taNode.emptySize = 1;\n            atlas.nodes.set(ciNorm.charCodeAt(0), taNode);\n        }\n        atlas.kernings = {};\n        for (let i = 0; i < data.kernings.length; i++) {\n            let ki = data.kernings[i];\n            let first = ki.first, second = ki.second;\n            //let charFirst = idToChar[first],\n            //    charSecond = idToChar[second];\n            // if (!atlas.kernings[charFirst]) {\n            //     atlas.kernings[charFirst] = {};\n            // }\n            //\n            // atlas.kernings[charFirst][charSecond] = ki.amount / s;\n            if (!atlas.kernings[first]) {\n                atlas.kernings[first] = {};\n            }\n            atlas.kernings[first][second] = ki.amount / s;\n        }\n    }\n    initFont(faceName, dataJson, imageBase64) {\n        let index = this.atlasesArr.length;\n        let fullName = this.getFullIndex(faceName);\n        this.atlasIndexes[fullName] = index;\n        let def = this.atlasIndexesDeferred[fullName];\n        if (!def) {\n            def = this.atlasIndexesDeferred[fullName] = new Deferred();\n        }\n        this.samplerArr[this.atlasesArr.length] = index;\n        // TODO: FontTextureAtlas();\n        let atlas = new FontTextureAtlas();\n        atlas.height = 0;\n        atlas.width = 0;\n        atlas.gliphSize = 0;\n        atlas.distanceRange = 0;\n        atlas.kernings = {};\n        atlas.assignHandler(this._handler);\n        this.atlasesArr[index] = atlas;\n        this._applyFontDataToAtlas(atlas, dataJson, index);\n        let img = new Image();\n        img.onload = () => {\n            this._createTexture(atlas, img);\n            def.resolve(index);\n        };\n        img.src = imageBase64;\n    }\n    _createTexture(atlas, img) {\n        atlas.createTexture(img);\n    }\n    loadFont(faceName, srcDir, atlasUrl) {\n        let index = this.atlasesArr.length;\n        let fullName = this.getFullIndex(faceName);\n        this.atlasIndexes[fullName] = index;\n        let def = this.atlasIndexesDeferred[fullName];\n        if (!def) {\n            def = this.atlasIndexesDeferred[fullName] = new Deferred();\n        }\n        this.samplerArr[this.atlasesArr.length] = index;\n        // TODO: FontTextureAtlas();\n        let atlas = new FontTextureAtlas();\n        atlas.height = 0;\n        atlas.width = 0;\n        atlas.gliphSize = 0;\n        atlas.distanceRange = 0;\n        atlas.kernings = {};\n        atlas.assignHandler(this._handler);\n        this.atlasesArr[index] = atlas;\n        fetch(`${srcDir}/${atlasUrl}`)\n            .then((response) => {\n            if (!response.ok) {\n                throw Error(`Unable to load \"${srcDir}/${atlasUrl}\"`);\n            }\n            //return response.json(response);\n            return response.json();\n        })\n            .then((data) => {\n            this._applyFontDataToAtlas(atlas, data, index);\n            let img = new Image();\n            img.onload = () => {\n                this._createTexture(atlas, img);\n                def.resolve(index);\n            };\n            img.src = `${srcDir}/${data.pages[0]}`;\n            img.crossOrigin = \"Anonymous\";\n        })\n            .catch(err => {\n            def.reject();\n            return { 'status': \"error\", 'msg': err.toString() };\n        });\n    }\n}\nexport { FontAtlas };\n//# sourceMappingURL=FontAtlas.js.map","import { Camera } from \"../camera/Camera\";\nimport { cons } from \"../cons\";\nimport { createRendererEvents } from \"./RendererEvents\";\nimport { depth } from \"../shaders/depth\";\nimport { Framebuffer, Multisample } from \"../webgl/index\";\nimport { FontAtlas } from \"../utils/FontAtlas\";\nimport { input } from \"../input/input\";\nimport { isEmpty } from \"../utils/shared\";\nimport { LabelWorker } from \"../entity/LabelWorker\";\nimport { randomi } from \"../math\";\nimport { screenFrame } from \"../shaders/screenFrame\";\nimport { toneMapping } from \"../shaders/toneMapping\";\nimport { TextureAtlas } from \"../utils/TextureAtlas\";\nimport { Vec2 } from \"../math/Vec2\";\nimport { Vec3 } from \"../math/Vec3\";\nconst MSAA_DEFAULT = 0;\nlet __pickingCallbackCounter__ = 0;\nlet __depthCallbackCounter__ = 0;\nlet __distanceCallbackCounter__ = 0;\nfunction clientWaitAsync(gl, sync, flags) {\n    return new Promise((resolve, reject) => {\n        function check() {\n            const res = gl.clientWaitSync(sync, flags, 0);\n            if (res == gl.WAIT_FAILED) {\n                reject();\n            }\n            else if (res == gl.TIMEOUT_EXPIRED) {\n                requestAnimationFrame(check);\n            }\n            else {\n                resolve();\n            }\n        }\n        check();\n    });\n}\n/**\n * Represents high level WebGL context interface that starts WebGL handler working in real time.\n * @class\n * @param {Handler} handler - WebGL handler context.\n * @param {Object} [params] - Renderer parameters:\n * @fires EventsHandler<RendererEventsType>#draw\n * @fires EventsHandler<RendererEventsType>#resize\n * @fires EventsHandler<RendererEventsType>#mousemove\n * @fires EventsHandler<RendererEventsType>#mousestop\n * @fires EventsHandler<RendererEventsType>#lclick\n * @fires EventsHandler<RendererEventsType>#rclick\n * @fires EventsHandler<RendererEventsType>#mclick\n * @fires EventsHandler<RendererEventsType>#ldblclick\n * @fires EventsHandler<RendererEventsType>#rdblclick\n * @fires EventsHandler<RendererEventsType>#mdblclick\n * @fires EventsHandler<RendererEventsType>#lup\n * @fires EventsHandler<RendererEventsType>#rup\n * @fires EventsHandler<RendererEventsType>#mup\n * @fires EventsHandler<RendererEventsType>#ldown\n * @fires EventsHandler<RendererEventsType>#rdown\n * @fires EventsHandler<RendererEventsType>#mdown\n * @fires EventsHandler<RendererEventsType>#lhold\n * @fires EventsHandler<RendererEventsType>#rhold\n * @fires EventsHandler<RendererEventsType>#mhold\n * @fires EventsHandler<RendererEventsType>#mousewheel\n * @fires EventsHandler<RendererEventsType>#touchstart\n * @fires EventsHandler<RendererEventsType>#touchend\n * @fires EventsHandler<RendererEventsType>#touchcancel\n * @fires EventsHandler<RendererEventsType>#touchmove\n * @fires EventsHandler<RendererEventsType>#doubletouch\n * @fires EventsHandler<RendererEventsType>#touchleave\n * @fires EventsHandler<RendererEventsType>#touchenter\n */\nlet __resizeTimeout;\nclass Renderer {\n    constructor(handler, params = {}) {\n        this._readPickingBuffer_webgl1 = () => {\n            this.pickingFramebuffer.activate();\n            this.pickingFramebuffer.readAllPixels(this._tempPickingPix_);\n            this.pickingFramebuffer.deactivate();\n        };\n        this._readPickingBuffer_webgl2 = () => {\n            const gl = this.handler.gl;\n            const buf = this._pickingPixelBuffer;\n            if (!this._skipPickingFrame) {\n                this._skipPickingFrame = true;\n                let dest = this._tempPickingPix_;\n                let w = this.pickingFramebuffer.width, h = this.pickingFramebuffer.height;\n                this.pickingFramebuffer.activate();\n                gl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n                gl.bufferData(gl.PIXEL_PACK_BUFFER, dest.byteLength, gl.STREAM_READ);\n                gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, 0);\n                gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n                this.pickingFramebuffer.deactivate();\n                const sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n                gl.flush();\n                clientWaitAsync(gl, sync, 0).then(() => {\n                    this._skipPickingFrame = false;\n                    gl.deleteSync(sync);\n                    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n                    gl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, dest);\n                    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n                });\n            }\n        };\n        this._readDistanceBuffer_webgl1 = () => {\n            this.distanceFramebuffer.activate();\n            this.distanceFramebuffer.readAllPixels(this._tempDistancePix_);\n            this.distanceFramebuffer.deactivate();\n        };\n        this._readDistanceBuffer_webgl2 = () => {\n            const gl = this.handler.gl;\n            const buf = this._distancePixelBuffer;\n            if (!this._skipDistanceFrame) {\n                this._skipDistanceFrame = true;\n                let dest = this._tempDistancePix_;\n                let w = this.distanceFramebuffer.width, h = this.distanceFramebuffer.height;\n                this.distanceFramebuffer.activate();\n                gl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n                gl.bufferData(gl.PIXEL_PACK_BUFFER, dest.byteLength, gl.STREAM_READ);\n                gl.readPixels(0, 0, w, h, gl.RGBA, gl.UNSIGNED_BYTE, 0);\n                gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n                this.distanceFramebuffer.deactivate();\n                const sync = gl.fenceSync(gl.SYNC_GPU_COMMANDS_COMPLETE, 0);\n                gl.flush();\n                clientWaitAsync(gl, sync, 0).then(() => {\n                    this._skipDistanceFrame = false;\n                    gl.deleteSync(sync);\n                    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, buf);\n                    gl.getBufferSubData(gl.PIXEL_PACK_BUFFER, 0, dest);\n                    gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n                });\n            }\n        };\n        this.div = null;\n        this.handler = handler;\n        this.exposure = 3.01;\n        this.gamma = 0.47;\n        this.whitepoint = 1.0;\n        this.brightThreshold = 0.9;\n        this._renderNodesArr = [];\n        this.renderNodes = {};\n        this.activeCamera = null;\n        this.events = createRendererEvents(this);\n        this.controls = {};\n        if (params.controls) {\n            for (let i in params.controls) {\n                this.controls[params.controls[i].name] = params.controls[i];\n            }\n        }\n        this.controlsBag = {};\n        this.colorObjects = new Map();\n        this._pickingCallbacks = [];\n        this.pickingFramebuffer = null;\n        this._tempPickingPix_ = new Uint8Array([]);\n        this.distanceFramebuffer = null;\n        this._distanceCallbacks = [];\n        this._tempDistancePix_ = new Uint8Array([]);\n        this._depthCallbacks = [];\n        this.depthFramebuffer = null;\n        let urlParams = new URLSearchParams(location.search);\n        let msaaParam = urlParams.get('og_msaa');\n        if (msaaParam) {\n            this._msaa = Number(urlParams.get('og_msaa'));\n        }\n        else {\n            this._msaa = params.msaa != undefined ? params.msaa : MSAA_DEFAULT;\n        }\n        this._internalFormat = \"RGBA16F\";\n        this._format = \"RGBA\";\n        this._type = \"FLOAT\";\n        this.sceneFramebuffer = null;\n        this.blitFramebuffer = null;\n        this.toneMappingFramebuffer = null;\n        this._initialized = false;\n        /**\n         * Texture atlas for the billboards images. One atlas per node.\n         * @public\n         * @type {TextureAtlas}\n         */\n        this.billboardsTextureAtlas = new TextureAtlas();\n        /**\n         * Texture atlas for the billboards images. One atlas per node.\n         * @public\n         * @type {TextureAtlas}\n         */\n        this.geoObjectsTextureAtlas = new TextureAtlas();\n        /**\n         * Texture font atlas for the font families and styles. One atlas per node.\n         * @public\n         * @type {FontAtlas}\n         */\n        this.fontAtlas = new FontAtlas(params.fontsSrc);\n        this._entityCollections = [];\n        this._currentOutput = \"screen\";\n        this._fnScreenFrame = null;\n        this.labelWorker = new LabelWorker(4);\n        this.__useDistanceFramebuffer__ = true;\n        this.screenDepthFramebuffer = null;\n        this.screenFramePositionBuffer = null;\n        this.screenTexture = {};\n        this.outputTexture = null;\n        this._skipDistanceFrame = false;\n        this._distancePixelBuffer = null;\n        this._skipPickingFrame = false;\n        this._pickingPixelBuffer = null;\n        this._readDistanceBuffer = this._readDistanceBuffer_webgl2;\n        this._readPickingBuffer = this._readPickingBuffer_webgl2;\n        if (params.autoActivate || isEmpty(params.autoActivate)) {\n            this.start();\n        }\n    }\n    enableBlendOneSrcAlpha() {\n        let gl = this.handler.gl;\n        gl.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFunc(gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n    }\n    enableBlendDefault() {\n        let gl = this.handler.gl;\n        gl.enable(gl.BLEND);\n        gl.blendEquation(gl.FUNC_ADD);\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE);\n    }\n    /**\n     * Sets renderer events activity.\n     * @param {Boolean} activity - Events activity.\n     */\n    setEventsActivity(activity) {\n        this.events.active = activity;\n    }\n    addDepthCallback(sender, callback) {\n        let id = __depthCallbackCounter__++;\n        this._depthCallbacks.push({\n            id: id, callback: callback, sender: sender\n        });\n        return id;\n    }\n    removeDepthCallback(id) {\n        for (let i = 0; i < this._depthCallbacks.length; i++) {\n            if (id === this._depthCallbacks[i].id) {\n                this._depthCallbacks.splice(i, 1);\n                break;\n            }\n        }\n    }\n    addDistanceCallback(sender, callback) {\n        let id = __distanceCallbackCounter__++;\n        this._distanceCallbacks.push({\n            id: id, callback: callback, sender: sender\n        });\n        return id;\n    }\n    removeDistanceCallback(id) {\n        for (let i = 0; i < this._distanceCallbacks.length; i++) {\n            if (id === this._distanceCallbacks[i].id) {\n                this._distanceCallbacks.splice(i, 1);\n                break;\n            }\n        }\n    }\n    /**\n     * Adds picking rendering callback function.\n     * @param {object} sender - Callback context.\n     * @param {Function} callback - Rendering callback.\n     * @returns {Number} Handler id\n     */\n    addPickingCallback(sender, callback) {\n        let id = __pickingCallbackCounter__++;\n        this._pickingCallbacks.push({\n            id: id, callback: callback, sender: sender\n        });\n        return id;\n    }\n    /**\n     * Removes picking rendering callback function.\n     * @param {Number} id - Handler id to remove.\n     */\n    removePickingCallback(id) {\n        for (let i = 0; i < this._pickingCallbacks.length; i++) {\n            if (id === this._pickingCallbacks[i].id) {\n                this._pickingCallbacks.splice(i, 1);\n                break;\n            }\n        }\n    }\n    getPickingObject(r, g, b) {\n        return this.colorObjects.get(`${r}_${g}_${b}`);\n    }\n    getPickingObjectArr(arr) {\n        return this.colorObjects.get(`${arr[0]}_${arr[1]}_${arr[2]}`);\n    }\n    getPickingObject3v(vec) {\n        return this.colorObjects.get(`${vec.x}_${vec.y}_${vec.z}`);\n    }\n    /**\n     * Assign picking color to the object.\n     * @public\n     * @param {Object} obj - Object that presume to be picked.\n     */\n    assignPickingColor(obj) {\n        if (!obj._pickingColor || obj._pickingColor.isZero()) {\n            let r = 0, g = 0, b = 0;\n            let str = \"0_0_0\";\n            while (!(r || g || b) || this.colorObjects.has(str)) {\n                r = randomi(1, 255);\n                g = randomi(1, 255);\n                b = randomi(1, 255);\n                str = `${r}_${g}_${b}`;\n            }\n            if (!obj._pickingColor) {\n                obj._pickingColor = new Vec3(r, g, b);\n            }\n            else {\n                obj._pickingColor.set(r, g, b);\n            }\n            obj._pickingColorU = new Float32Array([r / 255, g / 255, b / 255]);\n            this.colorObjects.set(str, obj);\n        }\n    }\n    /**\n     * Removes picking color from object.\n     * @public\n     * @param {Object} obj - Object to remove picking color.\n     */\n    clearPickingColor(obj) {\n        if (obj._pickingColor && !obj._pickingColor.isZero()) {\n            let c = obj._pickingColor;\n            if (!c.isZero()) {\n                this.colorObjects.delete(`${c.x}_${c.y}_${c.z}`);\n                c.x = c.y = c.z = 0;\n            }\n        }\n    }\n    /**\n     * Get the client width.\n     * @public\n     * @returns {number} -\n     */\n    getWidth() {\n        return this.handler.canvas.clientWidth;\n    }\n    /**\n     * Get the client height.\n     * @public\n     * @returns {number} -\n     */\n    getHeight() {\n        return this.handler.canvas.clientHeight;\n    }\n    /**\n     * Get center of the canvas\n     * @public\n     * @returns {Vec2} -\n     */\n    getCenter() {\n        let cnv = this.handler.canvas;\n        return new Vec2(Math.round(cnv.width * 0.5), Math.round(cnv.height * 0.5));\n    }\n    /**\n     * Get center of the screen viewport\n     * @public\n     * @returns {Vec2} -\n     */\n    getClientCenter() {\n        let cnv = this.handler.canvas;\n        return new Vec2(Math.round(cnv.clientWidth * 0.5), Math.round(cnv.clientHeight * 0.5));\n    }\n    /**\n     * Add the given control to the renderer.\n     * @param {Control} control - Control.\n     */\n    addControl(control) {\n        control.addTo(this);\n    }\n    /**\n     * Add the given controls array to the planet node.\n     * @param {Array.<Control>} cArr - Control array.\n     */\n    addControls(cArr) {\n        for (let i = 0; i < cArr.length; i++) {\n            cArr[i].addTo(this);\n        }\n    }\n    /**\n     * Remove control from the renderer.\n     * @param {Control} control  - Control.\n     */\n    removeControl(control) {\n        control.remove();\n    }\n    isInitialized() {\n        return this._initialized;\n    }\n    /**\n     * Renderer initialization.\n     * @public\n     */\n    initialize() {\n        if (this._initialized) {\n            return;\n        }\n        else {\n            this._initialized = true;\n        }\n        this.handler.initialize();\n        this.billboardsTextureAtlas.assignHandler(this.handler);\n        this.geoObjectsTextureAtlas.assignHandler(this.handler);\n        this.fontAtlas.assignHandler(this.handler);\n        this.handler.setFrameCallback(() => {\n            this.draw();\n        });\n        this.activeCamera = new Camera(this, {\n            eye: new Vec3(0, 0, 0), look: new Vec3(0, 0, -1), up: new Vec3(0, 1, 0)\n        });\n        this.events.initialize();\n        // Bind console key\n        this.events.on(\"charkeypress\", input.KEY_APOSTROPHE, function () {\n            cons.setVisibility(!cons.getVisibility());\n        });\n        this.handler.addProgram(screenFrame());\n        this.pickingFramebuffer = new Framebuffer(this.handler, {\n            width: 640, height: 480\n        });\n        this.pickingFramebuffer.init();\n        this._tempPickingPix_ = new Uint8Array(this.pickingFramebuffer.width * this.pickingFramebuffer.height * 4);\n        this.distanceFramebuffer = new Framebuffer(this.handler, {\n            width: 320, height: 240\n        });\n        this.distanceFramebuffer.init();\n        this._tempDistancePix_ = new Uint8Array(this.distanceFramebuffer.width * this.distanceFramebuffer.height * 4);\n        //this._tempDistancePix_ = new Uint8Array(4);\n        this.depthFramebuffer = new Framebuffer(this.handler, {\n            size: 2,\n            internalFormat: [\"RGBA\", \"DEPTH_COMPONENT24\"],\n            format: [\"RGBA\", \"DEPTH_COMPONENT\"],\n            type: [\"UNSIGNED_BYTE\", \"UNSIGNED_INT\"],\n            attachment: [\"COLOR_ATTACHMENT\", \"DEPTH_ATTACHMENT\"],\n            useDepth: false\n        });\n        this.depthFramebuffer.init();\n        this.screenDepthFramebuffer = new Framebuffer(this.handler, {\n            useDepth: false\n        });\n        this.screenDepthFramebuffer.init();\n        if (this.handler.gl.type === \"webgl\") {\n            this._readDistanceBuffer = this._readDistanceBuffer_webgl1;\n            this._readPickingBuffer = this._readPickingBuffer_webgl1;\n            this.sceneFramebuffer = new Framebuffer(this.handler);\n            this.sceneFramebuffer.init();\n            this._fnScreenFrame = this._screenFrameNoMSAA;\n            this.screenTexture = {\n                screen: this.sceneFramebuffer.textures[0],\n                picking: this.pickingFramebuffer.textures[0],\n                distance: this.distanceFramebuffer.textures[0],\n                depth: this.screenDepthFramebuffer.textures[0]\n            };\n        }\n        else {\n            let _maxMSAA = this.getMaxMSAA(this._internalFormat);\n            if (this._msaa > _maxMSAA) {\n                this._msaa = _maxMSAA;\n            }\n            this.handler.addPrograms([toneMapping()]);\n            this.handler.addPrograms([depth()]);\n            this.sceneFramebuffer = new Multisample(this.handler, {\n                size: 1,\n                msaa: this._msaa,\n                internalFormat: this._internalFormat,\n                filter: \"LINEAR\"\n            });\n            this.sceneFramebuffer.init();\n            this.blitFramebuffer = new Framebuffer(this.handler, {\n                size: 1,\n                useDepth: false,\n                internalFormat: this._internalFormat,\n                format: this._format,\n                type: this._type,\n                filter: \"NEAREST\"\n            });\n            this.blitFramebuffer.init();\n            this.toneMappingFramebuffer = new Framebuffer(this.handler, {\n                useDepth: false\n            });\n            this.toneMappingFramebuffer.init();\n            this._fnScreenFrame = this._screenFrameMSAA;\n            this.screenTexture = {\n                screen: this.toneMappingFramebuffer.textures[0],\n                picking: this.pickingFramebuffer.textures[0],\n                distance: this.distanceFramebuffer.textures[0],\n                depth: this.screenDepthFramebuffer.textures[0],\n                frustum: this.depthFramebuffer.textures[0]\n            };\n            this._initReadPixelsBuffers();\n        }\n        this.handler.ONCANVASRESIZE = () => {\n            this._resizeStart();\n            this.events.dispatch(this.events.resize, this.handler.canvas);\n            this._resizeEnd();\n            //clearTimeout(__resizeTimeout);\n            // __resizeTimeout = setTimeout(() => {\n            //     this._resizeEnd();\n            //     this.events.dispatch(this.events.resizeend, this.handler.canvas);\n            // }, 320);\n            this.events.dispatch(this.events.resizeend, this.handler.canvas);\n        };\n        this.screenFramePositionBuffer = this.handler.createArrayBuffer(new Float32Array([1, 1, -1, 1, 1, -1, -1, -1]), 2, 4);\n        this.outputTexture = this.screenTexture.screen;\n        this._initializeRenderNodes();\n        this._initializeControls();\n    }\n    _initReadPixelsBuffers() {\n        let gl = this.handler.gl;\n        this._distancePixelBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, this._distancePixelBuffer);\n        gl.bufferData(gl.PIXEL_PACK_BUFFER, this.distanceFramebuffer.width * this.distanceFramebuffer.height * 4, gl.STREAM_READ);\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n        this._pickingPixelBuffer = gl.createBuffer();\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, this._pickingPixelBuffer);\n        gl.bufferData(gl.PIXEL_PACK_BUFFER, this.pickingFramebuffer.width * this.pickingFramebuffer.height * 4, gl.STREAM_READ);\n        gl.bindBuffer(gl.PIXEL_PACK_BUFFER, null);\n    }\n    _initializeControls() {\n        let temp = this.controls;\n        this.controls = {};\n        for (let i in temp) {\n            this.addControl(temp[i]);\n        }\n    }\n    resize() {\n        this._resizeEnd();\n    }\n    setCurrentScreen(screenName) {\n        this._currentOutput = screenName;\n        if (this.screenTexture[screenName]) {\n            this.outputTexture = this.screenTexture[screenName];\n        }\n    }\n    _resizeStart() {\n        let c = this.handler.canvas;\n        this.activeCamera.setAspectRatio(c.width / c.height);\n        this.sceneFramebuffer.setSize(c.width * 0.5, c.height * 0.5);\n        this.blitFramebuffer && this.blitFramebuffer.setSize(c.width * 0.5, c.height * 0.5, true);\n    }\n    _resizeEnd() {\n        let c = this.handler.canvas;\n        this.activeCamera.setAspectRatio(c.width / c.height);\n        this.sceneFramebuffer.setSize(c.width, c.height);\n        this.blitFramebuffer && this.blitFramebuffer.setSize(c.width, c.height, true);\n        this.toneMappingFramebuffer && this.toneMappingFramebuffer.setSize(c.width, c.height, true);\n        this.depthFramebuffer && this.depthFramebuffer.setSize(c.clientWidth, c.clientHeight, true);\n        this.screenDepthFramebuffer && this.screenDepthFramebuffer.setSize(c.clientWidth, c.clientHeight, true);\n        if (this.handler.gl.type === \"webgl\") {\n            this.screenTexture.screen = this.sceneFramebuffer.textures[0];\n            this.screenTexture.picking = this.pickingFramebuffer.textures[0];\n            this.screenTexture.distance = this.distanceFramebuffer.textures[0];\n            this.screenTexture.depth = this.screenDepthFramebuffer.textures[0];\n            this.screenTexture.frustum = this.depthFramebuffer.textures[0];\n        }\n        else {\n            this.screenTexture.screen = this.toneMappingFramebuffer.textures[0];\n            this.screenTexture.picking = this.pickingFramebuffer.textures[0];\n            this.screenTexture.distance = this.distanceFramebuffer.textures[0];\n            this.screenTexture.depth = this.screenDepthFramebuffer.textures[0];\n            this.screenTexture.frustum = this.depthFramebuffer.textures[0];\n        }\n        this.setCurrentScreen(this._currentOutput);\n    }\n    removeNode(renderNode) {\n        // TODO: replace from RenderNode to this method\n        renderNode.remove();\n    }\n    /**\n     * Adds render node to the renderer.\n     * @public\n     * @param {RenderNode} renderNode - Render node.\n     */\n    addNode(renderNode) {\n        if (!this.renderNodes[renderNode.name]) {\n            renderNode.assign(this);\n            this._renderNodesArr.unshift(renderNode);\n            this.renderNodes[renderNode.name] = renderNode;\n        }\n        else {\n            cons.logWrn(`Node name ${renderNode.name} already exists.`);\n        }\n    }\n    _initializeRenderNodes() {\n        for (let i = 0; i < this._renderNodesArr.length; i++) {\n            this._renderNodesArr[i].initialize();\n        }\n    }\n    /**\n     * Adds render node to the renderer before specific node.\n     * @public\n     * @param {RenderNode} renderNode - Render node.\n     * @param {RenderNode} renderNodeBefore - Insert before the renderNodeBefore node.\n     */\n    addNodeBefore(renderNode, renderNodeBefore) {\n        if (!this.renderNodes[renderNode.name]) {\n            renderNode.assign(this);\n            this.renderNodes[renderNode.name] = renderNode;\n            for (let i = 0; i < this._renderNodesArr.length; i++) {\n                if (this._renderNodesArr[i].isEqual(renderNodeBefore)) {\n                    this._renderNodesArr.splice(i, 0, renderNode);\n                    break;\n                }\n            }\n            this._renderNodesArr.unshift(renderNode);\n        }\n        else {\n            cons.logWrn(`Node name ${renderNode.name} already exists.`);\n        }\n    }\n    /**\n     * Adds render nodes array to the renderer.\n     * @public\n     * @param {Array.<RenderNode>} nodesArr - Render nodes array.\n     */\n    addNodes(nodesArr) {\n        for (let i = 0; i < nodesArr.length; i++) {\n            this.addNode(nodesArr[i]);\n        }\n    }\n    getMaxMSAA(internalFormat) {\n        let gl = this.handler.gl;\n        let samples = gl.getInternalformatParameter(gl.RENDERBUFFER, gl[internalFormat], gl.SAMPLES);\n        return samples[0];\n    }\n    getMSAA() {\n        return this._msaa;\n    }\n    /**\n     * TODO: replace with cache friendly linked list by BillboardHandler, LabelHandler etc.\n     */\n    enqueueEntityCollectionsToDraw(ecArr) {\n        this._entityCollections.push.apply(this._entityCollections, ecArr);\n    }\n    /**\n     * Draws opaque items entity collections.\n     * @protected\n     */\n    _drawOpaqueEntityCollections() {\n        let ec = this._entityCollections;\n        if (ec.length) {\n            this.enableBlendDefault();\n            // pointClouds pass\n            let i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].pointCloudHandler.draw();\n            }\n        }\n    }\n    /**\n     * Draws transparent items entity collections.\n     * @protected\n     */\n    _drawTransparentEntityCollections() {\n        let ec = this._entityCollections;\n        if (ec.length) {\n            let gl = this.handler.gl;\n            this.enableBlendDefault();\n            // GeoObjects\n            let i = ec.length;\n            while (i--) {\n                let eci = ec[i];\n                if (ec[i]._fadingOpacity) {\n                    eci.events.dispatch(eci.events.draw, eci);\n                    ec[i].geoObjectHandler.draw();\n                }\n            }\n            // billboards pass\n            gl.activeTexture(gl.TEXTURE0);\n            gl.bindTexture(gl.TEXTURE_2D, this.billboardsTextureAtlas.texture);\n            i = ec.length;\n            while (i--) {\n                let eci = ec[i];\n                eci._fadingOpacity && eci.billboardHandler.draw();\n            }\n            // labels pass\n            let fa = this.fontAtlas.atlasesArr;\n            for (i = 0; i < fa.length; i++) {\n                gl.activeTexture(gl.TEXTURE0 + i);\n                gl.bindTexture(gl.TEXTURE_2D, fa[i].texture);\n            }\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].labelHandler.draw();\n            }\n            // rays\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].rayHandler.draw();\n            }\n            // polyline pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].polylineHandler.draw();\n            }\n            // Strip pass\n            i = ec.length;\n            while (i--) {\n                ec[i]._fadingOpacity && ec[i].stripHandler.draw();\n            }\n        }\n    }\n    _clearEntityCollectionQueue() {\n        this._entityCollections.length = 0;\n        this._entityCollections = [];\n    }\n    /**\n     * Draw nodes.\n     * @public\n     */\n    draw() {\n        this.activeCamera.checkMoveEnd();\n        let e = this.events;\n        e.handleEvents();\n        let sceneFramebuffer = this.sceneFramebuffer;\n        sceneFramebuffer.activate();\n        let h = this.handler, gl = h.gl;\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        this.enableBlendDefault();\n        e.dispatch(e.draw, this);\n        let frustums = this.activeCamera.frustums;\n        let pointerEvent = e.pointerEvent() || this.activeCamera.isMoving;\n        // Rendering scene nodes and entityCollections\n        let rn = this._renderNodesArr;\n        let k = frustums.length;\n        while (k--) {\n            this.activeCamera.setCurrentFrustum(k);\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n            let i = rn.length;\n            while (i--) {\n                rn[i].preDrawNode();\n            }\n            this._drawOpaqueEntityCollections();\n            i = rn.length;\n            while (i--) {\n                this.enableBlendDefault();\n                rn[i].drawNode();\n            }\n            this._drawTransparentEntityCollections();\n            this._clearEntityCollectionQueue();\n            e.dispatch(e.drawtransparent, this);\n            if (pointerEvent) {\n                this._drawPickingBuffer();\n                this.__useDistanceFramebuffer__ && this._drawDistanceBuffer();\n            }\n        }\n        sceneFramebuffer.deactivate();\n        this.blitFramebuffer && sceneFramebuffer.blitTo(this.blitFramebuffer, 0);\n        if (pointerEvent) {\n            // It works ONLY for 0 (closest) frustum\n            if (h.isWebGl2()) {\n                this._drawDepthBuffer();\n            }\n            this._readPickingBuffer();\n            this.__useDistanceFramebuffer__ && this._readDistanceBuffer();\n        }\n        // Tone mapping followed by rendering on the screen\n        this._fnScreenFrame();\n        e.dispatch(e.postdraw, this);\n        e.mouseState.wheelDelta = 0;\n        e.mouseState.justStopped = false;\n        e.mouseState.moving = false;\n        e.touchState.moving = false;\n    }\n    _screenFrameMSAA() {\n        let h = this.handler;\n        let sh = h.programs.toneMapping, p = sh._program, gl = h.gl;\n        gl.disable(gl.DEPTH_TEST);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer);\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\n        this.toneMappingFramebuffer.activate();\n        sh.activate();\n        // screen texture\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.blitFramebuffer.textures[0]);\n        gl.uniform1i(p.uniforms.hdrBuffer, 0);\n        gl.uniform1f(p.uniforms.gamma, this.gamma);\n        gl.uniform1f(p.uniforms.exposure, this.exposure);\n        gl.uniform1f(p.uniforms.whitepoint, this.whitepoint);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        this.toneMappingFramebuffer.deactivate();\n        // SCREEN PASS\n        sh = h.programs.screenFrame;\n        p = sh._program;\n        sh.activate();\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.outputTexture);\n        gl.uniform1i(p.uniforms.texture, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        gl.enable(gl.DEPTH_TEST);\n    }\n    _screenFrameNoMSAA() {\n        let h = this.handler;\n        let sh = h.programs.screenFrame, p = sh._program, gl = h.gl;\n        gl.disable(gl.DEPTH_TEST);\n        sh.activate();\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.outputTexture);\n        gl.uniform1i(p.uniforms.texture, 0);\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer);\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        gl.enable(gl.DEPTH_TEST);\n    }\n    /**\n     * Draw picking objects framebuffer.\n     * @private\n     */\n    _drawPickingBuffer() {\n        this.pickingFramebuffer.activate();\n        let h = this.handler;\n        let gl = h.gl;\n        if (this.activeCamera.isFirstPass) {\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n        else {\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        let dp = this._pickingCallbacks;\n        for (let i = 0, len = dp.length; i < len; i++) {\n            //\n            // draw picking scenes, usually we don't need blending,\n            // but sometimes set it manually in the callbacks\n            //\n            gl.disable(gl.BLEND);\n            /**\n             * This callback renders picking frame.\n             */\n            dp[i].callback.call(dp[i].sender);\n            gl.enable(gl.BLEND);\n        }\n        this.pickingFramebuffer.deactivate();\n    }\n    /**\n     * Draw picking objects framebuffer.\n     * @protected\n     */\n    _drawDistanceBuffer() {\n        this.distanceFramebuffer.activate();\n        let h = this.handler;\n        let gl = h.gl;\n        if (this.activeCamera.isFirstPass) {\n            gl.clearColor(0.0, 0.0, 0.0, 1.0);\n            gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        }\n        else {\n            gl.clear(gl.DEPTH_BUFFER_BIT);\n        }\n        gl.disable(gl.BLEND);\n        let dp = this._distanceCallbacks;\n        let i = dp.length;\n        while (i--) {\n            /**\n             * This callback renders distance frame.\n             */\n            dp[i].callback.call(dp[i].sender);\n        }\n        gl.enable(gl.BLEND);\n        this.distanceFramebuffer.deactivate();\n    }\n    _drawDepthBuffer() {\n        this.depthFramebuffer.activate();\n        let h = this.handler;\n        let gl = h.gl;\n        gl.clearColor(0.0, 0.0, 0.0, 1.0);\n        gl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT);\n        gl.enable(gl.DEPTH_TEST);\n        let dp = this._depthCallbacks;\n        let i = dp.length;\n        while (i--) {\n            /**\n             * This callback renders depth frame.\n             */\n            dp[i].callback.call(dp[i].sender);\n        }\n        this.depthFramebuffer.deactivate();\n        //\n        // PASS to depth visualization\n        this.screenDepthFramebuffer.activate();\n        let sh = h.programs.depth, p = sh._program;\n        gl.bindBuffer(gl.ARRAY_BUFFER, this.screenFramePositionBuffer);\n        gl.vertexAttribPointer(p.attributes.corners, 2, gl.FLOAT, false, 0, 0);\n        sh.activate();\n        gl.activeTexture(gl.TEXTURE0);\n        gl.bindTexture(gl.TEXTURE_2D, this.depthFramebuffer.textures[1]);\n        gl.uniform1i(p.uniforms.depthTexture, 0);\n        gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        this.screenDepthFramebuffer.deactivate();\n    }\n    readPickingColor(x, y, outColor) {\n        let w = this.pickingFramebuffer.width;\n        let h = this.pickingFramebuffer.height;\n        x = Math.round(x * w);\n        y = Math.round(y * h);\n        let ind = (y * w + x) * 4;\n        outColor[0] = this._tempPickingPix_[ind];\n        outColor[1] = this._tempPickingPix_[ind + 1];\n        outColor[2] = this._tempPickingPix_[ind + 2];\n    }\n    readDistanceColor(x, y, outColor) {\n        let w = this.distanceFramebuffer.width;\n        let h = this.distanceFramebuffer.height;\n        x = Math.round(x * w);\n        y = Math.round(y * h);\n        let ind = (y * w + x) * 4;\n        outColor[0] = this._tempDistancePix_[ind];\n        outColor[1] = this._tempDistancePix_[ind + 1];\n        outColor[2] = this._tempDistancePix_[ind + 2];\n    }\n    /**\n     * Function starts renderer\n     * @public\n     */\n    start() {\n        if (!this._initialized) {\n            this.initialize();\n        }\n        this.handler.start();\n    }\n    destroy() {\n        for (let i in this.controls) {\n            this.controls[i].remove();\n        }\n        for (let i = 0; i < this._renderNodesArr.length; i++) {\n            this._renderNodesArr[i].remove();\n        }\n        this.div = null;\n        this._renderNodesArr = [];\n        this.renderNodes = {};\n        this.activeCamera = null;\n        this.controls = {};\n        this.controlsBag = {};\n        this.colorObjects.clear();\n        // @ts-ignore\n        this.colorObjects = null;\n        this._pickingCallbacks = [];\n        this.pickingFramebuffer = null;\n        //@ts-ignore\n        this._tempPickingPix_ = null;\n        this.distanceFramebuffer = null;\n        this._distanceCallbacks = [];\n        //@ts-ignore\n        this._tempDistancePix_ = null;\n        this._depthCallbacks = [];\n        this.depthFramebuffer = null;\n        this.sceneFramebuffer = null;\n        this.blitFramebuffer = null;\n        this.toneMappingFramebuffer = null;\n        // todo\n        //this.billboardsTextureAtlas.clear();\n        //this.geoObjectsTextureAtlas.clear()\n        //this.fontAtlas.clear();\n        this._entityCollections = [];\n        this.handler.destroy();\n        // @ts-ignore\n        this.handler = null;\n        this._initialized = false;\n    }\n}\nexport { Renderer };\n//# sourceMappingURL=Renderer.js.map","import { Program } from '../webgl/Program';\nexport function screenFrame() {\n    return new Program(\"screenFrame\", {\n        uniforms: {\n            texture: \"sampler2d\"\n        },\n        attributes: {\n            corners: \"vec3\"\n        },\n        vertexShader: `attribute vec2 corners;\n            \n            varying vec2 tc;\n            void main(void) {\n                gl_Position = vec4(corners, 0.0, 1.0);\n                tc = corners * 0.5 + 0.5;\n            }`,\n        fragmentShader: `precision highp float;\n            uniform sampler2D texture;\n            \n            varying vec2 tc;\n            \n            void main(void) {\n                gl_FragColor = texture2D( texture, tc );\n            }`\n    });\n}\n//# sourceMappingURL=screenFrame.js.map","import { Program } from '../webgl/Program';\nexport function toneMapping() {\n    return new Program(\"toneMapping\", {\n        uniforms: {\n            hdrBuffer: \"sampler2d\",\n            exposure: \"float\",\n            gamma: \"float\",\n            whitepoint: \"float\"\n        },\n        attributes: {\n            corners: \"vec3\"\n        },\n        vertexShader: `#version 300 es\n            \n            in vec2 corners;\n            \n            out vec2 tc;\n\n            void main(void) {\n                gl_Position = vec4(corners, 0.0, 1.0);\n                tc = corners * 0.5 + 0.5;\n            }`,\n        fragmentShader: `#version 300 es\n\n            precision highp float;\n\n            #ifndef saturate\n                #define saturate(a) clamp(a, 0.0, 1.0)\n            #endif\n\n            uniform sampler2D hdrBuffer;\n\n            uniform float whitepoint;\n            uniform float exposure;\n            uniform float gamma;\n\n            vec3 LinearToneMapping(vec3 color) {\n                return exposure * color;\n            }\n\n            vec3 ReinhardToneMapping2(vec3 color) {\n                return vec3(1.0) - exp(-color * exposure);\n            }\n\n            vec3 ReinhardToneMapping(vec3 color) {\n                color *= exposure;\n                return saturate(color / (vec3(1.0) + color));\n            }\n\n            #define Uncharted2Helper(x) max(((x * (0.15 * x + 0.10 * 0.50) + 0.20 * 0.02) / (x * (0.15 * x + 0.50) + 0.20 * 0.30)) - 0.02 / 0.30, vec3(0.0))\n\n            vec3 Uncharted2ToneMapping(vec3 color) {\n                color *= exposure;\n                return saturate(Uncharted2Helper(color) / Uncharted2Helper(vec3(whitepoint)));\n            }\n\n            vec3 OptimizedCineonToneMapping(vec3 color) {\n                color *= exposure;\n                color = max(vec3(0.0), color - 0.004);\n                return pow((color * (6.2 * color + 0.5)) / (color * (6.2 * color + 1.7) + 0.06), vec3(2.2));\n            }\n\n            vec3 ACESFilmicToneMapping(vec3 color) {\n                color *= exposure;\n                return saturate((color * (2.51 * color + 0.03)) / (color * (2.43 * color + 0.59) + 0.14));\n            }\n\n            in vec2 tc;\n\n            layout(location = 0) out vec4 fragColor;\n            \n            void main(void) {\n                vec4 hdrColor = texture(hdrBuffer, tc).rgba;\n                \n                float oneByGamma = gamma / gamma;\n                float oneByWhitePoint = whitepoint / whitepoint;\n                vec3 mapped = ReinhardToneMapping2(hdrColor.rgb) * oneByGamma * oneByWhitePoint;\n                //vec3 mapped = ACESFilmicToneMapping(hdrColor.rgb) * oneByGamma * oneByWhitePoint;\n\n                mapped = pow(mapped, vec3(1.0 / gamma));\n        \n                fragColor = vec4(mapped, hdrColor.a);\n            }`\n    });\n}\n//# sourceMappingURL=toneMapping.js.map","import { Program } from '../webgl/Program';\nexport function depth() {\n    return new Program(\"depth\", {\n        uniforms: {\n            depthTexture: \"sampler2d\"\n        },\n        attributes: {\n            corners: \"vec2\"\n        },\n        vertexShader: `#version 300 es\n            \n            in vec2 corners;\n            \n            out vec2 tc;\n\n            void main(void) {\n                gl_Position = vec4(corners, 0.0, 1.0);\n                tc = corners * 0.5 + 0.5;\n            }`,\n        fragmentShader: `#version 300 es\n\n            precision highp float;\n\n            #define MAX_FRUSTUMS 4\n\n            uniform sampler2D depthTexture;\n           \n            in vec2 tc;\n\n            layout(location = 0) out vec4 fragColor;\n\n            float LinearizeDepth(in vec2 uv)\n            {\n                float depth = texture(depthTexture, tc).x;\n                return depth;//(2.0 * zNear) / (zFar + zNear - depth * (zFar - zNear));\n            }\n            \n            void main(void) {\n                float c = LinearizeDepth(tc);\n                fragColor = vec4(c, c, c, 1.0);\n            }`\n    });\n}\n//# sourceMappingURL=depth.js.map","// #StandWithUkraine\nimport { CompassButton } from \"./control/CompassButton\";\nimport { EarthCoordinates } from \"./control/EarthCoordinates\";\nimport { EarthNavigation } from \"./control/EarthNavigation\";\nimport { EmptyTerrain } from \"./terrain/EmptyTerrain\";\nimport { Handler } from \"./webgl/Handler\";\nimport { isEmpty } from \"./utils/shared\";\nimport { MouseNavigation } from \"./control/MouseNavigation\";\nimport { Planet } from \"./scene/Planet\";\nimport { ScaleControl } from \"./control/ScaleControl\";\nimport { Sun } from \"./control/Sun\";\nimport { TouchNavigation } from \"./control/TouchNavigation\";\nimport { Renderer } from \"./renderer/Renderer\";\nimport { ZoomControl } from \"./control/ZoomControl\";\nconst DEFAULT_NIGHT_SRC = `/night.png`;\nconst DEFAULT_SPEC_SRC = `/spec.png`;\nconst DEFAULT_RESOURCES_SRC = '/res';\n/** @const {string} */\nconst PLANET_NAME_PREFIX = \"globus_planet_\";\n/**\n * Creates a WebGL context with globe.\n * @class\n *\n * @example <caption>Basic initialization</caption>\n * globus = new Globe({\n *     'atmosphere': false,\n *     'target': 'globus',\n *     'name': 'Earth',\n *     'controls': [\n *          new control.MouseNavigation({ autoActivate: true }),\n *          new control.KeyboardNavigation({ autoActivate: true }),\n *          new control.EarthCoordinates({ autoActivate: true, center: false }),\n *          new control.LayerSwitcher({ autoActivate: true }),\n *          new control.ZoomControl({ autoActivate: true }),\n *          new control.TouchNavigation({ autoActivate: true }),\n *          new control.Sun({ autoActivate: true })\n *      ],\n *     'terrain': new GlobusTerrain(),\n *     'layers': [\n *          new XYZ(\"OpenStreetMap\", { isBaseLayer: true, url: \"http://b.tile.openstreetmap.org/{z}/{x}/{y}.png\", visibility: true, attribution: 'Data @ <a href=\"http://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"http://www.openstreetmap.org/copyright\">ODbL</a>' })\n *      ],\n *     'autoActivate': true\n * });\n *\n * @param {IGlobeParams} options - Options:\n * @param {string|HTMLElement} options.target - HTML element id where planet canvas have to be created.\n * @param {string} [options.name] - Planet name. Default is uniq identifier.\n * @param {EmptyTerrain} [options.terrain] - Terrain provider. Default no terrain - og.terrain.EmptyTerrain.\n * @param {Array.<Control>} [options.controls] - Renderer controls array.\n * @param {Array.<Layer>} [options.layers] - Planet layers.\n * @param {Extent| [[number, number],[number, number]]} [options.viewExtent] - Viewable starting extent.\n * @param {boolean} [options.autoActivate=true] - Globe rendering auto activation flag. True is default.\n * @param {HTMLElement} [options.attributionContainer] - Container for attribution list.\n * @param {number} [options.maxGridSize=128] = Maximal segment grid size. 128 is default\n * @param {string} [options.fontsSrc] -  Fonts collection url.\n * @param {string} [options.resourcesSrc] - Resources root src.\n * @param {string} [options.nightTextureSrc] - Night glowing image sources\n * @param {string} [options.specularTextureSrc] - Specular water mask image sourcr\n * @param {number} [options.maxAltitude=15000000.0] - Maximal camera altitude above terrain\n * @param {number} [options.minAltitude=1.0] - Minimal camera altitude above terrain\n * @param {number} [options.maxEqualZoomAltitude=15000000.0] - Maximal altitude since segments on the screen became the same zoom level\n * @param {number} [options.minEqualZoomAltitude=10000.0] - Minimal altitude since segments on the screen became the same zoom level\n * @param {number} [options.minEqualZoomCameraSlope=0.8] - Minimal camera slope above te globe where segments on the screen became the same zoom level\n * @param {number} [options.loadingBatchSize=12] -\n * @param {number} [options.quadTreeStrategyPrototype] - Prototype of quadTree. QuadTreeStrategy for Earth is default.\n * @param {number} [options.msaa=0] - MSAA antialiasing parameter: 2,4,8,16. Default is 0.\n * @param {number} [options.dpi] - Device pixel ratio. Default is current screen DPI.\n * @param {boolean} [options.atmosphereEnabled] - Enables atmosphere effect.\n * @param {boolean} [options.transtitionOpacityEnabled] - Enables terrain smooth opacity transition effect.\n */\nclass Globe {\n    constructor(options) {\n        this.$target = null;\n        this._instanceID = `__globus${Globe.__counter__++ ? Globe.__counter__ : \"\"}__`;\n        window[this._instanceID] = this;\n        //\n        // Canvas creation\n        //\n        this._canvas = document.createElement(\"canvas\");\n        this._canvas.id = `canvas${this._instanceID}`;\n        this._canvas.style.width = \"100%\";\n        this._canvas.style.height = \"100%\";\n        this._canvas.style.display = \"block\";\n        this._canvas.style.opacity = \"0.0\";\n        this._canvas.style.transition = \"opacity 150ms\";\n        /**\n         * Dom element where WebGL canvas creates\n         * @public\n         * @type {Element}\n         */\n        this.$inner = document.createElement('div');\n        this.$inner.classList.add(\"og-inner\");\n        this.$inner.appendChild(this._canvas);\n        this.$inner.attributions = document.createElement('div');\n        if (options.attributionContainer) {\n            options.attributionContainer.appendChild(this.$inner.attributions);\n        }\n        else {\n            this.$inner.attributions.classList.add(\"og-attribution\");\n            this.$inner.appendChild(this.$inner.attributions);\n        }\n        if (options.target) {\n            this.attachTo(options.target);\n        }\n        const _disableWheel = (e) => {\n            e.preventDefault();\n        };\n        this._canvas.onmouseenter = function () {\n            document.addEventListener(\"mousewheel\", _disableWheel, {\n                capture: false,\n                passive: false\n            });\n        };\n        this._canvas.onmouseleave = function () {\n            document.removeEventListener(\"mousewheel\", _disableWheel);\n        };\n        this.renderer = new Renderer(new Handler(this._canvas, {\n            autoActivate: false,\n            pixelRatio: options.dpi || (window.devicePixelRatio + 0.15),\n            context: {\n                //alpha: false,\n                antialias: false,\n                premultipliedAlpha: false\n            }\n        }), {\n            autoActivate: false,\n            msaa: options.msaa,\n            fontsSrc: options.fontsSrc\n        });\n        this.renderer.div = this.$inner;\n        // Skybox\n        if (options.skybox) {\n            this.renderer.addNode(options.skybox);\n        }\n        this._planetName = options.name ? options.name : PLANET_NAME_PREFIX + Globe.__counter__;\n        this.planet = new Planet({\n            name: this._planetName,\n            frustums: options.frustums,\n            ellipsoid: options.ellipsoid,\n            maxGridSize: options.maxGridSize,\n            nightTextureSrc: options.nightTextureSrc === null ? null : `${options.resourcesSrc || DEFAULT_RESOURCES_SRC}${DEFAULT_NIGHT_SRC}`,\n            specularTextureSrc: options.specularTextureSrc === null ? null : `${options.resourcesSrc || DEFAULT_RESOURCES_SRC}${DEFAULT_SPEC_SRC}`,\n            minAltitude: options.minAltitude,\n            maxAltitude: options.maxAltitude || 15000000,\n            maxEqualZoomAltitude: options.maxEqualZoomAltitude,\n            minEqualZoomAltitude: options.minEqualZoomAltitude,\n            minEqualZoomCameraSlope: options.minEqualZoomCameraSlope,\n            quadTreeStrategyPrototype: options.quadTreeStrategyPrototype,\n            maxLoadingRequests: options.maxLoadingRequests,\n            atmosphereEnabled: options.atmosphereEnabled,\n            transitionOpacityEnabled: options.transitionOpacityEnabled\n        });\n        // Attach terrain provider (can be one object or array)\n        if (options.terrain) {\n            //@todo: refactoring\n            if (Array.isArray(options.terrain)) {\n                this.planet.setTerrain(options.terrain[0]); // If array get the terrain from 1st element\n            }\n            else {\n                this.planet.setTerrain(options.terrain);\n            }\n        }\n        else {\n            this.planet.setTerrain(new EmptyTerrain());\n        }\n        this.renderer.addNode(this.planet);\n        // Add controls\n        if (options.controls) {\n            this.planet.addControls(options.controls);\n        }\n        else {\n            this.planet.addControls([\n                new ZoomControl(),\n                options.useEarthNavigation ? new EarthNavigation() : new MouseNavigation({ minSlope: options.minSlope }),\n                new TouchNavigation(),\n                new EarthCoordinates(),\n                new ScaleControl(),\n                new CompassButton()\n            ]);\n        }\n        const _controls = this.renderer.controls;\n        let sun;\n        for (let i in _controls) {\n            if (_controls[i] instanceof Sun) {\n                sun = _controls[i];\n                break;\n            }\n        }\n        if (!sun) {\n            this.sun = new Sun();\n            this.planet.addControl(this.sun);\n        }\n        else {\n            this.sun = sun;\n        }\n        if (options.sun) {\n            if (options.sun.active !== undefined && !options.sun.active) {\n                this.sun.deactivate();\n            }\n            if (options.sun.stopped === true) {\n                this.sun.stop();\n            }\n        }\n        if (options.layers) {\n            this.planet.addLayers(options.layers);\n        }\n        // TODO: view center, altitude, extent\n        let ve = options.viewExtent;\n        if (ve) {\n            if (ve instanceof Array) {\n                this.planet.viewExtentArr(ve);\n            }\n            else {\n                this.planet.viewExtent(ve);\n            }\n        }\n        // Run!\n        if (options.autoActivate || isEmpty(options.autoActivate)) {\n            this.start();\n        }\n    }\n    start() {\n        this.renderer.start();\n        this.fadeIn();\n    }\n    /**\n     * Starts screen brightness fading in effect by the duration time.\n     * @public\n     */\n    fadeIn() {\n        this._canvas.style.opacity = \"1.0\";\n    }\n    /**\n     * Starts screen brightness fading out effect by the duration time.\n     * @public\n     */\n    fadeOut() {\n        this._canvas.style.opacity = \"0\";\n    }\n    attachTo(target) {\n        this.detach();\n        let t;\n        if (target instanceof HTMLElement) {\n            t = target;\n        }\n        else {\n            t = document.getElementById(target) || document.querySelector(target);\n        }\n        if (t) {\n            this.$target = t;\n            t.appendChild(this.$inner);\n        }\n    }\n    detach() {\n        if (this.$target) {\n            // Remember that when container is zero\n            // sized(display none etc.) renderer frame will be stopped\n            this.$target.removeChild(this.$inner);\n        }\n    }\n    destroy() {\n        this.detach();\n        this.renderer.destroy();\n    }\n}\nGlobe.__counter__ = 0;\nexport { Globe };\n//# sourceMappingURL=Globe.js.map","import { CLOSE_ICON } from './ui/icons';\nimport { createLonLat, stringTemplate } from \"./utils/shared\";\nimport { Vec3 } from \"./math/Vec3\";\nimport { View } from './ui/View';\nconst TEMPLATE = `<div class=\"og-popup {className}\">\n      <div class=\"og-popup-content-wrapper\">\n        <div class=\"og-popup-content\"></div>\n      </div>\n      <div class=\"og-popup-tip-container\">\n        <div class=\"og-popup-tip\"></div>\n      </div>\n      <div class=\"og-popup-toolbar\">\n        <div class=\"og-popup-btn og-popup-close\">${CLOSE_ICON}</div>\n      </div>\n      <div class=\"og-popup-title\">{title}</div>\n    </div>`;\nconst POPUP_EVENTS = [\"open\", \"close\"];\nclass Popup extends View {\n    constructor(options) {\n        super({\n            template: stringTemplate(TEMPLATE, {\n                title: options.title || \"\"\n            }),\n            classList: options.className ? [options.className] : [],\n            ...options\n        });\n        //@ts-ignore\n        this.events = this.events.registerNames(POPUP_EVENTS);\n        this._content = options.content || \"\";\n        this.$content = null;\n        this.$tip = null;\n        this.$title = null;\n        this._planet = options.planet;\n        this._offset = options.offset || [0, 0];\n        this._lonLat = createLonLat(options.lonLat);\n        this._cartPos = new Vec3();\n        this._visibility = options.visibility || false;\n        this.render();\n    }\n    _updatePosition() {\n        this.setCartesian3v(this._cartPos);\n    }\n    setScreen(p) {\n        if (this._planet) {\n            let r = this._planet.renderer.handler.pixelRatio;\n            this.el.style.transform =\n                `translate(${p.x / r - this.clientWidth * 0.5}px, ${p.y / r - this._planet.renderer.handler.canvas.clientHeight - this.$tip.clientHeight}px)`;\n        }\n    }\n    get clientWidth() {\n        return this.el ? this.el.clientWidth : 0;\n    }\n    get clientHeight() {\n        return this.el ? this.el.clientHeight : 0;\n    }\n    setOffset(x = 0, y = 0) {\n        this._offset[0] = x;\n        this._offset[1] = y;\n        if (this.el) {\n            this.el.style.left = `${x}px`;\n            this.el.style.bottom = `${y}px`;\n        }\n        return this;\n    }\n    render(params) {\n        super.render(params);\n        this.$content = this.select(\".og-popup-content\");\n        this.$title = this.select(\".og-popup-title\");\n        this.$tip = this.select(\".og-popup-tip-container\");\n        this.setOffset(this._offset[0], this._offset[1]);\n        this.setContent(this._content);\n        this.setLonLat(this._lonLat);\n        this.setVisibility(this._visibility);\n        this.select(\".og-popup-close\").addEventListener(\"click\", () => {\n            this.hide();\n        });\n        return this;\n    }\n    setVisibility(visibility) {\n        if (visibility) {\n            this.show();\n        }\n        else {\n            this.hide();\n        }\n        return this;\n    }\n    getContainer() {\n        return this.$content;\n    }\n    getToolbarContainer() {\n        return this.select(\".og-popup-toolbar\");\n    }\n    show() {\n        this._visibility = true;\n        if (this._planet) {\n            this._planet.events.on(\"draw\", this._updatePosition, this);\n            this.appendTo(this._planet.renderer.div);\n            this.events.dispatch(this.events.open, this);\n        }\n        return this;\n    }\n    hide() {\n        this._visibility = false;\n        if (this.el && this.el.parentNode) {\n            this._planet.events.off(\"draw\", this._updatePosition);\n            this.el.parentNode.removeChild(this.el);\n            this.events.dispatch(this.events.close, this);\n        }\n        return this;\n    }\n    setCartesian3v(cart, height = 0) {\n        this._cartPos = cart;\n        if (this._planet) {\n            let cam = this._planet.camera;\n            let f = this._planet.ellipsoid.equatorialSize + height, g = cam._lonLat.height;\n            let look = cart.sub(cam.eye), v = Math.sqrt((f + g) * (f + g) - f * f);\n            if (v > look.length() && cam.getForward().dot(look.normalize()) > 0.0) {\n                this.el.style.display = \"block\";\n                this.setScreen(cam.project(cart));\n            }\n            else {\n                this.el.style.display = \"none\";\n            }\n        }\n        return this;\n    }\n    setTitle(html) {\n        if (this.$title) {\n            this.$title.innerHTML = html;\n        }\n    }\n    setLonLat(lonLat) {\n        this._lonLat = lonLat;\n        if (this._planet) {\n            this.setCartesian3v(this._planet.ellipsoid.lonLatToCartesian(lonLat), lonLat.height);\n        }\n    }\n    setContent(content) {\n        if (content) {\n            this.clear();\n            this._content = content;\n            if (this.$content) {\n                if (typeof content === \"string\") {\n                    this.$content.innerHTML = content;\n                }\n                else {\n                    this.$content.appendChild(content);\n                }\n            }\n        }\n    }\n    clear() {\n        this._content = null;\n        if (this.$content) {\n            this.$content.innerHTML = \"\";\n        }\n    }\n}\nexport { Popup };\n//# sourceMappingURL=Popup.js.map","import { SegmentLonLat } from \"./SegmentLonLat\";\nimport { TILEGROUP_COMMON } from \"./Segment\";\nexport class SegmentLonLatWgs84 extends SegmentLonLat {\n    constructor(node, planet, tileZoom, extent) {\n        super(node, planet, tileZoom, extent);\n        this.isPole = false;\n        this._tileGroup = TILEGROUP_COMMON;\n    }\n    _getMaxZoom() {\n        return 150;\n    }\n    _assignTileYIndexes(extent) {\n        this.tileY = Math.round((90.0 - extent.northEast.lat) / (extent.northEast.lat - extent.southWest.lat));\n        this.tileYN = this.tileY - 1;\n        this.tileYS = this.tileY + 1;\n    }\n    _assignTileXIndexes(extent) {\n        this.tileX = Math.round(Math.abs(-180.0 - extent.southWest.lon) / (extent.northEast.lon - extent.southWest.lon));\n        let p2 = (1 << this.tileZoom) * 2;\n        this.tileXE = (this.tileX + 1) % p2;\n        this.tileXW = (p2 + this.tileX - 1) % p2;\n    }\n}\n//# sourceMappingURL=SegmentLonLatWgs84.js.map","import * as quadTree from \"../quadTree/quadTree\";\nimport { Extent } from \"../Extent\";\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { Node } from \"../quadTree/Node\";\nimport { SegmentLonLatWgs84 } from \"../segment/SegmentLonLatWgs84\";\nimport { QuadTreeStrategy } from \"./QuadTreeStrategy\";\nexport class MarsQuadTreeStrategy extends QuadTreeStrategy {\n    constructor(planet) {\n        super(planet, \"Mars\", EPSG4326);\n    }\n    init() {\n        let earthQuadTreeSouth = new Node(SegmentLonLatWgs84, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-180, -90, 0, 90]));\n        let earthQuadTreeWest = new Node(SegmentLonLatWgs84, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([0, -90, 180, 90]));\n        this._quadTreeList.push(earthQuadTreeSouth);\n        this._quadTreeList.push(earthQuadTreeWest);\n    }\n}\n//# sourceMappingURL=MarsQuadTreeStrategy.js.map","import * as quadTree from \"../quadTree/quadTree\";\nimport { Extent } from \"../Extent\";\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { Node } from \"../quadTree/Node\";\nimport { SegmentLonLatWgs84 } from \"../segment/SegmentLonLatWgs84\";\nimport { QuadTreeStrategy } from \"./QuadTreeStrategy\";\nexport class Wgs84QuadTreeStrategy extends QuadTreeStrategy {\n    constructor(planet) {\n        super(planet, \"wgs84\", EPSG4326);\n    }\n    init() {\n        let wgs84QuadTree = new Node(SegmentLonLatWgs84, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-180, -90, 180, 90]));\n        this._quadTreeList.push(wgs84QuadTree);\n    }\n}\n//# sourceMappingURL=Wgs84QuadTreeStrategy.js.map","import { EarthQuadTreeStrategy } from \"./EarthQuadTreeStrategy\";\nimport { MarsQuadTreeStrategy } from \"./MarsQuadTreeStrategy\";\nimport { EPSG4326QuadTreeStrategy } from \"./EPSG4326QuadTreeStrategy\";\nimport { QuadTreeStrategy } from \"./QuadTreeStrategy\";\nimport { Wgs84QuadTreeStrategy } from \"./Wgs84QuadTreeStrategy\";\nconst quadTreeStrategyType = {\n    epsg4326: EPSG4326QuadTreeStrategy,\n    earth: EarthQuadTreeStrategy,\n    mars: MarsQuadTreeStrategy,\n    wgs84: Wgs84QuadTreeStrategy\n};\nexport { quadTreeStrategyType, QuadTreeStrategy, Wgs84QuadTreeStrategy, MarsQuadTreeStrategy, EarthQuadTreeStrategy };\n//# sourceMappingURL=index.js.map","import * as quadTree from \"../quadTree/quadTree\";\nimport { Extent } from \"../Extent\";\nimport { EPSG4326 } from \"../proj/EPSG4326\";\nimport { Node } from \"../quadTree/Node\";\nimport { QuadTreeStrategy } from \"./QuadTreeStrategy\";\nimport { SegmentLonLatWgs84 } from \"../segment/SegmentLonLatWgs84\";\nexport class EPSG4326QuadTreeStrategy extends QuadTreeStrategy {\n    constructor(planet) {\n        super(planet, \"EPSG4326\", EPSG4326);\n    }\n    init() {\n        let earthQuadTreeSouth = new Node(SegmentLonLatWgs84, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([-180, -90, 0, 90]));\n        let earthQuadTreeWest = new Node(SegmentLonLatWgs84, this.planet, quadTree.NW, null, 0, 0, Extent.createFromArray([0, -90, 180, 90]));\n        this._quadTreeList.push(earthQuadTreeSouth);\n        this._quadTreeList.push(earthQuadTreeWest);\n    }\n}\n//# sourceMappingURL=EPSG4326QuadTreeStrategy.js.map","import { EPS5 } from \"../math\";\nimport { Vec3 } from \"./Vec3\";\nconst DISJOINT = 0;\nconst COINCIDE = 1;\nconst INTERSECT = 2;\n/**\n * Plane class.\n * @constructor\n * @param {Vec3} [p] - Plane point.\n * @param {Vec3} [n] - Planet normal.\n */\nclass Plane {\n    constructor(p, n) {\n        this.p = p ? p.clone() : new Vec3();\n        this.n = n ? n.clone() : this.p.normal();\n    }\n    set(p, n) {\n        this.p.copy(p);\n        this.n.copy(n);\n    }\n    getNormal() {\n        return this.n.clone();\n    }\n    distance(p) {\n        let pp = this.getProjection(p);\n        return p.distance(pp);\n    }\n    getProjection(v, def) {\n        return Vec3.proj_b_to_plane(v, this.n, def);\n    }\n    getProjectionPoint(p, vh) {\n        let v = p.sub(this.p), n = this.n, dist = v.dot(n);\n        if (vh) {\n            vh.copy(n.scale(dist));\n        }\n        else {\n            vh = n.scale(dist);\n        }\n        return p.sub(vh);\n    }\n    getIntersection(Pn1, Pn2, L) {\n        let u = Pn1.n.cross(Pn2.n);\n        let ax = u.x >= 0 ? u.x : -u.x;\n        let ay = u.y >= 0 ? u.y : -u.y;\n        let az = u.z >= 0 ? u.z : -u.z;\n        // test if the two planes are parallel\n        if (ax + ay + az < EPS5) {\n            // Pn1 and Pn2 are near parallel\n            // test if disjoint or coincide\n            let v = Pn2.p.sub(Pn1.p);\n            if (Pn1.n.dot(v) == 0) {\n                // Pn2.V0 lies in Pn1\n                return COINCIDE; // Pn1 and Pn2 coincide\n            }\n            else {\n                return DISJOINT; // Pn1 and Pn2 are disjoint\n            }\n        }\n        // Pn1 and Pn2 intersect in a line\n        // first determine max abs coordinate of cross product\n        let maxc; // max coordinate\n        if (ax > ay) {\n            if (ax > az) {\n                maxc = 1;\n            }\n            else {\n                maxc = 3;\n            }\n        }\n        else {\n            if (ay > az) {\n                maxc = 2;\n            }\n            else {\n                maxc = 3;\n            }\n        }\n        // next, to get a point on the intersect line\n        // zero the max coord, and solve for the other two\n        let iP = new Vec3(); // intersect point\n        let d1, d2; // the constants in the 2 plane equations\n        d1 = -Pn1.n.dot(Pn1.p); // note: could be pre-stored  with plane\n        d2 = -Pn2.n.dot(Pn2.p); // ditto\n        // select max coordinate\n        if (maxc === 1) {\n            // intersect with x=0\n            iP.x = 0;\n            iP.y = (d2 * Pn1.n.z - d1 * Pn2.n.z) / u.x;\n            iP.z = (d1 * Pn2.n.y - d2 * Pn1.n.y) / u.x;\n        }\n        else if (maxc === 2) {\n            // intersect with y=0\n            iP.x = (d1 * Pn2.n.z - d2 * Pn1.n.z) / u.y;\n            iP.y = 0;\n            iP.z = (d2 * Pn1.n.x - d1 * Pn2.n.x) / u.y;\n        }\n        else if (maxc === 3) {\n            // intersect with z=0\n            iP.x = (d2 * Pn1.n.y - d1 * Pn2.n.y) / u.z;\n            iP.y = (d1 * Pn2.n.x - d2 * Pn1.n.x) / u.z;\n            iP.z = 0;\n        }\n        L.p0.copy(iP);\n        L.p1.copy(iP.add(u));\n        return INTERSECT;\n    }\n}\nexport { Plane };\n//# sourceMappingURL=Plane.js.map"],"names":["TWO_PI","Math","PI","PI_TWO","MAX_FLOAT","Number","MAX_VALUE","LOG2","log","MAX32","MAX","MIN","RADIANS","DEGREES","DEGREES_DOUBLE","RADIANS_HALF","SQRT_HALF","sqrt","EPS5","EPS10","EPS12","EPS14","clamp","number","min","max","isPowerOfTwo","x","nextHighestPowerOfTwo","maxValue","i","randomi","floor","random","mod","m","n","zeroTwoPI","a","res","abs","step","edge","frac","mx","exp2","pow","lerp","t","h1","h0","cube","f","square","rev","degrees","angle","p0","p1","p2","p3","u","tt","uu","uuu","ttt","scaleTo","addA","d","s","p","b","base","lon","x0","err","maxIter","x2","HALF_PI","INV_PI_BY_180","INV_PI_BY_360","PI_BY_360","INV_PI_BY_180_HALF_PI","LonLat","constructor","lat","height","this","isZero","join","arr","length","ai","createFromArray","toArray","lonLat","forwardMercator","mercator.POLE_BY_180","tan","mercator.POLE_BY_PI","forwardMercatorRes","inverseMercator","y","mercator.INV_POLE_BY_180","atan","exp","mercator.PI_BY_POLE","set","copy","clone","forwardMercatorEPS01","equal","POLE","POLE2","PI_BY_POLE","POLE_BY_PI","POLE_BY_180","INV_POLE_BY_180","PI_BY_180","POLE_DOUBLE","ONE_BY_POLE_DOUBLE","forward","forward_lon","forward_lat","inverse_lat","getTileExtent","z","size","sw","Extent","MAX_LAT","MIN_LAT","lonlatArr","push","zoom","cos","ne","southWest","northEast","createByCoordinates","lonmin","math.MAX","lonmax","math.MIN","latmin","latmax","vi","createByCoordinatesArr","fromTile","width","mercator.POLE_DOUBLE","H","lnSize","ltSize","left","top","right","setByCoordinates","isInside","lonlat","overlaps","e","getWidth","getHeight","getCenter","getNorthWest","getNorthEast","getSouthWest","getSouthEast","getNorth","getEast","getWest","getSouth","equals","extent","getCartesianBounds","ellipsoid","xmin","xmax","ymin","ymax","zmin","zmax","v","coord","lonLatToCartesian","toString","toFixed","Mat3","_m","transposeTo","setIdentity","mulVec","g","Vec3","toMatrix4","Mat4","Vec4","w","identity","fromVec","toVec3","toArray3","subA","scale","affinity","iw","getStep","getFrac","dot","toMatrix3","mulVec3","mulVec4","toInverseMatrix3","c","h","j","k","l","o","inverseTo","r","A","B","C","D","E","q","mul","F","G","translate","translateToPosition","rotate","sin","rot","setRotation","rotateBetweenVectors","Quat","getRotationBetweenVectors","getMat4","setPerspective","bottom","near","far","setOrtho","lr","bt","nf","eulerToMatrix","ax","ay","az","ad","bd","mat","IDENTITY","xRotation","yRotation","zRotation","axisAngleToQuat","axis","getNormal","half_angle","sin_a","getLookRotation","up","negate","cross","normalize","fd","getLookAtSourceDest","sourcePoint","destPoint","forwardVector","FORWARD","UP","rotAngle","acos","rotAxis","getRotationBetweenVectorsRes","getRotationBetweenVectorsUp","source","dest","clear","add","sub","toVec","setFromSphericalCoords","cos_a","sin_lat","cos_lat","sin_long","cos_long","setLookRotation","toSphericalCoords","tx","ty","tz","asin","atan2","alpha","setFromAxisAngle","getAxisAngle","vl","ivl","setFromEulerAngles","pitch","yaw","roll","ex","math.RADIANS_HALF","ey","ez","cr","cp","cy","sr","sp","sy","cpcy","spsy","getEulerAngles","sqy","setFromMatrix4","tr","nxt","out","xs","ys","zs","wx","wy","wz","xx","xy","xz","yy","yz","zz","getMat3","mulA","conjugate","inverse","magnitude2","magnitude","isEqual","matching","slerp","omega","cosom","sinom","scale0","scale1","aw","bx","by","bz","bw","getRoll","reprojectAxis","fTy","fTz","fTwz","fTxy","fTyy","fTzz","getPitch","fTx","fTwx","fTxx","fTyz","getYaw","fTwy","fTxz","DOWN","RIGHT","LEFT","BACKWARD","ZERO","UNIT_X","UNIT_Y","UNIT_Z","NORTH","doubleToTwoFloats","high","low","doubleHigh","fround","doubleToTwoFloat32Array","length2","v1","v2","noncollinear","Boolean","proj_b_to_plane","def","proj_b_to_a","orthoNormalize","normal","tangent","div","divA","toVec4","projToVec","getQuat","vec","dotArr","point3","normalNegate","normalNegateScale","normalScale","distance","dx","dy","dz","distance2","negateTo","projToRay","pos","direction","smerp","one_d","LERP_DELTA","getRotationTo","fallbackAxis","v0","invs","Vec2","toVector3","point2","colorTable","aliceblue","antiquewhite","aqua","aquamarine","azure","beige","bisque","black","blanchedalmond","blue","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dodgerblue","firebrick","floralwhite","forestgreen","fuchsia","gainsboro","ghostwhite","gold","goldenrod","gray","green","greenyellow","honeydew","hotpink","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgrey","lightgreen","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightsteelblue","lightyellow","lime","limegreen","linen","magenta","maroon","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","navy","oldlace","olive","olivedrab","orange","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","purple","rebeccapurple","red","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","silver","skyblue","slateblue","slategray","snow","springgreen","steelblue","teal","thistle","tomato","turquoise","violet","wheat","white","whitesmoke","yellow","yellowgreen","getDefault","param","undefined","isEmpty","isUndef","obj","_stampCounter","stamp","_openglobus_id","isString","String","htmlColorToRgba","htmlColor","opacity","hColor","shorthandRegex","hex","replace","result","exec","parseInt","split","parseFloat","htmlColorToFloat32Array","Float32Array","htmlColorToRgb","stringTemplate","template","params","key","parseHTML","htmlStr","document","createElement","innerHTML","domArr","childNodes","removeChild","print2d","id","text","el","getElementById","classList","body","appendChild","style","defaultString","str","trim","createVector3","Array","createColorRGBA","createColorRGB","createExtent","createLonLat","binarySearchFast","start","end","binarySearch","ar","compare_fn","cmp","binaryInsert","splice","getLinesIntersectionLonLat","start1","end1","start2","end2","isSegment","dir1","dir2","a1","b1","d1","a2","b2","d2","seg1_line2_start","seg1_line2_end","seg2_line1_start","seg2_line1_end","castType","string","date","Date","datetime","time","integer","float","boolean","toLowerCase","isNaN","base64toBlob","base64Data","contentType","sliceSize","byteCharacters","atob","bytesLength","slicesCount","ceil","byteArrays","sliceIndex","begin","bytes","offset","charCodeAt","Uint8Array","Blob","type","throttle","func","limit","skip","lastFunc","lastRan","args","arguments","clearTimeout","setTimeout","now","apply","concatTypedArrays","concatArrays","ArrayBuffer","isView","makeArrayTyped","ctor","typedArr","makeArray","from","spliceArray","starting","deleteCount","spliceTypedArray","newSize","splicedArray","subarray","getMatrixSubArray64","sourceArr","gridSize","i0","j0","size_1","i0size","j0size","Float64Array","vInd","ind","getMatrixSubArray32","getMatrixSubArrayBoundsExt","sourceArrHigh","sourceArrLow","noDataVertices","outArr","outArrHigh","outArrLow","outBounds","outNoDataVertices","nInd","indBy3","cloneArray","items","map","item","isArray","async","loadImage","url","Promise","resolve","image","Image","addEventListener","src","crossOrigin","isImageLoaded","complete","naturalHeight","distanceFormatExt","round","getUrlParam","paramName","URLSearchParams","location","search","get","block","fQ11","fQ21","fQ12","fQ22","x1","y1","y2","rgbaData","outCurrenElevations","outChildrenElevations","destSize","destSizeOne","sourceSize","dt","rightHeigh","bottomHeigh","currIndex","sourceDataLength","tileX","tileY","destArr","ii","jj","destIndex","middleHeight","rightindex","bottomindex","rightBottomindex","defVal","xmlToJson","xml","nodeType","attributes","attribute","nodeName","nodeValue","hasChildNodes","old","SECONDS_PER_MILLISECOND","MILLISECONDS_PER_SECOND","SECONDS_PER_MINUTE","ONE_BY_SECONDS_PER_MINUTE","ONE_BY_HOURS_PER_DAY","SECONDS_PER_HOUR","ONE_BY_SECONDS_PER_HOUR","SECONDS_PER_12_HOURS","MINUTES_PER_DAY","SECONDS_PER_DAY","MILLISECONDS_PER_DAY","ONE_BY_MILLISECONDS_PER_DAY","ONE_BY_SECONDS_PER_DAY","J2000","getDayNumber","year","month","day","DateToUTC","dayNumber","getUTCFullYear","getUTCMonth","getUTCDate","hour","getUTCHours","secondsOfDay","getUTCSeconds","getUTCMinutes","getUTCMilliseconds","extraDays","UTCtoTAI","jd","leapSeconds","leapSecondsTable","index","TAItoUTC","tai","diff","UTCtoDate","utc","julianDayNumber","L","N","I","J","remainingSeconds","minute","second","millisecond","UTC","addMilliseconds","milliseconds","addSeconds","seconds","__ls","J2000TAI","console","trace","days","hours","minutes","Box","boundsArr","vertices","setFromBoundsArr","bbox","len","bounds","setFromExtent","Sphere","radius","center","setFromBounds","createEvents","methodNames","sender","Events","eventNames","__id","__counter__","_eventNames","registerNames","_sender","_stopPropagation","_stampCache","bindSender","active","handlers","_getStamp","name","ogid","_stamp","st","on","callback","priority","bind","_openglobus_priority","off","indexToRemove","dispatch","event","slice","stopPropagation","VIEW_EVENTS","View","options","events","model","parent","_classList","getHTML","insertAfter","newNodes","referenceNode","parentNode","insertBefore","nextSibling","view","render","HTMLElement","appendTo","node","clean","firstPosition","beforeRender","afterRender","renderTemplate","select","queryStr","querySelector","selectRemove","selectAll","querySelectorAll","remove","BUTTON_EVENTS","Button","super","icon","title","_onMouseDown","preventDefault","mousedown","_onMouseUp","mouseup","_onTouchStart","touchstart","_onTouchEnd","touchend","_onTouchCancel","touchcancel","_onMouseClick","_mouseClickHandler","$icon","$text","__og_button__","_initEvents","click","_clearEvents","removeEventListener","Control","_name","planet","_initialized","renderer","autoActivate","_active","_deferredActive","oninit","onadd","onremove","onactivate","ondeactivate","addTo","controls","isInitialized","activate","deactivate","isActive","control","CompassButton","_heading","_svg","btn","_onClick","_draw","getCartesianFromPixelTerrain","handler","flyCartesian","camera","eye","look","setHeading","getHeading","heading","transform","CLOSE_ICON","DIALOG_EVENTS","Dialog","display","visible","resize","resizable","minHeight","maxHeight","minWidth","maxWidth","_onCloseBtnClick","close","_onMouseDownAll","bringToFront","_startDragging","_startPosX","clientX","_startPosY","clientY","_onMouseMove","setPosition","offsetLeft","offsetTop","_clearDragging","$header","$title","$container","$buttons","_closeBtn","useHide","_visibility","setContainer","container","zIndex","__zIndex__","_initButtons","show","visibility","hide","setVisibility","contains","dragstart","dragend","TOGGLEBUTTON_EVENTS","ToggleButton","preventClick","setActive","_isActive","_toggle","change","toggle","OPSIDE","NEIGHBOUR","OPPART","PARTOFFSET","Material","segment","layer","isReady","isLoading","texture","pickingMask","textureExists","appliedNodeId","appliedNode","texOffset","loadingAttempts","_updateTexture","_updatePickingMask","pickingReady","abortLoading","abortMaterialLoading","_createTexture","img","_planet","createTexture","_internalFormat","applyImage","initialized","nodeId","applyTexture","textureNotExists","clearMaterial","FADING_RATIO","Layer","isVector","_iconSrc","iconSrc","LAYER_EVENTS","properties","hideInLayerSwitcher","_hasImageryTiles","_opacity","minZoom","maxZoom","_attribution","attribution","_zIndex","_isBaseLayer","isBaseLayer","_defaultTextures","defaultTextures","_fading","fading","_fadingFactor","_fadingOpacity","_height","_extent","_textureFilter","textureFilter","toUpperCase","_isSRGB","isSRGB","_extentMerc","setExtent","utils.createExtent","_pickingColor","_pickingEnabled","pickingEnabled","_isPreloadDone","_preLoadZoomLevels","preLoadZoomLevels","_ambient","_diffuse","_specular","ambient","utils.createColorRGB","diffuse","specular","shininess","nightTextureCoefficient","rgb","getTMS","getTileIndex","instanceName","rendererEvents","picking","hasImageryTiles","getID","_id","_assignPlanet","_layers","gl","SRGB8_ALPHA8","RGBA8","_onLayerVisibilityChanged","setBaseLayer","layeradd","updateVisibleLayers","_bindPicking","_preLoad","isIdle","_terrainCompletedActivated","assignPickingColor","clearPickingColor","layerremove","_clearLayerMaterial","setAttribution","html","updateAttributionsList","getAttribution","setHeight","setZIndex","getZIndex","visibleTileLayers","baseLayer","visibilitychange","_forceMaterialApply","pm","materials","createMaterial","_renderCompleted","applyMaterial","material","loadMaterial","forceLoading","isForced","_preLoadRecursive","tileZoom","includes","nodes","quadTreeStrategy","quadTreeList","getVisibility","mercator.MIN_LAT","mercator.MAX_LAT","_correctFullExtent","getExtent","getExtentMerc","flyExtent","viewExtent","screenOpacity","_refreshFadingOpacity","getViewExtent","maxCurrZoom","minCurrZoom","redraw","clearLayerMaterial","CANVASTILES_EVENTS","CanvasTiles","animated","minNativeZoom","maxNativeZoom","_counter","_pendingsQueue","drawTile","_onLoadend_","_onLoadend","layerloadend","forEach","qi","seg","_isNorth","solidTextureOne","solidTextureTwo","transparentTexture","layerLock","isFree","__requestsCounter","MAX_REQUESTS","_exec","load","requestAnimationFrame","canvas","_correctCounter","_dequeueRequest","pmat","_whilePendings","loadend","pop","getState","pn","parentTextureExists","passReady","mId","psegm","pnm","dZ2","default","deleteTexture","BUTTONGROUP_EVENTS","ButtonGroup","_onChange","_buttons","bi","buttons","_bindButton","button","BaseWorker","numWorkers","program","_sourceId","_source","Map","_pendingQueue","_numWorkers","_workerQueue","setProgram","check","make","Worker","URL","createObjectURL","onmessage","_onMessage","unshift","target","data","destroy","terminate","pendingQueue","LOCK_UPDATE","LOCK_FREE","LabelWorker","LABEL_PROGRAM","label","_lockId","workerCallback","delete","_entityCollection","labelData","serializeWorkerData","postMessage","buffer","BaseBillboard","_position","utils.createVector3","position","_positionHigh","_positionLow","_rotation","rotation","_color","utils.createColorRGBA","color","_alignedAxis","alignedAxis","_offset","_entity","_handler","_handlerIndex","_isReady","setPositionArr","setPosition3v","getPosition","setOffset","setOffsetArr","setOffset3v","getOffset","setRotationArr","getRotation","setOpacity","setRgbaArr","setColor","setColor4v","setColorHTML","utils.htmlColorToRgba","getColor","setAlignedAxis","setAlignedAxisArr","setAlignedAxis3v","getAlignedAxis","setPickingColor3v","setPickingColorArr","workerId","Billboard","_src","_image","_scale","_width","setSrc","bh","rn","renderNode","ta","billboardsTextureAtlas","that","__nodeIndex","setTexCoordArr","texCoords","addImage","updateBillboardsTexCoords","getSrc","setImage","getImage","setSize","setSizeArr","getSize","setWidth","GeometryType","POINT","LINESTRING","POLYGON","MULTIPOLYGON","MULTILINESTRING","Geometry","_polyVerticesHighMerc","_polyVerticesLowMerc","_polyVerticesLength","_polyIndexesLength","_polyVerticesHandlerIndex","_polyIndexesHandlerIndex","_lineVerticesHighMerc","_lineVerticesLowMerc","_lineVerticesLength","_lineOrdersLength","_lineIndexesLength","_lineColorsLength","_lineThicknessLength","_lineVerticesHandlerIndex","_lineOrdersHandlerIndex","_lineIndexesHandlerIndex","_lineThicknessHandlerIndex","_lineColorsHandlerIndex","_type","getType","_coordinates","coordinates","_style","fillColor","lineColor","strokeColor","lineWidth","strokeWidth","_pickingReady","typeStr","geometryObj","outCoordinates","ci","cij","pi","pij","pijk","setGeometry","geoJson","setFillColor","setPolyColorArr","setFillColor4v","rgba","setStrokeColor","setLineStrokeColorArr","setLineColor","setLineColorArr","setStrokeColor4v","setLineColor4v","setStrokeOpacity","setLineOpacity","setStrokeWidth","setLineStrokeArr","setLineWidth","setLineThicknessArr","setFillOpacity","setGeometryVisibility","Line2","getParallel","getIntersection","L0","L1","intersects","Line3","getMagnitude","getSphereIntersection","sphere","cx","cz","px","py","pz","vx","vy","vz","t1","solution1","t2","solution2","line","res2","p13","p43","p21","d1343","d4321","d1321","d4343","denom","mua","mub","getNearestDistancePoint","point","mag","Ray$1","Ray","origin","OUTSIDE","INSIDE","INPLANE","AWAY","getPoint","hitTriangle","w0","uv","vv","wu","wv","hitPlane","hitSphere","vpc","pc","lc","di1","cpcl","dist","hitBox","box","GeoObject","_tag","tag","instanced","_pitch","_yaw","_roll","_direction","_tagData","_tagDataIndex","_object3d","object3d","_qNorthFrame","getDirection","normals","indices","updateDirection","setYaw","setPitch","setPitchRollArr","setRoll","setScale","setScaleArr","getScale","getNorthFrameRotation","qq","setDirectionArr","ALIGN","STR2ALIGN","Label","_text","_face","utils.defaultString","face","_size","_outline","outline","_outlineColor","outlineColor","_align","align","_fontIndex","_fontAtlas","_isRTL","isRTL","setText","getText","setAlign","getAlign","setFace","update","getFace","setOutline","setOutlineArr","getOutline","setOutlineOpacity","setOutlineColor","setOutlineColorArr","setOutlineColor4v","setOutlineColorHTML","getOutlineColor","getOutlineOpacity","fontIndex","getFontIndex","_applyFontIndex","setFontIndexArr","assignFontAtlas","fontAtlas","_maxLetters","PointCloud","pointSize","pickingScale","_renderNode","_points","_coordinatesData","_colorData","_pickingColorData","_coordinatesBuffer","_colorBuffer","_pickingColorBuffer","_buffersUpdateCallbacks","_createCoordinatesBuffer","_createColorBuffer","_createPickingColorBuffer","_changedBuffers","points","setPoints","_deleteBuffers","setRenderNode","_setPickingColors","col","pointCloud","setPointPosition","setPointColor","addPoints","addPoint","removePoint","insertPoint","draw","_update","sh","programs","_program","sha","shu","uniforms","uniformMatrix4fv","projectionViewMatrix","activeCamera","getProjectionViewMatrix","uniform1f","bindBuffer","ARRAY_BUFFER","vertexAttribPointer","itemSize","FLOAT","colors","drawArrays","POINTS","numItems","drawPicking","call","deleteBuffer","createArrayBuffer","Polyline","altitude","thickness","_defaultColor","_closedLine","isClosed","_path3v","_pathLengths","_pathLonLat","_pathLonLatMerc","_pathColors","pathColors","_verticesHigh","_verticesLow","_orders","_indexes","_colors","_verticesHighBuffer","_verticesLowBuffer","_ordersBuffer","_indexesBuffer","_colorsBuffer","_createVerticesBuffer","_createIndexBuffer","_createColorsBuffer","pathLonLat","setPathLonLat","path3v","setPath3v","_refresh","appendLineData3v","defaultColor","outVerticesHigh","outVerticesLow","outOrders","outIndexes","outTransformedPathLonLat","outPath3v","outTransformedPathMerc","outExtent","outColors","v_high","v_low","path","pathColors_j","last","startIndex","cur","cartesianToLonLat","first","appendPoint3v","point3v","pathColors_last","transformedPathLonLat","transformedPathMerc","appendLineDataLonLat","outTransformedPathCartesian","outPathLonLat","pp","cartesian","_setEqualPath3v","vh","pji","l1","_setEqualPathLonLat","setPointLonLat","segmentIndex","setPoint3v","skipLonLat","kk","_resizePathLengths","removeSegment","concat","multiLineIndex","insertPoint3v","multilineIndex","cc","addPoint3v","skipEllipsoid","addPointLonLat","_clearData","setThickness","getThickness","_createDataLonLat","_createData3v","pathLonlat","getPath3v","getPathLonLat","getPathColors","setPathColors","slen","forceEqual","polyline_screen","ec","disable","CULL_FACE","depthOffset","polygonOffsetUnits","proj","getProjectionMatrix","getViewMatrix","uniform3fv","eyePositionHigh","eyeHigh","eyePositionLow","eyeLow","uniform2fv","uFloatParams","_planetRadius2","_tanViewAngle_hradOneByHeight","viewport","prevHigh","currentHigh","nextHigh","prevLow","currentLow","nextLow","order","ELEMENT_ARRAY_BUFFER","drawElements","TRIANGLE_STRIP","UNSIGNED_INT","enable","polyline_picking","uniform4fv","createStreamArrayBuffer","setStreamArrayBuffer","Uint32Array","createElementArrayBuffer","_thickness","_startPosition","startPosition","_startPositionHigh","_startPositionLow","_endPosition","endPosition","_endPositionHigh","_endPositionLow","_startColor","startColor","_endColor","endColor","setStartPosition","setStartPositionArr","getLength","setStartPosition3v","setEndPosition","setEndPositionArr","setEndPosition3v","setThicknessArr","setColors4v","setColorsHTML","getStartPosition","getEndPosition","_tempHigh","_tempLow","Strip","_indexBuffer","_path","_gridSize","setPath","_createBuffers","strip","viewMatrix","projectionMatrix","uColor","uOpacity","aVertexPositionHigh","aVertexPositionLow","addEdge3v","vHigh","vLow","gs","gs1","di","p02","dj","p01","p23","ind3","setEdge3v","vSize","prev","p4","p5","next","p35","p24","ij","p45","warn","removeEdge","setGridSize","getPath","insertEdge3v","Entity","childrenNodes","_cartesian","_lonLat","utils.createLonLat","_lonLatMerc","_altitude","_entityCollectionIndex","_layer","_layerIndex","_featureConstructorArray","billboard","setBillboard","setLabel","polyline","setPolyline","setPointCloud","geometry","geoObject","setGeoObject","setStrip","ray","setRay","_createOptionFeature","entity","layerIndex","featureName","getCollectionIndex","collection","rightNow","removeEntity","setCartesian3v","setCartesian","_setCartesian3vSilent","getLonLat","setLonLat","lonLatToCartesianRes","setLonLat2","setAltitude","getAltitude","getCartesian","billboardHandler","labelHandler","rayHandler","polylineHandler","pointCloudHandler","geoObjectHandler","stripHandler","appendChildEntity","setPickingColor","objParser","objPositions","objTexcoords","objNormals","objVertexData","vertexData","materialLibs","geometries","groups","object","newGeometry","addVertex","vert","objIndexStr","objIndex","keywords","parts","vn","vt","textures","numTriangles","tri","mtllib","unparsedArgs","usemtl","keywordRE","lines","lineNo","startsWith","keyword","Object","fromEntries","entries","filter","array","transformLeftToRightCoordinateSystem","objData","convertedGeometries","cosA","sinA","nx","ny","nz","rotateObject","convertedVertices","convertedNormals","convertedTextures","Object3d","_vertices","_numVertices","_texCoords","centering","_indices","_normals","getNormals","verts","min_x","min_y","min_z","max_x","max_y","max_z","c_x","c_y","c_z","numVertices","centroid","minX","minY","minZ","maxX","maxY","maxZ","t03","t13","t23","v0_x","v0_y","v0_z","vv0_x","vv0_y","vv0_z","vv1_x","vv1_y","vv1_z","n_x","n_y","n_z","createSphere","lonBands","latBands","offsetX","offsetY","offsetZ","latNumber","theta","sinTheta","cosTheta","longNumber","phi","sinPhi","createDisc","radialSegments","isTop","thetaLength","sign","centerIndexStart","centerIndexEnd","createCylinder","radiusTop","radiusBottom","heightSegments","isBottom","indexArray","slope","indexRow","cap","createCube","depth","xOffset","yOffset","zOffset","createArrow","back","front","loadObj","fetch","mode","then","response","catch","BaseNode","topNode","_dictionary","addNode","_clear","getNodeByName","RenderNode","drawMode","lightEnabled","_lights","_lightsNames","_lightsPositions","_lightsParamsv","_lightsParamsf","entityCollections","_pickingId","assign","addPickingCallback","_entityCollectionPickingCallback","initialize","bindRenderNode","init","renderNodes","_renderNodesArr","removePickingCallback","addEntityCollection","entityCollection","isHidden","removeEntityCollection","addLight","light","getLightByName","li","indexOf","removeLight","preDrawNode","_preDrawNodes","drawNode","_drawNodes","setDrawMode","transformLights","tp","refreshTexCoordsArr","frame","preFrame","drawEntityCollections","enqueueEntityCollectionsToDraw","drawPickingEntityCollections","cons","_container","logErr","logWrn","_declarations","types","variableHandlers","MAT4","variable","_pName","value","MAT3","uniformMatrix3fv","INT","uniform1i","VEC2","VEC3","VEC4","SAMPLER2D","pgl","activeTexture","TEXTURE0","_textureID","bindTexture","TEXTURE_2D","SAMPLERCUBE","TEXTURE_CUBE_MAP","SAMPLER2DARRAY","samplerArr","Int32Array","uniform1iv","INTXX","FLOATXX","uniform1fv","vertexAttrib1f","vertexAttrib2fv","vertexAttrib3fv","itemTypes","Program","_attributes","_uniforms","vertexShader","fragmentShader","_variables","_p","_attribArrays","_attribDivisor","vertexAttribDivisor","drawElementsInstanced","itemType","normalized","use","useProgram","drawIndexBuffer","UNSIGNED_SHORT","_getShaderCompileStatus","shader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","_createVertexShader","createShader","VERTEX_SHADER","_createFragmentShader","FRAGMENT_SHADER","disableAttribArrays","disableVertexAttribArray","enableAttribArrays","enableVertexAttribArray","deleteProgram","createProgram","fs","vs","attachShader","linkProgram","ext","getExtension","drawElementsInstancedANGLE","vertexAttribDivisorANGLE","getProgramParameter","LINK_STATUS","getProgramInfoLog","itemTypeStr","divisor","getAttribLocation","loc","getUniformLocation","detachShader","deleteShader","PROJECT","ROTATE2D","BaseBillboardHandler","_renderer","_billboards","_positionHighBuffer","_positionLowBuffer","_sizeBuffer","_offsetBuffer","_rgbaBuffer","_rotationBuffer","_texCoordBuffer","_vertexBuffer","_texCoordArr","_vertexArr","_positionHighArr","_positionLowArr","_sizeArr","_offsetArr","_rgbaArr","_rotationArr","_pickingColorArr","createPickingColorBuffer","createPositionBuffer","createSizeBuffer","createOffsetBuffer","createRgbaBuffer","createRotationBuffer","createTexCoordBuffer","createVertexBuffer","concArr","curr","initProgram","addProgram","u_texture","planetRadius","uScaleByDistance","a_vertices","a_texCoord","a_positionsHigh","a_positionsLow","a_offset","a_size","a_rotation","a_rgba","billboardPicking","setRenderer","refresh","_removeBillboards","_displayPASS","scaleByDistance","clientWidth","clientHeight","TRIANGLES","_pickingPASS","reindexBillboardsArray","_removeBillboard","positionHigh","positionLow","tcoordArr","vArr","setVertexArr","vertexArr","BillboardHandler","props","_addBillboardToArrays","billboards","imageNode","setParametersToArray","InstanceData","_geoObjectHandler","geoObjects","numInstances","_texture","_textureSrc","_pitchRollArr","_directionArr","_normalsArr","_indicesArr","_visibleArr","_pitchRollBuffer","_directionBuffer","_normalsBuffer","_indicesBuffer","_visibleBuffer","createDirectionBuffer","createNormalsBuffer","createIndicesBuffer","createPitchRollBuffer","createVisibleBuffer","createTextureDefault","GeoObjectHandler","_geoObjects","_instanceDataMap","_instanceDataMapValues","_dataTagUpdateQueue","geo_object","lightsPositions","lightsParamsv","lightsParamsf","uTexture","uUseTexture","aVertexPosition","aVertexNormal","aTexCoord","aPositionHigh","aPositionLow","aDirection","aPitchRoll","aColor","aScale","aDispose","geo_object_picking","aPickingColor","_loadDataTagTexture","_addGeoObjectToArray","tagData","values","defaultTexture","tagDataIndex","_updateTag","dataTag","_removeAll","gi","_removeGeoObject","_clearDataTagQueue","tdi","DEFINE","EMPTY","LabelHandler","maxLetters","_gliphParamBuffer","_fontIndexBuffer","_outlineBuffer","_outlineColorBuffer","_gliphParamArr","_fontIndexArr","_outlineArr","_outlineColorArr","createFontIndexBuffer","createOutlineBuffer","createOutlineColorBuffer","fontTextureArr","sdfParamsArr","isOutlinePass","a_outline","a_gliphParam","a_fontIndex","labelPicking","labels","updateFonts","_addLabelToArrays","labelWorker","texCoordArr","gliphParamArr","positionHighArr","positionLowArr","sizeArr","offsetArr","rgbaArr","rotationArr","fontIndexArr","outlineArr","outlineColorArr","pickingColorArr","depthFunc","EQUAL","LESS","ml","fa","atlasesArr","_rtl_","kern","kernings","char","tc","metrics","nWidth","nHeight","nXOffset","nYOffset","nAdvance","xl","yl","zl","setMaxLetters","PointCloudHandler","_pointClouds","_initProgram","_reindexPointCloudArray","PolylineHandler","_polylines","reindexPolylineArray","ls","RayHandler","_rays","_startPositionHighBuffer","_startPositionLowBuffer","_endPositionHighBuffer","_endPositionLowBuffer","_thicknessBuffer","_startPositionHighArr","_startPositionLowArr","_endPositionHighArr","_endPositionLowArr","_thicknessArr","createStartPositionBuffer","createEndPositionBuffer","createThicknessBuffer","rayScreen","resolution","a_startPosHigh","a_startPosLow","a_endPosHigh","a_endPosLow","a_thickness","_removeRays","ri","_addRayToArrays","r0","g0","b0","a0","r1","g1","reindexRaysArray","_removeRay","DYNAMIC_DRAW","StripHandler","_strips","reindexStripArray","EntityCollection","_renderNodeIndex","labelMaxLetters","setPickingEnabled","_entities","math.MAX32","ENTITYCOLLECTION_EVENTS","entities","addEntities","getOpacity","setScaleByDistance","farInvisible","_addRecursively","entityadd","belongs","_removeRecursively","reindexEntitiesArray","entityremove","_removeEntitySilent","createPickingColors","_updateGeodeticCoordinates","updateBillboardsTextureAtlas","updateLabelsFontAtlas","ei","getEntities","each","_clearEntity","EntityCollectionNode","partId","state","count","deferredEntities","_inTheQueue","bsphere","_setExtentBounds","insertEntity","buildTree","_addEntitiesToCollection","_quadNode","_bindEventsDefault","equatorialSize","__setLonLat__","_nodeCapacity","cn","createChildrenNodes","en_nw","en_ne","en_sw","en_se","_nodePtr","size_x","size_y","nd","collectRenderCollectionsPASS1","visibleNodes","renderCollection","_secondPASS","collectRenderCollectionsPASS2","renderingNodeId","cam","altVis","frustum","containsSphere","applyCollection","traverseTree","_renderingNodes","_queueDeferredNode","clampToGround","relativeToGround","alignEntityToTheGround","_renderedNodes","isEntityInside","getEntityTerrainPoint","alt","getSurfaceNormal3v","isVisible","EntityCollectionNodeWGS84","isNorth","_renderingNodesNorth","_renderingNodesSouth","renderingNode","doubleToTwoFloats2","highLowArr","doubleToTwoFloatsV2","highLowVec","earcut","holeIndices","dim","hasHoles","outerLen","outerNode","linkedList","triangles","list","queue","steiner","getLeftmost","sort","compareX","eliminateHole","filterPoints","eliminateHoles","earcutLinked","clockwise","sum","signedArea","insertNode","removeNode","again","area","ear","pass","zOrder","prevZ","nextZ","tail","numMerges","pSize","qSize","inSize","sortLinked","indexCurve","stop","isEarHashed","isEar","cureLocalIntersections","splitEarcut","pointInTriangle","minTX","minTY","maxTX","maxTY","locallyInside","isValidDiagonal","splitPolygon","hole","hx","hy","qx","Infinity","my","tanMin","findHoleBridge","leftmost","intersectsPolygon","inside","middleInside","q1","q2","Node","an","bp","flatten","holes","dimensions","holeIndex","tempHigh","tempLow","tempHighLow","GeometryHandler","_geometries","_updatedGeometryArr","_updatedGeometry","_removeGeometryExtentArr","_removeGeometryExtents","_polyColors","_polyPickingColors","_polyIndexes","_lineOrders","_lineIndexes","_lineColors","_linePickingColors","_lineThickness","_lineStrokes","_lineStrokeColors","_polyVerticesHighBufferMerc","_polyVerticesLowBufferMerc","_polyColorsBuffer","_polyPickingColorsBuffer","_polyIndexesBuffer","_lineVerticesHighBufferMerc","_lineVerticesLowBufferMerc","_lineColorsBuffer","_linePickingColorsBuffer","_lineThicknessBuffer","_lineStrokesBuffer","_lineStrokeColorsBuffer","_lineOrdersBuffer","_lineIndexesBuffer","createPolyVerticesBuffer","createPolyIndexesBuffer","createPolyColorsBuffer","createLineVerticesBuffer","createLineIndexesBuffer","createLineOrdersBuffer","createLineColorsBuffer","createLineThicknessBuffer","createLineStrokesBuffer","createLineStrokeColorsBuffer","createPolyPickingColorsBuffer","createLinePickingColorsBuffer","appendLineData","pathArr","pickingColor","strokeSize","outPickingColors","outThickness","outStrokeColors","outStrokes","outVerticesHigh2","outVerticesLow2","sc","assignHandler","mercator.forward_lon","mercator.forward_lat","indexes","verticesHigh","verticesLow","cci","dataIndexes","_refreshRecursevely","treeNode","ready","lid","ni","getExtentLonLat","_refreshRecursevelyExt","_refreshPlanetNode","_updatePlanet","ql","needUpdate","polyIndexes","lineIndexes","QueueArray","_array","_popIndex","_shiftIndex","reset","shift","Vector","VECTOR_EVENTS","nodeCapacity","_entitiesConstructor","_labelMaxLetters","_stripEntityCollection","_polylineEntityCollection","_geoObjectEntityCollection","_geometryHandler","_entityCollectionsTree","_entityCollectionsTreeNorth","_entityCollectionsTreeSouth","_deferredEntitiesPendingQueue","setEntities","_proceedEntity","insert","temp","_reindexEntitiesArray","defEntities","removeEntities","entitiesForTree","_createEntityCollectionsTree","ve","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","doubletouch","touchleave","touchenter","_collectStripCollectionPASS","_collectPolylineCollectionPASS","rtg","visibleExtent","e_i","coords","c_j","c_j_h","ll","n_k","cart","getTerrainPoint","_collectGeoObjectCollectionPASS","collectVisibleCollections","_visibleNodes","_visibleNodesNorth","_visibleNodesSouth","_execDeferredNode","_vectorTileCreator","notEmpty","POLYGONDRAWINGSCENE_EVENTS","POINTER_OBJ3D","NUM_SEGMENTS","OUTLINE_ALT","CORNER_OPTIONS","CENTER_OPTIONS","OUTLINE_OPTIONS","PolygonDrawingScene","_cornerDblClick","geometryType","getCoordinates","_geometryLayer","_onCornerMouseEnter","cursor","hideGhostPointer","_onCornerMouseLeave","showGhostPointer","_onCenterMouseEnter","_onCenterMouseLeave","_pickedCenter","_pickedCorner","_onLup","mouseNavigation","setGhostPointerPosition","_onCornerLdown","_getLdown","_onCenterLdown","_moveCenterPoint","_moveCornerPoint","_onCornerLdblclick","pickingObject","setCoordinates","_onMouseDblClick","_showGhostPointer","_addNew","_isStartPoint","_cornerLayer","startpoint","_initCoordinates","_startPos","_startClick","_centerLayer","_outlineLayer","_ghostCorner","_ghostOutlineLayer","_insertCornerIndex","corners","bindPlanet","_initGhostLayerPointer","addLayer","startNewPoint","deactivateDoubleClickZoom","stopNewPoint","centers","_clearGhostPointer","_appendCart","groundPos","_updateGhostOutlinePointer","getPixelFromCartesian","_drawCorners","_checkTerrainCollision","_drawCenters","_drawGhostCorner","_tempTerrPoint","_extentLonLat","newCorner","prevCorn","corner","firstCart","prevCart","vecPrev","vecFirst","distPrev","distFirst","prevPath","firstPath","firstCenter","prevCenterCart","firstCenterCart","groundCoords","cartPrev","cartNext","vecNext","distNext","pathPrev","pathNext","prevPolyline","nextPolyline","prevCenter","nextCenter","nextCenterCart","minDist","cCurr","cNext","nPrev","nNext","nGround","midVec","toMid","LineStringDrawingScene","_moveCorner","indexCurrent","indexPrev","indexCenter","cartCurr","vecCurr","distCurr","centerCart","DrawingControl","_drawingScene","activatePolygonDrawing","activateLineStringDrawing","heightMode","ell","msl","gnd","FT_to_M","FT_to_KM","_abbr","_tenth","_convFn","convert","to","val","convertExt","isNotNaN","unitFrom","unitTo","fixed","TYPE_HTML","EarthCoordinates","_TYPE_FUNC","_SHOW_DECIMAL","_SHOW_DEGREE","_showFn","_el","_latSideEl","_lonSideEl","_latValEl","_lonValEl","_heightEl","_altUnitVal","altitudeUnit","_heightModeVal","_altUnit","units","_heightMode","_centerMode","centerMode","deg","sec","_createCenterEl","className","_updateUnits","units.toString","_showHeight","_refreshCoordinates","_grabCoordinates","scrPx","getLonLatFromPixelTerrain","getHeightAboveELL","units.convertExt","getHeightDefault","TouchExt$1","prev_x","prev_y","grabbedPoint","grabbedSpheroid","dX","dY","EarthNavigation","grabbedDir","inertia","_vRot","_hRot","_a","scaleRot","currState","positionState","touches","TouchExt","switchZoomState","wheelDelta","stopRotation","stopFlying","flyLonLat","onMouseWheel","onMouseLeftButtonDown","onMouseLeftButtonClick","onMouseLeftButtonUp","onTouchStart","onTouchEnd","onTouchMove","onDraw","sys","pageX","pageY","unproject","targetPoint","_u","lim","getCartesianFromMouseTerrain","isFlying","mouseState","moving","getUp","leftButtonDown","controlsBag","BASEGEOIMAGE_EVENTS","BaseGeoImage","_projType","_frameWidth","_frameHeight","_sourceReady","_sourceTexture","_materialTexture","_gridBufferLow","_gridBufferHigh","_extentWgs84ParamsHigh","_extentWgs84ParamsLow","_extentMercParamsHigh","_extentMercParamsLow","_refreshFrame","_frameCreated","_sourceCreated","_animate","_ready","_creationProceeding","_isRendering","_extentWgs84","_cornersWgs84","_cornersMerc","_isFullExtent","fullExtent","rendering","_renderingProjType0","setCorners","getCornersLonLat","getCorners","setCornersLonLat","me","_renderingProjType1","_geoImageCreator","_createFrame","tempArr","createEmptyTexture_l","gridBufferArr","createGridBuffer","v0s","v0t","sSize_x","sSize_y","getFrameWidth","getFrameHeight","_createSourceTexture","creator","_framebuffer","geoImageTransform","bindOutputTexture","clearColor","COLOR_BUFFER_BIT","isFullExtent","_texCoordsBuffer","cornersHigh","cornersLow","extentParamsHigh","extentParamsLow","sourceTexture","input","MB_LEFT","MB_RIGHT","MB_MIDDLE","KEY_CTRL","KEY_ALT","KEY_SHIFT","KEY_SPACE","KEY_PGUP","KEY_PGDN","KEY_LEFT","KEY_UP","KEY_RIGHT","KEY_DOWN","KEY_PRINTSCREEN","KEY_EQUALS","KEY_A","KEY_C","KEY_D","KEY_E","KEY_F","KEY_H","KEY_I","KEY_K","KEY_L","KEY_N","KEY_O","KEY_P","KEY_Q","KEY_R","KEY_S","KEY_V","KEY_W","KEY_X","KEY_Z","KEY_PLUS","KEY_F1","KEY_MINUS","KEY_APOSTROPHE","KEY_BACK_SLASH","KEY_MORE","KEY_SLASH","KEY_LESS","KEY_LEFT_SQUARE_BRACKET","KEY_RIGHT_SQUARE_BRACKET","KEY_SINGLE_QUOTE","LAYERANIMATION_EVENTS","LayerButtonView","_onVisibilityChange","_onDblClick","SLIDER_EVENTS","Slider","_onResize","_setOffset","_value","$panel","_max","_min","_onMouseWheel","window","_onMouseWheelFF","_onInput","rect","getBoundingClientRect","$pointer","_resizeObserver","ResizeObserver","$label","$progress","$input","observe","Lock","_lock","lock","free","isLocked","Key","MouseNavigation","_deactivate","_shiftBusy","_eye0","pointOnEarth","earthUp","qRot","distDiff","stepsCount","stepsForward","stepIndex","_lmbDoubleClickActive","minSlope","_wheelDirection","_keyLock","getMovePointsFromPixelTerrain","delta","dir","steps","_b","_r","scaled_n","rotArr","eyeArr","breaked","onMouseRightButtonDown","onMouseRightButtonClick","onMouseMove","onMouseLeave","onMouseEnter","onMouseLeftButtonDoubleClick","activateDoubleClickZoom","renderEvents","isKeyPressed","releaseKeys","updateButtonsStates","lockPlanet","onShiftFree","maxAlt","maxAltitude","polarSize","minAlt","minAltitude","camAlt","freePlanet","math.RADIANS","rotateHorizontal","rotateVertical","prevEye","sf","skipTerrain","terrainLock","_normalMapCreator","distanceFormat","obj3d","LABEL_OPTIONS","RULER_CORNER_OPTIONS","RulerScene","_startLonLat","_anchorLonLat","_cornerEntity","_onLUp","_onCornerLup","_onCornerEnter","_onCornerLeave","_onLdblclick","_preventClick","_onLclick","startLonLat","_timeout","_stopDrawing","_propsLabel","endLonLat","_drawLine","newLonLat","RULERSCENE_EVENTS","_ignoreTerrain","ignoreTerrain","_trackLayer","_labelLayer","_cornersLayer","_trackEntity","_createCorners","_activate","startPos","endPos","initialAzimuth","removeLayer","isCornersPositionChanged","Ruler","_rulerScene","RAYS_OPTIONS","HeightRulerScene","_geoRulerLayer","_rayV","_rayH","_heightLabels","deltaLabel","startLabel","endLabel","startCorner","endCorner","startCornerLonLat","startCornerHeight","endCornerLonLat","endCornerHeight","maxHeightCornerLonLat","minHeightCornerLonLat","deltaHeight","_updateHeightRaysAndLabels","middleLonLat","startHeight","endHeight","HeightRuler","ScaleControl","_template","_minWidth","_maxWidth","_isCenter","isCenter","_mPx","currWidth","_metersInMinSize","_scaleLabelEl","_renderTemplate","_drawScreen","terrain","leftButtonHold","rightButtonHold","ms","s0","getDistanceFromPixel","project","getForward","tempSize","viewAngle","getRight","s1","metersInMinSize","minMeters","innerText","SimpleSkyBackground","_colorOne","_colorTwo","colorOne","colorTwo","iResolution","fov","camPos","earthRadius","_drawBackground","simpleSkyBackground","DEPTH_TEST","screenFramePositionBuffer","getViewAngle","getPolarSize","AU_TO_METERS","getSunPosition","jDate","jd.J2000","M","math.rev","oblecl","math.DEGREES","xequat","yequat","zequat","math.TWO_PI","astro.AU_TO_METERS","LightSource","directional","_shininess","_tempAmbient","_tempDiffuse","_tempSpecular","_tempShininess","setBlack","setAmbient3v","setAmbient","setDiffuse3v","setDiffuse","setSpecular3v","setSpecular","setShininess","Sun","activationHeight","offsetVertical","offsetHorizontal","sunlight","_currDate","_prevDate","_clockPtr","_lightOn","_f","_k","_stopped","stopped","defaultClock","bindClock","clock","currentDate","tu","_vec","_vecPrev","TouchNavigation","_touching","onDoubleTouch","onTouchCancel","t0","pixelRatio","_startTouchOne","middle","earthMiddlePoint","prevAngle","deltaAngle","distanceToPointOnEarth","zoomCur","zoomPrev","rotateAround","panCur","panPrev","panOffset","checkTerrainCollision","ZoomControl","_move","_targetPoint","zoomInBtn","zoomOutBtn","zoomIn","stopZoom","zoomOut","SelectionScene","EVENT_NAMES","_onSelect","onSelect","_autoSelectionHide","autoSelectionHide","_onMouseMove_","_onMouseLdown_","_onMouseLdown","_onMouseLup_","_onMouseLup","direct","createPath","sideA","sideB","dateToStr","showTime","showMilliseconds","MONTHS","getMonth","padStart","drawNotch","ctx","strokeStyle","beginPath","moveTo","lineTo","stroke","drawText","font","fillStyle","baseLine","rotDeg","save","textBaseline","textAlign","fillText","restore","SCALES","TIMELINE_EVENTS","TimelineModel","_current","current","_rangeStart","rangeStart","_rangeEnd","rangeEnd","_range","getTime","_minDate","minDate","_maxDate","maxDate","multiplier","_requestAnimationFrameId","_prevNow","play","performance","_animationFrameCallback","cancelAnimationFrame","_frame","currentTime","range","rangeStartTime","rangeEndTime","MILLISECONDS_TO_SECONDS","TIMELINEVIEW_EVENTS","SCALE_NOTCH_COLOR","TimelineView","_isMouseOver","_canvasEl","pointerPosX","pointerCenterOffsetX","pointerTime","_millisecondsInPixel","_zoom","_isCurrentMouseOver","_isDragging","_clickPosX","_clickTime","_clickRangeStart","_clickRangeEnd","startdrag","_isCurrentDragging","_clickCurrentDate","startdragcurrent","_clickDelay","stopdrag","setcurrent","stopdragcurrent","_onMouseEnter","_onMouseOut","_onCurrentMouseEnter","_onCurrentMouseOut","offsetSec","newCurrent","$controls","_frameEl","_currentEl","_ctx","getContext","_canvasScale","_onResizeObserver_","_onResizeObserver","_pauseBtn","_playBtn","canvasScale","_resize","_drawCurrent","pause","playBack","playback","centerTimeOffset","newRangeStart","newRangeEnd","msPx","timeOffset","getOffsetByTime","_clearCanvas","fillRect","curPosX","scaleData","scaleMs","scalePx","segCount","originTime","addHours","setHours","getHours","Deferred","reject","promise","freeze","ELEVATIONPROFILE_EVENTS","ElevationProfile","_warningHeightLevel","_pointsReady","_isWarning","_minX","_planeDistance","_maxX","_minY","_maxY","_drawData","_promiseArr","_promiseCounter","_pMaxY","_pMinY","_pDist","_pTrackCoords","_pGroundCoords","_pIndex","setWarningHeightLevel","warningHeight","setRange","_getHeightAsync","pIndex","promiseCounter","geoid","getHeightLonLat","getHeightAsync","elv","_updatePointType","_collectCoordsBetweenTwoTrackPoints","internalPoints","scaleFactor","trackDir","dirSegLen","pjd","llx","_collectAllPoints","pointsLonLat","lonlat0","lonlat1","dirLength","n0","projLen","_getGroundElevation","_calcPointsAsync","all","trackCoords","planeDistance","pointsReady","isWarningOrCollision","drawData","collectProfile","startcollecting","counter","profilecollected","_setPointsType","TERRAIN_COLOR","LINE_COLORS","ELEVATIONPROFILEVIEW_EVENTS","ElevationProfileView","groundPoiIndex","$canvas","pointerDistance","_leftDistance","_rightDistance","groundData","trackData","gp0","gp1","groundElv","trackPoiIndex","tp0","tp1","trackElv","dblclick","_customFrame","_clickLeftDistance","_clickRightDistance","_onCanvasMouseMove","clearPointerCanvas","$pointerCanvas","redrawPointerCanvas","distanceOffset","_pixelsInMeter_x","setFrame","padDist","distanceCenterOffsetX","leftDistance","rightDistance","_pixelsInMeter_y","pointerEvents","_pointerCtx","$loading","_timeStartHandler","_hideLoading","_showLoading","clearCanvas","trackY","groundY","pointer","arc","fill","devicePixelRatio","distStr","clearRect","grd","createLinearGradient","addColorStop","_drawTrack","_drawTerrain","_drawWarningAndCollision","_drawLabels","yt","trackLength","prevP","aa","bb","yg","tracklength","groundLength","closePath","globalAlpha","groundlength","warningLength","collisionLength","pi0","pi1","warninglength","collisionlength","groundObj3d","headObj3d","POINTER_RAY_OPTIONS","POINTER_BILLBOARD_OPTIONS","POINTER_LABEL_OPTIONS","GROUND_POINTER_OPTIONS","HEAD_POINTER_OPTIONS","ElevationProfileScene","_onLClick","addGroundPoint3vAsync","_pickedGroundEntity","_startClickPos","_startEntityPos","groundCart","setGroundPointCartesian3v","_pickedHeadEntity","groundEntity","groundNormal","headPos","setHeadPointCartesian3v","_onGroundPointerEnter","_onGroundPointerLeave","_onGroundPointerLDown","_clampToGround","_onGroundPointerLUp","_onHeadPointerEnter","_onHeadPointerLeave","_onHeadPointerLDown","_onHeadPointerLUp","ELEVATIONPROFILESCENE_EVENTS","_groundPointersLayer","_headPointersLayer","_columnPointersLayer","_heightsLayer","_pointerHeadEntity","_pointerLabelEntity","_pointerRayEntity","_pointerLayer","minLon","minLat","maxLon","maxLat","_createGroundPointer","surfaceNormal","headCart","columnEntity","headEntity","heightLabelEntity","lonLatEll","setPointerCartesian3v","setPointerVisibility","getPointLonLat","getPointsLonLat","getHeightMSL","getHeightELLAsync","hGnd","hMsl","addPointLonLatArrayAsync","lonLatArr","Error","addPointLonLatAsync","ellLonLat","ellPos","hEll","addpoint","addGroundPointLonLatAsync","_addPoint","entityIndex","__tempVec__","nj","ELEVATIONPROFILEBUTTONSVIEW_EVENTS","ElevationProfileButtonsView","pointListBtn","resetBtn","locationBtn","PointListDialog","_onApplyClick","coordsArr","JSON","parse","$textarea","error","applyBtn","ElevationProfileLegend","$groundValue","$trackValue","$warningValue","$collisionValue","$trackUnits","$groundUnits","$warningUnits","$collisionUnits","setTrackLength","setGroundLength","setWarningLength","warningDist","setCollisionLength","collisionDist","_watch","watch","_toggleBtn","_dialog","_canvasTiles","applyCanvas","cnv","isPole","addWatches","watches","addWatch","watchEl","valEl","_fadingNodes","_createdNodesCount","_indexesCacheToRemoveCounter","_distBeforeMemClear","lodSize","deltaTime","_renderCompletedActivated","_terrainCompleted","_plainSegmentWorker","_tileLoader","loading","loader","_terrainWorker","queueSize","lockTreeBtn","lockQuadTree","unlockQuadTree","canvasTilesBtn","drawingControl","addControl","_createMenu","defaultBtn","polyBtn","lineBtn","_onSceneChange","_collectProfileThrottled","_onElevationProfilePointer","elevation","lonLat0","_elevationProfileScene","lonLat1","cart0","cart1","_onElevationProfileDblClick","poi","flyDistance","_onElevationProfileMouseEnter","_elevationProfileView","_onElevationProfileMouseLeave","_elevationProfileLegend","_elevationProfileButtonsView","_graphView","_poiListDialog","_cornerIndex","_catchCorner","_bindLayer","layers","_unbindLayer","_onMouseLeave","_onLDown","ground","getGreatCircleDistance","onCameraMoveForward","onCameraMoveBackward","onCameraStrifeLeft","onCameraStrifeRight","onCameraLookUp","onCameraLookDown","onCameraLookLeft","onCameraLookRight","onCameraRollLeft","onCameraRollRight","onCameraRollNorth","slide","onCameraTurnLeft","onCameraTurnRight","_currVisibleIndex","_onViewchange","_timeoutStart","_onLayerLoadend","currLayer","_layersArr","_currentIndex","_getFrameIndex","_frameSize","currVisibleLayer","prevFrame","_removeFrameFromPlanet","idle","_playInterval","playInterval","_playIntervalHandler","_playIndex","frameSize","repeat","skipTimeout","_getFramesNum","_setFrame","frameIndex","_appendFrameToPlanet","minIndex","maxIndex","_initLayers","_setCurrentIndexAsync","layersToRemove","setLayers","appendLayer","isPlaying","_checkEnd","setInterval","_clearInterval","setCurrentIndex","clearInterval","forceVisibility","prevCurrIndex","prevCurrFrame","currFrame","prevCurrLayer","frameChanged","layerView","_createLayerButton","_layerViews","$baseLayers","$overlays","_panel","_selectedLayer","$gamma","$exposure","$night","$opacity","$diffuse","$ambient","$specular","$atmosphereOpacity","_atmosphereMaxOpacity","_atmosphereMinOpacity","_gamma","_exposure","_night","_diffuse_r","_diffuse_g","_diffuse_b","_ambient_r","_ambient_g","_ambient_b","_specular_r","_specular_g","_specular_b","bindLayer","$suncontrol","sunStopBtn","sunActiveBtn","sun","lightingEnabledBtn","atmosphereEnabledBtn","atmosphereEnabled","atmosphereMinOpacity","gamma","getLayerByName","atmosphereMaxOpacity","Atmosphere","exposure","_onLayerAdd","_onLayerRemove","_fetchLayers","opt","zoomDiv","btnZoomIn","btnZoomOut","ruler","_createMenuBtn","_selectorScene","speed","startDate","endDate","_timelineView","setDate","toogleWireframe","LINE_STRIP","NewIndexesTypedArray","createCenterBodyIndexes","ind1","ind2","nr","createWestNeighborSkirt","deltaGr","grCount","rind","lind","createNorthNeighborSkirt","createEastNeighborSkirt","createSouthNeighborSkirt","rb","lb","initIndexesBodySkirts","table","dd","initIndexBodiesTable","createTextureCoords","Uint16Array","instance","maxGridSize","_maxGridSize","centerIndexesTable","skirtsIndexesTable","setMaxGridSize","createSegmentIndexes","sidesSizes","NewIndexesTypedArrayEmpty","initTextureCoordsTable","getInstance","UTILS","COMMON","NIGHT","DEF_BLEND","DEF_BLEND_WEBGL1","drawnode_screen_wl_webgl1NoAtmos","uGlobalTextureCoord","uNormalMapBias","samplerCount","tileOffsetArr","layerOpacityArr","uNormalMap","nightTexture","specularTexture","camHeight","aTextureCoord","BaseFramebuffer","_fbo","_depthComponent","depthComponent","_useDepth","useDepth","_depthRenderbuffer","_filter","forceDestroy","isComplete","checkFramebufferStatus","FRAMEBUFFER","FRAMEBUFFER_COMPLETE","checkStatus","bindFramebuffer","framebufferStack","popPrev","ImageCanvas","_canvas","_context","willReadFrequently","getCanvas","fillEmpty","imgd","getImageData","pixels","putImageData","getData","setData","imageData","createImageData","drawImage","toDataURL","getTextWidth","measureText","onload","openImage","windowContent","printWin","open","write","focus","Framebuffer","_isBare","isBare","_internalFormatArr","internalFormat","_formatArr","format","_typeArr","attachment","_attachmentArr","_renderbufferTarget","renderbufferTarget","deleteFramebuffer","deleteRenderbuffer","createFramebuffer","attachmentArr","ti","createEmptyTexture2DExt","att_i","drawBuffers","createRenderbuffer","bindRenderbuffer","RENDERBUFFER","renderbufferStorage","framebufferRenderbuffer","glAttachment","framebufferTexture2D","COLOR_ATTACHMENT0","readPixels","readBuffer","RGBA","readAllPixels","attachmentIndex","imageCanvas","_transmittanceBuffer","_scatteringBuffer","a_position","transmittanceTexture","scatteringTexture","sunPos","atmos.COMMON","_drawAtmosphereTextures","positionBuffer","transmittance","DEPTH_BUFFER_BIT","scattering","removeProgram","atmosphereBackground","TEXTURE1","sceneFramebuffer","Units","Proj","code","EPSG3857","EPSG4326","Slice","SLICE_SIZE_4","SLICE_SIZE","append","n4","_v0","_v1","_v2","_v3","_ray","_rayEx","_S","_V","Segment","_tileGroup","_projection","_plainRadius","_sw","_nw","_se","_ne","centerNormal","gridSizeByZoom","fileGridSize","tileXE","tileXW","tileYN","tileYS","tileIndex","_assignTileIndexes","plainReady","normalMapReady","terrainReady","terrainIsLoading","terrainExists","plainVertices","plainVerticesHigh","plainVerticesLow","plainNormals","terrainVertices","terrainVerticesHigh","terrainVerticesLow","tempVertices","tempVerticesHigh","tempVerticesLow","normalMapTexture","normalMapTextureBias","normalMapVertices","normalMapVerticesHigh","normalMapVerticesLow","normalMapNormals","vertexNormalBuffer","vertexPositionBuffer","vertexPositionBufferHigh","vertexPositionBufferLow","vertexTextureCoordBuffer","_globalTextureCoordinates","_appliedNeighborsZoom","_slices","readyToEngage","plainProcessing","normalMapTexturePtr","_transitionOpacity","_transitionTimestamp","checkZoom","_maxNodeZoom","getInsideLonLat","xyz","insideSegmentPosition","norm","qy","xn","yn","indX","indY","ind_v0","ind_v2","hitRay","projectNative","loadTerrain","elevationsNotExists","elevationsExists","elevations","_elevations","equalizeVertices","appliedTerrainNodeId","equalizedSideWithNodeId","_checkEqualization","neighborSide","neigborNode","equalize","nn","neighbors","gsOne","getOffsetOppositeNeighbourSide","nv","nvHigh","nvLow","n_gs","n_gsOne","inc","n_inc","nk","n_index","engage","createCoordsBuffers","_terrainWorkerCallback","setBoundingVolumeArr","nmc","_normalMapEdgeEqualize","side","nns","getEqualNeighbor","seg_a","seg_b","seg_a_raw","seg_b_raw","s_gs","s_gs1","i_a","i_b","vInd_a","vInd_b","applyTerrain","deleteBuffers","deleteMaterials","mi","deleteElevations","clearSegment","childrenInitialized","destroySegment","_setExtentLonLat","createBoundsByExtent","coord_sw","geodeticToCartesian","coord_ne","coord_nw","coord_se","setBoundingVolume3v","createBoundsByParent","pnGsOne","ind_sw","ind_nw","ind_ne","ind_se","pVerts","v_sw","v_ne","v_nw","v_se","bigOne","pseg","insideSize","t_i0","t_j0","coords_lt","coords_rb","v_lt","v_rb","vw","vi_y","vi_x","setBoundingSphere","setBoundingVolume","vmin","vmax","gsgs","_textureCoordsBufferCache","log2","_addViewExtent","viewExt","_viewExtent","pole","mercator.POLE","plainGridSize","sideSizeLog2","_assignGlobalTextureCoordinates","mercator.ONE_BY_POLE_DOUBLE","createPlainSegmentAsync","_plainSegmentWorkerCallback","plainRadius","createPlainSegment","_createPlainVertices","fgs","llStep","esw_lon","ene_lat","dg","r2","_invRadii2","gridSize3","nmInd","vertsHigh","vertsLow","norms","nmVerts","nmVertsHigh","nmVertsLow","nmNorms","nxl","nyl","nzl","getMaterialByLayer","_getLayerExtentOffset","initSlice","screenRendering","layerSlice","isOverlay","forcedOpacity","currHeight","getDefaultTexture","_getIndexBuffer","layerOverlap","_samplerArr","transitionOpacity","heightPickingRendering","increaseTransitionOpacity","transitionTime","fadingTransitionOpacity","colorPickingRendering","_pickingMaskArr","pickingMaskArr","depthRendering","cache","_indexesCache","segmentHelper.getInstance","_collectVisibleNodes","getNodeState","getNeighborSide","_vertOrder","_neGridSize","BOUNDS","Node$1","SegmentPrototype","prevState","_cameraInside","inFrustum","createBounds","ps","part","pathId","traverseNodes","terrainReadySegment","stopLoading","zoomPassNode","renderTree","clearNeighbors","_insideSegment","frustums","numFrustums","commonFrustumFlag","containsBox","horizonDist","polarSizeSqr","projectedSize","_maxLodSize","onlyTerrain","whileTerrainLoading","whileNormalMapCreating","addToRender","childrenPrevStateEquals","isFading","_collectFadingNodes","timestamp","_refreshTransitionOpacity","has","_transitionOpacityEnabled","getRenderedNodesNeighbors","rf","_renderedNodesInFrustum","applyNeighbor","opcs","ap","ld","cs_size","opcs_size","cs","getCommonSide","as","bs","a_ne","a_sw","b_ne","b_sw","a_ne_lon","a_ne_lat","a_sw_lon","a_sw_lat","b_ne_lon","b_ne_lat","b_sw_lon","b_sw_lat","gridSizeExt","vi_x_is","vi_y_is","i3","fgsZ","nij","clearTree","destroyBranches","clearBranches","nodesToRemove","neighbourNode","pNode","neighbourZoom","QuadTreeStrategy","projection","_quadTreeList","mats","preRender","quadTree","preLoad","normalMapCreator","drawSingle","collectRenderNodes","POLE_PIECE_SIZE","SegmentLonLat","_getMaxZoom","maxPoleZoom","Yz","_assignTileXIndexes","_assignTileYIndexes","lonSize","latSize","ltStep","EarthQuadTreeStrategy","Geoid","_cached_ix","_cached_iy","_v00","_v01","_v10","_v11","_t","loadModel","ok","status","arrayBuffer","rawfile","getline","fromCharCode","match","isFinite","rlonres","rlatres","setModel","_rawval","ix","iy","fy","fx","GeoImageCreator","maxFrames","MAX_FRAMES","_framebufferMercProj","_currentFrame","_queue","_quadTexCoordsBuffer","_quadVertexBuffer","_initShaders","_initBuffers","toMerc","v03","v12","v01","v32","halfSize","gridHigh","gridLow","kh","kl","P03i","P12i","utils.getLinesIntersectionLonLat","geoImage","LOADER_EVENTS","Loader","maxRequests","_loading","_senderRequestCounter","_promises","json","blob","imageBitmap","createImageBitmap","premultiplyAlpha","__requestCounterFrame__","msg","getRequestCounter","_checkLoadend","request","_handleResponse","abort","abortAll","NormalMapCreator","_minTabelSize","minTableSize","_maxTableSize","maxTableSize","_verticesBufferArray","_indexBufferArray","_positionBuffer","_normalMapVerticesTexture","normalMapBlur","s_texture","normalMap","a_normal","gs2","positions","_drawNormalMapBlur","indBuf","equalizeNormals","outTexture","_drawNormalMapNoBlur","_drawNormalMap","isBlur","BLEND","startTime","PlainSegmentWorker","PLAIN_SEGMENT_PROGRAM","setGeoid","_e2","_heightFactor","planeNormalize","plane","Frustum","_pickingColorU","inverseProjectionMatrix","inverseProjectionViewMatrix","cameraFrustumIndex","setProjectionMatrix","aspect","getRightPlane","getLeftPlane","getBottomPlane","getTopPlane","getBackwardPlane","getForwardPlane","getInverseProjectionMatrix","setViewMatrix","containsPoint","containsSphereBottomExc","containsSphereButtom","containsSphere2","cout","cin","Camera","_aspect","_viewAngle","_viewMatrix","_normalMatrix","_pr","_pu","_pb","_peye","isMoving","_tanViewAngle_hrad","frustumColors","fi","fr","FARTHEST_FRUSTUM_INDEX","currentFrustumIndex","isFirstPass","_projSizeConst","checkMoveEnd","moveend","bindRenderer","getClientAspect","_setProj","_init","getDown","getLeft","getBackward","viewchange","setAspectRatio","getAspectRatio","_oneByHeight","setViewAngle","du","dv","dn","sn","world1","isArc","ntr","trm","getNormalMatrix","setCurrentFrustum","getCurrentFrustum","getInverseProjectionViewMatrix","PlanetCamera","_terrainAltitude","_terrainPoint","_framesArr","_framesCounter","_numFrames","_completeCallback","_frameCallback","_flying","eyeNorm","setTerrainCollisionActivity","getEquatorialSize","updateGeodeticPosition","cartesianToLonLatRes","lookLonLat","newEye","newLook","getExtentPosition","north","south","east","west","southEast","northWest","_h","_w","tanPhi","tanTheta","ampl","completeCallback","startCallback","frameCallback","viewDistance","_rot","newPos","newUp","ground_a","v_a","n_a","lonlat_b","up_b","ground_b","n_b","u_b","v_b","bn","anbn","hM_a","math.SQRT_HALF","currMaxHeight","max_h","zero","g_i","ground_i","getRayIntersectionEllipsoid","height_i","eye_i","up_i","look_i","frameCallbak","rotateLeft","spin","rotateRight","rotateUp","rotateDown","dSlope","checkFly","getSurfaceVisibleDistance","R","equatorialSizeSqr","TerrainWorker","TERRAIN_PROGRAM","info","this_plainVertices","this_plainNormals","this_normalMapVertices","this_normalMapNormals","heightFactor","noDataValues","VectorTileCreator","vectorTileLineRasterization","thicknessOutline","vectorTilePolygonRasterization","coordinatesHigh","coordinatesLow","hLine","hPoly","_w2","_h2","createEmptyTexture_n","geomHandler","mb","Ellipsoid","_flattening","_a2","_b2","qa2b2","_e","_e22","_k2","_radii","_radii2","_invRadii","rhumbDistanceTo","f1","f2","df","getIntermediatePointOnGreatCircle","lonLat2","fraction","azimuth","getGreatCircleDestination","getBearing","l2","getFlattening","latrad","lonrad","slt","nc","projToSurface","pX","pY","pZ","invRadii2X","invRadii2Y","invRadii2Z","z2","ratio","lambda","m_X","m_Y","m_Z","m_X2","m_Y2","m_Z2","destination","fi1","lambda1","fi2","tanU1","cosU1","sinU1","tanU2","cosU2","sinU2","antipodal","lmb","sinLmb","cosLmb","sin_s","cos_s","sinSqs","cos2sm","cosSqa","lmb_","iterations","uSq","EPSILON","NaN","finalAzimuth","lon1","lat1","alpha1","sinAlpha1","cosAlpha1","sigma1","sinAlpha","cosSqAlpha","sigma","sigmaP","cos2SigmaM","sinSigma","cosSigma","deltaSigma","tmp","lat2","revAz","difference","w2","product","discriminant","qw","qw2","root0","root1","root","getBearingDestination","bearing","nlon","dR","sinf1","cosf1","sinl1","cosl1","sinf2","cosf2","sinl2","cosl2","dl","f3","l3","getRhumbBearing","dLon","dPhi","wgs84","_tempPickingPix_","_tempDepthColor_","Planet","_renderingFadingNodes","currentNode","sl","outTransparentSegments","isEq","_renderingFadingNodesNoDepth","_prevNodes","_currNodes","_updateLayer","visibleVectorLayers","_visibleTileLayerSlices","_frustumEntityCollections","maxEqualZoomAltitude","minEqualZoomAltitude","minEqualZoomCameraSlope","mousePositionOnEarth","emptyTexture","_skipPreRender","_initialViewExtent","_fadingNodesInFrustum","_indexesCacheToRemove","quadTreeStrategyPrototype","_nightTexture","_specularTexture","SLICE_SIZE_3","_lodSize","_curLodSize","_minLodSize","maxLoadingRequests","_memKey","PLANET_EVENTS","_prevCamEye","always","_collectRenderNodesIsActive","_renderScreenNodesPASS","_renderScreenNodesPASSNoAtmos","_renderScreenNodesWithHeightPASS","_renderScreenNodesWithHeightPASSNoAtmos","_atmosphereEnabled","_atmosphereMaxMinOpacity","_nightTextureSrc","nightTextureSrc","_specularTextureSrc","specularTextureSrc","transitionOpacityEnabled","enabled","_initializeAtmosphere","getLayers","setLodSize","currentLodSize","minLodSize","maxLodSize","addControls","cArr","layervisibilitychange","addLayers","baselayerchange","setHeightFactor","factor","_clearRenderedNodeList","_clearRenderNodesInFrustum","getHeightFactor","setTerrain","memClear","clearCache","_geoid","getGeoid","_renderScreenNodesPASSAtmos","_renderScreenNodesWithHeightPASSAtmos","isWebGl2","maxMinOpacity","shaders.drawnode_screen_wl_webgl1NoAtmos","_initializeShaders","frustumPickingColor","_renderColorPickingFramebufferPASS","addDepthCallback","_renderDepthFramebufferPASS","addDistanceCallback","_renderDistanceFramebufferPASS","TABLESIZE","ptr","texCoordCache","createDefaultTexture","_updateVisibleLayers","_frustumEntityCollectionPickingCallback","_globalPreDraw","_preRender","_checkRendercompleted","initLayers","_clearIndexesCache","createDefaultTextures","param0","param1","_getLayerAttributionHTML","_applyAttribution","_sortLayers","attributions","_collectRenderedNodesMaxZoom","temp2","ht","isEnabled","_collectRenderNodes","math.lerp","opaqueNodes","rij","_setUniformsNoAtmos","_renderingScreenNodes","_setUniformsAtmos","_renderingScreenNodesWithHeight","__useDistanceFramebuffer__","_collectVectorLayerCollections","rendercompleted","terraincompleted","enableBlendOneSrcAlpha","drawnode_screen_wl","drawnode_screen_nl","renderedNodes","firstPass","sli","transparentSegments","tj","POLYGON_OFFSET_FILL","slj","polygonOffset","drawnode_heightPicking","drawnode_colorPicking","enableBlendDefault","drawnode_depth","getCartesianFromPixelEllipsoid","getLonLatFromPixelEllipsoid","getPixelFromLonLat","getDistanceFromPixelEllipsoid","spx","spy","readDistanceColor","use32","math.step","math.mod","math.exp2","decodeFloatFromRGBAArr","screenDepthFramebuffer","screenPos","viewPosition","viewExtentArr","extentArr","viewLonLat","readyCollections","SkyBox","createDefault","RESOURCES_URL","uSampler","enableArray","loadCubeMapTexture","skybox","buf","axesBuffer","axesColorBuffer","createAxesBuffer","LINES","aVertexColor","axesShader","EmptyTerrain","geoidSrc","checkNoDataValue","maxNodeZoom","handleSegmentTerrain","GlobusTerrain","_s","subdomains","GLOBUSTERRAIN_EVENTS","_requestCount","_requestsPeerSubdomain","_dataType","_elevationCache","_fetchCache","_loader","_urlRewriteCallback","urlRewrite","heights","firstAttempt","mercator.POLE2","merc","mercator.forward","_getGroundHeightMerc","_buildURL","mercator.getTileExtent","_createHeights","getTileCache","tileData","v0Ind","v1Ind","v2Ind","v3Ind","h2","h3","v3","setUrl","setName","isReadyToLoad","_applyElevationsData","_getHTTPRequestString","_getSubdomain","_createUrl","setUrlRewriteCallback","ur","isMaxZoom","XYZ","XYZ_EVENTS","_requestsPeerSubdomains","_checkSegment","em","ENLARGE_MERCATOR_LON","ENLARGE_MERCATOR_LAT","WMS","_extra","extra","imageWidth","imageHeight","_getBbox","get_bbox_v1_1_1","_version","setVersion","version","createRequestUrl","srs","get_bbox_v1_3_0","BilTerrain","_format","_imageSize","imageSize","preventChildren","bil16","Int16Array","extractElevationTilesNonPowerOfTwo","elevationsSize","rightHeight","bottomHeight","isNoDataCurrent","isNoDataRight","isNoDataBottom","rightBottomHeight","isNoDataRightBottom","extractElevationTiles","rgb2Height","MapboxTerrain","_createTemporalCanvas","_imageDataCache","SIZE","i4","extractElevationTilesMapboxNonPowerOfTwo","fromInd4","sourceSize4","k4","extractElevationTilesMapboxNoChildren","extractElevationTilesMapbox","sizeImgW","sizeImgH","GeoImage","_onLoad_","HTMLImageElement","_onLoad","_applyImage","createTexture_l","ev","GeoTexture2d","frameWidth","frameHeight","GeoVideo","_video","videoElement","setVideoElement","video","texImage2D","UNSIGNED_BYTE","createTexture_n_webgl1","_onCanPlay","videoWidth","videoHeight","_onError","readyState","HAVE_ENOUGH_DATA","autoplay","loop","muted","setAttribute","KML","_billboard","_extractCoordonatesFromKml","xmlDoc","getElementsByTagName","textContent","co","_AGBRtoRGBA","agbr","_parseKMLcoordinates","_kmlPlacemarkToEntity","placemark","nameTags","iconHeading","iconURL","iconColor","_extractStyle","lonLats","lonlatalt","hdgrad","iconstyle","hdg","href","linestyle","_parseKML","documentElement","_convertKMLintoEntities","_convertCoordonatesIntoEntities","addToExtent","_pathes","kmlFile","_getXmlContent","file","fileReader","FileReader","DOMParser","parseFromString","readAsText","_expandExtents","extent1","extent2","addKmlFromFiles","kmls","coordonates","_getKmlFromUrl","XMLHttpRequest","responseType","overrideMimeType","DONE","responseXML","send","addKmlFromUrl","kml","CLOCK_EVENTS","Clock","__handler","jd.DateToUTC","_multiplier","_running","deltaTicks","_intervalDelay","_intervalStart","_intervalCallback","delay","jd.ONE_BY_MILLISECONDS_PER_DAY","getDate","jd.UTCtoDate","tick","cd","jd.addMilliseconds","ProgramController","_activated","getProgram","activeProgram","Stack","_head","vendorPrefixes","CONTEXT_TYPE","Handler","canvasTarget","_clocks","_canvasSize","_params","anisotropy","extensions","context","_canvasTarget","_lastAnimationFrameTime","createTexture_n","createTexture_n_webgl2","createTexture_l_webgl2","createTexture_mm","createTexture_mm_webgl2","createTexture_a","createTexture_a_webgl2","NEAREST","LINEAR","MIPMAP","ANISOTROPIC","ONCANVASRESIZE","_createCanvas","contextAttributes","ver","setFrameCallback","level","texParameteri","TEXTURE_MIN_FILTER","TEXTURE_MAG_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","createTexture_l_webgl1","createTexture_mm_webgl1","generateMipmap","LINEAR_MIPMAP_LINEAR","createTexture_a_webgl1","texParameterf","EXT_texture_filter_anisotropic","TEXTURE_MAX_ANISOTROPY_EXT","texStorage2D","texSubImage2D","faces","TEXTURE_CUBE_MAP_POSITIVE_X","TEXTURE_CUBE_MAP_NEGATIVE_X","TEXTURE_CUBE_MAP_POSITIVE_Y","TEXTURE_CUBE_MAP_NEGATIVE_Y","TEXTURE_CUBE_MAP_POSITIVE_Z","TEXTURE_CUBE_MAP_NEGATIVE_Z","emptyImage","notActivate","_initProgramController","addPrograms","programsArr","_initPrograms","initializeExtension","extensionStr","showLog","_setDefaults","intersectionObserver","IntersectionObserver","_toggleVisibilityChange","isIntersecting","threshold","resizeObserver","contentRect","visibilityState","frontFace","CCW","cullFace","BACK","getCanvasSize","usage","createBuffer","bufferData","STREAM_DRAW","bufferSubData","STATIC_DRAW","createArrayBufferLength","pr","drawFrame","hidden","clearFrame","isStopped","success","imgCnv","disconnect","numAttribs","getParameter","MAX_VERTEX_ATTRIBS","numTextureUnits","MAX_TEXTURE_IMAGE_UNITS","DITHER","SCISSOR_TEST","blendColor","blendEquation","FUNC_ADD","blendFunc","ONE","clearDepth","clearStencil","addClock","addClocks","clockArr","removeClock","Multisample","_msaa","msaa","_glFilter","renderbuffers","colorAttachments","renderbufferStorageMultisample","DEPTH_ATTACHMENT","blitTo","framebuffer","READ_FRAMEBUFFER","DRAW_FRAMEBUFFER","clearBufferfv","COLOR","blitFramebuffer","_sortByPriority","KeyboardHandler","_currentlyPressedKeys","_pressedKeysCallbacks","_unpressedKeysCallbacks","_charkeysCallbacks","_anykeyCallback","_event","onkeydown","handleKeyDown","onkeyup","handleKeyUp","getcurrentlyPressedKeys","getPressedKeysCallbacks","getUnpressedKeysCallbacks","getCharkeysCallbacks","removeEvent","keyCode","_removeCallback","setActivity","activity","addEvent","ch","ccl","pk","cpk","handleEvents","MouseHandler","htmlObject","_htmlObject","setEvent","deltaY","detail","TouchHandler","eventExt","_currPickingColor","_tempCurrPickingColor","_prevPickingColor","RendererEvents","RENDERER_EVENTS","_touchHandler","_mouseHandler","_keyboardHandler","clickRadius","leftButtonUp","rightButtonUp","middleButtonUp","rightButtonDown","middleButtonDown","middleButtonHold","leftButtonDoubleClick","rightButtonDoubleClick","middleButtonDoubleClick","leftButtonClick","rightButtonClick","middleButtonClick","justStopped","doubleClickDelay","clickDelay","touchState","touchEnd","touchStart","touchCancel","doubleTouch","doubleTouchDelay","doubleTouchRadius","_isMouseInside","_entityPickingEventsActive","_dblTchCoords","_oneTouchStart","_dblTchBegins","_mousestopThread","_ldblClkBegins","_rdblClkBegins","_mdblClkBegins","_lClkBegins","_rClkBegins","_mClkBegins","_lclickX","_lclickY","_rclickX","_rclickY","_mclickX","_mclickY","pointerEvent","ts","handleMouseEvents","handleTouchEvents","entityPickingEvents","keyPriority","onMouseUp","onMouseDown","getPickingObjectArr","pe","readPickingColor","ISBLACK","po","NOTBLACK","ce","_this","mousestop","tpo","tpe","pickingFramebuffer","Rectangle","getSquare","getDiagonal","fit","ImagesCacheManager","imagesCache","_imageIndexCounter","req","onerror","TextureAtlas","_images","_btree","_imagesCacheManager","borderSize","atlasWidth","atlasHeight","fastInsert","_makeAtlas","_completeNode","im","TextureAtlasNode","atlas","getImageTexCoordinates","newNode","rc","FontTextureAtlas","gliphSize","distanceRange","FontTextureAtlasNode","emptySize","chnl","page","xadvance","xoffset","yoffset","nChar","nCode","FontAtlas","catalogSrc","atlasIndexes","atlasIndexesDeferred","tokenImageSize","MAX_SIZE","fullName","getFullIndex","loadFont","_applyFontDataToAtlas","chars","common","scaleH","scaleW","distanceField","idToChar","taNode","ciNorm","ciCode","ki","amount","initFont","faceName","dataJson","imageBase64","srcDir","atlasUrl","pages","__pickingCallbackCounter__","__depthCallbackCounter__","__distanceCallbackCounter__","clientWaitAsync","sync","flags","clientWaitSync","WAIT_FAILED","TIMEOUT_EXPIRED","Renderer","_readPickingBuffer_webgl1","_readPickingBuffer_webgl2","_pickingPixelBuffer","_skipPickingFrame","PIXEL_PACK_BUFFER","byteLength","STREAM_READ","fenceSync","SYNC_GPU_COMMANDS_COMPLETE","flush","deleteSync","getBufferSubData","_readDistanceBuffer_webgl1","distanceFramebuffer","_tempDistancePix_","_readDistanceBuffer_webgl2","_distancePixelBuffer","_skipDistanceFrame","whitepoint","brightThreshold","colorObjects","_pickingCallbacks","_distanceCallbacks","_depthCallbacks","depthFramebuffer","urlParams","msaaParam","toneMappingFramebuffer","geoObjectsTextureAtlas","fontsSrc","_entityCollections","_currentOutput","_fnScreenFrame","screenTexture","outputTexture","_readDistanceBuffer","_readPickingBuffer","ONE_MINUS_SRC_ALPHA","blendFuncSeparate","SRC_ALPHA","setEventsActivity","removeDepthCallback","removeDistanceCallback","getPickingObject","getPickingObject3v","getClientCenter","removeControl","_screenFrameNoMSAA","screen","_maxMSAA","getMaxMSAA","hdrBuffer","depthTexture","_screenFrameMSAA","_initReadPixelsBuffers","_resizeStart","_resizeEnd","resizeend","_initializeRenderNodes","_initializeControls","setCurrentScreen","screenName","addNodeBefore","renderNodeBefore","addNodes","nodesArr","getInternalformatParameter","SAMPLES","getMSAA","ecArr","_drawOpaqueEntityCollections","_drawTransparentEntityCollections","eci","_clearEntityCollectionQueue","drawtransparent","_drawPickingBuffer","_drawDistanceBuffer","_drawDepthBuffer","postdraw","toneMapping","screenFrame","dp","outColor","DEFAULT_RESOURCES_SRC","Globe","$target","_instanceID","transition","$inner","attributionContainer","attachTo","_disableWheel","onmouseenter","capture","passive","onmouseleave","dpi","antialias","premultipliedAlpha","_planetName","resourcesSrc","useEarthNavigation","_controls","fadeIn","fadeOut","detach","TEMPLATE","POPUP_EVENTS","SegmentLonLatWgs84","MarsQuadTreeStrategy","earthQuadTreeSouth","earthQuadTreeWest","Wgs84QuadTreeStrategy","wgs84QuadTree","quadTreeStrategyType","epsg4326","earth","mars","getProjection","getProjectionPoint","Pn1","Pn2","maxc","iP","_content","content","$content","$tip","_cartPos","_updatePosition","setScreen","setContent","getContainer","getToolbarContainer","setTitle"],"mappings":"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"}